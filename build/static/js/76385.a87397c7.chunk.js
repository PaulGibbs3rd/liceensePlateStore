"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[76385,55515],{55515:function(e,t,n){n.r(t),n.d(t,{createArcadeExecutor:function(){return A},createArcadeProfile:function(){return T}});var r=n(74165),i=n(1413),a=n(15861),o=n(37762),l=n(4942),u=n(52639),s=n(51064),c=n(97246),d=n(10064),p=n(84652),f=n(84726),v=n(58237),h=n(64326),y=n(7575),m=n(49818),g=n(819),b=null;function _(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=t.elementType,a="value",o="array"===i.type?[{name:a,type:i.type,elementType:i.elementType}]:"dictionary"===i.type?[{name:a,type:i.type,properties:i.properties}]:[{name:a,type:i.type}];return new c.Z(e.map((function(e){var t={};return Z(t,o,(0,l.Z)({},a,e),n,r),t[a]})))}function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e instanceof m.Z?new h.default({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return t.constructFeatureSet(r,n.spatialReference,null,!0,n.lruCache,n.interceptor)}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.spatialReference,i=n.interceptor,a=n.lruCache;return"string"==typeof e?t.createFeatureSetCollectionFromService(e,r,a,i):t.createFeatureSetCollectionFromMap(e,r,a,i)}function x(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={};return Z(i,t.properties,e,n,r),new b.Dictionary(i)}function Z(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a={},l=0,u=Object.keys(n);l<u.length;l++){var c=u[l];a[c.toLowerCase()]=n[c]}var d,p=(0,o.Z)(t);try{for(p.s();!(d=p.n()).done;){var h=d.value,y=h.name.toLowerCase();if(i.variablesPreProcessed)e[y]=a[y];else switch(h.type){case"array":var m=a[y];e[y]=null==m?null:_(m,h,r,i);break;case"feature":var g=a[y];e[y]=null==g?null:b.Feature.createFromGraphic(g,null===i||void 0===i?void 0:i.timeZone);break;case"featureSet":var Z=a[y];e[y]=null==Z?null:r?C(Z,r,i):null;break;case"featureSetCollection":var w=a[y];e[y]=null==w?null:r?k(w,r,i):null;break;case"dictionary":var F=a[y];e[y]=null==F?null:x(F,h,r,i);break;case"date":var V=a[y];e[y]=V?V instanceof s.iG?V:null!==i&&void 0!==i&&i.timeZone?s.iG.dateJSAndZoneToArcadeDate(V,null===i||void 0===i?void 0:i.timeZone):s.iG.dateJSToArcadeDate(V):null;break;case"dateOnly":var I=a[y];e[y]=I?I instanceof f.u?I:f.u.fromReader(I):null;break;case"time":var E=a[y];e[y]=E?E instanceof v.n?E:v.n.fromReader(E):null;break;case"knowledgeGraph":case"geometry":case"boolean":case"text":case"number":e[y]=a[y]}}}catch(R){p.e(R)}finally{p.f()}}function w(e,t){var n,r=(0,o.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;t.push(i),"dictionary"===i.type&&w(i.properties,t)}}catch(a){r.e(a)}finally{r.f()}return t}function F(e,t,n,r,i){var a=n.spatialReference,o=n.interceptor,l=n.lruCache,u=n.console,s=n.abortSignal,c=n.timeZone,d=n.services,p={vars:{},spatialReference:a,interceptor:o,timeZone:c,lrucache:l,useAsync:i,services:void 0===d?{portal:y.Z.getDefault()}:d,console:u,abortSignal:s};return t?(Z(p.vars,e.variables,t,r,n),p):p}function V(e,t){switch(t.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":var n=(e.type,e),r="geometry"in n?n.geometry():null,i="readAttributes"in n?n.readAttributes():n.attributes;return new u.Z({geometry:r,attributes:i});case"dictionary":for(var a=e,o=a.attributes,l={},s=0,c=Object.keys(o);s<c.length;s++){var d=c[s];l[d]=V(a.field(d),t)}return l;case"array":return("toArray"in e?e.toArray():e).map((function(e){return V(e,t)}))}return e}var I={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$userInput",type:"geometry"},{name:"$graph",type:"knowledgeGraph"}]},E={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},R=new Map([["aggregate-field",{variables:[{name:"$feature",type:"feature"}]}],["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",I],["popup-element",I],["feature-reduction-popup",E],["feature-reduction-popup-element",E],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);function T(e){var t=R.get(e);if(!t){var n=Array.from(R.keys()).map((function(e){return"'".concat(e,"'")})).join(", ");throw new d.Z("createArcadeProfile:invalid-profile-name","Invalid profile name '".concat(e,"'. You must specify one of the following values: ").concat(n))}return(0,p.d9)(t)}function A(e,t){return S.apply(this,arguments)}function S(){return S=(0,a.Z)((0,r.Z)().mark((function e(t,n){var l,u,s,c,p,f,v,h,y,m,_,C,k,x,Z,I,E,R,T,A,S,O,M=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=M.length>2&&void 0!==M[2]?M[2]:{},e.t0=b,e.t0){e.next=6;break}return e.next=5,(0,g.LC)();case 5:b=e.sent;case 6:if(s=(u=b).arcade,c=u.arcadeUtils,p=s.loadScriptDependencies,f=s.referencesMember,v=s.scriptIsAsync,h=w(n.variables,[]),y=h.filter((function(e){return"featureSet"===e.type||"featureSetCollection"===e.type})).map((function(e){return e.name.toLowerCase()})),m=s.parseScript(t,y)){e.next=9;break}throw new d.Z("arcade:invalid-script","Unable to create SyntaxTree");case 9:return _=c.extractFieldNames(m),C=s.scriptTouchesGeometry(m),k=h.map((function(e){return e.name.toLowerCase()})).filter((function(e){return f(m,e)})),x=v(m,y),e.next=12,p(m,x,y);case 12:Z={vars:{},spatialReference:null,useAsync:x},I=(0,o.Z)(k);try{for(I.s();!(E=I.n()).done;)R=E.value,Z.vars[R]="any"}catch(L){I.e(L)}finally{I.f()}return T=l.lruCache,A=s.compileScript(m,Z),S=s.featureSetUtils(),O=l.services,e.abrupt("return",{execute:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x)throw new d.Z("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");var r=A(F(n,e,(0,i.Z)({lruCache:T},t),S,x));return t.rawOutput?r:V(r,c)},executeAsync:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var a,o,l=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},e.next=3,A(F(n,t,(0,i.Z)({lruCache:T,services:O},a),S,x));case 3:return o=e.sent,e.abrupt("return",a.rawOutput?o:V(o,c));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isAsync:x,variablesUsed:k,fieldsUsed:_,geometryUsed:C,syntaxTree:m});case 17:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}},97246:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(15671),i=n(43144),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,r.Z)(this,e),this._elements=t}return(0,i.Z)(e,[{key:"length",value:function(){return this._elements.length}},{key:"get",value:function(e){return this._elements[e]}},{key:"toArray",value:function(){return this.slice()}},{key:"slice",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length(),n=[],r=e;r<t;r++)n.push(this.get(r));return n}}]),e}()},18442:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(15671),i=n(43144),a=n(39052),o=n(56885),l=function(e,t){function n(e){(0,r.Z)(this,n),this._observable=new o.s,this._map=new Map(e)}return(0,i.Z)(n,[{key:"size",get:function(){return(0,a.it)(this._observable),this._map.size}},{key:"clear",value:function(){this._map.size>0&&(this._map.clear(),this._observable.notify())}},{key:"delete",value:function(e){var t=this._map.delete(e);return t&&this._observable.notify(),t}},{key:"entries",value:function(){return(0,a.it)(this._observable),this._map.entries()}},{key:"forEach",value:function(e,t){var n=this;(0,a.it)(this._observable),this._map.forEach((function(r,i){return e.call(t,r,i,n)}),t)}},{key:"get",value:function(e){return(0,a.it)(this._observable),this._map.get(e)}},{key:"has",value:function(e){return(0,a.it)(this._observable),this._map.has(e)}},{key:"keys",value:function(){return(0,a.it)(this._observable),this._map.keys()}},{key:"set",value:function(e,t){return this._map.set(e,t),this._observable.notify(),this}},{key:"values",value:function(){return(0,a.it)(this._observable),this._map.values()}},{key:e,value:function(){return(0,a.it)(this._observable),this._map[Symbol.iterator]()}},{key:t,get:function(){return this._map[Symbol.toStringTag]}}]),n}(Symbol.iterator,Symbol.toStringTag)},2622:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(15671),i=n(43144),a=n(39052),o=n(56885),l=function(e,t){function n(e){(0,r.Z)(this,n),this._observable=new o.s,this._set=new Set(e)}return(0,i.Z)(n,[{key:"size",get:function(){return(0,a.it)(this._observable),this._set.size}},{key:"add",value:function(e){var t=this._set.size;return this._set.add(e),this._set.size!==t&&this._observable.notify(),this}},{key:"clear",value:function(){this._set.size>0&&(this._set.clear(),this._observable.notify())}},{key:"delete",value:function(e){var t=this._set.delete(e);return t&&this._observable.notify(),t}},{key:"entries",value:function(){return(0,a.it)(this._observable),this._set.entries()}},{key:"forEach",value:function(e,t){var n=this;(0,a.it)(this._observable),this._set.forEach((function(r,i){return e.call(t,r,i,n)}),t)}},{key:"has",value:function(e){return(0,a.it)(this._observable),this._set.has(e)}},{key:"keys",value:function(){return(0,a.it)(this._observable),this._set.keys()}},{key:"values",value:function(){return(0,a.it)(this._observable),this._set.values()}},{key:e,value:function(){return(0,a.it)(this._observable),this._set[Symbol.iterator]()}},{key:t,get:function(){return this._set[Symbol.toStringTag]}}]),n}(Symbol.iterator,Symbol.toStringTag)},46634:function(e,t,n){n.d(t,{R:function(){return v}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),l=n(27366),u=n(7138),s=n(42537),c=n(94172),d=n(99346),p=n(49861),f=n(69912),v=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).updating=!1,e._handleId=0,e._scheduleHandleId=0,e._pendingPromises=new Set,e}return(0,i.Z)(n,[{key:"destroy",value:function(){this.removeAll()}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,c.watch)}},{key:"addWhen",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,c.when)}},{key:"addOnCollectionChange",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.initial,a=void 0!==i&&i,o=r.final,l=void 0!==o&&o,u=++this._handleId;return this.addHandles([(0,c.on)(e,"after-changes",this._createSyncUpdatingCallback(),c.sync),(0,c.on)(e,"change",t,{onListenerAdd:a?function(e){return t({added:e.toArray(),removed:[]})}:void 0,onListenerRemove:l?function(e){return t({added:[],removed:e.toArray()})}:void 0})],u),(0,s.kB)((function(){return n.removeHandles(u)}))}},{key:"addPromise",value:function(e){var t=this;if(null==e)return e;var n=++this._handleId;this.addHandles((0,s.kB)((function(){t._pendingPromises.delete(e)&&(0!==t._pendingPromises.size||t.hasHandles(h)||t._set("updating",!1))})),n),this._pendingPromises.add(e),this._set("updating",!0);var r=function(){return t.removeHandles(n)};return e.then(r,r),e}},{key:"removeAll",value:function(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}},{key:"_installWatch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,a);var o=i(e,t,r);return this.addHandles(o,a),(0,s.kB)((function(){return n.removeHandles(a)}))}},{key:"_installSyncUpdatingWatch",value:function(e,t){var n=this._createSyncUpdatingCallback(),r=(0,c.watch)(e,n,{sync:!0,equals:function(){return!1}});return this.addHandles(r,t),r}},{key:"_createSyncUpdatingCallback",value:function(){var e=this;return function(){e.removeHandles(h),++e._scheduleHandleId;var t=e._scheduleHandleId;e._get("updating")||e._set("updating",!0),e.addHandles((0,d.Os)((function(){t===e._scheduleHandleId&&(e._set("updating",e._pendingPromises.size>0),e.removeHandles(h))})),h)}}}]),n}(u.default);(0,l._)([(0,p.Cb)({readOnly:!0})],v.prototype,"updating",void 0),v=(0,l._)([(0,f.j)("esri.core.support.UpdatingHandles")],v);var h=-42},8234:function(e,t,n){n.d(t,{NL:function(){return p},QC:function(){return d}});var r=n(44925),i=n(61631),a=n(8905),o=n(96919),l=(n(80975),n(67005)),u=["actions","context","headingLevel","message","title"],s="esri-editor__prompt",c={base:s,header:"".concat(s,"__header"),heading:"".concat(s,"__header__heading"),message:"".concat(s,"__message"),divider:"".concat(s,"__divider"),actions:"".concat(s,"__actions")},d=function(){return(0,a.h)({button:function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(14105),n.e(32275)]).then(n.bind(n,32275))},icon:function(){return Promise.all([n.e(92358),n.e(87474)]).then(n.bind(n,87474))},scrim:function(){return Promise.all([n.e(92358),n.e(46895),n.e(99174)]).then(n.bind(n,99174))},label:function(){return Promise.all([n.e(92358),n.e(35738)]).then(n.bind(n,35738))},"radio-button":function(){return Promise.all([n.e(92358),n.e(54438),n.e(29033)]).then(n.bind(n,29033))},"radio-button-group":function(){return Promise.all([n.e(92358),n.e(4508)]).then(n.bind(n,4508))}})};function p(e){var t,n,a=e.actions,s=e.context,d=e.headingLevel,p=e.message,v=e.title,h=(0,r.Z)(e,u),y=a.primary,m=a.secondary;switch(s){case"danger":n="danger";break;case"info":n="brand";break;default:n="neutral"}var g=(0,l.u)("calcite-button",{afterCreate:f,appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:n,onclick:y.action,width:m?"half":"full"},y.label),b=m&&(0,l.u)("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:n,onclick:m.action,width:"half"},m.label);return(0,l.u)("calcite-scrim",{"data-testid":"prompt",key:"prompt"},(0,l.u)("div",{class:"".concat(c.base,"--").concat(s)},(0,l.u)("div",{class:c.header},(0,l.u)("calcite-icon",{icon:i.t}),(0,l.u)(o.X,{class:c.heading,level:d},v)),(0,l.u)("div",{class:c.message},p),null!==(t=function(e){var t=e.radios,n=e.onRadioSelection,r=e.defaultRadioSelection;return null!==t&&void 0!==t&&t.length?(0,l.u)("calcite-radio-button-group",{name:"PromptChoiceList"},t.map((function(e){return(0,l.u)("calcite-label",{layout:"inline"},(0,l.u)("calcite-radio-button",{checked:e.value===r,value:e.value,onCalciteRadioButtonChange:function(){return null===n||void 0===n?void 0:n(e.value)}}),e.label)}))):void 0}(h))&&void 0!==t?t:(0,l.u)("div",{class:c.divider}),(0,l.u)("div",{class:c.actions},b,g)))}function f(e){requestAnimationFrame((function(){return e.setFocus()}))}},61631:function(e,t,n){n.d(t,{t:function(){return r}});var r="exclamation-mark-triangle"},76385:function(e,t,n){n.r(t),n.d(t,{default:function(){return G}});var r=n(74165),i=n(15861),a=n(93433),o=n(4942),l=n(1413),u=n(29439),s=n(15671),c=n(43144),d=n(97326),p=n(60136),f=n(29388),v=n(27366),h=(n(59166),n(63780)),y=(n(93169),n(32718)),m=n(66978),g=n(94172),b=n(49861),_=n(69912),C=n(37270),k=n(33565),x=n(8234),Z="esri-feature-form",w="".concat(Z,"__group"),F="".concat(Z,"__input"),V="".concat(Z,"__related-records"),I={base:Z,form:"".concat(Z,"__form"),formHeader:"".concat(Z,"__form-header"),label:"".concat(Z,"__label"),labelTextContent:"".concat(Z,"__label-text-content"),fieldInput:"".concat(F),inputRadio:"".concat(F,"--radio"),inputRadioGroup:"".concat(F,"--radio-group"),inputRadioLabel:"".concat(F,"--radio-label"),inputDisabled:"".concat(F,"--disabled"),inputSwitch:"".concat(F,"--switch"),centeredButton:"".concat(Z,"__centered-button"),description:"".concat(Z,"__description-text"),listObserver:"".concat(Z,"__list-observer"),relatedRecordsHeader:"".concat(V,"_header"),relatedRecordsLabel:"".concat(V,"_label"),relatedRecordsList:"".concat(V,"_list"),dateInputContainer:"".concat("".concat(Z,"__date"),"-input-container"),textElement:"".concat(Z,"__text-element"),group:w,groupSequential:"".concat(w,"--sequential"),groupActive:"".concat(w,"--active")},E=n(73238),R=n(16458),T=n(8905),A=n(36496),S=n(83651),O=n(7021),M=n(96919),L=(n(80975),n(80532)),N=n(28907),D=n(67005),j=n(8704),P="data-field-name",H=function(e){(0,p.Z)(v,e);var t=(0,f.Z)(v);function v(e,n){var r;return(0,s.Z)(this,v),(r=t.call(this,e,n))._attemptFocusOnNextRender=!1,r._dateComponentMap=new Map,r._inputsWithChanges=new Set,r._focusedFieldName=null,r._pendingSubtypeChoice=null,r._listObserverNode=null,r._listObserver=new IntersectionObserver((function(e){e.length&&e[0].isIntersecting&&r._incrementRelatedRecordPage()}),{root:window.document}),r._prompt=null,r.groupDisplay="all",r.headingLevel=2,r.messages=null,r.messagesCommon=null,r.messagesFeature=null,r.messagesTemplates=null,r.viewModel=new R.Z,r._onShowAllRelatedRecordsClick=function(e){var t=(0,d.Z)(r),n=t.feature,i=t.relatedRecordCallbacks;n&&(null===i||void 0===i?void 0:i.showAllRelatedRecords)&&i.showAllRelatedRecords({parentFeature:n,relationshipId:e})},r._onAddRelatedRecordsClick=function(e,t){var n=(0,d.Z)(r),i=n.feature,a=n.relatedRecordCallbacks;i&&(null===a||void 0===a?void 0:a.addRelatedRecord)&&a.addRelatedRecord({parentFeature:i,relatedLayer:t,relationshipId:e})},r._onFormKeyDown=r._onFormKeyDown.bind((0,d.Z)(r)),r._onFormSubmit=r._onFormSubmit.bind((0,d.Z)(r)),r._onGroupToggle=r._onGroupToggle.bind((0,d.Z)(r)),r._onComponentBlur=r._onComponentBlur.bind((0,d.Z)(r)),r._onComponentFocus=r._onComponentFocus.bind((0,d.Z)(r)),r._onComponentKeyDown=r._onComponentKeyDown.bind((0,d.Z)(r)),r._afterComponentCreate=r._afterComponentCreate.bind((0,d.Z)(r)),r._afterComponentCreateOrUpdate=r._afterComponentCreateOrUpdate.bind((0,d.Z)(r)),r._afterDateComponentCreate=r._afterDateComponentCreate.bind((0,d.Z)(r)),r._afterDateComponentCreateOrUpdate=r._afterDateComponentCreateOrUpdate.bind((0,d.Z)(r)),r._afterRadioGroupCreateOrUpdate=r._afterRadioGroupCreateOrUpdate.bind((0,d.Z)(r)),r}return(0,c.Z)(v,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,g.watch)((function(){return e.feature}),(function(){e._inputsWithChanges.clear(),e._dateComponentMap.clear(),(0,g.whenOnce)((function(){return!e.viewModel.updating})).then((function(){var t=e._getFocusableInput("forward");e._syncGroupInputStates(),e._focusedFieldName=(null===t||void 0===t?void 0:t.name)||null,e._attemptFocusOnNextRender=!0}))})),(0,g.watch)((function(){return e.groupDisplay}),(function(){return e._syncGroupInputStates()})),this.on("submit",(function(t){if(t.invalid.length>0){var n=(0,u.Z)(t.invalid,1)[0];t.invalid.forEach((function(t){return e._inputsWithChanges.add(t)})),e._focusedFieldName=n,e._attemptFocusOnNextRender=!0,e.scheduleRender()}})),(0,g.watch)((function(){return[e.viewModel.activeRelationshipInput,e._listObserverNode]}),(function(){return e._onObserverChange()}))])}},{key:"loadDependencies",value:function(){return(0,T.h)({block:function(){return Promise.all([n.e(92358),n.e(46895),n.e(89219),n.e(63839),n.e(65138),n.e(2654),n.e(23635),n.e(4758)]).then(n.bind(n,4758))},button:function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(14105),n.e(32275)]).then(n.bind(n,32275))},combobox:function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(1579),n.e(34504),n.e(63017),n.e(70419)]).then(n.bind(n,70419))},"combobox-item":function(){return Promise.all([n.e(92358),n.e(15862)]).then(n.bind(n,15862))},"combobox-item-group":function(){return Promise.all([n.e(92358),n.e(85660)]).then(n.bind(n,85660))},icon:function(){return Promise.all([n.e(92358),n.e(87474)]).then(n.bind(n,87474))},input:function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(8715),n.e(16746)]).then(n.bind(n,75655))},"input-date-picker":function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(63839),n.e(96506),n.e(11216)]).then(n.bind(n,11216))},"input-message":function(){return Promise.all([n.e(92358),n.e(64058)]).then(n.bind(n,64058))},"input-number":function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(18135),n.e(77244)]).then(n.bind(n,90460))},"input-time-picker":function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(63839),n.e(65138),n.e(2654),n.e(96506),n.e(39094)]).then(n.bind(n,39094))},"input-time-zone":function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(89219),n.e(1579),n.e(34504),n.e(63017),n.e(96734)]).then(n.bind(n,96734))},label:function(){return Promise.all([n.e(92358),n.e(35738)]).then(n.bind(n,35738))},list:function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(34504),n.e(8715),n.e(38782)]).then(n.bind(n,38782))},"list-item":function(){return Promise.all([n.e(92358),n.e(46895),n.e(65138),n.e(21340)]).then(n.bind(n,67994))},loader:function(){return Promise.all([n.e(92358),n.e(46895),n.e(92382)]).then(n.bind(n,92382))},notice:function(){return Promise.all([n.e(92358),n.e(46895),n.e(15669)]).then(n.bind(n,15669))},"radio-button":function(){return Promise.all([n.e(92358),n.e(54438),n.e(29033)]).then(n.bind(n,29033))},"radio-button-group":function(){return Promise.all([n.e(92358),n.e(4508)]).then(n.bind(n,4508))},switch:function(){return Promise.all([n.e(92358),n.e(54438),n.e(40206)]).then(n.bind(n,40206))},"text-area":function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(36127)]).then(n.bind(n,36127))}})}},{key:"destroy",value:function(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}},{key:"_relatedRecordsEnabled",get:function(){var e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}},{key:"disabled",get:function(){return this.viewModel.disabled},set:function(e){this.viewModel.disabled=e}},{key:"feature",get:function(){return this.viewModel.feature},set:function(e){this.viewModel.feature=e}},{key:"formTemplate",get:function(){return this.viewModel.formTemplate},set:function(e){this.viewModel.formTemplate=e}},{key:"icon",get:function(){return"form-field"},set:function(e){this._overrideIfSome("icon",e)}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"map",get:function(){return this.viewModel.map},set:function(e){this.viewModel.map=e}},{key:"relatedRecordCallbacks",get:function(){return this.viewModel.relatedRecordCallbacks},set:function(e){this.viewModel.relatedRecordCallbacks=e}},{key:"relationshipId",get:function(){return this.viewModel.relationshipId},set:function(e){this.viewModel.relationshipId=e}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(e){this.viewModel.spatialReference=e}},{key:"strict",get:function(){return this.viewModel.strict},set:function(e){this.viewModel.strict=e}},{key:"timeZone",get:function(){return this.viewModel.timeZone},set:function(e){this.viewModel.timeZone=e}},{key:"showPrompt",get:function(){var e=this;return function(t){var n,r;null!==(n=e._prompt)&&void 0!==n&&null!==(r=n.cancel)&&void 0!==r&&r.call(n),e._prompt=t}},set:function(e){this._overrideIfSome("showPrompt",e)}},{key:"clearPrompt",get:function(){var e=this;return function(){return e._prompt=null}},set:function(e){this._overrideIfSome("clearPrompt",e)}},{key:"getValues",value:function(){return this.viewModel.getValues()}},{key:"submit",value:function(){return this.viewModel.submit()}},{key:"render",value:function(){var e=this.viewModel.state;return(0,D.u)("div",{class:this.classes(I.base,O.z.widget,O.z.panel)},"ready"===e?this._renderForm():null)}},{key:"_renderForm",value:function(){return(0,D.u)("div",null,(0,D.u)("form",{class:I.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent()),this._prompt?(0,D.u)(x.NL,(0,l.Z)((0,l.Z)({},this._prompt),{},{headingLevel:this.headingLevel})):void 0)}},{key:"_renderHeader",value:function(){var e=this.viewModel;if(e.formHeaderVisible){var t=null!=e.formTitle&&(0,D.u)(M.X,{key:"title",level:this.headingLevel},e.formTitle),n=null!=e.formDescription&&(0,D.u)("p",{class:I.description,key:"description"},e.formDescription);return(0,D.u)("div",{class:I.formHeader},t,n)}}},{key:"_renderContent",value:function(){var e=this,t=this.viewModel;return t.activeRelationshipInput?this._renderRelationshipInput(t.activeRelationshipInput):t.inputs.filter(h.pC).filter((function(e){return e.visible})).map((function(t){return e._renderInput(t)}))}},{key:"_renderInput",value:function(e){return(0,E.ib)(e)?this._renderGroup(e):(0,E.Vs)(e)?this._renderLabeledField(e):(0,E.V7)(e)?this._renderRelationshipInput(e):(0,E.Wh)(e)?this._renderTextElementInput(e):void 0}},{key:"_renderDescriptionOrEmpty",value:function(e,t){return null==e?null:(0,D.u)("div",{class:this.classes(I.description),id:t},e)}},{key:"_renderGroup",value:function(e){var t=this,n=this.disabled,r=this.formTemplate,i=this.headingLevel,a=e.description,o=e.id,l=e.inputs,u=e.label,s=e.open,c=l.filter((function(e){return e.visible})),d=this.viewModel.findField(this._focusedFieldName),p=(null===d||void 0===d?void 0:d.group)===e,f="sequential"===this.groupDisplay;return(0,D.u)("calcite-block",{class:this.classes(I.group,f?I.groupSequential:null,p?I.groupActive:null,n?I.inputDisabled:null),collapsible:!0,"data-group":e,description:a||void 0,disabled:n,heading:"".concat(u),headingLevel:null!==r&&void 0!==r&&r.title?(0,M.M)(i):i,id:o,key:o,open:s,onCalciteBlockToggle:function(n){var r=n.target;return t._onGroupToggle(r,e)}},c.map((function(e){return t._renderInput(e)})))}},{key:"_getFocusableInput",value:function(e,t){var n,r=(0,E.Li)(this.viewModel.inputs);if("backward"===e&&r.reverse(),t)if((0,E.ib)(t)){var i=t.inputs.find((function(e){return e.visible}));n=i?r.indexOf(i):0}else{var a;if((0,E._n)(t)&&!t.group.open){var o=t.group.inputs.filter(E.Vs);a="forward"===e?o[o.length-1]:o[0]}else a=t;n=r.indexOf(a)+1}else n=0;for(var l=n;l<r.length;l++){var u=r[l];if(u.visible&&(0,E.Vs)(u))return u}return null}},{key:"_renderLabeledField",value:function(e){var t,n=e.dataType,r=e.feature,i=e.label,a=e.layer,o=e.required,u={"aria-label":o?(0,j.n)(this.messages.requiredFieldLabel,{name:i}):i,class:I.label,key:"".concat(a.id,"-").concat(r.uid,"-").concat(e.name)},s=[(0,D.u)("div",{class:I.labelTextContent,key:"labelTextContainer"},i,o?(0,D.u)("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==n?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return"date"===n&&"coded-value"!==(null===(t=e.domain)||void 0===t?void 0:t.type)?(0,D.u)("label",(0,l.Z)({},u),s):(0,D.u)("calcite-label",(0,l.Z)({},u),s)}},{key:"_renderFieldInput",value:function(e){var t=e.dataType,n=e.domain,r=e.inputType,i=e.name,a=this.getCommonInputProps(e);if("coded-value"===(null===n||void 0===n?void 0:n.type)){var o=this.viewModel.getFieldValueOptionsForField(i,this.messages.empty);return"switch"!==r||e.hasInvalidSwitchValue?"radio-buttons"===r?this._renderRadioButtonComponents(e,o.flat(),a):this._renderComboBoxComponent(e,o,a):this._renderSwitchComponent(e,a)}return"datetime-picker"===r||"date"===t?this._renderDateComponents(e,a):"number"===t?this._renderNumberComponent(e,a):this._renderStringComponent(e,a)}},{key:"_renderStringComponent",value:function(e,t){var n=this;return"text-area"===e.inputType?t.readOnly?(0,D.u)("calcite-input",(0,l.Z)((0,l.Z)({},t),{},{loading:e.updating,type:"textarea",onCalciteInputInput:function(e){return n._saveValueFromComponent(e.target)}})):(0,D.u)("calcite-text-area",(0,l.Z)((0,l.Z)({},t),{},{resize:"vertical",onCalciteTextAreaInput:function(e){return n._saveValueFromComponent(e.target)}})):(0,D.u)("calcite-input",(0,l.Z)((0,l.Z)({},t),{},{loading:e.updating,type:"text",onCalciteInputInput:function(e){return n._saveValueFromComponent(e.target)}}))}},{key:"_renderNumberComponent",value:function(e,t){var n=this;return(0,D.u)("calcite-input-number",(0,l.Z)((0,l.Z)({},t),{},{integer:(0,C.Vo)(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:function(e){return n._saveValueFromComponent(e.target)}}))}},{key:"_renderDateComponents",value:function(e,t){var n=e.field;switch(n.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,(0,S.sx)(n,t.value,(0,l.Z)({timeZone:this.timeZone},(0,S.fu)(n))))}}},{key:"_renderDateOnlyFieldComponent",value:function(e,t){var n=this,r=e.range,i=e.valid,a=e.value,o=t.class,l=t.key,u=t.readOnly,s=r.rawMax,c=r.rawMin;return(0,D.u)("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:o,"data-date-part":"date","data-field-name":t[P],key:"".concat(l,"-date-input"),max:(0,A.H)(s)?s:void 0,min:(0,A.H)(c)?c:void 0,numberingSystem:S.T2,onblur:function(e){n._focusedFieldName=null,n._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:u,value:null!=a?"".concat(a):void 0,onCalciteInputDatePickerChange:function(e){return n._saveValueFromDateComponent(e.target)}})}},{key:"_renderTimeOnlyFieldComponent",value:function(e,t){var n=this,r=e.valid,i=e.value,a=t.class,o=t.key,l=t.readOnly;return(0,D.u)("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!r,class:a,"data-date-part":"time","data-field-name":t[P],key:"".concat(o,"-time-input"),numberingSystem:S.T2,onblur:function(e){n._focusedFieldName=null,n._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:l,step:e.timeStep,value:null!=i?"".concat(i):void 0,onCalciteInputTimePickerChange:function(e){return n._saveValueFromDateComponent(e.target)}})}},{key:"_renderTimestampOffsetFieldComponents",value:function(e,t){var n,r,i,a,u,s,c=this,d=e.name,p=e.range,f=e.timeZone,v=e.valid,h=e.value,y=t.class,m=t.key,g=t.readOnly,b=p.rawMax,_=p.rawMin,C=(n={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!v,numberingSystem:S.T2,overlayPositioning:"fixed",readOnly:g},(0,o.Z)(n,P,d),(0,o.Z)(n,"onfocus",this._onComponentFocus),n),k=(0,S.HB)(b,f),x=(0,S.HB)(_,f),Z=(0,S.HB)(h,f);return(0,D.u)("div",{class:I.dateInputContainer,key:"".concat(m,"-date-time-container")},(0,D.u)("calcite-input-date-picker",(0,l.Z)((0,l.Z)({},C),{},{class:y,"data-date-part":"date",key:"".concat(m,"-date-input"),max:null!==(r=null===k||void 0===k?void 0:k.date)&&void 0!==r?r:void 0,min:null!==(i=null===x||void 0===x?void 0:x.date)&&void 0!==i?i:void 0,onblur:function(e){c._focusedFieldName=null,c._saveValueFromDateComponent(e.target)},value:null!==(a=Z.date)&&void 0!==a?a:void 0,onCalciteInputDatePickerChange:function(e){return c._saveValueFromDateComponent(e.target)}})),(0,D.u)("calcite-input-time-picker",(0,l.Z)((0,l.Z)({},C),{},{class:y,"data-date-part":"time",key:"".concat(m,"-time-input"),onblur:function(e){c._focusedFieldName=null,c._saveValueFromDateComponent(e.target)},step:e.timeStep,value:null!==(u=Z.time)&&void 0!==u?u:void 0,onCalciteInputTimePickerChange:function(e){return c._saveValueFromDateComponent(e.target)}})),e.includeTimeOffset?(0,D.u)("calcite-input-time-zone",(0,l.Z)((0,l.Z)({},C),{},{class:y,"data-date-part":"timeZone",disabled:g,key:"".concat(m,"-timezone-input"),onblur:function(e){c._focusedFieldName=null,c._saveValueFromDateComponent(e.target)},value:null!==(s=Z.timeZoneOffset)&&void 0!==s?s:"0",onCalciteInputTimeZoneChange:function(e){return c._saveValueFromDateComponent(e.target)}})):null)}},{key:"_renderDateFieldComponents",value:function(e,t){var n,r,i,a,u,s=this,c=e.includeTime,d=e.name,p=e.valid,f=e.value,v=t.class,h=t.key,y=t.max,m=t.min,g=t.readOnly,b=this.timeZone,_=(n={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!p,numberingSystem:S.T2,overlayPositioning:"fixed",readOnly:g},(0,o.Z)(n,P,d),(0,o.Z)(n,"onfocus",this._onComponentFocus),n),C=(0,S.w5)(f,b),k=(0,S.w5)(y,b),x=(0,S.w5)(m,b);return(0,D.u)("div",{class:I.dateInputContainer,key:"".concat(h,"-date-time-container")},(0,D.u)("calcite-input-date-picker",(0,l.Z)((0,l.Z)({},_),{},{class:v,"data-date-part":"date",key:"".concat(h,"-date-input"),max:null!==(r=null===k||void 0===k?void 0:k.date)&&void 0!==r?r:void 0,min:null!==(i=null===x||void 0===x?void 0:x.date)&&void 0!==i?i:void 0,onblur:function(e){s._focusedFieldName=null,s._saveValueFromDateComponent(e.target)},value:null!==(a=C.date)&&void 0!==a?a:void 0,onCalciteInputDatePickerChange:function(e){return s._saveValueFromDateComponent(e.target)}})),c?(0,D.u)("calcite-input-time-picker",(0,l.Z)((0,l.Z)({},_),{},{class:v,"data-date-part":"time",key:"".concat(h,"-time-input"),onblur:function(e){s._focusedFieldName=null,s._saveValueFromDateComponent(e.target)},step:1,value:null!==(u=C.time)&&void 0!==u?u:void 0,onCalciteInputTimePickerChange:function(e){return s._saveValueFromDateComponent(e.target)}})):null)}},{key:"_renderReadOnlyComponent",value:function(e,t){var n=this.getCommonInputProps(e);return(0,D.u)("calcite-input",(0,l.Z)((0,l.Z)({},n),{},{class:this.classes(I.fieldInput,I.inputDisabled),readOnly:!0,type:"text",value:null!=t?"".concat(t):n.value}))}},{key:"_renderComboBoxComponent",value:function(e,t,n){var r=this,i=e.value,a=e.name,o=this.viewModel,u=this._inputsWithChanges,s="INSERT"===o.arcadeEditType,c=u.has(a),d=null==i&&(!s||c),p=s&&e.showNoValueOptionEnabled&&!c?function(){}:n.onblur;return(0,D.u)("calcite-combobox",(0,l.Z)((0,l.Z)({},n),{},{allowCustomValues:!1,clearDisabled:!0,disabled:n.readOnly,onblur:p,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:function(t){var n=t.target;d&&0===n.selectedItems.length?r._ignoreDeselectionOfNoValueOption(n):e.isSubtypeField&&0===n.selectedItems.length?n.value="".concat(e.value):r._saveValueFromComponent(n)}}),this.renderComboboxOptionsList(e,t))}},{key:"renderComboboxOptionsList",value:function(e,t){var n=e.value,r=e.name,i=this.messages,o=this.messagesTemplates,l=this.viewModel,s=this._inputsWithChanges,c=t.map((function(e){return e.map((function(e){var t=e.name,r=e.value;return(0,D.u)("calcite-combobox-item",{key:"#".concat(r),selected:n===r,textLabel:t,value:"".concat(r)})}))})),d=(0,u.Z)(c,3),p=d[0],f=d[1],v=d[2],h=[];f.length>0&&h.push((0,D.u)("calcite-combobox-item-group",{key:"other",label:o.other},f)),v.length>0&&h.push((0,D.u)("calcite-combobox-item-group",{key:"unsupported",label:i.subtypes.unsupportedDomainGroupTitle},v)),h.length>0?h.unshift((0,D.u)("calcite-combobox-item-group",{key:"recommended",label:i.recommended},p)):h.push.apply(h,(0,a.Z)(p));var y="INSERT"===l.arcadeEditType,m=s.has(r),g=null==n&&(!y||m);return e.showNoValueOptionEnabled&&h.unshift((0,D.u)("calcite-combobox-item",{key:"empty-option",selected:g,textLabel:e.showNoValueLabel||i.empty,value:""})),h}},{key:"_renderRadioButtonComponents",value:function(e,t,n){var r=this,i=e.name,a=e.value,o=t.map((function(e){var t=e.name,o=e.value;return r._renderRadioButtonComponent({key:t,label:t,name:i,value:o,selected:o===a,props:n})}));if(e.showNoValueOptionEnabled){var l=e.showNoValueLabel||this.messages.empty,u=""===a||null===a;o.unshift(this._renderRadioButtonComponent({key:"empty-option",label:l,name:i,value:"",selected:u,props:n}))}return(0,D.u)("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:I.inputRadioGroup,"data-field-name":n[P],key:"".concat(n.key,"-radio-group"),layout:"vertical",name:n.key,required:n.required},o)}},{key:"_renderSwitchComponent",value:function(e,t){var n=this,r=e.value,i=!!(0,E.I6)(e.element,"switch")&&r===e.element.input.onValue;return(0,D.u)("calcite-switch",(0,l.Z)((0,l.Z)({},t),{},{checked:i,class:I.inputSwitch,disabled:t.readOnly,onblur:function(){n._focusedFieldName=null},onCalciteSwitchChange:function(e){return n._saveValueFromComponent(e.target)}}))}},{key:"_renderRadioButtonComponent",value:function(e){var t=this,n=e.key,r=e.name,i=e.value,a=e.selected,o=e.label,u=e.props;return(0,D.u)("calcite-label",{class:I.inputRadioLabel,key:n,layout:"inline"},(0,D.u)("calcite-radio-button",(0,l.Z)((0,l.Z)({},u),{},{afterCreate:void 0,afterUpdate:void 0,checked:a,class:I.inputRadio,disabled:u.readOnly,name:r,onblur:function(){t._focusedFieldName=null},value:i,onCalciteRadioButtonChange:function(e){var n=e.target;n.checked&&t._saveValueFromComponent(n)}})),o)}},{key:"_renderAuxiliaryText",value:function(e){var t=e.name,n=this._inputsWithChanges.has(t)&&!e.valid?(0,E.Je)(e,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(t)?this.messages.validationErrors.valuesIncompatible:null!=e.valueExpressionExecutor&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=n?(0,D.u)("calcite-input-message",{icon:!0,status:"invalid"},n):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?(0,D.u)("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}},{key:"_renderShowAllRelatedRecordsListItem",value:function(e){var t=this,n=e.featureCount,r=e.relationshipId,i=e.showAllActionVisible,a=this.relatedRecordCallbacks;if(i&&null!==a&&void 0!==a&&a.showAllRelatedRecords){var o=this.messages;return(0,D.u)("calcite-list-item",{description:(0,j.n)(o.totalCount,{count:n}),label:o.showAll,value:!0,onCalciteListItemSelect:function(){return t._onShowAllRelatedRecordsClick(r)}},(0,D.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}}},{key:"_renderAddRelatedRecordButton",value:function(e){var t=this,n=e.canAddRelatedFeature,r=e.relationshipId,i=e.relatedLayer,a=this.messages,o=this.relatedRecordCallbacks;if(n&&null!==o&&void 0!==o&&o.addRelatedRecord&&i)return(0,D.u)("calcite-button",{alignment:"center",appearance:"outline-fill",class:I.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:"".concat(r,"-add-button"),onclick:function(){!e.updating&&e.originHasValidKey&&t._onAddRelatedRecordsClick(r,i)},round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?a.addRecord:a.addFeature)}},{key:"_renderRelatedRecordListItem",value:function(e,t){var n=e.feature,r=e.description,i=e.title,a=this.feature,o=this.relatedRecordCallbacks,l=this.viewModel.highlightHelper,u=l?function(){return l.add(n)}:void 0,s=l?function(){return l.remove(n)}:void 0;return(0,D.u)("calcite-list-item",{bind:this,description:r,key:"".concat(t,"-").concat(n.uid),label:i,onclick:function(){null!==l&&void 0!==l&&l.removeAll(),(null===o||void 0===o?void 0:o.editRelatedRecord)&&a&&o.editRelatedRecord({parentFeature:a,relationshipId:t,relatedFeature:n})},onmouseenter:u,onmouseleave:s,value:i},(0,D.u)("calcite-icon",{icon:(0,E.MP)(n),slot:"content-start"}),(0,D.u)("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}},{key:"_renderRelationshipInput",value:function(e){if(this._relatedRecordsEnabled&&e.editable){var t=e.featureCount,n=e.relationshipId,r=e.showAllEnabled?null:this._renderDescriptionOrEmpty(e.description),i=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return(0,D.u)("calcite-label",{class:this.classes(I.label,I.relatedRecordsLabel),key:"relationship-".concat(n,"-container")},(0,D.u)("div",null,this._renderRelatedRecordsHeaderContainer(e),r,i),this._renderAddRelatedRecordButton(e))}}},{key:"_renderRelatedRecordsHeaderContainer",value:function(e){var t,n=e.updating||!e.loaded;return(0,D.u)("div",{class:I.relatedRecordsHeader,key:"relationship-".concat(e.relationshipId,"-header")},(0,D.u)("span",null,e.label),n?(0,D.u)("calcite-loader",{inline:!0,key:"loader",label:null===(t=this.messagesCommon)||void 0===t?void 0:t.loading,scale:"s",type:"indeterminate"}):void 0)}},{key:"_renderRelatedRecordsList",value:function(e){var t=this,n=e.relationshipId;return(0,D.u)("calcite-list",{class:I.relatedRecordsList},e.relatedFeatureInfos.map((function(e){return t._renderRelatedRecordListItem(e,n)})),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}},{key:"_renderNoValidOriginKeyNotice",value:function(e){var t,n,r,i=this.messages,a=e.relatedLayerIsTable?i.noOriginKeyRecord:i.noOriginKeyFeature,o=null===(t=e.relationship)||void 0===t?void 0:t.keyField,l=this.viewModel.findField(o),u=null===(n=e.layer)||void 0===n?void 0:n.fieldsIndex.get(o),s=(null===l||void 0===l?void 0:l.label)||(null===u||void 0===u?void 0:u.alias)||o,c=(0,j.n)(a,{relatedLayerName:null===(r=e.relatedLayer)||void 0===r?void 0:r.title,originKeyField:s});return(0,D.u)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,D.u)("div",{slot:"message"},c))}},{key:"_renderNoRelatedRecordsNotice",value:function(){return(0,D.u)("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},(0,D.u)("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}},{key:"_renderObserverNode",value:function(){var e;if(null!==(e=this.viewModel.activeRelationshipInput)&&void 0!==e&&e.showAllEnabled)return(0,D.u)("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:I.listObserver,key:"feature-observer"})}},{key:"_renderTextElementInput",value:function(e){return(0,D.u)("div",{class:I.textElement,innerHTML:e.text,key:e.id})}},{key:"getCommonInputProps",value:function(e){var t=this.disabled,n=e.editable,r=e.hint,i=e.label,a=e.maxLength,l=e.minLength,u=e.name,s=e.range,c=s.max,d=s.min,p=e.required,f=e.valid,v=e.value,h=this._inputsWithChanges.has(u),y=!n||t;return(0,o.Z)({afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":f?"false":"true",class:this.classes(I.fieldInput,y?I.inputDisabled:null),status:h&&!f?"invalid":"idle",key:u,label:i,max:null!=c?c:void 0,min:null!=d?d:void 0,maxLength:a>-1?a:void 0,minLength:l>-1?l:void 0,placeholder:null!==r&&void 0!==r?r:void 0,readOnly:y,required:p,value:null==v?"":"".concat(v),onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown},P,u)}},{key:"_getFieldInputFromHTMLElement",value:function(e){return this.viewModel.findField(e.getAttribute(P))}},{key:"_afterDateComponentCreate",value:function(e){var t=this,n=this._getFieldInputFromHTMLElement(e),r=e.dataset.datePart,i=this._dateComponentMap.get(n.name);if("valueAsDate"in e&&null!=e.value){var a=new ResizeObserver((function(){var r,i;switch(e.value=void 0,n.field.type){case"date":e.value=null!==(r=(0,S.w5)(n.value,t.timeZone).date)&&void 0!==r?r:"";break;case"timestamp-offset":e.value=null!==(i=(0,S.HB)(n.value,t.timeZone).date)&&void 0!==i?i:"";break;default:e.value="".concat(n.value)}a.unobserve(e)}));a.observe(e)}if(null!=i)switch(r){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}else this._dateComponentMap.set(n.name,(0,o.Z)({},r,e));this._afterDateComponentCreateOrUpdate(e)}},{key:"_afterDateComponentCreateOrUpdate",value:function(e){this._afterComponentCreateOrUpdate(e)}},{key:"_afterComponentCreate",value:function(e){var t=this._getFieldInputFromHTMLElement(e);(0,E.ll)(t)&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}},{key:"_afterRadioGroupCreateOrUpdate",value:function(e){var t=e.selectedItem,n=e.querySelector("calcite-radio-button"),r=t||n;r&&this._afterComponentCreateOrUpdate(r)}},{key:"_afterComponentCreateOrUpdate",value:function(e){var t=this.viewModel,n=this._getFieldInputFromHTMLElement(e),r=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&r===n&&(this._attemptFocusOnNextRender=!1,(0,E._n)(n)&&(n.group.open=!0),e.setFocus())}},{key:"_onComponentFocus",value:function(e){var t=e.target,n=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=n.name}},{key:"_onComponentBlur",value:function(e){var t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}},{key:"_saveValueFromDateComponent",value:function(e){var t=this.timeZone,n=this._getFieldInputFromHTMLElement(e),r=n.field.type,i=n.name,a=n.range,o=this._dateComponentMap.get(i);if(o){var l=this.viewModel.getValue(i),u=null;"date-only"===r?u=Array.isArray(e.value)?e.value[0]:e.value:"time-only"===r?(l=(0,S.J2)(l),u=(0,S.J2)(e.value)):u="timestamp-offset"===r?null!=e.value?(0,S._t)({dateComponent:o.date,timeComponent:o.time,timeZoneComponent:o.timeZone,oldValue:l,defaultTimeZone:t}):null:null!=e.value?(0,S.Hs)({oldValue:l,dateComponent:o.date,timeComponent:o.time,timeZone:t,max:a.max,min:a.min}):null,null!==u&&e.value?l!==u&&this._updateFieldValue(i,u):this._updateFieldValue(i,null)}}},{key:"_saveValueFromComponent",value:function(e){var t=this._getFieldInputFromHTMLElement(e),n=this._parseValue(e),r=t.value;t.isSubtypeField&&(0,E.Pk)(this.layer,r,n)?this._pendingSubtypeChoice||n===r||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,n)):this._updateFieldValue(t.name,n)}},{key:"_handleSubtypeChoice",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n){var i,a,o,l,u,s,c,d,p,f,v,h,y,g,b;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t.value,u=t.name,s=this.layer,c=this.messages,d=this.viewModel,p=this.messagesCommon,this._updateFieldValue(u,n),s&&"subtypes"in s&&null!==(i=s.subtypes)&&void 0!==i&&i.length){e.next=3;break}return e.abrupt("return");case 3:if(f=s.subtypes.find((function(e){return e.code===n})),v=null!==(a=null===(o=s.subtypes.find((function(e){return e.code===l})))||void 0===o?void 0:o.name)&&void 0!==a?a:"".concat(l),f){e.next=6;break}return e.abrupt("return");case 6:return d.hasPendingSubtypeChoice=!0,h=(0,m.hh)(),y="update-fields",g=[{label:c.subtypes.useDefaultValuesOption,value:"update-fields"},{label:c.subtypes.keepCurrentValuesOption,value:"keep-existing"}],b={context:"info",title:c.subtypes.changeWarningTitle,message:(0,j.n)(c.subtypes.changeWarning,{originalType:v,newType:f.name}),radios:g,defaultRadioSelection:"update-fields",onRadioSelection:function(e){return y=e},actions:{primary:{label:p.apply,action:function(){return h.resolve(y)},type:"positive"},secondary:{label:p.cancel,type:"neutral",action:function(){return h.resolve("undo")}}},cancel:function(){return h.reject()}},e.prev=10,this.showPrompt(b),e.next=14,h.promise;case 14:e.t0=e.sent,e.next="update-fields"===e.t0?17:"keep-existing"===e.t0?19:"undo"===e.t0?21:22;break;case 17:return d.applySubtypeDefaults(f),this._validateContingenciesForNonNullFields(),e.abrupt("break",22);case 19:return this._validateContingenciesForNonNullFields(),e.abrupt("break",22);case 21:this._updateFieldValue(t.name,l);case 22:return e.prev=22,d.hasPendingSubtypeChoice=!1,this.clearPrompt(),this._pendingSubtypeChoice=null,e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[10,,22,25]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_onComponentKeyDown",value:function(e){var t=e.key,n=e.target,r=this._getFieldInputFromHTMLElement(n);"Enter"===t&&(0,E._n)(r)&&!r.group.open&&(r.group.open=!0)}},{key:"_updateFieldValue",value:function(e,t){var n=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),n!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}},{key:"_validateContingenciesForNonNullFields",value:function(){var e=Object.fromEntries(Object.entries(this.getValues()).filter((function(e){var t=(0,u.Z)(e,2);t[0];return null!=t[1]})));this.viewModel.validateContingencyConstraints(e)}},{key:"_parseValue",value:function(e){var t=this._getFieldInputFromHTMLElement(e),n=e.value;return(0,E.I6)(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:null==n||""===n?null:"number"===t.dataType?"-0"===n||"-0."===n||"-0,"===n?n:parseFloat(n):"date"===t.field.type?parseFloat(n):n}},{key:"_ignoreDeselectionOfNoValueOption",value:function(e){var t=e.firstChild;0===e.selectedItems.length&&t&&"selected"in t?t.selected=!0:y.Z.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}},{key:"_onGroupToggle",value:function(e,t){var n;e.open?(t.open=!0,this._focusedFieldName=(null===(n=this._getFocusableInput("forward",t))||void 0===n?void 0:n.name)||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach((function(e){e!==t&&(e.open=!1)}))):t.open=!1,this.scheduleRender()}},{key:"_onFormSubmit",value:function(e){e.preventDefault()}},{key:"_onFormKeyDown",value:function(e){"Enter"===e.key&&this.viewModel.submit()}},{key:"_afterListObserverCreated",value:function(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}},{key:"_afterListObserverRemoved",value:function(){this._listObserverNode=null}},{key:"_onObserverChange",value:function(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);var e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}},{key:"_incrementRelatedRecordPage",value:function(){var e=this.viewModel.activeRelationshipInput;null===e||void 0===e||e.incrementPage()}},{key:"_syncGroupInputStates",value:function(){if("sequential"===this.groupDisplay){var e=this.viewModel.allGroupInputs;if(e.length){var t=e.filter((function(e){return e.open}));0===t.length?e[0].open=!0:t.length>1&&t.slice(1).forEach((function(e){return e.open=!1}))}}}},{key:"test",get:function(){return{inputsWithChanges:this._inputsWithChanges}}}]),v}(k.Z);(0,v._)([(0,b.Cb)()],H.prototype,"_listObserverNode",void 0),(0,v._)([(0,b.Cb)()],H.prototype,"_relatedRecordsEnabled",null),(0,v._)([(0,b.Cb)()],H.prototype,"_prompt",void 0),(0,v._)([(0,b.Cb)()],H.prototype,"disabled",null),(0,v._)([(0,b.Cb)()],H.prototype,"feature",null),(0,v._)([(0,b.Cb)()],H.prototype,"formTemplate",null),(0,v._)([(0,b.Cb)()],H.prototype,"groupDisplay",void 0),(0,v._)([(0,b.Cb)()],H.prototype,"headingLevel",void 0),(0,v._)([(0,b.Cb)()],H.prototype,"icon",null),(0,v._)([(0,b.Cb)()],H.prototype,"label",null),(0,v._)([(0,b.Cb)()],H.prototype,"layer",null),(0,v._)([(0,b.Cb)()],H.prototype,"map",null),(0,v._)([(0,b.Cb)(),(0,L.H)("esri/widgets/FeatureForm/t9n/FeatureForm")],H.prototype,"messages",void 0),(0,v._)([(0,b.Cb)(),(0,L.H)("esri/t9n/common")],H.prototype,"messagesCommon",void 0),(0,v._)([(0,b.Cb)(),(0,L.H)("esri/widgets/Feature/t9n/Feature")],H.prototype,"messagesFeature",void 0),(0,v._)([(0,b.Cb)(),(0,L.H)("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],H.prototype,"messagesTemplates",void 0),(0,v._)([(0,b.Cb)()],H.prototype,"relatedRecordCallbacks",null),(0,v._)([(0,b.Cb)()],H.prototype,"relationshipId",null),(0,v._)([(0,b.Cb)()],H.prototype,"spatialReference",null),(0,v._)([(0,b.Cb)()],H.prototype,"strict",null),(0,v._)([(0,b.Cb)()],H.prototype,"timeZone",null),(0,v._)([(0,b.Cb)()],H.prototype,"showPrompt",null),(0,v._)([(0,b.Cb)()],H.prototype,"clearPrompt",null),(0,v._)([(0,b.Cb)(),(0,N.s)(["value-change","submit"])],H.prototype,"viewModel",void 0),(0,v._)([(0,b.Cb)()],H.prototype,"test",null);var G=H=(0,v._)([(0,_.j)("esri.widgets.FeatureForm")],H)},16458:function(e,t,n){n.d(t,{Z:function(){return Ye}});var r=n(93433),i=n(37762),a=n(1413),o=n(74165),l=n(29439),u=n(15861),s=n(15671),c=n(43144),d=n(60136),p=n(29388),f=n(27366),v=n(52639),h=n(41644),y=n(91505),m=n(32718),g=n(92026),b=n(67426),_=n(94172),C=n(643),k=n(49861),x=(n(84936),n(69912)),Z=n(46634),w=n(40934),F=n(73813),V=n(7138),I=(n(93169),function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).maxValue=null,r.minValue=null,r.codedValue=null,r}return(0,c.Z)(n)}(V.default));(0,f._)([(0,k.Cb)()],I.prototype,"objectType",void 0),(0,f._)([(0,k.Cb)()],I.prototype,"maxValue",void 0),(0,f._)([(0,k.Cb)()],I.prototype,"minValue",void 0),(0,f._)([(0,k.Cb)()],I.prototype,"codedValue",void 0);var E=I=(0,f._)([(0,x.j)("esri.layers.support.ContingentValue")],I),R=n(69767),T=n(76200),A=n(63780),S=n(46784),O=n(54472),M=n(25899),L=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).isRetired=!1,r}return(0,c.Z)(n)}(V.default);(0,f._)([(0,k.Cb)()],L.prototype,"id",void 0),(0,f._)([(0,k.Cb)()],L.prototype,"isRetired",void 0),(0,f._)([(0,k.Cb)()],L.prototype,"subtype",void 0),(0,f._)([(0,k.Cb)()],L.prototype,"values",void 0);var N=L=(0,f._)([(0,x.j)("esri.layers.support.Contingency")],L),D=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,s.Z)(this,n),t.call(this,e)}return(0,c.Z)(n)}(V.default);(0,f._)([(0,k.Cb)()],D.prototype,"fieldGroup",void 0),(0,f._)([(0,k.Cb)()],D.prototype,"type",void 0);var j=D=(0,f._)([(0,x.j)("esri.layers.support.ContingencyConstraintViolation")],D),P=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,s.Z)(this,n),t.call(this,e)}return(0,c.Z)(n)}(V.default);(0,f._)([(0,k.Cb)()],P.prototype,"contingentValuesAllGroups",void 0),(0,f._)([(0,k.Cb)()],P.prototype,"contingentValuesByFieldGroup",void 0);var H=P=(0,f._)([(0,x.j)("esri.layers.support.ContingentValuesResult")],P),G=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).fields=null,r.isEditingRestrictive=!1,r}return(0,c.Z)(n)}(V.default);(0,f._)([(0,k.Cb)()],G.prototype,"name",void 0),(0,f._)([(0,k.Cb)()],G.prototype,"fields",void 0),(0,f._)([(0,k.Cb)()],G.prototype,"isEditingRestrictive",void 0),(0,f._)([(0,k.Cb)()],G.prototype,"contingencies",void 0);var U,B=G=(0,f._)([(0,x.j)("esri.layers.support.FieldGroup")],G),z=n(37270),W=n(93882),q=n(73238),$=U=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).request=T.Z,r.fieldGroups=null,r.fieldGroupDefinitions=null,r}return(0,c.Z)(n,[{key:"initialize",value:function(){}},{key:"subtypeFieldName",get:function(){return(0,q.ZP)(this.layer).typeFieldName}},{key:"load",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t){var n,r=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.layer.load(t).then((function(){return r._initializeContingentValues(r.fieldGroupDefinitions,t)})),e.abrupt("return",(this.addResolvingPromise(n),this));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"validateContingencyConstraints",value:function(e,t){var n,r=this,a=Object.keys(e),o=[],l=[],u=(0,i.Z)(this.fieldGroups);try{var s=function(){var u=n.value,s=u.isEditingRestrictive?"error":"warning";if(t&&!u.fields.some((function(e){return t.includes(e)})))return"continue";if(!u.fields.every((function(e){return a.includes(e)})))return l.push(new j({fieldGroup:u,type:s})),"continue";var c=!1,d=e[r.subtypeFieldName],p=u.contingencies.filter((function(e){return!(!e.isRetired&&e.subtype)||e.subtype.code===d}));if(0!==p.length){var f,v=(0,i.Z)(p);try{for(v.s();!(f=v.n()).done;){var h=f.value,y=!0;for(var m in h.values){var g=h.values[m];if("any"!==g.objectType)if("null"===g.objectType){if(null!=e[m]){y=!1;break}}else if("code"===g.objectType){if(e[m]!==g.codedValue.code){y=!1;break}}else if("range"===g.objectType){var b=e[m];if(b<g.minValue||b>g.maxValue){y=!1;break}}}if(y){c=!0;break}}}catch(_){v.e(_)}finally{v.f()}c||o.push(new j({fieldGroup:u,type:s}))}};for(u.s();!(n=u.n()).done;)s()}catch(c){u.e(c)}finally{u.f()}return{invalid:o,incomplete:l}}},{key:"getContingentValues",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e[this.subtypeFieldName],a=null!=r,o={},l=[],u=this.fieldGroups.filter((function(e){return e.fields.includes(t)}));l.push(new E({objectType:"any"}));var s,c=(0,i.Z)(u);try{for(c.s();!(s=c.n()).done;){var d,p=s.value,f=[],v=p.contingencies.filter((function(e){return!(e.isRetired||e.subtype&&a&&e.subtype.code!==r)})),h=!1,y={},m=(0,i.Z)(v);try{for(m.s();!(d=m.n()).done;){var g=d.value,b=void 0,_=!0;for(var C in g.values){var k=g.values[C];if(t!==C){if(void 0!==e[C]&&"any"!==k.objectType)if("null"===k.objectType)null!==e[C]&&(_=!1);else if("code"===k.objectType)e[C]!==k.codedValue.code&&(_=!1);else if("range"===k.objectType){var x=e[C];(x<k.minValue||x>k.maxValue)&&(_=!1)}}else b=k,h=h||"range"===k.objectType}if(b&&_){if("any"===b.objectType){f.length=0,f.push(b);break}var Z=J(b);y[Z]||f.push(b),y[Z]=!0}}}catch(w){m.e(w)}finally{m.f()}h&&(f=K(f)),o[p.name]=f,l=n?Q(l,f):[]}}catch(w){c.e(w)}finally{c.f()}return 1===u.length&&n&&(l=[]),new H({contingentValuesAllGroups:l,contingentValuesByFieldGroup:o})}},{key:"_initializeContingentValues",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t,n){var r,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===t||void 0===t){e.next=4;break}e.t0=t,e.next=7;break;case 4:return e.next=6,this._fetchFieldGroupDefs(n);case 6:e.t0=e.sent;case 7:if(0!==(r=e.t0).length){e.next=10;break}return e.abrupt("return",void(this.fieldGroups=[]));case 10:return e.next=12,this._fetchContingentValues(r,n);case 12:i=e.sent,this.fieldGroups=i;case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_fetchFieldGroupDefs",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t){var n,r,i,a=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.layer.layerId){e.next=2;break}return e.abrupt("return",[]);case 2:if(n=this.layer.sourceJSON,r=this.layer.layerId.toString(),i=(0,M.Qc)(this.layer.url).url.path,!n.hasContingentValuesDefinition){e.next=7;break}return e.next=6,Y(i,r,t);case 6:return e.abrupt("return",e.sent.map((function(e){return{name:e.name,isEditingRestrictive:e.restrictive,fields:e.fields.map((function(e){return a.layer.fieldsIndex.normalizeFieldName(e)}))}})));case 7:return e.abrupt("return",void 0!==n.hasContingentValuesDefinition?[]:ne(i,t).then(function(){var e=(0,u.Z)((0,o.Z)().mark((function e(n){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.supportsQueryDataElements){e.next=4;break}return e.next=3,ee(i,r,t);case 3:return e.abrupt("return",e.sent.map((function(e){return{name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((function(e){return a.layer.fieldsIndex.normalizeFieldName(e)}))}})));case 4:return e.abrupt("return",[]);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchContingentValues",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t,n){var r,i,a,l,u;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.layer.layerId){e.next=2;break}return e.abrupt("return",[]);case 2:if(r=this.layer.sourceJSON,i=this.layer.layerId.toString(),a=(0,M.Qc)(this.layer.url).url.path,!r.hasContingentValuesDefinition){e.next=8;break}return e.next=6,oe(a,i,n);case 6:return l=e.sent,e.abrupt("return",this._constructFieldGroupsAGOL(t,l));case 8:return e.next=10,ie(a,i,n);case 10:return u=e.sent,e.abrupt("return",this._constructFieldGroupsEnterprise(t,u));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_constructFieldGroupsAGOL",value:function(e,t){var n=this;return e.map((function(e){var r=t.contingentValuesDefinition.fieldGroups.find((function(t){return t.name===e.name}));if(r){var i;return i=t.contingentValuesDefinition.hasSubType?n._parseAGOLFieldGroupSubtype(e,t,r.subTypes):n._parseAGOLFieldGroup(e,t,r.contingentValues),new B({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:i})}return null})).filter(A.pC)}},{key:"_parseAGOLFieldGroupSubtype",value:function(e,t,n){var r=this,i=[];return null!==n&&void 0!==n&&n.forEach((function(n){var a=r._getSubtypeAGOL(n.name);i=i.concat(r._parseAGOLFieldGroup(e,t,n.contingentValues,a))})),i}},{key:"_parseAGOLFieldGroup",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=[],l=(0,i.Z)(null!==n&&void 0!==n?n:[]);try{for(l.s();!(r=l.n()).done;){var u=r.value,s=this._parseAGOLContingency(u,e,t,a);o.push(s)}}catch(c){l.e(c)}finally{l.f()}return o}},{key:"_parseAGOLContingency",value:function(e,t,n,r){for(var i=this,a=e.id,o=!!e.retired&&1===e.retired,l={},u=0,s=0;u<t.fields.length;u++){var c=t.fields[u],d=n.typeCodes[e.types[u]];if("Code"===d)!function(){var t=e.values[s];s++;var a=i._getDomain(r,c),o=i.layer.getField(c);if("string"===(null===o||void 0===o?void 0:o.type)){var u=n.stringDicts.find((function(e){return e.domain===(null===a||void 0===a?void 0:a.name)}));u&&(t=u.entries[t])}var d=null===a||void 0===a?void 0:a.codedValues.find((function(e){return e.code===t})),p=new E({codedValue:d,objectType:"code"});l[c]=p}();else if("Range"===d){var p=e.values[s];s++;var f=p.range[0],v=p.range[1],h=new E({minValue:f,maxValue:v,objectType:"range"});l[c]=h}else if("Any"===d){var y=new E({objectType:"any"});l[c]=y}else{var m=new E({objectType:"null"});l[c]=m}}return new N({id:a,isRetired:o,subtype:r,values:l})}},{key:"_constructFieldGroupsEnterprise",value:function(e,t){var n=this,r=t.fieldGroups;return e.map((function(e){var i=r.find((function(t){return t.name===e.name}));if(i){var a=i.contingencies.map((function(r){for(var i=r.id,a=r.isRetired||!1,o=n._getSubtypeEnterprise(r.subtypeCode),l={},u=function(i){var a=e.fields[i],u=r.values[i];if("number"==typeof u||"string"==typeof u){var s=n._getDomain(o,a),c=n.layer.getField(a);if((0,z.qN)(c))u=t.stringDictionary[u];else if((0,z.y2)(c)){var d=new Date("".concat(u,"+00:00"));u=d.getTime()}var p=null===s||void 0===s?void 0:s.codedValues.find((function(e){return e.code===u})),f=new E({codedValue:p,objectType:"code"});l[a]=f}else if("object"==typeof u){var v=u.minValue,h=u.maxValue,y=new E({minValue:v,maxValue:h,objectType:"range"});l[a]=y}else if(u){var m=new E({objectType:"any"});l[a]=m}else{var g=new E({objectType:"null"});l[a]=g}},s=0;s<e.fields.length;s++)u(s);return new N({id:i,isRetired:a,subtype:o,values:l})}));return new B({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:a})}return null})).filter(A.pC)}},{key:"_getSubtypeEnterprise",value:function(e){var t,n=this.layer.sourceJSON;if(n.subtypes){var r=n.subtypes.find((function(t){return t.code===e}));t=W.Z.fromJSON(r)}return t||null}},{key:"_getSubtypeAGOL",value:function(e){var t,n=this.layer.sourceJSON;if(n.subtypes){var r=n.subtypes.find((function(t){return t.name===e}));t=W.Z.fromJSON(r)}return t||null}},{key:"_getDomain",value:function(e,t){var n=e?function(e,t){var n=e.domains;if(n){var r=Object.entries(n).find((function(e){return(0,l.Z)(e,1)[0].trim().toLowerCase()===t.trim().toLowerCase()}))||[],i=(0,l.Z)(r,2);i[0];return i[1]||null}return null}(e,t):this.layer.getFieldDomain(t);return"inherited"===(null===n||void 0===n?void 0:n.type)?this.layer.getFieldDomain(t):n}}],[{key:"createLoadedLayerContingentValuesCache",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t){var n,r,i,a,l,u,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.load();case 2:if(n=t.sourceJSON,void 0!==t.layerId){e.next=5;break}return e.abrupt("return",null);case 5:if(!(r=n.hasContingentValuesDefinition)){e.next=8;break}return e.abrupt("return",new U({layer:t}).load());case 8:if(void 0!==r){e.next=23;break}if(null!=(i=(0,M.Qc)(t.url))){e.next=12;break}return e.abrupt("return",null);case 12:return a=i.url.path,e.next=15,ne(a);case 15:if(!e.sent.supportsQueryDataElements){e.next=23;break}return l=t.layerId.toString(),e.next=19,ee(a,l);case 19:if(!(u=e.sent)){e.next=23;break}return s=u.map((function(e){return{name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((function(e){return t.fieldsIndex.normalizeFieldName(e)}))}})),e.abrupt("return",new U({layer:t,fieldGroupDefinitions:s}).load());case 23:return e.abrupt("return",null);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}((0,S.eC)(O.Z));function J(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function K(e){var t,n;e.sort((function(e,t){return"null"===e.objectType?-1:"null"===t.objectType?1:e.minValue-t.minValue}));var r,a=[],o=(0,i.Z)(e);try{for(o.s();!(r=o.n()).done;){var l=r.value;"null"!==l.objectType?null!=t&&null!=n?n<l.minValue?(a.push(new E({objectType:"range",minValue:t,maxValue:n})),t=l.minValue,n=l.maxValue):n<l.maxValue&&(n=l.maxValue):(t=l.minValue,n=l.maxValue):a.push(l)}}catch(u){o.e(u)}finally{o.f()}return a.push(new E({objectType:"range",minValue:t,maxValue:n})),a}function Q(e,t){var n,r;if(0===e.length||0===t.length)return[];if("any"===e[0].objectType)return t;if("any"===t[0].objectType)return e;var a="range"===e[0].objectType||"range"===(null===(n=e[1])||void 0===n?void 0:n.objectType),o="range"===t[0].objectType||"range"===(null===(r=t[1])||void 0===r?void 0:r.objectType);return a||o?function(e,t){var n,r,a=[],o=0,l=(0,i.Z)(e);try{for(l.s();!(r=l.n()).done;)for(var u=r.value;o<t.length;o++){var s=t[o];if("null"===u.objectType&&"null"===s.objectType)a.push(new E({objectType:"null"}));else{if("null"===u.objectType)break;if("null"===s.objectType)continue}if(u.maxValue<s.minValue)break;if(u.maxValue===s.minValue){a.push(new E({objectType:"range",minValue:u.maxValue,maxValue:s.minValue}));break}if(!(u.minValue>s.maxValue))if(u.minValue!==s.maxValue){if(n=u.minValue>s.minValue?u.minValue:s.minValue,u.maxValue<s.maxValue){a.push(new E({objectType:"range",minValue:n,maxValue:u.maxValue}));break}a.push(new E({objectType:"range",minValue:n,maxValue:s.maxValue}))}else a.push(new E({objectType:"range",minValue:u.minValue,maxValue:s.maxValue}))}}catch(c){l.e(c)}finally{l.f()}return a}(e,t):function(e,t){var n,r=[],a=(0,i.Z)(e);try{var o=function(){var e=n.value;t.some((function(t){if(e.objectType===t.objectType)switch(e.objectType){case"any":case"null":return!0;case"code":return e.codedValue.code===t.codedValue.code&&e.codedValue.name===t.codedValue.name}return!1}))&&r.push(e)};for(a.s();!(n=a.n()).done;)o()}catch(l){a.e(l)}finally{a.f()}return r}(e,t)}function Y(e,t,n){return X.apply(this,arguments)}function X(){return X=(0,u.Z)((0,o.Z)().mark((function e(t,n,r){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.Z)("".concat(t,"/").concat(n,"/fieldgroups"),(0,a.Z)({responseType:"json",query:{f:"json"}},r)).then((function(e){var t;return null!==(t=e.data.fieldGroups)&&void 0!==t?t:[]})));case 1:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}function ee(e,t,n){return te.apply(this,arguments)}function te(){return te=(0,u.Z)((0,o.Z)().mark((function e(t,n,r){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.Z)("".concat(t,"/queryDataElements"),(0,a.Z)({responseType:"json",query:{layers:JSON.stringify([n]),f:"json"}},r)).then((function(e){var t,n;return null!==(t=null===(n=e.data.layerDataElements)||void 0===n?void 0:n[0].dataElement.fieldGroups)&&void 0!==t?t:[]})));case 1:case"end":return e.stop()}}),e)}))),te.apply(this,arguments)}function ne(e,t){return re.apply(this,arguments)}function re(){return re=(0,u.Z)((0,o.Z)().mark((function e(t,n){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.Z)(t,(0,a.Z)({responseType:"json",query:{f:"json"}},n)).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}function ie(e,t,n){return ae.apply(this,arguments)}function ae(){return ae=(0,u.Z)((0,o.Z)().mark((function e(t,n,r){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.Z)("".concat(t,"/queryContingentValues"),(0,a.Z)({responseType:"json",query:{layers:JSON.stringify([n]),f:"json"}},r)).then((function(e){var t;return null===(t=e.data.contingentValueSets)||void 0===t?void 0:t[0]})));case 1:case"end":return e.stop()}}),e)}))),ae.apply(this,arguments)}function oe(e,t,n){return le.apply(this,arguments)}function le(){return le=(0,u.Z)((0,o.Z)().mark((function e(t,n,r){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.Z)("".concat(t,"/").concat(n,"/contingentValues"),(0,a.Z)({responseType:"json",query:{f:"json"}},r)).then((function(e){return e.data})));case 1:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}(0,f._)([(0,k.Cb)({constructOnly:!0})],$.prototype,"layer",void 0),(0,f._)([(0,k.Cb)({constructOnly:!0})],$.prototype,"request",void 0),(0,f._)([(0,k.Cb)({type:[B]})],$.prototype,"fieldGroups",void 0),(0,f._)([(0,k.Cb)({constructOnly:!0})],$.prototype,"fieldGroupDefinitions",void 0),(0,f._)([(0,k.Cb)()],$.prototype,"subtypeFieldName",null);var ue,se=$=U=(0,f._)([(0,x.j)("esri.layers.support.LayerContingentValuesCache")],$),ce=n(6701),de=n(74887),pe=n(55515),fe=n(66978),ve=Symbol("FormExpressionArcadeExecutor"),he=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e))[ue]=!0,r._lastEvaluatedValue=null,r._abortController=new AbortController,r._stale=!1,r._updatingTracking=new Z.R,r._executeAsyncDebounced=(0,fe.Ds)(function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t,n,i){var l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.executor.executeAsync(t,(0,a.Z)((0,a.Z)({},n),{},{abortSignal:i}));case 2:return l=e.sent,e.abrupt("return",i.aborted?r._lastEvaluatedValue:(r._lastEvaluatedValue=l,r._stale=!1,l));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()),r}return(0,c.Z)(n,[{key:"isAsync",get:function(){return this.executor.isAsync}},{key:"fieldsUsed",get:function(){return this.executor.fieldsUsed}},{key:"syntaxTree",get:function(){return this.executor.syntaxTree}},{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"stale",get:function(){return this._stale}},{key:"geometryUsed",get:function(){return this.executor.geometryUsed}},{key:"variablesUsed",get:function(){return this.executor.variablesUsed}},{key:"lastEvaluatedValue",get:function(){return this._lastEvaluatedValue}},{key:"abort",value:function(){this._abortController.abort()}},{key:"execute",value:function(e,t){this._abortController=new AbortController;var n=this.executor.execute(e,(0,a.Z)((0,a.Z)({},t),{},{abortSignal:this._abortController.signal}));return this._lastEvaluatedValue=n,n}},{key:"executeAsync",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t,n){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(t,null!==n&&void 0!==n?n:{},this._abortController.signal))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"markStale",value:function(){this._stale=!0}},{key:"reset",value:function(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}}]),n}(V.default);ue=ve,(0,f._)([(0,k.Cb)()],he.prototype,"_lastEvaluatedValue",void 0),(0,f._)([(0,k.Cb)()],he.prototype,"_stale",void 0),(0,f._)([(0,k.Cb)()],he.prototype,"_updatingTracking",void 0),(0,f._)([(0,k.Cb)({constructOnly:!0})],he.prototype,"executor",void 0),(0,f._)([(0,k.Cb)()],he.prototype,"isAsync",null),(0,f._)([(0,k.Cb)()],he.prototype,"fieldsUsed",null),(0,f._)([(0,k.Cb)()],he.prototype,"syntaxTree",null),(0,f._)([(0,k.Cb)()],he.prototype,"updating",null),(0,f._)([(0,k.Cb)()],he.prototype,"stale",null),(0,f._)([(0,k.Cb)()],he.prototype,"geometryUsed",null),(0,f._)([(0,k.Cb)()],he.prototype,"variablesUsed",null),(0,f._)([(0,k.Cb)()],he.prototype,"lastEvaluatedValue",null),he=(0,f._)([(0,x.j)("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],he);var ye=function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t,n){var r,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,pe.createArcadeProfile)("form-calculation"),e.next=3,(0,pe.createArcadeExecutor)(t,r,{});case 3:return i=e.sent,e.abrupt("return",(null!==n&&void 0!==n&&n.fieldsIndex&&(i.fieldsUsed=(0,z.Q0)(n.fieldsIndex,i.fieldsUsed)),new he({executor:i})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),me=n(77427),ge="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY",be=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e))._fieldReferencesLookup=new Map,r._fieldsAffectedLookup=new Map,r.preserveFieldValuesWhenHidden=!0,r._latestFieldValues=(0,a.Z)({},e.feature.attributes),r}return(0,c.Z)(n,[{key:"initialize",value:function(){this._dependencyGraph=this._buildDependencyGraph()}},{key:"destroy",value:function(){this.resetExecutors()}},{key:"_asyncExecutors",get:function(){return this.executors.filter((function(e){return e.isAsync}))}},{key:"_baseContext",get:function(){var e=this.arcadeContextInfo,t=e.editType,n=e.layer,r=e.map,i=e.originalFeature,a=e.spatialReference,o=e.timeZone,l="scene"===(null===n||void 0===n?void 0:n.type)&&null!=n.associatedLayer?n.associatedLayer:n;return[{$originalfeature:i,$editcontext:{editType:t},$layer:l,$featureset:l,$datastore:null===n||void 0===n?void 0:n.url,$map:r},{rawOutput:!0,spatialReference:null!==a&&void 0!==a?a:void 0,timeZone:o}]}},{key:"feature",set:function(e){this._latestFieldValues=(0,a.Z)({},null===e||void 0===e?void 0:e.attributes),this._set("feature",e)}},{key:"evaluateAll",value:function(){return this._evaluate(this.executors)}},{key:"evaluateAsyncExpressions",value:function(){return this._evaluate(this._asyncExecutors)}},{key:"evaluateExpressions",value:function(e){return this._evaluate(e)}},{key:"evaluateInvalidated",value:function(e){var t,n=this._fieldReferencesLookup,a=this._latestFieldValues,o=this.feature,l=new Set,u=(0,i.Z)(e);try{for(u.s();!(t=u.n()).done;){var s=t.value;if(a[s]=o.getAttribute(s),n.has(s)){var c,d=(0,i.Z)(n.get(s));try{for(d.s();!(c=d.n()).done;){var p=c.value;l.add(p)}}catch(f){d.e(f)}finally{d.f()}}}}catch(f){u.e(f)}finally{u.f()}return this._evaluate((0,r.Z)(l))}},{key:"evaluateInvalidatedByGeometry",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._fieldReferencesLookup.has(ge)){e.next=2;break}return e.abrupt("return",this._evaluate((0,r.Z)(this._fieldReferencesLookup.get(ge))));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resetExecutors",value:function(){var e,t=(0,i.Z)(this.executors);try{for(t.s();!(e=t.n()).done;){e.value.reset()}}catch(n){t.e(n)}finally{t.f()}}},{key:"_buildDependencyGraph",value:function(){var e,t=this._fieldReferencesLookup,n=this._fieldsAffectedLookup,r=this.executors,a=this.preserveFieldValuesWhenHidden,o=new Map(this.fieldInputs.map((function(e){return[e.name,e]}))),l=!1===a,u=new Map(r.map((function(e){return[e,new Array]}))),s=(0,i.Z)(r);try{var c=function(){var r,a=e.value,s=(0,i.Z)(a.fieldsUsed);try{var c=function(){var e,i=r.value;(0,me.s1)(t,i,(function(){return new Set})).add(a);var s=o.get(i);[null===s||void 0===s?void 0:s.valueExpressionExecutor,null===s||void 0===s?void 0:s.editableExpressionExecutor,l?null===s||void 0===s||null===(e=s.group)||void 0===e?void 0:e.visibilityExpressionExecutor:null,l?null===s||void 0===s?void 0:s.visibilityExpressionExecutor:null].filter((function(e){return null!=e&&e!==a})).forEach((function(e){u.get(e).push(a),(0,me.s1)(n,e,(function(){return new Set})).add(s)}))};for(s.s();!(r=s.n()).done;)c()}catch(d){s.e(d)}finally{s.f()}a.geometryUsed&&(0,me.s1)(t,ge,(function(){return new Set})).add(a)};for(s.s();!(e=s.n()).done;)c()}catch(d){s.e(d)}finally{s.f()}return u}},{key:"_evaluate",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t){var n,r,a,s,c,d,p,f,v,h,y,g,b=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Map,r=this._dependencyGraph,a=this._fieldsAffectedLookup,s=this._latestFieldValues,c=(0,i.Z)(t);try{for(c.s();!(d=c.n()).done;)p=d.value,_e(p,n,r)}catch(_){c.e(_)}finally{c.f()}f=(0,i.Z)(n);try{for(h=function(){var e=(0,l.Z)(v.value,2),t=e[0],n=e[1],r=n.resolver,c=n.dependencyPromises;Promise.all(c).then((0,u.Z)((0,o.Z)().mark((function e(){var n,r,i,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=b._makeContext(s),r=(0,l.Z)(n,2),i=r[0],a=r[1],e.abrupt("return",t.executeAsync(i,a));case 2:case"end":return e.stop()}}),e)})))).then((function(){if(a.has(t)){var e,n=(0,i.Z)(a.get(t));try{for(n.s();!(e=n.n()).done;){var o=e.value;b._latestFieldValues[o.name]=o.value}}catch(_){n.e(_)}finally{n.f()}}r.resolve()}),(function(e){!e||(0,fe.D_)(e)||Ce(e)||t.markStale(),r.reject(e)}))},f.s();!(v=f.n()).done;)h()}catch(_){f.e(_)}finally{f.f()}return e.next=7,Promise.allSettled(Array.from(n.values(),(function(e){return e.resolver.promise})));case 7:if(y=e.sent.filter((function(e){return"rejected"===e.status&&!((0,fe.D_)(e.reason)||Ce(e.reason))})),!(y.length>0)){e.next=11;break}throw g=new AggregateError(y,"One or more expression executions failed. First error message: ".concat(y[0].reason)),m.Z.getLogger(this).error(g),g;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_makeContext",value:function(e){var t=(0,l.Z)(this._baseContext,2),n=t[0],r=t[1],i=this.feature.clone();return i.attributes=e,[(0,a.Z)((0,a.Z)({},n),{},{$feature:i}),r]}},{key:"test",get:function(){}}]),n}(V.default);(0,f._)([(0,k.Cb)()],be.prototype,"_asyncExecutors",null),(0,f._)([(0,k.Cb)()],be.prototype,"_baseContext",null),(0,f._)([(0,k.Cb)()],be.prototype,"feature",null),(0,f._)([(0,k.Cb)({constructOnly:!0})],be.prototype,"preserveFieldValuesWhenHidden",void 0),(0,f._)([(0,k.Cb)()],be.prototype,"executors",void 0),(0,f._)([(0,k.Cb)()],be.prototype,"fieldInputs",void 0),(0,f._)([(0,k.Cb)()],be.prototype,"arcadeContextInfo",void 0),be=(0,f._)([(0,x.j)("esri.widgets.FeatureForm.FormExpressionsManager")],be);var _e=function e(t,n,r){if(!n.has(t)){var a=(0,fe.hh)();n.set(t,{resolver:a,dependencyPromises:[]}),t.abort();var o,l=r.get(t),u=(0,i.Z)(l);try{for(u.s();!(o=u.n()).done;){var s=o.value;e(s,n,r),n.get(s).dependencyPromises.push(a.promise)}}catch(c){u.e(c)}finally{u.f()}}},Ce=function(e){return e&&"object"==typeof e&&"message"in e&&"Cancelled"===e.message},ke=n(44927),xe=n(95439),Ze=n(170),we=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e))._expressionTrackingHandles=new Map,r.id=(0,xe.D)().toString(),r.type="group",r}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,_.watch)((function(){return[e.visible,e.inputs]}),(function(t){var n,r=(0,l.Z)(t,1)[0],a=e.inputs,o=!!r&&void 0,u=(0,i.Z)(a);try{for(u.s();!(n=u.n()).done;){var s=n.value;(0,q.Vs)(s)&&(s.required=o)}}catch(c){u.e(c)}finally{u.f()}}),{initial:!0,equals:function(e,t){return t[0]===e[0]&&t[1]===e[1]}})])}},{key:"destroy",value:function(){var e,t=(0,i.Z)(this._expressionTrackingHandles.values());try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(n){t.e(n)}finally{t.f()}}},{key:"initialState",get:function(){return this.element.initialState||"expanded"}},{key:"inputs",get:function(){return this._get("inputs")},set:function(e){var t=this;this.removeAllHandles(),e&&this.addHandles(e.map((function(e){return(0,_.watch)((function(){return e.visible}),(function(){return t._dirtyEvaluatedVisibilityExpression()}))}))),this._set("inputs",e)}},{key:"label",get:function(){return this.element.label},set:function(e){var t=this.element;t&&(t.label=e)}},{key:"open",get:function(){return"expanded"===this.initialState},set:function(e){this._override("open",e)}},{key:"state",get:function(){return(0,ke.Mr)(m.Z.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open?"expanded":"collapsed"},set:function(e){(0,ke.Mr)(m.Z.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open="expanded"===e}},{key:"visible",get:function(){return!1!==this.evaluatedVisibilityExpression&&this.inputs&&this.inputs.some((function(e){return e.visible}))}},{key:"_dirtyEvaluatedVisibilityExpression",value:function(){this.element.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}}]),n}(Ze.Z);(0,f._)([(0,k.Cb)()],we.prototype,"id",void 0),(0,f._)([(0,k.Cb)()],we.prototype,"initialState",null),(0,f._)([(0,k.Cb)()],we.prototype,"inputs",null),(0,f._)([(0,k.Cb)()],we.prototype,"label",null),(0,f._)([(0,k.Cb)()],we.prototype,"open",null),(0,f._)([(0,k.Cb)()],we.prototype,"type",void 0),(0,f._)([(0,k.Cb)()],we.prototype,"visible",null);var Fe=we=(0,f._)([(0,x.j)("esri.widgets.FeatureForm.GroupInput")],we),Ve=n(37933),Ie=n(67667),Ee=n(45276),Re=n(51799),Te=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e))._relationshipVM=null,r.group=null,r.type="relationship",r.addHandles([(0,_.watch)((function(){return{feature:r.feature,element:r.element,layer:r.layer}}),(function(e){return r._createRelationshipVM(e)}),_.initial),(0,_.on)((function(){return r.relatedLayer}),"edits",(function(){var e;return null===(e=r._relationshipVM)||void 0===e?void 0:e.refresh()}))]),r}return(0,c.Z)(n,[{key:"destroy",value:function(){var e;null===(e=this._relationshipVM)||void 0===e||e.destroy()}},{key:"canAddRelatedFeature",get:function(){var e=this.editable,t=this.featureCount,n=this.relationship;if(!n||!this.loaded||!this.relatedLayerAllowsAdds)return!1;var r=n.cardinality,i=n.role;return!("one-to-one"===r&&t>0)&&"many-to-many"!==r&&!("one-to-many"===r&&"destination"===i&&t>0)&&e}},{key:"displayCount",get:function(){var e;return null!==(e=this.element.displayCount)&&void 0!==e?e:3}},{key:"displayType",get:function(){return this.element.displayType}},{key:"editable",get:function(){var e;return!!this.relatedLayerAllowsEdits&&(null===(e=this.evaluatedEditableExpression)||void 0===e||e)}},{key:"featureCount",get:function(){var e,t;return null!==(e=null===(t=this._relationshipVM)||void 0===t?void 0:t.featureCount)&&void 0!==e?e:0}},{key:"loaded",get:function(){var e;return"loading"!==(null===(e=this._relationshipVM)||void 0===e?void 0:e.state)}},{key:"map",get:function(){return this._get("map")},set:function(e){var t;e&&null!==(t=this._relationshipVM)&&void 0!==t&&t.set("map",e),this._set("map",e)}},{key:"orderByFields",get:function(){return this.element.orderByFields}},{key:"originHasValidKey",get:function(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}},{key:"relationship",get:function(){var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.relationship}},{key:"relationshipId",get:function(){return this.element.relationshipId}},{key:"relatedFeatureInfos",get:function(){var e,t=this._relationshipVM,n=this.timeZone;if(null===t||void 0===t||null===(e=t.relatedFeatures)||void 0===e||!e.length||null===t||void 0===t||!t.relatedLayer)return[];var r=t.itemDescriptionFieldName,i=t.relatedFeatures,a=t.relatedLayer,o=a&&"formTemplate"in a&&a.formTemplate?a.formTemplate.title:void 0;return i.map((function(e){var t;if(r){var i=e.getAttribute(r),l=a.fieldsIndex.get(r);if(l){var u=(0,q.Bl)({values:[i],fields:[l],timeZone:null!==n&&void 0!==n?n:void 0})[r];null!=u&&(t=u.toString())}}return{feature:e,description:t,title:o?(0,q.sq)({label:o,attributes:e.attributes,fieldsIndex:a.fieldsIndex,timeZone:n}):void 0}})).toArray()}},{key:"relatedLayer",get:function(){var e;return null===(e=this._relationshipVM)||void 0===e?void 0:e.relatedLayer}},{key:"relatedLayerIsTable",get:function(){var e;return!(null===(e=this.relatedLayer)||void 0===e||!e.isTable)}},{key:"relatedLayerAllowsAdds",get:function(){var e,t=this.relatedLayer;if(!t||!this.relatedLayerAllowsEdits)return!1;var n=(0,Ve.S1)(t);return!(null===n||void 0===n||null===(e=n.operations)||void 0===e||!e.supportsAdd)}},{key:"relatedLayerAllowsEdits",get:function(){var e,t=this.relatedLayer;if(!t)return!1;var n=(0,Ve.S1)(t);return!(null===n||void 0===n||null===(e=n.operations)||void 0===e||!e.supportsEditing)}},{key:"showAllEnabled",get:function(){return this._get("showAllEnabled")},set:function(e){var t;null!==(t=this._relationshipVM)&&void 0!==t&&t.set("showAllEnabled",e),this._set("showAllEnabled",e)}},{key:"showAllActionVisible",get:function(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}},{key:"visible",get:function(){var e=this.relationship;return!!e&&("many-to-many"!==e.cardinality&&(null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element))}},{key:"updating",get:function(){var e,t;return"loading"===(null===(e=this._relationshipVM)||void 0===e?void 0:e.state)||"querying"===(null===(t=this._relationshipVM)||void 0===t?void 0:t.state)}},{key:"incrementPage",value:function(){this._relationshipVM&&this._relationshipVM.featurePage++}},{key:"getRelatedFeatureByObjectId",value:function(e){var t;return null===(t=this._relationshipVM)||void 0===t?void 0:t.getRelatedFeatureByObjectId(e)}},{key:"_createRelationshipVM",value:function(e){var t,n=e.feature,r=e.element,i=e.layer;if(null!==(t=this._relationshipVM)&&void 0!==t&&t.destroy(),n&&r&&i){var a=this.displayCount,o=this.map,l=this.orderByFields,u=this.relationshipId,s=this.showAllEnabled;(0,Ee.Um)(i)&&(this._relationshipVM=new Ie.Z({graphic:n,displayCount:a,layer:i,map:o,orderByFields:l,relationshipId:u,showAllEnabled:s}))}}}]),n}(Re.Z);(0,f._)([(0,k.Cb)()],Te.prototype,"_relationshipVM",void 0),(0,f._)([(0,k.Cb)()],Te.prototype,"canAddRelatedFeature",null),(0,f._)([(0,k.Cb)()],Te.prototype,"displayCount",null),(0,f._)([(0,k.Cb)()],Te.prototype,"displayType",null),(0,f._)([(0,k.Cb)()],Te.prototype,"editable",null),(0,f._)([(0,k.Cb)()],Te.prototype,"featureCount",null),(0,f._)([(0,k.Cb)()],Te.prototype,"group",void 0),(0,f._)([(0,k.Cb)()],Te.prototype,"loaded",null),(0,f._)([(0,k.Cb)()],Te.prototype,"map",null),(0,f._)([(0,k.Cb)()],Te.prototype,"orderByFields",null),(0,f._)([(0,k.Cb)()],Te.prototype,"originHasValidKey",null),(0,f._)([(0,k.Cb)()],Te.prototype,"relationship",null),(0,f._)([(0,k.Cb)()],Te.prototype,"relationshipId",null),(0,f._)([(0,k.Cb)()],Te.prototype,"relatedFeatureInfos",null),(0,f._)([(0,k.Cb)()],Te.prototype,"relatedLayer",null),(0,f._)([(0,k.Cb)()],Te.prototype,"relatedLayerIsTable",null),(0,f._)([(0,k.Cb)()],Te.prototype,"relatedLayerAllowsAdds",null),(0,f._)([(0,k.Cb)()],Te.prototype,"relatedLayerAllowsEdits",null),(0,f._)([(0,k.Cb)()],Te.prototype,"showAllEnabled",null),(0,f._)([(0,k.Cb)()],Te.prototype,"showAllActionVisible",null),(0,f._)([(0,k.Cb)({readOnly:!0})],Te.prototype,"type",void 0),(0,f._)([(0,k.Cb)()],Te.prototype,"visible",null),(0,f._)([(0,k.Cb)()],Te.prototype,"updating",null);var Ae,Se=Te=(0,f._)([(0,x.j)("esri.widgets.FeatureForm.RelationshipInput")],Te),Oe=n(80987),Me=n(18442),Le=n(2622),Ne=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];function De(){return De=(0,u.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Ae,e.t0){e.next=4;break}return e.next=4,je();case 4:return e.abrupt("return",Ae.parse(t));case 5:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}function je(){return Pe.apply(this,arguments)}function Pe(){return Pe=(0,u.Z)((0,o.Z)().mark((function e(){var t,r,l,u,s,c,d,p,f;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(13086).then(n.bind(n,33321));case 2:t=e.sent,r=t.Marked,l=function(e){return'<span style="text-decoration:line-through;">'.concat(e,"</span>")},u=function(e,t,n){return"<a".concat(null!=e?' href="'.concat(e,'"'):"").concat(null!=t?' title="'.concat(t,'"'):"",' target="_blank">').concat(null!==n&&void 0!==n?n:"","</a>")},s=function(){return""},c={},d=(0,i.Z)(Ne);try{for(d.s();!(p=d.n()).done;)f=p.value,c[f]=s}catch(o){d.e(o)}finally{d.f()}Ae=new r({renderer:(0,a.Z)({del:l,link:u},c)});case 11:case"end":return e.stop()}}),e)}))),Pe.apply(this,arguments)}var He=n(80975),Ge=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).group=null,r.id="TextElementInput-".concat((0,xe.D)()),r.type="text",r._expressionReferences=new Me.Z,r._expressionsUsed=new Le.Z,r._fieldsUsed=new Le.Z,r._literalParts=new Oe.Z,r._templateParts=new Oe.Z,r._updatingHandles=new Z.R,r}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.rawText;t?"markdown"===this.textFormat?this._updatingHandles.addPromise(function(e){return De.apply(this,arguments)}(t).then((function(t){return e._initializeTextParts(t)}))):this._initializeTextParts(t):this._literalParts.push("")}},{key:"expressionsUsed",get:function(){return Array.from(this._expressionsUsed)}},{key:"fieldsIndex",get:function(){return this.layer.fieldsIndex},set:function(e){this._overrideIfSome("fieldsIndex",e)}},{key:"fieldsUsed",get:function(){return Array.from(this._fieldsUsed)}},{key:"rawText",get:function(){return this.element.text}},{key:"text",get:function(){var e=this,t=this._templateParts.map((function(t){var n,r;return"".concat(null!==(n=null===(r=e._expressionReferences.get(t))||void 0===r?void 0:r.lastEvaluatedValue)&&void 0!==n?n:"")}));return He.w3.sanitize(function(e,t){return t.reduce((function(t,n,r){return t.concat(e.at(r),n)}),"").concat(e.at(-1))}(this._literalParts,t))}},{key:"textFormat",get:function(){return this.element.textFormat}},{key:"updating",get:function(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some((function(e){return null===e||void 0===e?void 0:e.updating}))}},{key:"setExpressionExecutor",value:function(e,t){this._expressionReferences.set((0,q.V$)(e),t)}},{key:"setFieldExecutor",value:function(e,t){this._expressionReferences.set((0,q.Lm)(e),t)}},{key:"_initializeTextParts",value:function(e){for(var t=this.fieldsIndex,n=function(e){var t,n=/{[^{]+?}/g,a=(0,r.Z)(e.matchAll(n)),o=0,l=[],u=[],s=(0,i.Z)(a);try{for(s.s();!(t=s.n()).done;){var c=t.value,d=c[0];l.push(e.slice(o,c.index)),u.push(d),o=c.index+d.length}}catch(p){s.e(p)}finally{s.f()}return l.push(e.slice(o)),{literals:l,templates:u}}(e),a=n.literals,o=n.templates,l=[],u=[],s=0;s<o.length;s++){var c=a[s],d=(0,z.ld)(o[s])[0];if((0,q.Pr)(d))this._expressionsUsed.add((0,q.of)(d)),this._expressionReferences.set(d,null),l.push(c),u.push(d);else if((0,q.FB)(d)){this._expressionsUsed.add(d);var p=(0,q.V$)(d);this._expressionReferences.set(p,null),l.push(c),u.push(p)}else if(null!==t&&void 0!==t&&t.has(d)){var f=t.normalizeFieldName(d);this._fieldsUsed.add(f);var v=(0,q.Lm)(f);this._expressionReferences.set(v,null),l.push(c),u.push(v)}else a[s+1]=c.concat(d,a[s+1])}l.push(a.at(-1)),this._literalParts.addMany(l),this._templateParts.addMany(u)}}]),n}(Ze.Z);(0,f._)([(0,k.Cb)()],Ge.prototype,"expressionsUsed",null),(0,f._)([(0,k.Cb)()],Ge.prototype,"fieldsIndex",null),(0,f._)([(0,k.Cb)()],Ge.prototype,"fieldsUsed",null),(0,f._)([(0,k.Cb)()],Ge.prototype,"group",void 0),(0,f._)([(0,k.Cb)()],Ge.prototype,"id",void 0),(0,f._)([(0,k.Cb)()],Ge.prototype,"rawText",null),(0,f._)([(0,k.Cb)()],Ge.prototype,"text",null),(0,f._)([(0,k.Cb)()],Ge.prototype,"textFormat",null),(0,f._)([(0,k.Cb)()],Ge.prototype,"type",void 0),(0,f._)([(0,k.Cb)()],Ge.prototype,"updating",null),Ge=(0,f._)([(0,x.j)("esri.widgets.FeatureForm.TextElementInput")],Ge);var Ue=new v.Z({attributes:{}}),Be={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"]},ze="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",We="#JSAPI_CONTINGENT_VALUE_ANY_HASH",qe="#JSAPI_CONTINGENT_VALUE_NULL_HASH",$e="esri.widgets.FeatureForm.FeatureFormViewModel",Je=function(){return m.Z.getLogger($e)},Ke=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e))._expressionExecutorsInUse=new Set,r._expressionExecutorLookup=new Map,r._expressionsManager=null,r._contingentValuesCache=null,r._featureClone=Ue.clone(),r._initialFeature=Ue.clone(),r._timeZone=null,r._updatingHandles=new Z.R,r.arcadeEditType="NA",r.contingencyConstraintViolations=new Map,r.disabled=!1,r.highlightHelper=null,r.inputs=[],r.map=null,r.relatedRecordCallbacks=null,r.strict=!1,r.hasPendingSubtypeChoice=!1,r}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this,t=(0,_.watch)((function(){var t;return[e.layer,!(null===(t=e.layer)||void 0===t||!t.loaded),e.formTemplate,e.feature,e.timeZone,e.arcadeEditType]}),function(){var t=(0,u.Z)((0,o.Z)().mark((function t(n){var r,i,a;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=(0,l.Z)(n,2),i=r[0],a=r[1],null!=i&&(a?e._updatingHandles.addPromise(e._updateInputs()):i.load().catch((function(){})));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),{equals:function(e,t){var n=(0,l.Z)(e,6),r=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=(0,l.Z)(t,6),d=c[0],p=c[1],f=c[2],v=c[3],h=c[4],y=c[5];return r===d&&i===p&&a===f&&o===v&&u===h&&s===y},initial:!0}),n=(0,_.watch)((function(){return e._arcadeContextInfo}),(function(t){null!=e._expressionsManager&&(e._expressionsManager.arcadeContextInfo=t,e._updatingHandles.addPromise(e._expressionsManager.evaluateAll().finally((function(){return e._afterExpressionsEvaluated()}))))})),r=(0,_.watch)((function(){return e.layer}),(function(t){var n="subtype-sublayer"===(null===t||void 0===t?void 0:t.type)?t.parent:"feature"===(null===t||void 0===t?void 0:t.type)?t:null;n&&e.addResolvingPromise(se.createLoadedLayerContingentValuesCache(n).then((function(t){e._contingentValuesCache=t,e.notifyChange("fieldsWithContingentValues")})))}),{initial:!0});this.addHandles([t,n,r])}},{key:"destroy",value:function(){var e;this.feature=null,this.layer=null,this._contingentValuesCache=(0,g.SC)(this._contingentValuesCache),null!==(e=this.highlightHelper)&&void 0!==e&&e.removeAll(),this._updatingHandles.destroy()}},{key:"_expressionInfosLookup",get:function(){var e,t;return new Map(null===(e=this.formTemplate)||void 0===e||null===(t=e.expressionInfos)||void 0===t?void 0:t.map((function(e){return[e.name,e]})))}},{key:"activeRelationshipInput",get:function(){var e=this;return this.allRelationshipInputs.find((function(t){return t.relationshipId===e.relationshipId}))}},{key:"_arcadeContextInfo",get:function(){var e=this._initialFeature,t=this.arcadeEditType,n=this.layer,r=this.map,i=this.spatialReference,a=this.timeZone;return{layer:(0,R.K)(n)?n:null,originalFeature:e,editType:t,map:r,spatialReference:i,timeZone:a}}},{key:"allFieldInputs",get:function(){return(0,q.IE)(this.inputs)}},{key:"allGroupInputs",get:function(){return this.inputs.filter(q.ib)}},{key:"allRelationshipInputs",get:function(){return(0,q.m1)(this.inputs)}},{key:"_layerFieldsByName",get:function(){var e;return new Map(null===(e=this.layer)||void 0===e?void 0:e.fields.map((function(e){return[e.name,e]})))}},{key:"feature",get:function(){return this._get("feature")},set:function(e){var t=this._get("feature");this._featureClone=e?e.clone():Ue.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach((function(t){return t.feature=e}))):(this.inputs.forEach((function(e){return e.destroy()})),this.inputs.length=0),t!==e&&(this.hasPendingSubtypeChoice=!1),this.contingencyConstraintViolations.clear(),this._set("feature",e)}},{key:"fieldsWithContingentValues",get:function(){if(null==this._contingentValuesCache)return new Set;var e=this._contingentValuesCache.fieldGroups.flatMap((function(e){return e.fields}));return new Set(e)}},{key:"formTemplate",get:function(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null},set:function(e){void 0===e?this._clearOverride("formTemplate"):this._override("formTemplate",e)}},{key:"formDescription",get:function(){var e=this.formTemplate,t=this.layer;return null!==e&&void 0!==e&&e.description&&t?(0,q.sq)({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}},{key:"formTitle",get:function(){var e=this.formTemplate,t=this.layer;return null!==e&&void 0!==e&&e.title&&t?(0,q.sq)({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}},{key:"formHeaderVisible",get:function(){var e=this.activeRelationshipInput,t=this.formDescription,n=this.formTitle;return!(e||!t&&!n)}},{key:"joinedContingentValues",get:function(){return this._joinContingentValues()}},{key:"layer",get:function(){var e;return null!==(e=this.feature)&&void 0!==e&&e.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null},set:function(e){this._override("layer",e)}},{key:"relationshipId",get:function(){return this._get("relationshipId")},set:function(e){var t=this.allRelationshipInputs;if(null!=e&&e===this.relationshipId||t.forEach((function(e){return e.showAllEnabled=!1})),null!=e){var n=t.find((function(t){return t.relationshipId===e}));n&&(n.showAllEnabled=!0)}this._set("relationshipId",e)}},{key:"spatialReference",get:function(){var e,t;return null!==(e=null===(t=this.layer)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null},set:function(e){this._override("spatialReference",e)}},{key:"state",get:function(){var e;return null!==(e=this.layer)&&void 0!==e&&e.loaded?"ready":"disabled"}},{key:"submittable",get:function(){return!!this.valid||this.allFieldInputs.filter((function(e){return!e.valid})).every((function(e){return e.submittable}))}},{key:"timeZone",get:function(){var e=this.layer;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return ce.pt;var t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===ce._4?t||ce.pt:this._timeZone||ce.By},set:function(e){this._timeZone=e}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"valid",get:function(){var e=this.allFieldInputs;return e.length>0&&e.every((function(e){return e.valid}))}},{key:"findField",value:function(e){return this.allFieldInputs.find((function(t){return t.name===e}))}},{key:"getFieldValueOptionsForField",value:function(e,t){var n,r=this.findField(e);if(!r)return[[],[],[]];var i="coded-value"===(null===(n=r.domain)||void 0===n?void 0:n.type)?r.domain.codedValues.map((function(e){return{name:e.name,value:e.code}})):[],a=null==r.value||i.some((function(e){return e.value===r.value}))?[]:[{name:"".concat(r.value),value:r.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(o.length>0){var l=new Set(o.map((function(e){return e.value})));return[o,i.filter((function(e){return!l.has(e.value)})),a]}return[i,[],a]}},{key:"getValue",value:function(e){var t,n,r=null===(t=this.layer)||void 0===t?void 0:t.getField(e);if(null!=r)return null!==(n=this._featureClone.getAttribute(r.name))&&void 0!==n?n:null}},{key:"setValue",value:function(e,t){var n=this,r=this._featureClone,i=this.strict,a=this.findField(e);t=""===t?null:t,a&&r.getAttribute(e)!==t&&(a.value=t,i&&!a.valid||(this._afterValueChange(a),null!=this._expressionsManager&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([a.name]).finally((function(){return n._afterExpressionsEvaluated()})))))}},{key:"getValues",value:function(){return(0,a.Z)({},this._featureClone.attributes)}},{key:"overrideInitialFeature",value:function(e){this._initialFeature=e}},{key:"submit",value:function(){var e=this.allFieldInputs,t=new Set(e.filter((function(e){return e.valid})).map((function(e){return e.name}))),n=e.filter((function(e){return!e.valid})).map((function(e){return e.name})),a=this.getValues();if(this.validateContingencyConstraints(a,{includeIncompleteViolations:!0}).length>0){var o,u=(0,i.Z)(this.contingencyConstraintViolations.entries());try{for(u.s();!(o=u.n()).done;){var s=(0,l.Z)(o.value,2),c=s[0];"error"===s[1].type&&(t.delete(c),n.push(c))}}catch(d){u.e(d)}finally{u.f()}}this.emit("submit",{valid:(0,r.Z)(t),invalid:n,values:a})}},{key:"validateContingencyConstraints",value:function(e,t){var n=this._contingentValuesCache,a=new Map;if(this.contingencyConstraintViolations=a,null==n)return[];var o,l=n.validateContingencyConstraints(e),u=l.invalid,s=l.incomplete,c=[].concat((0,r.Z)(u),(0,r.Z)(null!==t&&void 0!==t&&t.includeIncompleteViolations?s:[])),d=(0,i.Z)(c);try{for(d.s();!(o=d.n()).done;){var p,f=o.value,v=(0,i.Z)(f.fieldGroup.fields);try{for(v.s();!(p=v.n()).done;){var h=p.value;a.set(h,f)}}catch(y){v.e(y)}finally{v.f()}}}catch(y){d.e(y)}finally{d.f()}return c}},{key:"notifyFeatureGeometryChanged",value:function(){var e=this,t=this._expressionsManager,n=this.feature;this._featureClone.geometry=n.geometry,null!=t&&this._updatingHandles.addPromise(t.evaluateInvalidatedByGeometry().finally((function(){return e._afterExpressionsEvaluated()})))}},{key:"applySubtypeDefaults",value:function(e){var t,n=e.defaultValues,r=this.allFieldInputs,a=(0,i.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value.name,l=n[o];null!=l&&this.setValue(o,l)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_emitChangeEvent",value:function(e){var t=e.name,n=e.valid,r=e.value;this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:t,value:r,valid:n})}},{key:"_updateInputs",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(){var t,n,r,i,a,l,u,s,c,d;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._stopExpressions(),t=this._featureClone,n=this._initialFeature,r=this.arcadeEditType,i=this.formTemplate,a=this.inputs,l=this.layer,u=this.timeZone,l){e.next=4;break}return e.abrupt("return");case 4:if(s={arcadeEditType:r,feature:t,initialFeature:n,layer:l,timeZone:u},c=a.slice(),!(null!==i&&void 0!==i&&i.elements&&i.elements.length>0)){e.next=12;break}return e.next=9,this._updateInputsUsingFormElements(c,i.elements,s);case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=this._updateInputsUsingLayerFields(c,null===l||void 0===l?void 0:l.fields,s);case 13:return d=e.t0,this.inputs=d,e.next=17,this._startExpressions();case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateInputsUsingFormElements",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t,n,r){var a,u,s,c,d,p,f,v,h,y,m,g,b,_;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Map,u=(0,i.Z)(t);try{for(u.s();!(s=u.n()).done;)if(c=s.value,(0,q.ib)(c)){a.set(c.element,c),d=(0,i.Z)(c.inputs);try{for(d.s();!(p=d.n()).done;)(f=p.value).element&&a.set(f.element,f)}catch(o){d.e(o)}finally{d.f()}}else c.element&&a.set(c.element,c)}catch(o){u.e(o)}finally{u.f()}return v=new Map,e.next=6,this._updateInputsUsingFormElementsRecursive({existingInputsByElement:a,updatedElements:n.filter(Qe),sharedInitializationProperties:r,group:null,newExpressionExecutorPromises:v});case 6:h=e.sent,y=(0,i.Z)(a.entries());try{for(y.s();!(m=y.n()).done;)g=(0,l.Z)(m.value,2),b=g[0],_=g[1],a.delete(b),_.destroy()}catch(o){y.e(o)}finally{y.f()}return e.next=11,Promise.all(Array.from(v.values()));case 11:return e.abrupt("return",h);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_updateInputsUsingFormElementsRecursive",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t){var n,r,a,l,u,s,c,d,p,f=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.existingInputsByElement,r=t.updatedElements,a=t.sharedInitializationProperties,l=t.group,u=t.newExpressionExecutorPromises,s=[],c=(0,i.Z)(r),e.prev=2,p=(0,o.Z)().mark((function e(){var t,r,i,c,p,v,h;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.value,r=n.has(t),!(i=r?n.get(t):f._makeInputFromElement(t,a,l))){e.next=14;break}return s.push(i),e.next=6,(0,_.whenOnce)((function(){return!i.updating}));case 6:if(f._assignExpressionExecutors(i,t,u),!r){e.next=9;break}n.delete(t),(0,q.ib)(i)?(c=a.feature,p=a.timeZone,i.set({feature:c,timeZone:p})):(0,q.V7)(i)?(v=f.relationshipId===t.relationshipId,i.set(a),i.set({map:f.map,showAllEnabled:v})):i.set(a);case 9:if(!(0,F.ah)(t)){e.next=14;break}return h=t.elements.filter((function(e){return Qe(e)})),e.next=13,f._updateInputsUsingFormElementsRecursive({existingInputsByElement:n,updatedElements:h,sharedInitializationProperties:a,group:i,newExpressionExecutorPromises:u});case 13:i.inputs=e.sent;case 14:case"end":return e.stop()}}),e)})),c.s();case 5:if((d=c.n()).done){e.next=9;break}return e.delegateYield(p(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),c.e(e.t1);case 14:return e.prev=14,c.f(),e.finish(14);case 17:return e.abrupt("return",s);case 18:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateInputsUsingLayerFields",value:function(e,t,n){if(!Array.isArray(t))return Je().warn(this.declaredClass,"No attribute fields found."),[];var r,o=new Map,u=(0,i.Z)(e);try{for(u.s();!(r=u.n()).done;){var s=r.value;if((0,q.ib)(s)){var c,d=(0,i.Z)(s.inputs);try{for(d.s();!(c=d.n()).done;){c.value.destroy()}}catch(V){d.e(V)}finally{d.f()}s.inputs.length=0,s.destroy()}else(0,q.V7)(s)?s.destroy():(0,q.Vs)(s)&&(null!==s.element?s.destroy():o.set(s.field,s))}}catch(V){u.e(V)}finally{u.f()}var p,f=[],v=(0,i.Z)(t);try{for(v.s();!(p=v.n()).done;){var h,y,m,g,b=p.value,_=null!==(h=null===(y=n.feature)||void 0===y?void 0:y.getAttribute(b.name))&&void 0!==h?h:null,C=null!==(m=o.get(b))&&void 0!==m?m:new de.Z({field:b,preservesValueWhenHidden:null===(g=this.formTemplate)||void 0===g?void 0:g.preserveFieldValuesWhenHidden});f.push(C.set((0,a.Z)((0,a.Z)({},n),{},{value:_}))),o.delete(b)}}catch(V){v.e(V)}finally{v.f()}var k,x=(0,i.Z)(o.entries());try{for(x.s();!(k=x.n()).done;){var Z=(0,l.Z)(k.value,2),w=Z[0],F=Z[1];o.delete(w),F.destroy()}}catch(V){x.e(V)}finally{x.f()}return f}},{key:"_resetFieldInputValues",value:function(e){var t,n=(0,i.Z)(this.allFieldInputs);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.value=e.getAttribute(r.name)}}catch(a){n.e(a)}finally{n.f()}}},{key:"_makeInputFromElement",value:function(e,t,n){return(0,F.ah)(e)?function(e,t){var n=t.feature,r=t.layer;return new Fe({element:e,inputs:[],feature:n,layer:r})}(e,t):(0,F.fY)(e)?this._makeFieldInputFromElement(e,t,n):(0,F.V2)(e)?this._makeRelationshipInputFromElement(e,t,n):(0,F.iB)(e)?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.feature,i=t.layer,a=t.timeZone;return new Ge({element:e,feature:r,group:n,layer:i,timeZone:a})}(e,t):(0,h.Bg)()}},{key:"_makeFieldInputFromElement",value:function(e,t,n){var r,i,a=t.arcadeEditType,o=t.feature,l=t.initialFeature,u=t.layer,s=t.timeZone,c=e.fieldName,d=c&&this._layerFieldsByName.get(c);return d?new de.Z({arcadeEditType:a,element:e,field:d,value:null!==(r=null===o||void 0===o?void 0:o.getAttribute(e.fieldName))&&void 0!==r?r:null,feature:o,initialFeature:l,layer:u,group:n,preservesValueWhenHidden:null===(i=this.formTemplate)||void 0===i?void 0:i.preserveFieldValuesWhenHidden,timeZone:s}):null}},{key:"_makeRelationshipInputFromElement",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this.map,a=t.feature,o=t.layer,l=t.timeZone,u=new Se({element:e,feature:a,group:r,layer:o,map:i,timeZone:l});return u.addHandles((0,_.on)((function(){return u.relatedLayer}),"edits",(function(){var e;return null===(e=n._expressionsManager)||void 0===e?void 0:e.evaluateAsyncExpressions()}))),u}},{key:"_assignExpressionExecutors",value:function(e,t,n){var a,o=this,l=Be[t.type],u=[],s=(0,i.Z)(l);try{var c=function(){var r=a.value,i="".concat(r,"Executor");if(e[i])return o._useExecutor(e[i]),"continue";var l=t[r];if(null!=l&&""!==l){var s,c,d=null!==(s=null===(c=o._expressionInfosLookup.get(l))||void 0===c?void 0:c.expression)&&void 0!==s?s:l;u.push(o._getOrCreateExecutorForExpression(d,n).then((function(t){e[i]=o._useExecutor(t)})))}};for(s.s();!(a=s.n()).done;)c()}catch(d){s.e(d)}finally{s.f()}return(0,q.Wh)(e)&&u.push.apply(u,(0,r.Z)(this._assignTextElementExpressionExecutors(e,n))),u}},{key:"_assignTextElementExpressionExecutors",value:function(e,t){var n,r=this,a=this._expressionInfosLookup,o=[],l=(0,i.Z)(e.expressionsUsed);try{var u=function(){var i=n.value,l=a.get(i);null!=l?o.push(r._getOrCreateExecutorForExpression(l.expression,t).then((function(t){return e.setExpressionExecutor(i,r._useExecutor(t))}))):m.Z.getLogger(r).error("feature-form:expression-not-found","Could not find expressionInfo object with name '".concat(i,"'"))};for(l.s();!(n=l.n()).done;)u()}catch(p){l.e(p)}finally{l.f()}var s,c=(0,i.Z)(e.fieldsUsed);try{var d=function(){var n=s.value,i="return $feature['".concat(n,"'];");o.push(r._getOrCreateExecutorForExpression(i,t).then((function(t){return e.setFieldExecutor(n,r._useExecutor(t))})))};for(c.s();!(s=c.n()).done;)d()}catch(p){c.e(p)}finally{c.f()}return o}},{key:"_getOrCreateExecutorForExpression",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(t,n){var r,i,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this._expressionExecutorLookup).has(t)){e.next=3;break}return e.abrupt("return",r.get(t));case 3:if(!n.has(t)){e.next=5;break}return e.abrupt("return",n.get(t));case 5:return i=ye(t,this.layer),n.set(t,i),e.next=9,i;case 9:return a=e.sent,e.abrupt("return",(r.set(t,a),a));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_createExpressionsManager",value:function(e){var t=this._arcadeContextInfo,n=this._featureClone,r=this.allFieldInputs,i=this.formTemplate;this._expressionsManager=new be({executors:e,feature:n,arcadeContextInfo:t,fieldInputs:r,preserveFieldValuesWhenHidden:!0===(null===i||void 0===i?void 0:i.preserveFieldValuesWhenHidden)})}},{key:"_startExpressions",value:function(){var e=(0,u.Z)((0,o.Z)().mark((function e(){var t,n=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this._expressionExecutorsInUse.size){e.next=2;break}return e.abrupt("return");case 2:return t=Array.from(this._expressionExecutorsInUse),this._createExpressionsManager(t),e.next=6,this._expressionsManager.evaluateAll().finally((function(){return n._afterExpressionsEvaluated()}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_stopExpressions",value:function(){this._expressionsManager=(0,g.SC)(this._expressionsManager),this._expressionExecutorsInUse.clear()}},{key:"_useExecutor",value:function(e){return this._expressionExecutorsInUse.add(e),e}},{key:"_afterValueChange",value:function(e){var t=e.name,n=e.value,r=this._featureClone,a=this.formTemplate,o=this.layer;if(o){var l=r.getAttribute(t);r.setAttribute(t,n);var u=(0,q.ZP)(o),s=u.typeFieldName,c=u.types;if((e.isSubtypeField||t===s)&&n!==l){if("subtype-sublayer"===o.type){var d,p=null===(d=o.parent)||void 0===d?void 0:d.findSublayerForFeature(r);r.sourceLayer=this.feature.sourceLayer=p}var f,v=new Set,h=(0,i.Z)(c);try{for(h.s();!(f=h.n()).done;){var y=f.value;if(y.domains&&"object"==typeof y.domains)for(var m=0,g=Object.keys(y.domains);m<g.length;m++){var b=g[m];v.add(b)}}}catch(V){h.e(V)}finally{h.f()}var _,k=(0,i.Z)(v);try{for(k.s();!(_=k.n()).done;){var x=_.value,Z=this.findField(x);Z&&Z.notifyChange("domain")}}catch(V){k.e(V)}finally{k.f()}this.notifyChange("joinedContingentValues")}if(null!=a){var w=a.description,F=a.title;F&&(0,C.pZ)(F,t)&&this.notifyChange("formTitle"),w&&(0,C.pZ)(w,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}}},{key:"_afterExpressionsEvaluated",value:function(){var e,t=this._featureClone,n=(0,i.Z)(this.allFieldInputs);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.value!==t.getAttribute(r.name)&&this._afterValueChange(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"_joinContingentValues",value:function(){var e=this,t=this._contingentValuesCache;if(null==t)return[];var n,a=(0,q.ZP)(this.layer).typeFieldName,o=a?this.getValue(a):null,u=[],s=(0,i.Z)(t.fieldGroups);try{for(s.s();!(n=s.n()).done;){var c,d=n.value,p=d.contingencies,f=d.fields,v=d.name,h=[],y=(0,i.Z)(p);try{for(y.s();!(c=y.n()).done;){var m=c.value;m.isRetired||null!=m.subtype&&m.subtype.code!==o||h.push({values:m.values})}}catch(k){y.e(k)}finally{y.f()}h.length>0&&u.push({name:v,fields:f,contingencies:h})}}catch(k){s.e(k)}finally{s.f()}var g=this._generateJoinPlan(u),b=(0,l.Z)(g,2),_=b[0],C=b[1];return[].concat((0,r.Z)(_.flatMap((function(t){return e._joinFieldGroupContingencies(t)}))),(0,r.Z)(C.flatMap((function(e){return e.contingencies}))))}},{key:"_generateJoinPlan",value:function(e){var t,n=new Map,a=[],o=new Set,u=(0,i.Z)(e);try{for(u.s();!(t=u.n()).done;){var s,c=t.value,d=(0,i.Z)(c.fields);try{for(d.s();!(s=d.n()).done;){var p=s.value;if(n.has(p)){var f=n.get(p),v=c,h=[f.name,v.name].sort().join("|");if(o.has(h))continue;a.push([f,v]),o.add(h),n.set(p,v)}else n.set(p,c)}}catch(j){d.e(j)}finally{d.f()}}}catch(j){u.e(j)}finally{u.f()}var y,m=new Set(a.flat()),g=new Set(e),b=(0,i.Z)(m);try{for(b.s();!(y=b.n()).done;){var _=y.value;g.delete(_)}}catch(j){b.e(j)}finally{b.f()}var C,k=new Map,x=new Map,Z=(0,i.Z)(new Set(a.flat()));try{for(Z.s();!(C=Z.n()).done;){var w=C.value,F=Symbol(w.name);k.set(F,new Set([w])),x.set(w,F)}}catch(j){Z.e(j)}finally{Z.f()}for(var V=0,I=a;V<I.length;V++){var E=(0,l.Z)(I[V],2),R=E[0],T=E[1],A=x.get(R),S=x.get(T);if(A!==S){var O,M=k.get(A),L=k.get(S),N=(0,i.Z)(L);try{for(N.s();!(O=N.n()).done;){var D=O.value;M.add(D),x.set(D,A)}}catch(j){N.e(j)}finally{N.f()}k.delete(S)}}return[(0,r.Z)(k.values()).map((function(e){return(0,r.Z)(e)})),(0,r.Z)(g)]}},{key:"_joinFieldGroupContingencies",value:function(e){var t,n=e.slice(),a=n.shift(),o=n.shift(),u=this._generateJoinKey(a.fields,o.fields),s=new Set([].concat((0,r.Z)(a.fields),(0,r.Z)(o.fields))),c=new Map,d=(0,i.Z)(a.contingencies);try{for(d.s();!(t=d.n()).done;){var p,f=t.value,v=this._hashContingency(f,u.codedValueFields,!0),h=(0,l.Z)(v,1)[0];c.has(h)?null===(p=c.get(h))||void 0===p||p.push(f):c.set(h,[f])}}catch(z){d.e(z)}finally{d.f()}for(;n.length>0;){var y,m=new Map,g=n.shift(),b=this._generateJoinKey(s,g.fields),_=(0,i.Z)(o.contingencies);try{for(_.s();!(y=_.n()).done;){var C=y.value,k=this._hashContingency(C,u.codedValueFields),x=(0,l.Z)(k,2),Z=x[0],w=x[1]?this._findMatchingContingenciesWithAnyHashMask(c,Z):c.get(Z);if(c.has(We)&&null!==w&&void 0!==w&&w.push.apply(w,(0,r.Z)(this._findMatchingContingenciesContainingAny(C,c.get(We),u.codedValueFields))),null!=w){var F,V=(0,i.Z)(w);try{for(V.s();!(F=V.n()).done;){var I,E=F.value,R=u.rangeFields.length>0?this._joinContingenciesWithRangeDomains(E,C,u.rangeFields):this._joinContingencies(E,C);if(null==R)break;var T=this._hashContingency(R,b.codedValueFields,!0),A=(0,l.Z)(T,1)[0];m.has(A)?null===(I=m.get(A))||void 0===I||I.push(R):m.set(A,[R])}}catch(z){V.e(z)}finally{V.f()}}}}catch(z){_.e(z)}finally{_.f()}c=m,o=g,u=b,s=new Set([].concat((0,r.Z)(s),(0,r.Z)(o.fields)))}var S,O=[],M=(0,i.Z)(o.contingencies);try{for(M.s();!(S=M.n()).done;){var L=S.value,N=this._hashContingency(L,u.codedValueFields),D=(0,l.Z)(N,2),j=D[0],P=D[1]?this._findMatchingContingenciesWithAnyHashMask(c,j):c.get(j);if(c.has(We)&&P.push.apply(P,(0,r.Z)(this._findMatchingContingenciesContainingAny(L,c.get(We),u.codedValueFields))),null!=P){var H,G=(0,i.Z)(P);try{for(G.s();!(H=G.n()).done;){var U=H.value,B=u.rangeFields.length>0?this._joinContingenciesWithRangeDomains(U,L,u.rangeFields):this._joinContingencies(U,L);null!=B&&O.push(B)}}catch(z){G.e(z)}finally{G.f()}}}}catch(z){M.e(z)}finally{M.f()}return O}},{key:"_joinContingencies",value:function(e,t){for(var n={values:(0,a.Z)((0,a.Z)({},e.values),t.values)},r=0,i=Object.entries(n.values);r<i.length;r++){var o=(0,l.Z)(i[r],2),u=o[0];"any"===o[1].objectType&&null!=e.values[u]&&(n.values[u]=e.values[u])}return n}},{key:"_joinContingenciesWithRangeDomains",value:function(e,t,n){var r,a=this._joinContingencies(e,t),o=(0,i.Z)(n);try{for(o.s();!(r=o.n()).done;){var l=r.value,u=e.values[l],s=t.values[l],c=this._compareObjectTypes(u.objectType,s.objectType),d=c.leftIsNull,p=c.rightIsNull,f=c.bothAreNull,v=c.leftIsAny,h=c.rightIsAny,y=c.bothAreAny,m=c.leftIsRange,g=c.rightIsRange;if(!f&&!y)if(d&&h||p&&v)a.values[l]=new E({objectType:"null"});else{if(d&&g||p&&m)return null;v?(u.minValue=-1/0,u.maxValue=1/0):h&&(s.minValue=-1/0,s.maxValue=1/0);var b=Math.max(u.minValue,s.minValue),_=Math.min(u.maxValue,s.maxValue);if(b>_)return null;a.values[l]=new E({objectType:"range",minValue:b,maxValue:_})}}}catch(C){o.e(C)}finally{o.f()}return a}},{key:"_findMatchingContingenciesContainingAny",value:function(e,t,n){return t.filter((function(t){return n.every((function(n){var r,i,a=t.values[n],o=e.values[n];return"any"===a.objectType||"any"===o.objectType||(null===(r=a.codedValue)||void 0===r?void 0:r.code)===(null===(i=o.codedValue)||void 0===i?void 0:i.code)}))}))}},{key:"_findMatchingContingenciesWithAnyHashMask",value:function(e,t){var n,a=RegExp("".concat(t,"$")),o=[],u=(0,i.Z)(e);try{for(u.s();!(n=u.n()).done;){var s=(0,l.Z)(n.value,2),c=s[0],d=s[1];if(c===We)break;a.test(c)&&o.push.apply(o,(0,r.Z)(d))}}catch(p){u.e(p)}finally{u.f()}return o}},{key:"_generateJoinKey",value:function(e,t){var n,a=Array.isArray(e)?new Set(e):e,o=Array.isArray(t)?new Set(t):t,l=a.size<o.size?a:o,u=l===a?o:a,s=new Set,c=new Set,d=(0,i.Z)(l);try{for(d.s();!(n=d.n()).done;){var p=n.value;if(u.has(p)){var f,v=null===(f=this.layer)||void 0===f?void 0:f.getFieldDomain(p,{feature:this.feature});if(null==v)continue;switch(v.type){case"coded-value":s.add(p);break;case"range":c.add(p)}}}}catch(h){d.e(h)}finally{d.f()}return{codedValueFields:(0,r.Z)(s),rangeFields:(0,r.Z)(c)}}},{key:"_contingencyIsValid",value:function(e,t){var n,r={},a=(0,i.Z)(this.allFieldInputs);try{for(a.s();!(n=a.n()).done;){var o=n.value,u=o.name,s=o.value;this.fieldsWithContingentValues.has(u)&&null!=s&&u!==e&&(r[u]=s)}}catch(c){a.e(c)}finally{a.f()}return Object.entries(r).every((function(e){var n=(0,l.Z)(e,2),r=n[0],i=n[1];return!t.values.hasOwnProperty(r)||(0,q.zN)(i,t.values[r])}))}},{key:"_getContingentValueOptionsForField",value:function(e,t){var n,a=this.joinedContingentValues.slice(),o=new Map,l={code:"",name:null!==t&&void 0!==t?t:"No value"},u=(0,i.Z)(a);try{for(u.s();!(n=u.n()).done;){var s=n.value,c=s.values[e];if("code"===(null===c||void 0===c?void 0:c.objectType)||"null"===(null===c||void 0===c?void 0:c.objectType)){var d=c.codedValue&&"null"!==c.objectType?c.codedValue:l,p=d.code,f=d.name;!o.has(p)&&this._contingencyIsValid(e,s)&&o.set(p,{name:f,value:p})}}}catch(v){u.e(v)}finally{u.f()}return(0,r.Z)(o.values())}},{key:"_hashContingency",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.length<1)return[ze,!1];var r,a=[],o=!1,l=(0,i.Z)(t);try{for(l.s();!(r=l.n()).done;){var u,s=r.value,c=e.values[s];if("any"===c.objectType){if(n)return[We,!0];o=!0,a.push("".concat(s,":.*"))}else"null"===c.objectType?a.push("".concat(s,":").concat(qe)):a.push("".concat(s,":").concat(null===(u=c.codedValue)||void 0===u?void 0:u.code))}}catch(d){l.e(d)}finally{l.f()}return[a.sort().join("&"),o]}},{key:"_compareObjectTypes",value:function(e,t){return{leftIsNull:"null"===e,rightIsNull:"null"===t,bothAreNull:"null"===e&&"null"===t,leftIsAny:"any"===e,rightIsAny:"any"===t,bothAreAny:"any"===e&&"any"===t,leftIsRange:"range"===e,rightIsRange:"range"===t}}}]),n}((0,b.v)(y.Z.EventedAccessor));function Qe(e){return"field"===e.type||"group"===e.type||"relationship"===e.type||"text"===e.type||(Je().warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported","Element ".concat(e.label," has unsupported type '").concat(e.type,"'")),!1)}(0,f._)([(0,k.Cb)()],Ke.prototype,"_expressionInfosLookup",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"_featureClone",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"_timeZone",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"activeRelationshipInput",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"_arcadeContextInfo",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"allFieldInputs",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"allGroupInputs",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"allRelationshipInputs",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"_layerFieldsByName",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"arcadeEditType",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"contingencyConstraintViolations",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"disabled",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"feature",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"fieldsWithContingentValues",null),(0,f._)([(0,k.Cb)({type:w.Z})],Ke.prototype,"formTemplate",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"formDescription",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"formTitle",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"formHeaderVisible",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"highlightHelper",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"inputs",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"joinedContingentValues",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"layer",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"map",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"relatedRecordCallbacks",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"relationshipId",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"spatialReference",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"state",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"strict",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"submittable",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"timeZone",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"updating",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"valid",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"hasPendingSubtypeChoice",void 0),(0,f._)([(0,k.Cb)()],Ke.prototype,"getValues",null),(0,f._)([(0,k.Cb)()],Ke.prototype,"submit",null);var Ye=Ke=(0,f._)([(0,x.j)($e)],Ke)}}]);
//# sourceMappingURL=76385.a87397c7.chunk.js.map