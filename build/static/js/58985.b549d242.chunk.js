"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[58985],{87072:function(e,t,r){function n(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?o(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?o(e,t.floorInfo.floorField):null}function o(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{c:function(){return n},f:function(){return i}})},58132:function(e,t,r){r.d(t,{FN:function(){return a},QV:function(){return o},ac:function(){return l}});var n=r(37762),i=r(25265);function o(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!u(e,t))}function a(e,t,r){return!!e.some((function(e){var t=e.source,n=!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(null==t.gdbVersion||t.gdbVersion===r);return e.commitProperty("renderer"),e.commitProperty("labelingInfo"),e.commitProperty("opacity"),e.commitProperty("labelsVisible"),!n||e.originIdOf("renderer")>i.s3.SERVICE||e.originIdOf("labelingInfo")>i.s3.SERVICE||e.originIdOf("opacity")>i.s3.SERVICE||e.originIdOf("labelsVisible")>i.s3.SERVICE}))||!u(e,t)}function u(e,t){if(null===e||void 0===e||!e.length||null==t)return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;var i,o=0,a=r.length,u=(0,n.Z)(e);try{for(u.s();!(i=u.n()).done;){for(var l=i.value.id;o<a&&r[o]!==l;)o++;if(o>=a)return!1}}catch(s){u.e(s)}finally{u.f()}return!0}function l(e){return!!e&&e.some((function(e){var t;return null!=e.minScale||null!=(null===(t=e.layerDefinition)||void 0===t?void 0:t.minScale)}))}},96669:function(e,t,r){function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function i(e,t){var r;return"number"==typeof e?e:null!==e&&void 0!==e&&null!==(r=e.stops)&&void 0!==r&&r.length?function(e){for(var t=0,r=0,n=0;n<e.length;n++){var i=e[n].size;"number"==typeof i&&(t+=i,r++)}return t/r}(e.stops):t}function o(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,n=t.minSize;return(i(r,e)+i(n,e))/2})),n=0,o=r.length;if(0===o)return e;for(var a=0;a<o;a++)n+=r[a];var u=Math.floor(n/o);return Math.max(u,e)}function a(e){var t=null===e||void 0===e?void 0:e.renderer,r="touch"===(null===e||void 0===e?void 0:e.pointerType)?9:6;if(!t)return r;var i="visualVariables"in t?o(r,t.visualVariables):r;if("simple"===t.type)return n(i,t.symbol);if("unique-value"===t.type){var a,u=i;return null!==(a=t.uniqueValueInfos)&&void 0!==a&&a.forEach((function(e){u=n(u,e.symbol)})),u}if("class-breaks"===t.type){var l=i;return t.classBreakInfos.forEach((function(e){l=n(l,e.symbol)})),l}return"dot-density"===t.type||t.type,i}r.d(t,{k:function(){return a}})},13107:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(15671),i=r(43144),o=r(60136),a=r(29388),u=r(27366),l=r(32718),s=r(66978),c=r(94172),f=(r(93169),r(84936),r(10064),r(69912)),p=function(e){var t=function(e){(0,o.Z)(r,e);var t=(0,a.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.addHandles((0,c.on)((function(){return e.layer}),"refresh",(function(t){e.doRefresh(t.dataChanged).catch((function(t){(0,s.D_)(t)||l.Z.getLogger(e).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return t=(0,u._)([(0,f.j)("esri.views.layers.RefreshableLayerView")],t)}},32645:function(e,t,r){r.d(t,{VF:function(){return ce},Uf:function(){return se}});var n=r(1413),i=r(93433),o=r(29439),a=r(37762),u=r(74165),l=r(15861),s=r(15671),c=r(43144),f=r(60136),p=r(29388),d=r(27366),y=r(52639),h=r(7138),v=r(63780),m=r(80987),b=r(10064),g=r(42537),x=r(93169),w=r(77427),Z=r(66978),I=r(94172),_=r(76672),k=r(68860),S=r(49861),F=(r(32718),r(69912)),E=r(53866),C=r(82582),O=r(37270),R=r(87072),V=r(96669),P=r(76200),j=r(91340),M=r(23084),N=r(77981),T=r(92975),G=r(58132);function L(e,t){var r,n=e.toJSON(),i=n.dpi,o=n.gdbVersion,a=n.geometry,u=n.geometryPrecision,l=n.height,s=n.historicMoment,c=n.layerOption,f=n.mapExtent,p=n.maxAllowableOffset,d=n.returnFieldName,y=n.returnGeometry,h=n.returnUnformattedValues,v=n.returnZ,m=n.spatialReference,b=n.timeExtent,g=n.tolerance,x=n.width,w=A(e),Z=w.dynamicLayers,I=w.layerDefs,_=w.layerIds,k=null!=(null===t||void 0===t?void 0:t.geometry)?t.geometry:null,S={historicMoment:s,geometryPrecision:u,maxAllowableOffset:p,returnFieldName:d,returnGeometry:y,returnUnformattedValues:h,returnZ:v,tolerance:g},F=(null===k||void 0===k?void 0:k.toJSON())||a;S.imageDisplay="".concat(x,",").concat(l,",").concat(i),o&&(S.gdbVersion=o),F&&(delete F.spatialReference,S.geometry=JSON.stringify(F),S.geometryType=(0,N.Ji)(F));var E=null!==(r=null!==m&&void 0!==m?m:null===F||void 0===F?void 0:F.spatialReference)&&void 0!==r?r:null===f||void 0===f?void 0:f.spatialReference;if(E&&(S.sr=(0,T.B9)(E)),S.time=b?[b.start,b.end].join(","):null,f){var C=f.xmin,O=f.ymin,R=f.xmax,V=f.ymax;S.mapExtent="".concat(C,",").concat(O,",").concat(R,",").concat(V)}return I&&(S.layerDefs=I),Z&&!I&&(S.dynamicLayers=Z),S.layers="popup"===c?"visible":c,_&&!Z&&(S.layers+=":".concat(_.join(","))),S}function A(e){var t,r,n=e.mapExtent,i=e.floors,o=e.width,u=e.sublayers,l=e.layerIds,s=e.layerOption,c=e.gdbVersion,f=null===u||void 0===u||null===(t=u.find((function(e){return null!=e.layer})))||void 0===t||null===(r=t.layer)||void 0===r?void 0:r.serviceSublayers,p="popup"===s,d={},y=(0,C.yZ)({extent:n,width:o,spatialReference:null===n||void 0===n?void 0:n.spatialReference}),h=[];if(null!==u&&void 0!==u&&u.forEach((function e(t){var r=0===y,n=0===t.minScale||y<=t.minScale,i=0===t.maxScale||y>=t.maxScale;if(t.visible&&(r||n&&i))if(t.sublayers)t.sublayers.forEach(e);else{if(!1===(null===l||void 0===l?void 0:l.includes(t.id))||p&&(!t.popupTemplate||!t.popupEnabled))return;h.unshift(t)}})),u&&!h.length)d.layerIds=[];else{var v=(0,G.FN)(h,f,c),m=h.map((function(e){var t=(0,R.f)(i,e);return e.toExportImageJSON(t)}));if(v)d.dynamicLayers=JSON.stringify(m);else{if(u){var b=h.map((function(e){return e.id}));l&&(b=b.filter((function(e){return l.includes(e)}))),d.layerIds=b}else(null===l||void 0===l?void 0:l.length)&&(d.layerIds=l);var g=function(e,t){var r=!(null===e||void 0===e||!e.length),n=t.filter((function(e){return null!=e.definitionExpression||r&&null!=e.floorInfo}));return n.length?n.map((function(t){var r=(0,R.f)(e,t),n=(0,_._)(r,t.definitionExpression);return{id:t.id,definitionExpression:null!==n&&void 0!==n?n:void 0}})):null}(i,h);if(null!=g&&g.length){var x,w={},Z=(0,a.Z)(g);try{for(Z.s();!(x=Z.n()).done;){var I=x.value;I.definitionExpression&&(w[I.id]=I.definitionExpression)}}catch(k){Z.e(k)}finally{Z.f()}Object.keys(w).length&&(d.layerDefs=JSON.stringify(w))}}}return d}var U,H=r(59486),q=r(62044),z=r(46784),Q=r(25243),J=(r(84936),r(31201)),B=r(78952),D=U=function(e){(0,f.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).dpi=96,n.floors=null,n.gdbVersion=null,n.geometry=null,n.geometryPrecision=null,n.height=400,n.historicMoment=null,n.layerIds=null,n.layerOption="top",n.mapExtent=null,n.maxAllowableOffset=null,n.returnFieldName=!0,n.returnGeometry=!1,n.returnM=!1,n.returnUnformattedValues=!0,n.returnZ=!1,n.spatialReference=null,n.sublayers=null,n.timeExtent=null,n.tolerance=null,n.width=400,n}return(0,c.Z)(r,[{key:"writeHistoricMoment",value:function(e,t){t.historicMoment=e&&e.getTime()}}],[{key:"from",value:function(e){return(0,Q.TJ)(U,e)}}]),r}(z.wq);(0,d._)([(0,S.Cb)({type:Number,json:{write:!0}})],D.prototype,"dpi",void 0),(0,d._)([(0,S.Cb)()],D.prototype,"floors",void 0),(0,d._)([(0,S.Cb)({type:String,json:{write:!0}})],D.prototype,"gdbVersion",void 0),(0,d._)([(0,S.Cb)({types:H.qM,json:{read:N.im,write:!0}})],D.prototype,"geometry",void 0),(0,d._)([(0,S.Cb)({type:Number,json:{write:!0}})],D.prototype,"geometryPrecision",void 0),(0,d._)([(0,S.Cb)({type:Number,json:{write:!0}})],D.prototype,"height",void 0),(0,d._)([(0,S.Cb)({type:Date})],D.prototype,"historicMoment",void 0),(0,d._)([(0,J.c)("historicMoment")],D.prototype,"writeHistoricMoment",null),(0,d._)([(0,S.Cb)({type:[Number],json:{write:!0}})],D.prototype,"layerIds",void 0),(0,d._)([(0,S.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],D.prototype,"layerOption",void 0),(0,d._)([(0,S.Cb)({type:E.Z,json:{write:!0}})],D.prototype,"mapExtent",void 0),(0,d._)([(0,S.Cb)({type:Number,json:{write:!0}})],D.prototype,"maxAllowableOffset",void 0),(0,d._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnFieldName",void 0),(0,d._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnGeometry",void 0),(0,d._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnM",void 0),(0,d._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnUnformattedValues",void 0),(0,d._)([(0,S.Cb)({type:Boolean,json:{write:!0}})],D.prototype,"returnZ",void 0),(0,d._)([(0,S.Cb)({type:B.Z,json:{write:!0}})],D.prototype,"spatialReference",void 0),(0,d._)([(0,S.Cb)()],D.prototype,"sublayers",void 0),(0,d._)([(0,S.Cb)({type:q.Z,json:{write:!0}})],D.prototype,"timeExtent",void 0),(0,d._)([(0,S.Cb)({type:Number,json:{write:!0}})],D.prototype,"tolerance",void 0),(0,d._)([(0,S.Cb)({type:Number,json:{write:!0}})],D.prototype,"width",void 0);var K=D=U=(0,d._)([(0,F.j)("esri.rest.support.IdentifyParameters")],D),W=r(38511),X=r(27823),Y=function(e){(0,f.Z)(r,e);var t=(0,p.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).displayFieldName=null,n.feature=null,n.layerId=null,n.layerName=null,n}return(0,c.Z)(r,[{key:"readFeature",value:function(e,t){return y.Z.fromJSON({attributes:(0,n.Z)({},t.attributes),geometry:(0,n.Z)({},t.geometry)})}},{key:"writeFeature",value:function(e,t){if(e){var r=e.attributes,i=e.geometry;r&&(t.attributes=(0,n.Z)({},r)),null!=i&&(t.geometry=i.toJSON(),t.geometryType=X.P.toJSON(i.type))}}}]),r}(z.wq);(0,d._)([(0,S.Cb)({type:String,json:{write:!0}})],Y.prototype,"displayFieldName",void 0),(0,d._)([(0,S.Cb)({type:y.Z})],Y.prototype,"feature",void 0),(0,d._)([(0,W.r)("feature",["attributes","geometry"])],Y.prototype,"readFeature",null),(0,d._)([(0,J.c)("feature")],Y.prototype,"writeFeature",null),(0,d._)([(0,S.Cb)({type:Number,json:{write:!0}})],Y.prototype,"layerId",void 0),(0,d._)([(0,S.Cb)({type:String,json:{write:!0}})],Y.prototype,"layerName",void 0);var $=Y=(0,d._)([(0,F.j)("esri.rest.support.IdentifyResult")],Y);function ee(e,t,r){return te.apply(this,arguments)}function te(){return te=(0,l.Z)((0,u.Z)().mark((function e(t,r,i){var o,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(r=ne(r)).geometry?[r.geometry]:[],a=(0,M.en)(t),e.abrupt("return",(a.path+="/identify",(0,j.aX)(o).then((function(e){var t=L(r,{geometry:null===e||void 0===e?void 0:e[0]}),o=(0,M.cv)((0,n.Z)((0,n.Z)({},a.query),{},{f:"json"},t)),u=(0,M.lA)(o,i);return(0,P.Z)(a.path,u).then(re).then((function(e){return ie(e,r.sublayers)}))}))));case 2:case"end":return e.stop()}}),e)}))),te.apply(this,arguments)}function re(e){var t=e.data;return t.results=t.results||[],t.exceededTransferLimit=Boolean(t.exceededTransferLimit),t.results=t.results.map((function(e){return $.fromJSON(e)})),t}function ne(e){return K.from(e)}function ie(e,t){if(null===t||void 0===t||!t.length)return e;var r=new Map;t.forEach((function e(t){r.set(t.id,t),t.sublayers&&t.sublayers.forEach(e)}));var n,i=(0,a.Z)(e.results);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.feature.sourceLayer=r.get(o.layerId)}}catch(u){i.e(u)}finally{i.f()}return e}var oe=r(819),ae=r(16072),ue=r(24405),le=null;function se(e,t){return"tile"===t.type||"map-image"===t.type}var ce=function(e){(0,f.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e))._featuresResolutions=new WeakMap,r.highlightGraphics=null,r.highlightGraphicUpdated=null,r.updateHighlightedFeatures=(0,Z.Ds)(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.destroyed||r.updatingHandles.addPromise(r._updateHighlightedFeaturesGeometries(t).catch((function(){})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this,t=function(t){e.updatingHandles.addPromise(e._updateHighlightedFeaturesSymbols(t).catch((function(){}))),e.updateHighlightedFeatures(e._highlightGeometriesResolution)};this.addHandles([(0,I.on)((function(){return e.highlightGraphics}),"change",(function(e){return t(e.added)}),{onListenerAdd:function(e){return t(e)}})])}},{key:"fetchPopupFeaturesAtLocation",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,i,o,a,l,s,c,f;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.layerView,l=a.layer,s=a.view.scale,t){e.next=3;break}throw new b.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:l});case 3:if((c=fe(l.sublayers,s,r)).length){e.next=6;break}return e.abrupt("return",[]);case 6:return e.next=8,de(l,c);case 8:if(f=e.sent,(null===(n=null===(i=l.capabilities)||void 0===i||null===(o=i.operations)||void 0===o?void 0:o.supportsIdentify)||void 0===n||n)&&l.version>=10.5||f){e.next=11;break}throw new b.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:l});case 11:return e.abrupt("return",f?this._fetchPopupFeaturesUsingQueries(t,c,r):this._fetchPopupFeaturesUsingIdentify(t,c,r));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"clearHighlights",value:function(){var e;null===(e=this.highlightGraphics)||void 0===e||e.removeAll()}},{key:"highlight",value:function(e){var t,r,n=this.highlightGraphics;if(!n)return(0,g.kB)();var i=null;if(e instanceof y.Z?i=[e]:m.Z.isCollection(e)&&e.length>0?i=e.toArray():Array.isArray(e)&&e.length>0&&(i=e),null===(r=i=null===(t=i)||void 0===t?void 0:t.filter(v.pC))||void 0===r||!r.length)return(0,g.kB)();var o,u=(0,a.Z)(i);try{for(u.s();!(o=u.n()).done;){var l=o.value,s=l.sourceLayer;null!=s&&"geometryType"in s&&"point"===s.geometryType&&(l.visible=!1)}}catch(c){u.e(c)}finally{u.f()}return n.addMany(i),(0,g.kB)((function(){var e;return n.removeMany(null!==(e=i)&&void 0!==e?e:[])}))}},{key:"_updateHighlightedFeaturesSymbols",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var n,i,o,s,c,f;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layerView.view,i=this.highlightGraphics,o=this.highlightGraphicUpdated,i&&o){s=(0,a.Z)(t);try{for(f=function(){var e=c.value,t=e.sourceLayer&&"renderer"in e.sourceLayer&&e.sourceLayer.renderer;e.sourceLayer&&"geometryType"in e.sourceLayer&&"point"===e.sourceLayer.geometryType&&t&&"getSymbolAsync"in t&&t.getSymbolAsync(e).then(function(){var a=(0,l.Z)((0,u.Z)().mark((function a(l){var s,c,f;return(0,u.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(l||(l=new ae.default),c=null,f="visualVariables"in t?null===(s=t.visualVariables)||void 0===s?void 0:s.find((function(e){return"size"===e.type})):void 0,a.t0=f,!a.t0){a.next=11;break}if(a.t1=le,a.t1){a.next=10;break}return a.next=9,Promise.resolve().then(r.bind(r,56011));case 9:le=a.sent.getSize;case 10:c=le(f,e,{view:n.type,scale:n.scale,shape:"simple-marker"===l.type?l.style:null});case 11:c||(c="width"in l&&"height"in l&&null!=l.width&&null!=l.height?Math.max(l.width,l.height):"size"in l?l.size:16),i.includes(e)&&(e.symbol=new ae.default({style:"square",size:c,xoffset:"xoffset"in l?l.xoffset:0,yoffset:"yoffset"in l?l.yoffset:0}),o(e,"symbol"),e.visible=!0);case 13:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},s.s();!(c=s.n()).done;)f()}catch(p){s.e(p)}finally{s.f()}}case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateHighlightedFeaturesGeometries",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n,l,s,c,f,p,d,y,h,v,m,b,g,x,Z,I,_,k,S,F;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layerView,n=r.layer,l=r.view,s=this.highlightGraphics,c=this.highlightGraphicUpdated,this._highlightGeometriesResolution=t,c&&null!==s&&void 0!==s&&s.length&&n.capabilities.operations.supportsQuery){e.next=3;break}return e.abrupt("return");case 3:f=this._getTargetResolution(t),p=new Map,d=(0,a.Z)(s);try{for(d.s();!(y=d.n()).done;)h=y.value,(!this._featuresResolutions.has(h)||this._featuresResolutions.get(h)>f)&&(v=h.sourceLayer,(0,w.s1)(p,v,(function(){return new Map})).set(h.getObjectId(),h))}catch(u){d.e(u)}finally{d.f()}return m=Array.from(p,(function(e){var t=(0,o.Z)(e,2),r=t[0],n=t[1],a=r.createQuery();return a.objectIds=(0,i.Z)(n.keys()),a.outFields=[r.objectIdField],a.returnGeometry=!0,a.maxAllowableOffset=f,a.outSpatialReference=l.spatialReference,r.queryFeatures(a)})),e.next=9,Promise.all(m);case 9:if(b=e.sent,!this.destroyed){g=(0,a.Z)(b);try{for(g.s();!(x=g.n()).done;){Z=x.value.features,I=(0,a.Z)(Z);try{for(I.s();!(_=I.n()).done;)k=_.value,S=k.sourceLayer,(F=p.get(S).get(k.getObjectId()))&&s.includes(F)&&(F.geometry=k.geometry,c(F,"geometry"),this._featuresResolutions.set(F,f))}catch(u){I.e(u)}finally{I.f()}}}catch(u){g.e(u)}finally{g.f()}}case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getTargetResolution",value:function(e){var t=e*(0,k.c9)(this.layerView.view.spatialReference),r=t/16;return r<=10?0:e/t*r}},{key:"_fetchPopupFeaturesUsingIdentify",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var i,o,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createIdentifyParameters(t,r,n);case 2:if(null!=(i=e.sent)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,ee(this.layerView.layer.parsedUrl,i,n);case 7:return o=e.sent,a=o.results,e.abrupt("return",a.map((function(e){return e.feature})));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_createIdentifyParameters",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var i,o,a,l,s,c,f,p,d,y,h,v;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layerView,o=i.floors,a=i.layer,l=i.timeExtent,s=i.view,c=s.spatialReference,f=s.scale,r.length){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,Promise.all(r.map((function(e){return e.sublayer.load(n).catch((function(){}))})));case 5:return p=Math.min((0,x.Z)("mapservice-popup-identify-max-tolerance"),a.allSublayers.reduce((function(e,t){return t.renderer?(0,V.k)({renderer:t.renderer,pointerType:null===n||void 0===n?void 0:n.pointerType}):e}),2)),d=this.createFetchPopupFeaturesQueryGeometry(t,p),y=(0,C.dp)(f,c),h=Math.round(d.width/y),v=new E.Z({xmin:d.center.x-y*h,ymin:d.center.y-y*h,xmax:d.center.x+y*h,ymax:d.center.y+y*h,spatialReference:d.spatialReference}),e.abrupt("return",new K({floors:o,gdbVersion:"gdbVersion"in a?a.gdbVersion:void 0,geometry:t,height:h,layerOption:"popup",mapExtent:v,returnGeometry:!0,spatialReference:c,sublayers:a.sublayers,timeExtent:l,tolerance:p,width:h}));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_fetchPopupFeaturesUsingQueries",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var s,c,f,p,d=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.layerView,c=s.floors,f=s.timeExtent,p=r.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var i,l,s,p,y,h,v,m,b,g,x,w,I,k,S,F,E,C,P,j,M;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=r.sublayer,s=r.popupTemplate,e.next=3,l.load(n).catch((function(){}));case 3:if(!l.capabilities||l.capabilities.operations.supportsQuery){e.next=5;break}return e.abrupt("return",[]);case 5:return p=l.createQuery(),y=(0,V.k)({renderer:l.renderer,pointerType:null===n||void 0===n?void 0:n.pointerType}),h=d.createFetchPopupFeaturesQueryGeometry(t,y),v=new Set,e.next=11,Promise.all([(0,ue.e7)(l,s),null===(i=l.renderer)||void 0===i?void 0:i.collectRequiredFields(v,l.fieldsIndex)]);case 11:return m=e.sent,b=(0,o.Z)(m,1),g=b[0],(0,Z.k_)(n),(0,O.gd)(v,l.fieldsIndex,g),x=Array.from(v).sort(),p.geometry=h,p.outFields=x,p.timeExtent=f,w=(0,R.f)(c,l),p.where=(0,_._)(p.where,w),I=d._getTargetResolution(h.width/y),e.next=22,pe(s);case 22:return k=e.sent,(0,Z.k_)(n),(S="point"===l.geometryType||k&&k.arcadeUtils.hasGeometryOperations(s))||(p.maxAllowableOffset=I),e.next=28,l.queryFeatures(p,n);case 28:return F=e.sent,E=F.features,C=S?0:I,e.next=33,he(l,E,n);case 33:E=e.sent,P=(0,a.Z)(E);try{for(P.s();!(j=P.n()).done;)M=j.value,d._featuresResolutions.set(M,C)}catch(u){P.e(u)}finally{P.f()}return e.abrupt("return",E);case 37:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.allSettled(p);case 3:return e.abrupt("return",e.sent.reduce((function(e,t){return"fulfilled"===t.status?[].concat((0,i.Z)(e),(0,i.Z)(t.value)):e}),[]).filter(v.pC));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),n}(h.default);function fe(e,t,r){var i=[];if(!e)return i;return e.map((function e(o){var a=0===o.minScale||t<=o.minScale,u=0===o.maxScale||t>=o.maxScale;if(o.visible&&a&&u)if(o.sublayers)o.sublayers.forEach(e);else if(o.popupEnabled){var l=(0,ue.V5)(o,(0,n.Z)((0,n.Z)({},r),{},{defaultPopupTemplateEnabled:!1}));null!=l&&i.unshift({sublayer:o,popupTemplate:l})}})),i}function pe(e){var t;return null!==(t=e.expressionInfos)&&void 0!==t&&t.length||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type}))?(0,oe.LC)():Promise.resolve()}function de(e,t){return ye.apply(this,arguments)}function ye(){return(ye=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t.capabilities)||void 0===n||null===(i=n.operations)||void 0===i||!i.supportsQuery){e.next=2;break}return e.abrupt("return",!0);case 2:return e.prev=2,e.next=5,Promise.any(r.map((function(e){var t=e.sublayer;return t.load().then((function(){return t.capabilities.operations.supportsQuery}))})));case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function he(e,t,r){return ve.apply(this,arguments)}function ve(){return(ve=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.renderer,e.t0=i&&"defaultSymbol"in i&&!i.defaultSymbol,!e.t0){e.next=11;break}if(!i.valueExpression){e.next=9;break}return e.next=6,Promise.all(r.map((function(e){return i.getSymbolAsync(e,n).then((function(t){return t?e:null}))}))).then((function(e){return e.filter((function(e){return null!=e}))}));case 6:e.t1=e.sent,e.next=10;break;case 9:e.t1=r.filter((function(e){return null!=i.getSymbol(e)}));case 10:r=e.t1;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,d._)([(0,S.Cb)({constructOnly:!0})],ce.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,d._)([(0,S.Cb)({constructOnly:!0})],ce.prototype,"layerView",void 0),(0,d._)([(0,S.Cb)({constructOnly:!0})],ce.prototype,"highlightGraphics",void 0),(0,d._)([(0,S.Cb)({constructOnly:!0})],ce.prototype,"highlightGraphicUpdated",void 0),(0,d._)([(0,S.Cb)({constructOnly:!0})],ce.prototype,"updatingHandles",void 0),ce=(0,d._)([(0,F.j)("esri.views.layers.support.MapServiceLayerViewHelper")],ce)},24405:function(e,t,r){r.d(t,{V5:function(){return s},e7:function(){return u},zc:function(){return c}});var n=r(74165),i=r(93433),o=r(15861),a=r(37270);function u(e){return l.apply(this,arguments)}function l(){return l=(0,o.Z)((0,n.Z)().mark((function e(t){var r,o,u,l,s,c,f,p,d,y,h,v=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(u=v.length>1&&void 0!==v[1]?v[1]:t.popupTemplate)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,u.getRequiredFields(t.fieldsIndex);case 5:if(l=e.sent,s=u.lastEditInfoEnabled,c=t.objectIdField,f=t.typeIdField,p=t.globalIdField,d=t.relationships,!l.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:return y=s?(0,a.CH)(t):[],h=(0,a.Q0)(t.fieldsIndex,[].concat((0,i.Z)(l),(0,i.Z)(y))),e.abrupt("return",(f&&h.push(f),h&&c&&null!==(r=t.fieldsIndex)&&void 0!==r&&r.has(c)&&!h.includes(c)&&h.push(c),h&&p&&null!==(o=t.fieldsIndex)&&void 0!==o&&o.has(p)&&!h.includes(p)&&h.push(p),d&&d.forEach((function(e){var r,n=e.keyField;h&&n&&(null===(r=t.fieldsIndex)||void 0===r?void 0:r.has(n))&&!h.includes(n)&&h.push(n)})),h));case 15:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function s(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function c(e,t){return null!=s(e,{defaultPopupTemplateEnabled:t})}},45008:function(e,t,r){r.d(t,{D:function(){return u},K:function(){return a}});r(59486);var n=r(68860),i=r(96669),o=r(53866);function a(e,t,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.Z,u=0;if("2d"===r.type)u=t*(null!==(i=r.resolution)&&void 0!==i?i:0);else if("3d"===r.type){var l=r.overlayPixelSizeInMapUnits(e),s=r.basemapSpatialReference;u=null==s||s.equals(r.spatialReference)?t*l:(0,n.c9)(s)/(0,n.c9)(r.spatialReference)}var c=e.x-u,f=e.y-u,p=e.x+u,d=e.y+u,y=r.spatialReference;return a.xmin=Math.min(c,p),a.ymin=Math.min(f,d),a.xmax=Math.max(c,p),a.ymax=Math.max(f,d),a.spatialReference=y,a}function u(e,t,r){var n=r.toMap(e);return null!=n&&a(n,(0,i.k)(),r,l).intersects(t)}var l=new o.Z}}]);
//# sourceMappingURL=58985.b549d242.chunk.js.map