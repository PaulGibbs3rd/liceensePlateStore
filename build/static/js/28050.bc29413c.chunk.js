"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[28050],{97613:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(27366),l=n(84314),u=n(7138),c=n(11582),d=n(46784),v=n(92026),p=n(49861),h=(n(93169),n(32718),n(84936),n(69912)),f=n(96866),y=n(848),g=n(64575),_=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,v._W)(this.position,e.position)&&(0,v._W)(this.elevationInfo,e.elevationInfo)&&(0,l.kk)(this.feature,e.feature)}}]),n}((0,d.eC)((0,c.J)(u.default)));(0,s._)([(0,p.Cb)({type:y.Z,json:{write:{isRequired:!0}}})],_.prototype,"position",void 0),(0,s._)([(0,p.Cb)({type:g.Z}),(0,f.B)()],_.prototype,"elevationInfo",void 0),(0,s._)([(0,p.Cb)(l.rX)],_.prototype,"feature",void 0);var m=_=(0,s._)([(0,h.j)("esri.analysis.LineOfSightAnalysisObserver")],_)},33985:function(e,t,n){n.d(t,{Z:function(){return _}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(27366),l=n(84314),u=n(11582),c=n(46784),d=n(92026),v=n(49861),p=(n(93169),n(32718),n(84936),n(69912)),h=n(96866),f=n(848),y=n(64575),g=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,d._W)(this.position,e.position)&&(0,d._W)(this.elevationInfo,e.elevationInfo)&&(0,l.kk)(this.feature,e.feature)}}]),n}((0,c.eC)(u.j));(0,s._)([(0,v.Cb)({type:f.Z}),(0,h.B)()],g.prototype,"position",void 0),(0,s._)([(0,v.Cb)({type:y.Z}),(0,h.B)()],g.prototype,"elevationInfo",void 0),(0,s._)([(0,v.Cb)(l.rX)],g.prototype,"feature",void 0);var _=g=(0,s._)([(0,p.j)("esri.analysis.LineOfSightAnalysisTarget")],g)},84314:function(e,t,n){function i(e,t){return r(e)===r(t)}function r(e){if(null==e)return null;var t,n=null!=e.layer?e.layer.id:"";return null==(t=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid)?null:"o-".concat(n,"-").concat(t)}n.d(t,{kk:function(){return i},pD:function(){return r},rX:function(){return o}});var o={json:{write:{writer:function(e,t){var n;null!=(null===e||void 0===e||null===(n=e.layer)||void 0===n?void 0:n.objectIdField)&&null!=e.attributes&&(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}}},96866:function(e,t,n){n.d(t,{B:function(){return f}});var i=n(1413),r=n(37762),o=n(10064),a=n(9997),s=n(80292),l=n(35995),u=n(71907),c=n(33397),d=n(25265),v=n(49861),p=n(22892),h=n(53283);function f(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.origins)&&void 0!==t?t:[void 0];return function(t,o){var a,u=function(e,t,n){var r;if("resource"===(null===e||void 0===e?void 0:e.type))return function(e,t,n){var r=(0,c.Oe)(t,n);return{type:String,read:function(e,t,n){var i=(0,h.r)(e,t,n);return r.type===String?i:"function"==typeof r.type?new r.type({url:i}):void 0},write:{writer:function(t,o,a,u){if(null===u||void 0===u||!u.resources)return"string"==typeof t?void(o[a]=(0,h.t)(t,u)):void(o[a]=t.write({},u));var c=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),v=(0,h.t)(c,(0,i.Z)((0,i.Z)({},u),{},{verifyItemRelativeUrls:null!==u&&void 0!==u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0}),h.M.NO),f=r.type!==String&&(!(0,s.l)(this)||(null===u||void 0===u?void 0:u.origin)&&this.originIdOf(n)>(0,d.M9)(u.origin)),m={object:this,propertyName:n,value:t,targetUrl:v,dest:o,targetPropertyName:a,context:u,params:e};null!==u&&void 0!==u&&u.portalItem&&v&&!(0,l.YP)(v)?f&&null!==e&&void 0!==e&&e.contentAddressed?y(m):f?function(e){var t,n=e.context,r=e.targetUrl,o=e.params,a=e.value,s=e.dest,u=e.targetPropertyName;if(!n.portalItem)return;var c=n.portalItem.resourceFromPath(r),d=_(a,r,n),v=(0,p.B)(d),h=(0,l.Ml)(c.path),f=null!==(t=null===o||void 0===o?void 0:o.compress)&&void 0!==t&&t;v===h?(n.resources&&g((0,i.Z)((0,i.Z)({},e),{},{resource:c,content:d,compress:f,updates:n.resources.toUpdate})),s[u]=r):y(e)}(m):function(e){var t=e.context,n=e.targetUrl,i=e.dest,r=e.targetPropertyName;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(n),compress:!1}),i[r]=n)}(m):null!==u&&void 0!==u&&u.portalItem&&(null==v||null!=(0,h.i)(v)||(0,l.jc)(v)||f)?y(m):o[a]=v}}}}(e,t,n);switch(null!==(r=null===e||void 0===e?void 0:e.type)&&void 0!==r?r:"other"){case"other":return{read:!0,write:!0};case"url":return{read:h.b.read,write:h.b.write}}}(e,t,o),f=(0,r.Z)(n);try{for(f.s();!(a=f.n()).done;){var m=a.value,b=(0,v.CJ)(t,m,o);for(var C in u)b[C]=u[C]}}catch(w){f.e(w)}finally{f.f()}}}function y(e){var t,n,r,s,c=e.targetUrl,d=e.params,v=e.value,f=e.context,y=e.dest,m=e.targetPropertyName;if(f.portalItem){var b=(0,h.p)(c),C=_(v,c,f);if(null!==d&&void 0!==d&&d.contentAddressed&&"json"!==C.type)null===(t=f.messages)||void 0===t||t.push(new o.Z("persistable:contentAddressingUnsupported",'Property "'.concat(m,'" is trying to serializing a resource with content of type ').concat(C.type," with content addressing. Content addressing is only supported for json resources."),{content:C}));else{var w=null!==d&&void 0!==d&&d.contentAddressed&&"json"===C.type?(0,a.F)(C.jsonString):null!==(n=null===b||void 0===b?void 0:b.filename)&&void 0!==n?n:(0,u.DO)(),k=(0,l.v_)(null!==(r=null===d||void 0===d?void 0:d.prefix)&&void 0!==r?r:null===b||void 0===b?void 0:b.prefix,w),I="".concat(k,".").concat((0,p.B)(C));if(null!==d&&void 0!==d&&d.contentAddressed&&f.resources&&"json"===C.type){var O,T=null!==(O=f.resources.toKeep.find((function(e){return e.resource.path===I})))&&void 0!==O?O:f.resources.toAdd.find((function(e){return e.resource.path===I}));if(T)return void(y[m]=T.resource.itemRelativeUrl)}var Z=f.portalItem.resourceFromPath(I);(0,l.jc)(c)&&f.resources&&f.resources.pendingOperations.push((0,l.gi)(c).then((function(e){Z.path="".concat(k,".").concat((0,p.B)({type:"blob",blob:e})),y[m]=Z.itemRelativeUrl})).catch((function(){})));var P=null!==(s=null===d||void 0===d?void 0:d.compress)&&void 0!==s&&s;f.resources&&g((0,i.Z)((0,i.Z)({},e),{},{resource:Z,content:C,compress:P,updates:f.resources.toAdd})),y[m]=Z.itemRelativeUrl}}}function g(e){var t=e.object,n=e.propertyName,i=e.updates,r=e.resource,o=e.content,a=e.compress;i.push({resource:r,content:o,compress:a,finish:function(e){!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(t,n,e)}})}function _(e,t,n){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(n))}}},80292:function(e,t,n){function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{l:function(){return i}})},22892:function(e,t,n){n.d(t,{B:function(){return r}});var i=n(35995);function r(e){return o[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){var t=(0,i.Ml)(e);return l[t]||a}(e.url)}(e)]||s}var o={},a="text/plain",s=o[a],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(var u in l)o[l[u]]=u},98074:function(e,t,n){n.d(t,{p:function(){return v}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(27366),l=n(42537),u=n(67426),c=n(49861),d=(n(93169),n(32718),n(84936),n(69912)),v=function(e){var t=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).parent=null,e._userInteractive=!1,e._interactiveViewModelCount=0,e}return(0,r.Z)(n,[{key:"interactive",get:function(){return this._interactiveViewModelCount>0||this._userInteractive},set:function(e){this._userInteractive=e}},{key:"updating",get:function(){return!1}},{key:"visible",get:function(){return null==this.parent||this.parent.visible&&!this.parent.suspended},set:function(e){this._overrideIfSome("visible",e)}},{key:"forceInteractiveForViewModel",value:function(){var e=this;return this._interactiveViewModelCount++,(0,l.kB)((function(){return e._interactiveViewModelCount--}))}}]),n}((0,u.v)(e));return(0,s._)([(0,c.Cb)({constructOnly:!0})],t.prototype,"parent",void 0),(0,s._)([(0,c.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,s._)([(0,c.Cb)({type:Boolean})],t.prototype,"interactive",null),(0,s._)([(0,c.Cb)()],t.prototype,"_userInteractive",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,s._)([(0,c.Cb)()],t.prototype,"visible",null),(0,s._)([(0,c.Cb)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,s._)([(0,d.j)("esri.views.3d.analysis.AnalysisView3D")],t)}},77897:function(e,t,n){n.r(t),n.d(t,{default:function(){return nt}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(27366),l=n(7138),u=n(80987),c=n(91505),d=(n(93169),n(92026)),v=n(49861),p=n(32718),h=(n(84936),n(69912)),f=n(12400),y=n(98074),g=n(74165),_=n(15861),m=n(37762),b=(n(59486),n(84314)),C=n(14921),w=n(100),k=n(42537),I=n(66978),O=n(94172),T=n(32035),Z=n(46634),P=n(79803),S=n(77258),R=n(65156),L=n(40885),E=n(74509),V=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).target=null,r.intersectedGraphic=null,r.intersectedLocation=null,r.elevationAlignedTargetLocation=null,r.visible=void 0,r}return(0,r.Z)(n)}(l.default);(0,s._)([(0,v.Cb)()],V.prototype,"target",void 0),(0,s._)([(0,v.Cb)()],V.prototype,"intersectedGraphic",void 0),(0,s._)([(0,v.Cb)()],V.prototype,"intersectedLocation",void 0),(0,s._)([(0,v.Cb)()],V.prototype,"elevationAlignedTargetLocation",void 0),(0,s._)([(0,v.Cb)({type:Boolean})],V.prototype,"visible",void 0),V=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSightAnalysisResult")],V);var A=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).elevationAlignedTargetLocation=null,r.inputPoints={isValid:!1,observer:(0,f.Ue)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,f.Ue)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,f.Ue)(),targetAdjusted:(0,f.Ue)()},r.computationResult={start:(0,f.Ue)(),end:(0,f.Ue)(),intersection:(0,f.Ue)(),isValid:!1,isTargetVisible:!1},r.result=null,r}return(0,r.Z)(n,[{key:"notifyResultChanged",value:function(){this.notifyChange("computationResult")}},{key:"notifyInputPointsChanged",value:function(){this.notifyChange("inputPoints")}}]),n}(l.default);(0,s._)([(0,v.Cb)()],A.prototype,"target",void 0),(0,s._)([(0,v.Cb)()],A.prototype,"elevationAlignedTargetLocation",void 0),(0,s._)([(0,v.Cb)()],A.prototype,"inputPoints",void 0),(0,s._)([(0,v.Cb)()],A.prototype,"computationResult",void 0),(0,s._)([(0,v.Cb)()],A.prototype,"result",void 0),A=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],A);var H,j=n(17842),M=n(51378),x=n(65618),D=n(63780),U=n(84652),z=H=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"clone",value:function(){return new H({type:this.type,id:(0,U.d9)(this.id),mapPoint:(0,U.d9)(this.mapPoint),renderPoint:(0,f.d9)(this.renderPoint),normal:(0,U.d9)(this.normal),ray:(0,U.d9)(this.ray),graphic:this.graphic})}},{key:"equals",value:function(e){return this.type===e.type&&this.id===e.id&&(0,d._W)(this.mapPoint,e.mapPoint)&&(0,T.G)(this.renderPoint,e.renderPoint)&&(0,D.fS)(this.normal,e.normal)&&(0,L.fS)(this.ray,e.ray)&&this.graphic===e.graphic}}]),n}(l.default);(0,s._)([(0,v.Cb)()],z.prototype,"type",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],z.prototype,"id",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],z.prototype,"mapPoint",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],z.prototype,"renderPoint",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],z.prototype,"normal",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],z.prototype,"graphic",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],z.prototype,"ray",void 0),z=H=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],z);var F=n(85312),G=n(81703),B=n(43449),N=n(88153),W=n(54463),q=n(41781),X=n(848),J=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._terrainIntersectionOptionsLayerUids=new Set(["terrain"]),r}return(0,r.Z)(n,[{key:"initialize",value:function(){this.intersector=(0,N.Z8)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=W.eC.MIN}},{key:"getScreenPointIntersection",value:function(e){var t=(0,j.md)(e,M.qW.get()),n=(0,G.u4)(this.view.state.camera,t,ee);return this._getRayIntersection(n)}},{key:"_getRayIntersection",value:function(e,t){if(null==e||null==this.view.sceneIntersectionHelper)return null;var n=this.intersector;n.options.store=W.eC.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,n,t);var i=n.results.min,r=(0,f.Ue)();if(!i.getIntersectionPoint(r))return null;if(null!=(null===t||void 0===t?void 0:t.maxDistance)&&(0,T.a)(r,e.origin)>Math.pow(t.maxDistance,2))return null;var o=this.view.renderCoordsHelper.fromRenderCoords(r,new X.Z({spatialReference:this.view.spatialReference})),a=(0,f.d9)(i.normal);if((0,F.GS)(i))return new z({type:W.q7.OBJECT,id:"".concat(i.target.layerUid,"/").concat(i.target.nodeIndex,"/").concat(i.target.componentIndex),mapPoint:o,renderPoint:r,normal:a,ray:(0,L.JG)(e),graphic:null});if((0,F.BF)(i))return new z({type:W.q7.OBJECT,id:"".concat(i.target.layerUid,"/").concat(i.target.graphicUid),mapPoint:o,renderPoint:r,normal:a,ray:(0,L.JG)(e),graphic:null});if((0,B.TX)(i))return new z({type:W.q7.TERRAIN,id:i.target.lij.slice(),mapPoint:o,renderPoint:r,normal:a,ray:(0,L.JG)(e),graphic:null});var s=(0,q.tB)(i,this.view);if(null!=s){var l,u=s.layer,c=s.sourceLayer;return l=c&&"scene"===c.type?(0,x.MS)(s,c.objectIdField):s.uid,new z({type:W.q7.OBJECT,id:"".concat(null===u||void 0===u?void 0:u.uid,"/").concat(l),mapPoint:o,renderPoint:r,normal:a,ray:(0,L.JG)(e),graphic:s})}return null}},{key:"updateFromGroundIntersection",value:function(e,t,n){var i=$,r=Y,o=K,a=Q;(0,T.c)(r,e),this.view.renderCoordsHelper.worldUpAtPosition(r,o),(0,T.n)(o,o);var s=this.view.basemapTerrain.visibleElevationBounds,l=(t>=0?1:-1)*((s?Math.abs(s.max-s.min):100)+Math.abs(t));(0,T.j)(a,o,l),(0,T.g)(i,r,a),(0,L.zk)(i,r,ee);var u=this._getRayIntersection(ee,{include:this._terrainIntersectionOptionsLayerUids,maxDistance:l});if(null!=u){var c=Q;return(0,T.j)(c,o,t),(0,T.g)(n,u.renderPoint,c),(0,f.d9)(u.normal)}return(0,T.c)(n,e),null}}]),n}(l.default);(0,s._)([(0,v.Cb)()],J.prototype,"view",void 0),(0,s._)([(0,v.Cb)()],J.prototype,"intersector",void 0),J=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],J);var $=(0,f.Ue)(),Y=(0,f.Ue)(),K=(0,f.Ue)(),Q=(0,f.Ue)(),ee=(0,L.Ue)(),te=n(33906),ne=n(93463),ie=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).updateOnCameraChange=!0,r._observerGroundOffsetRenderSpace=0,r._effectiveObserverElevationMode="absolute-height",r._observerFeatureId=null,r._updatingHandles=new Z.R,r._frameTask=ne.sq,r._computationHandles=new w.Z,r._externalObserverUpdate=!0,r}return(0,r.Z)(n,[{key:"initialize",value:function(){var e,t=null===(e=this.view.resourceController)||void 0===e?void 0:e.scheduler;this._frameTask=t?t.registerTask(ne.T8.LINE_OF_SIGHT_TOOL):ne.sq,this._intersector=new J({view:this.view}),this.addHandles([this._connectObserver(),this._connectComputations(),this._connectTargets()])}},{key:"destroy",value:function(){this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}},{key:"updating",get:function(){return this._frameTask.updating||this._updatingHandles.updating}},{key:"priority",get:function(){return this._frameTask.priority},set:function(e){this._frameTask.priority=e}},{key:"_computations",get:function(){return this.analysisViewData.computations}},{key:"_elevationAlignedObserverPositionRenderSpace",get:function(){return this.analysisViewData.observerEngineLocation},set:function(e){this.analysisViewData.observerEngineLocation=e}},{key:"_screenPixelSize",get:function(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}},{key:"_computeResult",value:function(e){var t=e.computation,n=t.inputPoints,i=t.computationResult,r=n.observerAdjusted,o=n.targetAdjusted,a=i.start,s=i.end;(0,T.c)(a,r),(0,T.c)(s,o),this._canCompute(t)?this._computeIntersection(e):function(e){var t=e.computation,n=e.interpolationInfo,i=t.computationResult,r=t.inputPoints,o=i.start,a=i.end,s=i.intersection,l=n.originalIntersection,u=n.originalObserver,c=n.originalTarget;if((0,T.c)(s,l),r.isValid){var d=se,v=(0,T.F)(u,l)/(0,T.F)(u,c);(0,T.z)(d,o,u),(0,T.j)(d,d,1-v),(0,T.g)(s,s,d),(0,T.z)(d,a,c),(0,T.j)(d,d,v),(0,T.g)(s,s,d),i.isValid=!0}else t.result=null,i.isValid=!1,i.isTargetVisible=!1}(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}},{key:"_updateAdjustedPointsFromFeatures",value:function(e){var t=this.view,n=t.sceneIntersectionHelper,i=e.inputPoints,r=i.observerAdjusted,o=i.observerFeatureId,a=i.targetFeatureId,s=i.targetAdjusted;if(null!=o||null!=a){var l=(0,T.p)(r,s),u=this._intersector.intersector,c=(0,L.zk)(i.observer,i.target,le);u.options.store=W.eC.ALL,n.intersectToolIntersectorRay(c,u);var d,v=null,p=null,h=null,y=null,g=(0,m.Z)(u.results.all);try{for(g.s();!(d=g.n()).done;){var _=d.value,C=(0,q.tB)(_,this.view);if(null!=C&&null!=_.distanceInRenderSpace){var w=(0,b.pD)(C);null!=w&&(null!=o&&w===o&&(null==v&&(v=re(_,t,l)),_.distanceInRenderSpace<v&&(h=_)),null!=a&&w===a&&(null==p&&(p=re(_,t,l)),null==y&&_.distanceInRenderSpace<l&&l-_.distanceInRenderSpace<p&&(y=_)))}}}catch(k){g.e(k)}finally{g.f()}null!=h&&h.getIntersectionPoint(r)&&(i.observerSurfaceNormal=h.getTransformedNormal((0,f.Ue)())),null!=y&&y.getIntersectionPoint(s)&&(i.targetSurfaceNormal=y.getTransformedNormal((0,f.Ue)()))}}},{key:"_adjustStartEndPositions",value:function(e){var t=this._screenPixelSize,n=this.view,i=e.inputPoints,r=i.observer,o=i.observerSurfaceNormal,a=i.target,s=i.targetSurfaceNormal,l=i.observerAdjusted,u=i.targetAdjusted,c=se;(0,T.c)(l,r),(0,T.c)(u,a),this._updateAdjustedPointsFromFeatures(e),null!=o?(0,T.c)(c,o):(0,T.f)(c,u,l);var d=t;(0,T.n)(c,c),(0,T.j)(c,c,Math.min(d,1)),(0,T.g)(l,l,c),null!=s?(0,T.c)(c,s):(0,T.f)(c,l,u);var v=n.state.camera.computeScreenPixelSizeAt(u);(0,T.n)(c,c),(0,T.j)(c,c,Math.min(v,1)),(0,T.g)(u,u,c)}},{key:"_computeIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=this.view,r=i.sceneIntersectionHelper,o=i.renderCoordsHelper;if(null!=r){var a=this._intersector.intersector,s=t.computationResult,l=t.inputPoints,u=l.observer,c=l.target,d=s.start,v=s.end,p=(0,L.zk)(d,v,le);a.options.store=W.eC.MIN,r.intersectToolIntersectorRay(p,a);var h=a.results.min,f=s.intersection,y=se,g=!0;if(null!=h&&h.getIntersectionPoint(f)){(0,T.c)(n.originalIntersection,f),(0,T.c)(n.originalObserver,d),(0,T.c)(n.originalTarget,v),o.fromRenderCoords(f,y,i.spatialReference);var _=1-(0,T.F)(v,c)/(0,T.F)(d,c);g=(0,T.F)(u,f)>=_*(0,T.F)(u,c)}var m=new X.Z(y,i.spatialReference),b=t.result,C=t.target;null!=b?(b.target=C,b.intersectedGraphic=g?null:(0,q.tB)(h,i),b.intersectedLocation=g?null:m,b.visible=g):t.result=new V({target:C,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:g?null:(0,q.tB)(h,i),intersectedLocation:g?null:m,visible:g}),s.isValid=l.isValid=!0,s.isTargetVisible=g}}},{key:"_canCompute",value:function(e){var t=this.analysisViewData.elevationAlignedObserver,n=this.view.frustum;if(null==t||null==e.elevationAlignedTargetLocation||null==n)return!1;var i=e.inputPoints,r=i.observerAdjusted,o=i.targetAdjusted,a=n.intersectsPoint(r),s=n.intersectsPoint(o);return a&&s}},{key:"_onObserverPositionChange",value:function(e,t,n,i,r){if(this._externalObserverUpdate=r,null==e)return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if(null==t)return(0,te.e)(this.analysis,e.spatialReference,p.Z.getLogger(this)),void(this.analysisViewData.elevationAlignedObserver=null);var o=oe(t,n),a=(0,E.tq)(t.x,t.y,t.z,this.view.spatialReference,this.view,o),s=a.absoluteZ,l=a.elevation,u=t.clone();u.z=s,this._effectiveObserverElevationMode=o.mode,this.analysisViewData.elevationAlignedObserver=u;var c=(0,f.Ue)();this.view.renderCoordsHelper.toRenderCoords(u,c),this._elevationAlignedObserverPositionRenderSpace=c,this._observerGroundOffsetRenderSpace=s-l,this._observerFeatureId=(0,b.pD)(i),this.priority=ne.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onObserverRenderSpacePositionChangeForComputation",value:function(e,t,n,i,r){var o=e.inputPoints;switch((0,T.c)(o.observer,t),o.observerFeatureId=r,o.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":var a=this._intersector.updateFromGroundIntersection(o.observer,n,o.observer);null==o.observerFeatureId&&(o.observerSurfaceNormal=a)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=ne.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onTargetPositionChange",value:function(e,t,n,i,r){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=e.inputPoints;if(o&&(a.isValid=!1),null==n)return null!=t&&(0,te.e)(this.analysis,t.spatialReference,p.Z.getLogger(this)),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();var s=oe(n,i),l=(0,E.tq)(n.x,n.y,n.z,this.view.spatialReference,this.view,s),u=l.absoluteZ,c=l.elevation,d=n.clone();switch(d.z=u,e.elevationAlignedTargetLocation=d,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,a.target),a.targetFeatureId=(0,b.pD)(r),a.targetSurfaceNormal=null,s.mode){case"on-the-ground":case"relative-to-ground":var v=this._intersector.updateFromGroundIntersection(a.target,u-c,a.target);null==a.targetFeatureId&&(a.targetSurfaceNormal=v)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=ne.T8.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_connectComputationToTarget",value:function(e){var t=this;return(0,k.AL)([this._updatingHandles.add((function(){return{computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:(0,P.projectOrLoad)(e.target.position,t.view.spatialReference)}}),(function(e){var n=e.computation,i=e.targetPosition,r=e.targetElevationInfo,o=e.targetFeatureInfo,a=e.projectedTargetPosition;null==a.pending?t._onTargetPositionChange(n,i,a.geometry,r,o):t._updatingHandles.addPromise(a.pending)}),O.initial)])}},{key:"_connectComputationToObserver",value:function(e){var t=this;return this._updatingHandles.add((function(){return{computation:e,observer:t.analysisViewData.elevationAlignedObserver}}),(function(e){var n=e.computation;t._externalObserverUpdate&&(n.inputPoints.isValid=!1,n.notifyInputPointsChanged())}),O.initial)}},{key:"_connectComputationToRenderSpaceObserver",value:function(e){var t=this;return this._updatingHandles.add((function(){return{computation:e,observer:t._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:t._observerGroundOffsetRenderSpace,observerElevationMode:t._effectiveObserverElevationMode,observerFeatureId:t._observerFeatureId}}),(function(e){var n=e.computation,i=e.observer,r=e.observerGroundOffset,o=e.observerElevationMode,a=e.observerFeatureId;t._onObserverRenderSpacePositionChangeForComputation(n,i,r,o,a)}),O.initial)}},{key:"_connectComputationToCamera",value:function(e){var t=this;return this._updatingHandles.add((function(){return{camera:t.view.state.camera,isDirty:t._isCameraDirty}}),(function(n){var i=n.isDirty;!t.updateOnCameraChange||e.inputPoints.isValid&&!i||e.notifyInputPointsChanged()}))}},{key:"_connectComputationToSlicePlane",value:function(e){var t=this;return this._updatingHandles.add((function(){return t.view.slicePlane}),(function(){e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}},{key:"_connectComputationToElevation",value:function(e){var t=this,n=function n(i,r){var o=t.analysis.observer,a=e.target,s=null,l=null,u=null,c=null,d=null,v=null;if(null!=(null===o||void 0===o?void 0:o.position)){var p=(0,P.projectOrLoad)(o.position,t.view.spatialReference);if(null!=p.pending)return t._updatingHandles.addPromise(p.pending),void p.pending.finally((function(){return n(i,r)}));s=p.geometry,l=o.elevationInfo,u=o.feature}if(null!=a.position){var h=(0,P.projectOrLoad)(a.position,t.view.spatialReference);if(null!=h.pending)return t._updatingHandles.addPromise(h.pending),void h.pending.finally((function(){return n(i,r)}));c=h.geometry,d=a.elevationInfo,v=a.feature}null==s&&null==c||((0,S.d)(i,r,ue,t.view.spatialReference),null!=s&&(0,R.Qn)(ue,s)&&t._onObserverPositionChange(null!=o?o.position:null,s,l,u,!1),null!=c&&(0,R.Qn)(ue,c)&&t._onTargetPositionChange(e,a.position,c,d,v,!1),null!=s&&null!=c&&(0,R.I7)(ue,s,c)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(function(e){var t=e.extent,i=e.spatialReference;return n(t,i)}))}},{key:"_connectComputationToTask",value:function(e){var t=this,n=null,i={computation:e,interpolationInfo:{originalIntersection:(0,f.Ue)(),originalObserver:(0,f.Ue)(),originalTarget:(0,f.Ue)()}};return(0,k.AL)([this._updatingHandles.add((function(){return e.inputPoints}),(function(){n=(0,d.IM)(n),n=(0,C.vr)(function(){var e=(0,_.Z)((0,g.Z)().mark((function e(n){return(0,g.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,I.R8)(t._frameTask.schedule((function(){return t._computeResult(i)}),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),{initial:!0,equals:function(){return!1}}),(0,k.kB)((function(){return n=(0,d.IM)(n)}))])}},{key:"_connectComputation",value:function(e){var t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_onComputationCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._connectComputation(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_onTargetCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._removeTarget(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._addTarget(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_onCursorTargetChange",value:function(e,t){null!=t&&this._removeTarget(t),null!=e&&this._addTarget(e)}},{key:"_addTarget",value:function(e){this._computations.some((function(t){return t.target===e}))||this._computations.add(new A({target:e}))}},{key:"_removeTarget",value:function(e){var t=this._computations.findIndex((function(t){return t.target===e}));this._computations.removeAt(t)}},{key:"_connectObserver",value:function(){var e=this;return(0,k.AL)([this._updatingHandles.add((function(){return{observerPosition:null!=e.analysis.observer?e.analysis.observer.position:null,projectedObserverPosition:(0,P.projectOrLoad)(null!=e.analysis.observer?e.analysis.observer.position:null,e.view.spatialReference),observerElevationInfo:null!=e.analysis.observer?e.analysis.observer.elevationInfo:null,observerFeatureInfo:null!=e.analysis.observer?e.analysis.observer.feature:null}}),(function(t){var n=t.observerPosition,i=t.projectedObserverPosition,r=t.observerElevationInfo,o=t.observerFeatureInfo;null==i.pending?e._onObserverPositionChange(n,i.geometry,r,o,!0):e._updatingHandles.addPromise(i.pending)}),O.initial)])}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e._computations}),(function(t){return e._onComputationCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_connectTargets",value:function(){var e=this;return(0,k.AL)([this._updatingHandles.addOnCollectionChange((function(){return e.analysis.targets}),(function(t){return e._onTargetCollectionChange(t)}),{initial:!0,final:!0}),this._updatingHandles.add((function(){return e.analysisViewData.cursorTarget}),(function(t,n){e._onCursorTargetChange(t,n)}))])}},{key:"_isCameraDirty",get:function(){var e=this.analysisViewData.elevationAlignedObserver,t=this.view,n=t.renderCoordsHelper;if(null==e||null==n)return!1;var i=se;n.toRenderCoords(e,i);var r=t.state.camera.computeScreenPixelSizeAt(i);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>ae}}]),n}(c.Z.EventedMixin(l.default));function re(e,t,n){if((0,q._s)(e)){var i=(0,q.VB)(e,t);if(null!=i)return Math.min(i*ce,n)}return 1e-5*n}function oe(e,t){return e.hasZ?null!==t&&void 0!==t?t:{mode:"absolute-height",offset:0}:{mode:"on-the-ground",offset:0}}(0,s._)([(0,v.Cb)({constructOnly:!0})],ie.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],ie.prototype,"analysisViewData",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],ie.prototype,"view",void 0),(0,s._)([(0,v.Cb)()],ie.prototype,"updating",null),(0,s._)([(0,v.Cb)()],ie.prototype,"priority",null),(0,s._)([(0,v.Cb)()],ie.prototype,"updateOnCameraChange",void 0),(0,s._)([(0,v.Cb)()],ie.prototype,"_computations",null),(0,s._)([(0,v.Cb)()],ie.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,s._)([(0,v.Cb)()],ie.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,s._)([(0,v.Cb)()],ie.prototype,"_effectiveObserverElevationMode",void 0),(0,s._)([(0,v.Cb)()],ie.prototype,"_observerFeatureId",void 0),(0,s._)([(0,v.Cb)()],ie.prototype,"_screenPixelSize",null),(0,s._)([(0,v.Cb)({readOnly:!0})],ie.prototype,"_updatingHandles",void 0),(0,s._)([(0,v.Cb)()],ie.prototype,"_frameTask",void 0),(0,s._)([(0,v.Cb)()],ie.prototype,"_isCameraDirty",null),ie=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightController")],ie);var ae=.1,se=(0,f.Ue)(),le=(0,L.Ue)(),ue=(0,R.cS)(),ce=.05,de=n(1413),ve=n(51995),pe=n(97613),he=n(33985),fe=n(85981),ye=n(64575),ge=n(86950),_e=new((0,r.Z)((function e(){(0,i.Z)(this,e),this.glowWidth=8,this.innerWidth=.75})));var me=(0,r.Z)((function e(){(0,i.Z)(this,e),this.size=.5})),be=new me;function Ce(e){return(0,ge.Ch)(e.accentColor,.75)}var we=new((0,r.Z)((function e(){(0,i.Z)(this,e),this.size=.5,this.visibleColor=new ve.Z([3,252,111,.75]),this.occludedColor=new ve.Z([252,3,69,.75]),this.undefinedColor=new ve.Z([127,127,127,.75])}))),ke=new((0,r.Z)((function e(){(0,i.Z)(this,e),this.innerWidth=2,this.outerWidth=8,this.visibleInnerColor=new ve.Z([3,252,111,1]),this.visibleOuterColor=new ve.Z([3,252,111,.15]),this.occludedInnerColor=new ve.Z([252,3,69,1]),this.occludedOuterColor=new ve.Z([252,3,69,.1]),this.undefinedInnerColor=new ve.Z([255,255,255,1]),this.undefinedOuterColor=new ve.Z([127,127,127,.2])}))),Ie=n(97326),Oe=n(88301),Te=n(61120),Ze=n(35284),Pe=n(83639),Se=n(40508),Re=n(81655),Le=n(70619),Ee=n(99034),Ve=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e,r){var o;(0,i.Z)(this,n);var a=(0,Pe.EA)(Ce(e.effectiveTheme)),s=(0,Le.PI)(a,be.size,32,32),l=new Se.r(s);return o=t.call(this,{view:e,renderObjects:[l],metadata:r,elevationInfo:{mode:"absolute-height",offset:0}}),(0,Re.c)((0,Ie.Z)(o)),o.themeHandle=(0,O.watch)((function(){return{color:Ce(e.effectiveTheme)}}),(function(e){a.setParameters(e)})),o}return(0,r.Z)(n,[{key:"destroy",value:function(){this.themeHandle.remove(),(0,Oe.Z)((0,Te.Z)(n.prototype),"destroy",this).call(this)}}]),n}(Ze.Z),Ae=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e,r){var o;(0,i.Z)(this,n);var a=we.size,s=we.visibleColor,l=we.occludedColor,u=we.undefinedColor;return o=t.call(this,{view:e,renderObjects:[He(a,s,Ee.jg.Custom1),He(a,l,Ee.jg.Custom2),He(a,u,Ee.jg.Custom3)],metadata:r,elevationInfo:{mode:"absolute-height",offset:0}}),(0,Re.c)((0,Ie.Z)(o)),o}return(0,r.Z)(n)}(Ze.Z);function He(e,t,n){return new Se.r((0,Le.PI)((0,Pe.EA)(ve.Z.toUnitRGBA(t)),e,32,32),n)}var je,Me=n(96026),xe=(n(84057),n(86509)),De=n(74229),Ue=n(72612),ze=n(63920);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(je||(je={}));var Fe=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).removeIncompleteOnCancel=!1,r.analysisViewData=null,r._latestPointerMovePointerType=null,r._laserlineVisualElement=null,r._grabbedManipulator=null,r._analysisHandles=new w.Z,r._updatingHandles=new Z.R,r._manipulatorHandles=new w.Z,r._targetTrackerManipulator=null,r}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=new J({view:this.view}),this.addHandles((0,O.watch)((function(){return e.state}),(function(t){t===je.Created&&e.finishToolCreation()}),O.syncAndInitial)),this._observerManipulator=this._createObserverManipulator(),this._createLaserLine(),this.addHandles([this._updatingHandles.add((function(){var t;return null===(t=e.analysisViewData)||void 0===t?void 0:t.elevationAlignedObserver}),(function(t){return e._onObserverLocationChange(t)}),O.initial),this._updatingHandles.add((function(){return function(e){var t=e.accentColor;return{glowColor:t,innerColor:(0,ge.mj)(t),globalAlpha:.75*t.a}}(e.view.effectiveTheme)}),(function(t){var n=t.glowColor,i=t.innerColor,r=t.globalAlpha;return e._updateLaserLineStyle(n,i,r)}),O.initial),this._updatingHandles.add((function(){return e._laserLineRendererDependencies()}),(function(t){return e._updateLaserLineRenderer(t)})),this._connectComputations(),this._updatingHandles.addWhen((function(){return!e._shouldRenderTracker}),(function(){return e._clearCursorTracker()}),O.initial)])}},{key:"destroy",value:function(){this._updatingHandles=(0,d.SC)(this._updatingHandles),this._manipulatorHandles=(0,d.SC)(this._manipulatorHandles),this._analysisHandles=(0,d.SC)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeLaserLine(),this._intersector=null,this._set("analysis",null)}},{key:"state",get:function(){var e;return this.active?this.hasGrabbedManipulators?je.Created:je.Creating:null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)?je.Created:je.Ready}},{key:"cursor",get:function(){return this.active&&this._showTracker?"crosshair":null}},{key:"updating",get:function(){return null!=this.analysisViewData&&this.analysisViewData.updating||this._updatingHandles.updating}},{key:"_showTracker",get:function(){return this.active&&"mouse"===this._latestPointerMovePointerType}},{key:"_shouldRenderTracker",get:function(){var e;return this._showTracker&&null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)&&!this.hasGrabbedManipulators}},{key:"continue",value:function(){this.view.activeTool=this}},{key:"stop",value:function(){this.view.activeTool=null}},{key:"onEditableChange",value:function(){this.analysisViewData.editable=this.internallyEditable}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}},{key:"onInputEventAfter",value:function(e){"immediate-click"===e.type&&this._clickHandler(e)}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}},{key:"onDeactivate",value:function(){this._clearCursorTracker()}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e.analysisViewData.computations}),(function(t){return e._onComputationsCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._connectComputation(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_connectComputation",value:function(e){var t=this;if(this.destroyed)p.Z.getLogger(this).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");else{var n=this._analysisHandles;if(!n.has(e)){var i=this._createTargetManipulator(e.target);null==this._targetTrackerManipulator&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),n.add([this._updatingHandles.add((function(){return function(e){var t=e.computationResult,n=t.isValid,i=t.isTargetVisible;return{isValid:n,isTargetVisible:i}}(e)}),(function(){return function(e,t){var n=t.computationResult,i=n.isValid,r=n.isTargetVisible;e.state=i?r?Ee.jg.Custom1:Ee.jg.Custom2:Ee.jg.Custom3}(i,e)}),O.initial),this._updatingHandles.add((function(){return e.elevationAlignedTargetLocation}),(function(e){return t._onTargetLocationChange(e,i)}),O.initial)],e)}}}},{key:"_disconnectComputation",value:function(e){if(this.destroyed)p.Z.getLogger(this).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");else{this._analysisHandles.remove(e);var t=this._getTargetManipulator(e.target);null!=t&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),null!=this._targetTrackerManipulator&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}}},{key:"_clearCursorTracker",value:function(){this.analysisViewData.cursorTarget=(0,d.SC)(this.analysisViewData.cursorTarget)}},{key:"_createTargetManipulator",value:function(e){var t=this,n={target:e,type:"target"},i=new Ae(this.view,n);return this._manipulatorHandles.add([this._createTargetManipulatorDragPipeline(i),i.events.on("grab-changed",(function(e){return t._manipulatorGrabChanged(i,e)})),i.events.on("immediate-click",(function(e){return t._manipulatorClick(i,e)}))],i),this.manipulators.add(i),null!=e.position?i.elevationAlignedLocation=e.position:i.available=!1,i}},{key:"_getTargetManipulator",value:function(e){var t=null;return this.manipulators.forEach((function(n){var i=n.manipulator;null==t&&"target"===i.metadata.type&&i.metadata.target===e&&(t=i)})),t}},{key:"_createObserverManipulator",value:function(){var e=this,t=new Ve(this.view,{type:"observer",intersection:null});return this._manipulatorHandles.add([this._createObserverManipulatorDragPipeline(t),t.events.on("grab-changed",(function(n){return e._manipulatorGrabChanged(t,n)})),t.events.on("immediate-click",(function(n){return e._manipulatorClick(t,n)}))],t),this.manipulators.add(t),t}},{key:"_screenToIntersection",value:function(){var e=this;return function(t){var n=e._intersector.getScreenPointIntersection(t.screenEnd);return null==n?null:(0,de.Z)((0,de.Z)({},t),{},{intersection:n})}}},{key:"_createTargetManipulatorDragPipeline",value:function(e){var t=this;return(0,De.Xd)(e,(function(n,i,r){i.next(t._screenToIntersection()).next(t._updateTargetDragStep(e)).next((function(){return t._updateLaserLineRenderer()})),r.next(function(e){var t,n=null===(t=e.position)||void 0===t?void 0:t.clone();return function(t){return e.position=n,t}}(e.metadata.target)).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_createObserverManipulatorDragPipeline",value:function(e){var t=this;return(0,De.Xd)(e,(function(e,n,i){n.next(t._screenToIntersection()).next(t._updateObserverDragStep()).next((function(){return t._updateLaserLineRenderer()})),i.next(t._cancelObserverDragStep()).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_updateObserverDragStep",value:function(){var e=this;return function(t){return null!=t.intersection.mapPoint?(null==e.analysis.observer&&(e.analysis.observer=new pe.Z),e._updateFromIntersection(e.analysis.observer,t.intersection)):e.analysis.observer=null,t}}},{key:"_cancelObserverDragStep",value:function(){var e,t=this,n=null!=(null===(e=this.analysis.observer)||void 0===e?void 0:e.position)?this.analysis.observer.clone():null;return function(e){return t.analysis.observer=n,e}}},{key:"_updateTargetDragStep",value:function(e){var t=this;return function(n){t._updateFromIntersection(e.metadata.target,n.intersection);var i=n.intersection.mapPoint;return null!=i&&(e.elevationAlignedLocation=i),n}}},{key:"_manipulatorGrabChanged",value:function(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}},{key:"_laserLineRendererDependencies",value:function(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:null!=this.analysis.observer?this.analysis.observer.position:null,visible:this.visible}}},{key:"_updateLaserLineRenderer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies(),t=e.laserlineVisualElement,n=e.grabbedManipulator,i=e.shouldRenderTracker,r=e.observerPosition,o=e.visible;if(null!=t){var a=null!=n?n:i&&null!=r?this._targetTrackerManipulator:null;null!=a&&o?(t.visible=!0,t.heightManifoldTarget=a.renderLocation,a!==this._observerManipulator?t.lineVerticalPlaneSegment=(0,fe.zk)(this._observerManipulator.renderLocation,a.renderLocation,Ge):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}}},{key:"_createLaserLine",value:function(){this._removeLaserLine();var e=_e.glowWidth,t=_e.innerWidth;this._laserlineVisualElement=new Me.W({view:this.view,attached:!0,visible:this.visible,style:{glowWidth:e,innerWidth:t},isDecoration:!0})}},{key:"_removeLaserLine",value:function(){null!=this._laserlineVisualElement&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}},{key:"_updateLaserLineStyle",value:function(e,t,n){var i=this._laserlineVisualElement;if(null!=i){var r=i.style;i.style=(0,de.Z)((0,de.Z)({},r),{},{glowColor:ve.Z.toUnitRGB(e),innerColor:ve.Z.toUnitRGB(t),globalAlpha:n})}}},{key:"_onObserverLocationChange",value:function(e){null!=e?(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e):this._observerManipulator.available=!1}},{key:"_onTargetLocationChange",value:function(e,t){null!=e?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}},{key:"_addPointFromClickEvent",value:function(e){var t,n=this._intersector.getScreenPointIntersection(e);if(null!=(null===n||void 0===n?void 0:n.mapPoint))if(null!=(null===(t=this.analysis.observer)||void 0===t?void 0:t.position)){this._clearCursorTracker();var i=new he.Z;this._updateFromIntersection(i,n),this.analysis.targets.add(i)}else{var r=new pe.Z;this._updateFromIntersection(r,n),this.analysis.observer=r}}},{key:"_clickHandler",value:function(e){this.active&&e.button!==ze.t.Right&&(this._addPointFromClickEvent((0,Ue.vT)(e)),e.stopPropagation())}},{key:"_doubleClickHandler",value:function(e){this.active&&e.button!==ze.t.Right&&(this.stop(),e.stopPropagation())}},{key:"_keyDownHandler",value:function(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){var t;if(!this.hasGrabbedManipulators&&(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),this._showTracker&&null!=(null===(t=this.analysis.observer)||void 0===t?void 0:t.position))){var n=(0,Ue.vT)(e),i=this._intersector.getScreenPointIntersection(n);null!=(null===i||void 0===i?void 0:i.mapPoint)&&(null==this.analysisViewData.cursorTarget&&(this.analysisViewData.cursorTarget=new he.Z),this._updateFromIntersection(this.analysisViewData.cursorTarget,i),this._updateLaserLineRenderer())}}},{key:"_updateFromIntersection",value:function(e,t){if(null==t.mapPoint)return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case W.q7.OBJECT:if(null!=t.graphic){var n=t.graphic,i=(0,E.RL)(n);"on-the-ground"===i.mode&&(i.mode="relative-to-ground",i.offset=0),e.elevationInfo=new ye.Z(i),e.feature=n}else e.elevationInfo=null,e.feature=null;break;case W.q7.TERRAIN:e.elevationInfo=new ye.Z({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}var r=t.mapPoint.clone();r.z=(0,E.vQ)(this.view,r,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=r}},{key:"_manipulatorClick",value:function(e,t){if(!("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==ze.t.Right||this.analysis.targets.length<=1)){var n=e.metadata.target;this.analysis.targets.remove(n),t.stopPropagation()}}},{key:"testInfo",get:function(){}}]),n}(xe.f);(0,s._)([(0,v.Cb)({constructOnly:!0})],Fe.prototype,"view",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],Fe.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Fe.prototype,"state",null),(0,s._)([(0,v.Cb)({readOnly:!0})],Fe.prototype,"cursor",null),(0,s._)([(0,v.Cb)()],Fe.prototype,"removeIncompleteOnCancel",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Fe.prototype,"updating",null),(0,s._)([(0,v.Cb)({constructOnly:!0})],Fe.prototype,"analysisViewData",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Fe.prototype,"_showTracker",null),(0,s._)([(0,v.Cb)()],Fe.prototype,"_latestPointerMovePointerType",void 0),(0,s._)([(0,v.Cb)()],Fe.prototype,"_shouldRenderTracker",null),(0,s._)([(0,v.Cb)()],Fe.prototype,"_laserlineVisualElement",void 0),(0,s._)([(0,v.Cb)()],Fe.prototype,"_grabbedManipulator",void 0),Fe=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightTool")],Fe);var Ge=(0,fe.Ue)(),Be=n(7025),Ne=function(){function e(t,n,r,o){(0,i.Z)(this,e),this.visibleLineVisualElement=t,this.occludedLineVisualElement=n,this.undefinedLineVisualElement=r,this.targetVisualElement=o}return(0,r.Z)(e,[{key:"destroy",value:function(){this.visibleLineVisualElement.destroy(),this.occludedLineVisualElement.destroy(),this.undefinedLineVisualElement.destroy(),this.targetVisualElement.destroy()}}]),e}(),We=n(33837),qe=n(66730),Xe=(n(56529),function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._lineOfSightVisualElements=new Array,r._computationHandles=new w.Z,r._updatingHandles=new Z.R,r}return(0,r.Z)(n,[{key:"initialize",value:function(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}},{key:"destroy",value:function(){this._updatingHandles=(0,d.SC)(this._updatingHandles),this._computationHandles=(0,d.SC)(this._computationHandles),this._observerVisualElement=(0,d.SC)(this._observerVisualElement)}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"interactiveAndEditable",get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"test",get:function(){}},{key:"_createLineOfSightVisualization",value:function(){var e=ke,t=this.view,n=this.isDecoration,i={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth,isDecoration:n},r=ve.Z.toUnitRGBA(e.visibleOuterColor),o=ve.Z.toUnitRGBA(e.visibleInnerColor),a=ve.Z.toUnitRGBA(e.occludedOuterColor),s=ve.Z.toUnitRGBA(e.occludedInnerColor),l=ve.Z.toUnitRGBA(e.undefinedOuterColor),u=ve.Z.toUnitRGBA(e.undefinedInnerColor),c=new We.r((0,de.Z)((0,de.Z)({},i),{},{color:r,innerColor:o})),d=new We.r((0,de.Z)((0,de.Z)({},i),{},{color:a,innerColor:s})),v=new We.r((0,de.Z)((0,de.Z)({},i),{},{color:l,innerColor:u})),p=new qe.L((0,de.Z)((0,de.Z)({view:t,attached:!0},Je),{},{size:8,isDecoration:n})),h=new Ne(c,d,v,p);return this._lineOfSightVisualElements.push(h),h}},{key:"_destroyLineOfSightVisualization",value:function(e){e.destroy(),this._lineOfSightVisualElements.splice(this._lineOfSightVisualElements.indexOf(e),1)}},{key:"_updateLineOfSightVisualization",value:function(e,t,n){var i=ke,r=e.computationResult,o=e.inputPoints,a=r.start,s=r.end,l=r.intersection,u=r.isValid,c=r.isTargetVisible,d=o.observer,v=Qe;v[12]=d[0],v[13]=d[1],v[14]=d[2];var p=(0,T.f)($e,a,d),h=(0,T.f)(Ye,s,d),y=(0,T.f)(Ke,l,d),g=t.visibleLineVisualElement,_=t.occludedLineVisualElement,m=t.undefinedLineVisualElement,b=t.targetVisualElement,C=null==this.analysisViewData.elevationAlignedObserver||null==e.elevationAlignedTargetLocation,w=this.visible&&!C;g.visible=w,_.visible=w,m.visible=w,b.visible=w,b.attached=!n.interactiveAndEditable,w&&(g.geometry=null,_.geometry=null,m.geometry=null,b.geometry=e.elevationAlignedTargetLocation,u?c?(g.geometry=[[(0,f.nI)(p),(0,f.nI)(h)]],g.transform=v,g.color=ve.Z.toUnitRGBA(i.visibleOuterColor),b.color=ve.Z.toUnitRGBA(i.visibleInnerColor)):(g.geometry=[[(0,f.nI)(p),(0,f.nI)(y)]],g.transform=v,g.color=ve.Z.toUnitRGBA(i.occludedOuterColor),_.geometry=[[(0,f.nI)(y),(0,f.nI)(h)]],_.transform=v,b.color=ve.Z.toUnitRGBA(i.occludedInnerColor)):(m.geometry=[[(0,f.nI)(p),(0,f.nI)(h)]],m.transform=v,b.color=ve.Z.toUnitRGBA(i.undefinedInnerColor)))}},{key:"_getLineOfSightVisualizationDependencies",value:function(e){return{computationResult:e.computationResult,occludedOuterColor:ke.occludedOuterColor,visibleOuterColor:ke.visibleOuterColor,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}},{key:"_connectComputation",value:function(e){var t=this,n=this._computationHandles;if(!n.has(e)){var i=this._createLineOfSightVisualization();n.add([this._updatingHandles.add((function(){return t._getLineOfSightVisualizationDependencies(e)}),(function(n){return t._updateLineOfSightVisualization(e,i,n)}),{initial:!0,equals:function(){return!1}}),(0,k.kB)((function(){return t._destroyLineOfSightVisualization(i)}))],e)}}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e.analysisViewData.computations}),(function(t){return e._onComputationsCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,m.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(u){r.e(u)}finally{r.f()}var a,s=(0,m.Z)(n);try{for(s.s();!(a=s.n()).done;){var l=a.value;this._connectComputation(l)}}catch(u){s.e(u)}finally{s.f()}}},{key:"_createObserverVisualization",value:function(){var e=this,t=ve.Z.toUnitRGBA(ke.visibleInnerColor),n=new qe.L((0,de.Z)((0,de.Z)({view:this.view,color:t},Je),{},{isDecoration:this.isDecoration}));this._observerVisualElement=n,this.addHandles(this._updatingHandles.add((function(){return{observer:e.analysisViewData.elevationAlignedObserver,interactiveAndEditable:e.interactiveAndEditable,visible:e.visible}}),(function(t){var i=t.observer,r=t.interactiveAndEditable,o=t.visible;null!=i&&!r&&o?(n.geometry=i,e._observerVisualElement.attached=!0):n.attached=!1}),O.initial))}}]),n}(l.default));(0,s._)([(0,v.Cb)({constructOnly:!0})],Xe.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],Xe.prototype,"analysisViewData",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0})],Xe.prototype,"view",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],Xe.prototype,"visible",null),(0,s._)([(0,v.Cb)({constructOnly:!0})],Xe.prototype,"isDecoration",void 0),(0,s._)([(0,v.Cb)()],Xe.prototype,"updating",null),(0,s._)([(0,v.Cb)()],Xe.prototype,"interactiveAndEditable",null),(0,s._)([(0,v.Cb)()],Xe.prototype,"test",null),Xe=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],Xe);var Je={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},$e=(0,f.Ue)(),Ye=(0,f.Ue)(),Ke=(0,f.Ue)(),Qe=(0,Be.Ue)(),et=n(70209),tt=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="line-of-sight-view-3d",r.analysis=null,r.tool=null,r.computations=new u.Z,r.elevationAlignedObserver=null,r.observerEngineLocation=(0,f.Ue)(),r.cursorTarget=null,r.editable=!0,r}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view,n=this.analysis;this._analysisController=new ie({analysis:n,analysisViewData:this,view:t}),this._analysisVisualization=new Xe({analysis:n,analysisViewData:this,view:t,isDecoration:!this.parent}),this.addHandles([this._analysisController.on("result-changed",(function(t){t.target!==e.cursorTarget&&e.emit("result-changed",t)})),(0,et.Lp)(this,Fe)])}},{key:"destroy",value:function(){(0,et.Yq)(this),this._analysisController=(0,d.SC)(this._analysisController),this._analysisVisualization=(0,d.SC)(this._analysisVisualization)}},{key:"results",get:function(){return this.computations.map((function(e){return e.result}))}},{key:"priority",get:function(){return this._analysisController.priority},set:function(e){this._analysisController.priority=e}},{key:"updating",get:function(){return null!=this._analysisController&&this._analysisController.updating||null!=this._analysisVisualization&&this._analysisVisualization.updating}},{key:"getResultForTarget",value:function(e){var t;return null===(t=this.computations.find((function(t){return t.target===e})))||void 0===t?void 0:t.result}},{key:"testInfo",get:function(){}}]),n}((0,y.p)(c.Z.EventedMixin(l.default)));(0,s._)([(0,v.Cb)({readOnly:!0})],tt.prototype,"type",void 0),(0,s._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],tt.prototype,"analysis",void 0),(0,s._)([(0,v.Cb)()],tt.prototype,"tool",void 0),(0,s._)([(0,v.Cb)({readOnly:!0})],tt.prototype,"results",null),(0,s._)([(0,v.Cb)()],tt.prototype,"priority",null),(0,s._)([(0,v.Cb)()],tt.prototype,"computations",void 0),(0,s._)([(0,v.Cb)()],tt.prototype,"elevationAlignedObserver",void 0),(0,s._)([(0,v.Cb)()],tt.prototype,"observerEngineLocation",void 0),(0,s._)([(0,v.Cb)()],tt.prototype,"cursorTarget",void 0),(0,s._)([(0,v.Cb)()],tt.prototype,"updating",null),(0,s._)([(0,v.Cb)()],tt.prototype,"editable",void 0),(0,s._)([(0,v.Cb)()],tt.prototype,"_analysisController",void 0),(0,s._)([(0,v.Cb)()],tt.prototype,"_analysisVisualization",void 0);var nt=tt=(0,s._)([(0,h.j)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],tt)},33906:function(e,t,n){n.d(t,{G:function(){return o},e:function(){return a}});var i=n(79803),r=n(77648);function o(e,t,n){var o,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,i.tryProjectWithZConversion)(e,t);return null==s?null:(s.hasZ&&!a||null==n||(s.z=null!==(o=(0,r.KO)(n,s))&&void 0!==o?o:0),s)}function a(e,t,n){n.warnOnce("Failed to project analysis geometry (id: '".concat(e.id,"'), projection from spatial reference (wkid: '").concat(t.wkid,"') to view spatial reference is not supported. Projection may be possible after calling projection.load()."))}},81655:function(e,t,n){n.d(t,{I:function(){return o},c:function(){return a}});var i=n(42537),r=n(74509);function o(e,t){return function(e,t){return!!e&&"on-the-ground"!==t.mode&&!(0,r.fl)(t)}(null===e||void 0===e?void 0:e.data.coordinateHelper.hasZ(),t)}function a(e,t){var n=null,r=e.events.on("grab-changed",(function(i){null!=n&&(n.remove(),n=null),"start"===i.action?(n=e.disableDisplay(),t&&t(i)):t&&t(i)}));return(0,i.kB)((function(){var e;null!==(e=n)&&void 0!==e&&e.remove(),r.remove()}))}},33837:function(e,t,n){n.d(t,{r:function(){return g}});var i=n(37762),r=n(15671),o=n(43144),a=n(60136),s=n(29388),l=n(29134),u=n(7025),c=n(32035),d=n(12400),v=n(86361),p=n(52168),h=n(79685),f=n(56529),y=n(58901),g=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var o;return(0,r.Z)(this,n),(o=t.call(this,e))._hasExternalMaterial=!1,o._hasExternalMaterial=null!=i,o._material=null!=i?i:new y.U({width:1,color:(0,v.al)(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:f.yD.OccludeAndTransparent,isDecoration:!!e.isDecoration,writeDepth:!0}),o.applyProperties(e),o}return(0,o.Z)(n,[{key:"setGeometryFromRenderSpacePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.geometry=[[[e[0]-t,e[1],e[2]],[e[0]+t,e[1],e[2]]],[[e[0],e[1]-t,e[2]],[e[0],e[1]+t,e[2]]],[[e[0],e[1],e[2]-t],[e[0],e[1],e[2]+t]]]}},{key:"setGeometryFromExtent",value:function(e){var t=this.view.spatialReference,n=(0,d.Ue)(),i=(0,d.Ue)(),r=100,o=[];(0,c.s)(n,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),o.push([i[0],i[1],i[2]]),(0,c.s)(n,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),o.push([i[0],i[1],i[2]]),(0,c.s)(n,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),o.push([i[0],i[1],i[2]]),(0,c.s)(n,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),o.push([i[0],i[1],i[2]]),(0,c.s)(n,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),o.push([i[0],i[1],i[2]]),(0,c.s)(n,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),o.push([i[0],i[1],i[2]]),this.geometry=[o]}},{key:"setGeometryFromFrustum",value:function(e){var t=[];e.lines.forEach((function(e){t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}},{key:"setGeometryFromBoundedPlane",value:function(e){var t=[],n=e.origin,i=e.basis1,r=e.basis2,o=.5,a=(0,d.Ue)(),s=(0,d.Ue)(),l=(0,d.Ue)(),u=(0,d.Ue)();a[0]=n[0]-i[0]*o-r[0]*o,a[1]=n[1]-i[1]*o-r[1]*o,a[2]=n[2]-i[2]*o-r[2]*o,s[0]=n[0]-i[0]*o+r[0]*o,s[1]=n[1]-i[1]*o+r[1]*o,s[2]=n[2]-i[2]*o+r[2]*o,l[0]=n[0]+i[0]*o+r[0]*o,l[1]=n[1]+i[1]*o+r[1]*o,l[2]=n[2]+i[2]*o+r[2]*o,u[0]=n[0]+i[0]*o-r[0]*o,u[1]=n[1]+i[1]*o-r[1]*o,u[2]=n[2]+i[2]*o-r[2]*o,t.push([a[0],a[1],a[2]]),t.push([s[0],s[1],s[2]]),t.push([l[0],l[1],l[2]]),t.push([u[0],u[1],u[2]]),t.push([a[0],a[1],a[2]]),this.geometry=[t]}},{key:"setGeometryFromSegment",value:function(e){var t=e.endRenderSpace;this.transform=(0,l.vc)(_,t);var n=e.createRenderGeometry(t,this.view.renderCoordsHelper).points;this.geometry=[n]}},{key:"setGeometryFromSegments",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.AG;this.transform=(0,l.vc)(_,n),this.geometry=e.map((function(e){return e.createRenderGeometry(n,t.view.renderCoordsHelper).points}))}},{key:"getTransformedGeometry",value:function(){var e=this;return null==this._geometry?null:this._geometry.map((function(t){return t.map((function(t){return(0,c.h)((0,d.Ue)(),t,e.transform)}))}))}},{key:"renderOccluded",get:function(){return this._material.parameters.renderOccluded},set:function(e){this._material.setParameters({renderOccluded:e})}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._material.parameters.width},set:function(e){this._material.setParameters({width:e})}},{key:"color",get:function(){return this._material.parameters.color},set:function(e){var t=1===e[3];this._material.setParameters({color:(0,v.d9)(e),writeDepth:t})}},{key:"innerWidth",get:function(){return this._material.parameters.innerWidth},set:function(e){this._material.setParameters({innerWidth:e})}},{key:"innerColor",get:function(){return this._material.parameters.innerColor},set:function(e){this._material.setParameters({innerColor:null!=e?(0,v.d9)(e):null})}},{key:"stipplePattern",get:function(){return this._material.parameters.stipplePattern},set:function(e){null!=this._material&&this._material.setParameters({stipplePattern:e})}},{key:"stippleOffColor",get:function(){return this._material.parameters.stippleOffColor},set:function(e){this._material.setParameters({stippleOffColor:null!=e?(0,v.d9)(e):null})}},{key:"stipplePreferContinuous",get:function(){return this._material.parameters.stipplePreferContinuous},set:function(e){this._material.setParameters({stipplePreferContinuous:e})}},{key:"falloff",get:function(){return this._material.parameters.falloff},set:function(e){this._material.setParameters({falloff:e})}},{key:"polygonOffset",get:function(){return this._material.parameters.hasPolygonOffset},set:function(e){this._material.setParameters({hasPolygonOffset:e})}},{key:"createExternalResources",value:function(){}},{key:"destroyExternalResources",value:function(){}},{key:"createGeometries",value:function(e){var t,n=(0,i.Z)((0,h.c)(this.geometry));try{for(n.s();!(t=n.n()).done;){var r=t.value,o=(0,h.Y)(this._material,r);e.addGeometry(o)}}catch(a){n.e(a)}finally{n.f()}}},{key:"forEachExternalMaterial",value:function(e){this._hasExternalMaterial||e(this._material)}}]),n}(p._),_=(0,u.Ue)()},66730:function(e,t,n){n.d(t,{L:function(){return w}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(16889),l=n(32035),u=n(12400),c=n(19093),d=n(86361),v=n(5986),p=n(41414),h=n(51378),f=n(52168),y=n(69691),g=n(78935),_=n(67794),m=n(70619),b=n(4760),C=n(21400),w=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._material=null,r._texture=null,r._geometry=null,r._size=3,r._color=(0,d.al)(1,0,1,1),r._pixelSnappingEnabled=!0,r._primitive="square",r._outlineSize=1,r._outlineColor=(0,d.al)(1,1,1,1),r._elevationInfo=null,r.applyProperties(e),r}return(0,r.Z)(n,[{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"size",get:function(){return this._size},set:function(e){if(e!==this._size){var t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}},{key:"color",get:function(){return this._color},set:function(e){(0,c.a)(e,this._color)||((0,c.c)(this._color,e),this._updateMaterial())}},{key:"pixelSnappingEnabled",get:function(){return this._pixelSnappingEnabled},set:function(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}},{key:"primitive",get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,this.recreate())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,c.a)(e,this._outlineColor)||((0,c.c)(this._outlineColor,e),this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"_updateMaterial",value:function(){this._material&&this._material.setParameters(this._materialParameters)}},{key:"_updateSizeAttribute",value:function(){var e=this.object;if(null!=e){var t=e.geometries[0];if(null!=t){var n=t.getMutableAttribute(b.T.SIZE).data,i=this._geometrySize;n[0]=i,n[1]=i,e.geometryVertexAttributeUpdated(e.geometries[0],b.T.SIZE)}}}},{key:"_materialParameters",get:function(){var e;return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,_.Rg)(this._primitive),distanceFieldBoundingBox:I,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:null===(e=this._texture)||void 0===e?void 0:e.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}},{key:"_geometrySize",get:function(){return this._size/k}},{key:"createExternalResources",value:function(){this._texture=(0,_.cU)(this._primitive,this._preferredTextureSize),this._material=new C.A(this._materialParameters);var e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}},{key:"destroyExternalResources",value:function(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}},{key:"createGeometries",value:function(e){var t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}},{key:"forEachExternalMaterial",value:function(e){this._material&&e(this._material)}},{key:"_preferredTextureSize",get:function(){return(0,s.uZ)(2*this._geometrySize,16,128)}},{key:"calculateMapBounds",value:function(e){var t,n=null===(t=this.object)||void 0===t?void 0:t.geometries[0];if(!n)return!1;var i=n.attributes.get(b.T.POSITION).data;return(0,v.S)(i,this.view.renderCoordsHelper.spatialReference,O,this.view.spatialReference),(0,p.G1)(e,O),!0}},{key:"_createRenderGeometry",value:function(){var e=this.geometry,t=this._material;if(null==e||null==t)return null;var n=this.view,i=n.renderCoordsHelper,r=n.elevationProvider,o=(0,y.w7)(e,r,g.o.fromElevationInfo(this.elevationInfo),i),a=(0,l.s)(h.WM.get(),e.x,e.y,o),s=h.WM.get();(0,v.S)(a,e.spatialReference,s,i.spatialReference);var u=this._geometrySize;return(0,m.dV)(t,null,s,null,[u,u],[0,0,0,1])}}]),n}(f._),k=_.hy,I=[k/2,k/2,1-k/2,1-k/2],O=(0,u.Ue)()},70209:function(e,t,n){n.d(t,{Er:function(){return u},Lp:function(){return c},Yq:function(){return d}});var i=n(74165),r=n(15861),o=n(14921),a=n(92026),s=n(66978),l=n(94172);function u(e,t){e.interactive=!0;var n=e.tool,u=e.view;u.activeTool=n;var c=(0,s.fu)(t,(function(){u.activeTool===n&&(u.activeTool=null)}));return(0,o.vr)(function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.whenOnce)((function(){return null==n||!n.active}),t);case 2:c=(0,a.hw)(c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t)}function c(e,t){return(0,l.watch)((function(){return e.interactive}),(function(){return function(e,t){e.interactive?function(e,t){d(e);var n=e.view,i=e.analysis,r=new t({view:n,analysis:i,analysisViewData:e});e.tool=r,n.tools.add(r)}(e,t):d(e)}(e,t)}),l.syncAndInitial)}function d(e){var t=e.view,n=e.tool;null!=n&&(t.tools.remove(n),e.tool=null)}},86509:function(e,t,n){n.d(t,{f:function(){return c}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(27366),l=n(94172),u=(n(32718),n(93169),n(84936),n(10064),n(69912)),c=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,l.watch)((function(){return e.analysisViewData.visible}),(function(t){return e.visible=t}),l.syncAndInitial))}},{key:"deactivate",value:function(){this.onDeactivate(),this.created||this.analysis.clear()}},{key:"resetCreated",value:function(){this._set("created",!1)}}]),n}(n(45900).m);c=(0,s._)([(0,u.j)("esri.views.interactive.AnalysisToolBase")],c)},94163:function(e,t,n){n.d(t,{SP:function(){return i},UG:function(){return d},dU:function(){return c},k0:function(){return l},xO:function(){return u}});n(16889);var i,r=n(13611),o=n(6644);function a(e,t){return e[0]*t[1]-e[1]*t[0]}function s(e,t,n){var i=(0,r.AK)(n,t)/(0,r.we)(n);return(0,r.bA)(e,n,i)}function l(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n;return(0,r.$X)(p,i,n),(0,r.$X)(f,t,o),s(y,f,p),(0,r.IH)(e,o,y)}function u(e,t,n,i){(0,r.$X)(p,t,n);var o=i/(0,r.kE)(p);return(0,r.od)(e,n,p,o)}function c(e,t){var n=e.start,o=e.end,s=t.start,l=t.end,u=(0,r.$X)(p,o,n),c=(0,r.$X)(h,l,s),d=a(u,c);if(Math.abs(d)<=v)return[];var g=(0,r.$X)(f,n,s),_=a(c,g)/d,m=a(u,g)/d;if(_>=0){if(m>=0||t.type===i.LINE)return[(0,r.od)(y,n,u,_)]}else if(e.type===i.LINE&&(m>=0||t.type===i.LINE))return[(0,r.od)(y,n,u,_)];return[]}function d(e,t,n){var o=[],a=(0,r.$X)(p,e.end,e.start),s=(0,r.$X)(h,e.start,t),l=(0,r.we)(a),u=2*(0,r.AK)(a,s),c=u*u-4*l*((0,r.we)(s)-n*n);if(0===c){var d=-u/(2*l);(e.type===i.LINE||d>=0)&&o.push((0,r.od)(y,e.start,a,d))}else if(c>0){var v=Math.sqrt(c),g=(-u+v)/(2*l);(e.type===i.LINE||g>=0)&&o.push((0,r.od)(y,e.start,a,g));var _=(-u-v)/(2*l);(e.type===i.LINE||_>=0)&&o.push((0,r.od)(f,e.start,a,_))}return o}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(i||(i={}));var v=1e-6,p=(0,o.Ue)(),h=(0,o.Ue)(),f=(0,o.Ue)(),y=(0,o.Ue)()}}]);
//# sourceMappingURL=28050.bc29413c.chunk.js.map