"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[48506],{25666:function(e,r,t){t.d(r,{cn:function(){return n},j:function(){return u},lK:function(){return i}});var n="updating";function i(e){return"updating"===e?null:e}function u(e){return"updating"===e}},15801:function(e,r,t){t.d(r,{Z:function(){return _}});var n,i=t(15671),u=t(43144),a=t(60136),l=t(29388),s=t(27366),o=t(80987),d=t(93002),c=t(51370),y=t(49861),f=(t(93169),t(32718),t(84936),t(69912)),p=t(59147),h=t(58550),v={type:o.Z,readOnly:!0,json:{origins:{service:{read:{source:"sublayers",reader:g}}},read:!1}};function g(e,r,t){if(e&&Array.isArray(e))return new o.Z(e.map((function(e){var r=function(e){return"group"===e.layerType?w:p.Z}(e);if(r){var n=new r;return n.read(e,t),n}return null!==t&&void 0!==t&&t.messages&&e&&t.messages.push(new c.Z("building-scene-layer:unsupported-sublayer-type","Building scene sublayer of type '"+(e.type||"unknown")+"' are not supported",{definition:e,context:t})),null})))}var b,w=n=function(e){(0,a.Z)(t,e);var r=(0,l.Z)(t);function t(e){var n;return(0,i.Z)(this,t),(n=r.call(this,e)).type="building-group",n.listMode="show",n.sublayers=null,n}return(0,u.Z)(t,[{key:"loadAll",value:function(){var e=this;return(0,d.w)(this,(function(r){return n.forEachSublayer(e.sublayers,(function(e){"building-group"!==e.type&&r(e)}))}))}}]),t}(h.Z);(0,s._)([(0,y.Cb)({type:["hide","show","hide-children"],json:{write:!0}})],w.prototype,"listMode",void 0),(0,s._)([(0,y.Cb)(v)],w.prototype,"sublayers",void 0),w=n=(0,s._)([(0,f.j)("esri.layers.buildingSublayers.BuildingGroupSublayer")],w),(b=w||(w={})).sublayersProperty=v,b.readSublayers=g,b.forEachSublayer=function e(r,t){r.forEach((function(r){t(r),"building-group"===r.type&&e(r.sublayers,t)}))};var _=w},30494:function(e,r,t){t.d(r,{T:function(){return s}});var n=t(74165),i=t(1413),u=t(15861),a=t(76200),l=t(10064);function s(e,r,t,n,i,u,a){return o.apply(this,arguments)}function o(){return o=(0,u.Z)((0,n.Z)().mark((function e(r,t,u,s,o,d,c){var y,f,p,h,v,g;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y=null,null==u){e.next=17;break}return f="".concat(r,"/nodepages/"),p=f+Math.floor(u.rootIndex/u.nodesPerPage),e.prev=3,e.next=6,(0,a.Z)(p,{query:(0,i.Z)((0,i.Z)({f:"json"},s),{},{token:o}),responseType:"json",signal:c});case 6:return e.t0=e.sent.data,e.t1=u.rootIndex,e.t2=u.nodesPerPage,e.t3=u.lodSelectionMetricType,e.t4=f,e.abrupt("return",{type:"page",rootPage:e.t0,rootIndex:e.t1,pageSize:e.t2,lodMetric:e.t3,urlPrefix:e.t4});case 14:e.prev=14,e.t5=e.catch(3),null!=d&&d.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",p,e.t5),y=e.t5;case 17:if(t){e.next=19;break}return e.abrupt("return",null);case 19:return h=null===t||void 0===t?void 0:t.split("/").pop(),v="".concat(r,"/nodes/"),g=v+h,e.prev=20,e.next=23,(0,a.Z)(g,{query:(0,i.Z)((0,i.Z)({f:"json"},s),{},{token:o}),responseType:"json",signal:c});case 23:return e.t6=e.sent.data,e.t7=v,e.abrupt("return",{type:"node",rootNode:e.t6,urlPrefix:e.t7});case 28:throw e.prev=28,e.t8=e.catch(20),new l.Z("sceneservice:root-node-missing","Root node missing.",{pageError:y,nodeError:e.t8,url:g});case 31:case"end":return e.stop()}}),e,null,[[3,14],[20,28]])}))),o.apply(this,arguments)}},7452:function(e,r,t){t.r(r),t.d(r,{default:function(){return ce}});var n,i,u=t(74165),a=t(29439),l=t(15861),s=t(37762),o=t(15671),d=t(43144),c=t(60136),y=t(29388),f=t(27366),p=t(52639),h=t(7138),v=t(63780),g=t(80987),b=t(42537),w=t(32718),_=t(92026),m=t(66978),F=t(94172),x=t(49861),E=(t(93169),t(69912)),k=(t(15801),t(93433)),Z=t(88301),C=t(61120),S=t(10064),I=(t(84936),t(54054)),V=(t(59147),t(18661)),M=t(37270),A=t(21149),L=t(91505),R=t(79056),q=t(67426),O=function(e,r){var t=function(e){(0,c.Z)(t,e);var r=(0,y.Z)(t);function t(e){var n;return(0,o.Z)(this,t),(n=r.call(this,e)).sublayer=null,n.parent=null,n.view=null,n}return(0,d.Z)(t,[{key:"initialize",value:function(){}},{key:"suspended",get:function(){return!this.canResume()}},{key:"updating",get:function(){return!this.suspended&&this.isUpdating()}},{key:"visible",get:function(){var e;return!(null===(e=this.sublayer)||void 0===e||!e.visible)},set:function(e){this._overrideIfSome("visible",e)}},{key:"fullOpacity",get:function(){var e,r,t=function(e){return null!=e?e:1};return t(null===(e=this.sublayer)||void 0===e?void 0:e.opacity)*t(null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)}},{key:"canResume",value:function(){var e,r;return!(null!==(e=this.parent)&&void 0!==e&&e.suspended)&&(null===(r=this.view)||void 0===r?void 0:r.ready)&&this.visible||!1}},{key:"isUpdating",value:function(){return!1}}]),t}((0,q.v)((0,R.IG)(L.Z.EventedMixin(e))));return(0,f._)([(0,x.Cb)()],t.prototype,"sublayer",void 0),(0,f._)([(0,x.Cb)()],t.prototype,"parent",void 0),(0,f._)([(0,x.Cb)({readOnly:!0})],t.prototype,"suspended",null),(0,f._)([(0,x.Cb)({type:Boolean,readOnly:!0})],t.prototype,"updating",null),(0,f._)([(0,x.Cb)()],t.prototype,"view",void 0),(0,f._)([(0,x.Cb)()],t.prototype,"visible",null),(0,f._)([(0,x.Cb)()],t.prototype,"fullOpacity",null),t=(0,f._)([(0,E.j)("esri.views.3d.layers.BuildingSublayerView3D")],t)},T=t(43629),P=t(42757),Q=t(1413),D=t(86361),j=t(97689),N=t(49420);(i=n||(n={}))[i.Solid=0]="Solid",i[i.WireFrame=1]="WireFrame",i[i.XRay=2]="XRay";function B(e){switch(e.filterMode.type){case"solid":return{mode:n.Solid};case"wire-frame":return{mode:n.WireFrame,edgeMaterial:(0,j.C8)(e.filterMode.edges,{})};case"x-ray":return{mode:n.XRay}}}function G(e,r){if(null==r)return e.color[3]=0,e.edgeMaterial=null,void(e.pickable=!1);switch(r.mode){case n.Solid:return;case n.WireFrame:return e.color[3]=0,e.edgeMaterial=r.edgeMaterial,void(e.pickable=!1);case n.XRay:return e.color[0]=1,e.color[1]=1,e.color[2]=1,e.color[3]*=.15,e.colorMixMode=N.a9.Replace,e.castShadows=!1,e.pickable=!1,void(e.edgeMaterial=function(e){return null==e?null:(z.lastMaterial!==e&&(z.cachedMaterial=function(e){var r=(0,D.d9)(e.color);return r[3]*=.075,(0,Q.Z)((0,Q.Z)({},e),{},{color:r})}(e),z.lastMaterial=e),z.cachedMaterial)}(e.edgeMaterial))}}var z={cachedMaterial:null,lastMaterial:null},H=t(31730),U=t(71039),W=t(43812),J=t(51246),X=t(73552),Y=t(44011),K=t(1247),$=t(77057),ee=(t(75505),t(86741),t(51370),function(e){(0,c.Z)(t,e);var r=(0,y.Z)(t);function t(){var e;return(0,o.Z)(this,t),(e=r.apply(this,arguments)).sublayer=null,e}return(0,d.Z)(t,[{key:"updating",get:function(){return!1}},{key:"suspended",get:function(){return!1}},{key:"availableFields",get:function(){return[]}},{key:"filter",get:function(){return null},set:function(e){throw new Error("Not implemented")}},{key:"queryFeatures",value:function(e,r){throw new Error("Not implemented")}},{key:"queryObjectIds",value:function(e,r){throw new Error("Not implemented")}},{key:"queryFeatureCount",value:function(e,r){throw new Error("Not implemented")}},{key:"createQuery",value:function(){throw new Error("Not implemented")}},{key:"queryExtent",value:function(e,r){throw new Error("Not implemented")}},{key:"highlight",value:function(e){throw new Error("Not implemented")}}]),t}(h.default));(0,f._)([(0,x.Cb)()],ee.prototype,"sublayer",void 0),(0,f._)([(0,x.Cb)()],ee.prototype,"availableFields",null),(0,f._)([(0,x.Cb)()],ee.prototype,"filter",null);var re=t(24405),te=t(69787),ne=t(93463),ie=function(e){(0,c.Z)(t,e);var r=(0,y.Z)(t);function t(){var e;return(0,o.Z)(this,t),(e=r.apply(this,arguments)).type="building-component-sublayer-3d",e.layerView=null,e._elevationContext="scene",e._isIntegratedMesh=!1,e._supportsLabeling=!1,e.requiredFields=[],e.progressiveLoadFactor=1,e._queryEngine=null,e}return(0,d.Z)(t,[{key:"i3slayer",get:function(){return this.sublayer}},{key:"layerUid",get:function(){return this.sublayer.layer.uid}},{key:"sublayerUid",get:function(){return this.sublayer.uid}},{key:"layerId",get:function(){return this.sublayer.layer.id}},{key:"sublayerId",get:function(){return this.sublayer.id}},{key:"layerPopupEnabledAndHasTemplate",get:function(){var e,r;return this.sublayer.popupEnabled&&(0,re.zc)(this.sublayer,null===(e=this.layerView)||void 0===e||null===(r=e.view.popup)||void 0===r?void 0:r.defaultPopupTemplateEnabled)}},{key:"initialize",value:function(){var e=this;this._updatingHandles.add((function(){return e.mergedFilter}),(function(r){null!=r&&U.z.checkSupport(r)?null==e._i3sFilter?e._i3sFilter=new U.z({viewFilter:r,layerFieldsIndex:e.sublayer.fieldsIndex,loadAsyncModule:function(r){return e._loadAsyncModule(r)},addSqlFilter:function(r,t){return e.addSqlFilter(r,t,e.logError)},addTimeFilter:function(r,t){return e.addTimeFilter(r,t)}}):e._i3sFilter.viewFilter=r:e._i3sFilter=(0,_.SC)(e._i3sFilter)}),F.syncAndInitial),this._updatingHandles.add((function(){return[e.sublayer.renderer,e.definitionExpressionFields,e.filterExpressionFields]}),(function(){return e._updateRequiredFields()})),this._updatingHandles.add((function(){return e.sublayer.renderer}),(function(r){return e._rendererChange(r)}),F.initial);var r=function(){return e._filterChange()};this._updatingHandles.add((function(){return e.parsedDefinitionExpression}),r),this._updatingHandles.add((function(){var r;return null===(r=e._i3sFilter)||void 0===r?void 0:r.sortedObjectIds}),r),this._updatingHandles.add((function(){var r;return null===(r=e._i3sFilter)||void 0===r?void 0:r.parsedWhereClause}),r),this._updatingHandles.add((function(){return e.getTimeFilterDependencies()}),r),this._updatingHandles.add((function(){return e.mergedFilter}),r),this._updatingHandles.add((function(){var r,t;return[null===(r=e._i3sFilter)||void 0===r?void 0:r.parsedGeometry,null===(t=e.filter)||void 0===t?void 0:t.spatialRelationship]}),(function(){return e._geometryFilterChange()})),this._updatingHandles.add((function(){return e.parsedFilterExpressions}),(function(){return e._updateSymbologyOverride()}),F.initial),this.addResolvingPromise(this._updateRequiredFields())}},{key:"lodFactor",get:function(){return this.view.qualitySettings.sceneService.object.lodFactor}},{key:"parsedFilterExpressions",get:function(){var e=this;return"Overview"!==this.sublayer.modelName&&this.layerView?this.layerView.filterExpressions.map((function(r){var t,i=(0,a.Z)(r,2),u=i[0],l=i[1];try{t=I.WhereClause.create(u,e.sublayer.fieldsIndex)}catch(n){return w.Z.getLogger(e).error("Failed to parse filterExpression: "+n),null}if(!t.isStandardized)return w.Z.getLogger(e).error("filterExpression is using non standard function"),null;var s=[],o=t.fieldNames;return(0,Y.e8)(o,e.sublayer.fields,{missingFields:s}),s.length>0?(w.Z.getLogger(e).error("filterExpression references unknown fields: ".concat(s.join(", "))),null):[t,l]})).filter((function(e){return null!=e})):[]}},{key:"filter",get:function(){return this._get("filter")},set:function(e){this._set("filter",U.z.checkSupport(e)?e:null)}},{key:"isUpdating",value:function(){var e,r;return(0,Z.Z)((0,C.Z)(t.prototype),"isUpdating",this).call(this)||null!==(e=null===(r=this._i3sFilter)||void 0===r?void 0:r.updating)&&void 0!==e&&e}},{key:"_updateSymbologyOverride",value:function(){var e=this,r=this.parsedFilterExpressions;r.length>0?this._setSymbologyOverride((function(t,n){var i,u=(0,s.Z)(r);try{for(u.s();!(i=u.n()).done;){var l=(0,a.Z)(i.value,2),o=l[0],d=l[1];try{if(o.testFeature(t))return G(n,d)}catch(B){e.logError(B)}}}catch(c){u.e(c)}finally{u.f()}return G(n,null)}),this.filterExpressionFields):this._setSymbologyOverride(null,null)}},{key:"filterExpressionFields",get:function(){return(0,M.Q0)(this.sublayer.fieldsIndex,this.parsedFilterExpressions.reduce((function(e,r){var t=(0,a.Z)(r,1)[0];return e.concat(t.fieldNames)}),new Array))}},{key:"availableFields",get:function(){var e=this.sublayer,r=e.fieldsIndex,t=this.requiredFields;if(e.outFields||e.layer.outFields){var n=[].concat((0,k.Z)(e.outFields||[]),(0,k.Z)(e.layer.outFields||[]));t=[].concat((0,k.Z)((0,M.Lk)(r,n)),(0,k.Z)(t))}return(0,M.Q0)(r,t)}},{key:"_createLayerGraphic",value:function(e){return new p.Z({attributes:e,layer:this.sublayer.layer,sourceLayer:this.sublayer})}},{key:"canResume",value:function(){return(0,Z.Z)((0,C.Z)(t.prototype),"canResume",this).call(this)&&(0,te.GB)(this.i3slayer.effectiveScaleRange,this.view.terrainScale)&&(!this._controller||this._controller.rootNodeVisible)}},{key:"fetchPopupFeaturesFromGraphics",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,i,a,l,o,d,c,y,f,p=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this._validateFetchPopupFeatures(t))){e.next=3;break}throw n;case 3:if(0!==r.length){e.next=5;break}return e.abrupt("return",[]);case 5:if(i=[],a=[],null==this.sublayer.associatedLayer){e.next=13;break}return e.next=10,this.sublayer.associatedLayer.load(t);case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0=this.sublayer;case 14:return l=e.t0,e.t1=M.Lk,e.t2=this.sublayer.fieldsIndex,e.next=19,(0,re.e7)(l,(0,re.V5)(this.sublayer,t));case 19:e.t3=e.sent,o=(0,e.t1)(e.t2,e.t3),(0,m.k_)(t),d=new Set,c=(0,s.Z)(r);try{for(c.s();!(y=c.n()).done;)f=y.value,(0,M.Gm)(o,f,d)?a.push(f):i.push(f)}catch(u){c.e(u)}finally{c.f()}if(0!==a.length){e.next=29;break}e.t4=i,e.next=34;break;case 29:if(e.t5=null!=this.sublayer.associatedLayer,!e.t5){e.next=33;break}return e.next=33,this.sublayer.associatedLayer.load().catch((function(){return w.Z.getLogger(p).warn("Failed to load associated feature layer. Displaying popup attributes from cached attributes.")}));case 33:e.t4=this.whenGraphicAttributes(a,Array.from(d)).catch((function(e){return(0,m.r9)(e),a})).then((function(e){return i.concat(e)}));case 34:return e.abrupt("return",e.t4);case 35:case"end":return e.stop()}}),e,this)})));return function(r,t){return e.apply(this,arguments)}}()},{key:"_updateRequiredFields",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=M.Q0,e.t1=this.sublayer.fieldsIndex,e.t2=[],e.t3=k.Z,!this.sublayer.renderer){e.next=10;break}return e.next=7,this.sublayer.renderer.getRequiredFields(this.sublayer.fieldsIndex);case 7:e.t4=e.sent,e.next=11;break;case 10:e.t4=[];case 11:e.t5=e.t4,e.t6=(0,e.t3)(e.t5),e.t7=(0,k.Z)(this.definitionExpressionFields),e.t8=(0,k.Z)(this.filterExpressionFields),e.t9=e.t2.concat.call(e.t2,e.t6,e.t7,e.t8),r=(0,e.t0)(e.t1,e.t9),this._set("requiredFields",r);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_validateFetchPopupFeatures",value:function(e){var r=this.sublayer;return r.popupEnabled?(0,re.V5)(r,e)?void 0:new S.Z("buildingscenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{sublayer:r}):new S.Z("buildingscenelayerview3d:fetchPopupFeatures","Popups are disabled",{sublayer:r})}},{key:"getFilters",value:function(){var e,r=(0,Z.Z)((0,C.Z)(t.prototype),"getFilters",this).call(this);return this.addSqlFilter(r,this.parsedDefinitionExpression,this.logError),null!==(e=this._i3sFilter)&&void 0!==e&&e.addFilters(r,this.view,this._controller.crsIndex,this._collection),r}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(e):new A.Z(e)}},{key:"queryExtent",value:function(e,r){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e),null===r||void 0===r?void 0:r.signal)}},{key:"queryFeatureCount",value:function(e,r){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e),null===r||void 0===r?void 0:r.signal)}},{key:"queryFeatures",value:function(e,r){var t=this;return this._ensureQueryEngine().executeQuery(this._ensureQuery(e),null===r||void 0===r?void 0:r.signal).then((function(e){if(null===e||void 0===e||!e.features)return e;var r,n=t.sublayer,i=n.layer,u=(0,s.Z)(e.features);try{for(u.s();!(r=u.n()).done;){var a=r.value;a.layer=i,a.sourceLayer=n}}catch(l){u.e(l)}finally{u.f()}return e}))}},{key:"queryObjectIds",value:function(e,r){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e),null===r||void 0===r?void 0:r.signal)}},{key:"_ensureQueryEngine",value:function(){return null==this._queryEngine&&(this._queryEngine=this._createQueryEngine()),this._queryEngine}},{key:"_createQueryEngine",value:function(){var e=this,r=(0,H.gz)(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new W.u({layerView:this,priority:ne.T8.FEATURE_QUERY_ENGINE,spatialIndex:new X.I({featureAdapter:new J.u({objectIdField:this.sublayer.objectIdField,attributeStorageInfo:this.sublayer.attributeStorageInfo,getFeatureExtent:r}),forAllFeatures:function(r,t){return e._forAllFeatures((function(e,t,n){return r({id:e,index:t,meta:n})}),t,P.p1.QUERYABLE)},getFeatureExtent:r,sourceSpatialReference:(0,Y.tp)(this.sublayer),viewSpatialReference:this.view.spatialReference})})}},{key:"_ensureQuery",value:function(e){return this._addDefinitionExpressionToQuery(null==e?this.createQuery():A.Z.from(e))}}]),t}((0,$.q)((0,K.l)((0,T.N)(O(ee)))));(0,f._)([(0,x.Cb)()],ie.prototype,"i3slayer",null),(0,f._)([(0,x.Cb)()],ie.prototype,"layerView",void 0),(0,f._)([(0,x.Cb)()],ie.prototype,"lodFactor",null),(0,f._)([(0,x.Cb)({readOnly:!0})],ie.prototype,"parsedFilterExpressions",null),(0,f._)([(0,x.Cb)({type:V.Z})],ie.prototype,"filter",null),(0,f._)([(0,x.Cb)()],ie.prototype,"_i3sFilter",void 0),(0,f._)([(0,x.Cb)({type:[String],readOnly:!0})],ie.prototype,"filterExpressionFields",null),(0,f._)([(0,x.Cb)({type:[String],readOnly:!0})],ie.prototype,"requiredFields",void 0),(0,f._)([(0,x.Cb)({type:[String],readOnly:!0})],ie.prototype,"availableFields",null);var ue=ie=(0,f._)([(0,E.j)("esri.views.3d.layers.BuildingComponentSublayerView3D")],ie),ae=t(42069),le=t(58890),se=function(e){(0,c.Z)(t,e);var r=(0,y.Z)(t);function t(e){var n;return(0,o.Z)(this,t),(n=r.call(this,e)).layer=null,n.sublayerViews=null,n}return(0,d.Z)(t,[{key:"highlight",value:function(e){throw new Error("Not implemented")}}]),t}(t(67581).Z);(0,f._)([(0,x.Cb)()],se.prototype,"layer",void 0),(0,f._)([(0,x.Cb)()],se.prototype,"sublayerViews",void 0);var oe=O(h.default),de=function(e){(0,c.Z)(t,e);var r=(0,y.Z)(t);function t(e){var n;return(0,o.Z)(this,t),(n=r.call(this,e)).type="building-scene-3d",n.sublayerViews=new g.Z,n._abortController=new AbortController,n._loadingComponents=0,n._pendingWhenSublayerViews=new Map,n.ignoresMemoryFactor=!1,n}return(0,d.Z)(t,[{key:"filterExpression",get:function(){var e,r=this.layer.activeFilterId,t=null!=r?this.layer.filters.find((function(e){return e.id===r})):null,n=null!=t?null===(e=t.filterBlocks)||void 0===e?void 0:e.find((function(e){return"solid"===e.filterMode.type})):null;return n?n.filterExpression:null}},{key:"filterExpressions",get:function(){var e=this.layer.activeFilterId,r=null!=e?this.layer.filters.find((function(r){return r.id===e})):null;return null!==r&&void 0!==r&&r.filterBlocks?r.filterBlocks.toArray().map((function(e){var r;return[null!==(r=e.filterExpression)&&void 0!==r?r:"",B(e)]})):[]}},{key:"updatingProgressValue",get:function(){var e=this.sublayerViews,r=this._loadingComponents+(e?e.length:0);return e.reduce((function(e,r){return e+r.updatingProgress}),0)/r}},{key:"visibleAtCurrentScale",get:function(){return(0,te.GB)(this.layer.effectiveScaleRange,this.view.terrainScale)}},{key:"isUpdating",value:function(){return this._loadingComponents>0||this.sublayerViews&&this.sublayerViews.some((function(e){return e.updating}))}},{key:"initialize",value:function(){(0,Y.Jf)(this.layer.spatialReference,this.view.spatialReference,this.view.viewingMode),this._initializeSubLayerViews(this.layer.sublayers,this)}},{key:"destroy",value:function(){this.sublayerViews&&(this.sublayerViews.forEach((function(e){return e.destroy()})),this.sublayerViews=null),this._abortController=(0,_.IM)(this._abortController)}},{key:"_initializeSubLayerViews",value:function(e,r){var t=this,n=this,i=this.view;e.forEach((function(e){if(!e.isEmpty)if("building-group"===e.type){var u=new oe({sublayer:e,view:i,parent:r});t._initializeSubLayerViews(e.sublayers,u)}else"mesh"===e.geometryType&&(t._loadingComponents++,e.load({signal:t._abortController.signal}).then((function(){var u=new ue({sublayer:e,layerView:n,view:i,parent:r});t.sublayerViews.push(u);var a=t._pendingWhenSublayerViews.get(e);if(a){var l,o=(0,s.Z)(a);try{for(o.s();!(l=o.n()).done;){l.value.resolve(u)}}catch(d){o.e(d)}finally{o.f()}t._pendingWhenSublayerViews.delete(e)}t.addHandles([(0,F.watch)((function(){return u.updating}),(function(){return t.notifyChange("updating")}),F.syncAndInitial),(0,F.watch)((function(){return u.updatingProgress}),(function(){return t.notifyChange("updatingProgressValue")}),F.syncAndInitial)])})).catch((function(r){(0,m.D_)(r)||w.Z.getLogger(t).error("Error while creating view for sublayer ".concat(e.id,"\nLayer: ").concat(t.layer.url,"\n"),r)})).then((function(){t._loadingComponents--,t.notifyChange("updating"),t.notifyChange("updatingProgressValue")})))}))}},{key:"getGraphicFromIntersectorTarget",value:function(e){var r,t=(0,s.Z)(this.sublayerViews.items);try{for(t.s();!(r=t.n()).done;){var n=r.value;if(n.sublayer.uid===e.sublayerUid)return n.getGraphicFromIntersectorTarget(e)}}catch(i){t.e(i)}finally{t.f()}return null}},{key:"fetchPopupFeaturesFromGraphics",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,i,l,o,d,c,y,f,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==r.length){e.next=2;break}return e.abrupt("return",[]);case 2:n=(0,v.Ms)(r,(function(e){return e.sourceLayer})),i=[],l=(0,s.Z)(n);try{for(l.s();!(o=l.n()).done;)d=(0,a.Z)(o.value,2),c=d[0],y=d[1],null!=(f=this._findComponent(c))&&i.push(f.fetchPopupFeaturesFromGraphics(y,t))}catch(u){l.e(u)}finally{l.f()}return e.next=7,(0,m.OT)(i);case 7:return p=e.sent,e.abrupt("return",((0,m.k_)(t),p.flat()));case 9:case"end":return e.stop()}}),e,this)})));return function(r,t){return e.apply(this,arguments)}}()},{key:"whenGraphicBounds",value:function(e){var r=this._findComponent(e.sourceLayer);return null==r?Promise.reject():r.whenGraphicBounds(e)}},{key:"getAABBFromIntersectorTarget",value:function(e){var r,t=(0,s.Z)(this.sublayerViews.items);try{for(t.s();!(r=t.n()).done;){var n=r.value;if(n.sublayer.uid===e.sublayerUid)return n.getAABBFromIntersectorTarget(e)}}catch(i){t.e(i)}finally{t.f()}return null}},{key:"whenSublayerView",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=this._findComponent(r))){e.next=3;break}return e.abrupt("return",t);case 3:return n=this._pendingWhenSublayerViews.get(r),i=(0,m.hh)(),e.abrupt("return",(n?n.push(i):this._pendingWhenSublayerViews.set(r,[i]),i.promise));case 5:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}()},{key:"_findComponent",value:function(e){return this.sublayerViews.find((function(r){return e===r.sublayer}))}},{key:"highlight",value:function(e){e instanceof p.Z?e=[e]:e instanceof g.Z&&(e=e.toArray());var r=[];if(Array.isArray(e)&&e.length>0&&e[0]instanceof p.Z){var t,n=e,i=new Map,u=(0,s.Z)(n);try{for(u.s();!(t=u.n()).done;){var a=t.value,l=i.get(a.sourceLayer);null==l&&(l=[],i.set(a.sourceLayer,l)),l.push(a)}}catch(o){u.e(o)}finally{u.f()}this.sublayerViews.forEach((function(e){var t=i.get(e.sublayer);t&&r.push(e.highlight(t))}))}return(0,b.AL)(r)}},{key:"usedMemory",get:function(){return this.sublayerViews.reduce((function(e,r){return e+r.usedMemory}),0)}},{key:"unloadedMemory",get:function(){return this.sublayerViews.reduce((function(e,r){return e+r.unloadedMemory}),0)}}]),t}((0,ae.A)(se));(0,f._)([(0,x.Cb)()],de.prototype,"sublayerViews",void 0),(0,f._)([(0,x.Cb)({readOnly:!0})],de.prototype,"filterExpression",null),(0,f._)([(0,x.Cb)({readOnly:!0})],de.prototype,"filterExpressions",null),(0,f._)([(0,x.Cb)(le.q)],de.prototype,"updatingProgress",void 0),(0,f._)([(0,x.Cb)({readOnly:!0,dependsOn:[]})],de.prototype,"updatingProgressValue",null),(0,f._)([(0,x.Cb)({readOnly:!0})],de.prototype,"visibleAtCurrentScale",null);var ce=de=(0,f._)([(0,E.j)("esri.views.3d.layers.BuildingSceneLayerView3D")],de)},1247:function(e,r,t){t.d(r,{l:function(){return p}});var n=t(15671),i=t(43144),u=t(97326),a=t(60136),l=t(29388),s=t(27366),o=t(32718),d=t(49861),c=(t(93169),t(84936),t(69912)),y=t(54054),f=t(44011),p=function(e){var r=function(e){(0,a.Z)(t,e);var r=(0,l.Z)(t);function t(){var e;return(0,n.Z)(this,t),(e=r.apply(this,arguments))._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e.logError=function(r){e._definitionExpressionErrors<e._maxDefinitionExpressionErrors&&o.Z.getLogger((0,u.Z)(e)).error("Error while evaluating definitionExpression: "+r),e._definitionExpressionErrors++,e._definitionExpressionErrors===e._maxDefinitionExpressionErrors&&o.Z.getLogger((0,u.Z)(e)).error("Further errors are ignored")},e}return(0,i.Z)(t,[{key:"parsedDefinitionExpression",get:function(){var e;if(null===(e=this.i3slayer)||void 0===e||!e.definitionExpression)return null;try{var r=y.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!r.isStandardized)return o.Z.getLogger(this).error("definitionExpression is using non standard function"),null;var t=[],n=r.fieldNames;return(0,f.e8)(n,this.i3slayer.fields,{missingFields:t}),t.length>0?(o.Z.getLogger(this).error("definitionExpression references unknown fields: ".concat(t.join(", "))),null):(this._definitionExpressionErrors=0,r)}catch(i){return o.Z.getLogger(this).error("Failed to parse definitionExpression: "+i),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}},{key:"_evaluateClause",value:function(e,r){try{return e.testFeature(r)}catch(t){return this.logError(t),!1}}},{key:"_addDefinitionExpressionToQuery",value:function(e){if(!this.parsedDefinitionExpression)return e;var r=this.i3slayer.definitionExpression,t=e.clone();return t.where?t.where="(".concat(r,") AND (").concat(t.where,")"):t.where=r,t}}]),t}(e);return(0,s._)([(0,d.Cb)({readOnly:!0})],r.prototype,"parsedDefinitionExpression",null),(0,s._)([(0,d.Cb)({readOnly:!0})],r.prototype,"definitionExpressionFields",null),r=(0,s._)([(0,c.j)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],r)}},77057:function(e,r,t){t.d(r,{q:function(){return p}});var n=t(15671),i=t(43144),u=t(60136),a=t(29388),l=t(27366),s=t(49861),o=(t(93169),t(32718),t(84936),t(69912)),d=t(20311),c=t(18661),y=t(50863),f=t(44011),p=function(e){var r=function(e){(0,u.Z)(t,e);var r=(0,a.Z)(t);function t(){return(0,n.Z)(this,t),r.apply(this,arguments)}return(0,i.Z)(t,[{key:"timeExtent",get:function(){var e;return(0,y.h)(this.i3slayer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}},{key:"mergedFilter",get:function(){var e,r,t,n=this.filter,i=this.timeExtent;if(null==i)return n;var u=null!==(e=null===n||void 0===n?void 0:n.clone())&&void 0!==e?e:new c.Z;return null!=i&&(u.timeExtent=null!==(r=null===(t=u.timeExtent)||void 0===t?void 0:t.intersection(i))&&void 0!==r?r:i),u}},{key:"getTimeFilterDependencies",value:function(){var e=this.i3slayer.timeInfo;return null==e?[]:[e.startField,e.endField]}},{key:"addTimeFilter",value:function(e,r){if(null!=r){var t=this.i3slayer.timeInfo;if(null!=t){var n=t.startField,i=t.endField;if(t.useTime&&(null!=n||null!=i)){var u=t.toJSON(),a=r.toJSON();e.push((function(e,r){return function(e,r,t,n){var i,u=null===(i=r.attributeInfo)||void 0===i?void 0:i.attributeData;if(null==u)return;var a=t.startTimeField,l=t.endTimeField;if(null!=a&&null==u[a]||null!=l&&null==u[l])return;var s=(0,d.y)(t,n,new h(u));if(null==s)return;var o=r.featureIds;(0,f.hv)(e,o,s)}(e,r,u,a)}))}}}}}]),t}(e);return(0,l._)([(0,s.Cb)({readOnly:!0})],r.prototype,"timeExtent",null),(0,l._)([(0,s.Cb)()],r.prototype,"mergedFilter",null),r=(0,l._)([(0,o.j)("esri.views.3d.layers.support.TemporalSceneLayerView")],r)};var h=function(){function e(r){(0,n.Z)(this,e),this.attributeData=r}return(0,i.Z)(e,[{key:"getAttribute",value:function(e,r){return(0,f.Jx)(this.attributeData[r],e)}},{key:"getAttributeAsTimestamp",value:function(e,r){var t=this.getAttribute(e,r);return"string"==typeof t?new Date(t).getTime():"number"==typeof t||null==t?t:null}}]),e}()}}]);
//# sourceMappingURL=48506.07116381.chunk.js.map