"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[26250],{46228:function(e,t,i){i.d(t,{I:function(){return n},v:function(){return a}});var r=i(16889);function n(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(0,r.uZ)(e,0,o),a=0;a<4;a++)t[i+a]=Math.floor(256*u(n*s[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0,r=0;r<4;r++)i+=e[t+r]*l[r];return i}var s=[1,256,65536,16777216],l=[1/256,1/65536,1/16777216,1/4294967296],o=a(new Uint8ClampedArray([255,255,255,255]));function u(e){return e-Math.floor(e)}},13491:function(e,t,i){i.d(t,{Q:function(){return c}});var r=i(60136),n=i(29388),a=i(37762),s=i(15671),l=i(43144),o=i(63780),u=(i(93169),i(27546)),h=i(36231),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,i=arguments.length>1?arguments[1]:void 0;(0,s.Z)(this,e),this._compareMinX=_,this._compareMinY=p,this._toBBox=function(e){return e},this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this._toBBox=i:this._initFormat(i)),this.clear()}return(0,l.Z)(e,[{key:"destroy",value:function(){this.clear(),Z.prune(),S.prune(),C.prune(),I.prune()}},{key:"all",value:function(e){d(this._data,e)}},{key:"search",value:function(e,t){var i=this._data,r=this._toBBox;if(x(e,i))for(Z.clear();i;){for(var n=0,a=i.children.length;n<a;n++){var s=i.children[n],l=i.leaf?r(s):s;x(e,l)&&(i.leaf?t(s):w(e,l)?d(s,t):Z.push(s))}i=Z.pop()}}},{key:"collides",value:function(e){var t=this._data,i=this._toBBox;if(!x(e,t))return!1;for(Z.clear();t;){for(var r=0,n=t.children.length;r<n;r++){var a=t.children[r],s=t.leaf?i(a):a;if(x(e,s)){if(t.leaf||w(e,s))return!0;Z.push(a)}}t=Z.pop()}return!1}},{key:"load",value:function(e){if(!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var r=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===r.height)this._splitRoot(this._data,r);else{if(this._data.height<r.height){var n=this._data;this._data=r,r=n}this._insert(r,this._data.height-r.height-1,!0)}else this._data=r;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this._data.height-1),this}},{key:"clear",value:function(){return this._data=new M([]),this}},{key:"remove",value:function(e){if(!e)return this;var t,i=this._data,r=null,n=0,a=!1,s=this._toBBox(e);for(C.clear(),I.clear();i||C.length>0;){var l;if(i||(i=C.pop(),r=C.data[C.length-1],n=null!==(l=I.pop())&&void 0!==l?l:0,a=!0),i.leaf&&-1!==(t=(0,o.cq)(i.children,e,i.children.length,i.indexHint)))return i.children.splice(t,1),C.push(i),this._condense(C),this;a||i.leaf||!w(i,s)?r?(n++,i=r.children[n],a=!1):i=null:(C.push(i),I.push(n),n=0,r=i,i=i.children[0])}return this}},{key:"toJSON",value:function(){return this._data}},{key:"fromJSON",value:function(e){return this._data=e,this}},{key:"_build",value:function(e,t,i,r){var n=i-t+1,a=this._maxEntries;if(n<=a){var s=new M(e.slice(t,i+1));return y(s,this._toBBox),s}r||(r=Math.ceil(Math.log(n)/Math.log(a)),a=Math.ceil(n/Math.pow(a,r-1)));var l=new D([]);l.height=r;var o=Math.ceil(n/a),u=o*Math.ceil(Math.sqrt(a));T(e,t,i,u,this._compareMinX);for(var h=t;h<=i;h+=u){var c=Math.min(h+u-1,i);T(e,h,c,o,this._compareMinY);for(var d=h;d<=c;d+=o){var f=Math.min(d+o-1,c);l.children.push(this._build(e,d,f,r-1))}}return y(l,this._toBBox),l}},{key:"_insert",value:function(e,t,i){var r=this._toBBox,n=i?e:r(e);C.clear();var a=function(e,t,i,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==i;){for(var n=void 0,a=1/0,s=1/0,l=0,o=t.children.length;l<o;l++){var u=t.children[l],h=m(u),c=k(e,u)-h;c<s?(s=c,a=h<a?h:a,n=u):c===s&&h<a&&(a=h,n=u)}t=n||t.children[0]}return t}(n,this._data,t,C);for(a.children.push(e),v(a,n);t>=0&&C.data[t].children.length>this._maxEntries;)this._split(C,t),t--;!function(e,t,i){for(var r=i;r>=0;r--)v(t.data[r],e)}(n,C,t)}},{key:"_split",value:function(e,t){var i=e.data[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var a=this._chooseSplitIndex(i,n,r);if(a){var s=i.children.splice(a,i.children.length-a),l=i.leaf?new M(s):new D(s);l.height=i.height,y(i,this._toBBox),y(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(i,l)}}},{key:"_splitRoot",value:function(e,t){this._data=new D([e,t]),this._data.height=e.height+1,y(this._data,this._toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,i){var r,n,a;r=n=1/0;for(var s=t;s<=i-t;s++){var l=f(e,0,s,this._toBBox),o=f(e,s,i,this._toBBox),u=b(l,o),h=m(l)+m(o);u<r?(r=u,a=s,n=h<n?h:n):u===r&&h<n&&(n=h,a=s)}return a}},{key:"_chooseSplitAxis",value:function(e,t,i){var r=e.leaf?this._compareMinX:_,n=e.leaf?this._compareMinY:p;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)}},{key:"_allDistMargin",value:function(e,t,i,r){e.children.sort(r);for(var n=this._toBBox,a=f(e,0,t,n),s=f(e,i-t,i,n),l=g(a)+g(s),o=t;o<i-t;o++){var u=e.children[o];v(a,e.leaf?n(u):u),l+=g(a)}for(var h=i-t-1;h>=t;h--){var c=e.children[h];v(s,e.leaf?n(c):c),l+=g(s)}return l}},{key:"_condense",value:function(e){for(var t=e.length-1;t>=0;t--){var i=e.data[t];if(0===i.children.length)if(t>0){var r=e.data[t-1],n=r.children;n.splice((0,o.cq)(n,i,n.length,r.indexHint),1)}else this.clear();else y(i,this._toBBox)}}},{key:"_initFormat",value:function(e){var t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}]),e}();function d(e,t){var i=e;for(S.clear();i;){var r;if(!0===i.leaf){var n,s=(0,a.Z)(i.children);try{for(s.s();!(n=s.n()).done;){t(n.value)}}catch(l){s.e(l)}finally{s.f()}}else S.pushArray(i.children);i=null!==(r=S.pop())&&void 0!==r?r:null}}function y(e,t){f(e,0,e.children.length,t,e)}function f(e,t,i,r,n){n||(n=new M([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a,s=t;s<i;s++)a=e.children[s],v(n,e.leaf?r(a):a);return n}function v(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function _(e,t){return e.minX-t.minX}function p(e,t){return e.minY-t.minY}function m(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function g(e){return e.maxX-e.minX+(e.maxY-e.minY)}function k(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function b(e,t){var i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,n-i)*Math.max(0,a-r)}function w(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function x(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function T(e,t,i,r,n){for(var a=[t,i];a.length;){var s=a.pop(),l=a.pop();if(!(s-l<=r)){var o=l+Math.ceil((s-l)/r/2)*r;(0,h.q)(e,o,l,s,n),a.push(l,o,o,s)}}}var Z=new u.Z,S=new u.Z,C=new u.Z,I=new u.Z({deallocator:void 0}),R=function(e){(0,r.Z)(i,e);var t=(0,n.Z)(i);function i(){var e;return(0,s.Z)(this,i),(e=t.apply(this,arguments)).height=1,e.indexHint=new o.SO,e}return(0,l.Z)(i)}((0,l.Z)((function e(){(0,s.Z)(this,e),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}))),M=function(e){(0,r.Z)(i,e);var t=(0,n.Z)(i);function i(e){var r;return(0,s.Z)(this,i),(r=t.call(this)).children=e,r.leaf=!0,r}return(0,l.Z)(i)}(R),D=function(e){(0,r.Z)(i,e);var t=(0,n.Z)(i);function i(e){var r;return(0,s.Z)(this,i),(r=t.call(this)).children=e,r.leaf=!1,r}return(0,l.Z)(i)}(R)},97314:function(e,t,i){i.d(t,{Z:function(){return o}});var r,n,a=i(15671),s=i(43144),l=i(40316);(n=r||(r={}))[n.moveTo=1]="moveTo",n[n.lineTo=2]="lineTo",n[n.close=7]="close";var o=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,a.Z)(this,e),this.values={},this._geometry=void 0,this._pbfGeometry=null,this.featureIndex=r;for(var n=i.keys,s=i.values,l=t.asUnsafe();l.next();)switch(l.tag()){case 1:this.id=l.getUInt64();break;case 2:for(var o=l.getMessage().asUnsafe(),u=this.values;!o.empty();){var h=o.getUInt32(),c=o.getUInt32();u[n[h]]=s[c]}o.release();break;case 3:this.type=l.getUInt32();break;case 4:this._pbfGeometry=l.getMessage();break;default:l.skip()}}return(0,s.Z)(e,[{key:"getGeometry",value:function(e){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;var t,i,n=this._pbfGeometry.asUnsafe();this._pbfGeometry=null,e?e.reset(this.type):t=[];for(var a,s=r.moveTo,o=0,u=0,h=0;!n.empty();){if(0===o){var c=n.getUInt32();s=7&c,o=c>>3}switch(o--,s){case r.moveTo:u+=n.getSInt32(),h+=n.getSInt32(),e?e.moveTo(u,h):t&&(i&&t.push(i),(i=[]).push(new l.E9(u,h)));break;case r.lineTo:u+=n.getSInt32(),h+=n.getSInt32(),e?e.lineTo(u,h):i&&i.push(new l.E9(u,h));break;case r.close:e?e.close():i&&!i[0].equals(u,h)&&i.push(i[0].clone());break;default:throw n.release(),new Error("Invalid path operation")}}return e?a=e.result():t&&(i&&t.push(i),a=t),n.release(),this._geometry=a,a}}]),e}()},7433:function(e,t,i){i.d(t,{Z:function(){return a}});var r=i(15671),n=i(43144),a=function(){function e(t){(0,r.Z)(this,e),this.extent=4096,this.keys=[],this.values=[],this._pbfLayer=t.clone();for(var i=t.asUnsafe();i.next();)switch(i.tag()){case 1:this.name=i.getString();break;case 3:this.keys.push(i.getString());break;case 4:this.values.push(i.processMessage(e._parseValue));break;case 5:this.extent=i.getUInt32();break;default:i.skip()}}return(0,n.Z)(e,[{key:"getData",value:function(){return this._pbfLayer}}],[{key:"_parseValue",value:function(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getInt64();case 5:return e.getUInt64();case 6:return e.getSInt64();case 7:return e.getBool();default:e.skip()}return null}}]),e}()},12233:function(e,t,i){i.d(t,{Z:function(){return a}});var r=i(15671),n=i(43144),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,r.Z)(this,e),this.x=t,this.y=i,this.width=n,this.height=a}return(0,n.Z)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},55067:function(e,t,i){i.d(t,{Z:function(){return _}});var r=i(37762),n=i(15671),a=i(43144),s=i(88301),l=i(61120),o=i(60136),u=i(29388),h=i(93169),c=i(80613),d=i(86438),y=i(40655),f=i(5086),v=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},_=function(e){(0,o.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this))._tileInfoView=e,r}return(0,a.Z)(i,[{key:"renderChildren",value:function(e){this.sortChildren(v),this.setStencilReference(e),(0,s.Z)((0,l.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=(0,s.Z)((0,l.Z)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=(0,s.Z)((0,l.Z)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[y.Z],drawPhase:c.jx.DEBUG|c.jx.MAP|c.jx.HIGHLIGHT|c.jx.LABEL,target:function(){return t.getStencilTarget()}})),(0,h.Z)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[f.Z],drawPhase:c.jx.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,i=1,n=(0,r.Z)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.stencilRef=i++}}catch(a){n.e(a)}finally{n.f()}}}]),i}(d.Z)},73028:function(e,t,i){i.r(t),i.d(t,{default:function(){return _e}});var r=i(74165),n=i(37762),a=i(15861),s=i(15671),l=i(43144),o=i(88301),u=i(61120),h=i(60136),c=i(29388),d=i(27366),y=i(84652),f=i(32718),v=i(92026),_=i(66978),p=i(49861),m=(i(93169),i(69912)),g=i(48732),k=i(848),b=i(65156),w=i(92975),x=i(10106),T=i(98067),Z=i(93433),S=i(29439),C=i(16054),I=i(48790),R=i(73828),M=function(e,t){return e+1/(1<<2*t)},D=function(){function e(t,i){(0,s.Z)(this,e),this._tiles=new Map,this._tileCache=new C.z(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=i}return(0,l.Z)(e,[{key:"destroy",value:function(){var e,t=(0,n.Z)(this._tiles);try{for(t.s();!(e=t.n()).done;){var i=(0,S.Z)(e.value,2);i[0];i[1].dispose()}}catch(r){t.e(r)}finally{t.f()}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t=this.tileInfoView,i=t.getTileCoverage(e.state,0,!0,"smallest");if(!i)return!0;var r,a=i.spans,s=i.lodInfo,l=s.level,o=this._tiles,u=new Set,h=new Set,c=(0,n.Z)(a);try{for(c.s();!(r=c.n()).done;)for(var d=r.value,y=d.row,f=d.colFrom,v=d.colTo,_=f;_<=v;_++){var p=R.Z.getId(l,y,s.normalizeCol(_),s.getWorldForColumn(_)),m=this._getOrAcquireTile(p);u.add(p),m.processed()?this._addToContainer(m):h.add(new R.Z(p))}}catch(A){c.e(A)}finally{c.f()}var g,k=(0,n.Z)(o);try{for(k.s();!(g=k.n()).done;){var b=(0,S.Z)(g.value,2),w=b[0];b[1].isCoverage=u.has(w)}}catch(A){k.e(A)}finally{k.f()}var x,T=(0,n.Z)(h);try{for(T.s();!(x=T.n()).done;){var Z=x.value;this._findPlaceholdersForMissingTiles(Z,u)}}catch(A){T.e(A)}finally{T.f()}var C,M=!1,D=(0,n.Z)(o);try{for(D.s();!(C=D.n()).done;){var L=(0,S.Z)(C.value,2),P=L[0],E=L[1];E.neededForCoverage=u.has(P),E.neededForCoverage||E.isHoldingForFade&&t.intersects(i,E.key)&&u.add(P),E.isFading&&(M=!0)}}catch(A){D.e(A)}finally{D.f()}var H,F=(0,n.Z)(this._tiles);try{for(F.s();!(H=F.n()).done;){var B=(0,S.Z)(H.value,2),U=B[0];B[1];u.has(U)||this._releaseTile(U)}}catch(A){F.e(A)}finally{F.f()}return I.Z.pool.release(i),!M}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"getIntersectingTiles",value:function(e,t,i,r,a){var s=this,l=[0,0],o=[0,0];r.toMap(l,e-i,t+i),r.toMap(o,e+i,t-i);var u,h=Math.min(l[0],o[0]),c=Math.min(l[1],o[1]),d=Math.max(l[0],o[0]),y=Math.max(l[1],o[1]),f=(0,b.al)(h,c,d,y),v=(0,b.Ue)(),_=[],p=(0,n.Z)(this._visibleTiles);try{for(p.s();!(u=p.n()).done;){var m=(0,S.Z)(u.value,2),g=(m[0],m[1]);this.tileInfoView.getTileBounds(v,g.key),(0,b.kK)(f,v)&&_.push(g)}}catch(x){p.e(x)}finally{p.f()}if(null!=a&&a.length>0){var k=new Set(_.map((function(e){return e.id}))),w=a.filter((function(e){return!k.has(e.tileKey.id)})).map((function(e){return s._visibleTiles.get(e.tileKey.id)})).filter((function(e){return void 0!==e}));_.push.apply(_,(0,Z.Z)(w))}return _}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var i,r=[],a=(0,n.Z)(this._tiles);try{for(a.s();!(i=a.n()).done;){var s=(0,S.Z)(i.value,2),l=(s[0],s[1]);this._addPlaceholderChild(r,l,e,t)}}catch(u){a.e(u)}finally{a.f()}var o=r.reduce(M,0);Math.abs(1-o)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,i,r){t.key.level<=i.level||!t.hasData()||function(e,t){var i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}(i,t.key)&&(this._addToContainer(t),r.add(t.id),e.push(t.key.level-i.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var i=this._tiles,r=e;;){if(!(r=L(r))||t.has(r))return;var n=i.get(r);if(null!==n&&void 0!==n&&n.hasData())return this._addToContainer(n),void t.add(n.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new R.Z(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,i=[],r=this._container;if(!r.contains(e)){var a,s=this._visibleTiles,l=(0,n.Z)(s);try{for(l.s();!(a=l.n()).done;){var o=(0,S.Z)(a.value,2),u=(o[0],o[1]);this._canConnectDirectly(e,u)&&i.push(u),null==t&&this._canConnectDirectly(u,e)&&(t=u)}}catch(_){l.e(_)}finally{l.f()}if(null!=t){var h,c=(0,n.Z)(i);try{for(c.s();!(h=c.n()).done;){var d=h.value;t.childrenTiles.delete(d),e.childrenTiles.add(d),d.parentTile=e}}catch(_){c.e(_)}finally{c.f()}t.childrenTiles.add(e),e.parentTile=t}else{var y,f=(0,n.Z)(i);try{for(f.s();!(y=f.n()).done;){var v=y.value;e.childrenTiles.add(v),v.parentTile=e}}catch(_){f.e(_)}finally{f.f()}}s.set(e.id,e),r.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),null!=e.parentTile){e.parentTile.childrenTiles.delete(e);var t,i=(0,n.Z)(e.childrenTiles);try{for(i.s();!(t=i.n()).done;){var r=t.value;null!=e.parentTile&&e.parentTile.childrenTiles.add(r)}}catch(l){i.e(l)}finally{i.f()}}var a,s=(0,n.Z)(e.childrenTiles);try{for(s.s();!(a=s.n()).done;){a.value.parentTile=e.parentTile}}catch(l){s.e(l)}finally{s.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var i=e.key,r=t.key,n=r.level,a=r.row,s=r.col,l=r.world,o=this._visibleTiles;n>0;){if(n--,a>>=1,s>>=1,i.level===n&&i.row===a&&i.col===s&&i.world===l)return!0;if(o.has("".concat(n,"/").concat(a,"/").concat(s,"/").concat(l)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var i=Math.ceil(t[0]/512)+1,r=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*r}}}]),e}();function L(e){var t=e.split("/"),i=(0,S.Z)(t,4),r=i[0],n=i[1],a=i[2],s=i[3],l=parseInt(r,10);return 0===l?null:"".concat(l-1,"/").concat(parseInt(n,10)>>1,"/").concat(parseInt(a,10)>>1,"/").concat(parseInt(s,10))}var P=i(72291),E=i(1413),H=i(22824),F=i(76432),B=i(46618),U=i(38684),A=i(42121),V=i(12463),z=i(36210),Y=i(50127),q=i(21391),N=1e-6,O=function(){function e(t,i){var r=this;(0,s.Z)(this,e),this.styleRepository=t,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._offsetFromScreenCenter=[0,0],this._completed=!1,this._fading=(0,F.t)(!1),this._symbolRepository=new z.L(4096,i,(function(){return new U.J})),this._symbolDeclutterer=new V.g(i,this._symbolRepository,(function(e,t,i){return r._createCollisionJob(e,t,i)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,(0,Y.C$)(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return r.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-r.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=r.styleRepository.getStyleLayerByUID(e);if(r._zoom+N<t.minzoom||r._zoom-N>=t.maxzoom)return!1;var i=t.getLayoutProperty("visibility");return!i||i.getValue()!==q.EE.NONE}))}return(0,l.Z)(e,[{key:"symbolRepository",get:function(){return this._symbolRepository}},{key:"_createCollisionJob",value:function(e,t,i){return this.updateDecluttererViewState(),new A.f(e,t,i,this.styleRepository,this._zoom,this._viewState.rotation)}},{key:"fading",get:function(){return this._fading.value}},{key:"decluttererOffset",get:function(){return this._offsetFromScreenCenter}},{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]};var i=[0,0];t.toScreen(i,t.center);var r=[0,0];return t.toScreen(r,this._declutterViewState.center),this._offsetFromScreenCenter[0]=i[0]-r[0],this._offsetFromScreenCenter[1]=i[1]-r[1],this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(B.JM),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e._fading.value=!1}),1.5*B.v7)}},{key:"_notifyUnstable",value:function(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}},{key:"updateDecluttererViewState",value:function(){this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._offsetFromScreenCenter[0]=0,this._offsetFromScreenCenter[1]=0}}]),e}(),X=i(80613),Q=i(87071),G=i(55067),K=i(8548),j=1e-6;function W(e,t){if(e){var i=e.getLayoutProperty("visibility");if(!i||i.getValue()!==q.EE.NONE&&(void 0===e.minzoom||e.minzoom<t+j)&&(void 0===e.maxzoom||e.maxzoom>=t-j))return!0}return!1}var J=function(e){(0,h.Z)(i,e);var t=(0,c.Z)(i);function i(e){var r;return(0,s.Z)(this,i),(r=t.call(this,e))._backgroundTiles=[],r._computeDisplayInfoView(e),r}return(0,l.Z)(i,[{key:"destroy",value:function(){var e,t;this.removeAllChildren(),null!==(e=this._spriteMosaic)&&void 0!==e&&e.dispose(),this._spriteMosaic=null,null!==(t=this._glyphMosaic)&&void 0!==t&&t.dispose(),this._glyphMosaic=null,null!=this._symbolFader&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[]}},{key:"fading",get:function(){var e,t;return null!==(e=null===(t=this._symbolFader)||void 0===t?void 0:t.fading)&&void 0!==e&&e}},{key:"symbolFader",get:function(){return this._symbolFader}},{key:"symbolRepository",get:function(){var e;return null===(e=this._symbolFader)||void 0===e?void 0:e.symbolRepository}},{key:"setStyleResources",value:function(e,t,i,r){this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,this._tileInfoView=r,this._computeDisplayInfoView(r),null==this._symbolFader&&(this._symbolFader=new O(this._styleRepository,this.children)),this._symbolFader.styleRepository=i}},{key:"setSpriteMosaic",value:function(e){var t;null!==(t=this._spriteMosaic)&&void 0!==t&&t.dispose(),this._spriteMosaic=e}},{key:"deleteStyleLayers",value:function(e){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(e)}},{key:"createRenderParams",value:function(e){return(0,E.Z)((0,E.Z)({},(0,o.Z)((0,u.Z)(i.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==X.jx.MAP&&e.drawPhase!==X.jx.DEBUG||void 0===this._spriteMosaic||(0,o.Z)((0,u.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return(0,o.Z)((0,u.Z)(i.prototype),"addChild",this).call(this,e),null!=this._symbolFader?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return null!=this._symbolFader&&this._symbolFader.removeTile(e),this.requestRender(),(0,o.Z)((0,u.Z)(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){e.drawPhase!==X.jx.DEBUG?this._doRender(e):(0,o.Z)((0,u.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];null!=this._symbolFader&&this._symbolFader.removeTile(t),t.dispose()}(0,o.Z)((0,u.Z)(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,r=e.state,a=this._styleRepository;if(a){var s=a.layers,l=this._displayInfo.scaleToZoom(r.scale);a.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,a.backgroundBucketIds,l)),(0,o.Z)((0,u.Z)(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===X.jx.MAP&&this._fade(l,r);var h=this.children.filter((function(e){return e.visible&&e.hasData()}));if(!h||0===h.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);var c,d=(0,n.Z)(h);try{for(d.s();!(c=d.n()).done;){c.value.triangleCount=0}}catch(m){d.e(m)}finally{d.f()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(K.xS.KEEP,K.xS.KEEP,K.xS.REPLACE),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(K.wb.LEQUAL),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var y=s.length-1;y>=0;y--)this._renderStyleLayer(s[y],e,h);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(K.zi.ONE,K.zi.ONE_MINUS_SRC_ALPHA,K.zi.ONE,K.zi.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(var f=0;f<s.length;f++)this._renderStyleLayer(s[f],e,h);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0);var v,_=(0,n.Z)(h);try{for(_.s();!(v=_.n()).done;){var p=v.value;p.debugInfo.display.triangleCount=p.triangleCount}}catch(m){_.e(m)}finally{_.f()}}}},{key:"_fade",value:function(e,t){null!=this._symbolFader&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,i){var r=t.displayLevel,a=t.painter,s=t.renderPass;if(void 0!==e){var l=e.getLayoutProperty("visibility");if(!l||l.getValue()!==q.EE.NONE){var o;switch(e.type){case q.fR.BACKGROUND:return;case q.fR.FILL:if("opaque"!==s&&"translucent"!==t.renderPass)return;o="vtlFill";break;case q.fR.LINE:if("translucent"!==s)return;o="vtlLine";break;case q.fR.CIRCLE:if("translucent"!==s)return;o="vtlCircle";break;case q.fR.SYMBOL:if("translucent"!==s)return;o="vtlSymbol"}if(i=e.type===q.fR.SYMBOL?i.filter((function(e){return e.decluttered})):i.filter((function(e){return e.neededForCoverage})),"vtlSymbol"===o||!(0===i.length||void 0!==e.minzoom&&e.minzoom>=r+j||void 0!==e.maxzoom&&e.maxzoom<r-j)){var u=e.uid;t.styleLayerUID=u,t.styleLayer=e;var h,c=(0,n.Z)(i);try{for(c.s();!(h=c.n()).done;){if(h.value.layerData.has(u)){a.renderObjects(t,i,o);break}}}catch(d){c.e(d)}finally{c.f()}}}}}},{key:"_renderBackgroundLayers",value:function(e,t,i){var r,a=e.context,s=e.painter,l=e.state,o=this._styleRepository,u=!1,h=(0,n.Z)(t);try{for(h.s();!(r=h.n()).done;){var c=r.value;if(o.getLayerById(c).type===q.fR.BACKGROUND&&W(o.getLayerById(c),i)){u=!0;break}}}catch(V){h.e(V)}finally{h.f()}if(u){var d=this._tileInfoView,y=d.getTileCoverage(e.state,0,!0,"smallest"),f=y.spans,v=y.lodInfo,_=v.level,p=(0,b.Ue)(),m=[];if(this._renderPasses){var g=this._renderPasses[0];null!=this._clippingInfos&&(g.brushes[0].prepareState(e),g.brushes[0].drawMany(e,this._clippingInfos))}var k,w,x=this._backgroundTiles,T=0,Z=(0,n.Z)(f);try{for(Z.s();!(w=Z.n()).done;)for(var S=w.value,C=S.row,M=S.colFrom,D=S.colTo,L=M;L<=D;L++){if(T<x.length)(k=x[T]).key.set(_,C,v.normalizeCol(L),v.getWorldForColumn(L)),d.getTileBounds(p,k.key,!1),k.x=p[0],k.y=p[3],k.resolution=d.getTileResolution(_);else{var P=new R.Z(_,C,v.normalizeCol(L),v.getWorldForColumn(L)),E=d.getTileBounds((0,b.Ue)(),P),H=d.getTileResolution(_);k=new Q.H(P,H,E[0],E[3],512,512,4096,4096),x.push(k)}k.setTransform(l),m.push(k),T++}}catch(V){Z.e(V)}finally{Z.f()}a.setStencilWriteMask(0),a.setColorMask(!0,!0,!0,!0),a.setStencilOp(K.xS.KEEP,K.xS.KEEP,K.xS.REPLACE),a.setStencilFunction(K.wb.EQUAL,0,255),a.setStencilTestEnabled(!0);var F,B=(0,n.Z)(t);try{for(B.s();!(F=B.n()).done;){var U=F.value,A=o.getLayerById(U);A.type===q.fR.BACKGROUND&&W(A,i)&&(e.styleLayerUID=A.uid,e.styleLayer=A,s.renderObjects(e,m,"vtlBackground"))}}catch(V){B.e(V)}finally{B.f()}I.Z.pool.release(y)}}},{key:"_computeDisplayInfoView",value:function(e){for(var t=e.tileInfo.lods[0].scale,i=Math.max(25,e.tileInfo.lods.length),r=[],n=0;n<=i;n++)r.push(t),t/=2;this._displayInfo=H.Z.create({scales:r,size:512,spatialReference:e.spatialReference,numLODs:i})}}]),i}(G.Z),$=i(52639),ee=i(77427),te=i(78084),ie=i(13491),re=i(97314),ne=i(99201),ae=i(7433),se=i(44305),le=function(e,t){var i=e.vtlSymbol.sourceTile,r=t.vtlSymbol.sourceTile;return i.level!==r.level?i.level-r.level:i.row!==r.row?i.row-r.row:i.col!==r.col?i.col-r.col:e.styleLayerUID-t.styleLayerUID},oe=function(){function e(t,i,r,n,a){(0,s.Z)(this,e),this.tileKey=t,this._index=null,this._styleRepository=null,this._tileHandler=null,this._tileKeyToPBF=new Map,this._tileLayerData=i,this._styleRepository=r,this._tileHandler=n,this._parentLayer=a}return(0,l.Z)(e,[{key:"clear",value:function(){var e;null!==(e=this._index)&&void 0!==e&&e.clear(),this._tileKeyToPBF.clear()}},{key:"queryAttributes",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i,n,a,s){var l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this._tileLayerData.size&&this._styleRepository&&this._tileHandler){e.next=2;break}return e.abrupt("return",[]);case 2:if(e.t0=null===this._index,!e.t0){e.next=7;break}return this._index=new ie.Q(100,ue),e.next=7,this._indexLayers();case 7:if(l=[],this._queryIndex(l,t,i,n,this.tileKey.level,a),e.t1=s&&(null===s||void 0===s?void 0:s.length)>0,!e.t1){e.next=13;break}return e.next=13,this._getSymbolsAttributes(l,s);case 13:return e.abrupt("return",l);case 14:case"end":return e.stop()}}),e,this)})));return function(t,i,r,n,a){return e.apply(this,arguments)}}()},{key:"_indexLayers",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,i,a,s,l,o,u=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tileKey,i=this._styleRepository.layers,e.next=4,this._getTilePayload(t);case 4:a=e.sent,s=(0,n.Z)(this._tileLayerData),e.prev=6,o=function(){var e=(0,S.Z)(l.value,2),r=e[0],n=e[1],s=i[r],o=a.find((function(e){return e.sourceName===s.source}));if(!o)return"continue";var h=o.protobuff,c=o.key;if(n.type!==x.al.SYMBOL){var d=1<<t.level-c.level,y=t.row-c.row*d,f=t.col-c.col*d;u._indexLayer(s,h,t.level,d,y,f)}},s.s();case 9:if((l=s.n()).done){e.next=15;break}if("continue"!==o()){e.next=13;break}return e.abrupt("continue",13);case 13:e.next=9;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),s.e(e.t0);case 20:return e.prev=20,s.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[6,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"_indexLayer",value:function(e,t,i,r,n,a){for(var s=e.sourceLayer,l=e.getFeatureFilter(),o=i,u=i+1,h=(0,ne.KU)(o),c=new te.Z(new Uint8Array(t),new DataView(t));c.next();)if(3===c.tag()){var d=c.getMessage(),y=new ae.Z(d);if(d.release(),y.name!==s)continue;for(var f=y.getData(),v=y.extent/r,_=v*a-h,p=v*n-h,m=_+v+2*h,g=p+v+2*h,k=v/512,b=4096/v,w=v*a,x=v*n;f.nextTag(2);){var T=f.getMessage(),Z=new re.Z(T,y);if(T.release(),!l||l.filter(Z,i)){var S=Z.values||{},C=S._minzoom,I=S._maxzoom;if(!(C&&C>=10*u||I&&I<=10*o)){var R=e.getFeatureInflatedBounds(Z,o,y.extent,k);null==R||R[0]>m||R[1]>g||R[2]<_||R[3]<p||(R[0]=(R[0]-w)*b,R[1]=(R[1]-x)*b,R[2]=(R[2]-w)*b,R[3]=(R[3]-x)*b,this._index.insert(new se.$L(e,Z,R,b,w,x)))}}}}else c.skip()}},{key:"_getSymbolsAttributes",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){var n,a,s,l,o,u,h,c,d,y,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&0!==i.length){e.next=2;break}return e.abrupt("return",t);case 2:for(n=[],i.sort(le),a=i[0].styleLayerUID,s=0,l=0;l<i.length;l++)a!==i[l].styleLayerUID&&(n.push({from:s,to:l,styleLayerUID:a,sourceTileKey:i[l].vtlSymbol.sourceTile}),s=l,a=i[l].styleLayerUID);n.push({from:s,to:i.length,styleLayerUID:a,sourceTileKey:i[i.length-1].vtlSymbol.sourceTile}),o=this._styleRepository.layers,h=null,c=0,d=n;case 10:if(!(c<d.length)){e.next=19;break}return y=d[c],e.next=14,this._getTilePayload(y.sourceTileKey);case 14:f=e.sent,u=o[y.styleLayerUID],h=!!u&&f.find((function(e){return e.sourceName===u.source})),h&&this._addSymbolsAttributes(t,i.slice(y.from,y.to).map((function(e){return e.vtlSymbol})),a,h);case 16:c++,e.next=10;break;case 19:return e.abrupt("return",t);case 20:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_addSymbolsAttributes",value:function(e,t,i,r){var n=this,a=this._styleRepository.layers,s=r.key,l=this.tileKey,o=1<<l.level-s.level,u=l.row-s.row*o,h=l.col-s.col*o;this._getSymbolAttributes(r.protobuff,t,i,o,u,h).forEach((function(t){var r=t.attributes,s=t.tilePoint;e.push({layerId:a[i].id,layerIndex:i,graphic:new $.Z({attributes:r,origin:{type:"vector-tile",layerId:a[i].id,layerIndex:i,layer:n._parentLayer}}),tilePoint:s})}))}},{key:"_getSymbolAttributes",value:function(e,t,i,r,n,a){var s=[],l=this._styleRepository.layers,o=0;t.sort((function(e,t){return e.featureIndex-t.featureIndex}));for(var u=new te.Z(new Uint8Array(e),new DataView(e));u.next();)if(3===u.tag()){var h=u.getMessage(),c=new ae.Z(h);if(h.release(),c.name!==l[i].sourceLayer)continue;for(var d=c.getData(),y=c.extent/r,f=4096/y,v=y*a,_=y*n,p=0;d.nextTag(2);){var m=d.getMessage();if(p++===t[o].featureIndex){var g=new re.Z(m,c),k=g.values,b=g.getGeometry(),w=null!=b?[f*(b[0][0].x-v),f*(b[0][0].y-_)]:null;s.push({attributes:k,tilePoint:w}),o++}if(m.release(),o===t.length)return s}}else u.skip();return s}},{key:"_queryIndex",value:function(e,t,i,r,n,a){var s,l=this,o=8*r*(window.devicePixelRatio||1);return null!==(s=this._index)&&void 0!==s&&s.search({minX:t-o,minY:i-o,maxX:t+o,maxY:i+o},(function(s){var o=s.layer,u=s.feature;o.isIntersectingFeature(t,i,r,u,n,a,s)&&e.push({layerId:o.id,layerIndex:o.uid,tilePoint:null,graphic:new $.Z({attributes:u.values,origin:{type:"vector-tile",layerId:s.layer.id,layerIndex:s.layer.uid,layer:l._parentLayer}})})})),e}},{key:"_getTilePayload",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,ee.s1)(this._tileKeyToPBF,t.id,(function(){return i._tileHandler.fetchTilePBFs(t)})).then((function(e){return e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"create",value:function(t,i,r,n,a){return new e(t,i,r,n,a)}}]),e}(),ue=function(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}},he=i(30969),ce=i(65457),de=i(75572),ye=i(32344),fe=i(67581),ve=function(e){(0,h.Z)(i,e);var t=(0,c.Z)(i);function i(){var e;return(0,s.Z)(this,i),(e=t.apply(this,arguments))._styleChanges=[],e._fetchQueue=null,e._parseQueue=null,e._tileHandlerPromise=null,e._isTileHandlerReady=!1,e}return(0,l.Z)(i,[{key:"fading",get:function(){var e,t;return null!==(e=null===(t=this._vectorTileContainer)||void 0===t?void 0:t.fading)&&void 0!==e&&e}},{key:"hitTest",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){var a,s,l,o,u,h,c,d,y,f,v,_,p,m,g=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this._tileHandlerPromise,u=null===(a=this._vectorTileContainer)||void 0===a?void 0:a.symbolFader,o&&this._isTileHandlerReady&&u){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,o;case 5:if(h=null,(c=null===(s=this._vectorTileContainer)||void 0===s?void 0:s.symbolRepository)&&(h=c.querySymbols(i,2,u.decluttererOffset,{})),d=this.view.state,(y=this._tileManager.getIntersectingTiles(i.x,i.y,2,d,h))&&0!==y.length||0!==(null===(l=h)||void 0===l?void 0:l.length)){e.next=11;break}return e.abrupt("return",null);case 11:t=t.clone().normalize(),f=[],v=[],_=(0,n.Z)(y);try{for(m=function(){var e,i=p.value;f.push(g._queryTile(v,t,2,g.view.state.rotation,i,null===(e=h)||void 0===e?void 0:e.filter((function(e){return e.tileKey.id===i.id}))))},_.s();!(p=_.n()).done;)m()}catch(r){_.e(r)}finally{_.f()}return e.next=17,Promise.all(f);case 17:return e.abrupt("return",v);case 18:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this,t=this.layer.currentStyleInfo.style;this._styleRepository=new he.Z(t),this._tileInfoView=new de.Z(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new J(this._tileInfoView),this._tileHandler=new T.m(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1),this.container.addChild(this._vectorTileContainer),this._start(),this.addAttachHandles([this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:x.Fr.PAINTER_CHANGED,data:t}),e.requestUpdate();else{var i,r,n=e._styleRepository,a=n.getLayerById(t.layer);if(!a)return;var s=a.type===q.fR.SYMBOL;n.setPaintProperties(t.layer,t.paint),s&&null!==(i=e._vectorTileContainer)&&void 0!==i&&i.restartDeclutter(),null===(r=e._vectorTileContainer)||void 0===r||r.requestRender()}})),this.layer.on("layout-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);if(r){var n=(0,g.Hg)(r.layout,t.layout);if(null!=n){var a,s;if((0,g.uD)(n,"visibility")&&1===function(e){if(null==e)return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(n))return i.setLayoutProperties(t.layer,t.layout),r.type===q.fR.SYMBOL&&null!==(a=e._vectorTileContainer)&&void 0!==a&&a.restartDeclutter(),void(null===(s=e._vectorTileContainer)||void 0===s||s.requestRender());e._styleChanges.push({type:x.Fr.LAYOUT_CHANGED,data:t}),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var i,r,n=e._styleRepository,a=n.getLayerById(t.layer);a&&(n.setStyleLayerVisibility(t.layer,t.visibility),a.type===q.fR.SYMBOL&&null!==(i=e._vectorTileContainer)&&void 0!==i&&i.restartDeclutter(),null===(r=e._vectorTileContainer)||void 0===r||r.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:x.Fr.LAYER_CHANGED,data:t}),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:x.Fr.LAYER_REMOVED,data:t}),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()})),this.layer.on("spriteSource-change",(function(t){e._styleChanges.push({type:x.Fr.SPRITES_CHANGED,data:t});var i,r=e._styleRepository.layers,a=(0,n.Z)(r);try{for(a.s();!(i=a.n()).done;){var s=i.value;switch(s.type){case q.fR.SYMBOL:s.getLayoutProperty("icon-image")&&e._styleChanges.push({type:x.Fr.LAYOUT_CHANGED,data:{layer:s.id,layout:s.layout}});break;case q.fR.LINE:s.getPaintProperty("line-pattern")&&e._styleChanges.push({type:x.Fr.PAINTER_CHANGED,data:{layer:s.id,paint:s.paint,isDataDriven:s.isPainterDataDriven()}});break;case q.fR.FILL:s.getLayoutProperty("fill-pattern")&&e._styleChanges.push({type:x.Fr.PAINTER_CHANGED,data:{layer:s.id,paint:s.paint,isDataDriven:s.isPainterDataDriven()}})}}}catch(l){a.e(l)}finally{a.f()}e.requestUpdate()}))])}},{key:"detach",value:function(){this._stop(),this.container.removeAllChildren(),this._vectorTileContainer=(0,v.SC)(this._vectorTileContainer),this._tileHandler=(0,v.SC)(this._tileHandler)}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"supportsSpatialReference",value:function(e){var t;return(0,w.fS)(null===(t=this.layer.tileInfo)||void 0===t?void 0:t.spatialReference,e)}},{key:"canResume",value:function(){var e=(0,o.Z)((0,u.Z)(i.prototype),"canResume",this).call(this),t=this.layer.currentStyleInfo;if(e&&null!==t&&void 0!==t&&t.layerDefinition){var r=this.view.scale,n=t.layerDefinition,a=n.minScale,s=n.maxScale;(null===t||void 0===t?void 0:t.layerDefinition)&&(a&&a<r&&(e=!1),s&&s>r&&(e=!1))}return e}},{key:"isUpdating",value:function(){return this.fading}},{key:"acquireTile",value:function(e){var t=this,i=this._createVectorTile(e);return this._updatingHandles.addPromise(this._fetchQueue.push(i.key).then((function(e){return t._parseQueue.push({key:i.key,data:e})})).then((function(e){i.once("attach",(function(){return t.requestUpdate()})),i.setData(e),t.requestUpdate()})).catch((function(e){(0,_.D_)(e)||f.Z.getLogger(t).error(e)}))),i}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new D({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new ye.Z({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new ye.Z({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository,e._tileInfoView),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue=(0,v.SC)(this._fetchQueue),this._parseQueue=(0,v.SC)(this._parseQueue),this._tileManager=(0,v.SC)(this._tileManager),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.fetchTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_parseTileData",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_applyStyleChanges",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,i,a,s,l,o,u,h,c=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),f.Z.getLogger(this).error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(i=this._styleRepository,a=new Set,t.forEach((function(e){if(e.type===x.Fr.LAYER_REMOVED){var t=e.data,r=i.getLayerById(t.layer);r&&a.add(r.uid)}})),s=new Set,t.forEach((function(e){var t;switch(e.type){case x.Fr.PAINTER_CHANGED:i.setPaintProperties(e.data.layer,e.data.paint),t=e.data.layer;break;case x.Fr.LAYOUT_CHANGED:i.setLayoutProperties(e.data.layer,e.data.layout),t=e.data.layer;break;case x.Fr.LAYER_REMOVED:return void i.deleteStyleLayer(e.data.layer);case x.Fr.LAYER_CHANGED:i.setStyleLayer(e.data.layer,e.data.index),t=e.data.layer.id;break;case x.Fr.SPRITES_CHANGED:c._vectorTileContainer.setSpriteMosaic(c._tileHandler.setSpriteSource(e.data.spriteSource))}if(t){var r=i.getLayerById(t);r&&s.add(r.uid)}})),l=this._vectorTileContainer.children,a.size>0){o=Array.from(a),this._vectorTileContainer.deleteStyleLayers(o),u=(0,n.Z)(l);try{for(u.s();!(h=u.n()).done;)h.value.deleteLayerData(o)}catch(d){u.e(d)}finally{u.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(s.size>0)){e.next=18;break}return e.delegateYield((0,r.Z)().mark((function e(){var t,i,a,o,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Array.from(s),i=[],a=(0,n.Z)(l);try{for(u=function(){var e=o.value,r=c._updatingHandles.addPromise(c._fetchQueue.push(e.key).then((function(i){return c._parseQueue.push({key:e.key,data:i,styleLayerUIDs:t})})).then((function(t){return e.setData(t)})));i.push(r)},a.s();!(o=a.n()).done;)u()}catch(d){a.e(d)}finally{a.f()}return e.next=5,Promise.all(i);case 5:case"end":return e.stop()}}),e)}))(),"t1",18);case 18:this._styleChanges=[],this._isTileHandlerReady=!0,this.requestUpdate();case 19:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"_loadStyle",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,i,n,a,s,l=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo.style,i=(0,y.d9)(t),this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._styleRepository=new he.Z(i),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController,n=this._tileHandlerAbortController.signal,e.prev=3,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,i,this.layer.tileInfo.lods.length-1),e.next=7,this._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),(0,_.D_)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!n.aborted){e.next=15;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,void this.requestUpdate()));case 15:return e.next=17,this._tileHandler.spriteMosaic;case 17:a=e.sent,s=this._vectorTileContainer,this._tileInfoView=new de.Z(this.layer.tileInfo,this.layer.fullExtent),s.setStyleResources(a,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this._tileManager=new D({acquireTile:function(e){return l.acquireTile(e)},releaseTile:function(e){return l.releaseTile(e)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.requestUpdate();case 20:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,b.Ue)(),e),i=this._tileInfoView.getTileResolution(e.level);return new P.i(e,i,t[0],t[3],512,512,this._styleRepository)}},{key:"_queryTile",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i,a,s,l,o){var u,h,c,d,y,f,v,_;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==l.layerData.size){e.next=2;break}return e.abrupt("return");case 2:return u=this._ensureTileIndex(l),h=this._tileInfoView.getTileBounds((0,b.Ue)(),l.key,!0),c=(i.x-h[0])/(h[2]-h[0])*4096,d=4096*(1-(i.y-h[1])/(h[3]-h[1])),e.next=8,u.queryAttributes(c,d,a,s,o);case 8:y=e.sent,f=(0,n.Z)(y);try{for(f.s();!(v=f.n()).done;)(_=v.value).graphic.geometry=this._tileToMapPoint(_.tilePoint,l.transforms.tileUnitsToPixels),t.push({type:"graphic",layer:this.layer,graphic:_.graphic,mapPoint:i.clone()})}catch(r){f.e(r)}finally{f.f()}t.sort((function(e,t){return t.graphic.origin.layerIndex-e.graphic.origin.layerIndex}));case 12:case"end":return e.stop()}}),e,this)})));return function(t,i,r,n,a,s){return e.apply(this,arguments)}}()},{key:"_tileToMapPoint",value:function(e,t){if(!e)return null;var i=e[0]*t[0]+e[1]*t[3]+t[6],r=e[0]*t[1]+e[1]*t[4]+t[7],n=this.view.state,a=[0,0];return n.toMap(a,[i,r]),new k.Z({x:a[0],y:a[1],spatialReference:n.spatialReference})}},{key:"_ensureTileIndex",value:function(e){var t=e.featureIndex;return t||(t=oe.create(e.key,e.layerData,this._styleRepository,this._tileHandler,this.layer),e.featureIndex=t),t}}]),i}((0,ce.y)(fe.Z));(0,d._)([(0,p.Cb)()],ve.prototype,"_isTileHandlerReady",void 0);var _e=ve=(0,d._)([(0,m.j)("esri.views.2d.layers.VectorTileLayerView2D")],ve)}}]);
//# sourceMappingURL=26250.dd803001.chunk.js.map