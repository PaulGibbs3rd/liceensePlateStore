"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[63336,2346],{63336:function(e,t,n){n.r(t),n.d(t,{DrawGraphicTool3D:function(){return ve},ExtentTransformTool:function(){return gi},ManipulatedObject3DGraphic:function(){return ki},MoveTool3D:function(){return Ct},ReshapeTool3D:function(){return dn},TransformTool3D:function(){return Fn}});var i=n(93433),a=n(1413),o=n(15671),r=n(43144),l=n(88301),s=n(61120),u=n(60136),c=n(29388),p=n(27366),d=n(86950),h=n(42537),v=n(92026),f=n(94172),_=n(49861),g=(n(93169),n(32718),n(84936),n(69912)),y=n(32035),m=n(12400),b=n(74509),M=n(64575),S=n(17842),k=(n(10064),n(74165)),w=n(15861),x=n(51995),O=n(7138),C=n(14921),E=n(16889),T=n(66978),Z=n(58935),I=n(68860),j=n(13611),A=n(6644),R=n(69662),D=n(51378),P=n(41201),z=n(74177),L=n(36444),H=n(59418),V={default:15,far:25},G=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).context=null,i.stagedVertex=null,i.visible=!0,i.edgeDistance="default",i._messagesUnits=null,i._labelInfos=[],i._nextLabelIndex=0,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=(0,C.vr)(function(){var t=(0,w.Z)((0,k.Z)().mark((function t(n){var i;return(0,k.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,P.ME)("esri/core/t9n/Units");case 2:i=t.sent,(0,T.k_)(n),e._messagesUnits=i;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());this.addHandles([(0,f.watch)((function(){return[null!=e.context&&e.getCameraOrExtent(e.context),e.visible,e._edgeDistancePixels,e.stagedVertex,e._messagesUnits]}),(function(){return e._update()}))].concat((0,i.Z)(["vertex-add","vertex-update","vertex-remove"].map((function(t){return(0,f.on)((function(){var t;return null===(t=e.context)||void 0===t?void 0:t.editGeometryOperations}),t,(function(){return e._update()}))}))),[(0,h.kB)((function(){return t.abort()})),(0,f.watch)((function(){return e._colors}),(function(t){return e._updateStyle(t)}))]))}},{key:"destroy",value:function(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}},{key:"updating",get:function(){return null==this._messagesUnits}},{key:"test",get:function(){}},{key:"_edgeDistancePixels",get:function(){return V[this.edgeDistance]}},{key:"_colors",get:function(){var e,t,n=null!==(e=null===(t=this.context)||void 0===t?void 0:t.view.effectiveTheme.textColor)&&void 0!==e?e:x.Z.fromArray([255,255,255]);return{textColor:n,backgroundColor:(0,d.G)((0,d.mj)(n,d.K6.Low),.6)}}},{key:"_update",value:function(){if(!this.destroyed){this._nextLabelIndex=0;var e=this.context,t=this.stagedVertex;if(!e)return this._destroyUnusedLabels();var n=e.editGeometryOperations,i=n.data,a=i.components,o=i.geometry,r=i.coordinateHelper;if(!o)return this._destroyUnusedLabels();for(var l=a.length,s=0;s<l;++s){var u=U(o,n,t,r,s);if(!(u.length<2)&&F(u,e.view,e.elevationInfo,r.spatialReference)){var c=1===l&&!(0,R.bu)(u),p=Y,d=W;this.toScreenPointArray(e,u[0],p);for(var h=1;h<u.length;++h){var v,f=u[h-1],_=u[h];this.toScreenPointArray(e,_,d),this._addLabel(e,f,p,_,d,c),p=(v=[d,p])[0],d=v[1]}}}this._destroyUnusedLabels()}}},{key:"_updateStyle",value:function(e){for(var t=e.textColor,n=e.backgroundColor,i=this._nextLabelIndex,a=this._labelInfos,o=0;o<i;++o){var r=a[o].label;r.textColor=t,r.backgroundColor=n}}},{key:"_addLabel",value:function(e,t,n,i,a,o){var r=this._getOrCreateLabel(e).label;if(!this.visible||(0,j.bI)(n,a)<3025)r.visible=!1;else{var l=e.editGeometryOperations.data.spatialReference,s=(0,H.x)(t,i,l),u=this._messagesUnits,c=(0,z.R)(e.view);r.text=null!=u&&null!=s?(0,Z.N9)(u,s,c):"",r.visible=!0;var p=a[0]-n[0],d=a[1]-n[1];o?(0,j.t8)(B,-d,p):(0,j.t8)(B,d,-p),(0,j.Fv)(B,B),(0,j.bA)(B,B,this._edgeDistancePixels),(0,j.t7)(X,n,a,.5),(0,j.IH)(X,X,B),r.position=[X[0],X[1]],Math.abs(B[0])>Math.abs(B[1])?r.anchor=B[0]>0?"left":"right":r.anchor=-B[1]<0?"top":"bottom"}}},{key:"_getOrCreateLabel",value:function(e){var t,n=this._labelInfos.length>this._nextLabelIndex,i=this._colors,a=i.textColor,o=i.backgroundColor;if(n){var r=this._labelInfos[this._nextLabelIndex++],l=r.label;return l.textColor=a,l.backgroundColor=o,r}var s=new L.Z({anchor:"center",fontSize:8,textColor:a,backgroundColor:o});null===(t=e.view.overlay)||void 0===t||t.items.add(s);var u={label:s};return this._labelInfos.push(u),this._nextLabelIndex=this._labelInfos.length,u}},{key:"_destroyUnusedLabels",value:function(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}},{key:"_destroyLabel",value:function(e){var t,n,i=e.label;null!==(t=this.context)&&void 0!==t&&null!==(n=t.view.overlay)&&void 0!==n&&n.items.remove(i),i.destroy()}}]),n}(O.default);function U(e,t,n,i,a){var o=[];if(t.data.components[a].iterateVertices((function(e){o.push(i.toXYZ(e.pos,D.WM.get()))})),0===a&&null!=n&&o.push(i.toXYZ(n,D.WM.get())),o.length<2)return o;var r=o[0],l=o[o.length-1];return"polygon"===e.type&&o.length>2&&!(0,y.G)(r,l)&&o.push(r),o}function F(e,t,n,i){var a;if("2d"===t.type)return!0;for(var o=null!==(a=(0,I.Z7)(i))&&void 0!==a?a:1,r=(0,I._R)(i),l=function(e){var a;return null!==(a=(0,b.zx)(t,e,i,n,b.jG))&&void 0!==a?a:0},s=1;s<e.length;++s){var u=e[s-1],c=e[s],p=(c[0]-u[0])*o,d=(c[1]-u[1])*o,h=(l(c)-l(u))*r;if(Math.abs(h)/Math.sqrt(p*p+d*d)>N)return!1}return!0}(0,p._)([(0,_.Cb)()],G.prototype,"context",void 0),(0,p._)([(0,_.Cb)()],G.prototype,"stagedVertex",void 0),(0,p._)([(0,_.Cb)()],G.prototype,"visible",void 0),(0,p._)([(0,_.Cb)()],G.prototype,"edgeDistance",void 0),(0,p._)([(0,_.Cb)()],G.prototype,"updating",null),(0,p._)([(0,_.Cb)()],G.prototype,"_messagesUnits",void 0),(0,p._)([(0,_.Cb)()],G.prototype,"_edgeDistancePixels",null),(0,p._)([(0,_.Cb)()],G.prototype,"_colors",null),G=(0,p._)([(0,g.j)("esri.views.interactive.SegmentLabels")],G);var N=(0,E.Vl)(5),B=(0,A.Ue)(),X=(0,A.Ue)(),Y=(0,S.s1)(),W=(0,S.s1)(),Q=n(11208),$=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"getCameraOrExtent",value:function(e){return e.view.state.camera}},{key:"toScreenPointArray",value:function(e,t){var n=e.view,i=e.elevationInfo,a=e.editGeometryOperations,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,S.s1)(),r=a.data.coordinateHelper.spatialReference;return(0,Q.RS)(t,r,i,n,J),n.state.camera.projectToScreen(J,o),o}}]),n}(G);$=(0,p._)([(0,g.j)("esri.views.3d.interactive.SegmentLabels3D")],$);var J=(0,m.Ue)(),q=n(79311),K=n(67331);function ee(e){var t=e.graphic;return t?[(0,f.watch)((function(){return"visible"in e?e.visible:e.displaying}),(function(e){e&&t.notifyMeshTransformChanged({action:K.u.EnableFastUpdates})}),(0,a.Z)({},f.syncAndInitial)),(0,h.kB)((function(){return t.notifyMeshTransformChanged({action:K.u.DisableFastUpdates})}))]:[]}var te=n(99047),ne=n(97411),ie=n(87198),ae=n(27676),oe=n(69691),re=n(78935),le=n(94687),se=n(56529),ue=n(84827),ce=n(66038),pe=n(46640),de=n(87036),he=n(27088),ve=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._activeVertexVisualElement=null,i._createGraphicState=null,i._outlineVisualElement=null,i._verticesVisualElement=null,i._verticalLineVisualElement=null,i._settings=new te.Z({getTheme:function(){return i.view.effectiveTheme}}),i.geometryType=null,i.type="draw-3d",i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this.elevationInfo,t=e.mode,n=e.offset,i=e.unit;this.internalGraphicsLayer.elevationInfo=new M.Z({mode:t,offset:n,unit:i})}},{key:"normalizeCtorArgs",value:function(e){if(!e.elevationInfo){var t,n=null===(t=e.hasZ)||void 0===t||t;return(0,a.Z)((0,a.Z)({},e),{},{elevationInfo:(0,b.mF)(n)})}return e}},{key:"initializeGraphic",value:function(e){var t=this,n=this.view,a=this._createGraphicState=new le.F({graphic:e});return(0,h.AL)([n.maskOccludee(e),n.trackGraphicState(a),(0,f.watch)((function(){return{element:t._outlineVisualElement,isDraped:a.isDraped}}),(function(e){var t=e.element,n=e.isDraped;t&&(t.isDraped=n)}),f.syncAndInitial),(0,he.EH)((function(){(0,de.Jo)(t.tooltipInfos.mesh,t.geometryToPlace)})),this._setupLoadingIndicator(a)].concat((0,i.Z)(ee(a))))}},{key:"makeDrawOperation",value:function(){var e=this.geometryType,t="circle"!==e&&"rectangle"!==e;return new ce.wW({view:this.view,manipulators:this.manipulators,geometryType:(0,ue.I)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new pe.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new pe.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new q._,segmentLabels:t?new $:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,b.Zz)(this.hasZ,this.elevationInfo),cursor:this.cursor,constraintsEnabled:!0})}},{key:"onActiveVertexChanged",value:function(e){var t=this,n=this.view;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),(0,h.kB)();var i=this._settings,a=i.manipulators.vertex,o=new ae.j({view:n,spatialReference:n.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=o;var r=i.visualElements.zVerticalLine,l=new ne.V({view:n,extensionType:r.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:se.yD.OccludeAndTransparent,isDecoration:!0});this._verticalLineVisualElement=l;var s=(0,h.AL)([(0,f.watch)((function(){return i.visualElements.zVerticalLine}),(function(e){return e.apply(l)}),f.initial),(0,f.watch)((function(){return{selectedColor:(0,d.O)(i.colors.selected),outlineColor:(0,d.O)(i.manipulators.vertex.outlineColor)}}),(function(e){var t=e.selectedColor,n=e.outlineColor;o.color=t,o.outlineColor=n}),f.initial),(0,h.kB)((function(){t._activeVertexVisualElement=(0,v.SC)(t._activeVertexVisualElement),t._verticalLineVisualElement=(0,v.SC)(t._verticalLineVisualElement)}))]);return o.attached=!0,this._updateVerticalLineVisualElement(e),s}},{key:"_updateVerticalLineVisualElement",value:function(e){var t=this._verticalLineVisualElement;if(t){var n=this.view,i=n.renderCoordsHelper,a=n.elevationProvider;(0,y.s)(_e,e[0],e[1],e[2]),fe.setFromElevationInfo(this.elevationInfo),_e[2]=(0,oe.w7)(_e,a,fe,i),i.toRenderCoords(_e,this.view.spatialReference,_e)?(t.setStartEndFromWorldDownAtLocation(_e),t.attached=!0):t.attached=!1}}},{key:"onOutlineChanged",value:function(e){var t=this;if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,(0,h.kB)();var n=this.internalGraphicsLayer.elevationInfo,i=this.view,a=this._settings,o=new ie.k({view:i,geometry:e,elevationInfo:n,isDraped:this._createGraphicState?this._createGraphicState.isDraped:"on-the-ground"===(0,b.Zz)(this.hasZ,n),attached:!1,isDecoration:!0});this._outlineVisualElement=o;var r=(0,h.AL)([(0,f.watch)((function(){return a.visualElements.lineObjects.outline}),(function(e){return e.apply(o)}),f.initial),(0,f.watch)((function(){return a.visualElements.lineObjects.shadowStyle}),(function(e){return e.apply(o)}),f.initial),(0,h.kB)((function(){t._outlineVisualElement=(0,v.SC)(t._outlineVisualElement)}))]);return o.attached=!0,o.laserlineEnabled=!0,r}},{key:"onRegularVerticesChanged",value:function(e){var t=this;if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,(0,h.kB)();var n=this.view,i=this._settings,a=i.manipulators.vertex,o=new ae.j({view:n,spatialReference:n.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:a.size,outlineSize:a.outlineSize,renderOccluded:a.renderOccluded,attached:!1,isDecoration:!0}),r=(0,h.AL)([(0,f.watch)((function(){return{color:(0,d.O)(i.manipulators.vertex.color),outlineColor:(0,d.O)(i.manipulators.vertex.outlineColor)}}),(function(e){var t=e.color,n=e.outlineColor;o.color=t,o.outlineColor=n}),f.initial),(0,h.kB)((function(){t._verticesVisualElement=(0,v.SC)(t._verticesVisualElement)}))]);return o.attached=!0,this._verticesVisualElement=o,r}},{key:"updateGraphicGeometry",value:function(e){if("mesh"!==this.geometryType||"point"!==(null===e||void 0===e?void 0:e.type))(0,l.Z)((0,s.Z)(n.prototype),"updateGraphicGeometry",this).call(this,e);else{var t=this.geometryToPlace;null!==t&&void 0!==t&&t.centerAt(e),(0,de.Jo)(this.tooltipInfos.mesh,t);var i=this._graphic;t&&i.geometry===t||(i.geometry=t)}}},{key:"_setupLoadingIndicator",value:function(e){var t=this.drawOperation;if(!this.geometryToPlace)return t.loading=!1,null;t.loading=!0;var n,i=(0,h.kB)((function(){t.loading=!1})),o=function(){return n&&cancelAnimationFrame(n)};return(0,h.AL)([(0,f.when)((function(){return e.displaying}),(function(){o(),n=requestAnimationFrame((function(){return i.remove()}))}),(0,a.Z)((0,a.Z)({},f.syncAndInitial),{},{once:!0})),(0,h.kB)(o),i])}}]),n}(ue.T);(0,p._)([(0,_.Cb)({constructOnly:!0})],ve.prototype,"elevationInfo",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],ve.prototype,"geometryType",void 0),(0,p._)([(0,_.Cb)()],ve.prototype,"type",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],ve.prototype,"view",void 0),ve=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],ve);var fe=new re.o,_e=(0,m.Ue)(),ge=n(37762),ye=n(63780),me=n(80987),be=n(91505),Me=n(47898),Se=n(46634),ke=n(55946),we=n(24204);function xe(e){var t=Oe(e);return(0,A.al)(Math.cos(t),Math.sin(t))}function Oe(e){if(null==e||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t,n="polyline"===e.type?e.paths:e.rings,i=(0,we.bn)(),a=(0,ge.Z)(n);try{for(a.s();!(t=a.n()).done;)for(var o=t.value,r=0;r<o.length-1;r++){var l=o[r],s=o[r+1],u=l[0]-s[0],c=l[1]-s[1];if(u*u+c*c>i)return Math.atan2(s[1]-l[1],s[0]-l[0])}}catch(p){a.e(p)}finally{a.f()}return 0}var Ce=n(36222),Ee=n(666),Te=n(81655),Ze=n(153),Ie=n(4914);function je(e,t,n){function i(){var e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return(0,a.Z)((0,a.Z)({},e),{},{activeTooltipInfo:t})}var o=!1;function r(n){var i=n.activeTooltipInfo,a=n.sketchOptions;o=!0,i&&(i.sketchOptions=a,Re(i,t)),e.info=i,o=!1}return(0,h.AL)([(0,f.watch)(i,r,f.syncAndInitial),(0,f.watch)((function(){var e=i(),n=e.activeTooltipInfo;if(n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:(0,Ee.$)(t)}}),(function(e,n){e&&!o&&n&&n.key!==e.key&&function(e,t,n){var i=n.callbacks,a=(0,Ee.$)(t);switch(null===a||void 0===a?void 0:a.type){case"mesh":Ae(e,a.origin,t,i),"orientation"in e&&"scale"in e&&(0,de.Jo)(e,a,i);break;case"point":Ae(e,a,t,i)}}(e.activeTooltipInfo,t,e.context)}),f.sync),t.on("committed",(function(){return r(i())})),(0,de.OE)(e)])}function Ae(e,t,n,i){var a,o,r,l,s=(0,de.$4)(e,t),u=s.dx,c=s.dy,p=s.dz;0===u&&0===c&&0===p||(null!==(a=i.onMoveStart)&&void 0!==a&&a.call(i),null!==(o=n.operations)&&void 0!==o&&o.move(u,c,p,Ze.b.NEW_STEP),null!==(r=i.onMove)&&void 0!==r&&r.call(i,u,c,p),null===(l=i.onMoveStop)||void 0===l||l.call(i))}function Re(e,t){var n=(0,Ee.$)(t);if(e&&n&&("mesh"===n.type||"point"===n.type)){var i="mesh"===n.type,a=i?n.origin:n;e.setLocationFromPoint(a),De(e,a,t),"transform-mesh"===e.type&&i&&(0,de.kJ)(e,n),e.clearInputValues()}}function De(e,t,n){var i;e.elevation.actual=(0,Ie.un)(t),e.elevation.visible=!(null===(i=n.operations)||void 0===i||!i.data.coordinateHelper.hasZ()),e.elevation.readOnly=!1,e.elevation.showAsZ=!0}var Pe,ze=n(76432),Le=n(35284);!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(Pe||(Pe={}));var He=n(41029),Ve=function(){function e(){(0,o.Z)(this,e),this.grabbingState=Pe.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return(0,r.Z)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=Pe.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,n){if(n===He.d.TRANSLATE_Z&&(t.zManipulator=e),e instanceof Le.Z&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),null==t.firstGrabbedXY&&e.grabbing&&n===He.d.TRANSLATE_XY&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=Pe.ANY,n){case He.d.TRANSLATE_Z:t.grabbingState|=Pe.Z;break;case He.d.TRANSLATE_XY:t.grabbingState|=Pe.XY}}))}}]),e}(),Ge=n(96026);function Ue(e){var t=e.object,n=function(e){var t=e.view,n=e.object,i=(0,Ee.$)(n),a=new ie.k({view:t,geometry:Be(i)?i:null,elevationInfo:n.elevationInfo,attached:!1,isDecoration:!0}),o=new te.Z({getTheme:function(){return t.effectiveTheme}}),r=function(){a.attached=n.visible},l=(0,h.AL)([(0,f.watch)((function(){return o.visualElements.lineObjects.outline}),(function(e){return e.apply(a)}),f.initial),(0,f.watch)((function(){return o.visualElements.lineObjects.shadowStyle}),(function(e){return e.apply(a)}),f.initial),(0,f.watch)((function(){return n.visible}),r),(0,f.watch)((function(){return n.isDraped}),(function(e){a.isDraped=e}),f.initial),n.on("committed",(function(){var e=(0,Ee.$)(n);a.geometry=Be(e)?e:null})),(0,h.ed)(a)]);return r(),{visualElement:a,remove:function(){return l.remove()}}}(e),i=[n,Fe(e,n.visualElement)];return t.maskOccludee&&i.push(t.maskOccludee()),{visualElement:n.visualElement,remove:function(){return(0,h.R5)(i)}}}function Fe(e,t){var n=e.object,i=e.view,a=[],o=n.elevationInfo,r="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,l=new Ve,s=new te.Z({getTheme:function(){return i.effectiveTheme}}),u=s.visualElements,c=new ne.V({view:i,extensionType:u.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:se.yD.OccludeAndTransparent,isDecoration:!0}),p=(0,E.Vl)(u.heightPlaneAngleCutoff),d=new Ge.W({view:i,attached:!1,angleCutoff:p,isDecoration:!0}),v=(0,ze.t)(1);a.push((0,f.watch)((function(){return{lineShadowStyle:s.visualElements.lineObjects.shadowStyle,pointShadowStyle:s.visualElements.pointObjects.shadowStyle,alpha:v.value}}),(function(e){var n=e.lineShadowStyle,i=e.pointShadowStyle,a=e.alpha;n.apply(t,a),i.apply(c,a)}),f.initial));var _=(0,ze.t)(1);a.push((0,f.watch)((function(){return{heightPlane:s.visualElements.heightPlane,alpha:_.value}}),(function(e){var t=e.heightPlane,n=e.alpha;return t.apply(d,n)}),f.initial));var g=function(){l.update(e);var i=(0,Ee.$)(n);if(!n.visible||r&&(n.isDraped||!Be(i)||!i.hasZ))return t.laserlineEnabled=!1,c.attached=!1,void(d.attached=!1);t.laserlineEnabled=!0;var a=l.grabbingState&Pe.XY?u.laserlineAlphaMultiplier:1;v.value=a;var o=l.grabbingState&Pe.Z?u.laserlineAlphaMultiplier:1;_.value=o,function(e,t){var n=1===t.numSelected?t.firstSelected:t.numSelected>1&&null!=t.firstGrabbedXY?t.firstGrabbedXY:null;null!=n?(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0):e.attached=!1}(c,l),Ne(e,t,d,l)};a.push((0,f.watch)((function(){return s.visualElements.zVerticalLine}),(function(e){return e.apply(c)}),f.initial)),a.push(n.on("committed",g),(0,f.watch)((function(){return n.visible}),g),t.events.on("attachment-origin-changed",g),(0,h.ed)(c),(0,h.ed)(d));var y=[],m=function(){(0,h.R5)(y),y.length=0,e.forEachManipulator((function(e){return y.push(e.events.on("grab-changed",g))})),e.forEachManipulator((function(e){return y.push(e.events.on("select-changed",g))})),g()};return m(),a.push(e.onManipulatorsChanged(m),(0,h.iU)((function(){return(0,h.AL)(y)}))),(0,h.AL)(a)}function Ne(e,t,n,i){if(i.numSelected>0){(0,y.s)(Xe,0,0,0);var a=0;e.forEachManipulator((function(e,t){t===He.d.TRANSLATE_XY&&e.selected&&e instanceof Le.Z&&((0,y.g)(Xe,Xe,e.renderLocation),a++)})),a>0?(n.heightManifoldTarget=(0,y.j)(Xe,Xe,1/a),n.attached=!0):n.attached=!1}else{var o=t.attachmentOrigin;null!=o&&e.view.renderCoordsHelper.toRenderCoords(o,Xe)?(n.heightManifoldTarget=Xe,n.attached=!0):n.attached=!1}}function Be(e){return null!=e&&("polygon"===e.type||"polyline"===e.type)}var Xe=(0,m.Ue)(),Ye=n(68859),We=n(5986),Qe=n(41414),$e=n(65156),Je=n(66730);function qe(e){var t=[],n=function(e,t){var n=e.view,i=e.object,a=new Je.L({view:n,geometry:Ke((0,Ee.$)(i)),elevationInfo:i.elevationInfo,isDecoration:!0});return function(e,t,n){var i=e.view,a=e.object,o=function(){t.attached=a.visible},r=new te.Z({getTheme:function(){return i.effectiveTheme}});(function(e,t,n){var i=e.view,a=e.object,o=null,r=function(e){null!=o&&(o.remove(),o=null),a.isDraped&&null!=e&&(o=function(e,t,n){var i=e.elevationProvider.spatialReference;(0,Ye.K)(t,et,i);var a=et[0],o=et[1];return e.elevationProvider.on("elevation-change",(function(e){(0,$e.jE)(e.extent,a,o)&&n()}))}(i,e,(function(){t.geometry=e})))},l=function(){var e=Ke((0,Ee.$)(a));null!=e&&(0,b.AA)(a.elevationInfo)&&(e.z=0),r(e),t.geometry=e};n.push(a.on("committed",l),(0,h.iU)((function(){return o}))),l()})(e,t,n),r.visualElements.pointObjects.outline.apply(t),n.push((0,f.watch)((function(){return a.visible}),o,f.initial))}(e,a,t),t.push((0,h.ed)(a)),a}(e,t);return function(e,t,n){var i=e.view,a=e.object,o=new te.Z({getTheme:function(){return i.effectiveTheme}}),r=new ne.V({view:i,extensionType:o.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:se.yD.OccludeAndTransparent,isDecoration:!0});t.push((0,f.watch)((function(){return o.visualElements.zVerticalLine}),(function(e){return e.apply(r)}),f.initial));var l=new Ge.W({view:i,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),s=(0,E.Vl)(o.visualElements.heightPlaneAngleCutoff),u=new Ge.W({view:i,attached:!1,angleCutoff:s,isDecoration:!0}),c=a.elevationInfo,p=re.o.fromElevationInfo(c),d="on-the-ground"===c.mode||!c.offset&&"absolute-height"!==c.mode,v=new Ve,_=(0,ze.t)(1);t.push((0,f.watch)((function(){return{heightPlane:o.visualElements.heightPlane,alpha:_.value}}),(function(e){var t=e.heightPlane,n=e.alpha;return t.apply(u,n)}),f.initial));var g=(0,ze.t)(1);t.push((0,f.watch)((function(){return{shadowStyle:o.visualElements.pointObjects.shadowStyle,alpha:g.value}}),(function(e){var t=e.shadowStyle,n=e.alpha;return t.apply(l,n)}),f.initial));var m=function(){v.update(e);var t=Ke((0,Ee.$)(a)),s=d&&(a.isDraped||null==t||!t.hasZ),c=!0;if(s||null==t)c=!1;else{(0,b.AA)(a.elevationInfo)&&((t=t.clone()).z=0);var h=(0,oe.w7)(t,i.elevationProvider,p,i.renderCoordsHelper);(0,y.s)(et,t.x,t.y,h),(0,We.S)(et,t.spatialReference,et,i.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation(et),l.intersectsWorldUpAtLocation=et}var f=v.grabbingState&Pe.Z?o.visualElements.laserlineAlphaMultiplier:1;_.value=f;var m=(0,Qe.cS)(tt);!s&&a.visible&&n.calculateMapBounds(m)&&(0,We.S)((0,Qe.KE)(m,et),i.spatialReference,et,i.renderCoordsHelper.spatialReference)?(u.heightManifoldTarget=et,u.attached=!0):u.attached=!1;var M=v.grabbingState&Pe.XY?o.visualElements.laserlineAlphaMultiplier:1;g.value=M;var S=c&&a.visible&&!s;l.attached=S,r.attached=S};t.push((0,f.watch)((function(){return[a.visible,a.isDraped]}),m),a.on("committed",m)),e.forEachManipulator((function(e){t.push(e.events.on("grab-changed",m))})),t.push((0,h.ed)(l)),t.push((0,h.ed)(r)),t.push((0,h.ed)(u)),m()}(e,t,n),{visualElement:n,remove:function(){return(0,h.R5)(t)}}}function Ke(e){return null==e?null:"point"===e.type?e:"mesh"===e.type?e.anchor.clone():null}var et=(0,m.Ue)(),tt=(0,Qe.Ue)();function nt(e){var t;switch(null===(t=(0,Ee.$)(e.object))||void 0===t?void 0:t.type){case"point":case"mesh":return qe(e);case"polygon":case"polyline":return Ue(e);default:return null}}var it=n(89107),at=n(6599),ot=n(72248),rt=n(51328),lt=n(70818),st=n(74229),ut=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i,a,r;return(0,o.Z)(this,n),(r=t.call(this))._view=e.view,r._tool=e.tool,r._object=e.object,r._manipulator=null===(i=(a=r._object).createManipulator)||void 0===i?void 0:i.call(a,{selectable:!0,cursor:"move"}),r.forEachManipulator((function(e){return r._tool.manipulators.add(e)})),r}return(0,r.Z)(n,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){this._manipulator&&e(this._manipulator,He.d.TRANSLATE_XY)}},{key:"createManipulatedObjectDragPipeline",value:function(e){var t=this;return(0,ot.$)(this._object,e,(function(e){return t.createDragPipeline(e)}))}},{key:"createDragPipeline",value:function(e){var t=this;if(!this._manipulator)return(0,h.kB)();var n=this._view;return(0,st.Xd)(this._manipulator,(function(i,a,o,r,l){var s,u=null===(s=t._object.operations)||void 0===s?void 0:s.data.spatialReference,c=a.next((function(e){return u?e:null})).next((0,rt.JA)(l,n,t._object,u)).next((0,st.AN)()).next((0,st.zh)());e(i,c,o,r,l)}))}}]),n}(lt.b),ct=n(7445),pt=n(45900),dt=n(17877),ht=n(59981),vt=n(34019),ft=n(80151),_t=n(26091),gt=n(51155),yt=n(42170),mt=n(85809),bt=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="translate-xy",i.distance=Me.yP,i}return(0,r.Z)(n)}(mt.h);(0,p._)([(0,_.Cb)()],bt.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],bt.prototype,"distance",void 0),bt=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo")],bt);var Mt=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="translate-z",i.distance=Me.yP,i}return(0,r.Z)(n,[{key:"clear",value:function(){this.distance=Me.yP}}]),n}(mt.h);(0,p._)([(0,_.Cb)()],Mt.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],Mt.prototype,"distance",void 0),Mt=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.TranslateZTooltipInfo")],Mt);var St=(0,r.Z)((function e(t){(0,o.Z)(this,e),this.objects=t,this.type="move-start"})),kt=(0,r.Z)((function e(t,n,i){(0,o.Z)(this,e),this.dx=t,this.dy=n,this.objects=i,this.type="move"})),wt=(0,r.Z)((function e(t){(0,o.Z)(this,e),this.objects=t,this.type="move-stop"})),xt=Symbol("manipulators"),Ot=Symbol("tooltips"),Ct=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._infos=new Map,i.events=new be.Z,i.objects=new me.Z,i.enableZ=!0,i.sketchOptions=new ht.Z,i.type="move-3d",i._latestTooltipInfo=null,i._translateTooltipInfo=null,i._translateXYTooltipInfo=null,i._translateZTooltipInfo=null,i._updatingHandles=new Se.R,i._moveManipulation=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view;this.tooltip=new _t.u({view:t}),this.addHandles([this.objects.on("change",(function(t){t.removed.forEach((function(t){return e.removeHandles(t)})),e._updateObjectInfos(t),e._setupFastTransformUpdates(t.added),e._refreshManipulators()})),this.objects.on("change",(function(){return e._connectTooltips()}))]);var n=this.objects.toArray();this._updateObjectInfos({added:n,removed:[]}),this._setupFastTransformUpdates(n),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}},{key:"destroy",value:function(){this.tooltip=(0,v.SC)(this.tooltip),this._moveManipulation=(0,v.SC)(this._moveManipulation),this._set("view",null),this._updatingHandles.destroy()}},{key:"onInputEvent",value:function(e){if(!this.destroyed&&!(0,de._i)(e,this.tooltip))return(0,l.Z)((0,s.Z)(n.prototype),"onInputEvent",this).call(this,e)}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"_shouldShowMovePointTooltip",get:function(){var e,t=this.objects;if(1!==t.length)return!1;var n=null===(e=(0,Ee.$)(t.at(0)))||void 0===e?void 0:e.type;return"point"===n||"mesh"===n}},{key:"activeTooltipInfo",get:function(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}},{key:"reset",value:function(){}},{key:"_updateObjectInfos",value:function(e){var t,n=e.added,i=e.removed,a=(0,ge.Z)(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;if((0,ct.Y)(o)===Ce.h.SUPPORTED){var r=new Et(o);this._infos.set(o,r)}}}catch(c){a.e(c)}finally{a.f()}var l,s=(0,ge.Z)(i);try{for(s.s();!(l=s.n()).done;){var u=l.value;this._infos.delete(u)}}catch(c){s.e(c)}finally{s.f()}}},{key:"_setupFastTransformUpdates",value:function(e){var t,n=(0,ge.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this._infos.get(i);this.addHandles(ee(a.object),i)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_refreshManipulators",value:function(){if(this.removeHandles(xt),this._moveManipulation=(0,v.SC)(this._moveManipulation),this.manipulators.removeAll(),0!==this._infos.size){var e=Array.from(this._infos.values());this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}}},{key:"_createManipulators",value:function(e){var t,n=this,i=(0,ge.Z)(e);try{var o=function(){var i=t.value,o=i.object;i.manipulationXY=new ut({tool:n,view:n.view,object:o}),i.manipulationXY.forEachManipulator((function(e){n.addHandles([e.events.on("immediate-click",(function(e){n.events.emit("immediate-click",(0,a.Z)((0,a.Z)({},e),{},{object:o})),e.stopPropagation()})),e.events.on("grab-changed",(function(e){"start"===e.action?n._showTooltip(at.p.XY):n._hideTooltip()}))],xt)})),n.addHandles(i.manipulationXY.createDragPipeline((function(t,i,a,o){return n._buildDragEventPipeline(e,at.p.XY,t,i,a,o)})),xt)};for(i.s();!(t=i.n()).done;)o()}catch(r){i.e(r)}finally{i.f()}this._createMoveManipulation(e)}},{key:"_createMoveManipulation",value:function(e){var t,n=this,i=new at.b({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?at.b.radiusForSymbol(null===(t=e[0].object.graphic)||void 0===t?void 0:t.symbol):it.dB});this._moveManipulation=i,i.elevationInfo={mode:"absolute-height",offset:0},i.forEachManipulator((function(e){n.addHandles(e.events.on("immediate-click",(function(t){var o=n.objects.at(0);!i.zManipulation.hasManipulator(e)&&1===n.objects.length&&o&&n.events.emit("immediate-click",(0,a.Z)((0,a.Z)({},t),{},{object:o})),t.stopPropagation()})),xt)}));var o=function(e){return function(t){n.addHandles([t.events.on("focus-changed",(function(t){"focus"===t.action?n._showTooltip(e):n._hideTooltip()})),t.events.on("grab-changed",(function(){n._latestTooltipInfo&&(n._latestTooltipInfo.distance=Me.yP)}))],xt)}};this._moveManipulation.xyManipulation.forEachManipulator(o(at.p.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(o(at.p.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(o(at.p.Z));var r,l=function(){return n._updateMoveManipulation(e)},s=(0,ge.Z)(e);try{var u=function(){var e=r.value;n.addHandles([e.object.on("committed",l),(0,f.watch)((function(){return e.object.visible}),l)],xt)};for(s.s();!(r=s.n()).done;)u()}catch(v){s.e(v)}finally{s.f()}var c=e[e.length-1];this.addHandles(c.object.on("committed",(function(){return n._updateMoveManipulationAngle(c)})),xt);var p=c.object,d=p.operations;if(d){var h=p.graphic;this.addHandles(i.createDragPipeline((function(t,i,a,o,r){return n._buildDragEventPipeline(e,t,i,a,o,r)}),p.elevationInfo,d.data.spatialReference,h),xt)}this._updateMoveManipulationAngle(c)}},{key:"_createVisualElements",value:function(e){var t,n=this,i=(0,ge.Z)(e);try{var a=function(){var i=t.value,a=i.object,o=nt({view:n.view,object:a,forEachManipulator:function(e){var t,a;null!==(t=i.manipulationXY)&&void 0!==t&&t.forEachManipulator(e),null===(a=n._moveManipulation)||void 0===a||a.forEachManipulator(e)},onManipulatorsChanged:function(){return(0,h.kB)()}});null!=o&&(i.geometryRepresentation=o.visualElement,i.geometryRepresentation instanceof ie.k&&n.addHandles([i.geometryRepresentation.events.on("attachment-origin-changed",(function(){i.object.isDraped||n._updateMoveManipulation(e)})),(0,f.watch)((function(){return i.object.isDraped}),(function(){return n._updateMoveManipulation(e)}))],xt),n.addHandles(o,xt))};for(i.s();!(t=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}},{key:"_updateMoveManipulationAngle",value:function(e){this._moveManipulation&&(this._moveManipulation.angle=Oe((0,Ee.$)(e.object)))}},{key:"_updateMoveManipulation",value:function(e){var t=(0,ke.T)(0,0,0,this.view.spatialReference),n=0,i=!1,a=this._moveManipulation;if(a){var o,r,l=(0,ge.Z)(e);try{for(l.s();!(r=l.n()).done;){var s=r.value;if(s.object.visible){this.enableZ&&(0,Te.I)(s.object.operations,s.object.elevationInfo)&&(i=!0);var u=s.geometryRepresentation instanceof ie.k&&!s.object.isDraped?s.geometryRepresentation.attachmentOrigin:s.object.origin;if(null!=u){var c,p=u.x,d=u.y,h=u.z;t.x+=p,t.y+=d,h&&(null!==(c=t.z)&&void 0!==c||(t.z=0),t.z+=h),n++}}}}catch(v){l.e(v)}finally{l.f()}n>0?(t.x/=n,t.y/=n,null!==(o=t.z)&&void 0!==o||(t.z=0),t.z/=n,a.location=t,a.xyManipulation.available=!0,a.xyAxisManipulation.available=!0,a.zManipulation.available=i):a.available=!1}}},{key:"_buildDragEventPipeline",value:function(e,t,n,i,a,o){var r=this,l=[],s=[],u=null,c=null,p=function(){for(var e=0,t=l;e<t.length;e++){t[e].dragging=!1}l.length=0,s.length=0,u=null,c=null,r._moveManipulation&&(r._moveManipulation.interactive=!0)};if(1===e.length&&t===at.p.XY){var d=e[0].object,h=this._buildSnappingPipelineSteps(d,d.elevationInfo,i,a,o);i=h.steps,a=h.cancel}return a=a.next((function(e){var t;return null===(t=c)||void 0===t?void 0:t(e)})).next((function(){return s.length&&r.events.emit("move-stop",new wt(s)),r.destroyed||p(),null})),{steps:i=i.next((function(t){if("start"===t.action){l.length=0,s.length=0;var i,a=(0,ge.Z)(e);try{for(a.s();!(i=a.n()).done;){var o,p,d=i.value;d.dragging||(null===(o=d.manipulationXY)||void 0===o||!o.hasManipulator(n))&&(null===(p=d.manipulationXY)||void 0===p?void 0:p.grabbing)||(l.push(d),s.push(d.object),d.dragging=!0)}}catch(h){a.e(h)}finally{a.f()}if(0!==s.length&&(r._moveManipulation&&(r._moveManipulation.interactive=!1),u=(0,st.fW)(s),c=(0,st.dJ)(s),r._emitRecordUndo(),r.events.emit("move-start",new St(s)),r.destroyed))return null}return 0!==s.length?t:null})).next((function(e){var t;return null===(t=u)||void 0===t?void 0:t(e)})).next((function(e){return r._updateMoveTooltip(t,e),e})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=r.view.toScreen(e.mapStart),n=r.view.toScreen(e.mapEnd),i=n.x-t.x,a=n.y-t.y;if(r.events.emit("move",new kt(i,a,s)),r.destroyed)return null}break;case"end":if(r.events.emit("move-stop",new wt(s)),r.destroyed)return null;p()}return null})),cancel:a}}},{key:"_connectTooltips",value:function(){var e,t=this;if(this.removeHandles(Ot),this._shouldShowMovePointTooltip){var n,i=this.objects.at(0),a=this.events;null!==(n=this._movePointTooltipInfo)&&void 0!==n||(this._movePointTooltipInfo=new gt.o({viewType:this.view.type,sketchOptions:this.sketchOptions}));var o={onMoveStart:function(){t._emitRecordUndo(),a.emit("move-start",new St([i]))},onMove:function(){return a.emit("move",new kt(0,0,[i]))},onMoveStop:function(){return a.emit("move-stop",new wt([i]))}};e=je(this.tooltip,i,(function(){return{sketchOptions:t.sketchOptions,activeTooltipInfo:t._movePointTooltipInfo,callbacks:o}}))}else e=(0,f.watch)((function(){return t.sketchOptions.tooltips.effectiveEnabled?t._latestTooltipInfo:null}),(function(e){t.tooltip.info=e}),f.syncAndInitial);this.addHandles(e,Ot)}},{key:"_showTooltip",value:function(e){this._shouldShowMovePointTooltip||this._updateMoveTooltip(e)}},{key:"_hideTooltip",value:function(){var e;this._shouldShowMovePointTooltip||(null!==(e=this.tooltip)&&void 0!==e&&e.clear(),this._latestTooltipInfo=null)}},{key:"_updateMoveTooltip",value:function(e,t){var n,i,a;if(!this._shouldShowMovePointTooltip){var o=this.sketchOptions;switch(e){case at.p.XY:this._latestTooltipInfo=null!==(n=this._translateTooltipInfo)&&void 0!==n?n:this._translateTooltipInfo=new yt.E({sketchOptions:o}),Tt(this._latestTooltipInfo,t,(function(e,t){return(0,H.Qw)(e,t)}));break;case at.p.XY_AXIS:this._latestTooltipInfo=null!==(i=this._translateXYTooltipInfo)&&void 0!==i?i:this._translateXYTooltipInfo=new bt({sketchOptions:o}),Tt(this._latestTooltipInfo,t,(function(e,n){return(0,Me.bA)((0,H.Qw)(e,n),(0,ot.h)(t))}));break;case at.p.Z:this._latestTooltipInfo=null!==(a=this._translateZTooltipInfo)&&void 0!==a?a:this._translateZTooltipInfo=new Mt({sketchOptions:o}),Tt(this._latestTooltipInfo,t,Ie._e)}this._latestTooltipInfo.sketchOptions=o}}},{key:"_emitRecordUndo",value:function(){var e=this.objects.toArray().map((function(e){var t;return null===(t=e.createUndoRecord)||void 0===t?void 0:t.call(e)})).filter(ye.pC);e.length>0&&this.events.emit("record-undo",{updates:e})}},{key:"_buildSnappingPipelineSteps",value:function(e,t,n,o,r){var l,s=this,u=(0,Ee.$)(e);if(null==u||"point"!==u.type&&"mesh"!==u.type)return{steps:n,cancel:o};var c=("point"===u.type?u:u.anchor).clone(),p=new vt.N({elevationInfo:t,pointer:r,editGeometryOperations:dt.c.fromGeometry(c,this.view.state.viewingMode),visualizer:new q._,excludeFeature:e.graphic}),d=this.snappingManager,h=(0,ft.W)({snappingContext:p,snappingManager:d,updatingHandles:this._updatingHandles}),v=h.snappingStep,f=h.cancelSnapping;return o=o.next(f),{steps:n=(l=n.next((function(t){return c.z=(0,b.vQ)(s.view,c,e.elevationInfo,{mode:"absolute-height",offset:0}),(0,a.Z)((0,a.Z)({},t),{},{snapOrigin:p.coordinateHelper.pointToVector(c)})}))).next.apply(l,(0,i.Z)(v)),cancel:o}}}]),n}(pt.m);(0,p._)([(0,_.Cb)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"view",void 0),(0,p._)([(0,_.Cb)()],Ct.prototype,"objects",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"enableZ",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0,type:ht.Z})],Ct.prototype,"sketchOptions",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],Ct.prototype,"snappingManager",void 0),(0,p._)([(0,_.Cb)()],Ct.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],Ct.prototype,"updating",null),(0,p._)([(0,_.Cb)()],Ct.prototype,"_latestTooltipInfo",void 0),(0,p._)([(0,_.Cb)()],Ct.prototype,"_shouldShowMovePointTooltip",null),(0,p._)([(0,_.Cb)()],Ct.prototype,"activeTooltipInfo",null),Ct=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.move.MoveTool3D")],Ct);var Et=(0,r.Z)((function e(t){(0,o.Z)(this,e),this.object=t,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}));function Tt(e,t,n){if(null!=t&&"end"!==t.action){var i=n(t.mapStart,t.mapEnd);e.distance=null!=i?i:Me.yP}else e.distance=Me.yP}n(59486);var Zt=n(100),It=n(7025),jt=n(29909),At=n(74579),Rt=n(83639),Dt=n(40508),Pt=n(55652),zt=n(3711);function Lt(e,t,n){var i="on-the-ground"===n.mode?zt.v.XY:zt.v.XYZ;return new zt.A(e,i,t,0)}function Ht(e,t,n){var i=(0,m.Ue)();if(!e.renderCoordsHelper.toRenderCoords(t,i))return null;var a=Vt(e,t,(0,Pt.st)(n.plane)),o=Vt(e,t,n.edgeDirection);if(null==a||null==o)return null;var r=(0,y.b)((0,m.Ue)(),a,o);return(0,Pt.Yq)(i,r,(0,Pt.Ue)())}function Vt(e,t,n){var i=(0,ke.T)(t.x+n[0],t.y+n[1],t.z+n[2],t.spatialReference),a=(0,m.Ue)(),o=(0,m.Ue)();return e.renderCoordsHelper.toRenderCoords(t,a)&&e.renderCoordsHelper.toRenderCoords(i,o)?(0,y.E)(o,a,o):null}var Gt=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="reshape-edge-offset",i.distance=Me.yP,i.area=null,i.totalLength=null,i}return(0,r.Z)(n)}(mt.h);(0,p._)([(0,_.Cb)()],Gt.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],Gt.prototype,"distance",void 0),(0,p._)([(0,_.Cb)()],Gt.prototype,"area",void 0),(0,p._)([(0,_.Cb)()],Gt.prototype,"totalLength",void 0),Gt=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo")],Gt);var Ut=n(6896),Ft=n(543),Nt=n(13615);function Bt(e,t){var n=null===t||void 0===t?void 0:t.type;return{edgeOffset:new Gt({sketchOptions:e,viewType:n}),movePoint:new gt.o({sketchOptions:e,viewType:n}),selectedVertex:new Ut.K({sketchOptions:e,viewType:n}),translate:new yt.E({sketchOptions:e,viewType:n}),translateXY:new bt({sketchOptions:e,viewType:n}),translateZ:new Mt({sketchOptions:e,viewType:n})}}function Xt(e,t,n){function i(){var e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return(0,a.Z)((0,a.Z)({},e),{},{activeTooltipInfo:t})}var o=!1;function r(n){o=!0,function(e,t){var n=t.activeTooltipInfo,i=t.selectedVertexManipulatorInfo,a=t.sketchOptions;if(n)switch(n.sketchOptions=a,null===n||void 0===n?void 0:n.type){case"move-point":Re(n,e);break;case"selected-vertex":!function(e,t,n){var i;if(!e||"selected-vertex"!==e.type)return;var a=null===t||void 0===t?void 0:t.manipulator.location;e.setLocationFromPoint(a),De(e,a,n);var o=null===(i=n.operations)||void 0===i?void 0:i.data.geometry;switch(null===o||void 0===o?void 0:o.type){case"polygon":e.geometryType="polygon",e.totalLength.visible=!1,e.area.actual=(0,Ft.f)(o);break;case"polyline":e.geometryType="polyline",e.totalLength.actual=(0,H.C_)(o),e.area.visible=!1}}(n,i,e)}}(t,n),e.info=n.activeTooltipInfo,o=!1}return(0,h.AL)([(0,f.watch)(i,r,f.syncAndInitial),(0,f.watch)((function(){var e=i(),n=e.activeTooltipInfo;if(n&&"key"in n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:(0,Ee.$)(t)}}),(function(e,n){e&&!o&&n&&n.key!==e.key&&function(e,t,n){var i=n.selectedVertexManipulatorInfo,a=n.callbacks,o=(0,Ee.$)(t);switch(null===o||void 0===o?void 0:o.type){case"mesh":"move-point"===e.type&&Ae(e,o.origin,t,a);break;case"point":"move-point"===e.type&&Ae(e,o,t,a);break;case"polyline":case"polygon":"selected-vertex"===e.type&&function(e,t,n,i){var a,o,r,l;if("vertex"!==(null===t||void 0===t?void 0:t.type))return;var s=(0,de.$4)(e,t.manipulator.location),u=s.dx,c=s.dy,p=s.dz;0===u&&0===c&&0===p||(null!==(a=i.onReshapeStart)&&void 0!==a&&a.call(i),null!==(o=n.operations)&&void 0!==o&&o.moveVertices([t.handle],u,c,p,Ze.b.NEW_STEP),null!==(r=i.onReshape)&&void 0!==r&&r.call(i),null===(l=i.onReshapeStop)||void 0===l||l.call(i))}(e,i,t,a)}}(e.activeTooltipInfo,t,e.context)}),f.sync),t.on("committed",(function(){return r(i())})),(0,de.OE)(e)])}function Yt(e,t,n){if(null!=t&&"end"!==t.action){var i=n(t.mapStart,t.mapEnd);e.distance=null!=i?i:Me.yP}else e.distance=Me.yP}function Wt(e,t,n){var i,a=n.sketchOptions,o=n.tooltipInfos.edgeOffset;if(o.distance=Me.yP,null!=t&&"end"!==t.action){var r=e.operations,l=t.mapEnd,s=t.signedDistance,u=t.operation;if(null!=s&&null!=r){var c=r.data.coordinateHelper,p=s*u.selectedArrow;o.distance=function(e,t,n,i,a){if(e){var o=a.toXYZ(a.pointToVector(n)),r=(0,Pt.nF)(i,o,D.WM.get()),l=(0,Nt.FB)(r,o,a.spatialReference);if(null!=l)return(0,Me.yG)(l.value*Math.sign(t),l.unit)}return(0,Me.yG)(t*(0,I.c9)(n.spatialReference),"meters")}(e.isDraped,p,l,u.plane,c)}}var d=null===(i=e.operations)||void 0===i?void 0:i.data.geometry;return o.area="polygon"===(null===d||void 0===d?void 0:d.type)?(0,Ft.f)(d):null,o.totalLength="polyline"===(null===d||void 0===d?void 0:d.type)?(0,H.C_)(d):null,o.sketchOptions=a,o}var Qt=n(70619),$t=n(63920),Jt=n(99034),qt=n(78952),Kt=Symbol(),en=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._selectedIndex=0,i._manipulatorHandles=new Zt.Z,i._manipulatorInfos=[],i._numGrabbing=0,i._numDragging=0,i._reshapeEventState=on.NONE,i._updatingHandles=new Se.R,i._recreatingManipulators=!1,i._settings=new te.Z({getTheme:function(){return i.view.effectiveTheme}}),i.events=new be.Z,i.activeTooltipInfo=null,i._vertexLaserLineVisualElement=null,i}return(0,r.Z)(n,[{key:"grabbingOrDragging",get:function(){return this._numGrabbing+this._numDragging>0}},{key:"_operations",get:function(){return this.object.operations}},{key:"initialize",value:function(){var e=this,t=this.view,n=this._settings.manipulators,i=n.vertex;this.tooltipInfos=Bt(this._sketchOptions,t),this._vertexManipulatorMaterial=(0,Rt.EA)((0,d.O)(i.color),i.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,Rt.qJ)((0,d.O)(i.outlineColor),i.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,Rt.qJ)((0,d.O)(i.hoverOutlineColor),i.renderOccluded);var a=n.edge;this._edgeManipulatorMaterial=(0,Rt.EA)((0,d.O)(a.color),a.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,Rt.qJ)((0,d.O)(a.outlineColor),a.renderOccluded);var o=n.edgeOffset;this._edgeOffsetManipulatorMaterial=(0,Rt.EA)((0,d.O)(o.color),o.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,Rt.EA)((0,d.O)(o.hoverColor),o.renderOccluded,!1);var r=n.selected;this._selectedManipulatorMaterial=(0,Rt.EA)((0,d.O)(r.color),r.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,Rt.qJ)((0,d.O)(r.outlineColor),r.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,Rt.qJ)((0,d.O)(r.hoverOutlineColor),r.renderOccluded),this.tooltip=new _t.u({view:t}),this.addHandles([(0,f.watch)((function(){var t=e._settings.manipulators;return{vertexSettings:t.vertex,edgeSettings:t.edge,edgeOffsetSettings:t.edgeOffset,selectedSettings:t.selected}}),(function(t){var n=t.vertexSettings,i=t.edgeSettings,a=t.edgeOffsetSettings,o=t.selectedSettings;n.applyColor(e._vertexManipulatorMaterial),n.applyOutline(e._vertexManipulatorOutlineMaterial),n.applyHoverOutline(e._vertexManipulatorHoverOutlineMaterial),i.applyColor(e._edgeManipulatorMaterial),i.applyOutline(e._edgeManipulatorOutlineMaterial),a.applyColor(e._edgeOffsetManipulatorMaterial),a.applyHover(e._edgeOffsetManipulatorHoverMaterial),o.applyColor(e._selectedManipulatorMaterial),o.applyOutline(e._selectedManipulatorOutlineMaterial),o.applyHoverOutline(e._selectedManipulatorHoverOutlineMaterial)})),(0,f.watch)((function(){return e.object.visible}),(function(t){var n,i=(0,ge.Z)(e._manipulatorInfos);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.manipulator.available=t,"edge"===a.type&&"edgeManipulator"in a&&(a.edgeManipulator.available=t)}}catch(o){i.e(o)}finally{i.f()}})),(0,f.watch)((function(){return e._numGrabbing+e._numDragging===0}),(function(t){return e._toggleAutoHideManipulators(t)})),(0,f.watch)((function(){return{labels:e._segmentLabels,enabled:e._sketchOptions.labels.enabled,edgeOffsetEnabled:e.enableEdgeOffset}}),(function(e){var t=e.labels,n=e.enabled,i=e.edgeOffsetEnabled;null!=t&&(t.visible=n,t.edgeDistance=i?"far":"default")}),f.initial),Xt(this.tooltip,this.object,(function(){return e._tooltipsContext})),(0,f.on)((function(){return e._operations}),"vertex-update",(function(t){e._updateManipulatorPositions(t.vertices)}),{onListenerAdd:function(){return e._recreateManipulators()}}),(0,f.on)((function(){var t;return null===(t=e._operations)||void 0===t?void 0:t.data}),"change",(function(t){"undo"!==t.operation&&"redo"!==t.operation||e._recreateManipulators()}))])}},{key:"destroy",value:function(){this._segmentLabels=(0,v.SC)(this._segmentLabels),this.tooltip=(0,v.SC)(this.tooltip),this._removeManipulators(),this._updatingHandles.destroy()}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"object",get:function(){return this.tool.object}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},{key:"enableDeleteVertices",get:function(){return this.tool.enableDeleteVertices}},{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"autoHideManipulators",get:function(){return this.tool.autoHideManipulators}},{key:"enableMoveObject",get:function(){return this.tool.enableMoveObject}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},{key:"_sketchOptions",get:function(){return this.tool.sketchOptions}},{key:"_accentColor",get:function(){return this.view.effectiveTheme.accentColor}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.type}));return this._removeVertices(e),e.length}},{key:"onManipulatorSelectionChanged",value:function(){this.events.emit("manipulators-changed")}},{key:"_removeManipulators",value:function(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,v.SC)(this._moveManipulation),this._objectMoveManipulation=(0,v.SC)(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}},{key:"_createManipulators",value:function(e){if(null!=this._operations){var t,n=this.object.elevationInfo,i=(0,ge.Z)(this._operations.data.components);try{for(i.s();!(t=i.n()).done;){var a,o=t.value,r=null===e||void 0===e?void 0:e.byComponentIndex.get(o.index),l=(0,ge.Z)(o.vertices);try{for(l.s();!(a=l.n()).done;){var s=a.value,u=null===r||void 0===r?void 0:r.has(s.index);this._createVertexOrEdgeManipulator(s,n,u)}}catch(h){l.e(h)}finally{l.f()}var c,p=(0,ge.Z)(o.edges);try{for(p.s();!(c=p.n()).done;){var d=c.value;this._createVertexOrEdgeManipulator(d,n)}}catch(h){p.e(h)}finally{p.f()}}}catch(h){i.e(h)}finally{i.f()}this._createObjectMoveManipulation(),this._createMoveManipulation(n),this._createVisualElements()}}},{key:"canRedo",get:function(){return null!=this._operations&&this._operations.canRedo}},{key:"canUndo",get:function(){return null!=this._operations&&this._operations.canUndo}},{key:"redo",value:function(){var e;return null===(e=this._operations)||void 0===e?void 0:e.redo()}},{key:"undo",value:function(){var e;return this.events.emit("undo"),null===(e=this._operations)||void 0===e?void 0:e.undo()}},{key:"_recreateManipulators",value:function(){if(!this._recreatingManipulators){var e,t;if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&(null===(e=this._segmentLabels)||void 0===e||null===(t=e.context)||void 0===t?void 0:t.editGeometryOperations)===this._operations||(this._segmentLabels=(0,v.SC)(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){var n=this._sketchOptions.labels;this._segmentLabels=new $({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:n},visible:n.enabled})}this._recreatingManipulators=!1}}},{key:"_perObjectManipulatorDragAction",value:function(e,t){if("end"===t.action)return t;var n,i=0,a=[],o=this._manipulatorInfos.some((function(e){return"vertex"===e.type&&e.manipulator.selected})),r=e===rn.SELECTED_OR_ALL&&o,l=(0,ge.Z)(this._manipulatorInfos);try{for(l.s();!(n=l.n()).done;){var s=n.value;"vertex"===s.type&&(s.manipulator.grabbing||r&&!s.manipulator.selected||a.push(s),i++)}}catch(u){l.e(u)}finally{l.f()}if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(on.MOVING),this.destroyed)return t;this.events.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(on.RESHAPING),this.destroyed)return t;this.events.emit("reshape",{type:"reshape",object:this.object})}return t}},{key:"_toggleAutoHideManipulators",value:function(e){var t=this;this.autoHideManipulators&&(e?this.removeHandles(Kt):this.tool.manipulators.forEach((function(e){var n,i=e.manipulator,a=null===(n=i.disableDisplay)||void 0===n?void 0:n.call(i);a&&t.addHandles(a,Kt)})))}},{key:"_isMultiVertexSelection",value:function(){return this._manipulatorInfos.reduce((function(e,t){return"vertex"===t.type&&t.manipulator.selected?e+1:e}),0)>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(on.RESHAPING),!this.destroyed){var t=e.mapDeltaX,n=e.mapDeltaY,i=e.mapDeltaZ;if(t||n||i){var a,o=[],r=(0,ge.Z)(this._manipulatorInfos);try{for(r.s();!(a=r.n()).done;){var l=a.value;"vertex"===l.type&&(l.manipulator.selected&&!l.manipulator.grabbing||l===e.info)&&o.push(l)}}catch(s){r.e(s)}finally{r.f()}this._moveVertices(o,e,Ze.b.ACCUMULATE_STEPS),this.events.emit("reshape",{type:"reshape",object:this.object})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case on.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case on.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object});break;case on.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object})}break;case on.MOVING:switch(this._reshapeEventState){case on.NONE:this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object});break;case on.RESHAPING:this.events.emit("reshape",{type:"reshape-stop",object:this.object}),this.destroyed||this.events.emit("move",{type:"move-start",dx:0,dy:0,object:this.object})}break;case on.RESHAPING:switch(this._reshapeEventState){case on.NONE:this.events.emit("reshape",{type:"reshape-start",object:this.object});break;case on.MOVING:this.events.emit("move",{type:"move-stop",dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit("reshape",{type:"reshape-start",object:this.object})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createObjectMoveManipulation",value:function(){var e=this,t=this.tool,n=this.view,i=this.object,o=this._operations;if(o){if(this._objectMoveManipulation=new ut({tool:t,view:n,object:i}),this.enableMoveObject){var r=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((function(t,n,i){n.next((function(t){return e._trackNumDragging(t)})).next((function(e){return"start"===e.action&&(r=o.createUndoGroup()),e})).next((function(t){return e._perObjectManipulatorDragAction(rn.ALL,t)})).next((function(t){return e._updateTranslateObjectTooltip(at.p.XY,t),t})).next((function(t){"end"===t.action&&(e._resetTooltip(),r=(0,v.hw)(r))})),i.next((function(){return e._onDragCancel(!0,(function(){return r=(0,v.hw)(r)}))}))}))),this._objectMoveManipulation.forEachManipulator((function(t){return e._manipulatorHandles.add(e._watchAndUpdateGrabState(t,!1))}))}else this._objectMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null}));this._objectMoveManipulation.forEachManipulator((function(t){return e._manipulatorHandles.add(t.events.on("immediate-click",(function(t){e._manipulatorInfos.some((function(e){return e.manipulator.selected}))?e._clearSelection():e.events.emit("immediate-click",(0,a.Z)((0,a.Z)({},t),{},{object:e.object})),t.stopPropagation()})))}))}}},{key:"_createMoveManipulation",value:function(e){var t,n=this,o=this.object,r=this.tool,l=this.view,s=this._operations;if(s){this._moveManipulation=new at.b({tool:r,view:l,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&(0,Te.I)(o.operations,o.elevationInfo),snapToScene:!1,radius:at.b.radiusForSymbol(null===(t=o.graphic)||void 0===t?void 0:t.symbol)}),this._moveManipulation.forEachManipulator((function(e){return n.addHandles([e.events.on("immediate-click",(function(t){n._moveManipulation.zManipulation.hasManipulator(e)||n._manipulatorInfos.some((function(e){return e.manipulator.selected}))||n.events.emit("immediate-click",(0,a.Z)((0,a.Z)({},t),{},{object:n.object})),t.stopPropagation()})),n._watchAndUpdateGrabState(e,!1)])}));var u=function(e){return function(t){n.addHandles(t.events.on("focus-changed",(function(t){"focus"===t.action?n._updateTranslateTooltip(e):n._resetTooltip()})))}};this._moveManipulation.xyManipulation.forEachManipulator(u(at.p.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(u(at.p.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(u(at.p.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var c=s.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline((function(t,l,u,c,p){var d,h,v=(0,ft.W)({predicate:function(e){return!!e.info},snappingManager:r.snappingManager,snappingContext:new vt.N({editGeometryOperations:s,elevationInfo:e,pointer:p,excludeFeature:o.graphic,visualizer:new q._}),updatingHandles:n._updatingHandles,useZ:!1}),f=v.snappingStep,_=v.cancelSnapping;return c=c.next((function(e){return n._onDragCancel(),e})).next(_),{steps:u=(d=u.next((function(e){return n._trackNumDragging(e)})).next((function(e){var t=n._manipulatorInfos.filter((function(e){return"vertex"===e.type&&e.manipulator.selected}));return e.manipulatorType===He.d.TRANSLATE_XY&&1===t.length?(0,a.Z)((0,a.Z)({},e),{},{info:t[0],snapOrigin:t[0].handle.pos}):e})).next((0,st.BS)(n.view,e,null!==(h=o.graphic)&&void 0!==h?h:void 0))).next.apply(d,(0,i.Z)(f)).next((0,st.AN)()).next((function(e){return n._perObjectManipulatorDragAction(rn.SELECTED_OR_ALL,e)})).next((function(e){return n._updateTranslateTooltip(t,e),e})),cancel:c}}),e,c,o.graphic),(0,f.watch)((function(){return o.visible}),(function(){return n._updateMoveManipulationPosition()}),f.initial),o.on("committed",(function(){n._recreatingManipulators||n._updateMoveManipulationPosition()})),(0,f.watch)((function(){return o.isDraped}),(function(e){n._updateMoveManipulationPosition();var t="align-move-manipulation";e?n.addHandles(n.view.elevationProvider.on("elevation-change",(function(){return n._updateMoveManipulationPosition()})),t):n.removeHandles(t)}),f.initial)])}}},{key:"_createVisualElements",value:function(){var e=this,t=this.object,n=nt({view:this.view,object:t,forEachManipulator:function(t){if(!e.destroyed&&!e._recreatingManipulators){e._objectMoveManipulation.forEachManipulator(t),e._moveManipulation.forEachManipulator(t);var n,i=(0,ge.Z)(e._manipulatorInfos);try{for(i.s();!(n=i.n()).done;){t(n.value.manipulator,He.d.TRANSLATE_XY)}}catch(a){i.e(a)}finally{i.f()}}},onManipulatorsChanged:function(t){return e.events.on("manipulators-changed",t)}});null!=n&&(this._outlineVisualElement=n.visualElement instanceof ie.k?n.visualElement:null);var i=this._outlineVisualElement;if(null!=i){var a=function(){t.isDraped||e._updateMoveManipulationPosition()};this._manipulatorHandles.add((0,f.on)((function(){return i.events}),"attachment-origin-changed",a,{onListenerAdd:a}))}this._manipulatorHandles.add(n)}},{key:"_createEdgeOffsetManipulator",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.object.elevationInfo,o=this._operations;if(e.component.vertices.length<=2||!o)return null;var r=this._settings.manipulators.edgeOffset,l=r.size/2,s=l+r.collisionPadding,u=l/s,c=u*Math.sqrt(3)/2;null==this._edgeOffsetManipulatorGeometryInside&&(this._edgeOffsetManipulatorGeometryInside=(0,Qt.DA)(this._edgeOffsetManipulatorMaterial,c,u/2,u/2,r.height,r.offset)),null==this._edgeOffsetManipulatorGeometryOutside&&(this._edgeOffsetManipulatorGeometryOutside=(0,Qt.DA)(this._edgeOffsetManipulatorMaterial,-c,u/2,u/2,r.height,-r.offset));var p=[new Dt.r(this._edgeOffsetManipulatorGeometryInside.instantiate(),Jt.Q9.Unfocused),new Dt.r(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Jt.Q9.Focused),new Dt.r(this._edgeOffsetManipulatorGeometryOutside.instantiate(),Jt.Q9.Unfocused),new Dt.r(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Jt.Q9.Focused)],d=new Le.Z({view:this.view,renderObjects:p,elevationInfo:"on-the-ground"!==i.mode||(0,At.YW)(null===(t=this.object.graphic)||void 0===t?void 0:t.symbol)?{mode:"absolute-height",offset:0}:i,worldOriented:!1,focusMultiplier:1,radius:s,available:this.object.visible,collisionType:{type:"disc",direction:(0,m.al)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),v=new Le.Z({view:this.view,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?"move":"default",metadata:{deleting:!1}}),f={manipulator:d,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:v,elevationInfo:i,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(f,r.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(f);for(var _=[],g=0,y=[e.leftVertex,e.rightVertex];g<y.length;g++){var b=y[g],M=this._getManipulatorInfoFromHandle(b);null!=M&&_.push(M.manipulator.events.on("location-update",(function(){return n._updateEdgeOffsetManipulator(f)})))}f.locationUpdateHandle=(0,h.AL)(_),this._manipulatorHandles.add(f.locationUpdateHandle,d),this._manipulatorHandles.add([this._watchAndUpdateGrabState(d,!0),this._watchAndUpdateGrabState(v,!0)],d),this._manipulatorHandles.add((0,st.Xd)(d,this._createEdgeOffsetPipeline(f,i)),d),this._manipulatorHandles.add((0,st.Xd)(v,(function(e,t,a,r){if("touch"===r)n._createEdgeOffsetPipeline(f,i)(e,t,a);else if(n.enableMoveObject){var l=n.object.graphic,s=o.data.spatialReference;t.next((function(e){return n._trackNumDragging(e)})).next((0,st.kY)(n.view,e.elevationAlignedLocation)).next((0,rt.G)(n.view,e.elevationAlignedLocation,i,s,l)).next((0,st.zh)()).next((0,st.AN)()).next((function(e){return n._perObjectManipulatorDragAction(rn.ALL,e)})).next((function(e){return n._updateTranslateObjectTooltip(at.p.XY,e),e})).next((function(e){"end"===e.action&&n._resetTooltip()})),a.next((function(){return n._onDragCancel(!e.metadata.deleting)}))}})),d);var S=function(e){n._manipulatorInfos.some((function(e){return e.manipulator.selected}))?n._clearSelection():n.events.emit("immediate-click",(0,a.Z)((0,a.Z)({},e),{},{object:n.object})),e.stopPropagation()};return this._manipulatorHandles.add([d.events.on("immediate-click",S),v.events.on("immediate-click",S),d.events.on("focus-changed",(function(e){"focus"===e.action?n._updateEdgeOffsetTooltip(null):n._resetTooltip()}))],d),this._manipulatorInfos.push(f),this.manipulators.add(d),this.manipulators.add(v),this.events.emit("manipulators-changed"),f}},{key:"_autoHideEdgeOffsetManipulator",value:function(e,t){var n=this,i=e.manipulator,a=e.edgeManipulator,o=function(){e.visibilityHandle=(0,v.hw)(e.visibilityHandle);var o=n._getManipulatorInfoFromHandle(e.handle.leftVertex),r=n._getManipulatorInfoFromHandle(e.handle.rightVertex),l=null!=o&&null!=r&&function(e,t,n){var i=n.projectToRenderScreen(e,(0,S.J$)()),a=n.projectToRenderScreen(t,(0,S.J$)());return null!=i&&null!=a?(0,y.q)((0,y.f)(i,i,a)):0}(o.manipulator.renderLocation,r.manipulator.renderLocation,n.view.state.camera)<t;(!i.focused&&!a.focused||l)&&(i.grabbable=!l,a.grabbable=!l,e.visibilityHandle=(0,h.AL)([i.disableDisplay(),(0,h.kB)((function(){i.grabbable=!0,a.grabbable=n.enableMoveObject}))]))};this._manipulatorHandles.add([i.events.on("focus-changed",o),a.events.on("focus-changed",o),(0,h.kB)((function(){(0,v.hw)(e.visibilityHandle),a.metadata.deleting=!0,n.manipulators.remove(a)}))],i),o()}},{key:"_updateEdgeOffsetManipulator",value:function(e){if(this._operations){this._updateManipulatorPosition(e);var t=this._operations.data.coordinateHelper,n=Ht(this.view,e.manipulator.elevationAlignedLocation,Lt(t,e.handle,e.manipulator.elevationInfo)),i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null!=i&&null!=a){var o=i.manipulator.renderLocation,r=a.manipulator.renderLocation,l=null!=n?function(e,t,n){var i=(0,Pt.st)(e),a=(0,y.E)((0,m.Ue)(),t,n),o=(0,y.b)((0,m.Ue)(),a,i),r=(0,y.b)((0,m.Ue)(),a,o);return(0,It.al)(a[0],a[1],a[2],0,o[0],o[1],o[2],0,r[0],r[1],r[2],0,0,0,0,1)}(n,o,r):It.Wd;e.manipulator.modelTransform=l,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=l;var s=(0,y.l)((0,y.f)(un,o,r))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-s,0,0],[s,0,0]]]}}}}},{key:"_createEdgeOffsetPipeline",value:function(e,t){var n=this;return function(i,o,r){var l=n._operations;if(l){n._clearSelection();var s=n._initializeEdgeOffset(e,t,l),u=s.step,c=s.cleanup;o.next((function(e){return n._trackNumDragging(e)})).next((0,st.kY)(n.view,i.elevationAlignedLocation)).next(u).next((0,rt.bB)(n.view)).next((0,rt.zP)(n.view,l.data.spatialReference)).next((0,st.AN)()).next((function(e){var t=e.operation,n=e.mapEnd;return null==t||null==n?e:("start"===e.action&&t.selectArrowFromStartPoint(n),(0,a.Z)((0,a.Z)({},e),{},{signedDistance:t.signedDistanceToPoint(n)}))})).next(n._applyEdgeOffsetStep(e)).next(n._showEdgeOffsetTooltip()).next((function(e){"end"===e.action&&c()})),r.next((function(){i.metadata.deleting||(c(),n._onDragCancel())}))}}}},{key:"_initializeEdgeOffset",value:function(e,t,n){var i=this,o=this.view,r=Lt(n.data.coordinateHelper,e.handle,t),l=n.createUndoGroup(),s=Ht(o,e.manipulator.elevationAlignedLocation,r);if(r.requiresSplitEdgeLeft){var u=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);null!=u&&this._splitEdgeManipulator(u,1)}if(r.requiresSplitEdgeRight){var c=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);null!=c&&this._splitEdgeManipulator(c,0)}var p,_=function(){return new jt.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:n.data.spatialReference})},g=this._settings,y=new ie.k({view:o,isDraped:this.object.isDraped,geometry:_(),elevationInfo:e.elevationInfo,width:g.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),m=function(){i._cleanEdgeOffsetCollapsedEdges(e),p=(0,v.hw)(p)},b=this.events.on("undo",m);return p=(0,h.AL)([(0,f.watch)((function(){return(0,d.O)(i._accentColor)}),(function(e){return y.color=e}),f.initial),(0,h.ed)(y),(0,f.watch)((function(){return i.object.isDraped}),(function(e){return y.isDraped=e})),this.object.on("committed",(function(){return y.geometry=_()})),l,b]),y.attached=!0,{step:function(e){return null==r||null==s?(m(),null):(0,a.Z)((0,a.Z)({},e),{},{operation:r,plane:s})},cleanup:m}}},{key:"_applyEdgeOffsetStep",value:function(e){var t=this;return function(n){if(t.destroyed||null==n.operation)return n;t._updateEventState(on.RESHAPING);var i=n.mapDeltaX,a=n.mapDeltaY,o=n.mapDeltaZ;return(i||a||o)&&(t._offsetEdge(e,n),t.events.emit("reshape",{type:"reshape",object:t.object})),n}}},{key:"_showEdgeOffsetTooltip",value:function(){var e=this;return function(t){return null!=t.signedDistance&&e.object.operations?e._updateEdgeOffsetTooltip(t):e._resetTooltip(),t}}},{key:"_cleanEdgeOffsetCollapsedEdges",value:function(e){var t,n;if(this._operations){var i=null===(t=e.handle.leftVertex.leftEdge)||void 0===t?void 0:t.leftVertex,a=e.handle.leftVertex,o=null===(n=e.handle.rightVertex.rightEdge)||void 0===n?void 0:n.rightVertex,r=e.handle.rightVertex,l=this._operations.data.coordinateHelper,s=[];if(i&&l.distance(i.pos,a.pos)<cn){var u=this._getManipulatorInfoFromHandle(a);null!=u&&s.push(u)}if(l.distance(a.pos,r.pos)<cn||o&&l.distance(o.pos,r.pos)<cn){var c=this._getManipulatorInfoFromHandle(r);null!=c&&s.push(c)}s.length&&this._removeVertices(s)}}},{key:"_createVertexOrEdgeManipulator",value:function(e){var t,n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.object.elevationInfo,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=this.view,s=this._operations;if(!s)return null;var u=this._settings;if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,o);if(!this.enableMidpoints)return null}if(null==this._vertexManipulatorGeometry||null==this._vertexManipulatorOutlineGeometry){var c=tn(u.manipulators.vertex),p=c.size,d=c.outlineSize;this._vertexManipulatorGeometry=(0,Qt.PI)(this._vertexManipulatorMaterial,p,16,16),this._vertexManipulatorOutlineGeometry=(0,Qt.PI)(this._vertexManipulatorOutlineMaterial,d,16,16)}if(null==this._edgeManipulatorGeometry||null==this._edgeManipulatorOutlineGeometry){var f=tn(u.manipulators.edge),_=f.size,g=f.outlineSize;this._edgeManipulatorGeometry=(0,Qt.PI)(this._edgeManipulatorMaterial,_,16,16),this._edgeManipulatorOutlineGeometry=(0,Qt.PI)(this._edgeManipulatorOutlineMaterial,g,16,16)}var y=null===(t=this._operations)||void 0===t?void 0:t.data.type,m="point"===y||"mesh"===y?[]:[new Dt.r(this._vertexManipulatorGeometry.instantiate(),an.Vertex|Jt.Q9.Unselected),new Dt.r(this._vertexManipulatorOutlineGeometry.instantiate(),an.Vertex|Jt.Q9.Unfocused|Jt.Q9.Unselected),new Dt.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),an.Vertex|Jt.Q9.Focused|Jt.Q9.Unselected),new Dt.r(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),Jt.Q9.Selected),new Dt.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),Jt.Q9.Selected|Jt.Q9.Unfocused),new Dt.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),Jt.Q9.Selected|Jt.Q9.Focused)];this.enableMidpoints&&m.push(new Dt.r(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),an.Edge|Jt.Q9.Focused|Jt.Q9.Unselected),new Dt.r(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),an.Edge|Jt.Q9.Focused|Jt.Q9.Unselected),new Dt.r(this._edgeManipulatorGeometry.instantiate(),an.Edge|Jt.Q9.Unfocused|Jt.Q9.Unselected),new Dt.r(this._edgeManipulatorOutlineGeometry.instantiate(),an.Edge|Jt.Q9.Unfocused|Jt.Q9.Unselected));var b=new Le.Z({view:l,renderObjects:m,elevationInfo:o,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1}});b.selected=r,this._setTypeSpecificManipulatorSettings(b,e,o);var M="edge"===e.type?{manipulator:b,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:b,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(M),this.manipulators.add(b),this._updateManipulatorPosition(M),"edge"===M.type){for(var S=[],k=0,w=[M.handle.leftVertex,M.handle.rightVertex];k<w.length;k++){var x=w[k],O=this._getManipulatorInfoFromHandle(x);null!=O&&S.push(O.manipulator.events.on("location-update",(function(){return n._updateManipulatorPosition(M)})))}M.locationUpdateHandle=(0,h.AL)(S),this._manipulatorHandles.add(M.locationUpdateHandle,b)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(b,!0),b);var C=(0,st.Xd)(b,(function(e,t,r,l){var u,c,p=null,d=(0,ft.W)({predicate:function(){return!n._isMultiVertexSelection()},snappingManager:n.tool.snappingManager,snappingContext:new vt.N({editGeometryOperations:s,elevationInfo:o,pointer:l,excludeFeature:n.object.graphic,visualizer:new q._}),updatingHandles:n._updatingHandles,useZ:!1}),h=d.snappingStep,f=d.cancelSnapping;r=r.next((function(t){return n._onDragCancel(!e.metadata.deleting,(function(){return p=(0,v.hw)(p)})),t})).next(f),(u=t.next((function(e){return n._trackNumDragging(e)})).next((function(e){if("start"===e.action&&n._operations&&(p=n._operations.createUndoGroup()),"edge"===M.type){var t=n._splitEdgeManipulator(M);return(0,a.Z)((0,a.Z)({},e),{},{info:t,snapOrigin:t.handle.pos})}return(0,a.Z)((0,a.Z)({},e),{},{info:M,snapOrigin:M.handle.pos})})).next((0,st.kY)(n.view,e.elevationAlignedLocation)).next((0,rt.G)(n.view,e.elevationAlignedLocation,n.object.elevationInfo,e.location.spatialReference,n.object.graphic)).next((0,st.BS)(n.view,o,null!==(c=n.object.graphic)&&void 0!==c?c:void 0))).next.apply(u,(0,i.Z)(h)).next((0,st.AN)()).next((function(e){n._perVertexManipulatorDragAction(e),"end"===e.action&&(p=(0,v.hw)(p)),n._resetTooltip()}))}));return this._manipulatorHandles.add([C,b.events.on("immediate-click",(function(e){return n._manipulatorClickCallback(e,M)})),b.events.on("select-changed",(function(){M.selectedIndex=++n._selectedIndex,n._updateMoveManipulationPosition(),n._resetTooltip()})),b.events.on("focus-changed",(function(){n._resetTooltip()}))],b),this.events.emit("manipulators-changed"),M}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_onDragCancel",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(this._numDragging--,e&&this.undo(),null!=this.tool.snappingManager&&this.tool.snappingManager.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case on.NONE:break;case on.MOVING:this.events.emit("move",{type:"move",dx:0,dy:0,object:this.object});break;case on.RESHAPING:this.events.emit("reshape",{type:"reshape",object:this.object})}t&&t(),this.destroyed||this._updateEventState(on.NONE)}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,n){var i=this._settings;switch(t.type){case"vertex":var a;e.state=an.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2;var o=i.manipulators.vertex,r=o.size,l=o.collisionPadding;e.radius=r/2+l,e.elevationInfo=n;var s=null===(a=this._operations)||void 0===a?void 0:a.data.type;e.interactive=null!=s&&"point"!==s&&"mesh"!==s;break;case"edge":var u;e.state=an.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1;var c=i.manipulators.edge,p=c.size,d=c.collisionPadding;e.radius=p/2+d,e.elevationInfo="on-the-ground"!==n.mode||(0,At.YW)(null===(u=this.object.graphic)||void 0===u?void 0:u.symbol)?{mode:"absolute-height",offset:0}:n}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var n=this;return e.events.on("grab-changed",(function(i){return n._onGrabStateChanged(e,t,i.action,i.pointerType)}))}},{key:"_onGrabStateChanged",value:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if(!this._recreatingManipulators){if("start"===n)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(on.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((function(e){var t,n=e.manipulator,a=null===(t=i._operations)||void 0===t?void 0:t.data.type;n.interactive=n.grabbing||!i._numGrabbing&&null!=a&&"point"!==a&&"mesh"!==a,"edgeManipulator"in e&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!i._numGrabbing)})),this._objectMoveManipulation.forEachManipulator((function(e){e.interactive=e.grabbing||!i._numGrabbing})))}}},{key:"_clearSelection",value:function(){var e,t=(0,ge.Z)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.manipulator.grabbing||(n.manipulator.selected=!1)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.events.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){null!=e&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),(0,ye.e$)(this._manipulatorInfos,e),this.events.emit("manipulators-changed"),this._resetTooltip())}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,n=(0,ge.Z)(this._manipulatorInfos);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(e===i.handle)return i}}catch(a){n.e(a)}finally{n.f()}}return null}},{key:"_updateManipulatorPositions",value:function(e){var t,n=(0,ge.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i))}}catch(a){n.e(a)}finally{n.f()}}},{key:"_updateManipulatorPosition",value:function(e){var t=this._operations;if(null!=e&&t)if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,sn),e.manipulator.grabbing&&null!=this._vertexLaserLineVisualElement&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){var n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),i=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(null==n||null==i)return;var a=n.manipulator,o=i.manipulator;if(null!=e.manipulator.elevationInfo&&"on-the-ground"===e.manipulator.elevationInfo.mode){var r=a.location,l=o.location,s=r.x+.5*(l.x-r.x),u=r.y+.5*(l.y-r.y),c=r.hasZ&&l.hasZ?0:void 0;e.manipulator.location=(0,ke.T)(s,u,c,t.data.spatialReference)}else(0,y.o)(un,a.renderLocation,o.renderLocation,.5),e.manipulator.renderLocation=un}}},{key:"_splitEdgeManipulator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=this._operations,i=n.splitEdge(e.handle,t).createdVertex;e.locationUpdateHandle=(0,v.hw)(e.locationUpdateHandle);var a,o=this.object.elevationInfo;this.enableEdgeOffset?(this._removeManipulator(e),a=this._createVertexOrEdgeManipulator(i)):((a=e).handle=i,a.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,o)),i.leftEdge&&this._createVertexOrEdgeManipulator(i.leftEdge),i.rightEdge&&this._createVertexOrEdgeManipulator(i.rightEdge),this._updateManipulatorPosition(a),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(e.manipulator);var r=this._updateEventState(on.RESHAPING),l=n.data.coordinateHelper.vectorToArray(a.handle.pos),s=n.data.components.indexOf(i.component);return this.events.emit("vertex-add",{type:"vertex-add",object:this.object,vertices:[{coordinates:l,componentIndex:s,vertexIndex:i.index}],added:l}),r&&this._updateEventState(on.NONE),a}},{key:"_updateMoveManipulationPosition",value:function(){var e,t,n=(0,y.s)(un,0,0,0),i=0,a=!1,o=null,r=null,l=(0,ge.Z)(this._manipulatorInfos);try{for(l.s();!(t=l.n()).done;){var s=t.value;"vertex"===s.type&&(s.manipulator.selected?(i++,(0,y.g)(n,n,s.manipulator.renderLocation),null==o||s.selectedIndex>o.selectedIndex?(r=o,o=s):(null==r||s.selectedIndex>r.selectedIndex)&&(r=s)):a=!0)}}catch(M){l.e(M)}finally{l.f()}var u=this.object,c=null===(e=this._operations)||void 0===e?void 0:e.data.geometry;if(0===i){var p,d=u.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=d,this._moveManipulation.xyAxisManipulation.available=d,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=d,this._moveManipulation.zManipulation.available=d&&this.enableZShape&&(0,Te.I)(this._operations,u.elevationInfo),this._moveManipulation.angle=Oe(c),this._moveManipulation.radius=at.b.radiusForSymbol(null===(p=u.graphic)||void 0===p?void 0:p.symbol)}else{var h=u.visible;this._moveManipulation.xyManipulation.available=h,this._moveManipulation.xyAxisManipulation.available=h,this._moveManipulation.zManipulation.available=h&&this.enableZVertex&&(0,Te.I)(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=h&&1!==i;var v=0;if(null!=o){var f,_,g=o.handle.pos,m=null!=r?r.handle.pos:null!==(f=o.handle.leftEdge)&&void 0!==f&&f.leftVertex?o.handle.leftEdge.leftVertex.pos:null,b=null==r&&null!==(_=o.handle.rightEdge)&&void 0!==_&&_.rightVertex?o.handle.rightEdge.rightVertex.pos:null;m&&b?this._moveManipulation.xyAxisManipulation.available=!1:m?v=nn(m,g):b&&(v=nn(g,b))}this._moveManipulation.angle=v,this._moveManipulation.radius=it.E5}0!==i&&a?((0,y.j)(n,n,1/i),sn.spatialReference=this._operations.data.spatialReference,sn.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(n,sn),this._moveManipulation.elevationAlignedLocation=sn):null==this._outlineVisualElement||this.object.isDraped||null==this._outlineVisualElement.attachmentOrigin?(0,Rt.gm)(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}},{key:"_removeVertices",value:function(e){var t=new Array,n=this._operations;if(n){var i,a=(0,ge.Z)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value,r=o.handle.component;if("vertex"===o.type&&n.canRemoveVertex(r)){var l;t.push(o.handle),this._removeManipulator(o),this._removeManipulator(this._getManipulatorInfoFromHandle(o.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(o.handle.rightEdge));var s=null===(l=n.removeVertices([o.handle]).removedVertices)||void 0===l?void 0:l[0].createdEdge;s?this._createVertexOrEdgeManipulator(s):this.enableEdgeOffset&&r.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(r.edges[0]))}}}catch(p){a.e(p)}finally{a.f()}if(t.length>0){var u=t.map((function(e){var t=n.data.components.indexOf(e.component);return{coordinates:n.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}})),c=this._updateEventState(on.RESHAPING);if(this.destroyed)return;if(this.events.emit("vertex-remove",{type:"vertex-remove",object:this.object,removed:u.map((function(e){return e.coordinates})),vertices:u}),this.destroyed)return;if(c&&(this._updateEventState(on.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}}},{key:"_moveVertices",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?Ze.b.NEW_STEP:Ze.b.ACCUMULATE_STEPS,i=this._operations;if(i){e.length>0&&i.moveVertices(e.map((function(e){return e.handle})),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);var a,o=(0,ge.Z)(e);try{for(o.s();!(a=o.n()).done;){var r=a.value;this._updateManipulatorPosition(r)}}catch(l){o.e(l)}finally{o.f()}}}},{key:"_offsetEdge",value:function(e,t){if(null!=t.operation&&null!=t.signedDistance){var n=this._operations;if(n){var i=t.operation.clone();i.distance=t.signedDistance,n.updateVertices([e.handle.leftVertex,e.handle.rightVertex],i),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&e.button===$t.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===$t.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}},{key:"_updateTranslateTooltip",value:function(e,t){null!=this._defaultTooltipInfo?this._resetTooltip():this._updateTranslateObjectTooltip(e,t)}},{key:"_updateTranslateObjectTooltip",value:function(e,t){this.activeTooltipInfo=function(e,t,n){var i=n.sketchOptions,a=n.tooltipInfos,o=null;switch(e){case at.p.XY:Yt(o=a.translate,t,(function(e,t){return(0,H.Qw)(e,t)}));break;case at.p.XY_AXIS:Yt(o=a.translateXY,t,(function(e,n){return(0,Me.bA)((0,H.Qw)(e,n),(0,ot.h)(t))}));break;case at.p.Z:Yt(o=a.translateZ,t,Ie._e)}return o.sketchOptions=i,o}(e,t,this._tooltipsContext)}},{key:"_updateEdgeOffsetTooltip",value:function(e){this.activeTooltipInfo=Wt(this.object,e,this._tooltipsContext)}},{key:"_resetTooltip",value:function(){this.activeTooltipInfo=this._defaultTooltipInfo}},{key:"_defaultTooltipInfo",get:function(){var e;switch(null===(e=this._operations)||void 0===e?void 0:e.data.type){case"polyline":case"polygon":return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case"point":case"mesh":return this.tooltipInfos.movePoint;default:return null}}},{key:"_selectedVertexManipulatorInfo",get:function(){var e=this._manipulatorInfos.filter((function(e){return"vertex"===e.type&&e.manipulator.selected}));return 1===e.length?e[0]:null}},{key:"_tooltipsContext",get:function(){var e=this,t=this.events;return{sketchOptions:this._sketchOptions,tooltipInfos:this.tooltipInfos,activeTooltipInfo:this.activeTooltipInfo,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:{onReshapeStart:function(){return t.emit("reshape",{type:"reshape-start",object:e.object})},onReshape:function(){return t.emit("reshape",{type:"reshape",object:e.object})},onReshapeStop:function(){return t.emit("reshape",{type:"reshape-stop",object:e.object})},onMoveStart:function(){return t.emit("move",{type:"move-start",object:e.object,dx:0,dy:0})},onMove:function(){return t.emit("move",{type:"move",object:e.object,dx:0,dy:0})},onMoveStop:function(){return t.emit("move",{type:"move-stop",object:e.object,dx:0,dy:0})}}}}},{key:"test",get:function(){}}]),n}(O.default);function tn(e){var t=e.size/2,n=t+e.collisionPadding;return{size:t/n,outlineSize:(t+e.outlineSize)/n}}function nn(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,p._)([(0,_.Cb)()],en.prototype,"_numGrabbing",void 0),(0,p._)([(0,_.Cb)()],en.prototype,"_numDragging",void 0),(0,p._)([(0,_.Cb)()],en.prototype,"grabbingOrDragging",null),(0,p._)([(0,_.Cb)()],en.prototype,"_operations",null),(0,p._)([(0,_.Cb)()],en.prototype,"_segmentLabels",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],en.prototype,"tool",void 0),(0,p._)([(0,_.Cb)()],en.prototype,"tooltip",void 0),(0,p._)([(0,_.Cb)()],en.prototype,"activeTooltipInfo",void 0),(0,p._)([(0,_.Cb)({readOnly:!0})],en.prototype,"updating",null),(0,p._)([(0,_.Cb)()],en.prototype,"manipulators",null),(0,p._)([(0,_.Cb)()],en.prototype,"view",null),(0,p._)([(0,_.Cb)()],en.prototype,"object",null),(0,p._)([(0,_.Cb)()],en.prototype,"enableZShape",null),(0,p._)([(0,_.Cb)()],en.prototype,"enableDeleteVertices",null),(0,p._)([(0,_.Cb)()],en.prototype,"enableZVertex",null),(0,p._)([(0,_.Cb)()],en.prototype,"autoHideManipulators",null),(0,p._)([(0,_.Cb)()],en.prototype,"enableMoveObject",null),(0,p._)([(0,_.Cb)()],en.prototype,"enableMidpoints",null),(0,p._)([(0,_.Cb)()],en.prototype,"enableEdgeOffset",null),(0,p._)([(0,_.Cb)()],en.prototype,"_sketchOptions",null),(0,p._)([(0,_.Cb)()],en.prototype,"_accentColor",null),(0,p._)([(0,_.Cb)()],en.prototype,"_tooltipsContext",null),en=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.reshape.ReshapeOperation")],en);var an,on,rn,ln,sn=(0,ke.T)(0,0,void 0,qt.Z.WGS84),un=(0,m.Ue)(),cn=1e-6;(ln=an||(an={})).Vertex=Jt.jg.Custom1,ln.Edge=Jt.jg.Custom2,function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(on||(on={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(rn||(rn={}));var pn=n(87888),dn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).events=new be.Z,i.enableZShape=!0,i.enableZVertex=!0,i.enableMoveObject=!0,i.enableDeleteVertices=!0,i.autoHideManipulators=!1,i.enableMidpoints=!0,i.enableEdgeOffset=!1,i.type="reshape-3d",i.sketchOptions=new ht.Z,i.snappingManager=null,i.automaticManipulatorSelection=!1,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this,t=this._reshapeOperation=new en({tool:this});this.addHandles([t.events.on("reshape",(function(t){return e.events.emit("reshape",t)})),t.events.on("move",(function(t){return e.events.emit("move",t)})),t.events.on("vertex-add",(function(t){return e.events.emit("vertex-add",t)})),t.events.on("vertex-remove",(function(t){return e.events.emit("vertex-remove",t)})),t.events.on("immediate-click",(function(t){return e.events.emit("immediate-click",(0,a.Z)((0,a.Z)({},t),{},{object:e.object}))})),this.view.on("pointer-down",["Shift"],(function(e){return e.stopPropagation()}))]),this.finishToolCreation()}},{key:"destroy",value:function(){this._reshapeOperation=(0,v.SC)(this._reshapeOperation)}},{key:"updating",get:function(){var e,t,n;return null!==(e=null!==(t=this.object.updating)&&void 0!==t&&t||(null===(n=this._reshapeOperation)||void 0===n?void 0:n.updating))&&void 0!==e&&e}},{key:"activeTooltipInfo",get:function(){var e,t;return null!==(e=null===(t=this._reshapeOperation)||void 0===t?void 0:t.activeTooltipInfo)&&void 0!==e?e:null}},{key:"tooltip",get:function(){var e,t;return null!==(e=null===(t=this._reshapeOperation)||void 0===t?void 0:t.tooltip)&&void 0!==e?e:null}},{key:"onManipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}},{key:"canUndo",get:function(){var e;return null!==(e=this._reshapeOperation.canUndo)&&void 0!==e&&e}},{key:"undo",value:function(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._reshapeOperation.undo()}},{key:"canRedo",get:function(){var e;return null!==(e=this._reshapeOperation.canRedo)&&void 0!==e&&e}},{key:"redo",value:function(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._reshapeOperation.redo()}},{key:"onInputEvent",value:function(e){var t=this._reshapeOperation;t&&!t.grabbingOrDragging&&(0,de._i)(e,t.tooltip)||!this.enableDeleteVertices||"key-down"!==e.type||!pn.Sn.delete.includes(e.key)||this._reshapeOperation.removeSelectedVertices()>0&&e.stopPropagation()}},{key:"reset",value:function(){}},{key:"test",get:function(){}}]),n}(pt.m);(0,p._)([(0,_.Cb)()],dn.prototype,"_reshapeOperation",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"view",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],dn.prototype,"object",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"enableZShape",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"enableZVertex",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"enableMoveObject",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"enableDeleteVertices",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"autoHideManipulators",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"enableMidpoints",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"enableEdgeOffset",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"type",void 0),(0,p._)([(0,_.Cb)({type:ht.Z})],dn.prototype,"sketchOptions",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"snappingManager",void 0),(0,p._)([(0,_.Cb)()],dn.prototype,"updating",null),(0,p._)([(0,_.Cb)()],dn.prototype,"activeTooltipInfo",null),(0,p._)([(0,_.Cb)()],dn.prototype,"tooltip",null),(0,p._)([(0,_.Cb)()],dn.prototype,"automaticManipulatorSelection",void 0),dn=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D")],dn);var hn=n(848),vn=n(50951),fn=n(45238),_n=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._interactionState=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,f.when)((function(){var t=e._interactionState;return t&&t.angle!==t.previousAngle?{interactionState:t,angle:t.state.angle}:null}),(function(t){var n=t.interactionState;e._updateMeshRotation(n)}),f.sync),(0,f.when)((function(){var t=e._interactionState;return t&&t.scale!==t.previousScale?{interactionState:t,scale:t.state.scale}:null}),(function(t){var n=t.interactionState;e._updateMeshSize(n)}),f.sync)])}},{key:"initialAngle",get:function(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.initialAngle)&&void 0!==e?e:0}},{key:"angle",get:function(){var e,t,n=this.geometry.transform;if(null==n)return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.angle)&&void 0!==e?e:0;var i=(0,fn.ZZ)(n.rotation)[2];return Math.abs(i)>.999999?(0,E.Vl)((0,fn.EU)(n.rotation))*Math.sign(i):0}},{key:"angleClockwise",get:function(){return-this.angle}},{key:"relativeAngle",get:function(){return this.angle-this.initialAngle}},{key:"relativeAngleClockwise",get:function(){return-this.relativeAngle}},{key:"scale",get:function(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.scale)&&void 0!==e?e:1}},{key:"startInteraction",value:function(){var e=this,t=new gn({angle:this.angle});this._interactionState=t;var n=function(){e._interactionState=null};return{state:t,done:n,cancel:function(){t.cancel(),n()}}}},{key:"createUndoRecord",value:function(){return this.object.createUndoRecord()}},{key:"_updateMeshRotation",value:function(e){var t=e.angle,n=e.previousAngle;e.previousAngle=t;var i=(0,E.BV)(t-n);this.geometry.rotate(0,0,i,{origin:this.geometry.anchor})}},{key:"_updateMeshSize",value:function(e){var t=e.scale,n=e.previousScale;e.previousScale=t;var i=t/n,a=this.geometry.anchor;this.geometry.scale(i,{origin:a})}}]),n}(O.default);(0,p._)([(0,_.Cb)({constructOnly:!0})],_n.prototype,"object",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],_n.prototype,"geometry",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],_n.prototype,"viewingMode",void 0),(0,p._)([(0,_.Cb)()],_n.prototype,"initialAngle",null),(0,p._)([(0,_.Cb)()],_n.prototype,"angle",null),(0,p._)([(0,_.Cb)()],_n.prototype,"angleClockwise",null),(0,p._)([(0,_.Cb)()],_n.prototype,"relativeAngle",null),(0,p._)([(0,_.Cb)()],_n.prototype,"relativeAngleClockwise",null),(0,p._)([(0,_.Cb)()],_n.prototype,"scale",null),(0,p._)([(0,_.Cb)()],_n.prototype,"_interactionState",void 0),_n=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],_n);var gn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).angle=0,i.initialAngle=0,i.previousAngle=0,i.previousScale=1,i.scale=1,i.initialAngle=e.angle,i.previousAngle=e.angle,i}return(0,r.Z)(n,[{key:"state",get:function(){return{angle:this.angle,scale:this.scale}}},{key:"cancel",value:function(){this.angle=this.initialAngle,this.scale=1}}]),n}(O.default);(0,p._)([(0,_.Cb)()],gn.prototype,"angle",void 0),(0,p._)([(0,_.Cb)()],gn.prototype,"initialAngle",void 0),(0,p._)([(0,_.Cb)()],gn.prototype,"previousAngle",void 0),(0,p._)([(0,_.Cb)()],gn.prototype,"previousScale",void 0),(0,p._)([(0,_.Cb)()],gn.prototype,"scale",void 0),(0,p._)([(0,_.Cb)()],gn.prototype,"state",null),gn=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],gn);var yn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).sizeAxis=null,i._interactionState=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,f.when)((function(){return null!=e._interactionState?e._interactionState.state:null}),(function(t){e._updateSymbol(t)}),f.sync))}},{key:"initialAngle",get:function(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.initialAngle)&&void 0!==e?e:0}},{key:"angle",get:function(){var e,t;return null!=this._interactionState?this._interactionState.angle:null!=this._orientationReferenceSymbolLayer?(t=null!==(e=this._orientationReferenceSymbolLayer.heading)&&void 0!==e?e:0,-(0,E.Vl)(t)):0}},{key:"angleClockwise",get:function(){return-this.angle}},{key:"orientation",get:function(){return this.angle}},{key:"orientationClockwise",get:function(){return this.angleClockwise}},{key:"relativeAngle",get:function(){return this.angle-this.initialAngle}},{key:"relativeAngleClockwise",get:function(){return-this.relativeAngle}},{key:"scale",get:function(){var e,t;return null!==(e=null===(t=this._interactionState)||void 0===t?void 0:t.scale)&&void 0!==e?e:1}},{key:"size",get:function(){var e=this._sizeReferenceSymbolLayer;if(null==e)return null;var t=this.findLayerView(),n=this._graphicSymbol;if(null==t||null==n||"point-3d"!==n.type)return null;var i=t.getSymbolLayerSize(n,e);if("size"in i&&null!=i.size)return i.size;var a=this.sizeAxis;return!("width"in i)||null==i.width||null!=a&&"width"!==a&&"all"!==a&&"width-and-depth"!==a?!("depth"in i)||null==e.depth||null!=a&&"depth"!==a&&"all"!==a&&"width-and-depth"!==a?!("height"in i)||null==e.height||null!=a&&"height"!==a&&"all"!==a?null:i.height:i.depth:i.width}},{key:"_sizeReferenceSymbolLayer",get:function(){var e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((function(e){return"object"===e.type}))}},{key:"_orientationReferenceSymbolLayer",get:function(){var e=this._graphicSymbol;return null==e||0===e.symbolLayers.length?null:e.symbolLayers.find((function(e){return"object"===e.type&&null!=e.heading}))}},{key:"_graphicSymbol",get:function(){var e;return null!=(null===(e=this.graphic)||void 0===e?void 0:e.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null},set:function(e){this.graphic.symbol=e}},{key:"startInteraction",value:function(){var e=this,t=this._graphicSymbol,n=this.findLayerView();if(null!=this._interactionState||null==t||null==n)return mn;var i=t.symbolLayers.map((function(e){return"object"===e.type?n.getSymbolLayerSize(t,e):null})).toArray(),a=t.clone(),o=this.angle,r=new bn({originalSymbol:a,angle:o,initialSizes:i});this._interactionState=r;var l=function(){e._interactionState=null};return{state:r,done:l,cancel:function(){e._graphicSymbol=a,l()}}}},{key:"createUndoRecord",value:function(){var e=this.graphic.symbol,t=null;return{undo:function(n){t=n.symbol,n.symbol=e},redo:function(n){e=n.symbol,n.symbol=t}}}},{key:"_updateSymbol",value:function(e){var t=this,n=e.scale,i=e.angle,a=e.originalSymbol,o=e.initialSizes,r=this._graphicSymbol;if(null!=r&&"point-3d"===r.type){var l=r.clone(),s=-(0,E.BV)(i-this.initialAngle),u=!1;this._forEachObjectSymbolLayerPair(a,l,(function(e,i,a){var r,l=(null!==(r=e.heading)&&void 0!==r?r:0)+s;i.heading!==l&&(i.heading=l,u=!0);var c=o[a];if(null!=c&&"width"in c){c.width=t.sizeFilter(c.width),c.height=t.sizeFilter(c.height),c.depth=t.sizeFilter(c.depth);var p=c.width*n;i.width!==p&&(i.width=p,u=!0);var d=c.depth*n;i.depth!==d&&(i.depth=d,u=!0);var h=c.height*n;i.height!==h&&(i.height=h,u=!0)}})),u&&(this._graphicSymbol=l)}}},{key:"_forEachObjectSymbolLayerPair",value:function(e,t,n){e.symbolLayers.forEach((function(e,i){var a=t.symbolLayers.at(i);"object"===e.type&&"object"===a.type&&n(e,a,i)}))}}]),n}(O.default);(0,p._)([(0,_.Cb)()],yn.prototype,"initialAngle",null),(0,p._)([(0,_.Cb)()],yn.prototype,"angle",null),(0,p._)([(0,_.Cb)()],yn.prototype,"angleClockwise",null),(0,p._)([(0,_.Cb)()],yn.prototype,"orientation",null),(0,p._)([(0,_.Cb)()],yn.prototype,"orientationClockwise",null),(0,p._)([(0,_.Cb)()],yn.prototype,"relativeAngle",null),(0,p._)([(0,_.Cb)()],yn.prototype,"relativeAngleClockwise",null),(0,p._)([(0,_.Cb)()],yn.prototype,"scale",null),(0,p._)([(0,_.Cb)()],yn.prototype,"size",null),(0,p._)([(0,_.Cb)()],yn.prototype,"sizeAxis",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],yn.prototype,"graphic",void 0),(0,p._)([(0,_.Cb)()],yn.prototype,"_interactionState",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],yn.prototype,"findLayerView",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],yn.prototype,"sizeFilter",void 0),(0,p._)([(0,_.Cb)()],yn.prototype,"_sizeReferenceSymbolLayer",null),(0,p._)([(0,_.Cb)()],yn.prototype,"_orientationReferenceSymbolLayer",null),(0,p._)([(0,_.Cb)()],yn.prototype,"_graphicSymbol",null),yn=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter")],yn);var mn={state:{angle:0,scale:0},done:function(){},cancel:function(){}},bn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).angle=0,i.initialAngle=0,i.scale=1,i.initialAngle=e.angle,i}return(0,r.Z)(n,[{key:"state",get:function(){return{originalSymbol:this.originalSymbol,angle:this.angle,initialAngle:this.initialAngle,scale:this.scale,initialSizes:this.initialSizes}}}]),n}(O.default);(0,p._)([(0,_.Cb)()],bn.prototype,"originalSymbol",void 0),(0,p._)([(0,_.Cb)()],bn.prototype,"angle",void 0),(0,p._)([(0,_.Cb)()],bn.prototype,"initialAngle",void 0),(0,p._)([(0,_.Cb)()],bn.prototype,"initialSizes",void 0),(0,p._)([(0,_.Cb)()],bn.prototype,"scale",void 0),(0,p._)([(0,_.Cb)()],bn.prototype,"state",null),bn=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState")],bn);var Mn=n(29439),Sn=n(17768),kn=n(99346),wn=n(29134),xn=n(40885),On=n(68401),Cn=n(66832),En=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="transform-absolute",i.orientation=null,i.orientationPrecision=null,i.rotationType="geographic",i.size=null,i.sizePrecision=null,i.sizeUnit=null,i}return(0,r.Z)(n)}(mt.h);(0,p._)([(0,_.Cb)()],En.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],En.prototype,"orientation",void 0),(0,p._)([(0,_.Cb)()],En.prototype,"orientationPrecision",void 0),(0,p._)([(0,_.Cb)()],En.prototype,"rotationType",void 0),(0,p._)([(0,_.Cb)()],En.prototype,"size",void 0),(0,p._)([(0,_.Cb)()],En.prototype,"sizePrecision",void 0),(0,p._)([(0,_.Cb)()],En.prototype,"sizeUnit",void 0),En=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.TransformAbsoluteTooltipInfo")],En);var Tn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="transform-rotate",i.rotation=null,i.rotationPrecision=null,i.orientation=null,i.orientationPrecision=null,i.rotationType="geographic",i}return(0,r.Z)(n)}(mt.h);(0,p._)([(0,_.Cb)()],Tn.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],Tn.prototype,"rotation",void 0),(0,p._)([(0,_.Cb)()],Tn.prototype,"rotationPrecision",void 0),(0,p._)([(0,_.Cb)()],Tn.prototype,"orientation",void 0),(0,p._)([(0,_.Cb)()],Tn.prototype,"orientationPrecision",void 0),(0,p._)([(0,_.Cb)()],Tn.prototype,"rotationType",void 0),Tn=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.TransformRotateTooltipInfo")],Tn);var Zn,In,jn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="transform-scale",i.size=null,i.sizeUnit=null,i.sizePrecision=null,i}return(0,r.Z)(n)}(mt.h);(0,p._)([(0,_.Cb)()],jn.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],jn.prototype,"scale",void 0),(0,p._)([(0,_.Cb)()],jn.prototype,"size",void 0),(0,p._)([(0,_.Cb)()],jn.prototype,"sizeUnit",void 0),(0,p._)([(0,_.Cb)()],jn.prototype,"sizePrecision",void 0),jn=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.TransformScaleTooltipInfo")],jn),(In=Zn||(Zn={})).ScaleIn=Jt.jg.Custom2,In.ScaleOut=Jt.jg.Custom3,In.RotateLeft=Jt.jg.Custom4,In.RotateRight=Jt.jg.Custom5,In.Unlocked=Jt.jg.Custom7,In.DelayedFocused=Jt.jg.Custom8,In.TouchInput=Jt.jg.Custom12;var An,Rn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).mode=null,i.tooltipEnabled=!0,i._scaleRotateDragData=null,i._activeAnimation=null,i._ringIndicatorDelayMs=it.oB,i._absoluteTooltipInfo=null,i._scaleTooltipInfo=null,i._rotateTooltipInfo=null,i.events=new be.Z,i.getFocused=function(){return i._ringManipulator.focused},i.getScale=function(){var e;return"scale"===(null===(e=i._scaleRotateDragData)||void 0===e?void 0:e.mode)?i.adapter.scale:1},i}return(0,r.Z)(n,[{key:"angle",get:function(){return this.adapter.angle}},{key:"scale",get:function(){return this.adapter.scale}},{key:"location",set:function(e){this._ringManipulator.location=e}},{key:"elevationAlignedLocation",set:function(e){this._ringManipulator.elevationAlignedLocation=e}},{key:"grabbing",get:function(){return this._ringManipulator.grabbing}},{key:"interactive",set:function(e){this._ringManipulator.interactive=e}},{key:"updating",get:function(){return!!this._activeAnimation}},{key:"tooltipEffectiveEnabled",get:function(){return this.sketchOptions.tooltips.effectiveEnabled&&this.tooltipEnabled}},{key:"initialize",value:function(){var e=this;this.tooltip=new _t.u({view:this.tool.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([(0,f.when)((function(){return!e.tooltipEffectiveEnabled}),(function(){return e.tooltip.clear()}),f.initial),(0,f.watch)((function(){var t=e.adapter,n=e.tooltip.info;return n===e._absoluteTooltipInfo&&e.getFocused()?[n,t.size,t.orientationClockwise]:[null]}),(function(t){(0,Mn.Z)(t,1)[0]&&e._updateFocusTooltip()})),(0,f.watch)((function(){var t=e.adapter;return[t.angle,t.scale]}),(function(){return e._updateManipulatorTransform()}))])}},{key:"destroy",value:function(){var e;null!==(e=this._activeAnimation)&&void 0!==e&&e.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this.tooltip=(0,v.SC)(this.tooltip)}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var n=(0,kn.A)({update:function(n){var i=n.deltaTime;e.update(i)&&t.cancelActiveAnimation()}});this._activeAnimation=(0,a.Z)((0,a.Z)({},e),{},{frameTask:n})}},{key:"cancelActiveAnimation",value:function(){var e;null!==(e=this._activeAnimation)&&void 0!==e&&e.frameTask.remove(),this._activeAnimation=(0,v.SC)(this._activeAnimation)}},{key:"forEachManipulator",value:function(e){e(this._ringManipulator,He.d.SCALE_ROTATE)}},{key:"_createManipulator",value:function(){var e=this,t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);var n=this.tool.object,i=(0,st.Xd)(t,(function(t,i,a){e._scaleRotateDragData=null;var o=e.adapter.startInteraction(),r={mode:"none",origin:(0,m.d9)(t.renderLocation),initialAngle:e.adapter.angle,angle:0,angleDir:0,scaleDir:0};e._scaleRotateDragData=r,e._updateDragState();var l=D.WM.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,l),i.next((0,rt._N)(e.tool.view,(0,Pt.Yq)(t.renderLocation,l,(0,Pt.Ue)()))).next((function(t){var i=(0,Pt.st)(t.plane),a=(0,Rt.Gd)(t.renderStart,t.renderEnd,r.origin,i),l=Sn.Q4.shortestSignedDiff(r.angle,a);r.angleDir=(0,E.uZ)(r.angleDir+l,-it.j6,it.j6),r.angle=a;var s=function(e,t){var n=(0,y.f)(D.WM.get(),t.renderStart,e.origin),i=(0,y.f)(D.WM.get(),t.renderEnd,e.origin),a=(0,y.l)(n),o=(0,y.l)(i);return 0===a?0:o/a}(r,t),u=s-e.adapter.scale;if(r.scaleDir=(0,E.uZ)(r.scaleDir+u,-it.Ls,it.Ls),e._onScaleChanged(),"none"===r.mode){var c=e.mode||function(e,t,n,i){var a=e.renderStart,o=e.renderEnd,r=Dn(a,i,D.WM.get()),l=Dn(o,i,D.WM.get());if((0,y.a)(r,l)<it.f2*it.f2)return null;var s=(0,y.f)(D.WM.get(),a,n),u=(0,y.b)(D.WM.get(),s,(0,Pt.st)(t)),c=a,p=(0,y.g)(D.WM.get(),c,u),d=Dn(n,i,D.WM.get()),h=r,v=Dn(p,i,D.WM.get()),f=(0,y.f)(D.WM.get(),v,h),_=(0,y.f)(D.WM.get(),r,d),g=(0,xn.re)(h,f),m=(0,xn.re)(d,_);return(0,xn.Jk)(g,l)<(0,xn.Jk)(m,l)?"rotate":"scale"}(t,t.plane,r.origin,e.tool.view.state.camera);if(null!=c){switch(c){case"rotate":e.tool.events.emit("rotate-start",{object:n,angle:0}),e.tool.events.emit("record-undo",{updates:[e.adapter.createUndoRecord()]});break;case"scale":e.tool.events.emit("scale-start",{object:n,xScale:1,yScale:1}),e.tool.events.emit("record-undo",{updates:[e.adapter.createUndoRecord()]})}r.mode=c}}switch(r.mode){case"rotate":o.state.angle=r.initialAngle+a;break;case"scale":o.state.scale=s,e._onScaleChanged()}switch(e._updateDragState(),e._updateManipulatorTransform(),t.action){case"start":case"update":switch(r.mode){case"rotate":e.tool.events.emit("rotate",{object:n,angle:(0,E.BV)(r.angle)});break;case"scale":e.tool.events.emit("scale",{object:n,xScale:s,yScale:s})}break;case"end":switch(r.mode){case"rotate":e.tool.events.emit("rotate-stop",{object:n,angle:(0,E.BV)(r.angle)});break;case"scale":e.tool.events.emit("scale-stop",{object:n,xScale:s,yScale:s})}}return"end"===t.action&&(e.startAnimation(Pn(e,(function(){return e._onScaleChanged()}))),e._scaleRotateDragData=null,e._updateDragState(),o.done()),t})).next(e._updateTooltipPipelineStep(r)),a.next((function(){if(o.cancel(),null!=e._scaleRotateDragData){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.events.emit("rotate-stop",{object:n,angle:0});break;case"scale":e.tool.events.emit("scale-stop",{object:n,xScale:1,yScale:1})}e.startAnimation(Pn(e,(function(){return e._onScaleChanged()}))),e._scaleRotateDragData=null,e._updateDragState()}e._updateFocusTooltip()}))}));this.addHandles([i,t.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t,n){var i=0,a=null,o=function(){return!1};return{start:function(){a=e.getFocused,e.getFocused=o,i=0,t()},update:function(e){var t;return i+=e,null===(t=a)||void 0===t||!t()||i>=n.delayMs?An.STOP:An.CONTINUE},destroy:function(){a&&(e.getFocused=a),t()}}}(e,(function(){return e._updateDelayedFocusedState()}),{delayMs:e._ringIndicatorDelayMs})):e._updateDelayedFocusedState()})),t.events.on("immediate-click",(function(e){e.stopPropagation()})),(0,f.watch)((function(){return e.tool.object.visible}),(function(t){return e._ringManipulator.available=t}),f.initial)])}},{key:"_updateTooltipPipelineStep",value:function(e){var t=this;return function(n){var i=t.sketchOptions,a=i.tooltips.visualVariables;if(!t.tooltipEffectiveEnabled)return n;if("end"===n.action)return t._updateFocusTooltip(),n;var o=t.tooltip;switch(e.mode){case"scale":var r;o.info=null!==(r=t._scaleTooltipInfo)&&void 0!==r?r:t._scaleTooltipInfo=new jn({sketchOptions:i});var l=t.adapter,s=l.size,u=l.scale,c=null===a||void 0===a?void 0:a.size,p=o.info;p.sketchOptions=i,p.scale=(0,Me.M1)(u),p.size=null!=s?(0,Me.yG)(s,"meters"):void 0,p.sizePrecision=zn(null===c||void 0===c?void 0:c.valueType),p.sizeUnit=null===c||void 0===c?void 0:c.unit;break;case"rotate":var d,h;o.info=null!==(d=t._rotateTooltipInfo)&&void 0!==d?d:t._rotateTooltipInfo=new Tn({sketchOptions:i});var v=t.adapter,f=v.orientationClockwise,_=v.relativeAngleClockwise,g=null===a||void 0===a?void 0:a.rotation,y=zn(null===g||void 0===g?void 0:g.valueType),m=o.info;m.sketchOptions=i,m.rotation=null!=_?(0,Me.GJ)(_,"radians","geographic"):void 0,m.rotationPrecision=y,m.rotationType=null!==(h=null===g||void 0===g?void 0:g.rotationType)&&void 0!==h?h:"geographic",m.orientation=null!=f?(0,Me.GJ)(f,"radians","geographic"):void 0,m.orientationPrecision=y}return n}}},{key:"_updateFocusTooltip",value:function(){var e=this.sketchOptions,t=this.tooltip,n=e.tooltips.visualVariables;if(this.tooltipEffectiveEnabled)if(this.getFocused()){var i,a,o=null===n||void 0===n?void 0:n.rotation,r=null===n||void 0===n?void 0:n.size,l=this.mode,s=this.adapter,u=s.size,c=s.orientationClockwise,p=null!=c&&(null==l||"rotate"===l),d=null!=u&&(null==l||"scale"===l);t.info=null!==(i=this._absoluteTooltipInfo)&&void 0!==i?i:this._absoluteTooltipInfo=new En({sketchOptions:e});var h=t.info;h.sketchOptions=e,h.orientation=p?(0,Me.GJ)(c,"radians","geographic"):void 0,h.orientationPrecision=zn(null===o||void 0===o?void 0:o.valueType),h.rotationType=null!==(a=null===o||void 0===o?void 0:o.rotationType)&&void 0!==a?a:"geographic",h.size=d?(0,Me.yG)(u,"meters"):void 0,h.sizeUnit=null===r||void 0===r?void 0:r.unit,h.sizePrecision=zn(null===r||void 0===r?void 0:r.valueType)}else t.clear()}},{key:"_onScaleChanged",value:function(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}},{key:"_updateDelayedFocusedState",value:function(){this._ringManipulator.updateStateEnabled(Zn.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}},{key:"_updateDragState",value:function(){var e;if(this._ringManipulator.updateStateEnabled(Zn.Unlocked,!(null!=this._scaleRotateDragData&&"none"!==(null===(e=this._scaleRotateDragData)||void 0===e?void 0:e.mode))),null!=this._scaleRotateDragData)switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Zn.ScaleIn|Zn.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Zn.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Zn.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Zn.RotateLeft|Zn.RotateRight,!1),this._ringManipulator.updateStateEnabled(Zn.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Zn.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Zn.ScaleIn|Zn.ScaleOut|Zn.RotateLeft|Zn.RotateRight,!1)}},{key:"_updateManipulatorTransform",value:function(){var e=(0,wn.Us)(D.MP.get(),this.adapter.angle,(0,m.al)(0,0,1));if(null!=e){var t=this.getScale(),n=(0,wn.xJ)(D.MP.get(),(0,y.s)(D.WM.get(),t,t,t));this._ringManipulator.modelTransform=(0,wn.Jp)(D.MP.get(),n,e)}}},{key:"_createRingManipulator",value:function(){for(var e=function(e,t,n){for(var i=[],a=Math.ceil(it.NH*(t-e)/(2*Math.PI)),o=0;o<a+1;o++){var r=e+o*(t-e)/a;i.push((0,m.al)(n*Math.cos(r),n*Math.sin(r),0))}return i},t=function(t){return e(0,2*Math.PI,t)},n=function(e){return[[-e/2,0],[e/2,0],[e/2,it._v/2],[-e/2,it._v/2]]},a=this._createMaterial(1),o=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;return(0,Qt.x2)(i,n(t),e,[],[],!1)},r=t(it.CA),l=o(r,it.Az),s={left:new Array,right:new Array},u=[],c=0;c<2;c++){var p=c*Math.PI-Math.PI/4,d=Math.PI/2-it.xf,h=p+d,v=p+Math.PI/2-d,f=e(h,v,it.UC),_=o(f,it.Xt);u.push(f),u.push(e(h,v,it.qi-it.Az/2)),s.left.push(_),s.right.push(_.instantiate());for(var g=0;g<2;g++){var y=0===g,b=(0,It.Ue)();if(y){(0,wn.bA)(b,b,[1,-1,1]),(0,wn.U1)(b,b,-h,[0,0,1]);var M=Math.round(it.YK*(f.length-1));b[12]=f[M][0],b[13]=f[M][1],b[14]=f[M][2]}else{(0,wn.U1)(b,b,v,[0,0,1]);var S=Math.round((1-it.YK)*(f.length-1));b[12]=f[S][0],b[13]=f[S][1],b[14]=f[S][2]}var k=(0,Qt.DA)(a,it.uA,0,it.Fv,it._v);(0,Qt.mx)(k,b),(y?s.left:s.right).push(k)}}for(var w=[],x=0;x<2;x++){var O=x*Math.PI-Math.PI/4,C=Math.PI/2-it.Sn,E=O+C,T=O+Math.PI/2-C,Z=e(E,T,it.qi);w.push(o(Z,it.Xt))}var I=this._createMaterial(.66),j=this._createMaterial(.5),A=this._createMaterial(.33),R=t(it.CA+it._P),D=t(it.CA+it.An),P=o(R,it.Xt,I),z=o(D,it.Xt,A),L=t(it.CA-it._P),H=t(it.CA-it.An),V=o(L,it.Xt,I),G=o(H,it.Xt,A),U=[new Dt.r(l,Zn.DelayedFocused),new Dt.r(l.instantiate({material:j}),Jt.Q9.None)];this.mode&&"scale"!==this.mode||(U=U.concat([].concat((0,i.Z)(w.map((function(e){return new Dt.r(e,Zn.DelayedFocused|Zn.Unlocked)}))),[new Dt.r(P,Zn.DelayedFocused|Zn.ScaleIn),new Dt.r(z,Zn.DelayedFocused|Zn.ScaleIn),new Dt.r(V,Zn.DelayedFocused|Zn.ScaleOut),new Dt.r(G,Zn.DelayedFocused|Zn.ScaleOut)]))),this.mode&&"rotate"!==this.mode||(U=U.concat([].concat((0,i.Z)(s.right.map((function(e){return new Dt.r(e.instantiate(),Zn.DelayedFocused|Zn.Unlocked)}))),(0,i.Z)(s.left.map((function(e){return new Dt.r(e,Zn.DelayedFocused|Zn.RotateLeft)}))),(0,i.Z)(s.right.map((function(e){return new Dt.r(e,Zn.DelayedFocused|Zn.RotateRight)}))))));var F=[r].concat(u);return new Le.Z({view:this.tool.view,renderObjects:U,autoScaleRenderObjects:!1,worldOriented:!0,radius:it.Az,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:"ribbon",paths:F,direction:(0,m.al)(0,0,1)}})}},{key:"_createMaterial",value:function(e){var t=this,n=new Cn.E({cullFace:On.Vr.Back,renderOccluded:se.yD.Transparent,isDecoration:!0});return this.addHandles((0,f.watch)((function(){return{color:(0,d.Ch)(t.tool.view.effectiveTheme.accentColor,e)}}),(function(e){return n.setParameters(e)}),f.initial)),n}},{key:"test",get:function(){}}]),n}(O.default);function Dn(e,t,n){return t.projectToScreen(e,Ln),(0,y.s)(n,Ln[0],Ln[1],0)}function Pn(e,t){var n=null,i=1,a=function(){return i};return{start:function(){i=e.getScale(),n=e.getScale,e.getScale=a,t()},update:function(e){return i+=((i+1)/2-i)*Math.min(e*it.$8,1),t(),Math.abs(i-1)<.01?An.STOP:An.CONTINUE},destroy:function(){n&&(e.getScale=n),t()}}}function zn(e){switch(e){case"integer":case"long":return 0;default:return null}}(0,p._)([(0,_.Cb)({constructOnly:!0})],Rn.prototype,"tool",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],Rn.prototype,"adapter",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],Rn.prototype,"sketchOptions",void 0),(0,p._)([(0,_.Cb)()],Rn.prototype,"mode",void 0),(0,p._)([(0,_.Cb)()],Rn.prototype,"tooltipEnabled",void 0),(0,p._)([(0,_.Cb)()],Rn.prototype,"_activeAnimation",void 0),(0,p._)([(0,_.Cb)()],Rn.prototype,"updating",null),(0,p._)([(0,_.Cb)()],Rn.prototype,"tooltipEffectiveEnabled",null),Rn=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform")],Rn),function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(An||(An={}));var Ln=(0,S.s1)(),Hn=n(73816),Vn=n(35647),Gn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="transform-mesh",i.orientation=(0,Hn.Zq)({actual:null,lockable:!1}),i.scale=(0,Hn.Se)({actual:null,lockable:!1}),i.allFields.forEach((function(e){e.lockable=!1,e.setActual(null)})),i}return(0,r.Z)(n,[{key:"key",get:function(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}},{key:"allFields",get:function(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}}]),n}((0,Vn.A)(mt.h));(0,p._)([(0,_.Cb)()],Gn.prototype,"key",null),(0,p._)([(0,_.Cb)()],Gn.prototype,"allFields",null),Gn=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo")],Gn);var Un=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="transform-point",i.allFields.forEach((function(e){e.lockable=!1,e.setActual(null)})),i}return(0,r.Z)(n,[{key:"allFields",get:function(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}}]),n}((0,Vn.A)(mt.h));(0,p._)([(0,_.Cb)()],Un.prototype,"allFields",null),Un=(0,p._)([(0,g.j)("esri.views.interactive.tooltip.infos.TransformPointTooltipInfo")],Un);var Fn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).events=new be.Z,i.enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i.sketchOptions=new ht.Z,i.type="transform-3d",i._updatingHandles=new Se.R,i._scaleRotate=null,i}return(0,r.Z)(n,[{key:"initialize",value:function(){var e,t=this,n=this.events,o=this.object,r=this.view;this.tooltip=new _t.u({view:r}),this._moveManipulation=new at.b({tool:this,view:r,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&(0,Te.I)(o.operations,o.elevationInfo),radius:at.b.radiusForSymbol(null===(e=o.graphic)||void 0===e?void 0:e.symbol)}),this._moveManipulation.forEachManipulator((function(e){return t.addHandles(e.events.on("immediate-click",(function(e){n.emit("immediate-click",(0,a.Z)((0,a.Z)({},e),{},{object:t.object})),e.stopPropagation()})))}));var l=o.elevationInfo;if(this._moveManipulation.elevationInfo=l,this.addHandles(ee(o)),this._moveManipulation.createManipulatedObjectDragPipeline((function(e,n,a,s,u){if(e===at.p.XY){var c,p,d=(0,ft.W)({snappingContext:new vt.N({elevationInfo:l,pointer:u,editGeometryOperations:dt.c.fromGeometry(new hn.Z({spatialReference:null===(c=o.operations)||void 0===c?void 0:c.data.spatialReference}),r.state.viewingMode),visualizer:new q._,excludeFeature:o.graphic}),snappingManager:t.snappingManager,updatingHandles:t._updatingHandles,useZ:!1}),h=d.snappingStep,v=d.cancelSnapping;s=s.next(v),a=(p=a.next((0,st.Mz)(t.view,l))).next.apply(p,(0,i.Z)(h))}return{steps:a,cancel:s}}),o,(function(e){var i=e.action,a={object:e.object,dxScreen:e.dxScreen,dyScreen:e.dyScreen};switch(i){case"start":t._emitRecordUndo(),n.emit("translate-start",a);break;case"update":n.emit("translate",a);break;case"end":n.emit("translate-stop",a)}})),this._moveManipulation.angle=null!=this._scaleRotate?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles((0,f.watch)((function(){return t._scaleRotateAdapter.angle}),(function(){return t._updateMoveAngle()}))),this.enableScaling||this.enableRotation){var s,u=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Rn({tool:this,mode:u,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions,tooltipEnabled:"mesh"!==(null===(s=(0,Ee.$)(o))||void 0===s?void 0:s.type)}),this.addHandles(this._scaleRotate.events.on("scale-changed",(function(){return t._onScaleChanged()})))}this.addHandles([nt({view:this.view,object:o,forEachManipulator:function(e){return t._forEachManipulator(e)},onManipulatorsChanged:function(){return(0,h.kB)()}}),o.on("committed",(function(){return t._onGeometryChanged()})),this._hideManipulatorsForObjectState(),(0,f.watch)((function(){return r.scale}),(function(){return t._updateMoveAngle()}))].filter(ye.pC)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((function(e){e instanceof Le.Z&&t.addHandles(e.events.on("grab-changed",(function(){return t._updateManipulatorsInteractive()})))}));var c=null===r||void 0===r?void 0:r.type,p=this.sketchOptions;this._meshTooltipInfo=new Gn({viewType:c,sketchOptions:p}),this._pointTooltipInfo=new Un({viewType:c,sketchOptions:p});var d={object:o,dxScreen:0,dyScreen:0},v={onMoveStart:function(){t._emitRecordUndo(),n.emit("translate-start",(0,a.Z)({},d))},onMove:function(){return n.emit("translate",(0,a.Z)({},d))},onMoveStop:function(){return n.emit("translate-stop",(0,a.Z)({},d))},onRotateStart:function(e){t._emitRecordUndo(),n.emit("rotate-start",{object:o,angle:e})},onRotate:function(e){return n.emit("rotate",{object:o,angle:e})},onRotateStop:function(e){return n.emit("rotate-stop",{object:o,angle:e})},onScaleStart:function(e,i){t._emitRecordUndo(),n.emit("scale-start",{object:o,xScale:e,yScale:i})},onScale:function(e,t){return n.emit("scale",{object:o,xScale:e,yScale:t})},onScaleStop:function(e,t){return n.emit("scale-stop",{object:o,xScale:e,yScale:t})}};this.addHandles(je(this.tooltip,this.object,(function(){return{sketchOptions:t.sketchOptions,activeTooltipInfo:t.activeTooltipInfo,callbacks:v}}))),this.finishToolCreation()}},{key:"destroy",value:function(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=(0,v.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,v.SC)(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set("view",null),this._set("object",null)}},{key:"onInputEvent",value:function(e){if(!this.destroyed&&!(0,de._i)(e,this.tooltip))return(0,l.Z)((0,s.Z)(n.prototype),"onInputEvent",this).call(this,e)}},{key:"_updateManipulatorsInteractive",value:function(){null!=this._scaleRotate&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}},{key:"_createScaleRotateAdapter",value:function(){var e,t,n,i,a,o=this,r=(0,Ee.$)(this.object);return"mesh"===(null===r||void 0===r?void 0:r.type)?new _n({object:this.object,geometry:r,viewingMode:this.view.state.viewingMode}):new yn({graphic:this.object.graphic,sizeFilter:function(e){return o._enforceNonZeroSize(e)},findLayerView:function(){return o.view.allLayerViews.find((function(e){var t;return e.layer===(null===(t=o.object.graphic)||void 0===t?void 0:t.layer)}))},sizeAxis:null!==(e=null===(t=this.sketchOptions)||void 0===t||null===(n=t.tooltips)||void 0===n||null===(i=n.visualVariables)||void 0===i||null===(a=i.size)||void 0===a?void 0:a.axis)&&void 0!==e?e:null})}},{key:"_forEachManipulator",value:function(e){var t,n;null!==(t=this._moveManipulation)&&void 0!==t&&t.forEachManipulator(e),null===(n=this._scaleRotate)||void 0===n||n.forEachManipulator(e)}},{key:"_hideManipulatorsForObjectState",value:function(){var e=this;return(0,f.watch)((function(){return e.object.visible}),(function(t){e._forEachManipulator((function(e){return e.available=t})),e._moveManipulation.zManipulation.available=t&&e.enableZ&&(0,Te.I)(e.object.operations,e.object.elevationInfo)}))}},{key:"_emitRecordUndo",value:function(){this.events.emit("record-undo",{updates:[this.object.createUndoRecord()]})}},{key:"snapToScene",set:function(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"updating",get:function(){var e;return this._updatingHandles.updating||!(null===(e=this._scaleRotate)||void 0===e||!e.updating)}},{key:"activeTooltipInfo",get:function(){var e,t,n;return null!=(null===(e=this._scaleRotate)||void 0===e||null===(t=e.tooltip)||void 0===t?void 0:t.info)?null:"mesh"===(null===(n=(0,Ee.$)(this.object))||void 0===n?void 0:n.type)?this._meshTooltipInfo:this._pointTooltipInfo}},{key:"location",set:function(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}},{key:"elevationAlignedLocation",set:function(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}},{key:"reset",value:function(){}},{key:"onHide",value:function(){var e;null===(e=this._scaleRotate)||void 0===e||e.cancelActiveAnimation()}},{key:"_onScaleChanged",value:function(){null!=this._scaleRotate&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}},{key:"_updateMoveAngle",value:function(){var e=this.view,t=e.state.viewingMode===vn.JY.Local||e.scale<it.Rn;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}},{key:"_onGeometryChanged",value:function(){(0,Rt.gm)(this,this.object)}},{key:"_enforceNonZeroSize",value:function(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}},{key:"test",get:function(){}}]),n}(pt.m);(0,p._)([(0,_.Cb)({constructOnly:!0,nonNullable:!0})],Fn.prototype,"view",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0,nonNullable:!0})],Fn.prototype,"object",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0,nonNullable:!0})],Fn.prototype,"enableZ",void 0),(0,p._)([(0,_.Cb)()],Fn.prototype,"enableRotation",void 0),(0,p._)([(0,_.Cb)()],Fn.prototype,"enableScaling",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0,type:ht.Z})],Fn.prototype,"sketchOptions",void 0),(0,p._)([(0,_.Cb)({value:!1})],Fn.prototype,"snapToScene",null),(0,p._)([(0,_.Cb)({constructOnly:!0})],Fn.prototype,"snappingManager",void 0),(0,p._)([(0,_.Cb)({readOnly:!0})],Fn.prototype,"type",void 0),(0,p._)([(0,_.Cb)({readOnly:!0})],Fn.prototype,"updating",null),(0,p._)([(0,_.Cb)()],Fn.prototype,"activeTooltipInfo",null),Fn=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.transform.TransformTool3D")],Fn);var Nn=n(38978),Bn=n(61074),Xn=function(){function e(t,n){var i=this;(0,o.Z)(this,e),this._tool=t,this._bounds=n,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;var a=this._tool,r=a.view;this.moveXYObjectManipulation=new ut({view:r,tool:a,object:this._object}),a.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new Bn.K(r,Bn.l.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Nn.Df,a.manipulators.add(this.moveZManipulator),a.addHandles([this._createMoveZDragPipeline()]),a.addHandles([a.events.on("translate-stop",(function(){i._moveXYTooltipInfo=null,i._moveZTooltipInfo=null}))])}return(0,r.Z)(e,[{key:"_object",get:function(){return this._tool.object}},{key:"_operations",get:function(){return this._object.operations}},{key:"destroy",value:function(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}},{key:"forEachManipulator",value:function(e){this.moveXYObjectManipulation.forEachManipulator(e),e(this.moveZManipulator,He.d.TRANSLATE_Z)}},{key:"updateManipulators",value:function(e,t){var n=this.moveZManipulator,i=(0,wn.jI)(D.MP.get(),e,Math.PI);i[12]=0,i[13]=0,i[14]=0,n.modelTransform=i,n.renderLocation=(0,y.f)(D.WM.get(),t.origin,t.basis1)}},{key:"getUpdatedTooltipInfo",value:function(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}},{key:"_computeMoveXYTooltipInfo",value:function(){var e,t=this._tool,n=null!==(e=this._moveXYTooltipInfo)&&void 0!==e?e:this._moveXYTooltipInfo=new yt.E({sketchOptions:t.sketchOptions});if(this.moveXYObjectManipulation.dragging){var i=this._bounds,a=i.mapBoundsStart.origin,o=i.mapBounds.origin,r=t.view.renderSpatialReference;if(!r)return null;var l=(0,H.x)(a,o,r);if(null==l)return null;n.distance=l}else n.distance=Me.yP;return n}},{key:"_computeMoveZTooltipInfo",value:function(){var e,t=this._tool,n=null!==(e=this._moveZTooltipInfo)&&void 0!==e?e:this._moveZTooltipInfo=new Mt({sketchOptions:t.sketchOptions});if(this.moveZManipulator.dragging){var i=this._bounds,a=i.mapBoundsStart.origin,o=i.mapBounds.origin,r=t.view.renderSpatialReference;if(!r)return null;var l=(0,Ie.Cr)(a,o,r);if(null==l)return null;n.distance=l}else n.distance=Me.yP;return n}},{key:"_createMoveXYObjectDragPipeline",value:function(){var e=this;return this.moveXYObjectManipulation.createDragPipeline((function(t,n,i){return e._applyObjectMoveSteps(n,i)}))}},{key:"_createMoveZDragPipeline",value:function(){var e=this;if(!this._operations)return(0,h.kB)();var t=this._operations.data.spatialReference;return(0,st.Xd)(this.moveZManipulator,(function(n,i,a){var o=(0,m.d9)(n.renderLocation),r=i.next((0,rt.Sp)(e._tool.view,o,t)).next((0,st.zh)());e._applyObjectMoveSteps(r,a)}))}},{key:"_applyObjectMoveSteps",value:function(e,t){var n=this,i=this._tool,a=this._object,o=e.next((function(e){return"start"===e.action&&(i.inputState={type:"move"},n._bounds.backupMapBounds(),i.events.emit("translate-start",{object:a,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next((0,st.AN)()).next(this._moveDragUpdateGeometry()).next((function(e){var t,n,o={object:a,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(null!==(t=e.mapEnd.z)&&void 0!==t?t:0)-(null!==(n=e.mapStart.z)&&void 0!==n?n:0))&&i.events.emit("translate",o);break;case"end":i.inputState=null,i.events.emit("translate-stop",o)}return e}));return t.next((function(){null!=i.inputState&&i.events.emit("translate-stop",{object:a,dxScreen:0,dyScreen:0}),i.cancel()})),o}},{key:"_moveDragUpdateGeometry",value:function(){var e=this,t=this._tool;return function(n){if(null==t.inputState||"move"!==t.inputState.type)return n;var i="start"===n.action?Ze.b.NEW_STEP:Ze.b.ACCUMULATE_STEPS;if(e._operations){var a=e._operations.move(n.mapDeltaX,n.mapDeltaY,n.mapDeltaZ,i);e._bounds.updateMapBoundsFromOperation(a)}return n}}}]),e}(),Yn=n(82218),Wn=n(11526),Qn=n(37947),$n=n(81703),Jn=n(34778),qn=n(85442),Kn=function(){function e(t,n,i){var a,r=this;(0,o.Z)(this,e),this._tool=t,this._bounds=n,this._snapRotation=i,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;var l=this._tool,s=l.view,u=!(null!==(a=s._stage)&&void 0!==a&&a.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this.rotateManipulator=new Qn.Z(s,(function(e,t){return(0,Wn.O)(s.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:u})})),l.addHandles([this.rotateManipulator.events.on("grab-changed",(function(e){return r._onRotateGrab(e)})),this._createRotateDragPipeline(this.rotateManipulator)]),l.manipulators.add(this.rotateManipulator),l.addHandles([l.events.on("rotate-start",(function(e){return r._startAngle=e.angle})),l.events.on("rotate",(function(e){return r._endAngle=e.angle})),l.events.on("rotate-stop",(function(){r._startAngle=0,r._endAngle=0}))])}return(0,r.Z)(e,[{key:"_object",get:function(){return this._tool.object}},{key:"_operations",get:function(){return this._object.operations}},{key:"destroy",value:function(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}},{key:"forEachManipulator",value:function(e){e(this.rotateManipulator,He.d.ROTATE)}},{key:"updateManipulators",value:function(e,t){var n=this._bounds.mapBounds.plane[2]<0?Math.PI:0,i=(0,wn.lM)(D.MP.get(),e,n);i[12]=0,i[13]=0,i[14]=0,this.rotateManipulator.modelTransform=i,this.rotateManipulator.renderLocation=(0,y.g)(D.WM.get(),t.origin,t.basis1)}},{key:"getUpdatedTooltipInfo",value:function(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}},{key:"_computeRotateTooltipInfo",value:function(){var e,t=null!==(e=this._rotateTooltipInfo)&&void 0!==e?e:this._rotateTooltipInfo=new qn.c({sketchOptions:this._tool.sketchOptions});return t.angle=this._startAngle-this._endAngle,t}},{key:"_onRotateGrab",value:function(e){var t=e.action,n=e.screenPoint,i=this._tool,a=this._bounds;if("start"===t&&n){var o=(0,Nn.Rd)(a.displayBounds,i.view.renderCoordsHelper,Nn.aZ.HEADING,(0,Pt.Ue)()),r=(0,$n.j$)(i.view.state.camera,n);(0,Pt.BR)(o,r,D.WM.get())&&(a.backupMapBounds(),i.inputState={type:"rotate",rotatePlane:o})}}},{key:"_createRotateDragPipeline",value:function(e){var t=this,n=this._tool,a=this._object;return(0,st.Xd)(e,(function(e,o,r){var l,s=n.inputState;null!=s&&((l=o.next((function(e){return"start"===e.action&&n.events.emit("rotate-start",{object:a,angle:0}),e})).next((0,rt._N)(n.view,s.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(s))).next.apply(l,(0,i.Z)(t._snapRotation())).next(t._rotateDragUpdateGeometry()).next((function(e){var t={object:a,angle:(0,E.BV)(e.rotateAngle)};switch(e.action){case"start":case"update":n.events.emit("rotate",t);break;case"end":n.inputState=null,n.events.emit("rotate-stop",t)}return e})),r.next((function(){null!=n.inputState&&n.events.emit("rotate-stop",{object:a,angle:0}),n.cancel()})))}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(n){var i=(0,Pt.st)(e.rotatePlane),o=(0,Rt.Gd)(n.renderStart,n.renderEnd,t._bounds.displayBounds.origin,i);return(0,a.Z)((0,a.Z)({},n),{},{rotateAxis:i,rotateAngle:o})}}},{key:"_rotateDragUpdateGeometry",value:function(){var e=this,t=this._bounds;return function(n){var i=(0,y.c)((0,m.Ue)(),t.mapBoundsStart.origin),a="start"===n.action?Ze.b.NEW_STEP:Ze.b.ACCUMULATE_STEPS;if(e._operations){var o=e._operations.rotate(i,n.rotateAngle,a,Jn.w.REPLACE);(0,Yn.c)(t.mapBoundsStart,t.mapBounds),t.updateMapBoundsFromOperation(o)}return n}}}]),e}(),ei=n(12350),ti=n(92583),ni=n(81725),ii=function(){function e(t,n){var i=this;(0,o.Z)(this,e),this._tool=t,this.mapBounds=(0,Yn.a)(),this.mapBoundsStart=(0,Yn.a)(),this.displayBounds=(0,Yn.a)(),t.addHandles((0,f.on)((function(){return t.object}),"modified-externally",(function(){return i._resetMapBounds()}),{onListenerAdd:function(){return i._resetMapBounds()}})),this._onDisplayBoundsChanged=n}return(0,r.Z)(e,[{key:"displayBoundsMargin",get:function(){var e,t,n,i=this._tool,a=i.view,o=i.object,r=(0,Ee.$)(o),l=null!==(e=null===(t=a.pointsOfInterest)||void 0===t?void 0:t.centerOnSurfaceFrequent.location)&&void 0!==e?e:null===r||void 0===r||null===(n=r.extent)||void 0===n?void 0:n.center;return l?ai*a.pixelSizeAt(l):0}},{key:"backupMapBounds",value:function(){(0,Yn.c)(this.mapBounds,this.mapBoundsStart)}},{key:"updateDisplayBounds",value:function(){var e;this._calculateDisplayBounds(),null===(e=this._onDisplayBoundsChanged)||void 0===e||e.call(this)}},{key:"updateMapBoundsFromOperation",value:function(e){(0,ti.nn)(e,this.mapBounds),this.updateDisplayBounds()}},{key:"updateMapBoundsFromOperationInverse",value:function(e){(0,ti.ui)(e,this.mapBounds),this.updateDisplayBounds()}},{key:"_resetMapBounds",value:function(){this._calculateMapBounds(),this.updateDisplayBounds()}},{key:"_calculateMapBounds",value:function(){var e,t=this._tool,n=t.view,i=t.attachmentOrigin,a=null===(e=t.object.operations)||void 0===e?void 0:e.data;if(a){var o=a.geometry;this.spatialReference=o.spatialReference;var r=xe(o);(0,j.bA)(r,r,-1);var l=n.spatialReference,s=o.spatialReference,u=i?n.pixelSizeAt(i)*(0,I.r6)(l)/(0,I.c9)(s):0;(0,ti.lv)(r,a,oi*u,this.mapBounds)}}},{key:"_calculateDisplayBounds",value:function(){var e,t=this._tool,n=t.view,i=t.attachmentOrigin,a=null!==(e=null===i||void 0===i?void 0:i.z)&&void 0!==e?e:(0,oe.w7)(this.mapBounds.origin,n.elevationProvider,re.o.fromElevationInfo(this._tool.object.elevationInfo),n.renderCoordsHelper),o=(0,Yn.c)(this.mapBounds);o.origin[2]=null!==a&&void 0!==a?a:0,function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;a||(a=(0,Yn.a)()),t.toRenderCoords(e.origin,n,a.origin);var o=D.WM.get();(0,y.g)(o,e.origin,e.basis1),(0,y.g)(o,o,e.basis2),t.toRenderCoords(o,n,o);var r=D.WM.get();(0,y.g)(r,e.origin,e.basis1),(0,y.f)(r,r,e.basis2),t.toRenderCoords(r,n,r);var l=D.WM.get();(0,y.f)(l,e.origin,e.basis1),(0,y.f)(l,l,e.basis2),t.toRenderCoords(l,n,l);var s=D.WM.get();(0,y.f)(s,e.origin,e.basis1),(0,y.g)(s,s,e.basis2),t.toRenderCoords(s,n,s);var u=(0,y.o)(D.WM.get(),o,r,.5);(0,y.f)(u,u,a.origin);var c=(0,y.o)(D.WM.get(),l,s,.5);(0,y.f)(c,a.origin,c),(0,y.o)(a.basis1,u,c,.5);var p=(0,y.o)(D.WM.get(),s,o,.5);(0,y.f)(p,p,a.origin);var d=(0,y.o)(D.WM.get(),r,l,.5);(0,y.f)(d,a.origin,d),(0,y.o)(a.basis2,p,d,.5);var h=(0,y.b)(D.WM.get(),a.basis1,a.basis2),v=(0,y.b)(h,h,a.basis1);(0,y.n)(v,v),(0,y.j)(a.basis2,v,(0,y.m)(a.basis2,v)),(0,y.j)(a.basis1,a.basis1,1+i/(0,y.l)(a.basis1)),(0,y.j)(a.basis2,a.basis2,1+i/(0,y.l)(a.basis2)),(0,Yn.u)(a)}(o,n.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}}]),e}(),ai=10,oi=80;function ri(e,t,n){return(0,y.f)(ci,(0,y.f)(ci,e.origin,e.basis1),e.basis2),(0,y.r)(ui,ci,e.basis1,2),(0,y.r)(si,ui,e.basis2,2),(0,y.r)(li,ci,e.basis2,2),ci[2]=ui[2]=si[2]=li[2]=t,(0,ni.D)({topLeft:li,topRight:si,bottomRight:ui,bottomLeft:ci,spatialReference:n})}var li=(0,m.Ue)(),si=(0,m.Ue)(),ui=(0,m.Ue)(),ci=(0,m.Ue)(),pi=n(72301),di=function(){function e(t,n,i){var a=this;(0,o.Z)(this,e),this._tool=t,this._bounds=n,this._preserveAspectRatioStep=i,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._scaleTooltipInfo=null,this._displayBoundsStart=(0,Yn.a)(),this._displayBoundsMarginStart=0,this._startScale=(0,A.Ue)(),this._endScale=(0,A.Ue)(),this._sizeStart=null,this._zMax=0,this._zMaxDirty=!0;var r=this._tool,l=r.view;this.resizeManipulators=this._resizeHandles.map((function(e){var t=new ei.o(l,e);return r.addHandles([t.events.on("grab-changed",(function(e){return a._onResizeGrab(e)})),a._createResizeDragPipeline(t,e)]),t})),r.manipulators.addMany(this.resizeManipulators),r.addHandles([r.events.on("scale-start",(function(e){(0,j.t8)(a._startScale,e.xScale,e.yScale),(0,j.t8)(a._endScale,e.xScale,e.yScale)})),r.events.on("scale",(function(e){(0,j.t8)(a._endScale,e.xScale,e.yScale)})),r.events.on("scale-stop",(function(){(0,j.t8)(a._startScale,0,0),(0,j.t8)(a._endScale,0,0)}))]),this._operations&&r.addHandles(this._operations.data.on("change",(function(){var e;"resize"!==(null===(e=r.inputState)||void 0===e?void 0:e.type)&&(a._zMaxDirty=!0)})))}return(0,r.Z)(e,[{key:"_object",get:function(){return this._tool.object}},{key:"_operations",get:function(){return this._object.operations}},{key:"zMax",get:function(){if(!this._zMaxDirty||!this._operations)return this._zMax;var e=this._operations.data;if(e.geometry.hasZ){var t=e.coordinateHelper;this._zMax=Number.NEGATIVE_INFINITY;var n,i=(0,ge.Z)(e.components);try{for(i.s();!(n=i.n()).done;){var a,o=n.value,r=(0,ge.Z)(o.vertices);try{for(r.s();!(a=r.n()).done;){var l,s=a.value,u=null!==(l=t.getZ(s.pos))&&void 0!==l?l:0;this._zMax=Math.max(u,this._zMax)}}catch(c){r.e(c)}finally{r.f()}}}catch(c){i.e(c)}finally{i.f()}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}},{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){this.resizeManipulators.forEach((function(t){return e(t,He.d.SCALE)}))}},{key:"updateManipulators",value:function(e,t){var n=this;this.resizeManipulators.forEach((function(i,a){(0,Nn.EC)(i,n._resizeHandles[a],e,t)}))}},{key:"getUpdatedTooltipInfo",value:function(){return this.resizeManipulators.some((function(e){return e.focused}))?this._computeScaleTooltipInfo():null}},{key:"_computeScaleTooltipInfo",value:function(){var e,t=this._tool,n=null!==(e=this._scaleTooltipInfo)&&void 0!==e?e:this._scaleTooltipInfo=new pi.p({sketchOptions:t.sketchOptions}),i=ri(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference);return null==i?null:(n.xSize=i.xSize,n.ySize=i.ySize,null!=this._sizeStart&&this.resizeManipulators.some((function(e){return e.dragging}))?(n.xScale=i.xSize.value/this._sizeStart.xSize.value,n.yScale=i.ySize.value/this._sizeStart.ySize.value):(n.xScale=1,n.yScale=1),n)}},{key:"_onResizeGrab",value:function(e){var t=e.action,n=e.screenPoint,i=this._tool,a=this._bounds;if("start"===t&&n){var o=(0,$n.j$)(i.view.state.camera,n);(0,Pt.BR)(a.displayBounds.plane,o,D.WM.get())&&(a.backupMapBounds(),(0,Yn.c)(a.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=a.displayBoundsMargin,this._sizeStart=ri(a.mapBoundsStart,this.zMax,a.spatialReference),i.inputState={type:"resize"})}}},{key:"_createResizeDragPipeline",value:function(e,t){var n=this,o=this._tool,r=this._object;return(0,st.Xd)(e,(function(e,l,s){var u;null!=o.inputState&&((u=l.next((function(e){return"start"===e.action&&o.events.emit("scale-start",{object:r,xScale:1,yScale:1}),e})).next((0,rt._N)(o.view,n._displayBoundsStart.plane)).next((function(e){return(0,a.Z)((0,a.Z)({},e),{},{handle:t})})).next(n._resizeDragRenderPlaneToFactors())).next.apply(u,(0,i.Z)(n._preserveAspectRatioStep())).next(n._resizeDragUpdateGeometry()).next((function(e){var t={object:r,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":o.events.emit("scale",t);break;case"end":o.inputState=null,o.events.emit("scale-stop",t)}return e})),s.next((function(){null!=o.inputState&&o.events.emit("scale-stop",{object:r,xScale:1,yScale:1}),o.cancel()})))}))}},{key:"_resizeDragRenderPlaneToFactors",value:function(){var e=this,t=this._bounds;return function(n){var i=e._displayBoundsStart,o=n.handle.direction,r=t.displayBoundsMargin,l=e._displayBoundsMarginStart,s=(0,y.c)(D.WM.get(),i.origin);(0,y.r)(s,s,i.basis1,-o[0]),(0,y.r)(s,s,i.basis2,-o[1]);var u=(0,y.f)(D.WM.get(),n.renderEnd,s),c=(0,y.f)(D.WM.get(),n.renderStart,s),p=(0,Nn.J0)(n.handle),d=(0,Nn.Lw)(i),h=(0,Nn.Lw)(t.displayBounds)/d,v=function(e,t){if(0===e)return 1;var n=(0,y.l)(t),i=.5*e*(0,y.m)(t,u)/n,a=i<0?-1:1;p&&(i+=(n-.5*e*(0,y.m)(t,c)/n)*a*h);var o=n<1.5*l?1:hi;return n=Math.max(n-l,hi),a>0&&(i-=r),a*Math.max(a*(i/n),o)};return(0,a.Z)((0,a.Z)({},n),{},{factor1:v(o[0],i.basis1),factor2:v(o[1],i.basis2)})}}},{key:"_resizeDragUpdateGeometry",value:function(){var e=this,t=this._bounds;return function(n){var i=(0,y.c)((0,m.Ue)(),t.mapBoundsStart.origin);(0,y.r)(i,i,t.mapBoundsStart.basis1,-n.handle.direction[0]),(0,y.r)(i,i,t.mapBoundsStart.basis2,-n.handle.direction[1]);var a=(0,j.t8)((0,A.Ue)(),t.mapBoundsStart.basis1[0],t.mapBoundsStart.basis1[1]);(0,j.Fv)(a,a);var o="start"===n.action?Ze.b.NEW_STEP:Ze.b.ACCUMULATE_STEPS;if(e._operations){var r=e._operations.scale(i,a,n.factor1,n.factor2,o,Jn.w.REPLACE);(0,Yn.c)(t.mapBoundsStart,t.mapBounds),t.updateMapBoundsFromOperation(r)}return n}}}]),e}(),hi=1e-6,vi=function(){function e(){(0,o.Z)(this,e),this._lastDragEvent=null,this._next=null,this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){var t=(0,a.Z)((0,a.Z)({},this._lastDragEvent),{},{action:"update"});e&&fi(t),this._next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;this._lastDragEvent=null;var t=new st.hM;return this._next=t,[function(t){return e._lastDragEvent="end"!==t.action?(0,a.Z)({},t):null,e._enabled&&fi(t),t},t]}},{key:"test",get:function(){}}]),e}();function fi(e){var t=(0,Nn.J0)(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}var _i=function(){function e(){(0,o.Z)(this,e),this._lastDragEvent=null,this._next=null,this.incrementRadians=(0,E.Vl)(5),this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&null!=this._lastDragEvent&&null!=this._next){var t=(0,a.Z)((0,a.Z)({},this._lastDragEvent),{},{action:"update"});e&&this._adjustRotation(t),this._next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;this._lastDragEvent=null;var t=new st.hM;return this._next=t,[function(t){return e._lastDragEvent="end"!==t.action?(0,a.Z)({},t):null,e._enabled&&e._adjustRotation(t),t},t]}},{key:"_adjustRotation",value:function(e){e.rotateAngle=Math.round(e.rotateAngle/this.incrementRadians)*this.incrementRadians}}]),e}(),gi=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).events=new be.Z,i.enableZ=!0,i.enableScaling=!0,i.enableRotation=!0,i.sketchOptions=new ht.Z,i._preserveAspectRatio=new vi,i._snapRotation=new _i,i.grabbing=!1,i.inputState=null,i._attachmentOrigin=null,i.type="transform-3d",i._outlineVisualElement=null,i}return(0,r.Z)(n,[{key:"updating",get:function(){return!!this.object.updating}},{key:"initialize",value:function(){var e=this,t=this.view,n=this.object,i=this._bounds=new ii(this,(function(){return e._updateManipulators()}));this._extentMove=new Xn(this,i),this._extentScale=new di(this,i,(function(){return e._preserveAspectRatio.createDragEventPipelineStep()})),this._extentRotate=new Kn(this,i,(function(){return e._snapRotation.createDragEventPipelineStep()})),this.addHandles([(0,f.watch)((function(){return e.enableZ}),(function(){return e._updateManipulatorAvailability(e._extentMove.moveZManipulator,He.d.TRANSLATE_Z)})),(0,f.watch)((function(){return e.enableScaling}),(function(){return e._extentScale.forEachManipulator((function(t){return e._updateManipulatorAvailability(t,He.d.SCALE)}))})),(0,f.watch)((function(){return e.enableRotation}),(function(){return e._updateManipulatorAvailability(e._extentRotate.rotateManipulator,He.d.ROTATE)}))]),this._updateManipulators(),this._updateAllManipulatorAvailability();var o=nt({view:t,object:n,forEachManipulator:function(t){return e._forEachManipulator(t)},onManipulatorsChanged:function(){return(0,h.kB)()}});if(null!=o){var r=o.visualElement;r instanceof ie.k&&(this._outlineVisualElement=r,this.addHandles(r.events.on("attachment-origin-changed",(function(){return e._bounds.updateDisplayBounds()})))),this.addHandles(o)}this.addHandles([n.on("committed",(function(){return e._onGeometryChanged()})),(0,f.watch)((function(){return e.object.visible}),(function(){return e._updateAllManipulatorAvailability()})),(0,f.watch)((function(){return e.object.isDraped}),(function(){return e._graphicDrapedChanged()}),f.initial),(0,f.watch)((function(){var e;return null===(e=t.pointsOfInterest)||void 0===e?void 0:e.centerOnSurfaceFrequent.location}),(function(){return i.updateDisplayBounds()}))]);this._forEachManipulator((function(t){e.addHandles(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e._updateAllManipulatorAvailability()})))}));this._forEachManipulator((function(t,i){e.addHandles(t.events.on("immediate-click",(function(t){i===He.d.TRANSLATE_XY&&e.events.emit("immediate-click",(0,a.Z)((0,a.Z)({},t),{},{object:n})),t.stopPropagation()})))})),this._initializeTooltip(),this.finishToolCreation()}},{key:"destroy",value:function(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set("view",null),this._set("object",null)}},{key:"_initializeTooltip",value:function(){var e=this,t=this.view,n=this.tooltip=new _t.u({view:t}),i=function(){n.info=e._getUpdatedTooltipInfo()};this.addHandles([(0,f.watch)((function(){return e.sketchOptions.tooltips.effectiveEnabled}),i),this.events.on("translate-start",i),this.events.on("translate",i),this.events.on("translate-stop",(function(){return e.tooltip.clear()})),this.events.on("rotate-start",i),this.events.on("rotate",i),this.events.on("rotate-stop",i),this.events.on("scale-start",i),this.events.on("scale",i),this.events.on("scale-stop",i)]),this._forEachManipulator((function(t){e.addHandles([t.events.on("focus-changed",i),t.events.on("grab-changed",i),t.events.on("drag",(function(t){"cancel"===t.action?e.tooltip.clear():i()}))])}))}},{key:"_getUpdatedTooltipInfo",value:function(){var e,t;return this.sketchOptions.tooltips.effectiveEnabled?null!==(e=null!==(t=this._extentMove.getUpdatedTooltipInfo())&&void 0!==t?t:this._extentScale.getUpdatedTooltipInfo())&&void 0!==e?e:this._extentRotate.getUpdatedTooltipInfo():null}},{key:"_onGeometryChanged",value:function(){this._bounds.updateDisplayBounds()}},{key:"_graphicDrapedChanged",value:function(){var e=this;this.removeHandles(yi),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on("elevation-change",(function(t){null!=e._attachmentOrigin&&(0,$e.jE)(t.extent,e._attachmentOrigin.x,e._attachmentOrigin.y)&&e._bounds.updateDisplayBounds()})),yi)}},{key:"_updateManipulators",value:function(){if(this.visible){var e=this._bounds.displayBounds,t=(0,Nn.zY)(e,D.MP.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}}},{key:"_updateAllManipulatorAvailability",value:function(){var e=this;this._forEachManipulator((function(t,n){return e._updateManipulatorAvailability(t,n)}))}},{key:"_updateManipulatorAvailability",value:function(e,t){var n=this.grabbing&&!e.grabbing;if(e.interactive=!n,e instanceof Le.Z){var i=this.object.visible,a=this.enableZ&&(0,Te.I)(this.object.operations,this.object.elevationInfo);switch(t){case He.d.ROTATE:e.available=i&&this.enableRotation;break;case He.d.SCALE:e.available=i&&(this.enableScaling||this.enableRotation||a),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?Nn.Sc:Nn.vc;break;case He.d.TRANSLATE_Z:e.available=i&&a;break;default:e.available=i}}}},{key:"_forEachManipulator",value:function(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"snapRotation",get:function(){return this._snapRotation.enabled},set:function(e){this._snapRotation.enabled=e,this._set("snapRotation",e)}},{key:"attachmentOrigin",get:function(){var e,t,n,i,a=this.object.isDraped?null:null===(e=this._outlineVisualElement)||void 0===e?void 0:e.attachmentOrigin;return this._attachmentOrigin=null!==(t=null!==a&&void 0!==a?a:this.object.origin)&&void 0!==t?t:null===(n=(0,Ee.$)(this.object))||void 0===n||null===(i=n.extent)||void 0===i?void 0:i.center,this._attachmentOrigin}},{key:"reset",value:function(){}},{key:"cancel",value:function(){if(this.canUndo){var e,t=null===(e=this.object.operations)||void 0===e?void 0:e.undo();t&&this._bounds.updateMapBoundsFromOperationInverse(t)}this.inputState=null}},{key:"canUndo",get:function(){var e;return!(null===(e=this.object.operations)||void 0===e||!e.canUndo)}},{key:"undo",value:function(){if(null!=this.inputState)this.view.activeTool=null;else if(this.canUndo){var e,t=null===(e=this.object.operations)||void 0===e?void 0:e.undo();t&&this._bounds.updateMapBoundsFromOperationInverse(t)}}},{key:"canRedo",get:function(){var e;return!(null===(e=this.object.operations)||void 0===e||!e.canRedo)}},{key:"redo",value:function(){if(this.canRedo){var e,t=null===(e=this.object.operations)||void 0===e?void 0:e.redo();t&&this._bounds.updateMapBoundsFromOperation(t)}}},{key:"test",get:function(){}}]),n}(pt.m);(0,p._)([(0,_.Cb)()],gi.prototype,"updating",null),(0,p._)([(0,_.Cb)({constructOnly:!0,nonNullable:!0})],gi.prototype,"view",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0,nonNullable:!0})],gi.prototype,"object",void 0),(0,p._)([(0,_.Cb)()],gi.prototype,"enableZ",void 0),(0,p._)([(0,_.Cb)()],gi.prototype,"enableScaling",void 0),(0,p._)([(0,_.Cb)()],gi.prototype,"enableRotation",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0,type:ht.Z})],gi.prototype,"sketchOptions",void 0),(0,p._)([(0,_.Cb)()],gi.prototype,"preserveAspectRatio",null),(0,p._)([(0,_.Cb)()],gi.prototype,"snapRotation",null),(0,p._)([(0,_.Cb)()],gi.prototype,"grabbing",void 0),(0,p._)([(0,_.Cb)()],gi.prototype,"inputState",void 0),(0,p._)([(0,_.Cb)({readOnly:!0})],gi.prototype,"type",void 0),(0,p._)([(0,_.Cb)()],gi.prototype,"tooltip",void 0),gi=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.transform.ExtentTransformTool")],gi);var yi="draped-elevation-changes",mi=n(69048);function bi(e){return null!=e&&"mesh"===e.type?function(e){return(0,mi.zZ)(e.vertexSpace)?function(e,t,n){var i=null===t||void 0===t?void 0:t.clone(),a=(0,m.d9)(n.origin),o=null,r=null;return{undo:function(){var t;o=null===(t=e.transform)||void 0===t?void 0:t.clone(),r=(0,m.d9)(n.origin),e.transform=i,e.vertexSpace.origin=a},redo:function(){var t;i=null===(t=e.transform)||void 0===t?void 0:t.clone(),a=(0,m.d9)(n.origin),e.transform=o,e.vertexSpace.origin=r}}}(e,e.transform,e.vertexSpace):function(e){var t,n=e.vertexAttributes.clonePositional();return{undo:function(){t=e.vertexAttributes.clonePositional(),e.vertexAttributes=n},redo:function(){n=e.vertexAttributes.clonePositional(),e.vertexAttributes=t}}}(e)}(e):function(e){var t=e,n=null;return{undo:function(e){n=e.geometry,e.geometry=t},redo:function(e){t=e.geometry,e.geometry=n}}}(e)}var Mi=n(2346),Si=Symbol(),ki=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e))._updatingHandles=new Se.R,i}return(0,r.Z)(n,[{key:"operations",get:function(){return this._operations}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"elevationInfo",get:function(){return(0,b.RL)(this.graphic)}},{key:"visible",get:function(){return this._graphicState.displaying}},{key:"isDraped",get:function(){return this._graphicState.isDraped}},{key:"origin",get:function(){return(0,Rt.du)(this.view,this.graphic)}},{key:"destroy",value:function(){this._operations=(0,v.SC)(this._operations),this._updatingHandles.destroy()}},{key:"initialize",value:function(){var e=this;this._graphicState=new le.F({graphic:this.graphic}),this._graphicState.on("changed",(function(){return e.emit("committed")})),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add((function(){return e.graphic.geometry}),(function(t){var n;if(t!==(null===(n=e._operations)||void 0===n?void 0:n.data.geometry)){var i;if(!t||"multipoint"===(null===t||void 0===t?void 0:t.type)||"extent"===(null===t||void 0===t?void 0:t.type))return(0,v.SC)(e._operations),e.removeHandles(Si),void(e._operations=null);if(null!==(i=e._operations)&&void 0!==i&&i.trySetGeometry(t))e.emit("modified-externally");else{(0,v.SC)(e._operations),e.removeHandles(Si);var a=dt.c.fromGeometry(t,e.view.state.viewingMode);e._operations=a,e.addHandles(a.data.on("change",(function(){return e.graphic.geometry=a.data.geometry})),Si)}}}),f.initial))}},{key:"createManipulator",value:function(e){return new Mi.L((0,a.Z)({view:this.view,graphic:this.graphic},e))}},{key:"maskOccludee",value:function(){return this.view.maskOccludee(this.graphic)}},{key:"endInteraction",value:function(){var e=this.graphic.geometry;"mesh"===(null===e||void 0===e?void 0:e.type)&&this.graphic.notifyMeshTransformChanged({action:K.u.UpdateFastLocalOrigin})}},{key:"toMap",value:function(e){return this.view.toMap(e,{include:[this.graphic]})}},{key:"createUndoRecord",value:function(){return bi(this.graphic.geometry)}}]),n}(be.Z.EventedAccessor);(0,p._)([(0,_.Cb)({constructOnly:!0})],ki.prototype,"view",void 0),(0,p._)([(0,_.Cb)({constructOnly:!0})],ki.prototype,"graphic",void 0),(0,p._)([(0,_.Cb)()],ki.prototype,"_operations",void 0),(0,p._)([(0,_.Cb)()],ki.prototype,"operations",null),(0,p._)([(0,_.Cb)()],ki.prototype,"updating",null),ki=(0,p._)([(0,g.j)("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],ki)},81655:function(e,t,n){n.d(t,{I:function(){return o},c:function(){return r}});var i=n(42537),a=n(74509);function o(e,t){return function(e,t){return!!e&&"on-the-ground"!==t.mode&&!(0,a.fl)(t)}(null===e||void 0===e?void 0:e.data.coordinateHelper.hasZ(),t)}function r(e,t){var n=null,a=e.events.on("grab-changed",(function(i){null!=n&&(n.remove(),n=null),"start"===i.action?(n=e.disableDisplay(),t&&t(i)):t&&t(i)}));return(0,i.kB)((function(){var e;null!==(e=n)&&void 0!==e&&e.remove(),a.remove()}))}},87198:function(e,t,n){n.d(t,{k:function(){return Z}});var i=n(37762),a=n(15671),o=n(43144),r=n(88301),l=n(61120),s=n(60136),u=n(29388),c=n(91505),p=n(32035),d=n(12400),h=n(19093),v=n(99894),f=n(50628),_=n(41414),g=n(86372),y=n(55946),m=n(74509),b=n(64575),M=n(19182),S=n(96026),k=n(78935),w=n(79685),x=n(78081),O=n(56529),C=n(39077),E=n(4760),T=n(58901),Z=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i,o;return(0,a.Z)(this,n),(o=t.call(this,e))._attachmentOrigin=(0,y.T)(0,0,0,null),o._attachmentOriginDirty=!0,o.events=new c.Z,o._geometry=null,o._width=1,o._color=(0,v.al)(1,0,1,1),o._innerWidth=0,o._innerColor=(0,v.al)(1,1,1,1),o._stipplePattern=null,o._stippleOffColor=null,o._falloff=0,o._elevationInfo=null,o._laserlineStyle=null,o._laserlineEnabled=!1,o._renderOccluded=O.yD.OccludeAndTransparentStencil,o._attachmentOrigin.spatialReference=e.view.spatialReference,o._laserline=new S.W({view:e.view,isDecoration:e.isDecoration}),o.applyProperties(e),o.attached=null===(i=e.attached)||void 0===i||i,o}return(0,o.Z)(n,[{key:"destroy",value:function(){this._laserline.destroy(),(0,r.Z)((0,l.Z)(n.prototype),"destroy",this).call(this)}},{key:"createObject3DResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(e){return t._createObject3DResources(e)},destroyResources:I,recreateGeometry:function(e,n){e.geometries.length=0,t._recreateGeometry(n,e.material,e.geometries)}}}},{key:"createDrapedResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(){return t._createDrapedResources()},destroyResources:I,recreateGeometry:function(e){e.geometries=t._createRenderGeometriesDraped(e.material),t._attachmentOriginChanged()}}}},{key:"_laserlineAttached",get:function(){return this.attached&&this.visible&&null!=this._laserlineStyle&&!this.isDraped&&this.laserlineEnabled}},{key:"onAttachedChange",value:function(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,h.a)(e,this._color)||((0,h.c)(this._color,e),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,h.a)(e,this._innerColor)||((0,h.c)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&(0,h.a)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,v.d9)(e):null,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"attachmentOrigin",get:function(){var e;if(!this._attachmentOriginDirty)return this._attachmentOrigin;var t=null===(e=this.object3dResources.resources)||void 0===e?void 0:e.geometries;if(!t||0===t.length)return null;(0,p.s)(A,0,0,0);var n,a=0,o=(0,i.Z)(t);try{for(o.s();!(n=o.n()).done;){n.value.computeAttachmentOrigin(j)&&((0,p.g)(A,A,j),a++)}}catch(r){o.e(r)}finally{o.f()}return 0===a?null:((0,p.j)(A,A,1/a),this.view.renderCoordsHelper.fromRenderCoords(A,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"_updateMaterial",value:function(){null!=this.object3dResources.resources&&this.object3dResources.resources.material.setParameters(this._materialParameters),null!=this.drapedResources.resources&&this.drapedResources.resources.material.setParameters(this._materialParameters)}},{key:"_isClosed",get:function(){return null!=this.geometry&&"polygon"===this.geometry.type}},{key:"_materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}},{key:"_normalizedRenderOccluded",get:function(){return this.isDraped&&this._renderOccluded===O.yD.OccludeAndTransparentStencil?O.yD.OccludeAndTransparent:this._renderOccluded}},{key:"_recreateGeometry",value:function(e,t,n){this._createRenderGeometries(t,n);var a,o=(0,i.Z)(n);try{for(o.s();!(a=o.n()).done;){var r=a.value;e.addGeometry(r)}}catch(l){o.e(l)}finally{o.f()}this._attachmentOriginChanged()}},{key:"_attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"_createObject3DResources",value:function(e){var t=new T.U(this._materialParameters),n=new Array;return this._recreateGeometry(e,t,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}}},{key:"_createDrapedResources",value:function(){var e=new T.U(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}},{key:"_createRenderGeometriesDraped",value:function(e){var t=this,n=this.geometry,i=this.view,a=i.basemapTerrain.spatialReference;return null==n||null==a?[]:(0,x.r)(n,a).lines.map((function(n){var o=n.position,r={overlayInfo:{spatialReference:a,renderCoordsHelper:i.renderCoordsHelper},attributeData:{position:o},removeDuplicateStartEnd:t._isClosed};return new C.z((0,w.Y)(e,r))}))}},{key:"calculateMapBounds",value:function(e){if(null==this.object3dResources.resources)return!1;var t,n=this.view.renderCoordsHelper,a=(0,i.Z)(this.object3dResources.resources.geometries);try{for(a.s();!(t=a.n()).done;){var o=t.value.attributes.get(E.T.POSITION),r=(0,g.bg)(o.data.length);(0,f.projectBuffer)(o.data,n.spatialReference,0,r,this.view.spatialReference,0,o.data.length/3),(0,_.G1)(e,r)}}catch(l){a.e(l)}finally{a.f()}return!0}},{key:"_createRenderGeometries",value:function(e,t){var n,a=this.geometry;if(null!=a){var o,r=(0,x.V)(a,this.view.elevationProvider,this.view.renderCoordsHelper,k.o.fromElevationInfo(null!==(n=this.elevationInfo)&&void 0!==n?n:new b.Z({mode:(0,m.VW)(a,null)}))),l=new Array,s=(0,i.Z)(r.lines);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=u.position,p={mapPositions:u.mapPositions,attributeData:{position:c},removeDuplicateStartEnd:this._isClosed};t.push((0,w.Y)(e,p)),l.push(c)}}catch(d){s.e(d)}finally{s.f()}this._laserline.pathVerticalPlane=l}}}]),n}(M.i);function I(e){e.geometries=[]}var j=(0,d.Ue)(),A=(0,d.Ue)()},27676:function(e,t,n){n.d(t,{j:function(){return M}});var i=n(1413),a=n(37762),o=n(15671),r=n(43144),l=n(60136),s=n(29388),u=n(32035),c=n(12400),p=n(19093),d=n(86361),h=n(52168),v=n(78935),f=n(86372),_=n(69691);var g=n(68401),y=n(70619),m=n(56529),b=n(11606),M=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).view=null,i._renderOccluded=m.yD.OccludeAndTransparent,i._vertices=null,i._spatialReference=null,i._color=(0,d.nI)([1,127/255,0,1]),i._size=11,i._outlineColor=(0,d.nI)([0,0,0,.5]),i._outlineSize=1,i._elevationInfo=null,i.applyProperties(e),i}return(0,r.Z)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){(0,p.a)(e,this._color)||((0,p.c)(this._color,e),this._updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,p.a)(e,this._outlineColor)||((0,p.c)(this._outlineColor,e),this._updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"_vertexMaterialParameters",get:function(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}},{key:"_vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}},{key:"_updateMaterial",value:function(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}},{key:"_updateOutlineMaterial",value:function(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}},{key:"_createRenderGeometries",value:function(){var e=this.vertices;if(null==e||0===e.length)return[];for(var t=function(e,t,n,i,a){var o=(0,f.bg)(3*e.length),r=(0,f.bg)(o.length);e.forEach((function(e,t){o[3*t]=e[0],o[3*t+1]=e[1],o[3*t+2]=e.length>2?e[2]:0}));var l=(0,_.rR)(o,t,0,r,0,o,0,o.length/3,n,i,a),s=null!=l;return{numVertices:e.length,position:o,mapPositions:r,projectionSuccess:s,sampledElevation:l}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,v.o.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,a=t.position,o=0;o<i;++o){var r=(0,u.s)(S,a[3*o],a[3*o+1],a[3*o+2]),l=k(this._vertexMaterial,.5,r),s=k(this._vertexOutlineMaterial,.5,r);n.push({vertexGeometry:l,vertexOutlineGeometry:s})}return n}},{key:"createGeometries",value:function(e){var t,n=this._createRenderGeometries(),i=(0,a.Z)(n);try{for(i.s();!(t=i.n()).done;){var o=t.value,r=o.vertexGeometry,l=o.vertexOutlineGeometry;e.addGeometry(r),e.addGeometry(l)}}catch(s){i.e(s)}finally{i.f()}}},{key:"createExternalResources",value:function(){this._vertexMaterial=new b.Q((0,i.Z)((0,i.Z)({},this._vertexMaterialParameters),{},{writeDepth:!0,cullFace:g.Vr.Back,screenSizeEnabled:!0})),this._vertexOutlineMaterial=new b.Q((0,i.Z)((0,i.Z)({},this._vertexOutlineMaterialParameters),{},{forceTransparentMode:!0,writeDepth:!0,cullFace:g.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}]),n}(h._),S=(0,c.Ue)();function k(e,t,n){return(0,y.PI)(e,t,16,16,{offset:n})}},94687:function(e,t,n){n.d(t,{F:function(){return p}});var i=n(43144),a=n(15671),o=n(60136),r=n(29388),l=n(27366),s=n(91505),u=n(49861),c=(n(93169),n(32718),n(84936),n(69912)),p=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).tracking=!1,i.displaying=!1,i.isDraped=!1,i}return(0,i.Z)(n)}(s.Z.EventedAccessor);(0,l._)([(0,u.Cb)({constructOnly:!0})],p.prototype,"graphic",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"tracking",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"displaying",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"isDraped",void 0),p=(0,l._)([(0,c.j)("esri.views.3d.layers.graphics.GraphicState")],p)},2346:function(e,t,n){n.d(t,{L:function(){return w}});var i=n(15671),a=n(43144),o=n(60136),r=n(29388),l=n(27366),s=n(7138),u=n(91505),c=n(94172),p=n(17842),d=n(49861),h=(n(93169),n(32718),n(84936),n(69912)),v=n(13611),f=n(32035),_=n(12400),g=n(79803),y=n(68859),m=n(74509),b=n(61574),M=n(64575),S=n(90297),k=n(45008),w=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var a;return(0,i.Z)(this,n),(a=t.call(this,e)).layer=null,a.interactive=!0,a.selectable=!1,a.grabbable=!0,a.dragging=!1,a.cursor=null,a.consumesClicks=!0,a.events=new u.Z.EventEmitter,a._circleCollisionCache=null,a._graphicSymbolChangedHandle=null,a._originalSymbol=null,a}return(0,a.Z)(n,[{key:"graphic",set:function(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}},{key:"elevationInfo",get:function(){var e=this.graphic.layer,t=e&&"elevationInfo"in e?e.elevationInfo:null,n=(0,m.vu)(this.graphic),i=t?t.offset:0;return new M.Z({mode:n,offset:i})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var n=t.geometry;if(null==n)return null;var i=this._get("focusedSymbol"),a=null!=i?i:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,n,a):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,c.watch)((function(){var t;return null===(t=e.graphic)||void 0===t?void 0:t.symbol}),(function(t){null!=t&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&null!=e.focusedSymbol&&(e.graphic.symbol=e.focusedSymbol))}),c.sync)}},{key:"detachSymbolChanged",value:function(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"onElevationChange",value:function(){}},{key:"onViewChange",value:function(){}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,n,i){var a;if(null==(i=i||(0,b.js)(n)))return null;var o=this._circleCollisionCache;if("point"===n.type&&"cim"===i.type&&"CIMPointSymbol"===(null===(a=i.data.symbol)||void 0===a?void 0:a.type)&&i.data.symbol.symbolLayers){var r=(0,S.i)(i),l=r.offsetX,s=r.offsetY,u=r.size,c=(0,p.md)(t,O),d=u/2,h=e.toScreen(n),f=h.x+l,_=h.y+s;return(0,v.bI)(c,[f,_])<d*d?1:null}if("point"!==n.type||"simple-marker"!==i.type)return(0,k.D)(t,n,e)?1:null;if(null==o||!o.originalPoint.equals(n)){var y=n,m=e.spatialReference;if((0,g.canProjectWithoutEngine)(y.spatialReference,m)){var M=(0,g.project)(y,m);o={originalPoint:y.clone(),mapPoint:M,radiusPx:(0,p.F2)(i.size)},this._circleCollisionCache=o}}if(null!=o){var w,x=(0,p.md)(t,O),C=null===(w=e.toScreen)||void 0===w?void 0:w.call(e,o.mapPoint);if(!C)return null;var E=o.radiusPx,T=C.x+(0,p.F2)(i.xoffset),Z=C.y-(0,p.F2)(i.yoffset);return(0,v.bI)(x,[T,Z])<E*E?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,n){var i=e.toMap(t,{include:[n]});return i&&(0,y.K)(i,x,e.renderSpatialReference)?(0,f.p)(x,e.state.camera.eye):null}}]),n}(s.default);(0,l._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],w.prototype,"graphic",null),(0,l._)([(0,d.Cb)()],w.prototype,"elevationInfo",null),(0,l._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],w.prototype,"view",void 0),(0,l._)([(0,d.Cb)({value:null})],w.prototype,"focusedSymbol",null),(0,l._)([(0,d.Cb)({constructOnly:!0})],w.prototype,"layer",void 0),(0,l._)([(0,d.Cb)()],w.prototype,"interactive",void 0),(0,l._)([(0,d.Cb)()],w.prototype,"selectable",void 0),(0,l._)([(0,d.Cb)()],w.prototype,"grabbable",void 0),(0,l._)([(0,d.Cb)({value:!1})],w.prototype,"grabbing",null),(0,l._)([(0,d.Cb)()],w.prototype,"dragging",void 0),(0,l._)([(0,d.Cb)()],w.prototype,"hovering",null),(0,l._)([(0,d.Cb)({value:!1})],w.prototype,"selected",null),(0,l._)([(0,d.Cb)()],w.prototype,"cursor",void 0),w=(0,l._)([(0,h.j)("esri.views.interactive.GraphicManipulator")],w);var x=(0,_.Ue)(),O=(0,p.s1)()},90297:function(e,t,n){n.d(t,{i:function(){return a}});var i=n(17842);function a(e){var t=0,n=0,a=0;return e?("cim"===e.type&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map((function(e){"CIMVectorMarker"===e.type&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),null!=e.size&&e.size>a&&(a=e.size))})),t=(0,i.F2)(t),n=(0,i.F2)(n),a=(0,i.F2)(a),{offsetX:t,offsetY:n,size:a}):{offsetX:t,offsetY:n,size:a}}},85442:function(e,t,n){n.d(t,{c:function(){return c}});var i=n(43144),a=n(15671),o=n(60136),r=n(29388),l=n(27366),s=n(49861),u=(n(93169),n(32718),n(84936),n(69912)),c=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="extent-rotate",i.angle=0,i}return(0,i.Z)(n)}(n(85809).h);(0,l._)([(0,s.Cb)()],c.prototype,"type",void 0),(0,l._)([(0,s.Cb)()],c.prototype,"angle",void 0),c=(0,l._)([(0,u.j)("esri.views.interactive.tooltip.infos.ExtentRotateTooltipInfo")],c)},72301:function(e,t,n){n.d(t,{p:function(){return p}});var i=n(43144),a=n(15671),o=n(60136),r=n(29388),l=n(27366),s=n(47898),u=n(49861),c=(n(93169),n(32718),n(84936),n(69912)),p=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="extent-scale",i.xScale=0,i.yScale=0,i.xSize=s.yP,i.ySize=s.yP,i}return(0,i.Z)(n)}(n(85809).h);(0,l._)([(0,u.Cb)()],p.prototype,"type",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"xScale",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"yScale",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"xSize",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"ySize",void 0),p=(0,l._)([(0,c.j)("esri.views.interactive.tooltip.infos.ExtentScaleTooltipInfo")],p)},51155:function(e,t,n){n.d(t,{o:function(){return p}});var i=n(15671),a=n(43144),o=n(60136),r=n(29388),l=n(27366),s=n(49861),u=(n(93169),n(32718),n(84936),n(69912)),c=n(85809),p=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var a;return(0,i.Z)(this,n),(a=t.call(this,e)).type="move-point",a.allFields.forEach((function(e){e.lockable=!1,e.setActual(null)})),a}return(0,a.Z)(n,[{key:"allFields",get:function(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}}]),n}((0,n(35647).A)(c.h));(0,l._)([(0,s.Cb)()],p.prototype,"allFields",null),p=(0,l._)([(0,u.j)("esri.views.interactive.tooltip.infos.MovePointTooltipInfo")],p)},6896:function(e,t,n){n.d(t,{K:function(){return d}});var i=n(15671),a=n(43144),o=n(60136),r=n(29388),l=n(27366),s=n(49861),u=(n(93169),n(32718),n(84936),n(69912)),c=n(73816),p=n(85809),d=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var a;return(0,i.Z)(this,n),(a=t.call(this,e)).type="selected-vertex",a.area=(0,c.UR)(),a.totalLength=(0,c.i4)(),a.geometryType="polyline",a.allFields.forEach((function(e){e.lockable=!1,e.setActual(null)})),a}return(0,a.Z)(n,[{key:"allFields",get:function(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,"polygon"===this.geometryType?this.area:this.totalLength]}}]),n}((0,n(35647).A)(p.h));(0,l._)([(0,s.Cb)()],d.prototype,"geometryType",void 0),(0,l._)([(0,s.Cb)()],d.prototype,"allFields",null),d=(0,l._)([(0,u.j)("esri.views.interactive.tooltip.infos.SelectedVertexTooltipInfo")],d)},42170:function(e,t,n){n.d(t,{E:function(){return p}});var i=n(15671),a=n(43144),o=n(60136),r=n(29388),l=n(27366),s=n(47898),u=n(49861),c=(n(93169),n(32718),n(84936),n(69912)),p=function(e){(0,o.Z)(n,e);var t=(0,r.Z)(n);function n(e){var a;return(0,i.Z)(this,n),(a=t.call(this,e)).type="translate",a.distance=s.yP,a}return(0,a.Z)(n,[{key:"clear",value:function(){this.distance=s.yP}}]),n}(n(85809).h);(0,l._)([(0,u.Cb)()],p.prototype,"type",void 0),(0,l._)([(0,u.Cb)()],p.prototype,"distance",void 0),p=(0,l._)([(0,c.j)("esri.views.interactive.tooltip.infos.TranslateTooltipInfo")],p)},81725:function(e,t,n){n.d(t,{D:function(){return o}});var i=n(47898),a=n(59418);function o(e){var t=e.topLeft,n=e.topRight,o=e.bottomRight,r=e.bottomLeft,l=e.spatialReference,s=(0,i.Fp)((0,a.x)(r,o,l),(0,a.x)(t,n,l));if(null==s)return null;var u=(0,i.Fp)((0,a.x)(o,n,l),(0,a.x)(r,t,l));return null==u?null:{xSize:s,ySize:u}}}}]);
//# sourceMappingURL=63336.ca754a92.chunk.js.map