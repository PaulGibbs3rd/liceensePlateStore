{"version":3,"file":"static/js/83329.cce8bd9c.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/2d/engine/webgl/TileContainer.js","../node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js","../node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport has from\"../../../../core/has.js\";import{WGLDrawPhase as e}from\"./enums.js\";import r from\"./WGLContainer.js\";import s from\"./brushes/WGLBrushStencil.js\";import t from\"./brushes/WGLBrushTileDebugInfo.js\";const n=(e,r)=>e.key.level-r.key.level!=0?e.key.level-r.key.level:e.key.row-r.key.row!=0?e.key.row-r.key.row:e.key.col-r.key.col;class i extends r{constructor(e){super(),this._tileInfoView=e}renderChildren(e){this.sortChildren(n),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:r}=e,s=super.createRenderParams(e);return s.requiredLevel=this._tileInfoView.getClosestInfoForScale(r.scale).level,s.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(r.scale),s}prepareRenderPasses(r){const n=super.prepareRenderPasses(r);return n.push(r.registerRenderPass({name:\"stencil\",brushes:[s],drawPhase:e.DEBUG|e.MAP|e.HIGHLIGHT|e.LABEL,target:()=>this.getStencilTarget()})),has(\"esri-tiles-debug\")&&n.push(r.registerRenderPass({name:\"tileInfo\",brushes:[t],drawPhase:e.DEBUG,target:()=>this.children})),n}getStencilTarget(){return this.children}setStencilReference(e){let r=1;for(const s of this.children)s.stencilRef=r++}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Logger.js\";import{isAbortError as i}from\"../../../core/promiseUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import{equals as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{BitmapTileLayerView2D as l}from\"./BitmapTileLayerView2D.js\";import{LayerView2DMixin as o}from\"./LayerView2D.js\";import{resampleImage as h}from\"./support/imageUtils.js\";import n from\"../tiling/TileInfoView.js\";import c from\"../tiling/TileKey.js\";import u from\"../tiling/TileQueue.js\";import f from\"../tiling/TileStrategy.js\";import p from\"../../layers/LayerView.js\";import d from\"../../layers/RefreshableLayerView.js\";const m=new Set([102113,102100,3857,3785,900913]),y=[0,0];let _=class extends(d(l(o(p)))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}get tileMatrixSet(){const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(e.id!==this.layer.activeLayer.tileMatrixSetId&&(this.layer.activeLayer.tileMatrixSetId=e.id),e):null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume()}attach(){const e=this.tileMatrixSet?.tileInfo;e&&(this._tileInfoView=new n(e),this._fetchQueue=new u({tileInfoView:this._tileInfoView,concurrency:16,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new f({cachePolicy:\"keep\",resampling:!0,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.addAttachHandles(this._updatingHandles.add((()=>[this.layer?.activeLayer?.styleId,this.tileMatrixSet]),(()=>this.doRefresh()))),super.attach())}detach(){super.detach(),this._tileStrategy?.destroy(),this._fetchQueue?.destroy(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.activeLayer.tileMatrixSets?.some((t=>a(t.tileInfo?.spatialReference,e)))??!1}async doRefresh(){if(this.attached){if(this.suspended)return this._tileStrategy.clear(),void this.requestUpdate();this._fetchQueue.reset(),this._tileStrategy.refresh((e=>this._updatingHandles.addPromise(this._enqueueTileFetch(e))))}}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(y,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,t={}){const s=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,{signal:r,resamplingLevel:a=0}=t;if(!s)return this._fetchImage(e,r);const l=new c(0,0,0,0);let o;try{await s.fetchAvailabilityUpsample(e.level,e.row,e.col,l,{signal:r}),o=await this._fetchImage(l,r)}catch(n){if(i(n))throw n;if(a<3){const i=this._tileInfoView.getTileParentId(e.id);if(i){const s=new c(i),r=await this.fetchTile(s,{...t,resamplingLevel:a+1});return h(this._tileInfoView,r,s,e)}}throw n}return h(this._tileInfoView,o,l,e)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(s){i(s)||t.getLogger(this).error(s)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchImageBitmapTile(e.level,e.row,e.col,{signal:t})}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>a(e.tileInfo?.spatialReference,t)));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>m.has(e.tileInfo?.spatialReference.wkid??-1)))),i}};e([s({readOnly:!0})],_.prototype,\"tileMatrixSet\",null),_=e([r(\"esri.views.2d.layers.WMTSLayerView2D\")],_);const w=_;export{w as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/reactiveUtils.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import\"../../core/Error.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";const i=i=>{let a=class extends i{initialize(){this.addHandles(o((()=>this.layer),\"refresh\",(r=>{this.doRefresh(r.dataChanged).catch((r=>{s(r)||e.getLogger(this).error(r)}))})),\"RefreshableLayerView\")}};return a=r([t(\"esri.views.layers.RefreshableLayerView\")],a),a};export{i as default};\n"],"names":["n","e","r","key","level","row","col","i","_r","_inherits","_super","_createSuper","_this","_classCallCheck","call","_tileInfoView","_createClass","value","this","sortChildren","setStencilReference","_get","_getPrototypeOf","prototype","state","s","requiredLevel","getClosestInfoForScale","scale","displayLevel","tileInfo","scaleToZoom","_this2","push","registerRenderPass","name","brushes","drawPhase","target","getStencilTarget","has","t","children","_step","_iterator","_createForOfIteratorHelper","done","stencilRef","err","f","m","Set","y","_","_d","apply","arguments","_tileStrategy","_fetchQueue","layer","get","_getTileMatrixSetBySpatialReference","activeLayer","id","tileMatrixSetId","pause","update","resume","_this$tileMatrixSet","tileMatrixSet","u","tileInfoView","concurrency","process","fetchTile","cachePolicy","resampling","acquireTile","releaseTile","addAttachHandles","_updatingHandles","add","_this2$layer","_this2$layer$activeLa","styleId","doRefresh","_this$_tileStrategy","_this$_fetchQueue","destroy","requestUpdate","_this$layer$activeLay","_this$layer$activeLay2","tileMatrixSets","some","_t$tileInfo","a","spatialReference","_doRefresh","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this3","wrap","_context","prev","next","attached","suspended","abrupt","clear","reset","refresh","addPromise","_enqueueTileFetch","stop","_this$_tileInfoView$g","_this$_tileInfoView$g2","_this$_tileInfoView$t","_bitmapView","createTile","bitmap","getTileCoords","_slicedToArray","x","resolution","getTileResolution","size","width","height","addChild","abort","removeChild","once","_fetchTile","_callee2","_t$resamplingLevel","l","o","_i","_s","_args2","_context2","length","undefined","tilemapCache","signal","resamplingLevel","_fetchImage","c","fetchAvailabilityUpsample","sent","t0","getTileParentId","_objectSpread","h","_x","_enqueueTileFetch2","_callee3","_t","_this4","_context3","source","error","_x2","_fetchImage2","_callee4","_context4","fetchImageBitmapTile","_x3","_x4","view","find","_e$tileInfo","isWebMercator","_e$tileInfo$spatialRe","_e$tileInfo2","wkid","d","p","readOnly","w","addHandles","dataChanged","catch"],"sourceRoot":""}