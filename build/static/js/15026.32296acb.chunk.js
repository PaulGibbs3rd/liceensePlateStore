"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[15026],{8623:function(e,t,r){r.d(t,{Z:function(){return h}});var n=r(43144),a=r(15671),s=r(60136),u=r(29388),i=r(27366),o=r(11582),c=r(46784),l=r(49861),p=(r(93169),r(32718),r(84936),r(27135)),d=r(69912),f=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).type="georeferenced",n.origin=null,n}return(0,n.Z)(r)}((0,o.J)(c.wq));(0,i._)([(0,p.J)({georeferenced:"georeferenced"},{readOnly:!0})],f.prototype,"type",void 0),(0,i._)([(0,l.Cb)({type:[Number],nonNullable:!1,json:{write:!0}})],f.prototype,"origin",void 0);var h=f=(0,i._)([(0,d.j)("esri.geometry.support.MeshGeoreferencedVertexSpace")],f)},50250:function(e,t,r){r.d(t,{Z:function(){return y}});var n=r(43144),a=r(15671),s=r(60136),u=r(29388),i=r(27366),o=r(11582),c=r(46784),l=r(49861),p=(r(93169),r(32718),r(84936),r(27135)),d=r(69912),f=r(12400),h=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).type="local",n.origin=(0,f.Ue)(),n}return(0,n.Z)(r)}((0,o.J)(c.wq));(0,i._)([(0,p.J)({local:"local"},{readOnly:!0})],h.prototype,"type",void 0),(0,i._)([(0,l.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],h.prototype,"origin",void 0);var y=h=(0,i._)([(0,d.j)("esri.geometry.support.MeshLocalVertexSpace")],h)},17493:function(e,t,r){r.d(t,{CP:function(){return f},JG:function(){return x},LL:function(){return h},NZ:function(){return y},fV:function(){return b},vj:function(){return S},yT:function(){return q},zE:function(){return w}});var n=r(93433),a=r(74165),s=r(15861),u=r(37762),i=r(15671),o=r(43144),c=r(76200),l=r(63780),p=r(66978),d=r(18277),f=function(){function e(t,r,n){(0,i.Z)(this,e),this.assetName=t,this.assetMimeType=r,this.parts=n}return(0,o.Z)(e,[{key:"equals",value:function(e){return this===e||this.assetName===e.assetName&&this.assetMimeType===e.assetMimeType&&(0,l.fS)(this.parts,e.parts,(function(e,t){return e.equals(t)}))}},{key:"isOnService",value:function(e){return this.parts.every((function(t){return t.isOnService(e)}))}},{key:"makeHash",value:function(){var e,t="",r=(0,u.Z)(this.parts);try{for(r.s();!(e=r.n()).done;){t+=e.value.partHash}}catch(n){r.e(n)}finally{r.f()}return t}},{key:"toBlob",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==(r=this.parts).length){e.next=3;break}return e.abrupt("return",r[0].toBlob(t));case 3:return e.next=5,Promise.all(r.map((function(e){return e.toBlob(t)})));case 5:return n=e.sent,e.abrupt("return",((0,p.k_)(t),new Blob(n)));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),h=function(){function e(t,r){(0,i.Z)(this,e),this.partUrl=t,this.partHash=r}return(0,o.Z)(e,[{key:"equals",value:function(e){return this===e||this.partUrl===e.partUrl&&this.partHash===e.partHash}},{key:"isOnService",value:function(e){return this.partUrl.startsWith("".concat(e.path,"/assets/"))}},{key:"toBlob",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.Z)(this.partUrl,{responseType:"blob"});case 2:return r=e.sent,n=r.data,e.abrupt("return",((0,p.k_)(t),n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function y(e){return function(e){if(!e)return!1;if(Array.isArray(e))return e.some(Z);return Z(e)}(null===e||void 0===e?void 0:e.source)}function v(e){return!!Array.isArray(e)&&e.every((function(e){return e instanceof f}))}var m=/^(model\/gltf\+json)|(model\/gltf-binary)$/,g=/\.(gltf|glb)/i;function Z(e){if(e instanceof File){var t=e.type,r=e.name;return m.test(t)||g.test(r)}return m.test(e.assetMimeType)||g.test(e.assetName)}function x(e,t){return!!e&&function(e,t){if(Array.isArray(e)){var r=e;return r.length>0&&r.every((function(e){return k(e,t)}))}return k(e,t)}(e.source,t)}function b(e,t){if(e===t)return!0;var r=e.source,a=t.source;if(r===a)return!0;if(v(r)&&v(a)){if(r.length!==a.length)return!1;for(var s=function(e,t){return e.assetName<t.assetName?-1:e.assetName>t.assetName?1:0},u=(0,n.Z)(r).sort(s),i=(0,n.Z)(a).sort(s),o=0;o<u.length;++o)if(!u[o].equals(i[o]))return!1;return!0}return!1}function k(e,t){return e instanceof f&&e.isOnService(t)}function S(e,t){var r;return e instanceof File?(0,d.dm)(e,t):null!==(r=(0,d.S0)(e.assetMimeType,t))&&void 0!==r?r:(0,d.Ow)(e.assetName,t)}function w(e){return Array.isArray(e)?e:[e]}function q(e){return!!e.original}},69048:function(e,t,r){r.d(t,{G7:function(){return y},QK:function(){return f},rU:function(){return h},vI:function(){return v},z1:function(){return p},zZ:function(){return d}});var n=r(29439),a=r(44927),s=r(32718),u=r(32035),i=r(848),o=r(8623),c=r(50250);function l(){return s.Z.getLogger("esri.geometry.Mesh")}function p(e){return!d(e)}function d(e){return null!=e.origin}function f(e){return d(e.vertexSpace)}function h(e,t){if(!d(e))return null;var r=(0,n.Z)(e.origin,3),a=r[0],s=r[1],u=r[2];return new i.Z({x:a,y:s,z:u,spatialReference:t})}function y(e,t){var r,n,s,u=e.x,i=e.y,p=e.z,d=e.spatialReference,f=[u,i,null!==p&&void 0!==p?p:0];return void 0!==(null===t||void 0===t?void 0:t.geographic)&&((0,a.x9)(l(),"option: geographic",{replacement:"Use the `vertexSpace` option instead.",version:"4.29",warnOnce:!0}),t.vertexSpace&&l().warn("Deprecated geographic flag ignored since vertexSpace option is provided.")),"local"===(null!==(r=null!==(n=null===t||void 0===t?void 0:t.vertexSpace)&&void 0!==n?n:null==(s=null===t||void 0===t?void 0:t.geographic)?void 0:s?"local":"georeferenced")&&void 0!==r?r:function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(d))?new c.Z({origin:f}):new o.Z({origin:f})}function v(e,t){return e.type===t.type&&(e.origin===t.origin||null!=e.origin&&null!=t.origin&&(0,u.e)(e.origin,t.origin))}},60480:function(e,t,r){r.d(t,{g:function(){return n}});var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},15026:function(e,t,r){r.r(t),r.d(t,{default:function(){return V}});var n=r(29439),a=r(37762),s=r(1413),u=r(74165),i=r(15861),o=r(15671),c=r(43144),l=r(60136),p=r(29388),d=r(27366),f=r(42265),h=(r(59486),r(76200)),y=r(62044),v=r(63780),m=r(10064),g=r(93169),Z=r(43404),x=r(54472),b=r(32718),k=r(18202),S=r(66978),w=r(94172),q=r(35995),O=r(71907),_=r(49861),A=r(69912),E=r(53866),R=r(8623),F=r(69048),I=r(17493),C=r(91836),T=r(63543),M=r(89623),N=r(25899),U=r(62594),D=r(18277),J=r(77946),Q=r(62204),P=r(21149),L=r(54789),j=r(78952),G=new Z.X({originalAndCurrentFeatures:"original-and-current-features",none:"none"}),H=new Z.X({Started:"published",Publishing:"publishing",Stopped:"unavailable"}),B=function(e){(0,l.Z)(d,e);var t=(0,p.Z)(d);function d(e){var r;return(0,o.Z)(this,d),(r=t.call(this,e)).type="feature-layer",r.supportedSourceTypes=new Set(["Feature Layer","Oriented Imagery Layer","Table","Catalog Layer"]),r.refresh=(0,S.Ds)((0,i.Z)((0,u.Z)().mark((function e(){var t,n,a,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.load();case 2:if(null!=(a=null===(t=r.sourceJSON.editingInfo)||void 0===t?void 0:t.lastEditDate)){e.next=5;break}return e.abrupt("return",{dataChanged:!0,updates:{}});case 5:return e.prev=5,e.next=8,r._fetchService(null);case 8:e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(5),e.abrupt("return",{dataChanged:!0,updates:{}});case 13:return s=a!==(null===(n=r.sourceJSON.editingInfo)||void 0===n?void 0:n.lastEditDate),e.abrupt("return",{dataChanged:s,updates:s?{editingInfo:r.sourceJSON.editingInfo,extent:r.sourceJSON.extent}:null});case 15:case"end":return e.stop()}}),e,null,[[5,10]])})))),r._ongoingAssetUploads=new Map,r}return(0,c.Z)(d,[{key:"load",value:function(e){var t=this,r=this.layer.sourceJSON,n=this._fetchService(r,(0,s.Z)({},e)).then((function(){return t.layer.setUserPrivileges(t.sourceJSON.serviceItemId,e)})).then((function(){return t._ensureLatestMetadata(e)}));return this.addResolvingPromise(n),Promise.resolve(this)}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,w.watch)((function(){var t=e.layer;return t&&"lastEditsEventDate"in t?t.lastEditsEventDate:null}),(function(t){return e._handleLastEditsEventChange(t)}))])}},{key:"destroy",value:function(){this._removeEditInterceptor()}},{key:"queryTask",get:function(){var e,t,r=this.layer,n=r.capabilities,a=r.parsedUrl,s=r.gdbVersion,u=r.spatialReference,i=r.fieldsIndex,o="infoFor3D"in this.layer?this.layer.infoFor3D:null,c="dynamicDataSource"in this.layer?this.layer.dynamicDataSource:null,l=(0,g.Z)("featurelayer-pbf")&&(null===n||void 0===n?void 0:n.query.supportsFormatPBF)&&null==o,p=null!==(e=null===n||void 0===n||null===(t=n.operations)||void 0===t?void 0:t.supportsQueryAttachments)&&void 0!==e&&e;return new M.Z({url:a.path,pbfSupported:l,fieldsIndex:i,infoFor3D:o,dynamicDataSource:c,gdbVersion:s,sourceSpatialReference:u,queryAttachmentsSupported:p})}},{key:"addAttachment",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){var n,a,s,i,o,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=this.layer,e.next=5,(0,U.nU)(n,"editing");case 5:return a=t.attributes[n.objectIdField],s=n.parsedUrl.path+"/"+a+"/addAttachment",i=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(r,i.query),e.prev=6,e.next=9,(0,h.Z)(s,{body:o});case 9:return c=e.sent,e.abrupt("return",(0,C.Q7)(c.data.addAttachmentResult));case 13:throw e.prev=13,e.t0=e.catch(6),this._createAttachmentErrorResult(a,e.t0);case 16:case"end":return e.stop()}}),e,this,[[6,13]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateAttachment",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r,n){var a,s,i,o,c,l;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return a=this.layer,e.next=5,(0,U.nU)(a,"editing");case 5:return s=t.attributes[a.objectIdField],i=a.parsedUrl.path+"/"+s+"/updateAttachment",o=this._getLayerRequestOptions({query:{attachmentId:r}}),c=this._getFormDataForAttachment(n,o.query),e.prev=6,e.next=9,(0,h.Z)(i,{body:c});case 9:return l=e.sent,e.abrupt("return",(0,C.Q7)(l.data.updateAttachmentResult));case 13:throw e.prev=13,e.t0=e.catch(6),this._createAttachmentErrorResult(s,e.t0);case 16:case"end":return e.stop()}}),e,this,[[6,13]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"applyEdits",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){var n,a,s,i,o,c,l,p,d,f,y,g,Z,x,b,k,S,w,q,O,_,A,E,R=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return c=this.layer,e.next=5,(0,U.nU)(c,"editing");case 5:if(l="infoFor3D"in c?c.infoFor3D:null,d=(p=null!=l)||null!==(n=null===r||void 0===r?void 0:r.globalIdUsed)&&void 0!==n&&n,!p){e.next=14;break}return e.next=11,this._uploadMeshesAndGetAssetMapEditsJSON(t);case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=null;case 15:return f=e.t0,y=null!==(a=null===(s=t.addFeatures)||void 0===s?void 0:s.map((function(e){return(0,C.mh)(R.layer,e,l)})))&&void 0!==a?a:[],e.next=19,Promise.all(y);case 19:return g=e.sent.filter(v.pC),Z=null!==(i=null===(o=t.updateFeatures)||void 0===o?void 0:o.map((function(e){return(0,C.mh)(R.layer,e,l)})))&&void 0!==i?i:[],e.next=23,Promise.all(Z);case 23:return x=e.sent.filter(v.pC),b=(0,C.CJ)(this.layer,t.deleteFeatures,d),(0,Q.P)(g,x,c.spatialReference),e.next=28,(0,C.hw)(this.layer,t);case 28:return k=e.sent,S=c.capabilities.editing.supportsAsyncApplyEdits&&p,w=(null===r||void 0===r?void 0:r.gdbVersion)||c.gdbVersion,q={gdbVersion:w,rollbackOnFailure:null===r||void 0===r?void 0:r.rollbackOnFailureEnabled,useGlobalIds:d,returnEditMoment:null===r||void 0===r?void 0:r.returnEditMoment,usePreviousEditMoment:null===r||void 0===r?void 0:r.usePreviousEditMoment,async:S},e.next=34,(0,L.Px)(this.layer.url,w,!0);case 34:return O=(0,L.JV)(this.layer.url,w||null),e.next=37,(0,L.r9)(c.url,w,c.historicMoment);case 37:if(!e.sent){e.next=39;break}throw new m.Z("feature-layer-source:historic-version","Editing a historic version is not allowed");case 39:if(null!==r&&void 0!==r&&r.returnServiceEditsOption?(q.edits=JSON.stringify([{id:c.layerId,adds:g.length?g:null,updates:x.length?x:null,deletes:b.length?b:null,attachments:k,assetMaps:f}]),q.returnServiceEditsOption=G.toJSON(null===r||void 0===r?void 0:r.returnServiceEditsOption),q.returnServiceEditsInSourceSR=null===r||void 0===r?void 0:r.returnServiceEditsInSourceSR):(q.adds=g.length?JSON.stringify(g):null,q.updates=x.length?JSON.stringify(x):null,q.deletes=b.length?d?JSON.stringify(b):b.join(","):null,q.attachments=k&&JSON.stringify(k),q.assetMaps=null!=f?JSON.stringify(f):void 0),_=this._getLayerRequestOptions({method:"post",query:q}),O&&(_.authMode="immediate",_.query.returnEditMoment=!0,_.query.sessionId=L.U8),A=null!==r&&void 0!==r&&r.returnServiceEditsOption?c.url:c.parsedUrl.path,e.prev=43,!S){e.next=50;break}return e.next=47,this._asyncApplyEdits(A+"/applyEdits",_);case 47:e.t1=e.sent,e.next=53;break;case 50:return e.next=52,(0,h.Z)(A+"/applyEdits",_);case 52:e.t1=e.sent;case 53:E=e.t1,e.next=71;break;case 56:if(e.prev=56,e.t2=e.catch(43),(0,C.JK)(e.t2)){e.next=60;break}throw e.t2;case 60:if(_.authMode="immediate",!S){e.next=67;break}return e.next=64,this._asyncApplyEdits(A+"/applyEdits",_);case 64:e.t3=e.sent,e.next=70;break;case 67:return e.next=69,(0,h.Z)(A+"/applyEdits",_);case 69:e.t3=e.sent;case 70:E=e.t3;case 71:return e.abrupt("return",this._createEditsResult(E));case 72:case"end":return e.stop()}}),e,this,[[43,56]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteAttachments",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){var n,a,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=this.layer,e.next=5,(0,U.nU)(n,"editing");case 5:return a=t.attributes[n.objectIdField],s=n.parsedUrl.path+"/"+a+"/deleteAttachments",e.prev=6,e.next=9,(0,h.Z)(s,this._getLayerRequestOptions({query:{attachmentIds:r.join(",")},method:"post"}));case 9:return e.abrupt("return",e.sent.data.deleteAttachmentResults.map(C.Q7));case 12:throw e.prev=12,e.t0=e.catch(6),this._createAttachmentErrorResult(a,e.t0);case 15:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchRecomputedExtents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.signal;return this.load({signal:r}).then((0,i.Z)((0,u.Z)().mark((function r(){var n,a,i,o,c,l,p,d,f,v,m;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e._getLayerRequestOptions((0,s.Z)((0,s.Z)({},t),{},{query:{returnUpdates:!0}})),a=e.layer,i=a.layerId,o=a.url,r.next=6,(0,h.Z)("".concat(o,"/").concat(i),n);case 6:return c=r.sent,l=c.data,p=l.id,d=l.extent,f=l.fullExtent,v=l.timeExtent,m=d||f,r.abrupt("return",{id:p,fullExtent:m&&E.Z.fromJSON(m),timeExtent:v&&y.Z.fromJSON({start:v[0],end:v[1]})});case 14:case"end":return r.stop()}}),r)}))))}},{key:"queryAttachments",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t){var r,n,a=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.load();case 3:return n=this._getLayerRequestOptions(r),e.abrupt("return",this.queryTask.executeAttachmentQuery(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){var n,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.next=4,this.queryTask.execute(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)}));case 4:return a=e.sent,e.abrupt("return",(null!==(n=t.outStatistics)&&void 0!==n&&n.length&&a.features.length&&a.features.forEach((function(e){var r,n=e.attributes;null===(r=t.outStatistics)||void 0===r||r.forEach((function(e){var t=e.outStatisticFieldName;if(t){var r=t.toLowerCase();r&&r in n&&t!==r&&(n[t]=n[r],delete n[r])}}))})),a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeJSON(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForIds(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForCount(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForExtent(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryRelatedFeatures",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQuery(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryRelatedFeaturesCount",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQueryForCount(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopFeatures",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeTopFeaturesQuery(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopObjectIds",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopIds(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopExtents",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopExtents(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopCount",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopCount(t,(0,s.Z)((0,s.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchPublishingStatus",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(){var t,r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,N.M8)(this.layer.url)){e.next=2;break}return e.abrupt("return","unavailable");case 2:return t=(0,q.v_)(this.layer.url,"status"),e.next=5,(0,h.Z)(t,{query:{f:"json"}});case 5:return r=e.sent,e.abrupt("return",H.fromJSON(r.data.status));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"uploadAssets",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,n){var a,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(25532).then(r.bind(r,25532));case 2:return a=e.sent,s=a.uploadAssets,e.abrupt("return",s(t,{layer:this.layer,ongoingUploads:this._ongoingAssetUploads},n));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_handleLastEditsEventChange",value:function(e){var t,r,n,a,s=this.layer;if(null!=e&&"capabilities"in s&&"effectiveCapabilities"in s&&!(null!==(t=s.capabilities)&&void 0!==t&&null!==(r=t.operations)&&void 0!==r&&r.supportsEditing||null===(n=s.effectiveCapabilities)||void 0===n||null===(a=n.operations)||void 0===a)&&a.supportsEditing){var u=s.url;null!=u&&("layerId"in s&&(0,q.v_)(u,s.layerId.toString()),this._getOrCreateEditInterceptor(u).before=function(t){var r,n=null!==(r=t.requestOptions.method)&&void 0!==r?r:"auto";if("auto"===n||"head"===n){var a,s=null!==(a=t.requestOptions.query)&&void 0!==a?a:{};s._ts=e.getTime(),t.requestOptions.query=s}})}}},{key:"_getOrCreateEditInterceptor",value:function(e){return null==this._editInterceptor&&(this._editInterceptor={urls:e},f.Z.request.internalInterceptors.push(this._editInterceptor)),this._editInterceptor}},{key:"_removeEditInterceptor",value:function(){null!=this._editInterceptor&&((0,v.Od)(f.Z.request.internalInterceptors,this._editInterceptor),this._editInterceptor=null)}},{key:"_asyncApplyEdits",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){var n,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.Z)(t,r);case 2:n=e.sent.data.statusUrl;case 3:return e.next=5,(0,h.Z)(n,{query:{f:"json"},responseType:"json"});case 5:a=e.sent.data,e.t0=a.status,e.next="Completed"===e.t0?9:"CompletedWithErrors"===e.t0?10:"Failed ImportChanges"===e.t0||"InProgress"===e.t0||"Pending"===e.t0||"ExportAttachments"===e.t0||"ExportChanges"===e.t0||"ExportingData"===e.t0||"ExportingSnapshot"===e.t0||"ImportAttachments"===e.t0||"ProvisioningReplica"===e.t0||"UnRegisteringReplica"===e.t0?11:12;break;case 9:return e.abrupt("return",(0,h.Z)(a.resultUrl,{query:{f:"json"},responseType:"json"}));case 10:throw new m.Z("async-applyEdits-failed","asynchronous applyEdits call failed.");case 11:return e.abrupt("break",13);case 12:throw new m.Z("async-applyEdits-failed","asynchronous applyEdits call failed (undefined response status)");case 13:return e.next=15,(0,S.e4)(z);case 15:e.next=3;break;case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createRequestQueryOptions",value:function(e){var t=(0,s.Z)((0,s.Z)({},this.layer.customParameters),{},{token:this.layer.apiKey},null===e||void 0===e?void 0:e.query);return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}},{key:"_fetchService",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){var n,a,s,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=8;break}return n={},(0,g.Z)("featurelayer-advanced-symbols")&&(n.returnAdvancedSymbols=!0),(null===r||void 0===r?void 0:r.cacheBust)&&(n._ts=Date.now()),e.next=5,(0,h.Z)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:n,signal:null===r||void 0===r?void 0:r.signal}));case 5:a=e.sent,s=a.data,t=s;case 8:return e.next=10,this._patchServiceJSON(t,null===r||void 0===r?void 0:r.signal);case 10:if(this.sourceJSON=e.sent,i=t.type,this.supportedSourceTypes.has(i)){e.next=14;break}throw new m.Z("feature-layer-source:unsupported-type",'Source type "'.concat(i,'" is not supported'));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_patchServiceJSON",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t,r){var n,a,s,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Table"===t.type||!t.geometryType||null!==t&&void 0!==t&&null!==(n=t.drawingInfo)&&void 0!==n&&n.renderer||t.defaultSymbol||(a=(0,T.bU)(t.geometryType).renderer,(0,k.RB)("drawingInfo.renderer",a,t)),"esriGeometryMultiPatch"===t.geometryType&&t.infoFor3D&&(t.geometryType="mesh"),null!=t.extent){e.next=13;break}return e.prev=2,e.next=5,(0,h.Z)(this.layer.url,this._getLayerRequestOptions({signal:r}));case 5:s=e.sent,(i=s.data).spatialReference&&(t.extent={xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:i.spatialReference}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),(0,S.r9)(e.t0);case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_ensureLatestMetadata",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.layer.userHasUpdateItemPrivileges&&this.sourceJSON.cacheMaxAge>0)){e.next=2;break}return e.abrupt("return",this._fetchService(null,(0,s.Z)((0,s.Z)({},t),{},{cacheBust:!0})));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_uploadMeshesAndGetAssetMapEditsJSON",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t){var s,i,o,c,l,p,d,f,h,y,v,g,Z,x,b,k,S,w;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(s=t.addAssetFeatures)&&void 0!==s&&s.length){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this._areAllAssetsAlreadyMapped(s);case 5:if(!e.sent){e.next=7;break}return e.abrupt("return",null);case 7:if(i=t.addFeatures.filter((function(e){return e.geometry})),s.length===i.length+t.updateFeatures.length){e.next=10;break}throw new m.Z("feature-layer-source:unsupported-mesh-edits","Mixing attribute only edits with mesh geometry edits is not currently supported");case 10:o=new Array,c=new Map,l=(0,a.Z)(s),e.prev=12,l.s();case 14:if((p=l.n()).done){e.next=32;break}if(d=p.value,f=d.geometry,h=f.vertexSpace,!(0,F.zZ)(h)){e.next=21;break}o.push(f),e.next=30;break;case 21:return v=f.anchor,e.next=24,Promise.all([r.e(25158),r.e(54341),r.e(2321)]).then(r.bind(r,11837));case 24:return g=e.sent,Z=g.convertMeshVertexSpace,e.next=28,Z(f,new R.Z({origin:[v.x,v.y,null!==(y=v.z)&&void 0!==y?y:0]}));case 28:x=e.sent,c.set(x,f),d.geometry=x,o.push(x);case 30:e.next=14;break;case 32:e.next=37;break;case 34:e.prev=34,e.t0=e.catch(12),l.e(e.t0);case 37:return e.prev=37,l.f(),e.finish(37);case 40:return e.next=42,this.uploadAssets(o);case 42:b=(0,a.Z)(c);try{for(b.s();!(k=b.n()).done;)S=(0,n.Z)(k.value,2),w=S[0],S[1].addExternalSources(w.metadata.externalSources.items)}catch(u){b.e(u)}finally{b.f()}return e.abrupt("return",{adds:this._getAssetMapEditsJSON(s),updates:[],deletes:[]});case 45:case"end":return e.stop()}}),e,this,[[12,34,37,40]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_getAssetMapEditsJSON",value:function(e){var t,r=new Array,n=this.layer.globalIdField,s=this.layer.parsedUrl,u=(0,a.Z)(e);try{for(u.s();!(t=u.n()).done;){var i,o=t.value,c=o.geometry.metadata.getExternalSourcesOnService(s),l=o.getAttribute(n);if(0!==c.length){var p,d=(null!==(i=c.find(I.yT))&&void 0!==i?i:c[0]).source,f=(0,a.Z)(d);try{for(f.s();!(p=f.n()).done;){var h=p.value;1===h.parts.length?r.push({globalId:(0,O.zS)(),parentGlobalId:l,assetName:h.assetName,assetHash:h.parts[0].partHash,flags:[]}):b.Z.getLogger(this).error("Skipping asset ".concat(h.assetName,". It does not have exactly one part, so we cannot map it to a feature."))}}catch(y){f.e(y)}finally{f.f()}}else b.Z.getLogger(this).error("Skipping feature ".concat(l,". The mesh it is associated with has not been uploaded to the service and cannot be mapped to it."))}}catch(y){u.e(y)}finally{u.f()}return r}},{key:"_createEditsResult",value:function(e){var t=e.data,r=this.layer.layerId,n=[],s=null;if(Array.isArray(t)){var u,i=(0,a.Z)(t);try{for(i.s();!(u=i.n()).done;){var o,c,l,p=u.value;n.push({id:p.id,editedFeatures:p.editedFeatures}),p.id===r&&(s={addResults:null!==(o=p.addResults)&&void 0!==o?o:[],updateResults:null!==(c=p.updateResults)&&void 0!==c?c:[],deleteResults:null!==(l=p.deleteResults)&&void 0!==l?l:[],attachments:p.attachments,editMoment:p.editMoment})}}catch(g){i.e(g)}finally{i.f()}}else s=t;var d=(0,C.RZ)(s);if(n.length>0){d.editedFeatureResults=[];var f,h=(0,a.Z)(n);try{for(h.s();!(f=h.n()).done;){var y=f.value,v=y.editedFeatures,m=null!==v&&void 0!==v&&v.spatialReference?new j.Z(v.spatialReference):null;d.editedFeatureResults.push({layerId:y.id,editedFeatures:(0,C.JX)(v,m)})}}catch(g){h.e(g)}finally{h.f()}}return d}},{key:"_createAttachmentErrorResult",value:function(e,t){var r,n=(null===(r=t.details.messages)||void 0===r?void 0:r[0])||t.message,a=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new m.Z("feature-layer-source:attachment-failure",n,{code:a})}}},{key:"_getFormDataForAttachment",value:function(e,t){var r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(var n in t){var a=t[n];null!=a&&(r.set?r.set(n,a):r.append(n,a))}return r}},{key:"_getLayerRequestOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.layer,r=this.layer,n=r.parsedUrl,a=r.gdbVersion;return(0,s.Z)((0,s.Z)({},e),{},{query:(0,s.Z)((0,s.Z)({gdbVersion:a,layer:"dynamicDataSource"in t&&t.dynamicDataSource?JSON.stringify({source:t.dynamicDataSource}):void 0},n.query),{},{f:"json"},this._createRequestQueryOptions(e)),responseType:"json"})}},{key:"_areAllAssetsAlreadyMapped",value:function(){var e=(0,i.Z)((0,u.Z)().mark((function e(t){var r,n,s,i,o,c,l,p,d,f,h,y,m,g,Z,x,b;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layer,n=r.globalIdField,s=r.parsedUrl,null!=(i="infoFor3D"in r?r.infoFor3D:null)&&null!=n){e.next=3;break}return e.abrupt("return",!1);case 3:if(null!=(o=(0,D.$6)(i))){e.next=6;break}return e.abrupt("return",!1);case 6:c=(0,q.v_)(s.path,"../".concat(o.id)),l=new Array,p=(0,a.Z)(t),e.prev=8,p.s();case 10:if((d=p.n()).done){e.next=17;break}if((f=d.value).geometry.metadata.getExternalSourcesOnService(s).length>0){e.next=14;break}return e.abrupt("return",!1);case 14:l.push(f);case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),p.e(e.t0);case 22:return e.prev=22,p.f(),e.finish(22);case 25:if(h=l.map((function(e){return e.getAttribute(n)})).filter(v.pC),0!==h.length){e.next=28;break}return e.abrupt("return",!1);case 28:return y=i.assetMapFieldRoles,m=y.parentGlobalId,g=y.assetHash,Z=new P.Z({where:"".concat(m," IN (").concat(h.map((function(e){return"'".concat(e,"'")})),")"),outFields:[g,m],returnGeometry:!1}),e.next=34,(0,J.e)(c,Z);case 34:return x=e.sent,b=x.features,e.abrupt("return",0!==b.length&&!l.some((function(e){var t=e.getAttribute(n);if(!t)return!0;var r=e.geometry.metadata,a=b.filter((function(e){return e.getAttribute(m)===t}));if(0===a.length)return!0;var u=a.map((function(e){return e.getAttribute(g)}));return r.getExternalSourcesOnService(s).flatMap((function(e){return e.source.flatMap((function(e){return e.parts.map((function(e){return e.partHash}))}))})).some((function(e){return u.every((function(t){return e!==t}))}))})));case 37:case"end":return e.stop()}}),e,this,[[8,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()}]),d}(x.Z);(0,d._)([(0,_.Cb)()],B.prototype,"type",void 0),(0,d._)([(0,_.Cb)({constructOnly:!0})],B.prototype,"layer",void 0),(0,d._)([(0,_.Cb)({constructOnly:!0})],B.prototype,"supportedSourceTypes",void 0),(0,d._)([(0,_.Cb)({readOnly:!0})],B.prototype,"queryTask",null),B=(0,d._)([(0,A.j)("esri.layers.graphics.sources.FeatureLayerSource")],B);var z=1e3,V=B},63543:function(e,t,r){r.d(t,{Dm:function(){return d},Hq:function(){return h},MS:function(){return y},bU:function(){return c}});var n=r(4942),a=r(1413),s=r(93169),u=r(84652),i=r(60480),o=r(76115);function c(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.I4:"esriGeometryPolyline"===e?o.ET:o.lF}}}var l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/,p=1;function d(e,t){if((0,s.Z)("esri-csp-restrictions"))return function(){return(0,a.Z)((0,n.Z)({},t,null),e)};try{var r="this".concat(f(t)," = null;");for(var u in e)r+="this".concat(f(u)," = ").concat(JSON.stringify(e[u]),";");var i=new Function("\n      return class AttributesClass$".concat(p++," {\n        constructor() {\n          ").concat(r,";\n        }\n      }\n    "))();return function(){return new i}}catch(o){return function(){return(0,a.Z)((0,n.Z)({},t,null),e)}}}function f(e){return l.test(e)?".".concat(e):'["'.concat(e,'"]')}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,u.d9)(e)}}]}function y(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:i.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);
//# sourceMappingURL=15026.32296acb.chunk.js.map