"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[5954],{86591:function(e,t,r){r.d(t,{Z:function(){return m}});var n,i=r(15671),a=r(43144),s=r(60136),o=r(29388),u=r(27366),l=r(46784),c=r(84652),h=r(49861),f=r(25243),d=r(69912),v=n=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).variableName=null,n.dimensionName=null,n.values=[],n.isSlice=!1,n}return(0,a.Z)(r,[{key:"clone",value:function(){return new n({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,c.d9)(this.values),isSlice:this.isSlice})}}]),r}(l.wq);(0,u._)([(0,h.Cb)({type:String,json:{write:!0}})],v.prototype,"variableName",void 0),(0,u._)([(0,h.Cb)({type:String,json:{write:!0}})],v.prototype,"dimensionName",void 0),(0,u._)([(0,h.Cb)({type:f.V5.array(f.V5.oneOf([f.V5.native(Number),f.V5.array(f.V5.native(Number))])),json:{write:!0}})],v.prototype,"values",void 0),(0,u._)([(0,h.Cb)({type:Boolean,json:{write:!0}})],v.prototype,"isSlice",void 0);var m=v=n=(0,u._)([(0,d.j)("esri.layers.support.DimensionalDefinition")],v)},55635:function(e,t,r){r.d(t,{OE:function(){return d},Gc:function(){return p},Qg:function(){return v},Rq:function(){return c},gX:function(){return m},z2:function(){return h},ET:function(){return f},Vx:function(){return y}});r(59486);var n=r(15671),i=r(43144),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;(0,n.Z)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return(0,i.Z)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.refCount--,i.refCount<=0&&(n.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.ts=Date.now(),i.refCount++,n.delete(r),n.set(r,i),i.block}return null}},{key:"putBlock",value:function(e,t,r,n){var i=this._cachedBlocks,a=e+"/"+t;if(i.has(a)){var s=i.get(a);s.ts=Date.now(),s.refCount++}else i.set(a,{block:r,ts:Date.now(),refCount:1,controller:n});this._trim(),this._updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)}},{key:"updateMaxSize",value:function(e){this._size=e,this._trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this._clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"_updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),n=Date.now(),i=0;i<r.length&&r[i][1].ts<=n-e._duration;i++)t.delete(r[i][0]);0===t.size&&e._clearTimer()}),this._interval)}}},{key:"_trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"_clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),s=r(80394),o=r(848),u=new Map,l=new a;function c(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function h(e,t){var r={extent:null,rasterInfo:t,cache:new Map},n=u.get(e);return n?(n.push(r),n.length-1):(u.set(e,[r]),0)}function f(e,t){var r=u.get(e);r&&(r[t]=null,r.some((function(e){return null!=e}))||u.delete(e))}function d(e,t,r){var n,i=u.get(e);if(!i)return null==t?l.decreaseRefCount(e,r):0;if(null==t||null==i[t])return l.decreaseRefCount(e,r);var a=null===(n=i[t])||void 0===n?void 0:n.cache,s=null===a||void 0===a?void 0:a.get(r);if(a&&s){if(s.refCount--,0===s.refCount){a.delete(r);for(var o=0;o<i.length;o++){var c;null===(c=i[o])||void 0===c||c.cache.delete(r)}s.controller&&s.controller.abort()}return s.refCount}return 0}function v(e,t,r){var n,i=u.get(e);if(!i)return null==t?l.getBlock(e,r):null;if(null==t||null==i[t]){for(var a=0;a<i.length;a++){var s,o=null===(s=i[a])||void 0===s?void 0:s.cache.get(r);if(o)return o.refCount++,o.block}return l.getBlock(e,r)}var c=null===(n=i[t])||void 0===n?void 0:n.cache.get(r);if(c)return c.refCount++,c.block;for(var h=0;h<i.length;h++){var f;if(h!==t&&i[h]){var d=null===(f=i[h])||void 0===f?void 0:f.cache,v=null===d||void 0===d?void 0:d.get(r);if(d&&v)return v.refCount++,d.set(r,v),v.block}}return null}function m(e,t,r,n){var i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=u.get(e);if(s)if(null!=t&&null!=s[t]){var o={refCount:1,block:n,isResolved:!1,isRejected:!1,controller:a};n.then((function(){return o.isResolved=!0})).catch((function(){return o.isRejected=!0})),null===(i=s[t])||void 0===i||i.cache.set(r,o)}else l.putBlock(e,r,n,a);else null==t&&l.putBlock(e,r,n,a)}function p(e,t,r){var n,i=u.get(e);i?null!=t&&null!=i[t]?null===(n=i[t])||void 0===n||n.cache.delete(r):l.deleteBlock(e,r):null==t&&l.deleteBlock(e,r)}function g(e,t){var r,n=u.get(e);return n&&null!==(r=n[t])&&void 0!==r?r:null}function y(e,t,r,n,i,a){var u,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=g(e,t);if(c){var h=c.extent,f=c.cache,d=c.rasterInfo;if(!h||h.xmin!==r.xmin||h.xmax!==r.xmax||h.ymin!==r.ymin||h.ymax!==r.ymax){n=null!==(u=n)&&void 0!==u?u:0;for(var v=r.clone().normalize(),m=d.spatialReference,p=d.transform,y=new Set,_=0;_<v.length;_++){var x=v[_];if(!(x.xmax-x.xmin<=n||x.ymax-x.ymin<=n)){var b=(0,s.tB)(x,m,l);null!=p&&(b=p.inverseTransform(b));var w=new o.Z({x:n,y:n,spatialReference:x.spatialReference});if(null==i&&!(i=(0,s.VO)(w,m,x,l)))return;var T=(0,s.kr)(i,d,a||"closest"),k=T.pyramidLevel,P=T.pyramidResolution,S=T.excessiveReading;if(S)return;for(var C=d.storageInfo,R=C,U=R.origin,I={x:Math.max(0,Math.floor((b.xmin-U.x)/P.x)),y:Math.max(0,Math.floor((U.y-b.ymax)/P.y))},Z=Math.ceil((b.xmax-b.xmin)/P.x-.1),M=Math.ceil((b.ymax-b.ymin)/P.y-.1),F=k>0?C.pyramidBlockWidth:C.blockWidth,z=k>0?C.pyramidBlockHeight:C.blockHeight,V=1,D=Math.max(0,Math.floor(I.x/F)-V),B=Math.max(0,Math.floor(I.y/z)-V),A=Math.floor((I.x+Z-1)/F)+V,O=Math.floor((I.y+M-1)/z)+V,E=B;E<=O;E++)for(var L=D;L<=A;L++)y.add("".concat(k,"/").concat(E,"/").concat(L))}}f.forEach((function(e,t){if(!y.has(t)){var r=f.get(t);(null==r||r.isResolved||r.isRejected)&&f.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}}},21969:function(e,t,r){r.d(t,{MO:function(){return u},N3:function(){return m},Tj:function(){return p},Ur:function(){return l},W2:function(){return v},WU:function(){return g},gk:function(){return x},jj:function(){return y},nb:function(){return d}});var n=r(1413),i=r(93433),a=r(63780),s=r(86591);function o(e,t,r){var n=t.shift();if(0===r.length){r.push({sliceId:-1,multidimensionalDefinition:[]})}for(var a=r.length,s=function(t){var a,s=r.shift().multidimensionalDefinition;null===(a=n.values)||void 0===a||a.forEach((function(t){r.push({sliceId:-1,multidimensionalDefinition:[].concat((0,i.Z)(s),[{variableName:e,dimensionName:n.name,values:[t]}])})}))},u=0;u<a;u++)s();t.length&&o(e,t,r)}function u(e,t){var r=[],a=0;return(t?e.variables.filter((function(e){return e.name.toLowerCase()===t.toLowerCase()})):(0,i.Z)(e.variables).sort((function(e,t){return e.name>t.name?1:-1}))).forEach((function(e){var t=[],s=(0,i.Z)(e.dimensions).sort((function(e,t){return e.name>t.name?-1:1}));o(e.name,s,t),t.forEach((function(e){r.push((0,n.Z)((0,n.Z)({},e),{},{sliceId:a++}))}))})),r}function l(e,t,r){var n=e;if(t&&(t=(0,i.Z)(t).sort((function(e,t){return e.dimensionName<t.dimensionName?-1:1}))).forEach((function(e){var t=e.dimensionName,r=e.values,i=e.isSlice;r.length&&(n=n.filter((function(e){var n=e.multidimensionalDefinition.find((function(e){return e.dimensionName===t}));if(null==n)return!1;var a=n.values[0];return"number"==typeof a?"number"==typeof r[0]?r.includes(a):r.some((function(e){return e[0]<=a&&e[1]>=a})):"number"==typeof r[0]?r.some((function(e){return a[0]<=e&&a[1]>=e})):i?r.some((function(e){return e[0]===a[0]&&e[0]===a[1]})):r.some((function(e){return e[0]>=a[0]&&e[0]<=a[1]||e[1]>=a[0]&&e[1]<=a[1]||e[0]<a[0]&&e[1]>a[1]}))})))})),n.length&&null!=(null===r||void 0===r?void 0:r.start)&&null!=r.end){var a=r.start.getTime(),s=r.end.getTime(),o=n[0].multidimensionalDefinition.findIndex((function(e){return"StdTime"===e.dimensionName}));o>-1&&(n=n.filter((function(e){var t=e.multidimensionalDefinition[o].values[0];return a<=t&&s>=t})))}return n.map((function(e){return e.sliceId}))}function c(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function h(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function f(e,t,r){var a,s;if(null===t||void 0===t||null===(a=t.subsetDefinitions)||void 0===a||!a.length)return e;if(r){var o,u=t.variables;if(u.length&&!u.includes(r))return null;var l=t.subsetDefinitions.find((function(t){return t.dimensionName===e.name&&t.variableName===r}));if(null===l||void 0===l||null===(o=l.values)||void 0===o||!o.length)return e;s=h(l.values)}else{var f=t.dimensions.find((function(t){return t.name===e.name}));s=null===f||void 0===f?void 0:f.extent}var d=s;if(null===d||void 0===d||!d.length)return e;var v=e.values.filter((function(e){return c(e,d)}));return(0,n.Z)((0,n.Z)({},e),{},{extent:(0,i.Z)(d),values:v})}function d(e,t,r){var n;if(null===t||void 0===t||null===(n=t.subsetDefinitions)||void 0===n||!n.length)return!1;var i=t.variables;if(i.length&&e.some((function(e){var t=e.variableName;return t&&!i.includes(t)})))return!0;for(var a=function(n){var i=e[n],a=t.subsetDefinitions.find((function(e){return(""===i.variableName||e.variableName===i.variableName)&&e.dimensionName===i.dimensionName}));if(null!==a&&void 0!==a&&a.values.length){var s=h(a.values);if(i.isSlice||2!==i.values.length||Array.isArray(i.values[0])||i.values[0]===i.values[1]||!r){if(i.values.some((function(e){return!c(e,s)})))return{v:!0}}else if(!function(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}(i.values,s))return{v:!0}}},s=0;s<e.length;s++){var o=a(s);if("object"===typeof o)return o.v}return!1}function v(e,t){if(null==e)return{isOutside:!1};var r=t.geometry,n=t.timeExtent,i=t.multidimensionalDefinition,a=null;if(null!=n&&(a=function(e,t){var r,n,i=e.dimensions.find((function(e){return"StdTime"===e.name}));if(null==i||null==t.start&&null==t.end)return t;var a=(t=t.clone()).toJSON(),o=a.start,u=a.end,l=o===u?[o]:null!=o&&null!=u?[o,u]:[null!==o&&void 0!==o?o:u];return 2===l.length&&null!==i&&void 0!==i&&i.extent.length&&(l[0]=Math.max(l[0],i.extent[0]),l[1]=Math.min(l[1],null!==(r=i.extent[1])&&void 0!==r?r:i.extent[0]),l[1]<l[0])||d([new s.Z({variableName:"",dimensionName:"StdTime",isSlice:1===l.length,values:l})],e,!0)?null:(t.start=new Date(l[0]),t.end=new Date(null!==(n=l[1])&&void 0!==n?n:l[0]),t)}(e,n),null==a))return{isOutside:!0};var o=e.areaOfInterest;if(o&&r){var u="point"===r.type?r:"extent"===r.type?r.center:"polygon"===r.type?r.centroid:null;if(u&&!o.contains(u))return{isOutside:!0}}return null!=i&&i.length&&d(i,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:r,timeExtent:a,multidimensionalDefinition:i}}}function m(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.multidimensionalInfo,s=e.keyProperties;if(null==a)return null;var o=i.variableName,u=i.multidimensionalSubset,l=i.multidimensionalDefinition,c=null!=l?null===(t=l[0])||void 0===t?void 0:t.variableName:null,h=o||c||(null===s||void 0===s?void 0:s.DefaultVariable),f=a.variables;return(null===u||void 0===u||null===(r=u.variables)||void 0===r?void 0:r.length)&&(f=f.filter((function(e){var t=e.name;return u.variables.includes(t)}))),h&&null!==(n=f.find((function(e){return e.name===h})))&&void 0!==n?n:f[0]}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=m(e,t);if(!r)return null;var n=[],i=r.dimensions,a=r.name;if(0===i.length)return[new s.Z({variableName:a,dimensionName:"",values:[],isSlice:!0})];for(var o=0;o<i.length;o++){var u,l=f(i[o],t.multidimensionalSubset,a);if(!l)return null;var c=l.values,h=l.extent,d=null!==(u=null===c||void 0===c?void 0:c[0])&&void 0!==u?u:null===h||void 0===h?void 0:h[0];"stdz"===l.name.toLowerCase()&&!l.hasRanges&&h&&Math.abs(h[1])<=Math.abs(h[0])&&(d=null!==c&&void 0!==c&&c.length?c[c.length-1]:h[1]),n.push(new s.Z({variableName:a,dimensionName:l.name,values:[d],isSlice:!t.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return n}function g(e){return!(null===e||void 0===e||!e.length)&&e.some((function(e){if(null==e.values)return!0;var t=e.values.length;return 0===t||t>1||!e.isSlice&&Array.isArray(e.values[0])}))}function y(e,t){var r;if(null==t||null==e)return null;var i=t.variables.map((function(e){return(0,n.Z)({},e)}));return null!==e&&void 0!==e&&null!==(r=e.variables)&&void 0!==r&&r.length&&(i=i.filter((function(t){var r=t.name;return e.variables.includes(r)}))).forEach((function(t){t.dimensions=t.dimensions.map((function(r){return f(r,e,t.name)})).filter(a.pC)})),i}function _(e){var t,r,n,i=null===(t=e.values)||void 0===t?void 0:t.length;if(i)return i;var a=e.extent,s=e.unit,o=e.interval||1,u=a?a[1]-a[0]:0;if("ISO8601"!==s)return Math.round(u/o);switch(null!==(r=null===(n=e.intervalUnit)||void 0===n?void 0:n.toLowerCase())&&void 0!==r?r:"seconds"){case"seconds":i=Math.round(u/1e3/o);break;case"minutes":i=Math.round(u/6e4/o);break;case"hours":i=Math.round(u/36e5/o);break;case"days":i=Math.round(u/864e5/o);break;case"months":if(a){var l=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),c=new Date(a[0]).getUTCMonth(),h=new Date(a[1]).getUTCMonth();i=0===l?h-c+1:h+11-c+12*(l-1)+1}else i=0;break;case"years":i=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/o):0;break;case"decades":i=a?Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/o):0;break;default:i=0}return i}function x(e,t){for(var r=0,n=e[0].variableName,a=(0,i.Z)(t.variables).sort((function(e,t){return e.name>t.name?1:-1})),s=function(t){var s=a[t],o=(0,i.Z)(s.dimensions).sort((function(e,t){return e.name>t.name?-1:1}));if(s.name!==n)return r+=o.map((function(e){return _(e)})).reduce((function(e,t){return e*t})),"continue";for(var u=o.map((function(e){return _(e)})),l=o.length,c=function(t){var n=e.find((function(e){return e.dimensionName===o[t].name}));if(null==n)return{v:{v:null}};var i=function(e,t){var r,n=t.values;if(null!==n&&void 0!==n&&n.length){var i=Array.isArray(n[0]),a=Array.isArray(e);return i!==a?-1:i&&a?n.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]})):n.indexOf(e)}var s=t.extent;if(Array.isArray(e)||!s||e<s[0]||e>s[1])return-1;var o=t.interval||1;if("ISO8601"!==t.unit)return Math.round((e-s[0])/o);var u=s[0],l=-1;switch((null===(r=t.intervalUnit)||void 0===r?void 0:r.toLowerCase())||"seconds"){case"seconds":l=Math.round((e-u)/1e3/o);break;case"minutes":l=Math.round((e-u)/6e4/o);break;case"hours":l=Math.round((e-u)/36e5/o);break;case"days":l=Math.round((e-u)/864e5/o);break;case"months":var c=new Date(e).getUTCFullYear()-new Date(u).getUTCFullYear(),h=new Date(u).getUTCMonth(),f=new Date(e).getUTCMonth();l=0===c?f-h:f+11-h+12*(c-1);break;case"years":l=Math.round((new Date(e).getUTCFullYear()-new Date(u).getUTCFullYear())/o);break;case"decades":l=Math.round((new Date(e).getUTCFullYear()-new Date(u).getUTCFullYear())/10/o)}return l}(n.values[0],o[t]);if(-1===i)return{v:{v:null}};u.shift(),r+=t===l-1?i:i*u.reduce((function(e,t){return e*t}))},h=0;h<l;h++){var f=c(h);if("object"===typeof f)return f.v}return"break"},o=0;o<a.length;o++){var u=s(o);if("continue"!==u){if("break"===u)break;if("object"===typeof u)return u.v}}return r}},55067:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(37762),i=r(15671),a=r(43144),s=r(88301),o=r(61120),u=r(60136),l=r(29388),c=r(93169),h=r(80613),f=r(86438),d=r(40655),v=r(5086),m=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},p=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this))._tileInfoView=e,n}return(0,a.Z)(r,[{key:"renderChildren",value:function(e){this.sortChildren(m),this.setStencilReference(e),(0,s.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,n=(0,s.Z)((0,o.Z)(r.prototype),"createRenderParams",this).call(this,e);return n.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,n.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),n}},{key:"prepareRenderPasses",value:function(e){var t=this,n=(0,s.Z)((0,o.Z)(r.prototype),"prepareRenderPasses",this).call(this,e);return n.push(e.registerRenderPass({name:"stencil",brushes:[d.Z],drawPhase:h.jx.DEBUG|h.jx.MAP|h.jx.HIGHLIGHT|h.jx.LABEL,target:function(){return t.getStencilTarget()}})),(0,c.Z)("esri-tiles-debug")&&n.push(e.registerRenderPass({name:"tileInfo",brushes:[v.Z],drawPhase:h.jx.DEBUG,target:function(){return t.children}})),n}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,r=1,i=(0,n.Z)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.stencilRef=r++}}catch(a){i.e(a)}finally{i.f()}}}]),r}(f.Z)},5954:function(e,t,r){r.r(t),r.d(t,{default:function(){return bt}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(27366),u=r(32718),l=r(66978),c=r(94172),h=r(49861),f=(r(93169),r(84936),r(69912)),d=r(21969),v=r(34930),m=r(65457),p=r(74165),g=r(29439),y=r(15861),_=r(88301),x=r(61120),b=r(93433),w=r(65156),T=r(86226),k=r(1413),P=r(92026),S=r(29303),C=r(8768),R=r(30932),U=r(87422),I=r(8548),Z=r(48673),M={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"},F=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,n.Z)(this,r),(e=t.call(this))._textureInvalidated=!0,e._colormapTextureInvalidated=!0,e._rasterTexture=null,e._rasterTextureBandIds=null,e._transformGridTexture=null,e._colormapTexture=null,e._colormap=null,e._supportsBilinearTexture=!0,e._processedTexture=null,e.functionTextures=[],e.projected=!1,e.stencilRef=0,e.coordScale=[1,1],e._processed=!1,e._symbolizerParameters=null,e.height=null,e.isRendereredSource=!1,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e.rawPixelData=null,e._suspended=!1,e._bandIds=null,e._interpolation=null,e._transformGrid=null,e.width=null,e.x=0,e.y=0,e.source=i,e.transformGrid=a,e.interpolation=s,e}return(0,i.Z)(r,[{key:"destroy",value:function(){this._disposeTextures()}},{key:"processedTexture",get:function(){return this._processedTexture},set:function(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}},{key:"rasterTexture",get:function(){return this._rasterTexture},set:function(e){var t;this._rasterTexture!==e&&(null!==(t=this._rasterTexture)&&void 0!==t&&t.dispose(),this._rasterTexture=e),null==e&&(this.projected=!1)}},{key:"processed",get:function(){return this._processed},set:function(e){this._processed=e,e||((0,P.M2)(this.processedTexture),this.invalidateTexture())}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||M},set:function(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}},{key:"source",get:function(){return this._source},set:function(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this.commonUniforms=null,this.projected=!1,this.invalidateTexture())}},{key:"suspended",get:function(){return this._suspended},set:function(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){this._bandIds=e,this._isBandIdsChanged(e)&&(this.projected=!1,this.invalidateTexture())}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?I.cw.LINEAR:I.cw.NEAREST)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid!==e&&(this._transformGrid=e,this._transformGridTexture=(0,P.M2)(this._transformGridTexture))}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}},{key:"getRasterTextureSize",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=r||this.projected;return[n?this.width:(null===(e=this.source)||void 0===e?void 0:e.width)||this.width,n?this.height:(null===(t=this.source)||void 0===t?void 0:t.height)||this.height]}},{key:"getRasterCellSize",value:function(){var e,t=null===(e=this.rawPixelData)||void 0===e?void 0:e.srcPixelSize,r=this.projected,n=this.resolution;return t&&!r?[t.x,t.y]:[n,n]}},{key:"_createTransforms",value:function(){return{displayViewScreenMat3:(0,C.Ue)()}}},{key:"setTransform",value:function(e){var t=(0,S.yR)(this.transforms.displayViewScreenMat3),r=e.toScreenNoRotation([0,0],[this.x,this.y]),n=(0,g.Z)(r,2),i=n[0],a=n[1],s=this.resolution/this.pixelRatio/e.resolution,o=s*this.width,u=s*this.height,l=Math.PI*this.rotation/180;(0,S.Iu)(t,t,(0,R.al)(i,a)),(0,S.Iu)(t,t,(0,R.al)(o/2,u/2)),(0,S.U1)(t,t,-l),(0,S.Iu)(t,t,(0,R.al)(-o/2,-u/2)),(0,S.ex)(t,t,(0,R.al)(o,u)),(0,S.Jp)(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}},{key:"getTextures",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.forProcessing,n=void 0!==r&&r,i=t.useProcessedTexture,a=void 0!==i&&i,s=a&&null!==(e=this._processedTexture)&&void 0!==e?e:this._rasterTexture,o=[],u=[];return s?(this._transformGridTexture&&!this.projected&&(u.push(this._transformGridTexture),o.push("u_transformGrid")),a?(u.push(s),o.push("u_image"),this._colormapTexture&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u}):(u.push(s),o.push("u_image"),this._colormapTexture&&!n&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u})):{names:o,textures:u}}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}},{key:"updateTexture",value:function(e){var t=e.context;if(this.stage){var r=this._isValidSource(this.source);r&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(t)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(t),this._rasterTexture&&(r?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,Z.Br)(t,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()}},{key:"updateProcessedTexture",value:function(){var e=this.functionTextures;0!==e.length&&(this.processedTexture=e.shift(),e.forEach((function(e){return null===e||void 0===e?void 0:e.dispose()})),e.length=0)}},{key:"_createOrDestroyRasterTexture",value:function(e){var t,r=null===(t=this.source)||void 0===t?void 0:t.extractBands(this.bandIds);if(this._isValidSource(r)){var n=!this._isBandIdsChanged(this.bandIds);if(this._rasterTexture){if(n)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}this._supportsBilinearTexture=!!e.capabilities.textureFloatLinear;var i=this._getTextureSamplingMethod(this.interpolation),a=this.isRendereredSource;this._rasterTexture=(0,Z.s9)(e,r,i,a),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?(0,b.Z)(this.bandIds):null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null)}},{key:"_isBandIdsChanged",value:function(e){var t=this._rasterTextureBandIds;return!(null==t&&null==e||t&&e&&t.join("")===e.join(""))}},{key:"_isValidSource",value:function(e){var t;return null!=e&&(null===(t=e.pixels)||void 0===t?void 0:t.length)>0}},{key:"_getTextureSamplingMethod",value:function(e){var t=this.symbolizerParameters.type,r="lut"===t||"hillshade"===t||"stretch"===t&&1===this.symbolizerParameters.bandCount;return!this._supportsBilinearTexture||r||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"}},{key:"_updateColormapTexture",value:function(e){var t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((function(e,r){return e!==t[r]}))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=(0,Z.iC)(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=(0,Z.iC)(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}},{key:"_disposeTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this._transformGridTexture||e&&!this.projected||(this._transformGridTexture.dispose(),this._transformGridTexture=null),!e&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null,this._colormap=null,this._colormapTextureInvalidated=!0),!e&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}]),r}(U.s);function z(e){var t=[];return e&&(t.push("applyProjection"),1===e.spacing[0]&&t.push("lookupProjection")),t}function V(e,t,r){var n=!r.capabilities.textureFloatLinear,i=[];return"cubic"===e?i.push("bicubic"):"bilinear"===e&&(t?(i.push("bilinear"),i.push("nnedge")):n&&i.push("bilinear")),i}var D={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};var B={createProgram:function(e,t,r){var n=r?[]:z(t.transformGrid);return{defines:n,program:e.painter.materialManager.getProgram(D,n)}},bindTextureAndUniforms:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:i}),s=a.names,o=a.textures;(0,Z.RA)(e.context,t,s,o),(0,Z.N9)(t,n,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.displayViewScreenMat3);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset,h=(0,Z.Ue)(l,c);(0,Z.N9)(t,n,h)}},A={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};var O={createProgram:function(e,t,r){var n=t.symbolizerParameters.colormap,i=[].concat((0,b.Z)(r?[]:z(t.transformGrid)),(0,b.Z)(V(t.interpolation,!0,e.context)));return null!=n&&i.push("applyColormap"),{defines:i,program:e.painter.materialManager.getProgram(A,i)}},bindTextureAndUniforms:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:i}),s=a.names,o=a.textures;(0,Z.RA)(e.context,t,s,o),(0,Z.N9)(t,n,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.displayViewScreenMat3);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset;if(null!=l){var h=(0,Z.Ue)(l,c);(0,Z.N9)(t,n,h)}var f=(0,Z.Fm)(u);(0,Z.N9)(t,n,f)}},E={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};var L={createProgram:function(e,t,r){var n=t.symbolizerParameters,i=n.colormap,a=n.bandCount,s=[].concat((0,b.Z)(r?[]:z(t.transformGrid)),(0,b.Z)(V(t.interpolation,1===a,e.context)));return t.isRendereredSource&&!r?s.push("noop"):null!=i&&s.push("applyColormap"),{defines:s,program:e.painter.materialManager.getProgram(E,s)}},bindTextureAndUniforms:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:i}),s=a.names,o=a.textures;(0,Z.RA)(e.context,t,s,o),(0,Z.N9)(t,n,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.displayViewScreenMat3);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset;if(null!=l){var h=(0,Z.Ue)(l,c);(0,Z.N9)(t,n,h)}var f=(0,Z.xW)(u);(0,Z.N9)(t,n,f)}},G=new Map;function N(e){return G.get(e)}G.set("lut",B),G.set("hillshade",O),G.set("stretch",L);var j=[1,1],q=[2,0,0,0,2,0,-1,-1,0];function W(e,t,r){var n,i,a=e.context,s=e.rasterFunction,o=e.hasBranches,u=s.parameters.raster,l=o?null!==(n=null===u||void 0===u?void 0:u.id)&&void 0!==n?n:-1:0,c=null!==(i=r.functionTextures[l])&&void 0!==i?i:r.rasterTexture;(0,Z.RA)(a,t,["u_image"],[c])}function H(e,t,r){var n=e.rasterFunction.parameters.rasters;if(n){if(n.length<2)return W(e,t,r);var i=n.filter((function(e){return"Constant"!==e.name})).map((function(e){return null!=e.id&&"Identity"!==e.name?r.functionTextures[e.id]:r.rasterTexture}));if((0,Z.RA)(e.context,t,["u_image","u_image1","u_image2"].slice(0,i.length),i),i.length!==n.length)if(2===n.length){var a=n.findIndex((function(e){return"Constant"===e.name})),s=0===a?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],o=n[a].parameters.value;t.setUniform1f("u_image1Const",o),t.setUniformMatrix3fv("u_imageSwap",s)}else if(3===n.length){var u=[];if(n.forEach((function(e,t){return"Constant"===e.name&&u.push(t)})),1===u.length){var l=n[u[0]].parameters.value;t.setUniform1f("u_image1Const",l);var c=0===u[0]?[0,1,0,0,0,1,1,0,0]:1===u[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1];t.setUniformMatrix3fv("u_imageSwap",c)}else if(2===u.length){var h=n[u[0]].parameters.value;t.setUniform1f("u_image1Const",h);var f=n[u[1]].parameters.value;t.setUniform1f("u_image2Const",f);var d=n.findIndex((function(e){return"Constant"!==e.name})),v=0===d?[1,0,0,0,1,0,0,0,1]:1===d?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0];t.setUniformMatrix3fv("u_imageSwap",v)}}}}function Q(e){e.setUniform2fv("u_coordScale",j),e.setUniformMatrix3fv("u_dvsMat3",q)}var Y={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])};var J={createProgram:function(e,t){return e.painter.materialManager.getProgram(Y,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.getRasterTextureSize();t.setUniform2fv("u_srcImageSize",n);var i=r.getRasterCellSize();t.setUniform2fv("u_cellSize",i)}},X={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};var K={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters.indexType;return r.materialManager.getProgram(X,[n])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",n)}},$={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ee={createProgram:function(e,t){var r=e.rasterFunction.parameters.rasters.filter((function(e){return"Constant"===e.name})),n=[];return r.length&&(n.push("oneConstant"),2===r.length&&n.push("twoConstant")),e.painter.materialManager.getProgram($,n)},bindTextureAndUniforms:function(e,t,r){H(e,t,r),Q(t)}},te={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/computechange",attributes:new Map([["a_position",0],["a_texcoord",1]])};var re={createProgram:function(e){var t=e.painter,r=e.rasterFunction.parameters,n=r.method,i=r.rasters,a=r.isOutputRounded,s=[n.includes("-")?n.slice(0,n.indexOf("-")):n];return i.filter((function(e){return"Constant"===e.name})).length&&s.push("oneConstant"),a&&s.push("roundOutput"),t.materialManager.getProgram(te,s)},bindTextureAndUniforms:function(e,t,r){H(e,t,r),Q(t);var n=e.rasterFunction.parameters.domainRange;t.setUniform2fv("u_domainRange",n)}},ne={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/contrast",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ie={createProgram:function(e,t){return e.painter.materialManager.getProgram(ne,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters,i=n.contrastOffset,a=n.brightnessOffset;t.setUniform1f("u_contrastOffset",i),t.setUniform1f("u_brightnessOffset",a)}},ae={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])};var se={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters,i=[{name:"rows",value:n.kernelRows},{name:"cols",value:n.kernelCols}];return r.materialManager.getProgram(ae,i)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t),t.setUniform2fv("u_srcImageSize",[r.width,r.height]);var n=e.rasterFunction.parameters,i=n.kernel,a=n.clampRange;t.setUniform1fv("u_kernel",i),t.setUniform2fv("u_clampRange",a)}},oe={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/curvature",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ue={createProgram:function(e,t){var r=e.painter,n=[e.rasterFunction.parameters.curvatureType];return r.materialManager.getProgram(oe,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.getRasterTextureSize();t.setUniform2fv("u_srcImageSize",n);var i=e.rasterFunction.parameters.zFactor,a=r.getRasterCellSize();t.setUniform1f("u_zlFactor",200*i/a[0]/a[1])}},le={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ce={createProgram:function(e,t){return e.painter.materialManager.getProgram(le,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",n)}},he={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/focalstatistics",attributes:new Map([["a_position",0],["a_texcoord",1]])};var fe={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters,i=n.kernelRows,a=n.kernelCols,s=n.fillNoDataOnly,o=[{name:"rows",value:i},{name:"cols",value:a},n.statisticsType];return s&&o.push("fill"),r.materialManager.getProgram(he,o)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t),t.setUniform2fv("u_srcImageSize",[r.width,r.height]);var n=e.rasterFunction.parameters.clampRange;t.setUniform2fv("u_clampRange",n)}},de={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/grayscale",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ve={createProgram:function(e,t){return e.painter.materialManager.getProgram(de,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters.weights;t.setUniform3fv("u_weights",n)}},me={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])};var pe={createProgram:function(e){var t=e.painter,r=e.rasterFunction.parameters,n=r.imageCount,i=r.operationName,a=r.rasters,s=r.isOutputRounded,o=[i.toLowerCase()];2===n&&o.push("twoImages");var u=a.filter((function(e){return"Constant"===e.name}));return u.length&&(o.push("oneConstant"),2===u.length&&o.push("twoConstant")),s&&o.push("roundOutput"),t.materialManager.getProgram(me,o)},bindTextureAndUniforms:function(e,t,r){H(e,t,r),Q(t);var n=e.rasterFunction.parameters.domainRange;t.setUniform2fv("u_domainRange",n)}},ge={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ye={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters.bandCount>1?["multiBand"]:[];return r.materialManager.getProgram(ge,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters,i=n.includedRanges,a=n.noDataValues;t.setUniform1fv("u_includedRanges",i),t.setUniform1fv("u_noDataValues",a)}},_e={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};var xe={createProgram:function(e,t){var r=e.painter,n=e.rasterFunction.parameters.scaled?["scaled"]:[];return r.materialManager.getProgram(_e,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",n)}},be={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};var we={createProgram:function(e,t){return e.painter.materialManager.getProgram(be,[])},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=e.rasterFunction.parameters,i=n.noDataRanges,a=n.rangeMaps,s=n.allowUnmatched,o=n.clampRange;t.setUniform1fv("u_noDataRanges",i),t.setUniform1fv("u_rangeMaps",a),t.setUniform1f("u_unmatchMask",s?1:0),t.setUniform2fv("u_clampRange",o)}},Te=r(6644),ke={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};var Pe={createProgram:function(e,t){var r,n=e.painter,i=[],a=t.interpolation,s=t.transformGrid,o=null===(r=e.rasterFunction)||void 0===r?void 0:r.parameters;return"cubic"===a?i.push("bicubic"):"bilinear"===a&&(i.push("bilinear"),(null===o||void 0===o?void 0:o.requireNNEdge)&&i.push("nnedge")),s&&(i.push("applyProjection"),1===s.spacing[0]&&i.push("lookupProjection")),n.materialManager.getProgram(ke,i)},bindTextureAndUniforms:function(e,t,r){var n=r.getTextures({forProcessing:!0}),i=n.names,a=n.textures;(0,Z.RA)(e.context,t,i,a),t.setUniform1f("u_scale",1),t.setUniform2fv("u_offset",[0,0]),t.setUniform2fv("u_coordScale",[1,1]),t.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]),t.setUniform1i("u_flipY",0),t.setUniform1f("u_opacity",1);var s=r.width,o=r.height,u=r.source,l=r.transformGrid;t.setUniform2fv("u_srcImageSize",[u.width,u.height]),t.setUniform2fv("u_targetImageSize",[s,o]),t.setUniform2fv("u_transformSpacing",l?l.spacing:Te.AG),t.setUniform2fv("u_transformGridSize",l?l.size:Te.AG)}},Se={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};var Ce={createProgram:function(e,t){var r=e.painter,n="percent-rise"===e.rasterFunction.parameters.slopeType?["percentRise"]:[];return r.materialManager.getProgram(Se,n)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.getRasterTextureSize();t.setUniform2fv("u_srcImageSize",n);var i=r.getRasterCellSize();t.setUniform2fv("u_cellSize",i);var a=e.rasterFunction.parameters,s=a.zFactor,o=a.slopeType,u=a.pixelSizePower,l=a.pixelSizeFactor;t.setUniform1f("u_zFactor",s),t.setUniform1f("u_pixelSizePower","adjusted"===o?u:0),t.setUniform1f("u_pixelSizeFactor","adjusted"===o?l:0)}},Re={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};var Ue={createProgram:function(e,t){var r=e.rasterFunction.parameters,n=r.useGamma,i=r.bandCount,a=r.isOutputRounded,s=[];return n&&s.push("useGamma"),i>1&&s.push("multiBand"),a&&s.push("roundOutput"),e.painter.materialManager.getProgram(Re,s)},bindTextureAndUniforms:function(e,t,r){W(e,t,r),Q(t);var n=r.width,i=r.height,a=e.rasterFunction.parameters;t.setUniform2fv("u_srcImageSize",[n,i]),t.setUniform1f("u_minOutput",a.outMin),t.setUniform1f("u_maxOutput",a.outMax),t.setUniform1fv("u_factor",a.factor),t.setUniform1fv("u_minCutOff",a.minCutOff),t.setUniform1fv("u_maxCutOff",a.maxCutOff),t.setUniform1fv("u_gamma",a.gamma),t.setUniform1fv("u_gammaCorrection",a.gammaCorrection)}},Ie=r(57808),Ze=r(52311),Me=new Map;function Fe(e,t){var r=new Ze.X;return r.width=e,r.height=t,r.internalFormat=I.lP.RGBA32F,r.samplingMode=I.cw.NEAREST,r.dataType=I.Br.FLOAT,r.isImmutable=!0,r.wrapMode=I.e8.CLAMP_TO_EDGE,r}function ze(e,t,r,n){var i=e.rasterFunction.name.toLowerCase(),a="reproject"===i?Pe:function(e){return Me.get(e.toLowerCase())}(i);if(null!=a){var s=function(e,t,r,n){var i=e.context,a=e.requestRender,s=e.allowDelayedRender,o=n.createProgram(e,r);return s&&null!=a&&!o.compiled?(a(),null):(i.bindFramebuffer(t),i.setViewport(0,0,t.width,t.height),i.useProgram(o),o)}(e,r,n,a);if(s){a.bindTextureAndUniforms(e,s,n);var o=n.interpolation;"reproject"===i&&(n.interpolation="nearest"),t.draw();var u=n.getRasterTextureSize("reproject"===i),l=(0,g.Z)(u,2),c=l[0],h=l[1],f=Fe(c,h),d=new Ie.x(e.context,f);if(r.copyToTexture(0,0,c,h,0,0,d),"reproject"===i)n.rasterTexture=d,n.projected=!0,n.interpolation=o;else{var v=e.hasBranches?e.rasterFunction.id:0;n.functionTextures[v]=d}}}}Me.set("arithmetic",pe),Me.set("aspect",J),Me.set("bandarithmetic",K),Me.set("computechange",re),Me.set("compositeband",ee),Me.set("convolution",se),Me.set("contrastbrightness",ie),Me.set("curvature",ue),Me.set("extractband",ce),Me.set("statistics",fe),Me.set("grayscale",ve),Me.set("local",pe),Me.set("mask",ye),Me.set("ndvi",xe),Me.set("remap",we),Me.set("slope",Ce),Me.set("stretch",Ue);var Ve=r(94109),De=r(25866),Be=r(3886),Ae=r(53634),Oe=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).name="raster",e._quad=null,e._rendererUniformInfos=new Map,e._fbo=null,e}return(0,i.Z)(r,[{key:"dispose",value:function(){(0,P.M2)(this._quad),(0,P.M2)(this._fbo)}},{key:"prepareState",value:function(e){var t=e.context,r="raster"===e.renderPass;t.setBlendingEnabled(!r),t.setBlendFunctionSeparate(I.zi.ONE,I.zi.ONE_MINUS_SRC_ALPHA,I.zi.ONE,I.zi.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!r)}},{key:"draw",value:function(e,t){if(function(e){return null!=e.source}(t)&&!t.suspended){var r=e.renderPass;if("raster-bitmap"!==r)return"raster"===r?this._process(e,t):void this._drawBitmap(e,t,!0);this._drawBitmap(e,t)}}},{key:"_process",value:function(e,t){var r="Reproject"===e.rasterFunction.name;if(r?!t.rasterTexture||!t.projected:!t.processed){var n=e.timeline,i=e.context;n.begin(this.name);var a=i.getBoundFramebufferObject(),s=i.getViewport();r||(t.processedTexture=(0,P.M2)(t.processedTexture)),i.setStencilFunction(I.wb.EQUAL,t.stencilRef,255),t.updateTexture(e),this._initQuad(i);var o=t.getRasterTextureSize(r),u=(0,g.Z)(o,2),l=u[0],c=u[1],h=this._getRasterFBO(i,l,c),f=h.isStandardRasterTileSize,d=h.fbo;ze(e,this._quad,d,t),f||d.dispose(),i.bindFramebuffer(a),i.setViewport(s.x,s.y,s.width,s.height),n.end(this.name)}}},{key:"_drawBitmap",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.timeline,i=e.context;if(n.begin(this.name),i.setStencilFunction(I.wb.EQUAL,t.stencilRef,255),t.updateTexture(e),r&&!t.processedTexture){if(t.updateProcessedTexture(),!t.processedTexture)return void n.end(this.name);t.processed=!0}this._initBitmapCommonUniforms(t);var a=t.symbolizerParameters.type,s=N(a),o=e.requestRender,u=e.allowDelayedRender,l=s.createProgram(e,t,t.projected&&r),c=l.defines,h=l.program;if(!u||null==o||h.compiled){i.useProgram(h);var f=this._getUniformInfos(a,i,h,c);this._quad||(this._quad=new De.Z(i,[0,0,1,0,0,1,1,1])),s.bindTextureAndUniforms(e,h,t,f,r),this._quad.draw(),n.end(this.name)}else o()}},{key:"_initBitmapCommonUniforms",value:function(e){if(!e.commonUniforms){var t=(0,Z.zS)(1,[0,0]),r=e.transformGrid,n=e.width,i=e.height,a=(0,Z.Tc)(r,[n,i],[e.source.width,e.source.height],1,!1);e.commonUniforms=(0,k.Z)((0,k.Z)((0,k.Z)({},t),a),{},{u_coordScale:e.coordScale})}}},{key:"_getRasterFBO",value:function(e,t,r){var n=t===Ve.i9&&r===Ve.i9;return n?(this._fbo||(this._fbo=this._createNewFBO(e,t,r)),{isStandardRasterTileSize:n,fbo:this._fbo}):{isStandardRasterTileSize:n,fbo:this._createNewFBO(e,t,r)}}},{key:"_createNewFBO",value:function(e,t,r){var n=Fe(t,r);return new Ae.X(e,n)}},{key:"_initQuad",value:function(e){this._quad||(this._quad=new De.Z(e,[0,0,1,0,0,1,1,1]))}},{key:"_getUniformInfos",value:function(e,t,r,n){var i=n.length>0?e+"-"+n.join("-"):e;if(this._rendererUniformInfos.has(i))return this._rendererUniformInfos.get(i);var a=(0,Z.v)(t,r);return this._rendererUniformInfos.set(i,a),a}}]),r}(Be.Z),Ee=r(72900),Le=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e,i,a,s,o,u){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,n.Z)(this,r),(l=t.call(this,e,i,a,s,o,u)).bitmap=null,l.bitmap=new F(c,null,null),l.bitmap.coordScale=[o,u],l.bitmap.once("isReady",(function(){return l.ready()})),l}return(0,i.Z)(r,[{key:"destroy",value:function(){(0,_.Z)((0,x.Z)(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"setTransform",value:function(e){(0,_.Z)((0,x.Z)(r.prototype),"setTransform",this).call(this,e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}},{key:"_createTransforms",value:function(){return{displayViewScreenMat3:(0,C.Ue)(),tileMat3:(0,C.Ue)()}}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(Ee.I),Ge=r(80613),Ne=r(55067),je=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return(0,i.Z)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e),r=(0,g.Z)(this._tileInfoView.tileInfo.size,2),n=r[0],i=r[1],a=this._tileInfoView.getTileResolution(e.level);return new Le(e,a,t[0],t[3],n,i)}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"imagery (tile)",brushes:[Oe],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:Ge.jx.MAP});return[].concat((0,b.Z)((0,_.Z)((0,x.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[n])}},{key:"doRender",value:function(e){if(this.visible&&e.drawPhase===Ge.jx.MAP){var t=this.rasterFunctionChain;if(!t)return e.renderPass="raster-bitmap",void(0,_.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e);if(!t.hasFocalFunction){var n=(0,g.Z)(this._tileInfoView.tileInfo.size,2),i=n[0],a=n[1];e.renderPass="raster",e.rasterFunction={name:"Reproject",parameters:{targetImageSize:[i,a],requireNNEdge:t.isSourceSingleBand},pixelType:"f32",id:0,isNoopProcess:!1},(0,_.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e)}if(null!==t&&void 0!==t&&t.functions.length)for(var s=t.functions,o=t.hasBranches,u=0;u<s.length;u++){var l=s[u];"Constant"!==l.name&&"Identity"!==l.name&&(e.renderPass="raster",e.rasterFunction=l,e.hasBranches=o,(0,_.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e))}e.rasterFunction=null,e.renderPass="bitmap",(0,_.Z)((0,x.Z)(r.prototype),"doRender",this).call(this,e)}}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds((0,w.Ue)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,n=(0,T.ut)(r.spatialReference);if(n){var i=r.lodAt(e.level);if(!i)return t;var a=i.resolution,s=n/a%r.size[0],o=s?(r.size[0]-s)*a:0;t[0]-=o*e.world,t[2]-=o*e.world}}return t}}]),r}(Ne.Z),qe=r(97326),We=(r(59486),r(7138)),He=r(46634),Qe=r(848),Ye=r(99278),Je=r(22824),Xe=r(55635),Ke=r(80394),$e=r(37995),et=(r(73828),r(32344)),tt=r(85269),rt=r(90316),nt=r(53866),it=[0,0],at=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments))._updatingHandles=new He.R,e._emptyTilePixelBlock=null,e._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._srcResolutions=[],e.previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._isCustomTilingScheme=!1,e._maxIndexedColormapSize=0,e._rasterFunctionState="na",e._globalUpdateRequested=!1,e.attached=!1,e.timeExtent=null,e.redrawOrRefetch=(0,l.Ds)((0,y.Z)((0,p.Z)().mark((function t(){var r,n,i,a,s,o=arguments;return(0,p.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=o.length>0&&void 0!==o[0]?o[0]:{},n=e._rasterFunctionState,t.t0=r.reprocess,!t.t0){t.next=7;break}return t.next=6,e._updatingHandles.addPromise(e.layer.updateRasterFunction());case 6:e.updateRasterFunctionParameters();case 7:if(e.previousLOD&&!e.layerView.suspended){t.next=9;break}return t.abrupt("return");case 9:return i=e._rasterFunctionState,a=(0,qe.Z)(e),s=a.type,t.abrupt("return",r.refetch||"raster"!==s&&r.reprocess||"cpu"===i||"cpu"===n?e._updatingHandles.addPromise(e.doRefresh()):e._updatingHandles.addPromise(e._redrawImage(r.signal)));case 11:case"end":return t.stop()}}),t)})))),e}return(0,i.Z)(r,[{key:"destroy",value:function(){this._updatingHandles.destroy()}},{key:"useWebGLForProcessing",get:function(){var e;return null===(e=this._get("useWebGLForProcessing"))||void 0===e||e},set:function(e){this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){var e;return null===(e=this._get("useProgressiveUpdate"))||void 0===e||e},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();var r=this._getCacheSize(e);this._tileStrategy=new tt.Z({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:r,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,n=t.resolution,i=t.scale,a=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var o=this._srcResolutions[a.level],u=r.toJSON?r:nt.Z.fromJSON(r);(0,Xe.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,u,n,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null===(s=this.previousLOD)||void 0===s?void 0:s.level)!==a.level&&(this.previousLOD=a,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}},{key:"moveEnd",value:function(){var e=this;!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.layerView.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.layerView.requestUpdate()}},{key:"updating",get:function(){var e;return this._globalUpdateRequested||(null===(e=this._updatingHandles)||void 0===e?void 0:e.updating)}},{key:"attach",value:function(){var e=this,t=(0,rt.h)();this._maxIndexedColormapSize=4*(t.maxTextureSize||4096),this._initializeTileInfo(),this._tileInfoView=new $e.Z(this.layerView.tileInfo,this.layerView.fullExtent);var r=this._computeFetchConcurrency();this._fetchQueue=new et.Z({tileInfoView:this._tileInfoView,concurrency:r,process:function(t,r){return e._fetchTile(t,r)}});var n=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new tt.Z({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:n,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,Xe.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}},{key:"acquireTile",value:function(e){var t=this.container.createTile(e);return this._updatingHandles.addPromise(this._enqueueTileFetch(t)),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(function(){e.destroy(),t.layerView.requestUpdate()})),this.layerView.requestUpdate()}},{key:"createEmptyTilePixelBlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&null!=this._emptyTilePixelBlock)return this._emptyTilePixelBlock;var r=e=e||this._tileInfoView.tileInfo.size,n=(0,g.Z)(r,2),i=n[0],a=n[1],s=new Ye.Z({width:i,height:a,pixels:[new Uint8Array(i*a)],mask:new Uint8Array(i*a),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}},{key:"_getBandIds",value:function(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;var e=this.layer,t=e.bandIds,r=e.raster,n="rasterFunction"in r?r.rasterFunction.rawInputBandIds:null;return null!==t&&void 0!==t&&t.length&&null!==n&&void 0!==n&&n.length&&1!==r.rasterInfo.bandCount?t.map((function(e){return n[Math.min(e,n.length-1)]})):t||n}},{key:"updateRasterFunctionParameters",value:function(){}},{key:"_fetchTile",value:function(e,t){var r=this._getFetchOptions(e.level,t.signal);return this.fetchTile(e,r)}},{key:"_getFetchOptions",value:function(e,t){var r=this.canUseWebGLForProcessing(),n=this.layerView,i=n.tileInfo,a=!i.isWrappable&&null!=(0,Ke.ut)(n.view.spatialReference),s=r&&this.layer.raster.hasUniqueSourceStorageInfo;return{allowPartialFill:!0,datumTransformation:n.datumTransformation,interpolation:r?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:s,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:t,srcResolution:this._srcResolutions[e],timeExtent:n.timeExtent,tileInfo:i,disableWrapAround:a}}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.layerView,t=e.view.spatialReference;if(this._canUseLayerLODs()){var r=this.layer.tileInfo,n=r.origin,i=r.lods,a=i.map((function(e){return e.scale})),s=Je.Z.create({spatialReference:t,size:Ve.i9,scales:a,origin:n});return e.set("tileInfo",s),void(this._srcResolutions=i.map((function(e){var t=e.resolution;return{x:t,y:t}})))}var o=(0,Ke.vF)(this.layer.serviceRasterInfo,t,{tileSize:Ve.i9,alignGlobalDatasetWithAGOL:!0,limitToSrcResolution:!1}),u=o.scales,l=o.srcResolutions,c=o.isCustomTilingScheme,h=Je.Z.create({spatialReference:t,size:Ve.i9,scales:u}),f=0===h.origin.x,d=e.fullExtent,v=d.xmin,m=d.ymax;(f||c&&h.origin.x>v)&&(h.origin=new Qe.Z({x:v,y:m,spatialReference:t})),this._isCustomTilingScheme=c,e.set("tileInfo",h),this._srcResolutions=null!==l&&void 0!==l?l:[]}},{key:"_canUseLayerLODs",value:function(){var e,t=this.layer,r=this.layerView;if("Map"!==t.raster.tileType)return!1;var n=t.tileInfo.lods,i=null===(e=r.view.constraints)||void 0===e?void 0:e.effectiveLODs;return(null===i||void 0===i?void 0:i.length)===n.length&&i.every((function(e,t){var r=e.scale;return Math.abs(r-n[t].scale)<.001}))}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.serviceRasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){var n,i,a,s,o,c,h=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=30;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(n=e.sent,i=this._getBandIds(),a=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.layerView.moving||0!==this._fetchQueue.length){e.next=18;break}return a=!1,e.prev=9,e.next=12,this._redrawImage(null===(s=this._abortController)||void 0===s?void 0:s.signal);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),(0,l.D_)(e.t0)&&u.Z.getLogger(this).error(e.t0);case 17:this._globalUpdateRequested=!1;case 18:return!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams(),o=this._tileInfoView.getTileCoords(it,t.key),c=this._tileInfoView.getTileResolution(t.key),e.next=22,this.updateTileSource(t,{source:n,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:a,bandIds:i,coords:o,resolution:c});case 22:t.once("attach",(function(){return h.layerView.requestUpdate()})),this.container.addChild(t),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(1),(0,l.D_)(e.t1)||u.Z.getLogger(this).error(e.t1);case 29:this.layerView.requestUpdate();case 30:case"end":return e.stop()}}),e,this,[[1,26],[9,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t){var r,n=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.container.children.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:if(!this.layerView.hasTilingEffects){e.next=9;break}return e.next=7,this._updateGlobalSymbolizerParams(t);case 7:e.next=10;break;case 9:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 10:return r=this.container.children.map(function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.updateTileSymbolizerParameters(t,{local:n._symbolizerParams,global:n._globalSymbolizerParams}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,Promise.allSettled(r);case 13:this.container.requestRender();case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateGlobalSymbolizerParams",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t){var r,n,i,a,s;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._getFetchOptions(this.previousLOD.level,t),e.next=3,this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,(0,k.Z)((0,k.Z)({},r),{},{interpolation:"nearest",requestRawData:!1,skipRasterFunction:!1}));case 3:if(null!==(n=e.sent)&&void 0!==n&&n.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:i=this.previousLOD.resolution,a=this._getBandIds(),s=this.layer.symbolizer.generateWebGLParameters({pixelBlock:n.pixelBlock.extractBands(a),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:i,y:i},bandIds:a}),!this.canUseWebGLForProcessing()&&s&&"stretch"===s.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(s.factor=s.factor.map((function(e){return 255*e})),s.outMin=Math.round(255*s.outMin),s.outMax=Math.round(255*s.outMax)),this._globalSymbolizerParams=s;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){var e=this.previousLOD.resolution,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:e,y:e},bandIds:t})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=this.layerView,n=t.raster,i=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:r.timeExtent}),a=i.multidimensionalDefinition,s=n.rasterInfo.multidimensionalInfo?n.getSliceIndex(a):null,o=(0,Xe.Rq)(n.rasterId,s);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,Xe.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,Xe.z2)(o,n.rasterInfo),e){var u=r.view,l=this._tileInfoView.getClosestInfoForScale(u.scale),c=this._srcResolutions[l.level];(0,Xe.Vx)(o,this._blockCacheRegistryId,u.extent,u.resolution,c,n.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}},{key:"doRefresh",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(){var t,r=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.attached&&this.previousLOD&&!this.layerView.suspended){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:return this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),t=[],this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.refresh((function(e){return t.push(r._enqueueTileFetch(e))})),e.next=12,this._updatingHandles.addPromise(Promise.allSettled(t));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(We.default);(0,o._)([(0,h.Cb)()],at.prototype,"_globalUpdateRequested",void 0),(0,o._)([(0,h.Cb)()],at.prototype,"attached",void 0),(0,o._)([(0,h.Cb)()],at.prototype,"container",void 0),(0,o._)([(0,h.Cb)()],at.prototype,"layer",void 0),(0,o._)([(0,h.Cb)()],at.prototype,"layerView",void 0),(0,o._)([(0,h.Cb)()],at.prototype,"type",void 0),(0,o._)([(0,h.Cb)()],at.prototype,"useWebGLForProcessing",null),(0,o._)([(0,h.Cb)()],at.prototype,"useProgressiveUpdate",null),(0,o._)([(0,h.Cb)()],at.prototype,"timeExtent",void 0),(0,o._)([(0,h.Cb)()],at.prototype,"updating",null),at=(0,o._)([(0,f.j)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],at);var st=r(39594),ot=r(20921),ut=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).type="raster",e}return(0,i.Z)(r,[{key:"attach",value:function(){(0,_.Z)((0,x.Z)(r.prototype),"attach",this).call(this),this.container=new je(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}},{key:"detach",value:function(){(0,_.Z)((0,x.Z)(r.prototype),"detach",this).call(this),this.container.removeAllChildren(),this.container=null}},{key:"canUseWebGLForProcessing",value:function(){var e,t,r=this.layer.symbolizer,n=null===(e=r.lookup)||void 0===e||null===(t=e.colormapLut)||void 0===t?void 0:t.indexedColormap,i=n&&n.length>this._maxIndexedColormapSize;return this.useWebGLForProcessing&&r.canRenderInWebGL&&!i&&!("majority"===this.layer.interpolation&&(0,st.JV)(this.layer))}},{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"updateRasterFunctionParameters",value:function(){var e=this.layerView,t=e.clips,r=e.view;null!=this._geometry&&t.remove(this._geometry);var n=this.layer,i=n.raster,a=n.type;if("Function"===i.datasetFormat){var s=i.getClippingGeometry(r.spatialReference);if(s){var o=new ot.Z({geometry:s});t.add(o),this._geometry=o}}var u=this.container;if("Function"!==i.datasetFormat||"wcs"===a)return u.rasterFunctionChain=null,u.children.forEach((function(e){var t=e.bitmap;t&&(t.suspended=!0,t.processed=!1,t.projected&&(t.invalidateTexture(),t.rasterTexture=null))})),void(this._rasterFunctionState="na");var l=this._rasterFunctionState,c=i.rasterFunction,h=i.primaryRasters,f=c.supportsGPU&&(!h||h.rasters.length<=1),d=f?c.flatWebGLFunctionChain:null,v=this.layer.renderer,m=!f||!(null!==d&&void 0!==d&&d.functions.length)||"raster-stretch"===(null===v||void 0===v?void 0:v.type)&&v.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();u.rasterFunctionChain=m?null:d;var p=null==c?"na":u.rasterFunctionChain?"gpu":"cpu";u.children.forEach((function(e){var t=e.bitmap;t&&(t.suspended=l!==p,t.processed=!1,t.processedTexture=null)})),this._rasterFunctionState=p}},{key:"updateTileSource",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){var n,i,a,s,o,u,l,c,h,f,d,v,m,y;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._getBandIds(),a=this._getLayerInterpolation(),s=this.canUseWebGLForProcessing(),o=r.source,u=r.globalSymbolizerParams,l=r.suspended,c=r.coords,h=r.resolution,f=this.layerView.hasTilingEffects?u:r.symbolizerParams,d=t.bitmap,n=(0,g.Z)(c,2),d.x=n[0],d.y=n[1],d.resolution=h,null==(null===o||void 0===o?void 0:o.pixelBlock)){e.next=14;break}if(v={extent:o.extent,pixelBlock:o.pixelBlock,srcPixelSize:o.srcTilePixelSize},d.rawPixelData=v,!s){e.next=7;break}d.source=o.pixelBlock,d.isRendereredSource=!1,e.next=11;break;case 7:return e.next=9,this.layer.applyRenderer(v,"stretch"===(null===u||void 0===u?void 0:u.type)?u:void 0);case 9:m=e.sent,d.source=m,d.isRendereredSource=!0;case 11:d.symbolizerParameters=s?f:null,d.transformGrid=s?o.transformGrid:null,e.next=16;break;case 14:y=this.createEmptyTilePixelBlock(),d.source=y,d.symbolizerParameters=s?f:null,d.transformGrid=null;case 16:d.bandIds=s?i:null,d.width=this._tileInfoView.tileInfo.size[0],d.height=this._tileInfoView.tileInfo.size[1],d.interpolation=a,d.suspended=l,d.invalidateTexture();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSymbolizerParameters",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){var n,i,a,s,o,u,l;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.local,i=r.global,a=this._getBandIds(),s=this._getLayerInterpolation(),o=this.canUseWebGLForProcessing(),u=t.bitmap,l=u.rawPixelData,!o&&null!=l){e.next=5;break}u.isRendereredSource&&null!=l&&(u.source=l.pixelBlock),u.isRendereredSource=!1,e.next=9;break;case 5:return e.next=7,this.layer.applyRenderer(l,"stretch"===(null===i||void 0===i?void 0:i.type)?i:void 0);case 7:u.source=e.sent,u.isRendereredSource=!0;case 9:u.symbolizerParameters=o?this.layerView.hasTilingEffects?i:n:null,u.bandIds=o?a:null,u.interpolation=s,u.suspended=!1;case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getLayerInterpolation",value:function(){var e=this.layer,t=e.interpolation,r=e.renderer;if(!r)return t;var n=r.type;return"raster-colormap"===n||"unique-value"===n||"class-breaks"===n?"nearest":"raster-stretch"===r.type&&null!=r.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}}]),r}(at);(0,o._)([(0,h.Cb)()],ut.prototype,"container",void 0),(0,o._)([(0,h.Cb)()],ut.prototype,"layer",void 0),(0,o._)([(0,h.Cb)()],ut.prototype,"type",void 0);var lt=ut=(0,o._)([(0,f.j)("esri.views.2d.layers.imagery.ImageryTileView2D")],ut),ct=r(64145),ht=r(57874),ft=r(60831),dt=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e,i,a,s,o,u){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,n.Z)(this,r),(l=t.call(this,e,i,a,s,o,u)).tileData=new ft.F(c),l.tileData.coordScale=[o,u],l.tileData.once("isReady",(function(){return l.ready()})),l}return(0,i.Z)(r,[{key:"destroy",value:function(){(0,_.Z)((0,x.Z)(r.prototype),"destroy",this).call(this),this.tileData.destroy(),this.tileData=null,this.stage=null}},{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(e){this.tileData.stencilRef=e}},{key:"_createTransforms",value:function(){return{displayViewScreenMat3:(0,C.Ue)(),tileMat3:(0,C.Ue)()}}},{key:"setTransform",value:function(e){(0,_.Z)((0,x.Z)(r.prototype),"setTransform",this).call(this,e);var t=this.resolution/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,i=(0,g.Z)(this.tileData.offset,2),a=i[0],s=i[1],o=[this.x+a*this.resolution,this.y-s*this.resolution],u=e.toScreenNoRotation([0,0],o),l=(0,g.Z)(u,2),c=l[0],h=l[1],f=this.tileData.symbolizerParameters.symbolTileSize,d=Math.round((this.width-this.tileData.offset[0])/f)*f,v=Math.round((this.height-this.tileData.offset[1])/f)*f,m=d/this.rangeX*t,p=v/this.rangeY*t;(0,S.t8)(n,m,0,0,0,p,0,c,h,1),(0,S.Jp)(this.transforms.displayViewScreenMat3,e.displayViewMat3,n),this.tileData.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}},{key:"onAttach",value:function(){this.tileData.stage=this.stage}},{key:"onDetach",value:function(){this.tileData.stage=null}}]),r}(Ee.I),vt=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e.symbolTypes=["triangle"],e}return(0,i.Z)(r,[{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,w.Ue)(),e),r=(0,g.Z)(this._tileInfoView.tileInfo.size,2),n=r[0],i=r[1],a=this._tileInfoView.getTileResolution(e.level);return new dt(e,a,t[0],t[3],n,i)}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"imagery (vf tile)",brushes:[ht.Z],target:function(){return t.children.map((function(e){return e.tileData}))},drawPhase:Ge.jx.MAP});return[].concat((0,b.Z)((0,_.Z)((0,x.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[n])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===Ge.jx.MAP&&this.symbolTypes.forEach((function(n){e.renderPass=n,(0,_.Z)((0,x.Z)(r.prototype),"doRender",t).call(t,e)}))}}]),r}(Ne.Z),mt=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments))._handle=null,e.type="rasterVF",e}return(0,i.Z)(r,[{key:"canUseWebGLForProcessing",value:function(){return!1}},{key:"fetchTile",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){var n,i;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,k.Z)((0,k.Z)({},r),{},{interpolation:"nearest",requestProjectedLocalDirections:!0}),e.next=3,this.layer.fetchTile(t.level,t.row,t.col,r);case 3:if(i=e.sent,e.t0="vector-magdir"===(null===(n=this.layer.serviceRasterInfo)||void 0===n?void 0:n.dataType)&&null!==i&&void 0!==i&&i.pixelBlock,!e.t0){e.next=9;break}return e.next=8,this.layer.convertVectorFieldData(i.pixelBlock,r);case 8:i.pixelBlock=e.sent;case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSource",value:function(e,t){var r=t.symbolizerParams,n=e.tileData;n.key=e.key,n.width=this._tileInfoView.tileInfo.size[0],n.height=this._tileInfoView.tileInfo.size[1];var i=r.symbolTileSize,a=t.source;if(n.offset=this._getTileSymbolOffset(n.key,i),null!=(null===a||void 0===a?void 0:a.pixelBlock)){var s={extent:a.extent,pixelBlock:a.pixelBlock};n.rawPixelData=s,n.symbolizerParameters=r,n.source=this._sampleVectorFieldData(a.pixelBlock,r,n.offset)}else{var o=[Math.round((this._tileInfoView.tileInfo.size[0]-n.offset[0])/i),Math.round((this._tileInfoView.tileInfo.size[1]-n.offset[1])/i)],u=this.createEmptyTilePixelBlock(o);n.source=u,n.symbolizerParameters=r}return n.invalidateVAO(),Promise.resolve()}},{key:"updateTileSymbolizerParameters",value:function(e,t){var r,n=t.local,i=n.symbolTileSize,a=e.tileData;a.offset=this._getTileSymbolOffset(a.key,i);var s=a.symbolizerParameters.symbolTileSize;a.symbolizerParameters=n;var o=null===(r=a.rawPixelData)||void 0===r?void 0:r.pixelBlock;return null!=o&&s!==i&&(a.source=this._sampleVectorFieldData(o,a.symbolizerParameters,a.offset)),Promise.resolve()}},{key:"attach",value:function(){var e=this;(0,_.Z)((0,x.Z)(r.prototype),"attach",this).call(this),this.container=new vt(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,c.watch)((function(){return e.layer.renderer}),(function(t){return e._updateSymbolType(t)}))}},{key:"detach",value:function(){var e;(0,_.Z)((0,x.Z)(r.prototype),"detach",this).call(this),this.container.removeAllChildren(),null!==(e=this._handle)&&void 0!==e&&e.remove(),this._handle=null,this.container=null}},{key:"_getTileSymbolOffset",value:function(e,t){var r=e.col*this._tileInfoView.tileInfo.size[0]%t,n=e.row*this._tileInfoView.tileInfo.size[1]%t;return[r>t/2?t-r:-r,n>t/2?t-n:-n]}},{key:"_sampleVectorFieldData",value:function(e,t,r){var n=t.symbolTileSize;return(0,ct.nb)(e,"vector-uv",n,r)}},{key:"_updateSymbolType",value:function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}}]),r}(at);(0,o._)([(0,h.Cb)()],mt.prototype,"container",void 0),(0,o._)([(0,h.Cb)()],mt.prototype,"layer",void 0),(0,o._)([(0,h.Cb)()],mt.prototype,"type",void 0);var pt=mt=(0,o._)([(0,f.j)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],mt),gt=r(55245),yt=r(67581),_t=r(13107),xt=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments))._useWebGLForProcessing=!0,e._useProgressiveUpdate=!0,e.subview=null,e}return(0,i.Z)(r,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}},{key:"displayParameters",get:function(){var e=this.layer,t=this._get("displayParameters");return e.renderer?{bandIds:e.bandIds,renderer:e.renderer,interpolation:e.interpolation,multidimensionalDefinition:e.multidimensionalDefinition,rasterFunction:"imagery-tile"===e.type?e.rasterFunction:null}:t}},{key:"update",value:function(e){var t;null!==(t=this.subview)&&void 0!==t&&t.update(e),this.notifyChange("updating")}},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,c.watch)((function(){return e.displayParameters}),(function(t,r){var n=t.interpolation!==(null===r||void 0===r?void 0:r.interpolation)&&("majority"===t.interpolation||"majority"===(null===r||void 0===r?void 0:r.interpolation))&&(0,st.JV)(e.layer),i=t.renderer!==(null===r||void 0===r?void 0:r.renderer)&&e._getSubviewType(null===r||void 0===r?void 0:r.renderer)!==e._getSubviewType(t.renderer);i&&e._updateSubview();var a=t.multidimensionalDefinition!==(null===r||void 0===r?void 0:r.multidimensionalDefinition),s=t.rasterFunction!==(null===r||void 0===r?void 0:r.rasterFunction),o=s&&!e._useWebGLForProcessing,c=a||n||i||o;e.subview.redrawOrRefetch({refetch:c,reprocess:s}).catch((function(t){(0,l.D_)(t)||u.Z.getLogger(e).error(t)})),e.notifyChange("updating")})),(0,c.watch)((function(){var t;return null!==(t=e.layer.multidimensionalSubset)&&void 0!==t?t:null}),(function(t,r){var n=e.layer.multidimensionalDefinition;null!=n&&(0,d.nb)(n,t)!==(0,d.nb)(n,r)&&(e.subview.redrawOrRefetch({refetch:!0}).catch((function(t){(0,l.D_)(t)||u.Z.getLogger(e).error(t)})),e.notifyChange("updating"))}),c.sync),(0,c.watch)((function(){return e.timeExtent}),(function(){e.subview.timeExtent=e.timeExtent,e.subview.redrawOrRefetch({refetch:!0}).catch((function(t){(0,l.D_)(t)||u.Z.getLogger(e).error(t)}))}),c.initial)])}},{key:"detach",value:function(){var e;this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null!==(e=this.subview)&&void 0!==e&&e.destroy(),this.subview=null}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.subview.moveEnd()}},{key:"doRefresh",value:function(){return this.subview?this.subview.doRefresh():Promise.resolve()}},{key:"_updateSubview",value:function(){var e=this.layer.renderer;if(e){var t=this._getSubviewType(e);if(this.subview){var r;if(this.subview.type===t)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null!==(r=this.subview)&&void 0!==r&&r.destroy(),this.subview=null}var n,i=this.layer;if("useWebGLForProcessing"in(n="rasterVF"===t?new pt({layer:i,layerView:this}):"flow"===t?new v.Z({layer:i,layerView:this}):new lt({layer:i,layerView:this}))&&(n.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in n&&(n.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in n){var a=this.subview;n.previousLOD=a&&"previousLOD"in a?a.previousLOD:null}this._attachSubview(n),this.subview=n,this.requestUpdate()}}},{key:"_attachSubview",value:function(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0))}},{key:"_detachSubview",value:function(e){(null===e||void 0===e?void 0:e.attached)&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}},{key:"_getSubviewType",value:function(e){var t=null===e||void 0===e?void 0:e.type;return"vector-field"===t?"rasterVF":"flow"===t?"flow":"raster"}}]),r}((0,gt.Z)((0,_t.Z)((0,m.y)(yt.Z))));(0,o._)([(0,h.Cb)()],xt.prototype,"subview",void 0),(0,o._)([(0,h.Cb)()],xt.prototype,"useWebGLForProcessing",null),(0,o._)([(0,h.Cb)()],xt.prototype,"useProgressiveUpdate",null),(0,o._)([(0,h.Cb)({readOnly:!0})],xt.prototype,"displayParameters",null);var bt=xt=(0,o._)([(0,f.j)("esri.views.2d.layers.ImageryTileLayerView2D")],xt)},55245:function(e,t,r){r.d(t,{Z:function(){return g}});var n=r(74165),i=r(15861),a=r(15671),s=r(43144),o=r(60136),u=r(29388),l=r(27366),c=r(52639),h=r(10064),f=r(49861),d=(r(93169),r(32718),r(84936),r(69912)),v=r(50863),m=r(80394),p=r(24405),g=function(e){var t=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.tileInfo=null,e}return(0,s.Z)(r,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"timeExtent",get:function(){var e;return(0,v.h)(this.layer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}},{key:"hasTilingEffects",get:function(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}},{key:"datumTransformation",get:function(){return(0,m._D)(this.layer.fullExtent,this.view.spatialReference,!0)}},{key:"supportsSpatialReference",value:function(e){return!!(0,m.lK)(this.layer.serviceRasterInfo,e)}},{key:"fetchPopupFeaturesAtLocation",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,o,u,l,f,d,v,m,g,y,_,x,b,w,T,k,P,S,C,R,U;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}throw new h.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i});case 3:if(a=i.popupEnabled,s=(0,p.V5)(i,r),a&&null!=s){e.next=6;break}return e.abrupt("return",[]);case 6:return o=[],e.next=9,i.identify(t,{timeExtent:this.timeExtent,signal:null===r||void 0===r?void 0:r.signal});case 9:if(u=e.sent,l=u.value,f=u.magdirValue,d=u.processedValue,v="",null!==l&&void 0!==l&&l.length){if(v="imagery-tile"===i.type&&i.hasStandardTime()&&null!=l[0]?l.map((function(e){return i.getStandardTimeValue(e)})).join(", "):l.join(", "),(y={ObjectId:0})[_="Raster.ServicePixelValue"]="imagery-tile"===i.type&&"Function"===i.raster.datasetFormat?null===d||void 0===d?void 0:d.join(", "):v,y[_+".Raw"]=v,x=null!==(m=null===(g=i.raster)||void 0===g?void 0:g.rasterInfo)&&void 0!==m?m:i.serviceRasterInfo,null!=(b=null===x||void 0===x?void 0:x.attributeTable)&&(w=b.fields,T=b.features,k=w.find((function(e){return"value"===e.name.toLowerCase()})),P=y[_],S=k?T.find((function(e){return String(e.attributes[k.name])===P})):null,S))for(C in S.attributes)S.attributes.hasOwnProperty(C)&&(y[this._rasterFieldPrefix+C]=S.attributes[C]);"vector-magdir"!==(R=null===x||void 0===x?void 0:x.dataType)&&"vector-uv"!==R||(y["Raster.Magnitude"]=null===f||void 0===f?void 0:f[0],y["Raster.Direction"]=null===f||void 0===f?void 0:f[1]),U=new c.Z({geometry:this.fullExtent.clone(),attributes:y,layer:i,sourceLayer:i}),o.push(U)}return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getfullExtent",value:function(){return(0,m.lK)(this.layer.serviceRasterInfo,this.view.spatialReference)}}]),r}(e);return(0,l._)([(0,f.Cb)()],t.prototype,"fullExtent",null),(0,l._)([(0,f.Cb)()],t.prototype,"layer",void 0),(0,l._)([(0,f.Cb)({readOnly:!0})],t.prototype,"timeExtent",null),(0,l._)([(0,f.Cb)()],t.prototype,"view",void 0),(0,l._)([(0,f.Cb)()],t.prototype,"tileInfo",void 0),(0,l._)([(0,f.Cb)({readOnly:!0})],t.prototype,"hasTilingEffects",null),(0,l._)([(0,f.Cb)()],t.prototype,"datumTransformation",null),t=(0,l._)([(0,d.j)("esri.views.layers.ImageryTileLayerView")],t)}},48673:function(e,t,r){r.d(t,{Br:function(){return l},Fm:function(){return m},N9:function(){return g},RA:function(){return y},Tc:function(){return h},Ue:function(){return f},iC:function(){return c},s9:function(){return u},v:function(){return p},xW:function(){return v},zS:function(){return d}});var n=r(29439),i=r(6644),a=r(8548),s=r(57808),o=r(52311);function u(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=!(n&&"u8"===t.pixelType),u=i?a.Br.FLOAT:a.Br.UNSIGNED_BYTE,l=null==t.pixels||0===t.pixels.length?null:i?t.getAsRGBAFloat():t.getAsRGBA(),c=e.capabilities.textureFloatLinear,h=new o.X;return h.width=t.width,h.height=t.height,h.internalFormat=i?a.lP.RGBA32F:a.VI.RGBA,h.samplingMode=!c||"bilinear"!==r&&"cubic"!==r?a.cw.NEAREST:a.cw.LINEAR,h.dataType=u,h.wrapMode=a.e8.CLAMP_TO_EDGE,new s.x(e,h,l)}function l(e,t){var r=t.spacing,i=t.offsets,u=t.coefficients,l=(0,n.Z)(t.size,2),c=l[0],h=l[1],f=r[0]>1,d=new o.X;d.width=f?4*c:c,d.height=h,d.internalFormat=a.lP.RGBA32F,d.dataType=a.Br.FLOAT,d.samplingMode=a.cw.NEAREST,d.wrapMode=a.e8.CLAMP_TO_EDGE;var v=new Float32Array(f?c*h*16:2*i.length);if(f&&null!=u)for(var m=0,p=0;m<u.length;m++)v[p++]=u[m],m%3==2&&(v[p++]=1);else for(var g=0;g<h;g++)for(var y=0;y<c;y++){var _=4*(g*c+y),x=2*(y*h+g);v[_]=i[x],v[_+1]=i[x+1],v[_+3]=-1===i[x]?0:1}return new s.x(e,d,v)}function c(e,t){var r=new o.X;return r.internalFormat=a.VI.RGBA,r.width=t.length/4,r.height=1,r.samplingMode=a.cw.NEAREST,r.wrapMode=a.e8.CLAMP_TO_EDGE,new s.x(e,r,t)}function h(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return{u_flipY:a,u_applyTransform:!!e,u_opacity:n,u_transformSpacing:e?e.spacing:i.AG,u_transformGridSize:e?e.size:i.AG,u_targetImageSize:t,u_srcImageSize:r}}function f(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function d(e,t){return{u_scale:e,u_offset:t}}function v(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function m(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function p(e,t){var r=e.gl,n=t.glName,i=new Map;if(null==n)return i;for(var a,s=r.getProgramParameter(n,r.ACTIVE_UNIFORMS),o=0;o<s;o++)(a=r.getActiveUniform(n,o))&&i.set(a.name,{location:r.getUniformLocation(n,a.name),info:a});return i}function g(e,t,r){Object.keys(r).forEach((function(n){var i=t.get(n)||t.get(n+"[0]");i&&function(e,t,r,n){if(null===n||null==r)return!1;var i=n.info;switch(i.type){case a.Se.FLOAT:i.size>1?e.setUniform1fv(t,r):e.setUniform1f(t,r);break;case a.Se.FLOAT_VEC2:e.setUniform2fv(t,r);break;case a.Se.FLOAT_VEC3:e.setUniform3fv(t,r);break;case a.Se.FLOAT_VEC4:e.setUniform4fv(t,r);break;case a.Se.FLOAT_MAT3:e.setUniformMatrix3fv(t,r);break;case a.Se.FLOAT_MAT4:e.setUniformMatrix4fv(t,r);break;case a.Se.INT:i.size>1?e.setUniform1iv(t,r):e.setUniform1i(t,r);break;case a.Se.BOOL:e.setUniform1i(t,r?1:0);break;case a.Se.INT_VEC2:case a.Se.BOOL_VEC2:e.setUniform2iv(t,r);break;case a.Se.INT_VEC3:case a.Se.BOOL_VEC3:e.setUniform3iv(t,r);break;case a.Se.INT_VEC4:case a.Se.BOOL_VEC4:e.setUniform4iv(t,r);break;default:return!1}}(e,n,r[n],i)}))}function y(e,t,r,n){r.length===n.length&&(n.some((function(e){return null==e}))||r.some((function(e){return null==e}))||r.forEach((function(r,i){t.setUniform1i(r,i),e.bindTexture(n[i],i)})))}}}]);
//# sourceMappingURL=5954.38fe97b2.chunk.js.map