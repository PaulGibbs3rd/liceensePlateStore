"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[77043],{77043:function(e,t,n){n.r(t),n.d(t,{ElevationQuery:function(){return b},GeometryDescriptor:function(){return R},getFinestLodIndex:function(){return q}});var r=n(60136),a=n(29388),i=n(37762),l=n(74165),o=n(1413),u=n(15861),s=n(15671),c=n(43144),f=n(14921),h=n(10064),p=n(92026),v=n(66978),m=n(68860),d=n(77577),y=n(848),x=n(29909),Z=n(79803),k=n(65156),w=n(8904),g=n(76081),T=n(87960),b=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"queryAll",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r){var a,i,u,s,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=null!==r&&void 0!==r&&r.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new h.Z("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:return a=R.fromGeometry(n),i=!1,(null===r||void 0===r?void 0:r.returnSampleInfo)||(i=!0),u=(0,o.Z)((0,o.Z)((0,o.Z)({},I),r),{},{returnSampleInfo:!0}),e.next=8,this.query(t[t.length-1],a,u);case 8:return s=e.sent,e.next=11,this._queryAllContinue(t,s,u);case 11:return c=e.sent,e.abrupt("return",(c.geometry=c.geometry.export(),i&&delete c.sampleInfo,c));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r){var a,i,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new h.Z("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&(n instanceof R||"point"===n.type||"multipoint"===n.type||"polyline"===n.type)){e.next=4;break}throw new h.Z("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");case 4:return a=(0,o.Z)((0,o.Z)({},I),r),i=new E(t,n.spatialReference,a),u=a.signal,e.next=7,t.load({signal:u});case 7:return e.next=9,C(i,n,u);case 9:return e.next=11,this._selectTiles(i,u);case 11:return e.next=13,j(i,u);case 13:return P(i),e.abrupt("return",U(i,u));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createSampler",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r){var a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new h.Z("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new h.Z("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return a=(0,o.Z)((0,o.Z)({},I),r),e.abrupt("return",this._createSampler(t,n,a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createSamplerAll",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r){var a,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=null!==r&&void 0!==r&&r.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new h.Z("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new h.Z("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return a=(0,o.Z)((0,o.Z)((0,o.Z)({},I),r),{},{returnSampleInfo:!0}),e.next=7,this._createSampler(t[t.length-1],n,a);case 7:return i=e.sent,e.abrupt("return",this._createSamplerAllContinue(t,n,i,a));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_createSampler",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r,a){var i,o,u,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.signal,e.next=3,t.load({signal:i});case 3:if(o=n.spatialReference,u=t.tileInfo.spatialReference,e.t0=o.equals(u),e.t0){e.next=9;break}return e.next=8,(0,Z.initializeProjection)([{source:o,dest:u}],{signal:i});case 8:n=(0,Z.project)(n,u);case 9:return s=new D(t,n,r,a),e.next=12,this._selectTiles(s,i);case 12:return e.next=14,j(s,i);case 14:return e.abrupt("return",new w.Tl(s.elevationTiles,s.layer.tileInfo,s.options.noDataValue));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"_createSamplerAllContinue",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r,a){var i,o,u,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pop(),t.length){e.next=2;break}return e.abrupt("return",r);case 2:return i=r.samplers.filter((function(e){return!e.tile.hasNoDataValues})).map((function(e){return(0,k.oJ)(e.extent)})),e.next=5,this._createSampler(t[t.length-1],n,a,i);case 5:if(0!==(o=e.sent).samplers.length){e.next=8;break}return e.abrupt("return",r);case 8:return u=r.samplers.concat(o.samplers),s=new w.Tl(u,a.noDataValue),e.abrupt("return",this._createSamplerAllContinue(t,n,s,a));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"_queryAllContinue",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r){var a,i,o,u,s,c,f,h,v,m;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=t.pop(),i=n.geometry.coordinates,o=n.sampleInfo,(0,p.O3)(o),u=[],s=[],c=0;c<i.length;c++)(f=o[c]).demResolution>=0?f.source||(f.source=a):t.length&&(u.push(i[c]),s.push(c));if(t.length&&0!==u.length){e.next=6;break}return e.abrupt("return",n);case 6:return h=n.geometry.clone(u),e.next=9,this.query(t[t.length-1],h,r);case 9:if(v=e.sent,m=v.sampleInfo){e.next=13;break}throw new Error("no sampleInfo");case 13:return e.abrupt("return",(s.forEach((function(e,t){i[e].z=v.geometry.coordinates[t].z,o[e].demResolution=m[t].demResolution})),this._queryAllContinue(t,n,r)));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_selectTiles",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("geometry"===t.type&&M(t),"number"!=typeof(r=t.options.demResolution)){e.next=6;break}V(t,r),e.next=15;break;case 6:if("finest-contiguous"!==r){e.next=11;break}return e.next=9,this._selectTilesFinestContiguous(t,n);case 9:e.next=15;break;case 11:if("auto"===r){e.next=13;break}throw new h.Z("elevation-query:invalid-dem-resolution","Invalid dem resolution value '".concat(r,'\', expected a number, "finest-contiguous" or "auto"'));case 13:return e.next=15,this._selectTilesAuto(t,n);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_selectTilesFinestContiguous",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layer,a=r.tileInfo,i=r.tilemapCache,o=q(a,i,t.options.minDemResolution),e.next=3,this._selectTilesFinestContiguousAt(t,o,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_selectTilesFinestContiguousAt",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n,r){var a,i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.layer,t.selectTilesAtLOD(n),!(n<0)){e.next=3;break}return e.abrupt("return");case 3:if(i=a.tilemapCache,o=t.getTilesToFetch(),e.prev=4,!i||B(i)){e.next=10;break}return e.next=8,(0,v.Hl)(Promise.all(o.map((function(e){return i.fetchAvailability(e.level,e.row,e.col,{signal:r})}))),r);case 8:e.next=14;break;case 10:return e.next=12,j(t,r);case 12:if(t.allElevationTilesFetched()){e.next=14;break}throw t.clearElevationTiles(),new h.Z("elevation-query:has-unavailable-tiles");case 14:e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(4),(0,v.r9)(e.t0),e.next=21,this._selectTilesFinestContiguousAt(t,n-1,r);case 21:case"end":return e.stop()}}),e,this,[[4,16]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_selectTilesAuto",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F(t),O(t),(r=t.layer.tilemapCache)&&!B(r)){e.next=4;break}return e.abrupt("return",this._selectTilesAutoPrefetchUpsample(t,n));case 4:return a=t.getTilesToFetch(),i={},o=a.map(function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var a,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new T.f(null,0,0,0,(0,k.Ue)()),e.next=3,(0,f.q6)(r.fetchAvailabilityUpsample(t.level,t.row,t.col,a,{signal:n}));case 3:!1!==(o=e.sent).ok?null!=t.id&&(i[t.id]=a):(0,v.r9)(o.error);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,(0,v.Hl)(Promise.all(o),n);case 7:t.remapTiles(i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_selectTilesAutoPrefetchUpsample",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n){var r,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layer.tileInfo,e.next=3,j(t,n);case 3:if(a=!1,t.forEachTileToFetch((function(e,t){r.upsampleTile(e)?a=!0:t()})),e.t0=a,!e.t0){e.next=9;break}return e.next=9,this._selectTilesAutoPrefetchUpsample(t,n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),R=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"export",value:function(){return this._exporter(this.coordinates,this.spatialReference)}},{key:"clone",value:function(t){var n=new e;return n.geometry=this.geometry,n.spatialReference=this.spatialReference,n.coordinates=t||this.coordinates.map((function(e){return e.clone()})),n._exporter=this._exporter,n}},{key:"project",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.spatialReference.equals(t)){e.next=2;break}return e.abrupt("return",this.clone());case 2:return e.next=4,(0,Z.initializeProjection)([{source:this.spatialReference,dest:t}],{signal:n});case 4:if(r=new d.Z({spatialReference:this.spatialReference,points:this.coordinates.map((function(e){return[e.x,e.y]}))}),a=(0,Z.project)(r,t)){e.next=7;break}return e.abrupt("return",null);case 7:return i=this.coordinates.map((function(e,t){var n=e.clone(),r=a.points[t];return n.x=r[0],n.y=r[1],n})),o=this.clone(i),e.abrupt("return",(o.spatialReference=t,o));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}],[{key:"fromGeometry",value:function(t){var n=new e;if(n.geometry=t,n.spatialReference=t.spatialReference,t instanceof e)n.coordinates=t.coordinates.map((function(e){return e.clone()})),n._exporter=function(e,n){var r=t.clone(e);return r.spatialReference=n,r};else switch(t.type){case"point":var r=t,a=r.hasZ,l=r.hasM;n.coordinates=a&&l?[new _(r.x,r.y,r.z,r.m)]:a?[new _(r.x,r.y,r.z)]:l?[new _(r.x,r.y,null,r.m)]:[new _(r.x,r.y)],n._exporter=function(e,n){return t.hasM?new y.Z(e[0].x,e[0].y,e[0].z,e[0].m,n):new y.Z(e[0].x,e[0].y,e[0].z,n)};break;case"multipoint":var o=t,u=o.hasZ,s=o.hasM;n.coordinates=u&&s?o.points.map((function(e){return new _(e[0],e[1],e[2],e[3])})):u?o.points.map((function(e){return new _(e[0],e[1],e[2])})):s?o.points.map((function(e){return new _(e[0],e[1],null,e[2])})):o.points.map((function(e){return new _(e[0],e[1])})),n._exporter=function(e,n){return t.hasM?new d.Z({points:e.map((function(e){return[e.x,e.y,e.z,e.m]})),hasZ:!0,hasM:!0,spatialReference:n}):new d.Z(e.map((function(e){return[e.x,e.y,e.z]})),n)};break;case"polyline":var c,f=t,h=[],p=[],v=t.hasZ,m=t.hasM,Z=0,k=(0,i.Z)(f.paths);try{for(k.s();!(c=k.n()).done;){var w=c.value;if(p.push([Z,Z+w.length]),Z+=w.length,v&&m){var g,T=(0,i.Z)(w);try{for(T.s();!(g=T.n()).done;){var b=g.value;h.push(new _(b[0],b[1],b[2],b[3]))}}catch(V){T.e(V)}finally{T.f()}}else if(v){var R,A=(0,i.Z)(w);try{for(A.s();!(R=A.n()).done;){var E=R.value;h.push(new _(E[0],E[1],E[2]))}}catch(V){A.e(V)}finally{A.f()}}else if(m){var D,q=(0,i.Z)(w);try{for(q.s();!(D=q.n()).done;){var I=D.value;h.push(new _(I[0],I[1],null,I[2]))}}catch(V){q.e(V)}finally{q.f()}}else{var C,z=(0,i.Z)(w);try{for(z.s();!(C=z.n()).done;){var M=C.value;h.push(new _(M[0],M[1]))}}catch(V){z.e(V)}finally{z.f()}}}}catch(V){k.e(V)}finally{k.f()}n.coordinates=h,n._exporter=function(e,n){var r=t.hasM?e.map((function(e){return[e.x,e.y,e.z,e.m]})):e.map((function(e){return[e.x,e.y,e.z]})),a=p.map((function(e){return r.slice(e[0],e[1])}));return new x.Z({paths:a,hasM:t.hasM,hasZ:!0,spatialReference:n})}}return n}}]),e}(),_=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;(0,s.Z)(this,e),this.x=t,this.y=n,this.z=r,this.m=a,this.tile=i,this.elevationTile=l}return(0,c.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.m)}}]),e}(),A=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.layer=t,this.options=n})),E=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e,r,a){var i;return(0,s.Z)(this,n),(i=t.call(this,e,a)).outSpatialReference=r,i.type="geometry",i}return(0,c.Z)(n,[{key:"selectTilesAtLOD",value:function(e){if(e<0)this.geometry.coordinates.forEach((function(e){return e.tile=null}));else{var t=this.layer,n=t.tileInfo,r=t.tilemapCache,a=S(n,r)[e].level;this.geometry.coordinates.forEach((function(e){return e.tile=n.tileAt(a,e.x,e.y)}))}}},{key:"allElevationTilesFetched",value:function(){return!this.geometry.coordinates.some((function(e){return!e.elevationTile}))}},{key:"clearElevationTiles",value:function(){var e,t=(0,i.Z)(this.geometry.coordinates);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.elevationTile!==this.outsideExtentTile&&(n.elevationTile=null)}}catch(r){t.e(r)}finally{t.f()}}},{key:"populateElevationTiles",value:function(e){var t,n=(0,i.Z)(this.geometry.coordinates);try{for(n.s();!(t=n.n()).done;){var r,a=t.value;!a.elevationTile&&(null===(r=a.tile)||void 0===r?void 0:r.id)&&(a.elevationTile=e[a.tile.id])}}catch(l){n.e(l)}finally{n.f()}}},{key:"remapTiles",value:function(e){var t,n=(0,i.Z)(this.geometry.coordinates);try{for(n.s();!(t=n.n()).done;){var r,a=t.value,l=null===(r=a.tile)||void 0===r?void 0:r.id;a.tile=l?e[l]:null}}catch(o){n.e(o)}finally{n.f()}}},{key:"getTilesToFetch",value:function(){var e,t={},n=[],r=(0,i.Z)(this.geometry.coordinates);try{for(r.s();!(e=r.n()).done;){var a,l=e.value,o=l.tile;if(o){var u=null===(a=l.tile)||void 0===a?void 0:a.id;l.elevationTile||!u||t[u]||(t[u]=o,n.push(o))}}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"forEachTileToFetch",value:function(e){var t,n=(0,i.Z)(this.geometry.coordinates);try{var r=function(){var n=t.value;n.tile&&!n.elevationTile&&e(n.tile,(function(){n.tile=null}))};for(n.s();!(t=n.n()).done;)r()}catch(a){n.e(a)}finally{n.f()}}}]),n}(A),D=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e,r,a,i){var l;return(0,s.Z)(this,n),(l=t.call(this,e,a)).type="extent",l.elevationTiles=[],l._candidateTiles=[],l._fetchedCandidates=new Set,l.extent=r.clone().intersection(e.fullExtent),l.maskExtents=i,l}return(0,c.Z)(n,[{key:"selectTilesAtLOD",value:function(e,t){var n=this._maximumLodForRequests(t),r=Math.min(n,e);r<0?this._candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(r)}},{key:"_maximumLodForRequests",value:function(e){var t=this.layer,n=t.tileInfo,r=S(n,t.tilemapCache);if(!e)return r.length-1;var a=this.extent;if(null==a)return-1;for(var i=r.length-1;i>=0;i--){var l=r[i],o=l.resolution*n.size[0],u=l.resolution*n.size[1];if(Math.ceil(a.width/o)*Math.ceil(a.height/u)<=e)return i}return-1}},{key:"allElevationTilesFetched",value:function(){return this._candidateTiles.length===this.elevationTiles.length}},{key:"clearElevationTiles",value:function(){this.elevationTiles.length=0,this._fetchedCandidates.clear()}},{key:"populateElevationTiles",value:function(e){var t,n=(0,i.Z)(this._candidateTiles);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.id&&e[r.id];a&&(this._fetchedCandidates.add(r),this.elevationTiles.push(a))}}catch(l){n.e(l)}finally{n.f()}}},{key:"remapTiles",value:function(e){this._candidateTiles=H(this._candidateTiles.map((function(t){return e[t.id]})))}},{key:"getTilesToFetch",value:function(){return this._candidateTiles}},{key:"forEachTileToFetch",value:function(e,t){var n=this,r=this._candidateTiles;this._candidateTiles=[],r.forEach((function(r){if(n._fetchedCandidates.has(r))t&&t(r);else{var a=!1;e(r,(function(){return a=!0})),a?t&&t(r):n._candidateTiles.push(r)}})),this._candidateTiles=H(this._candidateTiles,t)}},{key:"_selectCandidateTilesCoveringExtentAt",value:function(e){this._candidateTiles.length=0;var t=this.extent;if(null!=t){var n=this.layer,r=n.tileInfo,a=S(r,n.tilemapCache)[e],i=r.tileAt(a.level,t.xmin,t.ymin),l=i.extent;if(null!=l)for(var o=a.resolution*r.size[0],u=a.resolution*r.size[1],s=Math.ceil((t.xmax-l[0])/o),c=Math.ceil((t.ymax-l[1])/u),f=0;f<c;f++)for(var h=0;h<s;h++){var p=new T.f(null,i.level,i.row-f,i.col+h);r.updateTileInfo(p),this._tileIsMasked(p)||this._candidateTiles.push(p)}}}},{key:"_tileIsMasked",value:function(e){return!!this.maskExtents&&this.maskExtents.some((function(t){return e.extent&&(0,k.r3)(t,e.extent)}))}}]),n}(A);function q(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=S(e,t),a=r.length-1;if(n>0){var i=n/(0,m.c9)(e.spatialReference),l=r.findIndex((function(e){return e.resolution<i}));0===l?a=0:l>0&&(a=l-1)}return a}var I={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0};function C(e,t,n){return z.apply(this,arguments)}function z(){return(z=(0,u.Z)((0,l.Z)().mark((function e(t,n,r){var a,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.layer.tileInfo.spatialReference,!(n instanceof R)){e.next=7;break}return e.next=4,n.project(i,r);case 4:a=e.sent,e.next=10;break;case 7:return e.next=9,(0,Z.initializeProjection)([{source:n.spatialReference,dest:i}],{signal:r});case 9:a=(0,Z.project)(n,i);case 10:if(a){e.next=12;break}throw new h.Z("elevation-query:spatial-reference-mismatch","Cannot query elevation in '".concat(n.spatialReference.wkid,"' on an elevation service in '").concat(i.wkid,"'"));case 12:t.geometry=R.fromGeometry(a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){if(null!=e.layer.fullExtent){var t=new g.R(null);t.sample=function(){return e.options.noDataValue},e.outsideExtentTile=t;var n=e.layer.fullExtent;e.geometry.coordinates.forEach((function(e){var r=e.x,a=e.y;(r<n.xmin||r>n.xmax||a<n.ymin||a>n.ymax)&&(e.elevationTile=t)}))}}function V(e,t){var n=function(e,t){for(var n=e.layer,r=n.tileInfo,a=n.tilemapCache,i=t/(0,m.c9)(r.spatialReference),l=S(r,a),o=l[0],u=0,s=1;s<l.length;s++){var c=l[s];Math.abs(c.resolution-i)<Math.abs(o.resolution-i)&&(o=c,u=s)}return u}(e,t);e.selectTilesAtLOD(n)}function F(e){var t=e.layer,n=q(t.tileInfo,t.tilemapCache,e.options.minDemResolution);e.selectTilesAtLOD(n,e.options.maximumAutoTileRequests)}function S(e,t){var n=e.lods;if(B(t)){var r=t.effectiveMinLOD,a=t.effectiveMaxLOD;return n.filter((function(e){return e.level>=r&&e.level<=a}))}return n}function j(e,t){return L.apply(this,arguments)}function L(){return L=(0,u.Z)((0,l.Z)().mark((function e(t,n){var r,a,i,o,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getTilesToFetch(),a={},i=t.options.cache,o=t.options.noDataValue,s=r.map(function(){var e=(0,u.Z)((0,l.Z)().mark((function e(r){var u,s,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r.id){e.next=2;break}return e.abrupt("return");case 2:if(u="".concat(t.layer.uid,":").concat(r.id,":").concat(o),null==(s=null!=i?i.get(u):null)){e.next=8;break}e.t0=s,e.next=11;break;case 8:return e.next=10,t.layer.fetchTile(r.level,r.row,r.col,{noDataValue:o,signal:n});case 10:e.t0=e.sent;case 11:c=e.t0,null!=i&&i.put(u,c),a[r.id]=new g.R(r,c);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,(0,v.Hl)(Promise.allSettled(s),n);case 3:t.populateElevationTiles(a);case 4:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function O(e){var t=e.layer.tileInfo,n=0,r={},a=function(e){null!=e.id&&(e.id in r?r[e.id]++:(r[e.id]=1,n++))},i=function(e){if(null!=e.id){var t=r[e.id];1===t?(delete r[e.id],n--):r[e.id]=t-1}};e.forEachTileToFetch(a,i);for(var l=!0;l&&(l=!1,e.forEachTileToFetch((function(r){n<=e.options.maximumAutoTileRequests||(i(r),t.upsampleTile(r)&&(l=!0),a(r))}),i),l););}function P(e){e.geometry.coordinates.forEach((function(t){var n=t.elevationTile,r=e.options.noDataValue;if(n){var a=n.sample(t.x,t.y);null!=a?r=a:t.elevationTile=null}t.z=r}))}function H(e,t){var n,r={},a=[],l=(0,i.Z)(e);try{for(l.s();!(n=l.n()).done;){var o=n.value,u=o.id;u&&!r[u]?(r[u]=o,a.push(o)):t&&t(o)}}catch(c){l.e(c)}finally{l.f()}var s=a.sort((function(e,t){return e.level-t.level}));return s.filter((function(e,n){for(var r=0;r<n;r++){var a=s[r].extent;if(a&&e.extent&&(0,k.r3)(a,e.extent))return t&&t(e),!1}return!0}))}function U(e,t){return G.apply(this,arguments)}function G(){return(G=(0,u.Z)((0,l.Z)().mark((function e(t,n){var r,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.geometry.project(t.outSpatialReference,n);case 2:return r=e.sent,(0,p.O3)(r),a={geometry:r.export(),noDataValue:t.options.noDataValue},e.abrupt("return",(t.options.returnSampleInfo&&(a.sampleInfo=N(t)),t.geometry.coordinates.forEach((function(e){e.tile=null,e.elevationTile=null})),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){var t=e.layer.tileInfo,n=(0,m.c9)(t.spatialReference);return e.geometry.coordinates.map((function(r){var a=-1;return r.elevationTile&&r.elevationTile!==e.outsideExtentTile&&(a=t.lodAt(r.elevationTile.tile.level).resolution*n),{demResolution:a}}))}function B(e){return null!=(null===e||void 0===e?void 0:e.tileInfo)}},8904:function(e,t,n){n.d(t,{G$:function(){return x},OB:function(){return d},Tl:function(){return y}});var r=n(37762),a=n(60136),i=n(29388),l=n(15671),o=n(43144),u=(n(59486),n(93169),n(42537)),s=n(32718),c=n(68860),f=n(65156),h=n(81753),p=n(848),v=function(){return s.Z.getLogger("esri.layers.support.ElevationSampler")},m=function(){function e(){(0,l.Z)(this,e)}return(0,o.Z)(e,[{key:"queryElevation",value:function(e){return x(e.clone(),this)}},{key:"on",value:function(){return(0,u.kB)()}},{key:"projectIfRequired",value:function(e,t){return Z(e,t)}}]),e}(),d=function(e){(0,a.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,a){var i;(0,l.Z)(this,n),(i=t.call(this)).tile=e,i.noDataValue=a;var o=e.tile.extent;i.extent=(0,f.HH)(o,r.spatialReference),i.extent.zmin=e.zmin,i.extent.zmax=e.zmax,i._aaExtent=o;var u=(0,c.c9)(r.spatialReference),s=r.lodAt(e.tile.level).resolution*u;return i.demResolution={min:s,max:s},i}return(0,o.Z)(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"contains",value:function(e){var t=this.projectIfRequired(e,this.spatialReference);return null!=t&&this.containsAt(t.x,t.y)}},{key:"containsAt",value:function(e,t){return(0,f.jE)(this._aaExtent,e,t)}},{key:"elevationAt",value:function(e,t){var n;if(!this.containsAt(e,t)){var r=this.extent,a="".concat(r.xmin,", ").concat(r.ymin,", ").concat(r.xmax,", ").concat(r.ymax);return v().warn("#elevationAt()","Point used to sample elevation (".concat(e,", ").concat(t,") is outside of the sampler extent (").concat(a,")")),this.noDataValue}return null!==(n=this.tile.sample(e,t))&&void 0!==n?n:this.noDataValue}}]),n}(m),y=function(e){(0,a.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,a){var i,o;(0,l.Z)(this,n),i=t.call(this),"number"==typeof r?(i.noDataValue=r,o=null):(o=r,i.noDataValue=a),i.samplers=o?e.map((function(e){return new d(e,o,i.noDataValue)})):e;var u=i.samplers[0];if(u){i.extent=u.extent.clone();var s=u.demResolution,c=s.min,h=s.max;i.demResolution={min:c,max:h};for(var p=1;p<i.samplers.length;p++){var v=i.samplers[p];i.extent.union(v.extent),i.demResolution.min=Math.min(i.demResolution.min,v.demResolution.min),i.demResolution.max=Math.max(i.demResolution.max,v.demResolution.max)}}else i.extent=(0,f.HH)((0,f.Ue)(),o.spatialReference),i.demResolution={min:0,max:0};return i}return(0,o.Z)(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"elevationAt",value:function(e,t){var n,a,i=!1,l=(0,r.Z)(this.samplers);try{for(l.s();!(a=l.n()).done;){var o=a.value;if(o.containsAt(e,t)&&(i=!0,(n=o.elevationAt(e,t))!==o.noDataValue))return n}}catch(u){l.e(u)}finally{l.f()}return null!=n?n:(i||v().warn("#elevationAt()","Point used to sample elevation (".concat(e,", ").concat(t,") is outside of the sampler")),this.noDataValue)}}]),n}(m);function x(e,t){var n=Z(e,t.spatialReference);if(!n)return null;switch(e.type){case"point":!function(e,t,n){e.z=n.elevationAt(t.x,t.y)}(e,n,t);break;case"polyline":!function(e,t,n){k.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,a=0;a<e.paths.length;a++)for(var i=e.paths[a],l=t.paths[a],o=0;o<i.length;o++){var u=i[o],s=l[o];k.x=s[0],k.y=s[1],r&&(u[3]=u[2]),u[2]=n.elevationAt(k.x,k.y)}e.hasZ=!0}(e,n,t);break;case"multipoint":!function(e,t,n){k.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,a=0;a<e.points.length;a++){var i=e.points[a],l=t.points[a];k.x=l[0],k.y=l[1],r&&(i[3]=i[2]),i[2]=n.elevationAt(k.x,k.y)}e.hasZ=!0}(e,n,t)}return e}function Z(e,t){if(null==e)return null;var n=e.spatialReference;if(n.equals(t))return e;var r=(0,h.iV)(e,t);return r||v().error("Cannot project geometry spatial reference (wkid:".concat(n.wkid,") to elevation sampler spatial reference (wkid:").concat(t.wkid,")")),r}var k=new p.Z},11939:function(e,t,n){n.d(t,{K:function(){return i}});var r=n(43144),a=n(15671),i=(0,r.Z)((function e(t,n){(0,a.Z)(this,e),this.data=t,this.safeWidth=.99999999*(t.width-1),this.dx=(t.width-1)/(n[2]-n[0]),this.dy=(t.width-1)/(n[3]-n[1]),this.x0=n[0],this.y1=n[3]}))},76081:function(e,t,n){n.d(t,{R:function(){return l}});var r=n(15671),a=n(43144),i=n(11939),l=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if((0,r.Z)(this,e),this.tile=t,null!=n&&null!=t){var a=t.extent;this._samplerData=new i.K(n,a)}}return(0,a.Z)(e,[{key:"zmin",get:function(){return null!=this._samplerData?this._samplerData.data.minValue:0}},{key:"zmax",get:function(){return null!=this._samplerData?this._samplerData.data.maxValue:0}},{key:"hasNoDataValues",get:function(){var e;return!(null===(e=this._samplerData)||void 0===e||!e.data.hasNoDataValues)}},{key:"sample",value:function(e,t){if(null!=this._samplerData){var n=this._samplerData,r=n.safeWidth,a=n.data,i=n.dx,l=n.dy,u=n.y1,s=n.x0,c=a.width,f=a.values,h=a.noDataValue,p=o(l*(u-t),0,r),v=o(i*(e-s),0,r),m=Math.floor(p),d=Math.floor(v),y=m*c+d,x=y+c,Z=f[y],k=f[x],w=f[y+1],g=f[x+1];if(Z!==h&&k!==h&&w!==h&&g!==h){var T=v-d,b=Z+(w-Z)*T;return b+(k+(g-k)*T-b)*(p-m)}}}}]),e}();function o(e,t,n){return e<t?t:e>n?n:e}}}]);
//# sourceMappingURL=77043.eafd6d5b.chunk.js.map