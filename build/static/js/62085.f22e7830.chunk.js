"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[62085],{59447:function(e,t,r){r.d(t,{r:function(){return n}});var i=r(15671),a=r(43144),n=function(){function e(){(0,i.Z)(this,e),this._outer=new Map}return(0,a.Z)(e,[{key:"clear",value:function(){this._outer.clear()}},{key:"empty",get:function(){return 0===this._outer.size}},{key:"get",value:function(e,t){var r;return null===(r=this._outer.get(e))||void 0===r?void 0:r.get(t)}},{key:"set",value:function(e,t,r){var i=this._outer.get(e);i?i.set(t,r):this._outer.set(e,new Map([[t,r]]))}},{key:"delete",value:function(e,t){var r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}},{key:"forEach",value:function(e){this._outer.forEach((function(t,r){return e(t,r)}))}}]),e}()},91958:function(e,t,r){r.d(t,{$7:function(){return p},$e:function(){return u},N5:function(){return f},lW:function(){return l}});var i=r(74165),a=r(15861),n=(r(93169),r(10064)),s=r(66978),o=r(35995);function u(e){var t=d(e);return null!=t?t.toDataURL():""}function l(e,t){return h.apply(this,arguments)}function h(){return h=(0,a.Z)((0,i.Z)().mark((function e(t,r){var a,o,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(a=d(t))){e.next=3;break}throw new n.Z("imageToArrayBuffer","Unsupported image type");case 3:return o=c(t),e.next=6,new Promise((function(e){return a.toBlob(e,o)}));case 6:if(u=e.sent,(0,s.k_)(r),u){e.next=9;break}throw new n.Z("imageToArrayBuffer","Failed to encode image");case 9:return e.next=11,u.arrayBuffer();case 11:return l=e.sent,e.abrupt("return",((0,s.k_)(r),{data:l,type:o}));case 13:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function c(e){if(!(e instanceof HTMLImageElement))return"image/png";var t=e.src;if((0,o.HK)(t)){var r=(0,o.sJ)(t);return"image/jpeg"===(null===r||void 0===r?void 0:r.mediaType)?r.mediaType:"image/png"}return/\.png$/i.test(t)?"image/png":/\.(jpg|jpeg)$/i.test(t)?"image/jpeg":"image/png"}function d(e){if(e instanceof HTMLCanvasElement)return e;if(e instanceof HTMLVideoElement)return null;var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return e instanceof HTMLImageElement?r.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&r.putImageData(e,0,0),t}function f(e){for(var t=[],r=new Uint8Array(e),i=0;i<r.length;i++)t.push(String.fromCharCode(r[i]));return"data:application/octet-stream;base64,"+btoa(t.join(""))}function p(e){if(e.byteLength<8)return!1;var t=new Uint8Array(e);return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]}},38330:function(e,t,r){r.d(t,{t:function(){return o}});var i=r(74165),a=r(1413),n=r(15861),s=r(76200);function o(e,t){return u.apply(this,arguments)}function u(){return u=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.Z)(t,(0,a.Z)({responseType:"image"},r));case 2:return n=e.sent,o=n.data,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}},59001:function(e,t,r){r.d(t,{Z:function(){return l}});var i=r(74165),a=r(15861),n=r(15671),s=r(43144),o=r(82272),u=r(51e3),l=function(){function e(){(0,n.Z)(this,e),this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}return(0,s.Z)(e,[{key:"destroy",value:function(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}},{key:"getResource",value:function(e){var t;return null!==(t=this._resourceMap.get(e))&&void 0!==t?t:null}},{key:"fetchResource",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var a,n,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=this._resourceMap.get(t))){e.next=3;break}return e.abrupt("return",{width:a.width,height:a.height});case 3:return n=this._inFlightResourceMap.get(t),e.abrupt("return",n?n.then((function(e){return{width:e.width,height:e.height}})):(n=(0,u.n$)(t,r),this._inFlightResourceMap.set(t,n),n.then((function(e){return s._inFlightResourceMap.delete(t),s._resourceMap.set(t,e),{width:e.width,height:e.height}}),(function(){return{width:0,height:0}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteResource",value:function(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}},{key:"loadFont",value:function(e){return(0,o.mx)(e)}}]),e}()},6388:function(e,t,r){r.d(t,{Fp:function(){return l},RL:function(){return f},UV:function(){return d},bk:function(){return c}});var i=r(29439),a=r(37762),n=r(46228),s=r(77981),o=r(691),u=r(94109);function l(e){switch(e.type){case"CIMPointSymbol":var t=e.symbolLayers;if(!t||1!==t.length)return null;var r=t[0];return"CIMVectorMarker"!==r.type?null:l(r);case"CIMVectorMarker":var i,a=e.markerGraphics;if(!a||1!==a.length)return null;var n=a[0];if(!n)return null;var s=n.geometry;if(!s)return null;var o=n.symbol;return!o||"CIMPolygonSymbol"!==o.type&&"CIMLineSymbol"!==o.type||null!==(i=o.symbolLayers)&&void 0!==i&&i.some((function(e){return!!e.effects}))?null:{type:"sdf",geom:s,asFill:"CIMPolygonSymbol"===o.type}}}function h(e){var t,r=1/0,i=-1/0,n=1/0,s=-1/0,o=(0,a.Z)(e);try{for(o.s();!(t=o.n()).done;){var u,l=t.value,h=(0,a.Z)(l);try{for(h.s();!(u=h.n()).done;){var c=u.value;c[0]<r&&(r=c[0]),c[0]>i&&(i=c[0]),c[1]<n&&(n=c[1]),c[1]>s&&(s=c[1])}}catch(d){h.e(d)}finally{h.f()}}}catch(d){o.e(d)}finally{o.f()}return[r,n,i,s]}function c(e){return e?e.rings?h(e.rings):e.paths?h(e.paths):(0,s.YX)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function d(e,t,r,a,n){var s=(0,i.Z)(e,4),o=s[0],l=s[1],h=s[2],c=s[3];if(h<o||c<l)return[0,0,0,1];var d=h-o,f=c-l,p=u.iA,v=u.s4,_=Math.floor(.5*(.5*p-v)),m=(p-2*(_+v))/Math.max(d,f),g=Math.round(d*m)+2*_,y=Math.round(f*m)+2*_,b=1;t&&(b=y/m/(t.ymax-t.ymin));var w=0,x=0,k=1;a&&(n?t&&r&&t.ymax-t.ymin>0&&(k=(t.xmax-t.xmin)/(t.ymax-t.ymin),w=a.x/(r*k),x=a.y/r):(w=a.x,x=a.y)),t&&(w=.5*(t.xmax+t.xmin)+w*(t.xmax-t.xmin),x=.5*(t.ymax+t.ymin)+x*(t.ymax-t.ymin)),w-=o,x-=l,w*=m,x*=m;var M=(w+=_)/g-.5,S=(x+=_)/y-.5;return n&&r&&(M*=r*k,S*=r),[b,M,S,k]}function f(e){var t,r=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),n=function(e){var t,r=1/0,i=-1/0,n=1/0,s=-1/0,u=(0,a.Z)(e);try{for(u.s();!(t=u.n()).done;){var l,h=t.value,c=(0,a.Z)(h);try{for(c.s();!(l=c.n()).done;){var d=l.value;d[0]<r&&(r=d[0]),d[0]>i&&(i=d[0]),d[1]<n&&(n=d[1]),d[1]>s&&(s=d[1])}}catch(f){c.e(f)}finally{c.f()}}}catch(f){u.e(f)}finally{u.f()}return new o.Z(r,n,i-r,s-n)}(r),s=u.iA,l=u.s4,h=Math.floor(.5*(.5*s-l)),c=(s-2*(h+l))/Math.max(n.width,n.height),d=Math.round(n.width*c)+2*h,f=Math.round(n.height*c)+2*h,v=[],_=(0,a.Z)(r);try{for(_.s();!(t=_.n()).done;){var m=t.value;if(m&&m.length>1){var g,y=[],b=(0,a.Z)(m);try{for(b.s();!(g=b.n()).done;){var w=g.value,x=(0,i.Z)(w,2),k=x[0],M=x[1];k-=n.x,M-=n.y,k*=c,M*=c,k+=h-.5,M+=h-.5,e.asFill?y.push([k,M]):y.push([Math.round(k),Math.round(M)])}}catch(P){b.e(P)}finally{b.f()}if(e.asFill){var S=y.length-1;y[0][0]===y[S][0]&&y[0][1]===y[S][1]||y.push(y[0])}v.push(y)}}}catch(P){_.e(P)}finally{_.f()}var O=function(e,t,r,i){for(var n=t*r,s=new Array(n),o=i*i+1,u=0;u<n;++u)s[u]=o;var l,h=(0,a.Z)(e);try{for(h.s();!(l=h.n()).done;)for(var c=l.value,d=c.length,f=1;f<d;++f){var p=c[f-1],v=c[f],_=void 0,m=void 0,g=void 0,y=void 0;p[0]<v[0]?(_=p[0],m=v[0]):(_=v[0],m=p[0]),p[1]<v[1]?(g=p[1],y=v[1]):(g=v[1],y=p[1]);var b=Math.floor(_)-i,w=Math.floor(m)+i,x=Math.floor(g)-i,k=Math.floor(y)+i;b<0&&(b=0),w>t&&(w=t),x<0&&(x=0),k>r&&(k=r);for(var M=v[0]-p[0],S=v[1]-p[1],O=M*M+S*S,T=b;T<w;T++)for(var C=x;C<k;C++){var E=T+.5,F=C+.5,z=void 0,R=void 0,B=(E-p[0])*M+(F-p[1])*S;B<0?(z=p[0],R=p[1]):B>O?(z=v[0],R=v[1]):(B/=O,z=p[0]+B*M,R=p[1]+B*S);var A=(E-z)*(E-z)+(F-R)*(F-R),I=(r-C-1)*t+T;A<s[I]&&(s[I]=A)}}}catch(P){h.e(P)}finally{h.f()}for(var Z=0;Z<n;++Z)s[Z]=Math.sqrt(s[Z]);return s}(v,d,f,h);return e.asFill&&function(e,t,r,i,n){var s,o=(0,a.Z)(e);try{for(o.s();!(s=o.n()).done;)for(var u=s.value,l=u.length,h=1;h<l;++h){var c=u[h-1],d=u[h],f=void 0,p=void 0,v=void 0,_=void 0;c[0]<d[0]?(f=c[0],p=d[0]):(f=d[0],p=c[0]),c[1]<d[1]?(v=c[1],_=d[1]):(v=d[1],_=c[1]);var m=Math.floor(f),g=Math.floor(p)+1,y=Math.floor(v),b=Math.floor(_)+1;m<i&&(m=i),g>t-i&&(g=t-i),y<i&&(y=i),b>r-i&&(b=r-i);for(var w=y;w<b;++w)if(c[1]>w!=d[1]>w){for(var x=w+.5,k=(r-w-1)*t,M=m;M<g;++M)M+.5<(d[0]-c[0])*(x-c[1])/(d[1]-c[1])+c[0]&&(n[k+M]=-n[k+M]);for(var S=i;S<m;++S)n[k+S]=-n[k+S]}}}catch(P){o.e(P)}finally{o.f()}}(v,d,f,h,O),[p(O,h),d,f]}function p(e,t){for(var r=2*t,i=e.length,a=new Uint8Array(4*i),s=0;s<i;++s){var o=.5-e[s]/r;(0,n.I)(o,a,4*s)}return a}},26554:function(e,t,r){r.d(t,{Y:function(){return u},m:function(){return l}});var i=r(37762),a=r(93433),n=r(46228),s=r(16889),o=r(51750);function u(e,t,r){var i=t.style,a=(0,s.fp)(Math.ceil(r)),n=function(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e}(i)?8*a:16*a,o=2*a;e.width=n,e.height=n;var u=e.getContext("2d");u.strokeStyle="#FFFFFF",u.lineWidth=a,u.beginPath(),"vertical"!==i&&"cross"!==i&&"esriSFSCross"!==i&&"esriSFSVertical"!==i||(u.moveTo(n/2,-o),u.lineTo(n/2,n+o)),"horizontal"!==i&&"cross"!==i&&"esriSFSCross"!==i&&"esriSFSHorizontal"!==i||(u.moveTo(-o,n/2),u.lineTo(n+o,n/2)),"backward-diagonal"!==i&&"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i&&"esriSFSBackwardDiagonal"!==i||(u.moveTo(-o,-o),u.lineTo(n+o,n+o),u.moveTo(n-o,-o),u.lineTo(n+o,o),u.moveTo(-o,n-o),u.lineTo(o,n+o)),"forward-diagonal"!==i&&"diagonal-cross"!==i&&"esriSFSForwardDiagonal"!==i&&"esriSFSDiagonalCross"!==i||(u.moveTo(n+o,-o),u.lineTo(-o,n+o),u.moveTo(o,-o),u.lineTo(-o,o),u.moveTo(n+o,n-o),u.lineTo(n-o,n+o)),u.stroke();for(var l,h=u.getImageData(0,0,e.width,e.height),c=new Uint8Array(h.data),d=0;d<c.length;d+=4)l=c[d+3]/255,c[d]=c[d]*l,c[d+1]=c[d+1]*l,c[d+2]=c[d+2]*l;return[c,e.width,e.height,a]}function l(e,t){null==e&&(e=[]);var r="Butt"===t,s="Square"===t,u=!r&&!s;e.length%2==1&&(e=[].concat((0,a.Z)(e),(0,a.Z)(e)));var l,h=o.v,c=2*h,d=0,f=(0,i.Z)(e);try{for(f.s();!(l=f.n()).done;){d+=l.value}}catch(F){f.e(F)}finally{f.f()}var p,v=Math.round(d*h),_=new Float32Array(v*c),m=.5*h,g=0,y=0,b=.5,w=!0,x=(0,i.Z)(e);try{for(x.s();!(p=x.n()).done;){var k=p.value;for(g=y,y+=k*h;b<=y;){for(var M=.5;M<c;){var S=(M-.5)*v+b-.5,O=u?(M-h)*(M-h):Math.abs(M-h);_[S]=w?r?Math.max(Math.max(g+m-b,O),Math.max(b-y+m,O)):O:u?Math.min((b-g)*(b-g)+O,(b-y)*(b-y)+O):s?Math.min(Math.max(b-g,O),Math.max(y-b,O)):Math.min(Math.max(b-g+m,O),Math.max(y+m-b,O)),M++}b++}w=!w}}catch(F){x.e(F)}finally{x.f()}for(var P=_.length,T=new Uint8Array(4*P),C=0;C<P;++C){var E=(u?Math.sqrt(_[C]):_[C])/h;(0,n.I)(E,T,4*C)}return[T,v,c]}},47566:function(e,t,r){r.d(t,{y:function(){return s}});var i=r(37762),a=r(15671),n=r(43144),s=function(){function e(){(0,a.Z)(this,e),this._candidateTiles=[]}return(0,n.Z)(e,[{key:"schedule",value:function(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}},{key:"reshuffle",value:function(e){var t,r=[],a=(0,i.Z)(this._candidateTiles);try{for(a.s();!(t=a.n()).done;){var n=t.value;e>0?(n.reshuffle(),e--):r.push(n)}}catch(s){a.e(s)}finally{a.f()}this._candidateTiles=r}}]),e}()},25999:function(e,t,r){r.d(t,{hY:function(){return d}});var i=r(15671),a=r(43144),n=r(42537),s=r(38499),o=(r(91958),r(48202)),u=r(93592);function l(e,t){var r=e.width,i=e.height,a=e.getFrame,n=e.frameDurations.slice(),o=n.pop();return n.push((0,s.HA)(o+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:n,getFrame:a,width:r,height:i}}var h=function(){function e(t,r,a,n){(0,i.Z)(this,e),this._animation=t,this._repeatType=a,this._onFrameData=n,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(var s=0;r>s;)s+=this.timeToFrame,this.nextFrame();var o=this._animation.getFrame(this._currentFrame);this._onFrameData(o)}return(0,a.Z)(e,[{key:"nextFrame",value:function(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case o.of.None:this._currentFrame-=this._direction;break;case o.of.Loop:this._currentFrame=0;break;case o.of.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case o.of.None:this._currentFrame-=this._direction;break;case o.of.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case o.of.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];var e=this._animation.getFrame(this._currentFrame);this._onFrameData(e)}}]),e}();function c(e,t,r,i){var a,n=t.repeatType;if(null==n&&(n=o.of.Loop),!0===t.reverseAnimation&&(e=function(e){var t=e.width,r=e.height,i=e.frameDurations.reverse();return{frameCount:e.frameCount,duration:e.duration,frameDurations:i,getFrame:function(t){var r=e.frameDurations.length-1-t;return e.getFrame(r)},width:t,height:r}}(e)),null!=t.duration&&(e=function(e,t){var r=e.width,i=e.height,a=e.getFrame,n=t/e.duration,o=e.frameDurations.map((function(e){return(0,s.HA)(e*n)}));return{frameCount:e.frameCount,duration:e.duration,frameDurations:o,getFrame:a,width:r,height:i}}(e,(0,s.HA)(1e3*t.duration))),null!=t.repeatDelay){var c=1e3*t.repeatDelay;n===o.of.Loop?e=l(e,(0,s.HA)(c)):n===o.of.Oscillate&&(e=function(e,t){var r=e.width,i=e.height,a=e.getFrame,n=e.frameDurations.slice(),o=n.shift();return n.unshift((0,s.HA)(o+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:n,getFrame:a,width:r,height:i}}(l(e,(0,s.HA)(c/2)),(0,s.HA)(c/2)))}if(null!=t.startTimeOffset)a=(0,s.HA)(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){var d=null!=t.randomizeStartSeed?t.randomizeStartSeed:82749913,f=(0,u.f)(r,d);a=(0,s.HA)(f*function(e){return(0,s.HA)(e.frameDurations.reduce((function(e,t){return e+t}),0))}(e))}else a=(0,s.HA)(0);return new h(e,a,n,i)}function d(e,t,r,i){var a,s=null==t.playAnimation||t.playAnimation,o=c(e,t,r,i),u=o.timeToFrame;return function e(){a=s?setTimeout((function(){o.nextFrame(),u=o.timeToFrame,e()}),u):void 0}(),(0,n.kB)((function(){return s&&clearTimeout(a)}))}},40658:function(e,t,r){r.d(t,{s:function(){return o}});var i=r(54711),a=r(65706),n=function(e){var t="";t+=e[0].toUpperCase();for(var r=1;r<e.length;r++){var i=e[r];i===i.toUpperCase()?(t+="_",t+=i):t+=i.toUpperCase()}return t},s=function(e){var t={};for(var r in e)t[n(r)]=e[r];return(0,a.K)(t)},o=function(e,t,r,a){var n=e+e.substring(e.lastIndexOf("/")),o=t+t.substring(t.lastIndexOf("/")),u=s(a);return{attributes:r,shaders:{vertexShader:u+(0,i.w)("".concat(n,".vert")),fragmentShader:u+(0,i.w)("".concat(o,".frag"))}}}},39444:function(e,t,r){r.d(t,{K:function(){return R}});var i=r(37762),a=r(15671),n=r(43144),s=r(88301),o=r(61120),u=r(60136),l=r(29388),h=r(92026),c=r(58880),d=r(80613),f=r(97890),p=r(93560),v=r(66759),_=0;function m(e,t){return new f.G((0,v.W)(_++),e,t)}var g={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null},y=function(){function e(){(0,a.Z)(this,e),this.instances={fill:m(p.k2.fill,{uniforms:g,optionalAttributes:{zoomRange:!0}}),marker:m(p.k2.marker,{uniforms:g,optionalAttributes:{zoomRange:!0}}),line:m(p.k2.line,{uniforms:g,optionalAttributes:{zoomRange:!0}}),text:m(p.k2.text,{uniforms:g,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}}),complexFill:m(p.k2.complexFill,{uniforms:g,optionalAttributes:{zoomRange:!0}}),texturedLine:m(p.k2.texturedLine,{uniforms:g,optionalAttributes:{zoomRange:!0}})},this._instancesById=Object.values(this.instances).reduce((function(e,t){return e.set(t.instanceId,t),e}),new Map)}return(0,n.Z)(e,[{key:"getInstance",value:function(e){return this._instancesById.get(e)}}]),e}(),b=r(29303),w=r(8768),x=r(30932),k=r(93311),M=r(91340),S=r(87422),O=r(84319),P=r(44070),T=r(8548),C=r(45412),E=Math.PI/180,F=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this))._program=null,i._vao=null,i._vertexBuffer=null,i._indexBuffer=null,i._dvsMat3=(0,w.Ue)(),i._localOrigin={x:0,y:0},i._getBounds=e,i}return(0,n.Z)(r,[{key:"destroy",value:function(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,h.M2)(this._program)}},{key:"doRender",value:function(e){var t=e.context,r=this._getBounds();if(!(r.length<1)){this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,r),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(T.zi.ONE,T.zi.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);var i=this._program;t.bindVAO(this._vao),t.useProgram(i),i.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(T.MX.LINES,8*r.length,T.g.UNSIGNED_INT,0),t.bindVAO()}}},{key:"_createTransforms",value:function(){return{displayViewScreenMat3:(0,w.Ue)()}}},{key:"_createShaderProgram",value:function(e){if(!this._program){this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",z().attributes)}}},{key:"_updateMatricesAndLocalOrigin",value:function(e){var t=e.state,r=t.displayMat3,i=t.size,a=t.resolution,n=t.pixelRatio,s=t.rotation,o=t.viewpoint,u=E*s,l=o.targetGeometry,h=l.x,c=l.y,d=(0,M.or)(h,t.spatialReference);this._localOrigin.x=d,this._localOrigin.y=c;var f=n*i[0],p=n*i[1],v=a*f,_=a*p,m=(0,b.yR)(this._dvsMat3);(0,b.Jp)(m,m,r),(0,b.Iu)(m,m,(0,x.al)(f/2,p/2)),(0,b.bA)(m,m,(0,k.al)(i[0]/v,-p/_,1)),(0,b.U1)(m,m,-u)}},{key:"_updateBufferData",value:function(e,t){var r,a=this._localOrigin,n=a.x,s=a.y,o=8*t.length,u=new Float32Array(o),l=new Uint32Array(8*t.length),h=0,c=0,d=(0,i.Z)(t);try{for(d.s();!(r=d.n()).done;){var f=r.value;f&&(u[2*h]=f[0]-n,u[2*h+1]=f[1]-s,u[2*h+2]=f[0]-n,u[2*h+3]=f[3]-s,u[2*h+4]=f[2]-n,u[2*h+5]=f[3]-s,u[2*h+6]=f[2]-n,u[2*h+7]=f[1]-s,l[c]=h+0,l[c+1]=h+3,l[c+2]=h+3,l[c+3]=h+2,l[c+4]=h+2,l[c+5]=h+1,l[c+6]=h+1,l[c+7]=h+0,h+=4,c+=8)}}catch(v){d.e(v)}finally{d.f()}if(this._vertexBuffer?this._vertexBuffer.setData(u.buffer):this._vertexBuffer=P.f.createVertex(e,T.l1.DYNAMIC_DRAW,u.buffer),this._indexBuffer?this._indexBuffer.setData(l):this._indexBuffer=P.f.createIndex(e,T.l1.DYNAMIC_DRAW,l),!this._vao){var p=z();this._vao=new C.U(e,p.attributes,p.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}]),r}(S.s),z=function(){return(0,O.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:T.g.FLOAT}]})},R=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e))._instanceStore=new y,i.checkHighlight=function(){return!0},i}return(0,n.Z)(r,[{key:"destroy",value:function(){(0,s.Z)((0,o.Z)(r.prototype),"destroy",this).call(this),this._boundsRenderer=(0,h.SC)(this._boundsRenderer)}},{key:"instanceStore",get:function(){return this._instanceStore}},{key:"enableRenderingBounds",value:function(e){this._boundsRenderer=new F(e),this.requestRender()}},{key:"hasHighlight",get:function(){return this.checkHighlight()}},{key:"onTileData",value:function(e,t){e.onMessage(t),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"_renderChildren",value:function(e,t){e.selection=t;var r,a=(0,i.Z)(this.children);try{for(a.s();!(r=a.n()).done;){var n=r.value;if(n.visible){var s=n.getDisplayList(this._instanceStore,d.gl.STRICT_ORDER);null===s||void 0===s||s.render(e)}}}catch(o){a.e(o)}finally{a.f()}}}]),r}(c.b)},75391:function(e,t,r){r.d(t,{Z:function(){return f}});var i=r(37762),a=r(15671),n=r(43144),s=r(88301),o=r(61120),u=r(60136),l=r(29388),h=r(80613),c=r(39444),d=r(39594),f=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"renderChildren",value:function(e){var t,a=(0,i.Z)(this.children);try{for(a.s();!(t=a.n()).done;){t.value.setTransform(e.state)}}catch(n){a.e(n)}finally{a.f()}if((0,s.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e),this.attributeView.update(),this.children.some((function(e){return e.hasData}))){switch(e.drawPhase){case h.jx.MAP:this._renderChildren(e,h.Xq.All);break;case h.jx.HIGHLIGHT:this.hasHighlight&&this._renderHighlight(e)}this._boundsRenderer&&this._boundsRenderer.doRender(e)}}},{key:"_renderHighlight",value:function(e){var t=this;(0,d.P9)(e,!1,(function(e){t._renderChildren(e,h.Xq.Highlight)}))}}]),r}(c.K)},34971:function(e,t,r){r.r(t),r.d(t,{GraphicContainer:function(){return ir.Z},GraphicsView2D:function(){return rr.Z},LabelManager:function(){return tr.Q},MagnifierView2D:function(){return fr},MapViewNavigation:function(){return ar.Z},Stage:function(){return er}});var i=r(74165),a=r(1413),n=r(15861),s=r(37762),o=r(15671),u=r(43144),l=r(97326),h=r(60136),c=r(29388),d=r(10064),f=r(93169),p=r(92026),v=r(99346),_=r(76432),m=r(8768),g=r(29439),y=r(93433),b=r(86950),w=r(82272),x=r(84652),k=r(32718),M=r(17842),S=r(643),O=r(78915),P=r(86553),T=r(48202),C=r(26707),E=r(6388),F=r(31027),z=r(95954),R=r(94109);function B(e){var t=e.markerPlacement;return t&&t.angleToLine?T.v2.MAP:T.v2.SCREEN}var A=function(){function e(t){(0,o.Z)(this,e),this._cimLayers=[],this._poMap={},this._primitiveOverrides=[],t&&(this._resourceManager=t)}return(0,u.Z)(e,[{key:"analyzeSymbolReference",value:function(e,t,r){if(this._cimLayers=null!==r&&void 0!==r?r:[],!e)return this._cimLayers;if(this._reset(),e.primitiveOverrides){this._primitiveOverrides=e.primitiveOverrides;var i,a=(0,s.Z)(this._primitiveOverrides);try{for(a.s();!(i=a.n()).done;){var n=i.value,o=n.valueExpressionInfo;if(o)this._setPoMap(n.primitiveName,n.propertyName,o);else if(null!=n.value){var u=n.value;n.propertyName.includes("Color")&&((0,b.jQ)(u)&&(u=(0,F.nn)(u)),u=(0,F.oY)(u)),this._setPoMap(n.primitiveName,n.propertyName,u)}}}catch(l){a.e(l)}finally{a.f()}}return this._analyzeSymbol(e.symbol,t),this._cimLayers}},{key:"_reset",value:function(){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[]}},{key:"_analyzeSymbol",value:function(e,t){switch(null===e||void 0===e?void 0:e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this._analyzeMultiLayerSymbol(e,t)}}},{key:"_analyzeMultiLayerSymbol",value:function(e,t){var r,i=null===e||void 0===e?void 0:e.symbolLayers;if(i){var a=e.effects,n=T.v2.SCREEN,o=null!==(r=(0,F.ap)(e))&&void 0!==r?r:0;"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(n=T.v2.MAP);for(var u="CIMPolygonSymbol"===e.type,l=i.length;l--;){var h,c=i[l];if(c&&!1!==c.enable){var d=void 0;(null===a||void 0===a?void 0:a.length)&&(d=(0,y.Z)(a));var f=c.effects;(null===f||void 0===f?void 0:f.length)&&(a?(h=d).push.apply(h,(0,y.Z)(f)):d=(0,y.Z)(f));var p=null;if(d){p=[];var v,_=(0,s.Z)(d);try{for(_.s();!(v=_.n()).done;){var m=v.value,g=C.E.findEffectOverrides(m,this._primitiveOverrides);g&&p.push(g)}}catch(M){_.e(M)}finally{_.f()}}switch(C.E.findApplicableOverrides(c,this._primitiveOverrides,[]),c.type){case"CIMSolidFill":this._analyzeSolidFill(c,p);break;case"CIMPictureFill":this._analyzePictureFill(c,p);break;case"CIMHatchFill":this._analyzeHatchFill(c,p);break;case"CIMGradientFill":this._analyzeGradientFill(c,p);break;case"CIMSolidStroke":this._analyzeSolidStroke(c,p,u,o);break;case"CIMPictureStroke":this._analyzePictureStroke(c,p,u,o);break;case"CIMGradientStroke":this._analyzeGradientStroke(c,p,u,o);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":"CIMLineSymbol"!==e.type&&"CIMPolygonSymbol"!==e.type||(n=B(c));var b=[],w=c.primitiveName;w&&b.push(w);var x=u&&(0,F.gJ)(c.markerPlacement);this._analyzeMarker(c,p,null,b,n,o,t,[],!1,x);break;default:k.Z.getLogger("esri.symbols.cim.cimAnalyzer").error("Cannot analyze CIM layer",c.type)}}}}}},{key:"_analyzeSolidFill",value:function(e,t){var r=e.primitiveName,i=e.type,a=(0,F.oY)(e.color);this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!e.colorLocked,color:this._getValueOrOverrideExpression(i,r,"Color",a),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t,applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!1})}},{key:"_analyzePictureFill",value:function(e,t){var r=e.primitiveName,i=e.type,a=(0,F.cO)(e),n=(0,F.J0)(e.height,P.E.CIMPictureFill.height),s=(0,F.J0)(e.scaleX,1);if("width"in e&&"number"==typeof e.width){var o=e.width,u=1,l=this._resourceManager.getResource(e.url);null!=l&&(u=l.width/l.height),s/=u*(n/o)}var h={type:"sprite-rasterization-param",resource:e,overrides:this._getPrimitiveMaterialOverrides(r,i)};this._cimLayers.push({type:"fill",spriteRasterizationParam:h,colorLocked:!!e.colorLocked,effects:t,color:this._getValueOrOverrideExpression(i,r,"TintColor",a),height:this._getValueOrOverrideExpression(i,r,"Height",n),scaleX:this._getValueOrOverrideExpression(i,r,"ScaleX",s),angle:this._getValueOrOverrideExpression(i,r,"Rotation",(0,F.J0)(e.rotation)),offsetX:this._getValueOrOverrideExpression(i,r,"OffsetX",(0,F.J0)(e.offsetX)),offsetY:this._getValueOrOverrideExpression(i,r,"OffsetY",(0,F.J0)(e.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}},{key:"_analyzeHatchFill",value:function(e,t){var r,i=e.primitiveName,a=e.type,n=this._analyzeMaterialOverrides(i,["Rotation","OffsetX","OffsetY"]),o=(0,F.Ul)(n),u=[255,255,255,1],l=!1;if(null!==(r=e.lineSymbol)&&void 0!==r&&r.symbolLayers){var h,c=(0,s.Z)(e.lineSymbol.symbolLayers);try{for(c.s();!(h=c.n()).done;){var d,f,p,v,_=h.value;if("CIMSolidStroke"===_.type){var m=null!==(d=_.primitiveName)&&void 0!==d?d:i;l||!m||_.colorLocked||null==(null===(f=this._poMap[m])||void 0===f?void 0:f.Color)&&null==(null===(p=this._poMap[m])||void 0===p?void 0:p.StrokeColor)||(u=(0,F.oY)(_.color),u=null!==(v=this._maybeGetValueOrOverrideExpression(m,"StrokeColor"))&&void 0!==v?v:this._getValueOrOverrideExpression(a,m,"Color",u),l=!0);var g=this._maybeGetValueOrOverrideExpression(m,"StrokeWidth");if(g){var y=null,b=null;"number"==typeof g?y=g:b=g.valueExpressionInfo;var w=o.find((function(e){return"strokeWidth"===e.propertyName}));w?w.propertyName="width":(w={type:"CIMPrimitiveOverride",primitiveName:m,propertyName:"width",valueExpressionInfo:b,value:y,defaultValue:(0,F.dT)(a,"width")},o.push(w))}}}}catch(k){c.e(k)}finally{c.f()}}var x={type:"sprite-rasterization-param",resource:e,overrides:o};this._cimLayers.push({type:"fill",spriteRasterizationParam:x,colorLocked:!!e.colorLocked,effects:t,color:u,height:this._getValueOrOverrideExpression(a,i,"Separation",(0,F.J0)(e.separation,P.E.CIMHatchFill.separation)),scaleX:1,angle:this._getValueOrOverrideExpression(a,i,"Rotation",(0,F.J0)(e.rotation)),offsetX:this._getValueOrOverrideExpression(a,i,"OffsetX",(0,F.J0)(e.offsetX)),offsetY:this._getValueOrOverrideExpression(a,i,"OffsetY",(0,F.J0)(e.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!l})}},{key:"_analyzeGradientFill",value:function(e,t){this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!e.colorLocked,effects:t,color:[128,128,128,1],height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1})}},{key:"_analyzeSolidStroke",value:function(e,t,r,i){var a,n,s=e.primitiveName,o=e.type,u=(0,F.oY)(e.color),l=(0,F.J0)(e.width,P.E.CIMSolidStroke.width),h=(0,F.vn)(e.capStyle,P.E.CIMSolidStroke.capstyle),c=(0,F.vn)(e.joinStyle,P.E.CIMSolidStroke.joinstyle),d=e.miterLimit,f=[];if(this._analyzePrimitiveOverrides(s,t,null,null)&&(f=this._getPrimitiveMaterialOverrides(s,o)),t&&Array.isArray(t)&&t.length>0){var p=t[t.length-1].effect;p&&"CIMGeometricEffectDashes"===p.type&&"NoConstraint"===p.lineDashEnding&&null===p.offsetAlongLine&&(a=p.dashTemplate,n=p.scaleDash,(t=(0,y.Z)(t)).pop())}var v=void 0!==a?{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:a,capStyle:h},overrides:f}:null;this._cimLayers.push({type:"line",spriteRasterizationParam:v,isOutline:r,colorLocked:!!e.colorLocked,effects:t,color:this._getValueOrOverrideExpression(o,s,"Color",u),width:this._getValueOrOverrideExpression(o,s,"Width",l),cap:this._getValueOrOverrideExpression(o,s,"CapStyle",h),join:this._getValueOrOverrideExpression(o,s,"JoinStyle",c),miterLimit:d&&this._getValueOrOverrideExpression(o,s,"MiterLimit",d),referenceWidth:i,zOrder:I(e.name),dashTemplate:a,scaleDash:n,sampleAlphaOnly:!0})}},{key:"_analyzePictureStroke",value:function(e,t,r,i){var a=e.primitiveName,n=e.type,s=(0,F.cO)(e),o=(0,F.J0)(e.width,P.E.CIMPictureStroke.width),u=(0,F.vn)(e.capStyle,P.E.CIMPictureStroke.capstyle),l=(0,F.vn)(e.joinStyle,P.E.CIMPictureStroke.joinstyle),h=e.miterLimit,c={type:"sprite-rasterization-param",resource:e,overrides:this._getPrimitiveMaterialOverrides(a,n)};this._cimLayers.push({type:"line",spriteRasterizationParam:c,isOutline:r,colorLocked:!!e.colorLocked,effects:t,color:this._getValueOrOverrideExpression(n,a,"TintColor",s),width:this._getValueOrOverrideExpression(n,a,"Width",o),cap:this._getValueOrOverrideExpression(n,a,"CapStyle",u),join:this._getValueOrOverrideExpression(n,a,"JoinStyle",l),miterLimit:h&&this._getValueOrOverrideExpression(n,a,"MiterLimit",h),referenceWidth:i,zOrder:I(e.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}},{key:"_analyzeGradientStroke",value:function(e,t,r,i){var a=e.primitiveName,n=e.type,s=(0,F.J0)(e.width,P.E.CIMSolidStroke.width),o=(0,F.vn)(e.capStyle,P.E.CIMGradientStroke.capstyle),u=(0,F.vn)(e.joinStyle,P.E.CIMGradientStroke.joinstyle),l=e.miterLimit;this._cimLayers.push({type:"line",spriteRasterizationParam:null,isOutline:r,colorLocked:!!e.colorLocked,effects:t,color:[128,128,128,1],width:this._getValueOrOverrideExpression(n,a,"Width",s),cap:this._getValueOrOverrideExpression(n,a,"CapStyle",o),join:this._getValueOrOverrideExpression(n,a,"JoinStyle",u),miterLimit:l&&this._getValueOrOverrideExpression(n,a,"MiterLimit",l),referenceWidth:i,zOrder:I(e.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}},{key:"_analyzeMarker",value:function(e,t,r,i,a,n,s,o){var u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=arguments.length>9&&void 0!==arguments[9]&&arguments[9];if(u||(u=!!e.colorLocked),!this._analyzeMarkerInsidePolygon(e,t,u)){var h=(0,F.J0)(e.size,P.E.CIMVectorMarker.size),c=(0,F.J0)(e.rotation),d=(0,F.J0)(e.offsetX),f=(0,F.J0)(e.offsetY),p=e.primitiveName,v=e.type,_=this._getValueOrOverrideExpression(v,p,"Size",h),m=this._getValueOrOverrideExpression(v,p,"Rotation",c),g=this._getValueOrOverrideExpression(v,p,"OffsetX",d),y=this._getValueOrOverrideExpression(v,p,"OffsetY",f);switch(e.type){case"CIMPictureMarker":this._analyzePictureMarker(e,t,r,i,a,n,_,m,g,y,o,u,l);break;case"CIMVectorMarker":this._analyzeVectorMarker(e,t,r,i,a,n,_,m,g,y,o,s,u,l)}}}},{key:"_analyzeMarkerInsidePolygon",value:function(e,t,r){var i=e.markerPlacement,a=e.type;if(!i||"CIMMarkerPlacementInsidePolygon"!==i.type)return!1;if("CIMVectorMarker"===a||"CIMPictureMarker"===a){var n=e.primitiveName;if(n&&this._analyzePrimitiveOverrides([n],t,null,null))return!1;var o=i.primitiveName;if(o&&this._analyzePrimitiveOverrides([o],t,null,null))return!1;if("CIMVectorMarker"===a){var u=e.markerGraphics;if(u){var l,h=(0,s.Z)(u);try{for(h.s();!(l=h.n()).done;){var c=l.value.symbol;if("CIMPolygonSymbol"===(null===c||void 0===c?void 0:c.type)&&c.symbolLayers){var d,f=c.symbolLayers,p=(0,s.Z)(f);try{for(p.s();!(d=p.n()).done;){if("CIMSolidStroke"===d.value.type)return!1}}catch(x){p.e(x)}finally{p.f()}}}}catch(x){h.e(x)}finally{h.f()}}}else{if(e.animatedSymbolProperties)return!1}}var v,_,m=Math.abs(i.stepX),g=Math.abs(i.stepY);if(0===m||0===g)return!0;if("Random"===i.gridType){var y=(0,M.Wz)(R.KA);_=Math.max(Math.floor(y/m),1)*m/(v=g*Math.max(Math.floor(y/g),1))}else i.shiftOddRows?(v=2*g,_=m/g*.5):(v=g,_=m/g);var b=(0,F.cO)(e),w="CIMCharacterMarker"===e.type?null:{type:"sprite-rasterization-param",resource:e,overrides:[]};return this._cimLayers.push({type:"fill",spriteRasterizationParam:w,colorLocked:r,effects:t,color:b,height:v,scaleX:_,angle:i.gridAngle,offsetX:(0,F.J0)(i.offsetX),offsetY:(0,F.J0)(i.offsetY),applyRandomOffset:"Random"===i.gridType,sampleAlphaOnly:"CIMPictureMarker"!==e.type,hasUnresolvedReplacementColor:!0}),!0}},{key:"_analyzePictureMarker",value:function(e,t,r,i,a,n,s,o,u,l,h,c,d){var f,p,v,_,m,g,b,w,k,M,O=e.animatedSymbolProperties,P=e.primitiveName,T=e.type,C=(0,F.J0)(e.scaleX,1),E=(0,F.cO)(e);r||(r=this._createMarkerPlacementOverrideExpression(e.markerPlacement));var z=this._createGIFAnimatedSymbolPropertiesOverrideExpression(O),R=null!==(f=e.anchorPoint)&&void 0!==f?f:{x:0,y:0};if("width"in e&&"number"==typeof e.width){var B=e.width,A=1,I=this._resourceManager.getResource(e.url);null!=I&&(A=I.width/I.height),C/=A*((0,F.J0)(e.size)/B)}var Z,U=(0,y.Z)(i);e.primitiveName&&U.push(e.primitiveName),O||z?Z={type:"animated",url:e.url,urlHash:"H"+(0,S.hP)(e.url),playAnimation:null===(p=e.animatedSymbolProperties)||void 0===p?void 0:p.playAnimation,reverseAnimation:null===(v=e.animatedSymbolProperties)||void 0===v?void 0:v.reverseAnimation,randomizeStartTime:null===(_=e.animatedSymbolProperties)||void 0===_?void 0:_.randomizeStartTime,randomizeStartSeed:null===(m=e.animatedSymbolProperties)||void 0===m?void 0:m.randomizeStartSeed,startTimeOffset:null===(g=e.animatedSymbolProperties)||void 0===g?void 0:g.startTimeOffset,duration:null===(b=e.animatedSymbolProperties)||void 0===b?void 0:b.duration,repeatType:null===(w=e.animatedSymbolProperties)||void 0===w?void 0:w.repeatType,repeatDelay:null===(k=e.animatedSymbolProperties)||void 0===k?void 0:k.repeatDelay}:(Z=(0,x.d9)(e)).markerPlacement=null;var L={type:"sprite-rasterization-param",resource:Z,overrides:this._getMaterialOverrides(U,T)};z&&(M=L.overrides).push.apply(M,(0,y.Z)(z.overrides)),this._cimLayers.push({type:"marker",spriteRasterizationParam:L,colorLocked:c,effects:t,scaleSymbolsProportionally:!1,alignment:a,size:s,scaleX:this._getValueOrOverrideExpression(T,P,"ScaleX",C),rotation:o,offsetX:u,offsetY:l,transform:{type:"cim-marker-transform-param",params:h},color:this._getValueOrOverrideExpression(T,P,"TintColor",E),anchorPoint:{x:R.x,y:R.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:[0,0,0,0],outlineWidth:0,frameHeight:0,widthRatio:1,rotateClockwise:!!e.rotateClockwise,referenceSize:n,sizeRatio:1,isOutline:d,markerPlacement:r})}},{key:"_analyzeVectorMarker",value:function(e,t,r,i,a,n,o,u,l,h,c,d,f,p){var v,_,m,g=e.markerGraphics;if(g){var b,w=e.frame;if(b=w?w.ymax-w.ymin:n){var x={offsetX:l,offsetY:h,rotation:u,size:o,frameHeight:b,rotateClockWise:!!e.rotateClockwise};c=[].concat((0,y.Z)(c),[x])}r||(r=this._createMarkerPlacementOverrideExpression(e.markerPlacement));var k,M=(0,s.Z)(g);try{for(M.s();!(k=M.n()).done;){var S=k.value;if(S){var O=S.symbol;if(!O)continue;var P=S.primitiveName,T=void 0;if(P&&i.push(P),("CIMPointSymbol"===O.type||"CIMTextSymbol"===O.type)&&w){var C=0,E=0,F=S.geometry;"x"in F&&"y"in F&&(C+=F.x-.5*(w.xmin+w.xmax),E+=F.y-.5*(w.ymin+w.ymax));var z=e.anchorPoint;z&&("Absolute"===e.anchorPointUnits?(C-=z.x,E-=z.y):w&&(C-=(w.xmax-w.xmin)*z.x,E-=(w.ymax-w.ymin)*z.y));var R={offsetX:C,offsetY:E,rotation:0,size:0,frameHeight:0,rotateClockWise:!1};T=[].concat((0,y.Z)(c),[R])}switch(O.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":d||U(O)?this._analyzeMultiLayerGraphicNonSDF(e,t,r,S,i,a,n,null!==(v=T)&&void 0!==v?v:c,b,f,p):this._analyzeMultiLayerGraphic(e,t,r,S,i,a,n,null!==(_=T)&&void 0!==_?_:c,b,f,p);break;case"CIMTextSymbol":this._analyzeTextGraphic(t,r,S,i,a,n,null!==(m=T)&&void 0!==m?m:c,f)}P&&i.pop()}}}catch(B){M.e(B)}finally{M.f()}}}},{key:"_analyzeMultiLayerGraphic",value:function(e,t,r,i,a,n,s,o,u,l,h){var c=i.symbol,d=c.symbolLayers;if(d){var f=d.length;if(Z(d))this._analyzeCompositeMarkerGraphic(e,t,r,i,d,n,s,o,u,l,h);else{var p=this._resourceManager.geometryEngine,v=z.j.applyEffects(c.effects,i.geometry,p);if(v)for(;f--;){var _=d[f];if(_&&!1!==_.enable){var m=_.primitiveName;switch(m&&a.push(m),_.type){case"CIMSolidFill":case"CIMSolidStroke":var y,b,w,x,k=z.j.applyEffects(_.effects,v,p),M=(0,E.bk)(k);if(!M)continue;var S="Relative"!==e.anchorPointUnits,O=(0,E.UV)(M,e.frame,e.size,e.anchorPoint,S),P=(0,g.Z)(O,4),T=P[0],C=P[1],R=P[2],B=P[3],A="CIMSolidFill"===_.type,I={type:"sdf",geom:k,asFill:A},U=_.path,L=A?(0,F.oY)((0,F.W7)(_)):null==U?(0,F.oY)((0,F.$Z)(_)):[0,0,0,0],D=A?[0,0,0,0]:(0,F.oY)((0,F.$Z)(_)),N=null!==(y=(0,F.F)(_))&&void 0!==y?y:0;if(!A&&!N)break;var V=i.primitiveName,G=null;A&&!_.colorLocked&&(G=this._maybeGetValueOrOverrideExpression(V,"FillColor"));var H=null;A||_.colorLocked||(H=this._maybeGetValueOrOverrideExpression(V,"StrokeColor"));var q=null!==(b=G)&&void 0!==b?b:this._getValueOrOverrideExpression(_.type,m,"Color",L),W=null!==(w=H)&&void 0!==w?w:this._getValueOrOverrideExpression(_.type,m,"Color",D),X=null!==(x=this._maybeGetValueOrOverrideExpression(V,"StrokeWidth"))&&void 0!==x?x:this._getValueOrOverrideExpression(_.type,m,"Width",N),j=U?{type:"sprite-rasterization-param",resource:{type:"path",path:U,asFill:A},overrides:[]}:{type:"sprite-rasterization-param",resource:I,overrides:[]};this._cimLayers.push({type:"marker",spriteRasterizationParam:j,colorLocked:!!_.colorLocked||!!l,effects:t,scaleSymbolsProportionally:!!e.scaleSymbolsProportionally,alignment:n,anchorPoint:{x:C,y:R},isAbsoluteAnchorPoint:S,size:u,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:o},frameHeight:u,widthRatio:B,rotateClockwise:!1,referenceSize:s,sizeRatio:T,color:q,outlineColor:W,outlineWidth:X,isOutline:h,markerPlacement:r});break;case"CIMPictureMarker":case"CIMVectorMarker":_.markerPlacement?this._analyzeMultiLayerGraphicNonSDF(e,t,r,i,a,n,s,o,u,!!_.colorLocked||!!l,h):this._analyzeMarker(_,t,r,a,n,s,!1,o,l,h);break;default:this._analyzeMultiLayerGraphicNonSDF(e,t,r,i,a,n,s,o,u,!!_.colorLocked||!!l,h)}m&&a.pop()}}}}}},{key:"_analyzeTextGraphic",value:function(e,t,r,i,n,o,u,l){var h,c,d,f,p;C.E.findApplicableOverrides(r,this._primitiveOverrides,[]);var v=r.geometry;if("x"in v&&"y"in v){var _=r.symbol,m=(0,F.BX)(_),g=(0,F.wi)(_.fontStyleName),b=(0,w.BN)(_.fontFamilyName);_.font=(0,a.Z)({family:b,decoration:m},g);var x=(0,F.J0)(_.height,P.E.CIMTextSymbol.height),k=(0,F.J0)(_.angle),M=(0,F.J0)(_.offsetX),S=(0,F.J0)(_.offsetY),O=(0,F.oY)((0,F.W7)(_)),T=(0,F.oY)((0,F.$Z)(_)),E=null!==(h=(0,F.F)(_))&&void 0!==h?h:0;E||(T=(0,F.oY)((0,F.W7)(_.haloSymbol)),E=(0,F.J0)(_.haloSize));var z=!1;if(null!==(c=_.symbol)&&void 0!==c&&c.symbolLayers){var R,B=(0,s.Z)(_.symbol.symbolLayers);try{for(B.s();!(R=B.n()).done;){var A=R.value;null!=(0,F.oY)((0,F.W7)(A))&&(z=!!A.colorLocked)}}catch(te){B.e(te)}finally{B.f()}}var I=r.primitiveName,Z=null;z||(Z=this._maybeGetValueOrOverrideExpression(I,"FillColor"));var U=this._maybeGetValueOrOverrideExpression(I,"TextSize"),L=this._maybeGetValueOrOverrideExpression(I,"TextAngle"),D=this._maybeGetValueOrOverrideExpression(I,"TextOffsetX"),N=this._maybeGetValueOrOverrideExpression(I,"TextOffsetY"),V=null,G=null,H=0;if(_.callout&&"CIMBackgroundCallout"===_.callout.type){var q=_.callout;if(q.backgroundSymbol){var W=q.backgroundSymbol.symbolLayers;if(W){var X,j=(0,s.Z)(W);try{for(j.s();!(X=j.n()).done;){var Y=X.value;"CIMSolidFill"===Y.type?V=(0,F.oY)(Y.color):"CIMSolidStroke"===Y.type&&(G=(0,F.oY)(Y.color),H=(0,F.J0)(Y.width,P.E.CIMSolidStroke.width))}}catch(te){j.e(te)}finally{j.f()}}}}var J=this._getValueOrOverrideExpression(_.type,r.primitiveName,"TextString",null!==(d=r.textString)&&void 0!==d?d:"");if(null!=J){var $=_.fontStyleName,K=b+($?"-"+$.toLowerCase():"-regular"),Q=this._getMaterialOverrides(i,_.type);Q.push.apply(Q,(0,y.Z)(this._getPrimitiveMaterialOverrides(r.primitiveName,_.type)));var ee={type:"text-rasterization-param",resource:{type:"text",textString:null!==(f=r.textString)&&void 0!==f?f:"",font:_.font,symbol:_,primitiveName:r.primitiveName},overrides:Q};this._cimLayers.push({type:"text",lineWidth:_.lineWidth,textRasterizationParam:ee,colorLocked:!!l||!!z,effects:e,alignment:n,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:!1,fontName:K,decoration:m,weight:g.weight,style:g.style,size:null!==U&&void 0!==U?U:x,angle:null!==L&&void 0!==L?L:k,offsetX:null!==D&&void 0!==D?D:M,offsetY:null!==N&&void 0!==N?N:S,transform:{type:"cim-marker-transform-param",params:u},horizontalAlignment:(0,F.X_)(_.horizontalAlignment),verticalAlignment:(0,F.FG)(_.verticalAlignment),text:J,color:null!==(p=Z)&&void 0!==p?p:this._getValueOrOverrideExpression(_.type,r.primitiveName,"Color",O),outlineColor:T,outlineSize:E,backgroundColor:V,borderLineColor:G,borderLineWidth:H,referenceSize:o,sizeRatio:1,markerPlacement:t})}}}},{key:"_analyzeMultiLayerGraphicNonSDF",value:function(e,t,r,i,n,s,o,u,l,h,c){var d=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}(e,i),f=e.primitiveName,p=this._analyzeMaterialOverrides(f,["Rotation","OffsetX","OffsetY"]),v=(0,F.Ul)(p),_=O.B$.getTextureAnchor(d,this._resourceManager),m=(0,g.Z)(_,3),b=m[0],w=m[1],x=m[2],k=this._getMaterialOverrides(n,e.type);k.push.apply(k,(0,y.Z)(v));var S={type:"sprite-rasterization-param",resource:(0,a.Z)((0,a.Z)({},d),{},{avoidSDFRasterization:!0}),overrides:k};this._cimLayers.push({type:"marker",spriteRasterizationParam:S,colorLocked:h,effects:t,scaleSymbolsProportionally:!!e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:b,y:w},isAbsoluteAnchorPoint:!1,size:l,rotation:0,offsetX:0,offsetY:0,transform:{type:"cim-marker-transform-param",params:u},color:[255,255,255,1],outlineColor:[0,0,0,0],outlineWidth:0,scaleX:1,frameHeight:l,widthRatio:1,rotateClockwise:!!e.rotateClockwise,referenceSize:o,sizeRatio:x/(0,M.F2)(e.size),isOutline:c,markerPlacement:r})}},{key:"_createMarkerPlacementOverrideExpression",value:function(e){if(!e)return null;var t=[];return C.E.findApplicableOverrides(e,this._primitiveOverrides,t),{type:"cim-marker-placement-param",placement:e,overrides:L(t)}}},{key:"_createGIFAnimatedSymbolPropertiesOverrideExpression",value:function(e){if(!e)return null;var t=[];return C.E.findApplicableOverrides(e,this._primitiveOverrides,t),{type:"cim-gif-animation-params",animation:e,overrides:L(t)}}},{key:"_analyzeCompositeMarkerGraphic",value:function(e,t,r,i,a,n,s,o,u,l,h){var c,d,f,p=i.geometry,v=a[0],_=a[1],m=(0,E.bk)(p);if(m){var y="Relative"!==e.anchorPointUnits,b=(0,E.UV)(m,e.frame,e.size,e.anchorPoint,y),w=(0,g.Z)(b,4),x=w[0],k=w[1],M=w[2],S=w[3],O=_.path,T=_.primitiveName,C=v.primitiveName,z=i.primitiveName,R=null;_.colorLocked||l||(R=this._maybeGetValueOrOverrideExpression(z,"FillColor"));var B=null!==(c=R)&&void 0!==c?c:this._getValueOrOverrideExpression(_.type,T,"Color",(0,F.oY)(_.color)),A=null;v.colorLocked||l||(A=this._maybeGetValueOrOverrideExpression(z,"StrokeColor"));var I=null!==(d=A)&&void 0!==d?d:this._getValueOrOverrideExpression(v.type,C,"Color",(0,F.oY)(v.color)),Z=null!==(f=this._maybeGetValueOrOverrideExpression(z,"StrokeWidth"))&&void 0!==f?f:this._getValueOrOverrideExpression(v.type,C,"Width",(0,F.J0)(v.width,P.E.CIMSolidStroke.width)),U={type:"sprite-rasterization-param",resource:O?{type:"path",path:O,asFill:!0}:{type:"sdf",geom:p,asFill:!0},overrides:[]};this._cimLayers.push({type:"marker",spriteRasterizationParam:U,colorLocked:l,effects:t,scaleSymbolsProportionally:!!e.scaleSymbolsProportionally,alignment:n,anchorPoint:{x:k,y:M},isAbsoluteAnchorPoint:y,size:u,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:o},frameHeight:u,widthRatio:S,rotateClockwise:!1,referenceSize:s,sizeRatio:x,color:B,outlineColor:I,outlineWidth:Z,isOutline:h,markerPlacement:r})}}},{key:"_setPoMap",value:function(e,t,r){var i;this._poMap[e]?i=this._poMap[e]:(i={},this._poMap[e]=i),i[t]=r}},{key:"_maybeGetValueOrOverrideExpression",value:function(e,t,r){return this._getValueOrOverrideExpression("",e,t,r,!1)}},{key:"_getValueOrOverrideExpression",value:function(e,t,r,i){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(a&&!(0,F.Mk)(i)&&(i=(0,F.dT)(e,r.toLowerCase())),null==t)return i;var n=this._poMap[t];if(null==n)return i;var s=n[r];return"string"==typeof s||"number"==typeof s||Array.isArray(s)?s:s?{valueExpressionInfo:s,defaultValue:i}:i}},{key:"_analyzePrimitiveOverrides",value:function(e,t,r,i){if(null==e)return!1;"string"==typeof e&&(e=[e]);var a,n=(0,s.Z)(this._primitiveOverrides);try{for(n.s();!(a=n.n()).done;){var o=a.value;if(e.includes(o.primitiveName)&&o.valueExpressionInfo)return!0}}catch(m){n.e(m)}finally{n.f()}if(null!=t){var u,l=(0,s.Z)(t);try{for(l.s();!(u=l.n()).done;){var h=u.value;if((null===h||void 0===h?void 0:h.overrides.length)>0)return!0}}catch(m){l.e(m)}finally{l.f()}}if(null!=r){var c,d=(0,s.Z)(r);try{for(d.s();!(c=d.n()).done;){var f=c.value;if((null===f||void 0===f?void 0:f.overrides.length)>0)return!0}}catch(m){d.e(m)}finally{d.f()}}if(null!=i){var p,v=(0,s.Z)(i);try{for(v.s();!(p=v.n()).done;){var _=p.value;if((null===_||void 0===_?void 0:_.overrides.length)>0)return!0}}catch(m){v.e(m)}finally{v.f()}}return!1}},{key:"_getMaterialOverrides",value:function(e,t){if(!e)return[];var r,i=[],a=(0,s.Z)(e);try{for(a.s();!(r=a.n()).done;){var n=r.value;i.push.apply(i,(0,y.Z)(this._getPrimitiveMaterialOverrides(n,t)))}}catch(o){a.e(o)}finally{a.f()}return i}},{key:"_getPrimitiveMaterialOverrides",value:function(e,t){if(!e)return[];var r=(0,F.Ul)(this._primitiveOverrides.filter((function(t){return t.primitiveName===e})));return r.forEach((function(e){return e.defaultValue=(0,F.dT)(t,e.propertyName.toLowerCase())})),r}},{key:"_analyzeMaterialOverrides",value:function(e,t){return this._primitiveOverrides.filter((function(r){return r.primitiveName!==e||!t.includes(r.propertyName)}))}}]),e}();function I(e){if(e&&0===e.indexOf("Level_")){var t=parseInt(e.substr(6),10);if(!isNaN(t))return t}return 0}var Z=function(e){return e&&2===e.length&&e[0].enable&&e[1].enable&&"CIMSolidStroke"===e[0].type&&"CIMSolidFill"===e[1].type&&null==e[0].path&&null==e[1].path&&!e[0].effects&&!e[1].effects};function U(e){var t=e.symbolLayers;if(!t||2!==t.length)return!1;var r=t.find((function(e){var t;return null===(t=e.effects)||void 0===t?void 0:t.find((function(e){return"CIMGeometricEffectDashes"===e.type&&null!=e.dashTemplate}))})),i=t.find((function(e){var t;return null===(t=e.effects)||void 0===t?void 0:t.find((function(e){return"CIMGeometricEffectAddControlPoints"===e.type}))}));return!!r||!!i}function L(e){return(0,x.d9)(e).map((function(e){return(0,a.Z)((0,a.Z)({},e),{},{propertyName:(0,F.Le)(e.propertyName)})}))}var D=r(33624),N=r(91505),V=r(98928),G=r(42537),H=r(16889),q=r(50264),W=r(55364),X=r(83826),j=function(){function e(t){var r=this;(0,o.Z)(this,e),this.events=new N.Z,this._hasMajorPerformanceCaveat=!1,this._lastRenderFrameCounter=0,this._canvas=document.createElement("canvas"),this._canvas.setAttribute("style","width: 100%; height:100%; display:block; willChange:transform");var i={failIfMajorPerformanceCaveat:!0,alpha:!0,antialias:!1,depth:!0,stencil:!0};t.appendChild(this._canvas);var n=(0,X.k)(this._canvas,i);n||(n=(0,X.k)(this._canvas,(0,a.Z)((0,a.Z)({},i),{},{failIfMajorPerformanceCaveat:!1})),this._hasMajorPerformanceCaveat=!0),this._gl=n,this._handles=(0,G.AL)([(0,V.on)(this._canvas,"webglcontextlost",(function(e){return r.events.emit("webgl-context-lost",e)}))])}return(0,u.Z)(e,[{key:"destroy",value:function(){var e;null!==(e=this._canvas.parentNode)&&void 0!==e&&e.removeChild(this._canvas),this._canvas=null,this._handles.remove(),this._gl=null}},{key:"gl",get:function(){return this._gl}},{key:"render",value:function(e,t){if(this._hasMajorPerformanceCaveat||(0,f.Z)("esri-force-performance-mode")){if(++this._lastRenderFrameCounter>=(0,f.Z)("esri-performance-mode-frames-between-render")&&(t(),this._lastRenderViewState=e.state.clone(),this._lastRenderFrameCounter=0),this._lastRenderViewState){var r=this._computeViewTransform(this._lastRenderViewState,e.state),i=(0,g.Z)(r,6),a=i[0],n=i[1],s=i[2],o=i[3],u=i[4],l=i[5];this._canvas.style.transform="matrix(".concat(a,", ").concat(n,", ").concat(s,", ").concat(o,", ").concat(u,", ").concat(l,")")}}else t()}},{key:"resize",value:function(e){var t=this._canvas,r=t.style,i=e.state.size,a=e.pixelRatio,n=i[0],s=i[1],o=Math.round(n*a),u=Math.round(s*a);t.width===o&&t.height===u||(t.width=o,t.height=u),r.width=n+"px",r.height=s+"px"}},{key:"_computeViewTransform",value:function(e,t){var r=(0,g.Z)(e.center,2),i=r[0],a=r[1],n=(0,g.Z)(t.center,2),s=n[0],o=n[1],u=e.toScreen([0,0],s,o),l=(0,g.Z)(u,2),h=l[0],c=l[1],d=e.toScreen([0,0],i,a),f=(0,g.Z)(d,2),p=f[0]-h,v=f[1]-c,_=e.scale/t.scale,m=t.rotation-e.rotation,y=(0,W.Ue)();return(0,q.yR)(y),(0,q.bA)(y,y,[_,_]),(0,q.U1)(y,y,(0,H.Vl)(m)),(0,q.Iu)(y,y,[p,v]),y}}]),e}(),Y=r(80613),J=r(34702),$=r(56130),K=r(61441),Q=r(53456),ee=r(44070),te=r(8548),re=r(96721),ie=r(45412),ae=function(){function e(){(0,o.Z)(this,e),this._initialized=!1}return(0,u.Z)(e,[{key:"dispose",value:function(){this._program=(0,p.M2)(this._program),this._vertexArrayObject=(0,p.M2)(this._vertexArrayObject)}},{key:"render",value:function(e,t,r,i){e&&(this._initialized||this._initialize(e),e.setBlendFunctionSeparate(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA,te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),e.bindVAO(this._vertexArrayObject),e.useProgram(this._program),t.setSamplingMode(r),e.bindTexture(t,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",i),e.drawArrays(te.MX.TRIANGLE_STRIP,0,4),e.bindTexture(null,0),e.bindVAO())}},{key:"_initialize",value:function(e){if(this._initialized)return!0;var t=(0,re.H)(e,Q.Q);if(!t)return!1;var r=new Int8Array(16);r[0]=-1,r[1]=-1,r[2]=0,r[3]=0,r[4]=1,r[5]=-1,r[6]=1,r[7]=0,r[8]=-1,r[9]=1,r[10]=0,r[11]=1,r[12]=1,r[13]=1,r[14]=1,r[15]=1;var i=Q.Q.attributes,a=new ie.U(e,i,K.As,{geometry:ee.f.createVertex(e,te.l1.STATIC_DRAW,r)});return this._program=t,this._vertexArrayObject=a,this._initialized=!0,!0}}]),e}(),ne=r(4942),se=r(40658),oe=function(){function e(t){(0,o.Z)(this,e),this._rctx=t,this._programByKey=new Map}return(0,u.Z)(e,[{key:"dispose",value:function(){this._programByKey.forEach((function(e){return e.dispose()})),this._programByKey.clear()}},{key:"getProgram",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=e.vsPath+"."+e.fsPath+JSON.stringify(t);if(this._programByKey.has(r))return this._programByKey.get(r);var i=(0,a.Z)({},t.map((function(e){return"string"==typeof e?{name:e,value:!0}:e})).reduce((function(e,t){return(0,a.Z)((0,a.Z)({},e),{},(0,ne.Z)({},t.name,t.value))}),{})),n=e.vsPath,s=e.fsPath,o=e.attributes,u=(0,se.s)(n,s,o,i),l=this._rctx.programCache.acquire(u.shaders.vertexShader,u.shaders.fragmentShader,u.attributes);if(!l)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(r,l),l}}]),e}(),ue=r(42265),le=r(76200),he=r(75746),ce=r(66978),de=r(59001),fe=r(26554),pe=r(691),ve=function(){function e(t){(0,o.Z)(this,e),this._resourceManager=t,this._cachedRasterizationCanvas=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._cachedRasterizationCanvas=null}},{key:"_canvas",get:function(){return this._cachedRasterizationCanvas||(this._cachedRasterizationCanvas=document.createElement("canvas")),this._cachedRasterizationCanvas}},{key:"rasterizeJSONResource",value:function(e){switch(e.type){case"dash":var t=e.dashTemplate,r=e.capStyle,i=(0,fe.m)(t,r),a=(0,g.Z)(i,3),n=a[0];return{size:[a[1],a[2]],image:new Uint32Array(n.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};case"fill-style":var s=(0,fe.Y)(this._canvas,e,R.FM),o=(0,g.Z)(s,4),u=o[0],l=o[1],h=o[2],c=o[3];return{size:[l,h],image:new Uint32Array(u.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:c};case"sdf":return _e(e);case"CIMHatchFill":case"CIMVectorMarker":case"CIMPictureMarker":return this._rasterizeCIMJSONResource(e)}}},{key:"_rasterizeCIMJSONResource",value:function(e){switch(e.type){case"CIMHatchFill":var t=O.B$.fromCIMHatchFill(e,R.FM);return this._rasterizeCIMVectorMarker(t);case"CIMPictureMarker":var r=O.B$.fromCIMInsidePolygon(e);return this._rasterizeCIMVectorMarker(r);case"CIMVectorMarker":var i;if("CIMMarkerPlacementInsidePolygon"===(null===(i=e.markerPlacement)||void 0===i?void 0:i.type)){var a=O.B$.fromCIMInsidePolygon(e);return this._rasterizeCIMVectorMarker(a)}var n=(0,E.Fp)(e);return n&&!e.avoidSDFRasterization?_e(n):this._rasterizeCIMVectorMarker(e,!1)}}},{key:"_rasterizeCIMVectorMarker",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t?pe.Z.fromExtent(e.frame):null,i=O.B$.rasterize(this._canvas,e,r,this._resourceManager),a=(0,g.Z)(i,5),n=a[0],s=a[1],o=a[2],u=a[3],l=a[4];return n?{size:[s,o],image:new Uint32Array(n.buffer),sdf:!1,simplePattern:!1,anchorX:u,anchorY:l}:null}},{key:"rasterizeImageResource",value:function(e,t,r,i){this._canvas.width=e,this._canvas.height=t;var a=this._canvas.getContext("2d",{willReadFrequently:!0});r instanceof ImageData?a.putImageData(r,0,0):(r.setAttribute("width","".concat(e,"px")),r.setAttribute("height","".concat(t,"px")),a.drawImage(r,0,0,e,t));var n,o=a.getImageData(0,0,e,t),u=new Uint8Array(o.data);if(i){var l,h=(0,s.Z)(i);try{for(h.s();!(l=h.n()).done;){var c=l.value;if(c&&c.oldColor&&4===c.oldColor.length&&c.newColor&&4===c.newColor.length){var d=(0,g.Z)(c.oldColor,4),f=d[0],p=d[1],v=d[2],_=d[3],m=(0,g.Z)(c.newColor,4),y=m[0],b=m[1],w=m[2],x=m[3];if(f===y&&p===b&&v===w&&_===x)continue;for(var k=0;k<u.length;k+=4)f===u[k]&&p===u[k+1]&&v===u[k+2]&&_===u[k+3]&&(u[k]=y,u[k+1]=b,u[k+2]=w,u[k+3]=x)}}}catch(z){h.e(z)}finally{h.f()}}for(var M=0;M<u.length;M+=4)n=u[M+3]/255,u[M]=u[M]*n,u[M+1]=u[M+1]*n,u[M+2]=u[M+2]*n;var S=u,O=e,P=t,T=512;if(O>=T||P>=T){var C=O/P;C>1?(O=T,P=Math.round(T/C)):(P=T,O=Math.round(T*C)),S=new Uint8Array(4*O*P);var E=new Uint8ClampedArray(S.buffer);(0,F.TT)(u,e,t,E,O,P,!1)}return{size:[O,P],image:new Uint32Array(S.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}]),e}();function _e(e){if(!e)return null;var t=(0,E.RL)(e),r=(0,g.Z)(t,3),i=r[0],a=r[1],n=r[2];return i?{size:[a,n],image:new Uint32Array(i.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}var me=r(12233),ge=function(){function e(t,r){(0,o.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=r,this._free.push(new me.Z(0,0,t,r))}return(0,u.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new me.Z;for(var r=null,i=-1,a=0;a<this._free.length;++a){var n=this._free[a];e<=n.width&&t<=n.height&&(null===r||n.y<=r.y&&n.x<=r.x)&&(r=n,i=a)}return null===r?new me.Z:(this._free.splice(i,1),r.width<r.height?(r.width>e&&this._free.push(new me.Z(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new me.Z(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new me.Z(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new me.Z(r.x,r.y+t,e,r.height-t))),new me.Z(r.x,r.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),ye=r(57808),be=r(52311),we=function(e){return Math.floor(e/256)};function xe(e){var t,r=new Set,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r.add(we(a))}}catch(n){i.e(n)}finally{i.f()}return r}function ke(e,t,r){return e.has(t)||e.set(t,r().then((function(){e.delete(t)})).catch((function(r){e.delete(t),(0,ce.H9)(r)}))),e.get(t)}var Me=function(){function e(t,r,i){(0,o.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=t,this.height=r,this._glyphSource=i,this._binPack=new ge(t-4,r-4),this._glyphData.push(new Uint8Array(t*r)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs()}return(0,u.Z)(e,[{key:"dispose",value:function(){this._binPack=null;var e,t=(0,s.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var r=e.value;r&&r.dispose()}}catch(i){t.e(i)}finally{t.f()}this._textures.length=0,this._glyphData.length=0}},{key:"_initDecorationGlyphs",value:function(){for(var e=[117,149,181,207,207,181,149,117],t=[],r=[],i=0;i<e.length;i++)for(var a=e[i],n=0;n<11;n++){var s=i>=3&&i<5&&n>=3&&n<8?255:0;t.push(a),r.push(s)}var o={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)},u={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(r)};this._recordGlyph(o),this._recordGlyph(u)}},{key:"getTexture",value:function(e,t){if(!this._textures[t]){var r=new be.X;r.pixelFormat=te.VI.ALPHA,r.wrapMode=te.e8.CLAMP_TO_EDGE,r.width=this.width,r.height=this.height,this._textures[t]=new ye.x(e,r,new Uint8Array(this.width*this.height))}return this._dirties[t]&&(this._textures[t].setData(this._glyphData[t]),this._dirties[t]=!1),this._textures[t]}},{key:"getGlyphItems",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,a){var n,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._getGlyphCache(t),e.next=3,this._fetchRanges(t,r,a);case 3:return e.abrupt("return",r.map((function(e){return s._getMosaicItem(n,t,e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"bind",value:function(e,t,r,i){var a=this.getTexture(e,r);a.setSamplingMode(t),e.bindTexture(a,i)}},{key:"preloadASCIIGlyphCache",value:function(e){var t=this,r=this._preloadCache[e];if(null!=r)return r;var i=this._glyphSource.preloadASCIIRange(e).then((function(){for(var r=t._getGlyphCache(e),i=0;i<256;i++)t._getMosaicItem(r,e,i)}));return this._preloadCache[e]=i,i}},{key:"_getGlyphCache",value:function(e){return this._glyphCache[e]||(this._glyphCache[e]={}),this._glyphCache[e]}},{key:"_invalidate",value:function(){this._dirties[this._currentPage]=!0}},{key:"_fetchRanges",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,a){var n,s,o=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=xe(r),s=[],n.forEach((function(e){s.push(o._fetchRange(t,e,a))})),e.next=4,Promise.all(s);case 4:case"end":return e.stop()}}),e)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_fetchRange",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,a){var n,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r>256)){e.next=2;break}return e.abrupt("return");case 2:return n=t+r,e.abrupt("return",ke(this._rangePromises,n,(function(){return s._glyphSource.getRange(t,r,a)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_getMosaicItem",value:function(e,t,r){if(!e[r]){var i=this._glyphSource.getGlyph(t,r);if(null===i||void 0===i||!i.metrics)return function(e){return{rect:new me.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0}}(r);var a=this._recordGlyph(i),n=this._currentPage,s=i.metrics;e[r]={rect:a,page:n,metrics:s,code:r,sdf:!0},this._invalidate()}return e[r]}},{key:"_recordGlyph",value:function(e){var t,r=e.metrics;if(0===r.width)t=new me.Z(0,0,0,0);else{var i=r.width+6,a=r.height+6;(t=this._binPack.allocate(i,a)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new ge(this.width-4,this.height-4),t=this._binPack.allocate(i,a));var n,s,o=this._glyphData[this._currentPage],u=e.bitmap;if(u)for(var l=0;l<a;l++){n=i*l,s=this.width*(t.y+l)+t.x;for(var h=0;h<i;h++)o[s+h]=u[n+h]}(0,f.Z)("esri-glyph-debug")&&this._showDebugPage(o)}return t}},{key:"_showDebugPage",value:function(e){var t=document.createElement("canvas"),r=t.getContext("2d"),i=new ImageData(this.width,this.height),a=i.data;t.width=this.width,t.height=this.height,t.style.border="1px solid black";for(var n=0;n<e.length;++n)a[4*n]=e[n],a[4*n+1]=0,a[4*n+2]=0,a[4*n+3]=255;r.putImageData(i,0,0),document.body.appendChild(t)}}]),e}(),Se=r(78084),Oe=function(){function e(t){for((0,o.Z)(this,e),this._metrics=[],this._bitmaps=[];t.next();)if(1===t.tag()){for(var r=t.getMessage();r.next();)if(3===r.tag()){for(var i=r.getMessage(),a=void 0,n=void 0,s=void 0,u=void 0,l=void 0,h=void 0,c=void 0;i.next();)switch(i.tag()){case 1:a=i.getUInt32();break;case 2:n=i.getBytes();break;case 3:s=i.getUInt32();break;case 4:u=i.getUInt32();break;case 5:l=i.getSInt32();break;case 6:h=i.getSInt32();break;case 7:c=i.getUInt32();break;default:i.skip()}i.release(),a&&(this._metrics[a]={width:s,height:u,left:l,top:h,advance:c},this._bitmaps[a]=n)}else r.skip();r.release()}else t.skip()}return(0,u.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),Pe=function(){function e(){(0,o.Z)(this,e),this._ranges=[]}return(0,u.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),Te=function(){function e(t){(0,o.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,u.Z)(e,[{key:"getRange",value:function(e,t,r){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var n=256*t,s=n+255,o=this._baseURL.replace("{fontstack}",e).replace("{range}",n+"-"+s);return(0,le.Z)(o,(0,a.Z)({responseType:"array-buffer"},r)).then((function(e){i.addRange(t,new Oe(new Se.Z(new Uint8Array(e.data),new DataView(e.data))))}))}},{key:"preloadASCIIRange",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,a,n,s,o,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._getFontStack(t),a=0,n=255,s=this._baseURL.replace("{fontstack}",t).replace("{range}",a+"-"+n),e.next=6,(0,le.Z)(s,{responseType:"array-buffer"});case 6:for(o=e.sent,u=new Oe(new Se.Z(new Uint8Array(o.data),new DataView(o.data))),l=a;l<=n;l++)r.getRange(l)||r.addRange(l,u);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyph",value:function(e,t){var r=this._getFontStack(e);if(r){var i=Math.floor(t/256),a=r.getRange(i);return a?{metrics:a.getMetrics(t),bitmap:a.getBitmap(t)}:void 0}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new Pe),t}}]),e}(),Ce=r(46228),Ee=1e20,Fe=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;(0,o.Z)(this,e),this._textureSize=t,this._rasterizationScale=r,this._canvasSize=this._textureSize*this._rasterizationScale,this._svg=null;var i=this._canvasSize,a=document.createElement("canvas");a.width=a.height=i,this._context=a.getContext("2d",{willReadFrequently:!1}),this._gridOuter=new Float64Array(i*i),this._gridInner=new Float64Array(i*i),this._f=new Float64Array(i),this._d=new Float64Array(i),this._z=new Float64Array(i+1),this._v=new Int16Array(i)}return(0,u.Z)(e,[{key:"dispose",value:function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}},{key:"draw",value:function(e,t,r){var i=this,a=this._canvasSize,n=this._textureSize,s=this._rasterizationScale,o=n/4;this._initSVG();var u=this.createSVGString(e,t);return new Promise((function(e,t){var l=new Image;l.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(u),l.onload=function(){l.onload=null,i._context.clearRect(0,0,a,a),i._context.drawImage(l,0,0,a,a);for(var t=i._context.getImageData(0,0,a,a),r=new Uint8Array(n*n*4),u=0;u<a*a;u++){var h=t.data[4*u+3]/255;i._gridOuter[u]=1===h?0:0===h?Ee:Math.pow(Math.max(0,.5-h),2),i._gridInner[u]=1===h?Ee:0===h?0:Math.pow(Math.max(0,h-.5),2)}i._edt(i._gridOuter,a,a),i._edt(i._gridInner,a,a);for(var c=0;c<n*n;c++){for(var d=0,f=0;f<s;f++)for(var p=Math.floor(c/n)*s+f,v=0;v<s;v++){var _=p*a+(c%n*s+v);d+=i._gridOuter[_]-i._gridInner[_]}d/=s*s,d/=s,(0,Ce.I)(.5-d/(2*o),r,4*c)}e(r)};var h=null===r||void 0===r?void 0:r.signal;h&&(0,ce.fu)(h,(function(){return t((0,ce.zE)())}))}))}},{key:"_initSVG",value:function(){if(!this._svg){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),this._svg=e}return this._svg}},{key:"createSVGString",value:function(e,t){var r=this._initSVG(),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",e),r.appendChild(i);var a,n,s,o=i.getBBox(),u=o.width/o.height,l=this._canvasSize/2;if(u>1){a=l/o.width;var h=l*(1/u);n=this._canvasSize/4,s=l-h/2}else a=l/o.height,n=l-l*u/2,s=this._canvasSize/4;var c=-o.x*a+n,d=-o.y*a+s;i.setAttribute("style","transform: matrix(".concat(a,", 0, 0, ").concat(a,", ").concat(c,", ").concat(d,")")),i.setAttribute("stroke-width",""+.5/a);var f='<svg style="fill:'.concat(t?"red":"none","; stroke:").concat(t?"none":"red",'" height="').concat(this._canvasSize,'" width="').concat(this._canvasSize,'" xmlns="http://www.w3.org/2000/svg">').concat(r.innerHTML,"</svg>");return r.removeChild(i),f}},{key:"_edt",value:function(e,t,r){for(var i=this._f,a=this._d,n=this._v,s=this._z,o=0;o<t;o++){for(var u=0;u<r;u++)i[u]=e[u*t+o];this._edt1d(i,a,n,s,r);for(var l=0;l<r;l++)e[l*t+o]=a[l]}for(var h=0;h<r;h++){for(var c=0;c<t;c++)i[c]=e[h*t+c];this._edt1d(i,a,n,s,t);for(var d=0;d<t;d++)e[h*t+d]=Math.sqrt(a[d])}}},{key:"_edt1d",value:function(e,t,r,i,a){r[0]=0,i[0]=-Ee,i[1]=+Ee;for(var n=1,s=0;n<a;n++){for(var o=(e[n]+n*n-(e[r[s]]+r[s]*r[s]))/(2*n-2*r[s]);o<=i[s];)s--,o=(e[n]+n*n-(e[r[s]]+r[s]*r[s]))/(2*n-2*r[s]);r[++s]=n,i[s]=o,i[s+1]=+Ee}for(var u=0,l=0;u<a;u++){for(;i[l+1]<u;)l++;t[u]=(u-r[l])*(u-r[l])+e[r[l]]}}}]),e}(),ze=r(13200);function Re(e){return e&&"static"===e.type}var Be=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,o.Z)(this,e),this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,this._pageWidth=t,this._pageHeight=r,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new ge(this._pageWidth,this._pageHeight);var a=Math.floor(this._pageWidth),n=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(a*n)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}return(0,u.Z)(e,[{key:"getWidth",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]}},{key:"getHeight",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]}},{key:"getPageTexture",value:function(e){return e<this._mosaicPages.length?this._mosaicPages[e].texture:null}},{key:"has",value:function(e){return this._mosaicRects.has(e)}},{key:"itemCount",get:function(){return this._mosaicRects.size}},{key:"getSpriteItem",value:function(e){return this._mosaicRects.get(e)}},{key:"addSpriteItem",value:function(e,t,r,i,a,n){var s,o,u,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(this._mosaicRects.has(e))return this._mosaicRects.get(e);if(Re(r)){var h=this._allocateImage(t[0],t[1]),c=(0,g.Z)(h,3);s=c[0],o=c[1],u=c[2]}else{s=new me.Z(0,0,t[0],t[1]),o=this._mosaicPages.length;var d=void 0;this._mosaicPages.push({mosaicsData:r,size:[t[0]+2*R.s4,t[1]+2*R.s4],dirty:!0,texture:d})}if(s.width<=0||s.height<=0)return null;var p={type:"sprite",rect:s,width:t[0],height:t[1],sdf:a,simplePattern:n,rasterizationScale:l,page:o};return this._mosaicRects.set(e,p),Re(r)&&((0,f.Z)("esri-mosaic-debug")&&this._showDebugSprite(t,r.data),this._copy({rect:s,spriteSize:t,spriteData:r.data,page:o,pageSize:u,repeat:i,sdf:a})),p}},{key:"hasItemsToProcess",value:function(){return 0!==this._spriteCopyQueue.length}},{key:"processNextItem",value:function(){var e=this._spriteCopyQueue.pop();e&&this._copy(e)}},{key:"getMosaicItemPosition",value:function(e){var t=this.getSpriteItem(e),r=null===t||void 0===t?void 0:t.rect;if(!r)return null;r.width=t.width,r.height=t.height;var i=t.width,a=t.height,n=R.s4,s=this._mosaicPages[t.page].size;return{size:[t.width,t.height],tl:[(r.x+n)/s[0],(r.y+n)/s[1]],br:[(r.x+n+i)/s[0],(r.y+n+a)/s[1]],page:t.page}}},{key:"bind",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this._mosaicPages[r],n=a.mosaicsData,s=a.texture;s||(s=Ie(e,a.size),a.texture=s),s.setSamplingMode(t),Re(n)?(e.bindTexture(s,i),a.dirty&&(s.setData(new Uint8Array(n.data.buffer)),s.generateMipmap(),(0,f.Z)("esri-mosaic-debug")&&this._showDebugPage(r))):(n.data.loadFrame(s),e.bindTexture(s,i),s.generateMipmap()),a.dirty=!1}},{key:"getTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._mosaicPages[t],i=r.mosaicsData,a=r.texture;return a||(a=Ie(e,r.size),r.texture=a),Re(i)?r.dirty&&(a.setData(new Uint8Array(i.data.buffer)),a.generateMipmap(),(0,f.Z)("esri-mosaic-debug")&&this._showDebugPage(t)):(i.data.loadFrame(a),a.generateMipmap()),r.dirty=!1,a}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,s.Z)(this._mosaicPages);try{for(t.s();!(e=t.n()).done;){var r=e.value,i=r.texture;i&&i.dispose();var a=r.mosaicsData;Re(a)||a.data.destroy()}}catch(n){t.e(n)}finally{t.f()}this._mosaicPages=null,this._mosaicRects.clear()}},{key:"_copy",value:function(t){if(!(t.page>=this._mosaicPages.length)){var r=this._mosaicPages[t.page],i=r.mosaicsData;if(!Re(r.mosaicsData))throw new d.Z("mapview-invalid-resource","unsuitable data type!");var a=t.spriteData,n=i.data;e._copyBits(a,t.spriteSize[0],0,0,n,t.pageSize[0],t.rect.x+R.s4,t.rect.y+R.s4,t.spriteSize[0],t.spriteSize[1],t.repeat),r.dirty=!0}}},{key:"_allocateImage",value:function(e,t){e+=2*R.s4,t+=2*R.s4;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var i=Math.pow(2,Math.ceil((0,ze.k3)(e))),a=Math.pow(2,Math.ceil((0,ze.k3)(t))),n=new me.Z(0,0,e,t);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*a)},size:[i,a],dirty:!0,texture:void 0}),[n,this._mosaicPages.length-1,[i,a]]}var s=this._binPack.allocate(e,t);if(s.width<=0){var o=this._mosaicPages[this._currentPage];return!o.dirty&&Re(o.mosaicsData)&&(o.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new ge(this._pageWidth,this._pageHeight),this._allocateImage(e,t)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_showDebugSprite",value:function(e,t){var r=(0,g.Z)(e,2),i=r[0],a=r[1],n=document.createElement("canvas");n.width=i,n.height=a,n.setAttribute("style","position: absolute; top: ".concat(4+204*Ae++,"px; right: 208px; width: 200px; height: 200px; border: 1px solid black;"));var s=n.getContext("2d"),o=new ImageData(i,a);o.data.set(new Uint8Array(t.buffer)),s.putImageData(o,0,0),document.body.appendChild(n)}},{key:"_showDebugPage",value:function(e){var t,r=this._mosaicPages[e],i=(0,g.Z)(r.size,2),a=i[0],n=i[1],s=r.mosaicsData;if(Re(s)){var o="mosaicDebugPage".concat(e),u=null!==(t=document.getElementById(o))&&void 0!==t?t:document.createElement("canvas");u.id=o,u.width=a,u.height=n,u.setAttribute("style","position: absolute; top: ".concat(4+204*e,"px; right: 4px; width: 200px; height: 200px; border: 1px solid black;"));var l=u.getContext("2d"),h=new ImageData(a,n);h.data.set(new Uint8Array(s.data.buffer)),l.putImageData(h,0,0),document.body.appendChild(u)}}}],[{key:"_copyBits",value:function(e,t,r,i,a,n,s,o,u,l,h){var c=i*t+r,d=o*n+s;if(h){d-=n;for(var f=-1;f<=l;c=((++f+l)%l+i)*t+r,d+=n)for(var p=-1;p<=u;p++)a[d+p]=e[c+(p+u)%u]}else for(var v=0;v<l;v++){for(var _=0;_<u;_++)a[d+_]=e[c+_];c+=t,d+=n}}}]),e}(),Ae=0;function Ie(e,t){var r=new be.X;return r.width=t[0],r.height=t[1],r.wrapMode=te.e8.CLAMP_TO_EDGE,new ye.x(e,r,null)}var Ze=r(84319),Ue=r(25999),Le=function(){function e(t,r,i,a){var n=this;(0,o.Z)(this,e),this._animation=t,this._frameData=null;this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=(0,Ue.hY)(this._animation,i,a,(function(e){n._frameData=e,r.requestRender()}))}return(0,u.Z)(e,[{key:"destroy",value:function(){this._playHandle.remove()}},{key:"loadFrame",value:function(e){var t=this._frameData;if(null!=t){var r="width"in t?t.width:t.codedWidth,i="height"in t?t.height:t.codedHeight;e.updateData(0,R.s4,R.s4,r,i,t),this._frameData=null}}}]),e}(),De=r(38164),Ne="arial-unicode-ms-regular",Ve=function(e,t,r){return k.Z.getLogger("esri.views.2d.engine.webgl.TextureManager").error(new d.Z(e,t,r))},Ge=function(){function e(t,r,i){(0,o.Z)(this,e),this.mosaicType=t,this.page=r,this.sdf=i}return(0,u.Z)(e,null,[{key:"fromMosaic",value:function(t,r){return new e(t,r.page,r.sdf)}}]),e}(),He=function(){function e(t){(0,o.Z)(this,e),this._requestRender=t,this._resourceManager=new de.Z,this._invalidFontsMap=new Map,this._sdfConverter=new Fe(R.$0),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new De.e({concurrency:10,process:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,ce.k_)(r),e.prev=1,e.next=4,(0,le.Z)(t,{responseType:"image",signal:r});case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),(0,ce.D_)(e.t0)){e.next=11;break}throw new d.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(t),e.t0);case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}()}),this._spriteMosaic=new Be(2048,2048,500),this._glyphSource=new Te("".concat(ue.Z.fontsUrl,"/{fontstack}/{range}.pbf")),this._glyphMosaic=new Me(1024,1024,this._glyphSource),this._rasterizer=new ve(this.resourceManager)}return(0,u.Z)(e,[{key:"dispose",value:function(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null,this._resourceManager.destroy()}},{key:"sprites",get:function(){return this._spriteMosaic}},{key:"glyphs",get:function(){return this._glyphMosaic}},{key:"resourceManager",get:function(){return this._resourceManager}},{key:"rasterizeItem",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var a,n,o,u,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return",(Ve("mapview-null-resource","Unable to rasterize null resource"),null));case 2:if("cim-rasterization-info"===t.type){e.next=4;break}return e.abrupt("return",(Ve("mapview-unexpected-resource","Unable to rasterize resource"),null));case 4:if("text"!==(a=t.resource).type){e.next=12;break}return e.next=8,this._rasterizeText(a,r);case 8:n=e.sent,o=(0,s.Z)(n.glyphs);try{for(o.s();!(u=o.n()).done;)l=u.value,this._setTextureBinding(Y.Un.GLYPH,l)}catch(i){o.e(i)}finally{o.f()}return e.abrupt("return",n);case 12:return e.next=14,this._rasterizeSprite(a,r);case 14:return h=e.sent,e.abrupt("return",(h&&this._setTextureBinding(Y.Un.SPRITE,h),h));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getMosaicInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._getTextureBindingInfo(e,t,r);return i?{size:i.size,texture:{texture:i.texture,unit:"sprite"===i.type?R.Kt:R.wJ}}:(Ve("mapview-invalid-resource","Unable to find resource for ".concat(t)),{size:[0,0],texture:{texture:null,unit:0}})}},{key:"_getTextureBindingInfo",value:function(e,t,r){var i=this._bindingInfos[t-1],a=i.page,n=r?te.cw.LINEAR_MIPMAP_LINEAR:te.cw.LINEAR;switch(i.mosaicType){case Y.Un.SPRITE:var s=[this.sprites.getWidth(a),this.sprites.getHeight(a)],o=this._spriteMosaic.getTexture(e,a);return o.setSamplingMode(n),{type:"sprite",texture:o,size:s};case Y.Un.GLYPH:var u=[this.glyphs.width,this.glyphs.height],l=this._glyphMosaic.getTexture(e,a);return this._glyphMosaic.bind(e,n,a,R.wJ),l.setSamplingMode(n),{type:"glyph",texture:l,size:u};default:return Ve("mapview-texture-manager","Cannot handle unknown type ".concat(i.mosaicType)),null}}},{key:"_hashMosaic",value:function(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}},{key:"_setTextureBinding",value:function(e,t){var r=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(r)){var i=Ge.fromMosaic(e,t),a=this._bindingInfos.length+1;this._hashToBindingIndex.set(r,a),this._bindingInfos.push(i)}t.textureBinding=this._hashToBindingIndex.get(r)}},{key:"_rasterizeText",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var a,n,s,o,u,l,h,c,d,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.font,n=t.textString,s=(0,w.Yc)(a),o=this._invalidFontsMap.has(s),u=(0,he.E)(n),l=(0,g.Z)(u,2),h=l[0],c=l[1],d=(0,Ze.Jq)(h),e.prev=1,p=o?Ne:s,e.t0=(0,f.Z)("esri-2d-stabilize-glyphs"),!e.t0){e.next=7;break}return e.next=7,this._glyphMosaic.preloadASCIIGlyphCache(p);case 7:return e.next=9,this._glyphMosaic.getGlyphItems(p,d,r);case 9:return e.t1=e.sent,e.t2=c,e.abrupt("return",{type:"glyphs",glyphs:e.t1,isRightToLeft:e.t2});case 14:return e.prev=14,e.t3=e.catch(1),Ve("mapview-invalid-resource","Couldn't find font ".concat(s,". Falling back to Arial Unicode MS Regular")),this._invalidFontsMap.set(s,!0),e.next=19,this._glyphMosaic.getGlyphItems(Ne,d,r);case 19:return e.t4=e.sent,e.t5=c,e.abrupt("return",{type:"glyphs",glyphs:e.t4,isRightToLeft:e.t5});case 22:case"end":return e.stop()}}),e,this,[[1,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_hashSpriteResource",value:function(e){switch(e.type){case"path":return"path:".concat(e.path,".").concat(e.asFill?1:0);case"CIMPictureMarker":return"".concat(e.type,":").concat(e.url,":").concat(e.size);case"CIMPictureFill":return"".concat(e.type,":").concat(e.url,":").concat(e.height);case"CIMPictureStroke":return"".concat(e.type,":").concat(e.url,":").concat(e.width);case"dash":return"dash:".concat(e.capStyle,".").concat(e.dashTemplate.join(""));case"sdf":return"sdf:".concat(JSON.stringify(e.geom),".").concat(e.asFill?1:0);case"fill-style":return"fill_style:".concat(e.style);case"animated":return JSON.stringify((0,Ze.IS)(e));case"CIMHatchFill":case"CIMVectorMarker":return JSON.stringify(e)}}},{key:"_rasterizeSprite",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var a,n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(n=(0,S.hP)(this._hashSpriteResource(t)),!this._spriteMosaic.has(n)){e.next=5;break}return e.abrupt("return",this._spriteMosaic.getSpriteItem(n));case 5:if(!("url"in t&&t.url||"CIMPictureFill"===t.type||"CIMPictureStroke"===t.type||"CIMPictureMarker"===t.type||"CIMVectorMarker"===t.type)){e.next=12;break}if(s=[],O.B$.fetchResources({type:"CIMPointSymbol",symbolLayers:[t]},this._resourceManager,s),e.t0=s.length>0,!e.t0){e.next=12;break}return e.next=12,Promise.all(s);case 12:e.t1=t.type,e.next="CIMPictureMarker"===e.t1?15:"animated"===e.t1||"CIMPictureFill"===e.t1||"CIMPictureStroke"===e.t1||"path"===e.t1?16:"sdf"===e.t1||"dash"===e.t1||"fill-style"===e.t1||"CIMVectorMarker"===e.t1||"CIMHatchFill"===e.t1?17:18;break;case 15:return e.abrupt("return","CIMMarkerPlacementInsidePolygon"===(null===(a=t.markerPlacement)||void 0===a?void 0:a.type)?this._rasterizeJSONResource(n,t):this._handleAsyncResource(n,t,r));case 16:return e.abrupt("return",this._handleAsyncResource(n,t,r));case 17:return e.abrupt("return",this._rasterizeJSONResource(n,t));case 18:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_rasterizeJSONResource",value:function(e,t){var r=this._rasterizer.rasterizeJSONResource(t);if(r){var i=r.size,a=r.image,n=r.sdf,s=r.simplePattern,o=r.rasterizationScale;return this._addItemToMosaic(e,i,{type:"static",data:a},qe(t),n,s,o)}return null}},{key:"_handleAsyncResource",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,a){var n,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ongoingRasterizations.has(t)){e.next=2;break}return e.abrupt("return",this._ongoingRasterizations.get(t));case 2:return e.abrupt("return",(n="path"===r.type?this._handleSVG(r,t,a):this._handleImage(r,t,a),this._ongoingRasterizations.set(t,n),n.finally((function(){return s._ongoingRasterizations.delete(t)})),n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_handleSVG",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,a){var n,s,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[R.$0,R.$0],s=t.asFill,e.next=4,this._sdfConverter.draw(t.path,s,a);case 4:return o=e.sent,e.abrupt("return",this._addItemToMosaic(r,n,{type:"static",data:new Uint32Array(o.buffer)},!1,!0,!0));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_handleGIFOrPNG",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,a){var n,s,o,u,l,h,c,d,f,p,v,_,m;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url,null!=(s=this.resourceManager.getResource(n))){e.next=3;break}return e.abrupt("return",null);case 3:if(o=s.width,u=s.height,!(s instanceof HTMLImageElement)){e.next=9;break}if("animated"!==t.type){e.next=7;break}return e.abrupt("return",(Ve("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null));case 7:return l="colorSubstitutions"in t?t.colorSubstitutions:void 0,h=this._rasterizer.rasterizeImageResource(o,u,s,l),c=h.size,d=h.sdf,f=h.image,e.abrupt("return",this._addItemToMosaic(r,c,{type:"static",data:f},qe(t),d,!1));case 9:return"animated"===t.type?(p=!1,v={playAnimation:t.playAnimation,reverseAnimation:t.reverseAnimation,randomizeStartTime:t.randomizeStartTime,randomizeStartSeed:t.randomizeStartSeed,startTimeOffset:t.startTimeOffset,duration:t.duration,repeatType:t.repeatType,repeatDelay:t.repeatDelay},_=t.startGroup||0):(p=qe(t),v={},_=0),m=new Le(s,this._requestRender,v,_),e.abrupt("return",this._addItemToMosaic(r,[m.width,m.height],{type:"animated",data:m},p,!1,!1));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_handleImage",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,n){var s,o,u,l,h,c,f,p,v,_,m,g,y,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.url,!We(s)&&!Xe(s)){e.next=3;break}return e.abrupt("return",this._handleGIFOrPNG(t,r,n));case 3:if("animated"!==t.type){e.next=5;break}return e.abrupt("return",(Ve("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null));case 5:if(e.prev=5,!(null!=(u=this.resourceManager.getResource(s))&&u instanceof HTMLImageElement)){e.next=11;break}o=u,e.next=16;break;case 11:return e.next=13,this._imageRequestQueue.push(s,(0,a.Z)({},n));case 13:l=e.sent,h=l.data,o=h;case 16:if((0,Ze.TB)(s)&&("width"in t&&"height"in t?(o.width=(0,M.F2)(t.width),o.height=(0,M.F2)(t.height)):"cim"in t&&(f=t,o.width=(0,M.F2)(null!==(c=f.width)&&void 0!==c?c:f.scaleX*f.size),o.height=(0,M.F2)(f.size))),o.width&&o.height){e.next=19;break}return e.abrupt("return",null);case 19:return p=o.width,v=o.height,_="colorSubstitutions"in t?t.colorSubstitutions:void 0,m=this._rasterizer.rasterizeImageResource(p,v,o,_),g=m.size,y=m.sdf,b=m.image,e.abrupt("return",this._addItemToMosaic(r,g,{type:"static",data:b},qe(t),y,!1));case 23:if(e.prev=23,e.t0=e.catch(5),(0,ce.D_)(e.t0)){e.next=27;break}throw new d.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(s,". ").concat(e.t0.message));case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[5,23]])})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_addItemToMosaic",value:function(e,t,r,i,a,n,s){return this._spriteMosaic.addSpriteItem(e,t,r,i,a,n,s)}}]),e}();function qe(e){switch(e.type){case"CIMVectorMarker":case"CIMPictureMarker":return je(e);default:return!0}}var We=function(e){return e&&(e.includes(".gif")||function(e){return null!=e&&e.startsWith("data:image/gif")}(e))},Xe=function(e){return e&&(e.includes(".png")||function(e){return null!=e&&e.startsWith("data:image/png")}(e))},je=function(e){return e&&"markerPlacement"in e&&e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type},Ye=function(){function e(t){(0,o.Z)(this,e),this._queue=[],this._refreshable=t}return(0,u.Z)(e,[{key:"destroy",value:function(){this._queue=[]}},{key:"enqueueTextureUpdate",value:function(e,t){var r=(0,ce.hh)(),i=e,a=R.Uz,n=Math.ceil(i.height/a);(0,ce.k_)(t);for(var s=0;s<n;s++){var o=s*a,u=s===n-1,l=u?i.height-a*s:a;this._queue.push({type:"chunk",request:e,resolver:r,chunk:s,chunkOffset:o,destHeight:l,chunkIsLast:u,options:t})}return(0,ce.$F)(t,(function(e){return r.reject(e)})),r.promise}},{key:"upload",value:function(){for(var e=0;this._queue.length;){var t=performance.now(),r=this._queue.shift();if(r){if(null!=r.options.signal&&r.options.signal.aborted)continue;switch(r.type){case"chunk":this._uploadChunk(r);break;case"no-chunk":this._uploadNoChunk(r)}var i=performance.now()-t;if((e+=i)+i>=R.NG)break}}this._queue.length&&this._refreshable.requestRender()}},{key:"_uploadChunk",value:function(e){var t=e.request,r=e.resolver,i=e.chunkOffset,a=e.chunkIsLast,n=e.destHeight,s=t.data,o=t.texture,u=t.width;null!=s&&(o.updateData(0,0,i,u,n,s,i),a&&r.resolve())}},{key:"_uploadNoChunk",value:function(e){var t=e.request,r=e.resolver,i=t.data;t.texture.setData(i),r.resolve()}}]),e}(),Je=r(25866),$e=r(24204),Ke=r(29303),Qe=r(6644),et=r(32035),tt=r(12400),rt=r(92841),it=(0,Qe.al)(-.5,-.5),at=function(){function e(){(0,o.Z)(this,e),this._centerNdc=(0,tt.Ue)(),this._pxToNdc=(0,tt.Ue)(),this._worldDimensionsPx=(0,tt.Ue)(),this._mat3=(0,m.Ue)(),this._initialized=!1}return(0,u.Z)(e,[{key:"dispose",value:function(){this._program=(0,p.M2)(this._program),this._quad=(0,p.M2)(this._quad)}},{key:"render",value:function(e,t,r){var i=e.context,a=this._updateGeometry(e,r);if(null!=t){var n=t.r,s=t.g,o=t.b,u=t.a;i.setClearColor(u*n/255,u*s/255,u*o/255,u)}else i.setClearColor(0,0,0,0);if(i.setStencilFunction(te.wb.ALWAYS,0,255),i.setStencilWriteMask(255),!a)return i.setClearStencil(1),void i.clear(i.gl.STENCIL_BUFFER_BIT|i.gl.COLOR_BUFFER_BIT);i.setClearStencil(0),i.clear(i.gl.STENCIL_BUFFER_BIT|i.gl.COLOR_BUFFER_BIT),this._initialized||this._initialize(i),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setColorMask(!1,!1,!1,!1),i.setBlendingEnabled(!1),i.setStencilOp(te.xS.KEEP,te.xS.KEEP,te.xS.REPLACE),i.setStencilFunction(te.wb.ALWAYS,1,255),i.setStencilTestEnabled(!0),i.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.draw(),this._quad.unbind()}},{key:"_initialize",value:function(e){if(!this._initialized){var t=(0,re.H)(e,rt.H);t&&(this._program=t,this._quad=new Je.Z(e,[0,0,1,0,0,1,1,1]),this._initialized=!0)}}},{key:"_updateGeometry",value:function(e,t){var r=e.state,i=e.pixelRatio,a=r.size,n=r.rotation,s=Math.round(a[0]*i),o=Math.round(a[1]*i);if(!r.spatialReference.isWrappable)return!1;var u=(0,$e.c$)(n),l=Math.abs(Math.cos(u)),h=Math.abs(Math.sin(u)),c=Math.round(s*l+o*h),d=Math.round(i*r.worldScreenWidth);if(c<=d)return!1;var f=s*h+o*l,p=(t.left-t.right)*i/s,v=(t.bottom-t.top)*i/o;(0,et.s)(this._worldDimensionsPx,d,f,1),(0,et.s)(this._pxToNdc,2/s,-2/o,1),(0,et.s)(this._centerNdc,p,v,1);var _=this._mat3;return(0,Ke.vc)(_,this._centerNdc),(0,Ke.bA)(_,_,this._pxToNdc),0!==n&&(0,Ke.U1)(_,_,u),(0,Ke.bA)(_,_,this._worldDimensionsPx),(0,Ke.Iu)(_,_,it),!0}}]),e}(),nt=function(){function e(){(0,o.Z)(this,e),this.name=this.constructor.name}return(0,u.Z)(e,[{key:"createOptions",value:function(e,t){return null}}]),e}(),st=function(e){(0,h.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).defines=[],e._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])},e}return(0,u.Z)(r,[{key:"dispose",value:function(){this._quad&&this._quad.dispose()}},{key:"bind",value:function(){}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){if(null!==t&&void 0!==t&&t.size){var r=e.context,i=e.renderingOptions;this._quad||(this._quad=new Je.Z(r,[0,0,1,0,0,1,1,1]));var a=r.getBoundFramebufferObject(),n=r.getViewport(),s=n.x,o=n.y,u=n.width,l=n.height,h=t.getBlock(R.wi.Animation);if(null!=h){var c=t.getUniforms(r);r.setViewport(0,0,t.size,t.size);var d=c.filterFlags,p=c.animation,v=(0,f.Z)("featurelayer-animation-enabled")?i.labelsAnimationTime:1,_=h.getFBO(r,1);r.unbindTexture(_.colorTexture),this._computeDelta(e,_,p,d,v);var m=h.getFBO(r);r.unbindTexture(m.colorTexture),this._updateAnimationState(e,_,m),r.bindFramebuffer(a),r.setViewport(s,o,u,l)}}}},{key:"_computeDelta",value:function(e,t,r,i,a){var n=e.context,s=e.painter,o=e.displayLevel,u=s.materialManager.getProgram(this._desc,["delta"]);if(n.bindFramebuffer(t),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.clear(n.gl.COLOR_BUFFER_BIT),n.useProgram(u),!("type"in i.texture)||!("type"in r.texture))throw new Error("InternalError: Expected to find texture");n.bindTexture(i.texture,i.unit),n.bindTexture(r.texture,r.unit),u.setUniform1i("u_maskTexture",i.unit),u.setUniform1i("u_sourceTexture",r.unit),u.setUniform1f("u_timeDelta",e.deltaTime),u.setUniform1f("u_animationTime",a),u.setUniform1f("u_zoomLevel",Math.round(10*o)),this._quad.draw()}},{key:"_updateAnimationState",value:function(e,t,r){var i=e.context,a=e.painter.materialManager.getProgram(this._desc,["update"]);i.bindTexture(t.colorTexture,1),i.useProgram(a),a.setUniform1i("u_sourceTexture",1),i.bindFramebuffer(r),i.setColorMask(!0,!0,!0,!0),i.setClearColor(0,0,0,0),i.clear(i.gl.COLOR_BUFFER_BIT),this._quad.draw()}}]),r}(nt),ot=r(54711),ut=function(e){return"#define ".concat(function(e){return e.replace("-","_").toUpperCase()}(e),"\n")};function lt(e){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:ut(e)+(0,ot.w)("blend/blend.vert"),fragmentShader:ut(e)+(0,ot.w)("blend/blend.frag")}}}var ht=function(){return k.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect")},ct=function(){function e(){(0,o.Z)(this,e),this._size=[0,0]}return(0,u.Z)(e,[{key:"dispose",value:function(e){this._backBufferTexture=(0,p.M2)(this._backBufferTexture),this._quad=(0,p.M2)(this._quad)}},{key:"draw",value:function(e,t,r,i,a){var n=e.context,s=e.drawPhase;if(this._setupShader(n),i&&"normal"!==i&&s!==Y.jx.LABEL)this._drawBlended(e,t,r,i,a);else{var o=lt("normal"),u=n.programCache.acquire(o.shaders.vertexShader,o.shaders.fragmentShader,o.attributes);if(u){n.useProgram(u),t.setSamplingMode(r),n.bindTexture(t,0),u.setUniform1i("u_layerTexture",0),u.setUniform1f("u_opacity",a),n.setBlendingEnabled(!0),n.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA);var l=this._quad;l.draw(),l.unbind(),u.dispose()}else ht().error(new d.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))}}},{key:"_drawBlended",value:function(e,t,r,i,a){var n,s,o=e.context,u=e.state,l=e.pixelRatio,h=e.inFadeTransition,c=u.size,f=o.getBoundFramebufferObject();null!=f?(n=f.width,s=f.height):(n=Math.round(l*c[0]),s=Math.round(l*c[1])),this._createOrResizeTexture(e,n,s);var p=this._backBufferTexture;f.copyToTexture(0,0,n,s,0,0,p),o.setStencilTestEnabled(!1),o.setStencilWriteMask(0),o.setBlendingEnabled(!0),o.setDepthTestEnabled(!1),o.setDepthWriteEnabled(!1);var v=lt(i),_=o.programCache.acquire(v.shaders.vertexShader,v.shaders.fragmentShader,v.attributes);if(_){o.useProgram(_),p.setSamplingMode(r),o.bindTexture(p,0),_.setUniform1i("u_backbufferTexture",0),t.setSamplingMode(r),o.bindTexture(t,1),_.setUniform1i("u_layerTexture",1),_.setUniform1f("u_opacity",a),_.setUniform1f("u_inFadeOpacity",h?1:0),o.setBlendFunction(te.zi.ONE,te.zi.ZERO);var m=this._quad;m.draw(),m.unbind(),_.dispose(),o.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA)}else ht().error(new d.Z("mapview-BlendEffect","Error creating shader program for blend mode ".concat(i)))}},{key:"_setupShader",value:function(e){this._quad||(this._quad=new Je.Z(e,[-1,-1,1,-1,-1,1,1,1]))}},{key:"_createOrResizeTexture",value:function(e,t,r){var i=e.context;if(null===this._backBufferTexture||t!==this._size[0]||r!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(t,r);else{var a=new be.X;a.internalFormat=te.VI.RGBA,a.wrapMode=te.e8.CLAMP_TO_EDGE,a.width=t,a.height=r,this._backBufferTexture=new ye.x(i,a)}this._size[0]=t,this._size[1]=r}}}]),e}(),dt=function(e){(0,h.Z)(r,e);var t=(0,c.Z)(r);function r(e){var i;return(0,o.Z)(this,r),(i=t.call(this)).name=i.constructor.name,i.defines=[e],i}return(0,u.Z)(r,[{key:"dispose",value:function(){}},{key:"bind",value:function(e){var t=e.context,r=e.painter;this._prev=t.getBoundFramebufferObject();var i=r.getFbos().effect0;t.bindFramebuffer(i),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){var r,i=e.context,a=e.painter,n=a.getPostProcessingEffects(t),o=i.getBoundFramebufferObject(),u=(0,s.Z)(n);try{for(u.s();!(r=u.n()).done;){var l=r.value,h=l.postProcessingEffect,c=l.effect;h.draw(e,o,c)}}catch(d){u.e(d)}finally{u.f()}i.bindFramebuffer(this._prev),i.setStencilTestEnabled(!1),a.blitTexture(i,o.colorTexture,te.cw.NEAREST),i.setStencilTestEnabled(!0)}}]),r}(nt),ft=r(17615),pt=r(93985),vt=r(61109),_t=function(){function e(){(0,o.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}},{key:"preBlur",value:function(e,t){e.bindTexture(t,R.Zt),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",ft.bM),e.bindVAO(this._resources.quadVAO),e.drawArrays(te.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"finalBlur",value:function(e,t){e.bindTexture(t,R.Zt),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",ft.dl),e.bindVAO(this._resources.quadVAO),e.drawArrays(te.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"renderHighlight",value:function(e,t,r){e.bindTexture(t,R.Zt),e.useProgram(this._resources.highlightProgram),r.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),e.drawArrays(te.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"_initialize",value:function(e,t,r){this._width=t,this._height=r;var i=ee.f.createVertex(e,te.l1.STATIC_DRAW,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),a=new ie.U(e,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new vt.G("a_position",2,te.g.BYTE,0,4),new vt.G("a_texcoord",2,te.g.UNSIGNED_BYTE,2,4)]},{geometry:i}),n=(0,re.H)(e,pt.C),s=(0,re.H)(e,pt.y);e.useProgram(n),n.setUniform1i("u_texture",R.Zt),n.setUniform1i("u_shade",R.Sf),n.setUniform1f("u_sigma",ft.pW),e.useProgram(s),s.setUniform1i("u_texture",R.Zt),s.setUniform1f("u_sigma",ft.pW),this._resources={quadGeometry:i,quadVAO:a,highlightProgram:n,blurProgram:s}}},{key:"setup",value:function(e,t,r){this._resources?(this._width=t,this._height=r):this._initialize(e,t,r)}}]),e}(),mt=r(53634),gt=r(3479);function yt(e,t,r){var i=new be.X(t,r);return i.wrapMode=te.e8.CLAMP_TO_EDGE,new mt.X(e,i,new gt.Y(te.Tg.STENCIL_INDEX8,t,r))}var bt=function(){function e(){(0,o.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}},{key:"_initialize",value:function(e,t,r){this._width=t,this._height=r;var i=yt(e,t,r),a=yt(e,t,r);this._resources={sharedBlur1Fbo:i,sharedBlur2Fbo:a}}},{key:"setup",value:function(e,t,r){!this._resources||this._width===t&&this._height===r||this.dispose(),this._resources||this._initialize(e,t,r)}},{key:"sharedBlur1Tex",get:function(){return this._resources.sharedBlur1Fbo.colorTexture}},{key:"sharedBlur1Fbo",get:function(){return this._resources.sharedBlur1Fbo}},{key:"sharedBlur2Tex",get:function(){return this._resources.sharedBlur2Fbo.colorTexture}},{key:"sharedBlur2Fbo",get:function(){return this._resources.sharedBlur2Fbo}}]),e}(),wt=function(e){(0,h.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).defines=["highlight"],e._hlRenderer=new _t,e._width=void 0,e._height=void 0,e._boundFBO=null,e._hlSurfaces=new bt,e._adjustedWidth=void 0,e._adjustedHeight=void 0,e._blitRenderer=new ae,e}return(0,u.Z)(r,[{key:"dispose",value:function(){var e,t;null!==(e=this._hlSurfaces)&&void 0!==e&&e.dispose(),null!==(t=this._hlRenderer)&&void 0!==t&&t.dispose(),this._boundFBO=null}},{key:"bind",value:function(e){var t=e.context,r=e.painter,i=t.getViewport(),a=i.width,n=i.height,s=r.getFbos().effect0;this.setup(e,a,n),t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"setup",value:function(e,t,r){var i=e.context;this._width=t,this._height=r;var a=t%4,n=r%4;t+=a<2?-a:4-a,r+=n<2?-n:4-n,this._adjustedWidth=t,this._adjustedHeight=r,this._boundFBO=i.getBoundFramebufferObject();var s=Math.round(1*t),o=Math.round(1*r);this._hlRenderer.setup(i,s,o),this._hlSurfaces.setup(i,s,o)}},{key:"draw",value:function(e){var t=e.context,r=e.passOptions.activeGradient,i=t.getBoundFramebufferObject();t.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(t,i.colorTexture,te.cw.NEAREST,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,r),this._boundFBO=null}}]),r}(nt),xt=function(e){(0,h.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).name=e.constructor.name,e.defines=["hittest"],e}return(0,u.Z)(r,[{key:"dispose",value:function(){null!=this._fbo&&this._fbo.dispose()}},{key:"createOptions",value:function(e,t){var r=e.pixelRatio;if(!t.length)return null;var i=t.shift(),a=i.x,n=i.y;this._outstanding=i;var s=(0,f.Z)("esri-mobile");return{type:"hittest",distance:(s?R.wN:R.S3)*r,smallSymbolDistance:(s?R.wN:R.pd)*r,smallSymbolSizeThreshold:R.fG,position:[a,n]}}},{key:"bind",value:function(e){var t=e.context,r=e.attributeView;if(r.size){var i=r.getBlock(R.wi.GPGPU);if(null!=i){var a=i.getFBO(t);t.setViewport(0,0,r.size,r.size),t.bindFramebuffer(a),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT)}}}},{key:"unbind",value:function(){}},{key:"draw",value:function(e){if(null!=this._outstanding){var t=this._outstanding;this._outstanding=null,this._resolve(e,t.resolvers)}}},{key:"_resolve",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var a,n,s,o,u,l,h,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.context,n=t.attributeView,null!=(s=n.getBlock(R.wi.GPGPU))){e.next=3;break}return e.abrupt("return",void r.forEach((function(e){return e.resolve([])})));case 3:return o=s.getFBO(a),u=new Uint8Array(o.width*o.height*4),e.prev=4,e.next=7,o.readPixelsAsync(0,0,o.width,o.height,te.VI.RGBA,te.Br.UNSIGNED_BYTE,u);case 7:e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(4),e.abrupt("return",void r.forEach((function(e){return e.resolve([])})));case 12:for(l=[],h=0;h<u.length;h+=4)c=h/4,u[h]&&l.push(c);r.forEach((function(e){return e.resolve(l)}));case 15:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(nt),kt=[1,0],Mt=[0,1],St=[1,.8,.6,.4,.2],Ot=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Pt=function(){function e(){(0,o.Z)(this,e),this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){if(this._quad=(0,p.M2)(this._quad),this._intensityFBO=(0,p.M2)(this._intensityFBO),this._compositeFBO=(0,p.M2)(this._compositeFBO),this._mipsFBOs){for(var e=0;e<this._nMips;e++)this._mipsFBOs[e]&&(this._mipsFBOs[e].horizontal.dispose(),this._mipsFBOs[e].vertical.dispose());this._mipsFBOs=null}}},{key:"draw",value:function(e,t,r){var i=t.width,a=t.height,n=e.context,s=e.painter.materialManager,o=n.gl,u=this._programDesc,l=r.strength,h=r.radius,c=r.threshold;this._quad||(this._quad=new Je.Z(n,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(e,i,a),n.setStencilTestEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),n.setStencilWriteMask(0);var d=this._quad;d.bind(),n.bindFramebuffer(this._intensityFBO);var f=s.getProgram(u.luminosityHighPass);n.useProgram(f),n.bindTexture(t.colorTexture,0),f.setUniform1i("u_texture",0),f.setUniform3fv("u_defaultColor",[0,0,0]),f.setUniform1f("u_defaultOpacity",0),f.setUniform1f("u_luminosityThreshold",c),f.setUniform1f("u_smoothWidth",.01);var p=[Math.round(i/2),Math.round(a/2)];n.setViewport(0,0,p[0],p[1]),n.setClearColor(0,0,0,0),n.clear(o.COLOR_BUFFER_BIT),d.draw(),n.setBlendingEnabled(!1);for(var v=this._intensityFBO.colorTexture,_=0;_<this._nMips;_++){var m=s.getProgram(u.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[_]}]);n.useProgram(m),n.bindTexture(v,_+1),m.setUniform1i("u_colorTexture",_+1),m.setUniform2fv("u_texSize",p),m.setUniform2fv("u_direction",kt),n.setViewport(0,0,p[0],p[1]);var g=this._mipsFBOs[_];n.bindFramebuffer(g.horizontal),d.draw(),v=g.horizontal.colorTexture,n.bindFramebuffer(g.vertical),n.bindTexture(v,_+1),m.setUniform2fv("u_direction",Mt),d.draw(),v=g.vertical.colorTexture,p[0]=Math.round(p[0]/2),p[1]=Math.round(p[1]/2)}n.setViewport(0,0,i,a);var y=s.getProgram(u.composite,[{name:"nummips",value:5}]);n.bindFramebuffer(this._compositeFBO),n.useProgram(y),y.setUniform1f("u_bloomStrength",l),y.setUniform1f("u_bloomRadius",h),y.setUniform1fv("u_bloomFactors",St),y.setUniform3fv("u_bloomTintColors",Ot),n.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),y.setUniform1i("u_blurTexture1",1),n.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),y.setUniform1i("u_blurTexture2",2),n.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),y.setUniform1i("u_blurTexture3",3),n.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),y.setUniform1i("u_blurTexture4",4),n.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),y.setUniform1i("u_blurTexture5",5),d.draw(),n.bindFramebuffer(t),n.setBlendingEnabled(!0);var b=s.getProgram(u.blit);n.useProgram(b),n.bindTexture(this._compositeFBO.colorTexture,6),b.setUniform1i("u_texture",6),n.setBlendFunction(te.zi.ONE,te.zi.ONE),d.draw(),d.unbind(),n.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),n.setStencilTestEnabled(!0)}},{key:"_createOrResizeResources",value:function(e,t,r){var i=e.context;if(!this._compositeFBO||this._size[0]!==t||this._size[1]!==r){this._size[0]=t,this._size[1]=r;var a=[Math.round(t/2),Math.round(r/2)];if(this._compositeFBO)this._compositeFBO.resize(t,r);else{var n=new be.X(t,r);n.internalFormat=te.VI.RGBA,n.wrapMode=te.e8.CLAMP_TO_EDGE,this._compositeFBO=new mt.X(i,n)}if(this._intensityFBO)this._intensityFBO.resize(a[0],a[1]);else{var s=new be.X(a[0],a[1]);s.internalFormat=te.VI.RGBA,s.wrapMode=te.e8.CLAMP_TO_EDGE,this._intensityFBO=new mt.X(i,s)}for(var o=0;o<this._nMips;o++){if(this._mipsFBOs[o])this._mipsFBOs[o].horizontal.resize(a[0],a[1]),this._mipsFBOs[o].vertical.resize(a[0],a[1]);else{var u=new be.X(a[0],a[1]);u.internalFormat=te.VI.RGBA,u.wrapMode=te.e8.CLAMP_TO_EDGE,this._mipsFBOs[o]={horizontal:new mt.X(i,u),vertical:new mt.X(i,u)}}a[0]=Math.round(a[0]/2),a[1]=Math.round(a[1]/2)}}}}]),e}(),Tt=[1,0],Ct=[0,1],Et=function(){function e(){(0,o.Z)(this,e),this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}},{key:"draw",value:function(e,t,r){var i=e.context,a=r.type,n=r.radius;if(0!==n){this._createOrResizeResources(e),this._quad||(this._quad=new Je.Z(i,[-1,-1,1,-1,-1,1,1,1]));var s=this._quad;s.bind(),"blur"===a?this._gaussianBlur(e,t,n):this._radialBlur(e,t),s.unbind()}}},{key:"_gaussianBlur",value:function(e,t,r){var i=e.context,a=e.state,n=e.painter,s=e.pixelRatio,o=a.size,u=n.materialManager,l=this._programDesc,h=this._quad,c=[Math.round(s*o[0]),Math.round(s*o[1])],d=this._blurFBO,f=u.getProgram(l.gaussianBlur,[{name:"radius",value:Math.ceil(r)}]);i.useProgram(f),i.setBlendingEnabled(!1),i.bindFramebuffer(d),i.bindTexture(t.colorTexture,4),f.setUniform1i("u_colorTexture",4),f.setUniform2fv("u_texSize",c),f.setUniform2fv("u_direction",Tt),f.setUniform1f("u_sigma",r),h.draw(),i.bindFramebuffer(t),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.bindTexture(null===d||void 0===d?void 0:d.colorTexture,5),f.setUniform1i("u_colorTexture",5),f.setUniform2fv("u_direction",Ct),h.draw(),i.setBlendingEnabled(!0),i.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),i.setStencilTestEnabled(!0)}},{key:"_radialBlur",value:function(e,t){var r=e.context,i=e.painter.materialManager,a=this._programDesc,n=this._quad,s=this._blurFBO;r.bindFramebuffer(s);var o=i.getProgram(a.radialBlur);r.useProgram(o),r.setBlendingEnabled(!1),r.bindTexture(t.colorTexture,4),o.setUniform1i("u_colorTexture",4),n.draw(),r.bindFramebuffer(t),r.setStencilWriteMask(0),r.setStencilTestEnabled(!1),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setBlendingEnabled(!0);var u=i.getProgram(a.blit);r.useProgram(u),r.bindTexture(null===s||void 0===s?void 0:s.colorTexture,5),u.setUniform1i("u_texture",5),r.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),n.draw()}},{key:"_createOrResizeResources",value:function(e){var t=e.context,r=e.state,i=e.pixelRatio,a=r.size,n=Math.round(i*a[0]),s=Math.round(i*a[1]);if(!this._blurFBO||this._size[0]!==n||this._size[1]!==s)if(this._size[0]=n,this._size[1]=s,this._blurFBO)this._blurFBO.resize(n,s);else{var o=new be.X(n,s);o.internalFormat=te.VI.RGBA,o.wrapMode=te.e8.CLAMP_TO_EDGE,this._blurFBO=new mt.X(t,o)}}}]),e}(),Ft=function(){function e(){(0,o.Z)(this,e),this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture=(0,p.M2)(this._layerFBOTexture)}},{key:"draw",value:function(e,t,r){var i=t.width,a=t.height;this._createOrResizeResources(e,i,a);var n=e.context,s=e.painter.materialManager,o=this._programDesc,u=this._quad,l=r.colorMatrix;u.bind();var h=this._layerFBOTexture;n.bindFramebuffer(t),t.copyToTexture(0,0,i,a,0,0,h),n.setBlendingEnabled(!1),n.setStencilTestEnabled(!1);var c=s.getProgram(o);n.useProgram(c),n.bindTexture(h,2),c.setUniformMatrix4fv("u_coefficients",l),c.setUniform1i("u_colorTexture",2),u.draw(),n.setBlendingEnabled(!0),n.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),n.setStencilTestEnabled(!0),u.unbind()}},{key:"_createOrResizeResources",value:function(e,t,r){var i=e.context;if(!this._layerFBOTexture||this._size[0]!==t||this._size[1]!==r){if(this._size[0]=t,this._size[1]=r,this._layerFBOTexture)this._layerFBOTexture.resize(t,r);else{var a=new be.X;a.internalFormat=te.VI.RGBA,a.wrapMode=te.e8.CLAMP_TO_EDGE,a.width=t,a.height=r,this._layerFBOTexture=new ye.x(i,a)}this._quad||(this._quad=new Je.Z(i,[-1,-1,1,-1,-1,1,1,1]))}}}]),e}(),zt=[1,0],Rt=[0,1],Bt=function(){function e(){(0,o.Z)(this,e),this._layerFBOTexture=null,this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._quad=null,this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture=(0,p.M2)(this._layerFBOTexture),this._horizontalBlurFBO=(0,p.M2)(this._horizontalBlurFBO),this._verticalBlurFBO=(0,p.M2)(this._verticalBlurFBO)}},{key:"draw",value:function(e,t,r){var i=e.context,a=e.state,n=e.painter.materialManager,s=this._programDesc,o=t.width,u=t.height,l=[Math.round(o),Math.round(u)],h=r.blurRadius,c=r.offsetX,d=r.offsetY,f=r.color,p=[(0,M.F2)(c),(0,M.F2)(d)];this._createOrResizeResources(e,o,u,l);var v=this._horizontalBlurFBO,_=this._verticalBlurFBO;i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1);var m=this._layerFBOTexture;t.copyToTexture(0,0,o,u,0,0,m),this._quad||(this._quad=new Je.Z(i,[-1,-1,1,-1,-1,1,1,1])),i.setViewport(0,0,l[0],l[1]);var g=this._quad;g.bind(),i.setBlendingEnabled(!1);var y=n.getProgram(s.blur,[{name:"radius",value:Math.ceil(h)}]);i.useProgram(y),i.bindFramebuffer(v),i.bindTexture(t.colorTexture,4),y.setUniform1i("u_colorTexture",4),y.setUniform2fv("u_texSize",l),y.setUniform2fv("u_direction",zt),y.setUniform1f("u_sigma",h),g.draw(),i.bindFramebuffer(_),i.bindTexture(null===v||void 0===v?void 0:v.colorTexture,5),y.setUniform1i("u_colorTexture",5),y.setUniform2fv("u_direction",Rt),g.draw(),i.bindFramebuffer(t),i.setViewport(0,0,o,u);var b=n.getProgram(s.composite);i.useProgram(b),i.bindTexture(null===_||void 0===_?void 0:_.colorTexture,2),b.setUniform1i("u_blurTexture",2),i.bindTexture(m,3),b.setUniform1i("u_layerFBOTexture",3),b.setUniform4fv("u_shadowColor",[f[3]*(f[0]/255),f[3]*(f[1]/255),f[3]*(f[2]/255),f[3]]),b.setUniformMatrix3fv("u_displayViewMat3",a.displayMat3),b.setUniform2fv("u_shadowOffset",p),g.draw(),i.setBlendingEnabled(!0),i.setStencilTestEnabled(!0),i.setBlendFunction(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),g.unbind()}},{key:"_createOrResizeResources",value:function(e,t,r,i){var a=e.context;if(!this._horizontalBlurFBO||this._size[0]!==t||this._size[1]!==r){if(this._size[0]=t,this._size[1]=r,this._horizontalBlurFBO)this._horizontalBlurFBO.resize(i[0],i[1]);else{var n=new be.X(i[0],i[1]);n.internalFormat=te.VI.RGBA,n.wrapMode=te.e8.CLAMP_TO_EDGE,this._horizontalBlurFBO=new mt.X(a,n)}if(this._verticalBlurFBO)this._verticalBlurFBO.resize(i[0],i[1]);else{var s=new be.X(i[0],i[1]);s.internalFormat=te.VI.RGBA,s.wrapMode=te.e8.CLAMP_TO_EDGE,this._verticalBlurFBO=new mt.X(a,s)}if(this._layerFBOTexture)this._layerFBOTexture.resize(t,r);else{var o=new be.X;o.internalFormat=te.VI.RGBA,o.wrapMode=te.e8.CLAMP_TO_EDGE,o.width=t,o.height=r,this._layerFBOTexture=new ye.x(a,o)}}}}]),e}(),At=function(){function e(){(0,o.Z)(this,e),this._size=[0,0],this._layerFBOTexture=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture=(0,p.M2)(this._layerFBOTexture)}},{key:"draw",value:function(e,t,r){var i=t.width,a=t.height;this._createOrResizeResources(e,i,a);var n=e.context,s=e.painter,o=r.amount,u=n.gl,l=this._layerFBOTexture;n.bindFramebuffer(t),t.copyToTexture(0,0,i,a,0,0,l),n.setBlendingEnabled(!0),n.setStencilTestEnabled(!1),n.setDepthTestEnabled(!1),n.setClearColor(0,0,0,0),n.clear(u.COLOR_BUFFER_BIT),s.blitTexture(n,l,te.cw.NEAREST,o)}},{key:"_createOrResizeResources",value:function(e,t,r){var i=e.context;if(!this._layerFBOTexture||this._size[0]!==t||this._size[1]!==r)if(this._size[0]=t,this._size[1]=r,this._layerFBOTexture)this._layerFBOTexture.resize(t,r);else{var a=new be.X;a.internalFormat=te.VI.RGBA,a.wrapMode=te.e8.CLAMP_TO_EDGE,a.samplingMode=te.cw.NEAREST,a.width=t,a.height=r,this._layerFBOTexture=new ye.x(i,a)}}}]),e}();function It(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return"colorize"}}var Zt={colorize:function(){return new Ft},blur:function(){return new Et},bloom:function(){return new Pt},opacity:function(){return new At},"drop-shadow":function(){return new Bt}},Ut=function(){function e(){(0,o.Z)(this,e),this._effectMap=new Map}return(0,u.Z)(e,[{key:"dispose",value:function(){this._effectMap.forEach((function(e){return e.dispose()})),this._effectMap.clear()}},{key:"getPostProcessingEffects",value:function(e){if(!e||0===e.length)return[];var t,r=[],i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,n=It(a.type),o=this._effectMap.get(n);o||(o=Zt[n](),this._effectMap.set(n,o)),r.push({postProcessingEffect:o,effect:a})}}catch(u){i.e(u)}finally{i.f()}return r}}]),e}(),Lt=r(63780),Dt=function(){function e(t,r){var i;(0,o.Z)(this,e),this.brushes=t,this.name=r.name,this.drawPhase=r.drawPhase||Y.jx.MAP,this._targetFn=r.target,this.effects=r.effects||[],this.enableDefaultDraw=null!==(i=r.enableDefaultDraw)&&void 0!==i?i:function(){return!0},this.forceDrawByDisplayOrder=!!r.forceDrawByDisplayOrder}return(0,u.Z)(e,[{key:"render",value:function(e){var t=e.context,r=e.profiler,i=this._targetFn(),a=this.drawPhase&e.drawPhase;if(r.recordPassStart(this.name),a){this.enableDefaultDraw()&&this._doRender(e,i),r.recordPassEnd();var n,o=(0,s.Z)(this.effects);try{for(o.s();!(n=o.n()).done;){var u,l=n.value;if(l.enable()){var h=l.apply,c=null===(u=l.args)||void 0===u?void 0:u.call(l),d=t.getViewport(),f=t.getBoundFramebufferObject(),p=e.passOptions;this._bindEffect(e,h,c),this._doRender(e,i,h.defines),this._drawAndUnbindEffect(e,h,d,f,p,c)}}}catch(v){o.e(v)}finally{o.f()}}}},{key:"_doRender",value:function(e,t,r){if(null!=t){var i,a=e.profiler,n=e.context,o=(0,s.Z)(this.brushes);try{for(o.s();!(i=o.n()).done;){var u=i.value;if(a.recordBrushStart(u.name),null!=u.brushEffect){var l=n.getViewport(),h=n.getBoundFramebufferObject(),c=e.passOptions;this._bindEffect(e,u.brushEffect),this._drawWithBrush(u,e,t,r),this._drawAndUnbindEffect(e,u.brushEffect,l,h,c)}else this._drawWithBrush(u,e,t,r);a.recordBrushEnd()}}catch(d){o.e(d)}finally{o.f()}}}},{key:"_drawWithBrush",value:function(e,t,r,i){(0,Lt.zG)(r)?(e.prepareState(t,i),e.drawMany(t,r,i)):r.visible&&(e.prepareState(t,i),e.draw(t,r,i))}},{key:"_bindEffect",value:function(e,t,r){e.profiler.recordPassStart(this.name+"."+t.name),t.bind(e,r);var i=t.createOptions(e,r);e.passOptions=i}},{key:"_drawAndUnbindEffect",value:function(e,t,r,i,a,n){var s=e.profiler,o=e.context;e.passOptions=a,s.recordBrushStart(t.name),t.draw(e,n),t.unbind(e,n),o.bindFramebuffer(i);var u=r.x,l=r.y,h=r.width,c=r.height;o.setViewport(u,l,h,c),s.recordBrushEnd(),s.recordPassEnd()}}]),e}(),Nt=function(){function e(){(0,o.Z)(this,e),this._programCache=new Map}return(0,u.Z)(e,[{key:"destroy",value:function(){var e,t=(0,s.Z)(this._programCache.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(r){t.e(r)}finally{t.f()}this._programCache.clear()}},{key:"getProgram",value:function(e,t,r,i,a){var n=e.getShaderKey(t,r,i,a),s=this._programCache.get(n);return s||(s=e.getProgram(t,r,i,a),this._programCache.set(n,s)),s}}]),e}(),Vt=r(15880),Gt=function(){function e(t,r){(0,o.Z)(this,e),this.context=t,this._currentPipelineStateNeedsUpdate=!1,this._blitRenderer=new ae,this._worldExtentRenderer=new at,this._brushCache=new Map,this._lastWidth=null,this._lastHeight=null,this._vtlMaterialManager=new $.Z,this._blendEffect=new ct,this._stencilBuf=null,this._prevBeforeLayerFBOStack=[],this._fboPool=[],this.effects={highlight:new wt,hittest:new xt,integrate:new st,insideEffect:new dt("inside"),outsideEffect:new dt("outside")},this._programCache=new Nt,this._shaderState={shader:null,uniforms:null,defines:null,optionalAttributes:null,useComputeBuffer:!1},this.materialManager=new oe(t),this.textureManager=new He(r),this.textureUploadManager=new Ye(r),this._effectsManager=new Ut,this._quadMesh=new Je.Z(t,[0,0,1,0,0,1,1,1])}return(0,u.Z)(e,[{key:"dispose",value:function(){var e;if(this._programCache.destroy(),this.materialManager.dispose(),this.textureManager.dispose(),this.textureUploadManager.destroy(),this._blitRenderer=(0,p.M2)(this._blitRenderer),this._worldExtentRenderer=(0,p.M2)(this._worldExtentRenderer),this._quadMesh.dispose(),this._brushCache&&(this._brushCache.forEach((function(e){return e.dispose()})),this._brushCache.clear(),this._brushCache=null),this._fbos)for(e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();var t,r,i=(0,s.Z)(this._fboPool);try{for(i.s();!(t=i.n()).done;){t.value.dispose()}}catch(a){i.e(a)}finally{i.f()}if(this._fboPool.length=0,this.effects)for(r in this.effects)this.effects[r]&&this.effects[r].dispose();this._effectsManager.dispose(),this._blendEffect.dispose(this.context),this._vtlMaterialManager=(0,p.M2)(this._vtlMaterialManager)}},{key:"clearShaderCache",value:function(){this._programCache.destroy(),this._programCache=new Nt}},{key:"blitRenderer",get:function(){return this._blitRenderer}},{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}},{key:"getFbos",value:function(){if(!this._fbos)throw new Error("InternalError: Painter FBOs not initialized");return this._fbos}},{key:"acquireFbo",value:function(e,t){var r;if(this._fboPool.length>0)r=this._fboPool.pop();else{var i=new be.X(e,t);i.samplingMode=te.cw.NEAREST,i.wrapMode=te.e8.CLAMP_TO_EDGE,r=new mt.X(this.context,i,this._stencilBuf)}return r.width===e&&r.height===t||r.resize(e,t),r}},{key:"releaseFbo",value:function(e){this._fboPool.push(e)}},{key:"getSharedStencilBuffer",value:function(){return this._stencilBuf}},{key:"beforeRenderPhases",value:function(e,t,r){var i=e.context;this._worldExtentRenderer.render(e,t,r);var a=i.getViewport(),n=a.width,s=a.height;if(this.updateFBOs(n,s),this._prevFBO=i.getBoundFramebufferObject(),i.bindFramebuffer(this.getFbos().output),i.setColorMask(!0,!0,!0,!0),null!=t){var o=t.r,u=t.g,l=t.b,h=t.a;i.setClearColor(h*o/255,h*u/255,h*l/255,h)}else i.setClearColor(0,0,0,0);i.setDepthWriteEnabled(!0),i.setClearDepth(1),i.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT),i.setDepthWriteEnabled(!1)}},{key:"afterRenderPhases",value:function(e){var t=e.context;t.bindFramebuffer(this._prevFBO),t.setStencilFunction(te.wb.EQUAL,1,255),t.setStencilTestEnabled(!0),t.setDepthTestEnabled(!1),this.blitTexture(t,this.getFbos().output.colorTexture,te.cw.NEAREST)}},{key:"beforeRenderLayer",value:function(e,t,r){var i=e.context,a=e.blendMode,n=e.effects,s=e.drawPhase;if(e.requireFBO||Ht(s,a,n,r)){var o=i.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(o);var u=i.getViewport(),l=u.width,h=u.height,c=this.acquireFbo(l,h);i.bindFramebuffer(c),i.setColorMask(!0,!0,!0,!0),i.setClearColor(0,0,0,0),i.setDepthWriteEnabled(!0),i.setClearDepth(1),i.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT),i.setDepthWriteEnabled(!1)}i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setStencilTestEnabled(!0),i.setClearStencil(t),i.setStencilWriteMask(255),i.clear(i.gl.STENCIL_BUFFER_BIT)}},{key:"afterRenderLayer",value:function(e,t){var r=e.context,i=e.blendMode,a=e.effects,n=e.requireFBO,s=e.drawPhase;if(n||Ht(s,i,a,t)){var o=r.getBoundFramebufferObject();null!=a&&a.length>0&&s===Y.jx.MAP&&(r.setColorMask(!0,!0,!0,!0),this._applyEffects(e,a,o)),r.bindFramebuffer(this._prevBeforeLayerFBOStack.pop()),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),r.setBlendingEnabled(!0),r.setBlendFunctionSeparate(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA,te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),r.setColorMask(!0,!0,!0,!0);var u=null==i||s===Y.jx.HIGHLIGHT?"normal":i;this._blendEffect.draw(e,o.colorTexture,te.cw.NEAREST,u,t),this.releaseFbo(o)}}},{key:"renderObject",value:function(e,t,r,i){var a=J.U[r];if(a){var n=this._brushCache.get(a);void 0===n&&(n=new a,this._brushCache.set(a,n)),n.prepareState(e),n.draw(e,t,i)}}},{key:"renderObjects",value:function(e,t,r,i){var a=J.U[r];if(a){var n=this._brushCache.get(a);void 0===n&&(n=new a,this._brushCache.set(a,n)),n.drawMany(e,t,i)}}},{key:"registerRenderPass",value:function(e){var t=this,r=e.brushes.map((function(e){return t._brushCache.has(e)||t._brushCache.set(e,new e),t._brushCache.get(e)}));return new Dt(r,e)}},{key:"blitTexture",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA,te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,r,i),this._currentPipelineStateNeedsUpdate=!0}},{key:"getPostProcessingEffects",value:function(e){return this._effectsManager.getPostProcessingEffects(e)}},{key:"updateFBOs",value:function(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){var r;for(r in this._fbos)this._fbos[r].resize(e,t);return}var i=new be.X(e,t);i.samplingMode=te.cw.NEAREST,i.wrapMode=te.e8.CLAMP_TO_EDGE;var a=new gt.Y(te.Tg.DEPTH_STENCIL,e,t);this._stencilBuf=new Vt.r(this.context,a),this._fbos={output:new mt.X(this.context,i,this._stencilBuf),effect0:new mt.X(this.context,i,this._stencilBuf)}}}},{key:"_applyEffects",value:function(e,t,r){var i,a=e.context,n=this._effectsManager.getPostProcessingEffects(t),o=(0,s.Z)(n);try{for(o.s();!(i=o.n()).done;){var u=i.value,l=u.postProcessingEffect,h=u.effect;a.bindFramebuffer(r),l.draw(e,r,h)}}catch(c){o.e(c)}finally{o.f()}this._currentPipelineStateNeedsUpdate=!0}},{key:"setShader",value:function(e){var t;this._shaderState.shader=e.shader,this._shaderState.uniforms=e.uniforms,this._shaderState.defines=e.defines,this._shaderState.optionalAttributes=e.optionalAttributes,this._shaderState.useComputeBuffer=null!==(t=e.useComputeBuffer)&&void 0!==t&&t}},{key:"setPipelineState",value:function(e){e!==this._currentPipelineState&&(this._currentPipelineState=e,this._currentPipelineStateNeedsUpdate=!0)}},{key:"submitDraw",value:function(e,t){var r=this._shaderState,i=r.shader,a=r.uniforms,n=r.defines,s=r.optionalAttributes,o=e.context,u=t.getAttributePrecisionPackFactors(),l=this._programCache.getProgram(i,u,a,null!==n&&void 0!==n?n:{},null!==s&&void 0!==s?s:{});return l.setUniforms(a),l.bind(o),this.updatePipelineState(o),this.setStencilRef(o,t),t.draw(e,i.locationInfo),l.cleanupTemporaryTextures(),{vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}},{key:"submitDrawQuad",value:function(e){var t=this._shaderState,r=t.shader,i=t.uniforms,a=t.defines,n=t.optionalAttributes,s=this._programCache.getProgram(r,{},i,null!==a&&void 0!==a?a:{},null!==n&&void 0!==n?n:{});s.setUniforms(i),s.bind(e),this.updatePipelineState(e),this._quadMesh.draw(),e.bindVAO(null),s.cleanupTemporaryTextures()}},{key:"submitDrawMesh",value:function(e,t,r){var i=this._shaderState,a=i.shader,n=i.uniforms,o=i.defines,u=i.optionalAttributes,l=this._programCache.getProgram(a,{},n,null!==o&&void 0!==o?o:{},null!==u&&void 0!==u?u:{});if(l.setUniforms(n),l.bind(e),this.updatePipelineState(e),r){var h,c=(0,s.Z)(r);try{for(c.s();!(h=c.n()).done;){var d=h.value;t.bind(e,d),t.draw(e)}}catch(p){c.e(p)}finally{c.f()}}else for(var f=0;f<t.parts.length;f++)t.bind(e,f),t.draw(e);t.unbind(e),l.cleanupTemporaryTextures()}},{key:"updatePipelineState",value:function(e){this._currentPipelineStateNeedsUpdate&&(this._currentPipelineStateNeedsUpdate=!1,this._updatePipelineState(e))}},{key:"_updatePipelineState",value:function(e){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");var t=this._currentPipelineState,r=t.color,i=t.depth,a=t.stencil;if(r){var n=r.blendMode,s=r.write;switch(e.setColorMask.apply(e,(0,y.Z)(s)),e.setBlendingEnabled(!0),e.setBlendEquation(te.db.ADD),n){case"composite":e.setBlendFunctionSeparate(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA,te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA);break;case"additive":e.setBlendFunctionSeparate(te.zi.ONE,te.zi.ONE,te.zi.ONE,te.zi.ONE);break;case"custom":var o=r.blendParameters,u=o.dstAlpha,l=o.dstRGB,h=o.srcAlpha,c=o.srcRGB;e.setBlendFunctionSeparate(c,l,h,u);break;case"delete":e.setBlendEquation(te.db.REVERSE_SUBTRACT),e.setBlendFunctionSeparate(te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA,te.zi.ONE,te.zi.ONE_MINUS_SRC_ALPHA)}}if(i){var d=i.test,f=i.write;f?(e.setDepthWriteEnabled(!0),e.setDepthRange(f.zNear,f.zFar)):e.setDepthWriteEnabled(!1),d?(e.setDepthTestEnabled(!0),e.setDepthFunction(d)):e.setDepthTestEnabled(!1)}else e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1);if(a){var p=a.test,v=a.write;if(p){var _=p.compare,m=p.mask,g=p.op,b=p.ref;e.setStencilTestEnabled(!0),"function"!=typeof b&&e.setStencilFunctionSeparate(te.LR.FRONT_AND_BACK,_,b,m),e.setStencilOpSeparate(te.LR.FRONT_AND_BACK,g.fail,g.zFail,g.zPass)}else e.setStencilTestEnabled(!1);if(v){var w=v.mask;e.setStencilWriteMask(w)}else e.setStencilWriteMask(0)}else e.setStencilTestEnabled(!1),e.setStencilWriteMask(0)}},{key:"setStencilRef",value:function(e,t){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");var r=this._currentPipelineState.stencil;if(r){var i=r.test;if(i){var a=i.compare,n=i.mask;if("function"==typeof i.ref){var s=t.getStencilReference();if(null===s)throw new Error("InternalError: Stencil reference expected for target but not defined");e.setStencilFunctionSeparate(te.LR.FRONT_AND_BACK,a,s,n)}}}}}]),e}();function Ht(e,t,r,i){return e!==Y.jx.LABEL_ALPHA&&e!==Y.jx.LABEL&&e!==Y.jx.HIGHLIGHT&&(1!==i||null!=t&&"normal"!==t||null!=r&&r.length>0)}var qt=r(34517),Wt=r(13163),Xt=r(47566),jt=r(93560),Yt=r(86540),Jt=r(84786),$t=r(7796),Kt=r(85377),Qt=r(51e3),er=function(e){(0,h.Z)(r,e);var t=(0,c.Z)(r);function r(e,i){var a,n;(0,o.Z)(this,r),(n=t.call(this)).meshWriterRegistry=new Yt.a,n._trash=new Set,n._renderRemainingTime=0,n._lastFrameRenderTime=0,n._renderRequested=(0,_.t)(!1),n.stage=(0,l.Z)(n),n._stationary=!0,n._reshuffleManager=new Xt.y,n._canvas=new j(e),n.context=new Kt.x(n._canvas.gl,null!==(a=i.contextOptions)&&void 0!==a?a:{}),n.painter=new Gt(n.context,(0,l.Z)(n)),n._cimAnalyzer=new A(n.painter.textureManager.resourceManager),(0,f.Z)("esri-2d-profiler")&&(n._debugOutput=document.createElement("div"),n._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),e.appendChild(n._debugOutput));return n._renderParameters={drawPhase:0,state:n.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:n.context,painter:n.painter,timeline:i.timeline||new Jt.T,renderingOptions:i.renderingOptions,requestRender:function(){return n.requestRender()},allowDelayedRender:!1,requireFBO:!1,profiler:new Wt.Q(n.context,n._debugOutput),dataUploadCounter:0,get highlightGradient(){return n._highlightGradient},reshuffleManager:n._reshuffleManager,backgroundColor:i.backgroundColor},n._taskHandle=(0,v.A)({render:function(e){return n.renderFrame(e)}}),n._taskHandle.pause(),n._lostWebGLContextHandle=n._canvas.events.on("webgl-context-lost",(function(e){return n.emit("webgl-error",{error:new d.Z("webgl-context-lost",e.statusMessage)})})),n._bufferPool=new qt.o,(0,jt.W4)(),n}return(0,u.Z)(r,[{key:"destroy",value:function(){var e,t;(0,jt.IG)(this.context),this.removeAllChildren(),this._emptyTrash(),this._taskHandle=(0,p.hw)(this._taskHandle),this._lostWebGLContextHandle=(0,p.hw)(this._lostWebGLContextHandle),this._canvas.destroy(),null!==(e=this._debugOutput)&&void 0!==e&&null!==(t=e.parentNode)&&void 0!==t&&t.removeChild(this._debugOutput),this._bufferPool.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}},{key:"textureManager",get:function(){return this.painter.textureManager}},{key:"backgroundColor",get:function(){return this._renderParameters.backgroundColor},set:function(e){this._renderParameters.backgroundColor=e,this.requestRender()}},{key:"bufferPool",get:function(){return this._bufferPool}},{key:"cimAnalyzer",get:function(){return this._cimAnalyzer}},{key:"renderingOptions",get:function(){return this._renderingOptions},set:function(e){this._renderingOptions=e,this.requestRender()}},{key:"renderRequested",get:function(){return this._renderRequested.value}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this.requestRender()}},{key:"stationary",get:function(){return this._stationary},set:function(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}},{key:"trashDisplayObject",value:function(e){this._trash.add(e),this.requestRender()}},{key:"untrashDisplayObject",value:function(e){return this._trash.delete(e)}},{key:"requestRender",value:function(){this._renderRemainingTime=2e3,this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}},{key:"renderFrame",value:function(e){var t=this._lastFrameRenderTime?e.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=t,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=e.time,this._renderRequested.value=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash()}},{key:"_createTransforms",value:function(){return{displayViewScreenMat3:(0,m.Ue)()}}},{key:"renderChildren",value:function(e){var t,r=this,i=(0,s.Z)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.beforeRender(e)}}catch(o){i.e(o)}finally{i.f()}this._reshuffleManager.reshuffle(R.BZ),this._canvas.render(e,(function(){return r._renderChildren(r.children,e)}));var a,n=(0,s.Z)(this.children);try{for(n.s();!(a=n.n()).done;){a.value.afterRender(e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_renderChildren",value:function(e,t){var r=this.context;this.painter.textureUploadManager.upload(),r.resetInfo(),t.profiler.recordStart("drawLayers"),t.dataUploadCounter=0,this.painter.beforeRenderPhases(t,t.backgroundColor,this.state.padding),t.drawPhase=Y.jx.MAP;var i,a=(0,s.Z)(e);try{for(a.s();!(i=a.n()).done;){i.value.processRender(t)}}catch(d){a.e(d)}finally{a.f()}if(this.children.some((function(e){return e.hasHighlight}))){t.drawPhase=Y.jx.HIGHLIGHT;var n,o=(0,s.Z)(e);try{for(o.s();!(n=o.n()).done;){n.value.processRender(t)}}catch(d){o.e(d)}finally{o.f()}}if(this.children.some((function(e){return e.hasLabels}))){t.drawPhase=Y.jx.LABEL;var u,l=(0,s.Z)(e);try{for(l.s();!(u=l.n()).done;){u.value.processRender(t)}}catch(d){l.e(d)}finally{l.f()}}if((0,f.Z)("esri-tiles-debug")){t.drawPhase=Y.jx.DEBUG;var h,c=(0,s.Z)(e);try{for(c.s();!(h=c.n()).done;){h.value.processRender(t)}}catch(d){c.e(d)}finally{c.f()}}this.painter.afterRenderPhases(t),t.profiler.recordEnd("drawLayers"),r.logInfo()}},{key:"doRender",value:function(e){var t=this.context,r=e.state,i=e.pixelRatio;this._canvas.resize(e),t.setViewport(0,0,i*r.size[0],i*r.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),this.renderChildren(e)}},{key:"takeScreenshot",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r,n,s){var o,u,l,h,c,d,f,p,v,_,m,g,y,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Math.round(this.state.size[0]*t.resolutionScale),u=Math.round(this.state.size[1]*t.resolutionScale),l=t.resolutionScale,h=this.context,c=this._state.clone(),null!=s&&(d=c.viewpoint,c.viewpoint.rotation=s,c.viewpoint=d),f=(0,a.Z)((0,a.Z)({},this._renderParameters),{},{drawPhase:null,globalOpacity:1,stationary:!0,state:c,pixelRatio:l,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1,backgroundColor:n}),(p=new be.X(o,u)).wrapMode=te.e8.CLAMP_TO_EDGE,p.internalFormat=te.lP.RGBA8,p.isImmutable=!0,v=new mt.X(h,p,new gt.Y(te.Tg.DEPTH_STENCIL,o,u)),_=h.getBoundFramebufferObject(),m=h.getViewport(),h.bindFramebuffer(v),h.setViewport(0,0,o,u),this._renderChildren(null!==r&&void 0!==r?r:this.children,f),g=this._readbackScreenshot(v,(0,a.Z)((0,a.Z)({},t.cropArea),{},{y:u-(t.cropArea.y+t.cropArea.height)})),h.bindFramebuffer(_),h.setViewport(m.x,m.y,m.width,m.height),this.requestRender(),e.next=10,g;case 10:return y=e.sent,e.abrupt("return",(1===t.outputScale?b=y:(b=new ImageData(Math.round(y.width*t.outputScale),Math.round(y.height*t.outputScale)),(0,$t.TT)(y,b,!0)),v.dispose(),b));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i,a){return e.apply(this,arguments)}}()},{key:"_readbackScreenshot",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,Qt.r7)(r.width,r.height,document.createElement("canvas")),e.next=3,t.readPixelsAsync(r.x,r.y,r.width,r.height,te.VI.RGBA,te.Br.UNSIGNED_BYTE,new Uint8Array(a.data.buffer));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_emptyTrash",value:function(){for(;this._trash.size>0;){var e=Array.from(this._trash);this._trash.clear();for(var t=0,r=e;t<r.length;t++){r[t].processDetach()}}}}]),r}(D.W),tr=r(70812),rr=r(85992),ir=r(75391),ar=r(582),nr=r(14921),sr=r(100),or=r(94172),ur=r(35995),lr=r(46634),hr=r(87422),cr=r(69610),dr=r(4583),fr=function(e){(0,h.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.call(this))._handles=new sr.Z,e._resourcePixelRatio=1,e.updatingHandles=new lr.R,e.visible=!1,e}return(0,u.Z)(r,[{key:"destroy",value:function(){this._handles=(0,p.SC)(this._handles),this._disposeRenderResources(),this._resourcesTask=(0,p.IM)(this._resourcesTask)}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this.requestRender()}},{key:"magnifier",get:function(){return this._magnifier},set:function(e){var t=this;this._magnifier=e,this._handles.removeAll(),this._handles.add([(0,or.watch)((function(){return e.version}),(function(){t.visible=e.visible&&null!=e.position&&e.size>0,t.requestRender()}),or.initial),(0,or.watch)((function(){return[e.maskUrl,e.overlayUrl]}),(function(){return t._reloadResources()})),(0,or.watch)((function(){return e.size}),(function(){t._disposeRenderResources(),t.requestRender()}))])}},{key:"_createTransforms",value:function(){return{displayViewScreenMat3:(0,m.Ue)()}}},{key:"doRender",value:function(e){var t=e.context;if(this._resourcesTask){if(e.drawPhase===Y.jx.MAP&&this._canRender()){this._updateResources(e);var r=this._magnifier;if(null!=r.position){var i=e.pixelRatio,a=r.size*i,n=1/r.factor,s=Math.ceil(n*a);this._readbackTexture.resize(s,s);var o=e.state.size,u=i*o[0],l=i*o[1],h=.5*s,c=.5*s,d=(0,H.uZ)(i*r.position.x,h,u-h-1),f=(0,H.uZ)(l-i*r.position.y,c,l-c-1);t.setBlendingEnabled(!0);var p=d-h,v=f-c,_=this._readbackTexture;t.bindTexture(_,0),t.gl.copyTexImage2D(_.descriptor.target,0,_.descriptor.pixelFormat,p,v,s,s,0);var m=this.backgroundColor,g=m?[m.a*m.r/255,m.a*m.g/255,m.a*m.b/255,m.a]:[1,1,1,1],y=(d+r.offset.x*i)/u*2-1,b=(f-r.offset.y*i)/l*2-1,w=a/u*2,x=a/l*2,k=this._program;t.bindVAO(this._vertexArrayObject),t.bindTexture(this._overlayTexture,6),t.bindTexture(this._maskTexture,7),t.useProgram(k),k.setUniform4fv("u_background",g),k.setUniform1i("u_readbackTexture",0),k.setUniform1i("u_overlayTexture",6),k.setUniform1i("u_maskTexture",7),k.setUniform4f("u_drawPos",y,b,w,x),k.setUniform1i("u_maskEnabled",r.maskEnabled?1:0),k.setUniform1i("u_overlayEnabled",r.overlayEnabled?1:0),t.setStencilTestEnabled(!1),t.setColorMask(!0,!0,!0,!0),t.drawArrays(te.MX.TRIANGLE_STRIP,0,4),t.bindVAO()}}}else this._reloadResources()}},{key:"_canRender",value:function(){return this._mask&&this._overlay&&null!=this._magnifier}},{key:"_reloadResources",value:function(){var e=this;this._resourcesTask&&this._resourcesTask.abort();var t=null!=this._magnifier?this._magnifier.maskUrl:null,r=null!=this._magnifier?this._magnifier.overlayUrl:null;this._resourcesTask=(0,nr.vr)(function(){var a=(0,n.Z)((0,i.Z)().mark((function a(n){var s,o,u,l,h,c,d;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=null==t||null==r?(0,dr.e)(n):null,o=null!=t?(0,le.Z)(t,{responseType:"image",signal:n}).then((function(e){return e.data})):s.then((function(e){return e.mask})),u=null!=r?(0,le.Z)(r,{responseType:"image",signal:n}).then((function(e){return e.data})):s.then((function(e){return e.overlay})),i.next=5,Promise.all([o,u]);case 5:l=i.sent,h=(0,g.Z)(l,2),c=h[0],d=h[1],e._mask=c,e._overlay=d,e._disposeRenderResources(),e.requestRender();case 10:case"end":return i.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()),this.updatingHandles.addPromise(this._resourcesTask.promise)}},{key:"_disposeRenderResources",value:function(){this._readbackTexture=(0,p.M2)(this._readbackTexture),this._overlayTexture=(0,p.M2)(this._overlayTexture),this._maskTexture=(0,p.M2)(this._maskTexture),this._vertexArrayObject=(0,p.M2)(this._vertexArrayObject),this._program=(0,p.M2)(this._program)}},{key:"_updateResources",value:function(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),!this._readbackTexture){var t=e.context;this._resourcePixelRatio=e.pixelRatio;var r=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=(0,cr.F)(t);var i=new Uint16Array([0,1,0,0,1,1,1,0]),a=cr.c.attributes;this._vertexArrayObject=new ie.U(t,a,K.cD,{geometry:ee.f.createVertex(t,te.l1.STATIC_DRAW,i)}),this._overlay.width=r,this._overlay.height=r;var n=new be.X;n.internalFormat=te.VI.RGBA,n.wrapMode=te.e8.CLAMP_TO_EDGE,n.samplingMode=te.cw.NEAREST,n.flipped=!0,n.preMultiplyAlpha=!(0,ur.zd)(this._overlay.src)||!e.context.driverTest.svgPremultipliesAlpha.result,this._overlayTexture=new ye.x(t,n,this._overlay),this._mask.width=r,this._mask.height=r,n.pixelFormat=n.internalFormat=te.VI.ALPHA,this._maskTexture=new ye.x(t,n,this._mask);var s=1/this._magnifier.factor;n.pixelFormat=n.internalFormat=te.VI.RGBA,n.width=n.height=Math.ceil(s*r),n.samplingMode=te.cw.LINEAR,n.flipped=!1,this._readbackTexture=new ye.x(t,n)}}}]),r}(hr.s)},4583:function(e,t,r){r.d(t,{e:function(){return o}});var i=r(74165),a=r(15861),n=r(66978),s=r(38330);function o(e){return u.apply(this,arguments)}function u(){return u=(0,a.Z)((0,i.Z)().mark((function e(t){var a,o,u,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.e(83581).then(r.bind(r,83581)),o=r.e(78938).then(r.bind(r,78938)),e.t0=s.t,e.next=5,a;case 5:return e.t1=e.sent.default,e.t2={signal:t},u=(0,e.t0)(e.t1,e.t2),e.t3=s.t,e.next=11,o;case 11:return e.t4=e.sent.default,e.t5={signal:t},l=(0,e.t3)(e.t4,e.t5),e.next=16,u;case 16:return e.t6=e.sent,e.next=19,l;case 19:return e.t7=e.sent,h={mask:e.t6,overlay:e.t7},e.abrupt("return",((0,n.k_)(t),h));case 22:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}},43411:function(e,t,r){function i(e,t,r){for(var i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}function a(e,t){for(var r=e.length,i=0;i<r;++i)s[0]=e[i],t[i]=s[0];return t}function n(e,t){for(var r=e.length,i=0;i<r;++i)s[0]=e[i],s[1]=e[i]-s[0],t[i]=s[1];return t}r.d(t,{GB:function(){return n},LF:function(){return i},U8:function(){return a}});var s=new Float32Array(2)}}]);
//# sourceMappingURL=62085.f22e7830.chunk.js.map