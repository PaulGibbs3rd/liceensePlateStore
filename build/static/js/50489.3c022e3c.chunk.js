"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[50489],{61029:function(e,t,i){i.d(t,{e:function(){return l},s:function(){return o}});var n=i(1413),r=i(63780),a=(i(93169),i(10064)),s=i(23707);function l(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function o(e,t){if(null==e)return null;if(!l(e))return new a.Z("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return function(e,t){var i=(0,n.Z)((0,n.Z)((0,n.Z)({},s.K),t),{},{cimFallbackEnabled:!0});return u(e,(0,s.q)(e.symbol,i).error)}(e,t);case"unique-value":return function(e,t){var i,a=(0,n.Z)((0,n.Z)((0,n.Z)({},s.K),t),{},{cimFallbackEnabled:!0}),l=null===(i=e.uniqueValueInfos)||void 0===i?void 0:i.map((function(e){return(0,s.q)(e.symbol,a).error})).filter(r.pC),o=(0,s.q)(e.defaultSymbol,a);return o.error&&null!==l&&void 0!==l&&l.unshift(o.error),u(e,l)}(e,t);case"class-breaks":return function(e,t){var i=(0,n.Z)((0,n.Z)((0,n.Z)({},s.K),t),{},{cimFallbackEnabled:!0}),a=e.classBreakInfos.map((function(e){return(0,s.q)(e.symbol,i).error})).filter(r.pC),l=(0,s.q)(e.defaultSymbol,i);return l.error&&a.unshift(l.error),u(e,a)}(e,t);case"dictionary":case"heatmap":return null}return null}function u(e,t){if(!t)return null;var i;if((i=Array.isArray(t)?t:[t]).length>0){var n=i.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));n.sort();var r=[];return n.forEach((function(e,t){0!==t&&e===n[t-1]||r.push(e)})),new a.Z("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(r.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:i})}return null}},14173:function(e,t,i){i.d(t,{J:function(){return a}});var n=i(43144),r=i(15671),a=(0,n.Z)((function e(t,i,n){(0,r.Z)(this,e),this.maximumTotalNumberOfVertices=t,this.maximumNumberOfFeatures=i,this.averageSymbolComplexity=n}))},52404:function(e,t,i){i.d(t,{D:function(){return o}});var n=i(15671),r=i(43144),a=(i(93169),i(27546)),s=i(65156),l=i(93463),o=function(){function e(){(0,n.Z)(this,e),this._extents=new a.Z({allocator:function(e){return e||(0,s.Ue)()}}),this._tmpExtent=(0,s.Ue)(),this._dirty=!1}return(0,r.Z)(e,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"clear",value:function(){this._extents.clear()}},{key:"add",value:function(e){this._contains(e)||(this._removeContained(e),(0,s.JG)(this._extents.pushNew(),e),this._dirty=!0)}},{key:"pop",value:function(){return this._dirty&&this._mergeTight(),this._extents.pop()}},{key:"merge",value:function(e){return this._mergeTight(e),e.hasProgressed}},{key:"_mergeTight",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.G5,i=this._extents,n=new Set,r=0;r!==i.length;){i.sort((function(e,t){return e[0]-t[0]})),r=i.length,n.clear();for(var a=function(r){if(t.done)return{v:void 0};var a=i.at(r);if(a){for(var l=r+1;l<i.length;++l){var o=i.at(l);if(null==o||o[0]>=a[2])break;n.add(o)}n.forEach((function(r){if(a!==r)if(r[2]<=a[0])n.delete(r);else{var l=(0,s.SO)(a),o=(0,s.SO)(r),u=e._tmpExtent;(0,s.jn)(a,r,u);var h=l+o;((0,s.SO)(u)-h)/h<.05&&((0,s.JG)(a,u),n.delete(r),i.remove(r),t.madeProgress())}})),n.add(a)}},o=0;o<i.length;++o){var u=a(o);if("object"===typeof u)return u.v}}this._dirty=!1}},{key:"_contains",value:function(e){return this._extents.some((function(t){return(0,s.r3)(t,e)}))}},{key:"_removeContained",value:function(e){this._extents.filterInPlace((function(t){return!(0,s.r3)(e,t)}))}},{key:"test",get:function(){}}]),e}()},8186:function(e,t,i){i.d(t,{w:function(){return it}});var n=i(29439),r=i(74165),a=i(15861),s=i(37762),l=i(15671),o=i(43144),u=i(97326),h=i(60136),c=i(29388),d=i(27366),p=(i(59486),i(94931),i(15126),i(98689),i(57823),i(32066),i(49018),i(34999),i(28189)),y=(i(9014),i(32718)),v=(i(51508),i(7138)),g=i(63780),f=i(93169),_=i(10064),b=i(42537),m=i(77427),C=i(92026),S=i(18759),w=i(27546),G=i(66978),x=i(94172),k=i(99346),E=i(49861),I=i(69912),R=i(48732),D=i(32035),P=i(12400),O=i(79803),A=i(50628),L=i(5986),U=i(20586),Z=i(41414),V=i(65156),j=i(92975),F=i(30651),T=i(65618),M=i(37818),z=i(41388),H=i(61029),B=i(819),N=i(23037),W=i(30155),q=i(23707),Y=i(55244),Q=i(14173),J=i(91293),X=i(70446),K=i(8821),$=i(91505),ee=(i(84936),i(3182)),te=i(80457),ie=i(77835),ne=(0,Z.Ue)(),re=function(e){(0,h.Z)(i,e);var t=(0,c.Z)(i);function i(e){var n;return(0,l.Z)(this,i),(n=t.call(this,e)).events=new $.Z,n.hasZ=null,n.hasM=null,n.objectIdField=null,n.featureAdapter={getAttribute:function(e,t){return"graphic"in e?e.graphic.attributes[t]:ie.n.getAttribute(e,t)},getAttributes:function(e){return"graphic"in e?e.graphic.attributes:ie.n.getAttributes(e)},getObjectId:function(e){var t;return"graphic"in e?null!==(t=(0,T.MS)(e.graphic,n.objectIdField))&&void 0!==t?t:void 0:ie.n.getObjectId(e)},getGeometry:function(e){return"graphic"in e?e.getAsOptimizedGeometry(n.hasZ,n.hasM):ie.n.getGeometry(e)},getCentroid:function(e,t){if("graphic"in e){var i=null;null!=e.centroid?i=e.centroid:"point"===e.graphic.geometry.type&&(0,O.projectPoint)(e.graphic.geometry,ae,n.viewSpatialReference)&&(i=ae);var r=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return null==i?(r[0]=0,r[1]=0,r[2]=0,r[3]=0):(r[0]=i.x,r[1]=i.y,t.hasZ&&(r[2]=i.hasZ?i.z:0),t.hasM&&(r[t.hasZ?3:2]=i.hasM?i.m:0)),new te.Z([],r)}return ie.n.getCentroid(e,t)},cloneWithGeometry:function(e,t){return"graphic"in e?new ee.u_(t,n.featureAdapter.getAttributes(e),null,n.featureAdapter.getObjectId(e)):ie.n.cloneWithGeometry(e,t)}},n}return(0,o.Z)(i,[{key:"forEachInBounds",value:function(e,t){this.getSpatialIndex().forEachInBounds(e,t)}},{key:"forEachBounds",value:function(e,t){var i,n=this.getSpatialIndex(),r=(0,s.Z)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value,l=this.featureAdapter.getObjectId(a);null!=n.getBounds(l,ne)&&t(ne)}}catch(o){r.e(o)}finally{r.f()}}}]),i}(v.default);(0,d._)([(0,E.Cb)({constructOnly:!0})],re.prototype,"getSpatialIndex",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],re.prototype,"forEach",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],re.prototype,"hasZ",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],re.prototype,"hasM",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],re.prototype,"objectIdField",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],re.prototype,"viewSpatialReference",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],re.prototype,"featureSpatialReference",void 0),re=(0,d._)([(0,I.j)("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],re);var ae={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null},se=i(91107),le=i(49253),oe=i(88301),ue=i(61120),he=i(14921),ce=i(67166),de=i(95437),pe=i(24168),ye=function(e){(0,h.Z)(i,e);var t=(0,c.Z)(i);function i(e,n,r){var a;return(0,l.Z)(this,i),(a=t.call(this,e,n,r))._calloutSymbolLayer=null,a.symbol.hasVisibleCallout()&&(a._calloutSymbolLayer=(0,ce.S)(a.symbol,n)),a}return(0,o.Z)(i,[{key:"doLoad",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._calloutSymbolLayer?(0,he.q6)(this._calloutSymbolLayer.load()):null,e.prev=1,e.next=4,(0,oe.Z)((0,ue.Z)(i.prototype),"doLoad",this).call(this,t);case 4:(0,G.k_)(t),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),null!==(a=this._calloutSymbolLayer)&&void 0!==a&&a.abortLoad(),e.t0;case 10:if(e.t1=n,!e.t1){e.next=14;break}return e.next=14,n;case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,oe.Z)((0,ue.Z)(i.prototype),"destroy",this).call(this),this._calloutSymbolLayer=(0,C.SC)(this._calloutSymbolLayer)}},{key:"createGraphics3DGraphic",value:function(e,t){var n=(0,oe.Z)((0,ue.Z)(i.prototype),"createGraphics3DGraphic",this).call(this,e,t);if(null!=this._calloutSymbolLayer&&null!=n){var r=this._createCalloutGraphic(e);r&&n.setCalloutGraphic(r)}return n}},{key:"globalPropertyChanged",value:function(e,t){return!!(0,oe.Z)((0,ue.Z)(i.prototype),"globalPropertyChanged",this).call(this,e,t)&&(!this._calloutSymbolLayer||this._calloutSymbolLayer.globalPropertyChanged(e,t,(function(e){return e.calloutLayer})))}},{key:"updateGeometry",value:function(e,t){var n=(0,oe.Z)((0,ue.Z)(i.prototype),"updateGeometry",this).call(this,e,t);if(n&&this._calloutSymbolLayer){var r=e.calloutLayer;if(r)return this._calloutSymbolLayer.updateGeometry(r,t)}return n}},{key:"_createCalloutGraphic",value:function(e){var t=e.renderingInfo;return e.renderingInfo=new de.Ly(t.renderer,t.symbol),this._calloutSymbolLayer.createGraphics3DGraphic(e)}}]),i}(pe.q);function ve(e,t,i){return"point-3d"===e.type?new ye(e,t,i):new pe.q(e,t,i)}var ge=i(19477),fe=i(46281),_e=function(){function e(t){var i,n=this;(0,l.Z)(this,e),this._graphicsCore=t,this._idToState=new Map,this._states=new Set;var r=null===(i=t.owner.layer)||void 0===i?void 0:i.objectIdField;r?(this._getGraphicId=function(e){return(0,T.MS)(e,r)},this._getGraphics3DGraphicById=function(e){return n._graphicsCore.getGraphics3DGraphicByObjectId(e)}):(this._getGraphicId=function(e){return e.uid},this._getGraphics3DGraphicById=function(e){return n._graphicsCore.getGraphics3DGraphicById(e)})}return(0,o.Z)(e,[{key:"destroy",value:function(){var e=this;this._idToState.clear(),this._states.forEach((function(t,i){return e.remove(i)}))}},{key:"add",value:function(e){var t=this,i=(0,b.kB)((function(){return t.remove(e)}));if(this._states.has(e))return i;var n=this._getGraphicId(e.graphic),r=this._getGraphics3DGraphicById(n);return this._states.has(e)||this._states.add(e),this._ensureStateList(n).push(e),e.displaying=null!=r&&r.isVisible(),e.isDraped=null!=r&&r.isDraped,e.tracking=!0,null!=r&&e.emit("changed"),i}},{key:"remove",value:function(e){if(this._states.has(e)){if(this._idToState.size){var t=this._getGraphicId(e.graphic),i=this._idToState.get(t);i&&((0,g.Od)(i,e),0===i.length&&this._idToState.delete(t))}this._states.delete(e),e.tracking=!1,e.displaying=!1}}},{key:"addGraphic",value:function(e){this._forEachState(e,(function(t){t.displaying=e.isVisible(),t.isDraped=e.isDraped,t.emit("changed")}))}},{key:"removeGraphic",value:function(e){this._forEachState(e,(function(e){e.displaying=!1,e.isDraped=!1}))}},{key:"updateGraphicGeometry",value:function(e){this._forEachState(e,(function(e){return e.emit("changed")}))}},{key:"updateGraphicVisibility",value:function(e){this._forEachState(e,(function(t){return t.displaying=e.isVisible()}))}},{key:"allGraphicsDeleted",value:function(){this._states.forEach((function(e){return e.displaying=!1}))}},{key:"_ensureStateList",value:function(e){var t=this._idToState.get(e);if(t)return t;var i=new Array;return this._idToState.set(e,i),i}},{key:"_forEachState",value:function(e,t){if(0!==this._states.size&&0!==this._idToState.size){var i=this._getGraphicId(e.graphic),n=this._idToState.get(i);null!=n&&n.forEach(t)}}}]),e}(),be=i(96387),me=i(41325),Ce=i(85042),Se=i(13491),we=function(e){(0,h.Z)(i,e);var t=(0,c.Z)(i);function i(e){var n;return(0,l.Z)(this,i),(n=t.call(this,e))._index=new Se.Q(9,(0,f.Z)("esri-csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),n._missing=new Set,n._boundsByFeature=new Map,n.spatialReference=null,n.hasZ=null,n.hasM=null,n.objectIdField=null,n.updating=!1,n}return(0,o.Z)(i,[{key:"setup",value:function(e){this._addMany(e)}},{key:"destroy",value:function(){this._missing.clear(),this._index=(0,C.SC)(this._index),this._boundsByFeature.clear(),this._boundsByFeature=null}},{key:"update",value:function(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}},{key:"updatingRemaining",get:function(){return this._missing.size}},{key:"queryGraphicUIDsInExtent",value:function(e,t,i){null!=t&&t.equals(this.spatialReference)&&(Ge.minX=e[0],Ge.minY=e[1],Ge.maxX=e[2],Ge.maxY=e[3],this.update(),this._index.search(Ge,(function(e){return i(e.graphic.uid)})))}},{key:"add",value:function(e){this._missing.add(e),this.updating=!0}},{key:"remove",value:function(e){if(this._missing.delete(e))this.updating=this._missing.size>0;else if(e.extent){this._index.remove(e);var t=(0,T.MS)(e.graphic,this._get("objectIdField"));null!=t&&this._boundsByFeature.delete(t)}}},{key:"_addMany",value:function(e){if(0!==e.length){var t,i=this._get("objectIdField"),n=(0,s.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.computeExtent(this.spatialReference);var a=(0,T.MS)(r.graphic,i);null!=a&&this._boundsByFeature.set(a,r.extent)}}catch(l){n.e(l)}finally{n.f()}this._index.load(e)}}},{key:"clear",value:function(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}},{key:"forEachInBounds",value:function(e,t){Ge.minX=e[0],Ge.minY=e[1],Ge.maxX=e[2],Ge.maxY=e[3],this.update(),this._index.search(Ge,(function(e){t(e)}))}},{key:"getBounds",value:function(e,t){this.update();var i=this._boundsByFeature.get(e);return i?(0,Z.JR)(t,i):null}}]),i}(v.default);(0,d._)([(0,E.Cb)({constructOnly:!0})],we.prototype,"spatialReference",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],we.prototype,"hasZ",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],we.prototype,"hasM",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],we.prototype,"objectIdField",void 0),(0,d._)([(0,E.Cb)()],we.prototype,"updating",void 0),(0,d._)([(0,E.Cb)({readOnly:!0})],we.prototype,"updatingRemaining",null),we=(0,d._)([(0,I.j)("esri.views.3d.layers.graphics.SpatialIndex2D")],we);var Ge={minX:0,minY:0,maxX:0,maxY:0};function xe(e){return 2216+4096*e.symbolLayers.length+e.complexity.memory.resourceBytes}var ke=i(68860),Ee=i(88152),Ie=i(4035),Re=i(88153),De=i(54463),Pe=i(4760),Oe=Symbol("layerHandles"),Ae=function(e){(0,h.Z)(i,e);var t=(0,c.Z)(i);function i(e){var n;return(0,l.Z)(this,i),(n=t.call(this,e))._elevationOffset=0,n}return(0,o.Z)(i,[{key:"spatialReference",get:function(){var e;return null===(e=this.view)||void 0===e?void 0:e.spatialReference}},{key:"initialize",value:function(){var e=this;this._renderCoordsHelper=this.view.renderCoordsHelper,this._intersectLayers=[this.stageLayer],this._intersector=(0,Re.Z8)(this.view.state.viewingMode),this._intersector.options.store=De.eC.MIN;var t=this._computeLayerExtent(this.spatialReference,this.stageLayer);this._zmin=t[2],this._zmax=t[5];var i=this.stageLayer.events;this.addHandles([i.on(["layerObjectAdded","layerObjectRemoved","geometryAdded","geometryRemoved"],(function(t){var i=t.object;return e._objectChanged(i)})),i.on("attributesChanged",(function(t){var i=t.attribute,n=t.object;return(0,Pe.j)(i)&&e._objectChanged(n)})),i.on(["transformationChanged","shaderTransformationChanged"],(function(t){return e._objectChanged(t)}))],Oe)}},{key:"dispose",value:function(){this.removeHandles(Oe)}},{key:"elevationInfoChanged",value:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"on-the-ground"!==e.mode){var t,i,n=(0,ke._R)(this.layer.spatialReference),r=(0,Ee.Z7)(null!==(t=e.unit)&&void 0!==t?t:"meters");this._elevationOffset=(null!==(i=e.offset)&&void 0!==i?i:0)*r/n}else this._elevationOffset=0}},{key:"getElevation",value:function(e,t,i,n){if(je[0]=e,je[1]=t,je[2]=i,!this._renderCoordsHelper.toRenderCoords(je,n,je))return y.Z.getLogger(this).error("could not project point for elevation alignment"),null;var r=this._elevationOffset,a=this._zmin+r,s=this._zmax+r;this._renderCoordsHelper.setAltitude(Fe,s,je),this._renderCoordsHelper.setAltitude(Te,a,je);return this._intersector.reset(Fe,Te,null),this._intersector.intersect(this._intersectLayers,null,1,null,(function(e){return!!e.lastValidElevationBB})),this._intersector.results.min.getIntersectionPoint(je)?this._renderCoordsHelper.getAltitude(je):null}},{key:"_objectChanged",value:function(e){var t=this.spatialReference;if(e.lastValidElevationBB&&t){(0,Z.cS)(Ze);var i=e.lastValidElevationBB;i.isEmpty()||this._expandExtent(t,i.min,i.max,Ze);var n=e.boundingVolumeWorldSpace,r=n.min,a=n.max;this._expandExtent(t,r,a,Ze),(0,Z.y8)(Ze,Ve.extent),this._zmin=Math.min(this._zmin,Ze[2]),this._zmax=Math.max(this._zmax,Ze[5]),Ve.spatialReference=t,this.emit("elevation-change",Ve),(0,D.c)(i.min,r),(0,D.c)(i.max,a)}}},{key:"_computeLayerExtent",value:function(e,t){var i=this;return(0,Z.cS)(Ze),null!=e&&t.objects.forAll((function(t){return i._expandExtent(e,t.boundingVolumeWorldSpace.min,t.boundingVolumeWorldSpace.max,Ze)})),Ze}},{key:"_expandExtent",value:function(e,t,i,n){for(var r=0;r<8;++r)je[0]=1&r?t[0]:i[0],je[1]=2&r?t[1]:i[1],je[2]=4&r?t[2]:i[2],this._renderCoordsHelper.fromRenderCoords(je,je,e),(0,Z.pp)(n,je);return n}}]),i}($.Z.EventedMixin(v.default));(0,d._)([(0,E.Cb)({constructOnly:!0})],Ae.prototype,"layer",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],Ae.prototype,"stageLayer",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],Ae.prototype,"view",void 0),(0,d._)([(0,E.Cb)()],Ae.prototype,"spatialReference",null),Ae=(0,d._)([(0,I.j)("esri.views.3d.layers.support.StageLayerElevationProvider")],Ae);var Le,Ue,Ze=(0,Z.cS)(),Ve=new Ie.c,je=(0,P.Ue)(),Fe=(0,P.Ue)(),Te=(0,P.Ue)(),Me=i(65206),ze=i(76419),He=i(19962),Be=i(78485),Ne=i(97882),We=i(24405),qe=i(93463),Ye=i(73553),Qe=i(53866),Je=i(848),Xe=i(24931),Ke=i(58009),$e=i(80045),et=(0,P.Ue)(),tt=(0,Z.Ue)(),it=Le=function(e){(0,h.Z)(i,e);var t=(0,c.Z)(i);function i(e){var n;return(0,l.Z)(this,i),(n=t.call(this,e))._propertiesPool=new ze.L({computedExtent:Qe.Z},(0,u.Z)(n)),n.computedExtent=null,n.currentRenderer=null,n.rendererHasGeometryOperations=!1,n._graphicStateTracking=null,n.graphics3DGraphics=new Map,n.stageLayer=null,n.stage=null,n._graphicsDrapedUids=new Set,n._graphicsBySymbol=new Map,n._symbolConversionCache=new Map,n._symbols=new Map,n._graphicsWithoutSymbol=new Map,n._graphicsWaitingForSymbol=new Map,n._graphicsUpdateId=0,n._frameTaskHandle=qe.sq,n._dataUpdateQueue=new z.b,n._updateQueue=new z.b,n._suspendSymbolCleanup=!1,n._arcadeOnDemand=null,n._rendererChangeAbortController=null,n._elevationInfoChangeAbortController=null,n._initializeAbortController=null,n._elevationAlignment=null,n._scaleVisibility=null,n._filterVisibility=null,n._spatialIndex=null,n.extentPadding=0,n._updatingPendingLoadedGraphicsChange=null,n._featureStore=null,n._deconflictor=null,n._labeler=null,n._objectStates=null,n._viewElevationProvider=null,n._stageLayerElevationProvider=null,n._sharedSymbolResourcesOwnerHandle=null,n._whenGraphics3DGraphicRequests={},n._pendingUpdates=new Map,n._numberOfGraphics=0,n._numberOfGraphicsProvidingElevation=0,n._pendingAdds=0,n._pendingRemoves=0,n._applyPendingRemovesFirst=!1,n._loadingSymbols=0,n._pendingUpdatesPool=new w.Z({allocator:function(e){return e||new nt},deallocator:function(e){return e.clear(),e}}),n._symbolWarningLogged=!1,n._geometryWarningLogged=!1,n._objectIdInvisibleSet=new Set,n._whenSymbolRemoved=new w.Z,n.preferredUpdatePolicy=Be.j.SYNC,n._forcedUpdatePolicy=null,n.elevationFeatureExpressionEnabled=!0,n.owner=null,n.layer=null,n.graphicSymbolSupported=!0,n.getRenderingInfoWithoutRenderer=!1,n.setUidToIdOnAdd=!0,n.hasZ=null,n.hasM=null,n._usedMemory=0,n._visible=!1,n._startCreateGraphics=!1,n._unusedSymbolsCache=e.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols",(function(e){return e.destroy()})),n.symbolCreationContext=new le.U(e.owner.view.resourceController.scheduler,(function(e,t){return n._updateQueue.push(e,t)})),n}return(0,o.Z)(i,[{key:"_viewSpatialReference",get:function(){return this.owner.view.spatialReference}},{key:"spatialIndex",get:function(){var e;return this._spatialIndex||(this._spatialIndex=new we({objectIdField:null===(e=this.owner.layer)||void 0===e?void 0:e.objectIdField,spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))),this._spatialIndex.update(),this._spatialIndex}},{key:"deconflictor",get:function(){return this._deconflictor}},{key:"labeler",get:function(){return this._labeler}},{key:"numberOfGraphics",get:function(){return this._numberOfGraphics}},{key:"effectiveUpdatePolicy",get:function(){var e;return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?Be.j.ASYNC:null!==(e=this._forcedUpdatePolicy)&&void 0!==e?e:this.preferredUpdatePolicy}},{key:"featureStore",get:function(){return this._featureStore}},{key:"initializePromise",get:function(){return this._initializePromise}},{key:"scaleVisibility",get:function(){return this._scaleVisibility}},{key:"elevationAlignment",get:function(){return this._elevationAlignment}},{key:"objectStates",get:function(){return this._objectStates}},{key:"filterVisibility",get:function(){return this._filterVisibility}},{key:"updating",get:function(){var e,t,i;return!!(this.dataUpdating||null!==(e=this._elevationAlignment)&&void 0!==e&&e.updating||null!==(t=this._scaleVisibility)&&void 0!==t&&t.updating||null!==(i=this._filterVisibility)&&void 0!==i&&i.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._frameTaskHandle.updating||this.running)}},{key:"dataUpdating",get:function(){var e;return!!(this._graphicsWaitingForSymbol.size>0||this._pendingUpdates.size>0||null!==(e=this._spatialIndex)&&void 0!==e&&e.updating||this._updatingPendingLoadedGraphicsChange||this._dataUpdateQueue.running||this._loadingSymbols>0)}},{key:"running",get:function(){var e;return this._pendingUpdates.size>0||!(null===(e=this._spatialIndex)||void 0===e||!e.updating)||this._dataUpdateQueue.running||this._updateQueue.running}},{key:"suspendedOrOutsideOfView",get:function(){var e;return this.owner.suspended||!(null===(e=this.owner.suspendInfo)||void 0===e||!e.outsideOfView)}},{key:"updatingRemaining",get:function(){var e,t;return this.updating?this._pendingUpdates.size+.1*((null===(e=this._spatialIndex)||void 0===e?void 0:e.updatingRemaining)||0)+.1*((null===(t=this._elevationAlignment)||void 0===t?void 0:t.updatingRemaining)||0):0}},{key:"displayFeatureLimit",get:function(){var e,t,i,n,r,a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,s=null!==(e=null===a||void 0===a?void 0:a.graphics3D.minTotalNumberOfFeatures)&&void 0!==e?e:0,l=null!==(t=null===a||void 0===a?void 0:a.graphics3D.maxTotalNumberOfFeatures)&&void 0!==t?t:0,o=null!==(i=null===a||void 0===a?void 0:a.graphics3D.maxNumberOfDrawCalls)&&void 0!==i?i:0,u=null!==(n=null===a||void 0===a?void 0:a.graphics3D.maxTotalNumberOfVertices)&&void 0!==n?n:0,h=this.averageSymbolComplexity,c=Math.max(1,null!==(r=null===h||void 0===h?void 0:h.verticesPerFeature)&&void 0!==r?r:1),d=h&&h.drawCallsPerFeature>0&&o>0?o/h.drawCallsPerFeature:l,p=Math.ceil(u/c),y=Math.max(s,Math.min(l,p,d)),v=this._get("displayFeatureLimit");return v&&v.maximumTotalNumberOfVertices===u&&v.averageSymbolComplexity===h&&v.maximumNumberOfFeatures===y?v:new Q.J(u,y,h)}},{key:"averageSymbolComplexity",get:function(){var e=(0,Y.bz)(this._symbolComplexities),t=this._get("averageSymbolComplexity");return 0===e.numComplexities||null!=t&&(e.estimated&&(t.verticesPerFeature>=e.verticesPerFeature||t.verticesPerCoordinate>=e.verticesPerCoordinate||t.drawCallsPerFeature>=e.drawCallsPerFeature)||t.verticesPerFeature===e.verticesPerFeature&&t.verticesPerCoordinate===e.verticesPerCoordinate&&t.drawCallsPerFeature===e.drawCallsPerFeature)?t:e}},{key:"usedMemory",get:function(){var e=null!=this.averageSymbolComplexity&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,t=this._getSymbolComplexitiesUsed().reduce((function(e,t){return e+t.memory.resourceBytes}),0);if(null==this._symbolMaterials){this._symbolMaterials=[];var i,n=(0,s.Z)(this._symbols.values());try{for(n.s();!(i=n.n()).done;){var r=i.value;if(null!=r){var a,l=(0,s.Z)(r.symbolLayers);try{for(l.s();!(a=l.n()).done;){var o=a.value;if(o){var u,h=(0,s.Z)(o.materials);try{for(h.s();!(u=h.n()).done;){var c=u.value;c&&this._symbolMaterials.push(c)}}catch(v){h.e(v)}finally{h.f()}}}}catch(v){l.e(v)}finally{l.f()}}}}catch(v){n.e(v)}finally{n.f()}}var d=this.owner.view._stage.renderer.plugins,p=this.owner.view.basemapTerrain.overlayManager.renderer,y=this._symbolMaterials.reduce((function(e,t){var i,n;return e+(null!==(i=null===(n=d.getMaterialRenderer(t)||p.getMaterialRenderer(t))||void 0===n?void 0:n.usedMemory)&&void 0!==i?i:0)}),0);return this._usedMemory+e+t+y}},{key:"usedMemoryPerGraphic",get:function(){if(this._usedMemory&&this._numberOfGraphics){var e=this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves));return this._usedMemory/this._numberOfGraphics*e}if(null!=this.averageSymbolComplexity){var t=this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0;return this.averageSymbolComplexity.memory.bytesPerFeature+t}return 0}},{key:"unprocessedMemoryEstimate",get:function(){return(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic}},{key:"_symbolComplexities",get:function(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}},{key:"visible",get:function(){return this._visible}},{key:"_getConvertedSymbol",value:function(e){var t,i;if("web-style"===e.type)return e.clone();var n=this._symbolConversionCache.get(e.id);if(null!=n)return n;var r=(0,q.q)(e,{geometryType:null!==(t=null===(i=this.layer)||void 0===i?void 0:i.geometryType)&&void 0!==t?t:void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(e),cimFallbackEnabled:!0}),a=r.symbol||null;return null==a&&r.error&&y.Z.getLogger(this).error(r.error.message),this._symbolConversionCache.set(e.id,a),a}},{key:"_getSymbolComplexitiesUsedOrRenderer",value:function(e){if(null==e)return[];var t=e.getSymbols(),i="backgroundFillSymbol"in e?e.backgroundFillSymbol:null;if(!i&&(null===t||void 0===t||!t.length))return[];var n=[],r=this._getSymbolComplexityUsedOrRenderer(i);null!=r&&n.push(r);var a,l=(0,s.Z)(t);try{for(l.s();!(a=l.n()).done;){var o=a.value,u=this._getSymbolComplexityUsedOrRenderer(o);null!=u&&n.push(u)}}catch(h){l.e(h)}finally{l.f()}return n}},{key:"_getSymbolComplexityUsedOrRenderer",value:function(e){if(null==e)return null;var t=this._symbols.get(e.id);if(null!=t)return t.complexity;var i=this._getConvertedSymbol(e);return null!=i?(0,Y.V9)(i):null}},{key:"_getSymbolComplexitiesUsed",value:function(){var e=[];return this._symbols.forEach((function(t){null!=t&&e.push(t.complexity)})),e}},{key:"_objectIdField",get:function(){return this.layer.objectIdField}},{key:"initialize",value:function(){var e,t,i,n,r,a,s,l=this;this._featureStore=new re({objectIdField:null===(e=this.owner.layer)||void 0===e?void 0:e.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:function(){return l.spatialIndex},forEach:function(e){return l.graphics3DGraphics.forEach(e)}});var o=function(e,t,i){return l.spatialIndex.queryGraphicUIDsInExtent(e,t,i)},u=this.componentFactories;this._elevationAlignment=null===(t=u.elevationAlignment)||void 0===t?void 0:t.call(u,this,o),this._scaleVisibility=null===(i=u.scaleVisibility)||void 0===i?void 0:i.call(u,this,o),this._filterVisibility=null===(n=u.filterVisibility)||void 0===n?void 0:n.call(u,{featureStore:this._featureStore,getFeatureCount:function(){return l.graphics3DGraphics.size},updateFeatureVisibilities:function(e){return l.modifyGraphics3DGraphicVisibilities((function(t){return t.setVisibilityFlag(X.E.GRAPHIC,X.P.FILTER,e((0,T.MS)(t.graphic,l._objectIdField)))}))},setAllFeaturesVisibility:function(e){return l.modifyGraphics3DGraphicVisibilities((function(t){return t.setVisibilityFlag(X.E.GRAPHIC,X.P.FILTER,e)}))},clearFeaturesVisibility:function(){return l.modifyGraphics3DGraphicVisibilities((function(e){return e.setVisibilityFlag(X.E.GRAPHIC,X.P.FILTER,!0)}))}}),this._deconflictor=null===(r=u.deconflictor)||void 0===r?void 0:r.call(u,this),this._labeler=null===(a=u.labeler)||void 0===a?void 0:a.call(u,this,this._scaleVisibility),this._objectStates=null===(s=u.objectStates)||void 0===s?void 0:s.call(u,this),this._initializeAbortController=new AbortController,this._initializePromise=this._initializeAsync()}},{key:"_initializeAsync",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,i,n,a,s,l,o,u,h,c=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(t=this._initializeAbortController)||void 0===t?void 0:t.signal,l=this.owner.view,this._viewElevationProvider=new J.Y(this._viewSpatialReference,l),this._initializeStage(l,this.layer.uid),o=l.sharedSymbolResources,this.symbolCreationContext.sharedResources=o,this._sharedSymbolResourcesOwnerHandle=o.addGraphicsOwner(this.owner),null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=o.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=l.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.graphicsCoreOwner=this.owner,this.symbolCreationContext.localOriginFactory=new He.C(l.renderSpatialReference),this.symbolCreationContext.elevationProvider=l.elevationProvider,this.symbolCreationContext.notifyGraphicGeometryChanged=function(e){return c.notifyGraphicGeometryChanged(e)},this.symbolCreationContext.notifyGraphicVisibilityChanged=function(e){return c.notifyGraphicVisibilityChanged(e)},u=(0,K.WI)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),e.next=7,(0,K.kr)(u,this._viewSpatialReference,s,y.Z.getLogger(this));case 7:if(this.symbolCreationContext.featureExpressionInfoContext=e.sent,(0,G.k_)(s),this.symbolCreationContext.screenSizePerspectiveEnabled=l.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!(null===(i=this.owner.view.qualitySettings)||void 0===i||!i.physicallyBasedRenderingEnabled),this.symbolCreationContext.skipHighSymbolLods=!(null===(n=this.owner.view.qualitySettings)||void 0===n||null===(a=n.graphics3D)||void 0===a||!a.skipHighSymbolLods),!("drapeSourceType"in this.owner)){e.next=16;break}h=this.owner,this.symbolCreationContext.drapeSourceRenderer=l.basemapTerrain.overlayManager.registerGeometryDrapeSource(h),this.addHandles((0,b.kB)((function(){return l.basemapTerrain.overlayManager.unregisterDrapeSource(h)})));case 16:this.addHandles([(0,x.watch)((function(){return c.suspendedOrOutsideOfView}),(function(){return c._updateQueue.unshift((function(){return c._updateLayerVisibility()}),null).catch(G.R8)})),(0,x.watch)((function(){var e,t;return[null===(e=c.layer)||void 0===e?void 0:e.screenSizePerspectiveEnabled,null===(t=c.owner.view)||void 0===t?void 0:t.screenSizePerspectiveEnabled]}),(function(){var e,t=l.screenSizePerspectiveEnabled&&!!c.layer.screenSizePerspectiveEnabled;t!==c.symbolCreationContext.screenSizePerspectiveEnabled&&(c.symbolCreationContext.screenSizePerspectiveEnabled=t,null!==(e=c._labeler)&&void 0!==e&&e.reset(),c.recreateAllGraphicsAndSymbols())})),(0,x.watch)((function(){return c.owner.slicePlaneEnabled}),(function(e){return c._slicePlaneEnabledChange(!!e)})),(0,x.watch)((function(){var e;return null===(e=c.owner.view.state)||void 0===e?void 0:e.rasterPixelRatio}),(function(){return c._pixelRatioChange()})),(0,x.watch)((function(){var e;return!(null===(e=c.owner.view.qualitySettings)||void 0===e||!e.physicallyBasedRenderingEnabled)}),(function(e){return c._physicalBasedRenderingChange(e)})),(0,x.watch)((function(){var e,t;return!(null===(e=c.owner.view.qualitySettings)||void 0===e||null===(t=e.graphics3D)||void 0===t||!t.skipHighSymbolLods)}),(function(e){return c._skipHighSymbolLoDsChange(e)})),(0,x.when)((function(){var e;return null===(e=l.basemapTerrain)||void 0===e?void 0:e.tilingScheme}),(function(e){if(e.spatialReference.equals(c.symbolCreationContext.overlaySR)||null==l.basemapTerrain.spatialReference||(c.symbolCreationContext.overlaySR=l.basemapTerrain.spatialReference),c.hasHandles("loaded-graphics"))c.recreateAllGraphics();else{c.addHandles([(0,x.on)((function(){var e;return null===(e=c.owner)||void 0===e?void 0:e.loadedGraphics}),"change",(function(e){c._graphicsCollectionChanged(e),c._signalUpdatingDuringAsyncLoadedGraphicsChange()}),{onListenerAdd:function(){c.recreateAllGraphics(),c._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")}}),{initial:!0}),(0,x.watch)((function(){return c.effectiveUpdatePolicy}),(function(e){null!=c.stageLayer&&(c.stageLayer.updatePolicy=e),c.symbolCreationContext.isAsync=c.effectiveUpdatePolicy===Be.j.ASYNC,e===Be.j.SYNC&&c.runTask(qe.G5)}),x.syncAndInitial)]),this._frameTaskHandle=l.resourceController.scheduler.registerTask(qe.T8.GRAPHICS_CORE,this),this.layer&&"featureReduction"in this.layer&&this.addHandles((0,x.watch)((function(){return c.layer.featureReduction}),(function(){var e;return null===(e=c._deconflictor)||void 0===e?void 0:e.featureReductionChange()}))),this.notifyChange("averageSymbolComplexity"),this.rendererChange(this.owner.renderer).catch((function(){})),this._initializeAbortController=null;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_abortInitialize",value:function(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=null)}},{key:"destroy",value:function(){for(var e in this._unusedSymbolsCache.destroy(),this._abortInitialize(),this._abortRendererChange(),this._abortElevationInfoChange(),this._frameTaskHandle.remove(),this._frameTaskHandle=qe.sq,this._dataUpdateQueue.cancelAll(),this._updateQueue.cancelAll(),this._deconflictor=(0,C.hw)(this._deconflictor),this._labeler=(0,C.hw)(this._labeler),this._elevationAlignment=(0,C.SC)(this._elevationAlignment),this._scaleVisibility=(0,C.SC)(this._scaleVisibility),this._filterVisibility=(0,C.SC)(this._filterVisibility),this._objectStates=(0,C.SC)(this._objectStates),this.clear(),this._featureStore=(0,C.SC)(this._featureStore),this._updatingPendingLoadedGraphicsChange=(0,C.hw)(this._updatingPendingLoadedGraphicsChange),this._graphicStateTracking=(0,C.SC)(this._graphicStateTracking),this.stage&&(this.stageLayer=(0,C.SC)(this.stageLayer),this.stage=null),this._set("owner",null),this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[e].reject(new _.Z("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null,this._sharedSymbolResourcesOwnerHandle=(0,C.hw)(this._sharedSymbolResourcesOwnerHandle),this._propertiesPool=(0,C.SC)(this._propertiesPool),this._pendingUpdatesPool=null,this._symbolConversionCache.clear(),this._objectIdInvisibleSet.clear(),this._spatialIndex=(0,C.SC)(this._spatialIndex)}},{key:"clear",value:function(){var e,t;null!==(e=this._objectStates)&&void 0!==e&&e.allGraphicsDeleted(),null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted(),this.graphics3DGraphics.forEach((function(e){return e.destroy()})),null!==(t=this._spatialIndex)&&void 0!==t&&t.clear(),this.graphics3DGraphics.clear(),this._numberOfGraphics=0,this._usedMemory=0,this._updateLayerVisibility(),this._symbols.forEach(C.SC),this._symbols.clear(),this._symbolMaterials=null,this._graphicsBySymbol.clear(),this._graphicsWithoutSymbol.clear(),this._graphicsWaitingForSymbol.clear(),this._pendingUpdates.clear(),this._pendingUpdatesPool.clear(),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1,this.notifyChange("dataUpdating"),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this._featureStore.events.emit("changed")}},{key:"_initializeStage",value:function(e,t){var i=this;this.stage=e._stage,this.stageLayer=new Ne.F(this.stage,{pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},t);var n=this.stageLayer.events;n.on("transformationChanged",(function(e){return i.notifyGraphicGeometryChanged(e.graphicUid)})),n.on("shaderTransformationChanged",(function(e){return i.notifyGraphicGeometryChanged(e.graphicUid)})),n.on("visibilityChanged",(function(e){return i.notifyGraphicVisibilityChanged(e.graphicUid)})),n.on("geometryAdded",(function(e){return i.notifyGraphicGeometryChanged(e.object.graphicUid)})),n.on("geometryRemoved",(function(e){return i.notifyGraphicGeometryChanged(e.object.graphicUid)})),n.on("attributesChanged",(function(e){return(0,Pe.j)(e.attribute)&&i.notifyGraphicGeometryChanged(e.object.graphicUid)}))}},{key:"notifyGraphicGeometryChanged",value:function(e){if(null!=this._graphicStateTracking&&null!=e){var t=this.graphics3DGraphics.get(e);t&&this._graphicStateTracking.updateGraphicGeometry(t)}}},{key:"notifyGraphicVisibilityChanged",value:function(e){if(null!=this._graphicStateTracking&&null!=e){var t=this.graphics3DGraphics.get(e);t&&this._graphicStateTracking.updateGraphicVisibility(t)}}},{key:"_updateLayerVisibility",value:function(){var e=this.displayFeatureLimit.maximumNumberOfFeatures,t=this._numberOfGraphics>e*rt,i=!this.suspendedOrOutsideOfView&&!t;i!==this._visible&&(this._visible=i,i?(this.stageLayer.pickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())}},{key:"_updateStageLayerVisibility",value:function(){this.stageLayer.visible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)}},{key:"getGraphics3DGraphicById",value:function(e){return null!=e?this.graphics3DGraphics.get(e):void 0}},{key:"getGraphics3DGraphicByObjectId",value:function(e){var t;return null!==(t=this.owner.layer)&&void 0!==t&&t.objectIdField?this._findGraphics3DGraphicByObjectId(e):null}},{key:"_getGraphicObjectID",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===(t=this.owner.layer)||void 0===t?void 0:t.objectIdField;return(0,T.MS)(e,i)}},{key:"graphics3DGraphicsByObjectID",get:function(){var e,t=this,i=null===(e=this.owner.layer)||void 0===e?void 0:e.objectIdField;if(i){var n=new Map;return this.graphics3DGraphics.forEach((function(e){if(e){var r=e.graphic,a=t._getGraphicObjectID(r,i);null!=a&&n.set(a,e)}})),n}}},{key:"labelsEnabled",get:function(){var e;return!(null===(e=this._labeler)||void 0===e||!e.layerLabelsEnabled())}},{key:"updateLabelingInfo",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i,n,a,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=null===(i=this._deconflictor)||void 0===i?void 0:i.labelingInfoChange(t),s=null===(n=this._labeler)||void 0===n?void 0:n.labelingInfoChange(t),e.next=3,Promise.allSettled([a,s]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateVisibilityInfo",value:function(){var e,t;null!==(e=this._deconflictor)&&void 0!==e&&e.labelingInfoChange(),null===(t=this._labeler)||void 0===t||t.visibilityInfoChange()}},{key:"symbolUpdateType",get:function(){var e=this;if(this._pendingUpdates.size>0)return"unknown";var t=0,i=0;return(0,m.oE)(this._symbols,(function(n,r){if(null!=n){var a=n.getFastUpdateStatus();if(a.loading>0)return!0;e._graphicsBySymbol.has(r)&&(i+=a.fast,t+=a.slow)}return!1}))?"unknown":i>=0&&0===t?"fast":t>=0&&0===i?"slow":"mixed"}},{key:"runTask",value:function(e){if(this._dataUpdateQueue.runTask(e),this._updateQueue.runTask(e),this._applyPendingUpdates(e),this.notifyChange("running"),this.running||this.notifyChange("dataUpdating"),this.notifyChange("updatingRemaining"),!e.hasProgressed)return Ye.J}},{key:"setObjectIdVisibility",value:function(e,t){t?this._objectIdInvisibleSet.delete(e):this._objectIdInvisibleSet.add(e);var i=this._findGraphics3DGraphicByObjectId(e);null!=i&&this._updateUserVisibility(i)}},{key:"_findGraphics3DGraphicByObjectId",value:function(e){var t=this;return(0,m.fQ)(this.graphics3DGraphics,(function(i){return t._getGraphicObjectID(i.graphic)===e}))}},{key:"_updateUserVisibility",value:function(e){if(null==e)return!1;var t=e.graphic,i=this._getGraphicObjectID(t),n=t.visible&&!this.owner.suspended&&(null==i||!this._objectIdInvisibleSet.has(i));return e.setVisibilityFlag(X.E.GRAPHIC,X.P.USER,n)}},{key:"_whenGraphics3DGraphic",value:function(e){var t=this.graphics3DGraphics.get(e.uid);if(t)return Promise.resolve(t);var i=this._whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;var n=(0,G.hh)();return this._whenGraphics3DGraphicRequests[e.uid]=n,n.promise}},{key:"_boundsForGraphics3DGraphic",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){var n,a,s,l,o,u,h,c,d,p,y;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._viewSpatialReference,a=this.owner.view.renderSpatialReference,s=this.owner.view.basemapTerrain.spatialReference,l=function(e,t,i){return(0,A.projectBuffer)(e,a,t,e,n,t,i)},o=function(e,t,i){return(0,A.projectBuffer)(e,s,t,e,n,t,i)},u=this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=i&&!!i.useViewElevation,minDemResolution:null!=i?i.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,e.next=8,t.getProjectedBoundingBox(l,o,u,null===i||void 0===i?void 0:i.signal);case 8:if(h=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:return c=h.boundingBox,h.requiresDrapedElevation&&(d=this.symbolCreationContext.elevationProvider)&&((0,Z.be)(c,et),y=null!==(p=d.getElevation(et[0],et[1],0,n,"ground"))&&void 0!==p?p:0,c[2]=Math.min(c[2],y),c[5]=Math.max(c[5],y)),e.abrupt("return",{boundingBox:c,screenSpaceObjects:h.screenSpaceObjects});case 14:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"whenGraphicBounds",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){var n,a,s,l,o=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,x.whenOnce)((function(){var e;return null===(e=o.owner)||void 0===e?void 0:e.loadedGraphics}));case 2:if(a=null===(n=this.owner.layer)||void 0===n?void 0:n.objectIdField,s=this.owner.loadedGraphics.find((function(e){return e===t||null!=a&&null!=e.attributes&&t.attributes&&e.attributes[a]===t.attributes[a]})),s){e.next=5;break}throw new _.Z("internal:graphic-not-part-of-view","Graphic is not part of this view");case 5:return e.next=7,this._whenGraphics3DGraphic(s);case 7:return l=e.sent,e.abrupt("return",this._boundsForGraphics3DGraphic(l,i));case 9:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"computeAttachmentOrigin",value:function(e,t){var i=this.graphics3DGraphics.get(e.uid);if(!i)return null;var r=i.computeAttachmentOrigin();if(0===r.render.num&&0===r.draped.num)return null;(0,D.s)(at,0,0,0);var a=0;if(r.render.num>0){if(!(0,L.S)(r.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,st,t))return null;(0,D.g)(at,at,st),a++}if(r.draped.num>0){var s,l=(0,n.Z)(r.draped.origin,2),o=l[0],u=l[1],h=null!==(s=this._viewElevationProvider.getElevation(o,u,"ground"))&&void 0!==s?s:0;if((0,D.s)(st,o,u,h),!(0,L.S)(st,this._viewElevationProvider.spatialReference,st,t))return null;(0,D.g)(at,at,st),a++}return a>1&&(0,D.j)(at,at,1/a),new Je.Z({x:at[0],y:at[1],z:at[2],spatialReference:t})}},{key:"getSymbolLayerSize",value:function(e,t){var i=this._symbols.get(e.id);if(null==i)throw new _.Z("internal:symbol-not-part-of-view","Symbol is not part of this view");var n=e.symbolLayers.indexOf(t);if(-1===n)throw new _.Z("internal:missing-symbol-layer","Symbol layer is not in symbol");var r=i.getSymbolLayerSize(n);if(null==r)throw new _.Z("internal:missing-size","Symbol layer has no valid size");return r}},{key:"_graphicsCollectionChanged",value:function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))}},{key:"graphicUpdateHandler",value:function(e){var t=e.graphic.uid,i=this.graphics3DGraphics.get(t);if(null!=i||null!=this._graphicsWithoutSymbol.get(t))switch(e.property){case"visible":this._graphicUpdateVisibleHandler(i);break;case"geometry":this._graphicUpdateGeometryHandler(i,e);break;case"symbol":this._graphicUpdateSymbolHandler(i,e);break;case"attributes":break;case"origin-transform":this._graphicUpdateTransformHandler(i,e)}}},{key:"_graphicUpdateGeometryHandler",value:function(e,t){var i=this;this._graphicUpdateGeometryOrTransformHandler(e,t,(function(){var n,r,a;return!(null==t.newValue||null==e||!e.graphics3DSymbol.updateGeometry(e,t.newValue)||null!==(n=null===(r=i._labeler)||void 0===r?void 0:r.updateGraphicGeometry(e))&&void 0!==n&&!n)&&(null!==(a=i._labeler)&&void 0!==a&&a.setDirty(),!0)}));var n=t.graphic.geometry;null!=n&&this._expandComputedExtent(n)}},{key:"_graphicUpdateTransformHandler",value:function(e,t){var i=t.graphic.geometry;this._graphicUpdateGeometryOrTransformHandler(e,t,(function(){return null!=t.newValue&&null!=e&&null!=i&&e.graphics3DSymbol.updateTransform(e,i.spatialReference,t.newValue,t.action)}))}},{key:"_graphicUpdateGeometryOrTransformHandler",value:function(e,t,i){if(null!=t.graphic.geometry)if(null!=e)i()||this._recreateGraphic(e.graphic);else{var n,r=null===(n=t.graphic.symbol)||void 0===n?void 0:n.id;if(r){var a=this._symbols.get(r);if(null!=a&&a.loadStatus===Ce.P.LOADING)return}this._recreateGraphic(t.graphic)}else this._recreateGraphic(t.graphic)}},{key:"_graphicUpdateSymbolHandler",value:function(e,t){var i=t.graphic,n=null!=e?e.graphics3DSymbol:null!=t.oldValue?this._symbols.get(t.oldValue.id):null;if(null!=n&&null!=t.newValue){var r=n.symbol,a=this._getConvertedSymbol(t.newValue);if((null==a||a.type===r.type&&"web-style"!==a.type)&&"web-style"!==r.type){var l=this._graphicsBySymbol.get(r.id);if(l&&1!==l.size)this._recreateGraphic(i);else{var o=(0,R.Hg)(r,a);if(null!=o){var u={diff:o,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(n.prepareSymbolPatch(u),(0,R.xb)(u.diff)){var h=this._getRenderingInfo(i);if(null!=h){var c,d=n.extentPadding,p=(0,s.Z)(u.symbolStatePatches);try{for(p.s();!(c=p.n()).done;){(0,c.value)()}}catch(g){p.e(g)}finally{p.f()}if(d!==n.extentPadding&&this._recomputeExtentPadding(),null!=e){var y,v=(0,s.Z)(u.graphics3DGraphicPatches);try{for(v.s();!(y=v.n()).done;){(0,y.value)(e,h)}}catch(g){v.e(g)}finally{v.f()}}this._updateSymbolMapping(r.id,a)}else this._recreateGraphic(i)}else this._recreateGraphic(i)}else this._updateSymbolMapping(r.id,a)}}else this._recreateGraphic(i)}else this._recreateGraphic(i)}},{key:"_graphicUpdateVisibleHandler",value:function(e){var t,i;this._updateUserVisibility(e)&&(null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty())}},{key:"recreateGraphics",value:function(e){this._suspendSymbolCleanup=!0,this.remove(e),this.add(e),this._suspendSymbolCleanup=!1,this.effectiveUpdatePolicy===Be.j.SYNC&&this._cleanupSymbols()}},{key:"_recreateGraphic",value:function(e){this.recreateGraphics([e])}},{key:"_beginGraphicUpdate",value:function(e){var t=this._graphicsUpdateId;return this._graphicsUpdateId++,this._graphicsWaitingForSymbol.set(e.uid,t),1===this._graphicsWaitingForSymbol.size&&this.notifyChange("dataUpdating"),t}},{key:"_endGraphicUpdate",value:function(e){e&&(this._graphicsWaitingForSymbol.delete(e.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating")))}},{key:"_recomputeExtentPadding",value:function(){var e=0;this._symbols.forEach((function(t){null!=t&&(e=Math.max(e,t.extentPadding))})),this._set("extentPadding",e)}},{key:"_expandComputedExtent",value:function(e){var t=tt,i=e.spatialReference;(0,T.FS)(e,t);var n=this._viewSpatialReference,r=Le.tmpVec;if((0,j.fS)(i,n)||(0,U.R)(t[0],t[1],0,i,r,n)&&(t[0]=r[0],t[1]=r[1],(0,U.R)(t[3],t[4],0,i,r,n),t[3]=r[0],t[4]=r[1]),isFinite(t[0])&&isFinite(t[3])&&isFinite(t[1])&&isFinite(t[4])){var a=this.computedExtent,s=null,l=isFinite(t[2])&&isFinite(t[5]),o=l&&(null==(null===a||void 0===a?void 0:a.zmin)||t[2]<a.zmin),u=l&&(null==(null===a||void 0===a?void 0:a.zmax)||t[5]>a.zmax);a?(t[0]<a.xmin||t[1]<a.ymin||t[3]>a.xmax||t[4]>a.ymax||o||u)&&((s=this._propertiesPool.get("computedExtent")).xmin=Math.min(t[0],a.xmin),s.ymin=Math.min(t[1],a.ymin),s.xmax=Math.max(t[3],a.xmax),s.ymax=Math.max(t[4],a.ymax),s.spatialReference=n):((s=this._propertiesPool.get("computedExtent")).xmin=t[0],s.ymin=t[1],s.xmax=t[3],s.ymax=t[4],s.spatialReference=n),s&&(o&&(s.zmin=t[2]),u&&(s.zmax=t[5]),this._set("computedExtent",s))}}},{key:"_abortElevationInfoChange",value:function(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}},{key:"elevationInfoChange",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,i,n,a,l=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._abortElevationInfoChange(),n=new AbortController,this._elevationInfoChangeAbortController=n,a=(0,K.WI)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),e.next=6,(0,K.kr)(a,this._viewSpatialReference,n.signal,y.Z.getLogger(this));case 6:this.symbolCreationContext.featureExpressionInfoContext=e.sent,(0,G.k_)(n.signal),this._elevationInfoChangeAbortController=null,null!==(t=this._labeler)&&void 0!==t&&t.elevationInfoChange(),this.forEachGraphics3DSymbol((function(e,t,i){e.globalPropertyChanged("elevationInfo",t)?t.forEach((function(e){var t,i=e.graphic,n=e.labelLayers,r=(0,s.Z)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.graphics3DSymbolLayer.updateGraphicElevationContext(i,a)}}catch(l){r.e(l)}finally{r.f()}})):l._recreateSymbol(i)})),this.updateStageLayerElevationProvider(),null===(i=this._elevationAlignment)||void 0===i||i.elevationInfoChange();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateStageLayerElevationProvider",value:function(){this._stageLayerElevationProvider?(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,C.M2)(this._stageLayerElevationProvider)):(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&this._numberOfGraphicsProvidingElevation>0&&(this._stageLayerElevationProvider=new Ae({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))}},{key:"_clearSymbolsAndGraphics",value:function(){var e,t,i,n;this.clear(),null!=this._filterVisibility&&this._filterVisibility.clear(),null!==(e=this._labeler)&&void 0!==e&&e.reset(),null!==(t=this._deconflictor)&&void 0!==t&&t.clear(),null!==(i=this._elevationAlignment)&&void 0!==i&&i.clear(),null!==(n=this.stageLayer)&&void 0!==n&&n.invalidateSpatialQueryAccelerator(),this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,C.M2)(this._stageLayerElevationProvider))}},{key:"startCreateGraphics",value:function(){this._startCreateGraphics=!0,this.recreateAllGraphics()}},{key:"recreateAllGraphics",value:function(){this._recreateAllGraphics(!1)}},{key:"recreateAllGraphicsAndSymbols",value:function(){this._recreateAllGraphics(!0)}},{key:"_recreateAllGraphics",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._startCreateGraphics){var t=this.owner,i=t.loadedGraphics,n=t.view,r=n.basemapTerrain.tilingScheme&&null!==i&&void 0!==i&&i.length?i.toArray():null;!e&&r||this._clearSymbolsAndGraphics(),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this._set("computedExtent",null),r&&(e?this.add(r):this.recreateGraphics(r))}}},{key:"_recreateSymbol",value:function(e){var t=this,i=this._graphicsBySymbol.get(e),n=[];i&&(i.forEach((function(e,i){var r,a=e.usedMemory;t._conditionalRemove(e,i),null!==(r=t._spatialIndex)&&void 0!==r&&r.remove(e),n.push(e.graphic),e.destroy(),t._removeGraphics3DGraphic(i,a),t._updateLayerVisibility(),t._featureStore.events.emit("changed")})),this._graphicsBySymbol.set(e,new Map));var r=this._symbols.get(e);(0,C.SC)(r),this._symbols.delete(e),this._symbolMaterials=null,this.add(n)}},{key:"_recreateGraphicsForSymbol",value:function(e){var t=this._graphicsBySymbol.get(e);if(t){var i=[];t.forEach((function(e){return i.push(e.graphic)})),this.recreateGraphics(i)}}},{key:"_conditionalRemove",value:function(e,t){var i,n,r;this._graphicsDrapedUids.delete(t),null!==(i=this._objectStates)&&void 0!==i&&i.removeGraphic(e),null!==(n=this._labeler)&&void 0!==n&&n.removeGraphic(e),null!==(r=this._deconflictor)&&void 0!==r&&r.removeGraphic(e),null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(e)}},{key:"add",value:function(e){var t;e&&0!==e.length&&(null!==(t=this.owner.view.basemapTerrain)&&void 0!==t&&t.tilingScheme?(this._updatePolicyForGraphics(e)===Be.j.ASYNC?this._addDelayed(e):this._addImmediate(e),this.notifyChange("dataUpdating")):y.Z.getLogger(this).error("#add()","Cannot add graphics before terrain surface has been initialized"))}},{key:"_updatePolicyForGraphics",value:function(e){if(this.effectiveUpdatePolicy===Be.j.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType)){var t,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(null!=n.geometry&&"mesh"===n.geometry.type&&!n.geometry.loaded)return Be.j.ASYNC}}catch(r){i.e(r)}finally{i.f()}}return this.effectiveUpdatePolicy}},{key:"_addImmediate",value:function(e){var t,i;this._geometryWarningLogged=!1,this._symbolWarningLogged=!1;var n,r=(0,s.Z)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;this._addGraphic(a,this._getRenderingInfo(a,y.Z.getLogger(this)),Be.j.SYNC)}}catch(l){r.e(l)}finally{r.f()}this._cleanupSymbols(),null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty()}},{key:"_addDelayed",value:function(e){var t,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n,r=t.value,a=r.uid,l=this._pendingUpdates.get(a);l?l.add?l.state!==Ue.NEW&&(null===(n=l.abortController)||void 0===n||n.abort()):this._pendingAdds++:(l=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(a,l)),l.add=r}}catch(o){i.e(o)}finally{i.f()}this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}},{key:"remove",value:function(e){this.effectiveUpdatePolicy===Be.j.ASYNC?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("dataUpdating")}},{key:"_removeImmediate",value:function(e){var t,i,n,r=(0,s.Z)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;this._removeGraphic(a)}}catch(l){r.e(l)}finally{r.f()}this._cleanupSymbols(),null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty()}},{key:"_removeDelayed",value:function(e){var t,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n,r=t.value,a=r.uid,l=this._pendingUpdates.get(a);if(l)l.add&&(l.remove?l.add=null:this._pendingUpdates.delete(a),l.state===Ue.LOADING&&null!==(n=l.abortController)&&void 0!==n&&n.abort(),this._pendingAdds--);else{var o=this._pendingUpdatesPool.pushNew();o.remove=r,this._pendingUpdates.set(a,o),this._pendingRemoves++,this._applyPendingRemovesFirst=!0}}}catch(u){i.e(u)}finally{i.f()}0===this._pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}},{key:"_finishPendingUpdates",value:function(){this._pendingUpdatesPool.clear(),this._cleanupSymbols(),(this._pendingAdds||this._pendingRemoves)&&y.Z.getLogger(this).warn("pendingAdds/Removes in inconsistent state!"),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1}},{key:"_applyPendingUpdates",value:function(e){var t;if(this._geometryWarningLogged=!1,this._symbolWarningLogged=!1,0===this._pendingUpdates.size&&null!==(t=this._spatialIndex)&&void 0!==t&&t.updating)return this._spatialIndex.update(),void e.madeProgress();if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;var i,r=(0,s.Z)(this._pendingUpdates);try{for(r.s();!(i=r.n()).done;){var a=(0,n.Z)(i.value,2),l=a[0],o=a[1];if(e.done){this._applyPendingRemovesFirst=!0;break}if(o.remove&&!o.add&&(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(o.remove),o.remove=null,this._pendingUpdates.delete(l),0===this._pendingRemoves))break}}catch(v){r.e(v)}finally{r.f()}}var u,h=(0,s.Z)(this._pendingUpdates);try{for(h.s();!(u=h.n()).done;){var c=(0,n.Z)(u.value,2),d=c[0],p=c[1];if(e.done)break;p.add&&p.state===Ue.NEW&&this._processPendingUpdateNew(p);var y=this.effectiveUpdatePolicy;if(!p.remove||p.add&&p.state!==Ue.READY||(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(p.remove),p.remove=null,y=Be.j.SYNC),p.add)switch(p.state){case Ue.READY:this._addGraphic(p.add,p.renderingInfo,y),p.add=null,this._pendingAdds--,e.madeProgress();break;case Ue.REJECTED:p.add=null,this._pendingAdds--;case Ue.LOADING:}null==p.remove&&null==p.add&&this._pendingUpdates.delete(d)}}catch(v){h.e(v)}finally{h.f()}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("dataUpdating"))}},{key:"_processPendingUpdateNew",value:function(e){if(e.add){var t=e.add.geometry;null==t||"mesh"!==t.type||t.loaded?this._processPendingUpdateNewRenderingInfo(e):this._processPendingUpdateNewMesh(e,t)}else e.state=Ue.READY}},{key:"_processPendingUpdateNewMesh",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state=Ue.LOADING,t.abortController=new AbortController,n=t.abortController.signal,e.prev=2,e.next=5,i.load({signal:n});case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",this._processPendingUpdateNewError(t,e.t0));case 10:t.abortController=null,this._processPendingUpdateNewRenderingInfo(t);case 11:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_processPendingUpdateNewError",value:function(e,t){e.abortController=null,(0,G.D_)(t)?e.state=Ue.NEW:e.state=Ue.REJECTED}},{key:"_processPendingUpdateNewRenderingInfo",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.layer.renderer&&"dictionary"===this.layer.renderer.type){e.next=2;break}return e.abrupt("return",(t.renderingInfo=this._getRenderingInfo(t.add,y.Z.getLogger(this)),void(t.state=Ue.READY)));case 2:return t.state=Ue.LOADING,t.abortController=new AbortController,n=null,e.prev=4,e.next=7,this._getRenderingInfoAsync(t.add,{signal:t.abortController.signal});case 7:n=e.sent,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",(t.abortController=null,void((0,G.D_)(e.t0)?t.state=Ue.NEW:t.state=Ue.REJECTED)));case 13:null==(null===(i=n)||void 0===i?void 0:i.symbol)?(this._symbolWarningLogged||(this._symbolWarningLogged=!0,y.Z.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," has no symbol and will not render"))),t.renderingInfo=null):t.renderingInfo=n,t.state=Ue.READY;case 14:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_addGraphic",value:function(e,t,i){var n=this;if(this._graphicsWithoutSymbol.set(e.uid,e),null!=(null===t||void 0===t?void 0:t.symbol)&&(0,T.S6)(e)){if(null!=this.stage.renderView.objectAndLayerIdRenderHelper&&this.setUidToIdOnAdd){var r,a=(0,N.ql)(this.owner.view.map,this.layer.uid);this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(e.objectId,e.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled&&!a&&(0,We.zc)(this.layer,null===(r=this.owner.view.popup)||void 0===r?void 0:r.defaultPopupTemplateEnabled))}var s=t.symbol,l=this.getOrCreateGraphics3DSymbol(s,t.renderer);if(null!=l){this._expandComputedExtent(e.geometry);var o=this._beginGraphicUpdate(e),u=new se.z(e,t,this.layer),h=!1,c=function(e){e===l.symbol.id&&(h=!0)};this._whenSymbolRemoved.push(c);var d=function(){var t;if(--n._loadingSymbols,!n.destroyed){if(n._whenSymbolRemoved.removeUnordered(c),n._graphicsWaitingForSymbol.get(e.uid)!==o||h||l.destroyed||n.graphicSymbolSupported&&e.symbol&&e.symbol.id!==l.symbol.id)--l.referenced,n._cleanupSymbols();else{var i=n._createGraphics3DGraphic(l,u);n._spatialIndex&&null!=i&&n._spatialIndex.add(i),--l.referenced,n._endGraphicUpdate(e)}n._featureStore.events.emit("changed"),null===(t=n._labeler)||void 0===t||t.setDirty()}},p=function(t){--n._loadingSymbols,n.destroyed||(n._whenSymbolRemoved.removeUnordered(c),h||((0,G.D_)(t)?n.add([e]):l.destroyed||n._endGraphicUpdate(e)))};++this._loadingSymbols,i===Be.j.ASYNC?l.load((function(){return n._dataUpdateQueue.push(d,null).catch(G.R8)}),(function(e){return n._dataUpdateQueue.push((function(){return p(e)}),null).catch(G.R8)})):l.load(d,p)}}}},{key:"_removeGraphic",value:function(e){var t=e.uid,i=this.graphics3DGraphics.get(t);if(i){var n,r;i.graphics3DSymbol.onRemoveGraphic(i);var a=i.usedMemory,s=i.isElevationSource;this._conditionalRemove(i,t),null===(n=this._spatialIndex)||void 0===n||n.remove(i);var l=i.graphics3DSymbol.symbol.id;null!==(r=this._graphicsBySymbol.get(l))&&void 0!==r&&r.delete(t),this._graphicsWithoutSymbol.delete(t),this._removeGraphics3DGraphic(t,a,s),i.destroy(),this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(t),this._graphicsWaitingForSymbol.delete(t),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating"))}},{key:"_hasLabelingContext",value:function(e){if(e instanceof Xe.Z||e instanceof Ke.Z){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some((function(t){return t.symbol===e}))}return!1}},{key:"_hasValidSymbolCreationContext",value:function(e){return!(e instanceof Xe.Z&&!this._hasLabelingContext(e))||(y.Z.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1)}},{key:"_getRenderingInfo",value:function(e,t){var i,n=e.geometry;if(null==n)return t&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!(0,O.canProjectWithoutEngine)(n.spatialReference,this._viewSpatialReference))return t&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has incompatible spatial reference and will not render"))),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return t&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;var r,a=this.rendererHasGeometryOperations?(0,M.mW)(e,this.layer):e;return null==(null===(i=r=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer)?this.owner.getRenderingInfo(a,this.currentRenderer,this._arcadeOnDemand):{symbol:a.symbol||(0,W.qN)(a.geometry)})||void 0===i?void 0:i.symbol)?(t&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has no symbol and will not render"))),null):r}},{key:"_getRenderingInfoAsync",value:function(e,t){if(null==e.geometry)return this._geometryWarningLogged||(this._geometryWarningLogged=!0,y.Z.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return this._symbolWarningLogged||(this._symbolWarningLogged=!0,y.Z.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;var i=this.rendererHasGeometryOperations?(0,M.mW)(e,this.layer):e;return this.owner.getRenderingInfoAsync(i,this.currentRenderer,this._arcadeOnDemand,t)}},{key:"_createGraphics3DSymbol",value:function(e,t){var i=this;if(!this._hasValidSymbolCreationContext(e))return null;var n,r=this._getConvertedSymbol(e);if(!r)return null;if(null!=t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var a=(0,q.q)(t.backgroundFillSymbol,{ignoreDrivers:!0});null!=a.symbol&&(n=a.symbol.symbolLayers)}var s=ve(r,this.symbolCreationContext,n);return s.load((function(){var e=s.extentPadding;e>i.extentPadding&&i._set("extentPadding",e),i.notifyChange("averageSymbolComplexity")}),(function(){})),s}},{key:"getOrCreateGraphics3DSymbol",value:function(e,t){var i=this,n=this._symbols.get(e.id);if(void 0===n){var r=this._unusedSymbolsCache.pop(e.id);n=null!=r?r:e instanceof $e.Z?new ge.l(e,(function(e){return i._dataUpdateQueue.push(e,null)}),(function(e){return i._createGraphics3DSymbol(e,t)})):this._createGraphics3DSymbol(e,t),this._symbols.set(e.id,n),this._symbolMaterials=null}return null!=n&&++n.referenced,n}},{key:"trackGraphicState",value:function(e){return null==this._graphicStateTracking&&(this._graphicStateTracking=new _e(this)),this._graphicStateTracking.add(e)}},{key:"_addGraphics3DGraphic",value:function(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this._numberOfGraphics++,e.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}},{key:"_removeGraphics3DGraphic",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._usedMemory-=t,this.graphics3DGraphics.delete(e),this._numberOfGraphics--,i&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}},{key:"_createGraphics3DGraphic",value:function(e,t){var i,n,r,a=t.graphic;if(this._graphicsWithoutSymbol.delete(a.uid),!this._symbols.has(e.symbol.id))return this.add([a]),null;if(this.graphics3DGraphics.has(a.uid))return null;var s=e.createGraphics3DGraphic(t);if(null==s)return null;this._addGraphics3DGraphic(s);var l=e.symbol.id;if(this._graphicsBySymbol.has(l)||this._graphicsBySymbol.set(l,new Map),this._graphicsBySymbol.get(l).set(a.uid,s),s.isDraped&&this._graphicsDrapedUids.add(a.uid),s.centroid=null,null!=a.geometry&&"point"!==a.geometry.type&&(s.centroid=(0,be.zE)(a.geometry,this._viewSpatialReference)),this._updateUserVisibility(s),null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(s),null!=this._filterVisibility){var o=this._filterVisibility.defaultVisibility;s.setVisibilityFlag(X.E.GRAPHIC,X.P.FILTER,o),o||this._filterVisibility.reapply()}null!==(i=this._deconflictor)&&void 0!==i&&i.addGraphic(s),null!==(n=this._labeler)&&void 0!==n&&n.addGraphic(s),null!==(r=this._objectStates)&&void 0!==r&&r.addGraphic(s),s.initialize(this.stageLayer,this.owner),null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(s);var u=this._whenGraphics3DGraphicRequests[a.uid];return u&&(delete this._whenGraphics3DGraphicRequests[a.uid],u.resolve(s)),this._symbolMaterials=null,s}},{key:"_abortRendererChange",value:function(){this._rendererChangeAbortController&&(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)}},{key:"rendererChange",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i,n,a,s,l,o=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._abortRendererChange(),t===this.currentRenderer){e.next=37;break}if(this._validateRenderer(t),null==t&&this._currentRendererChange(null,!1),!(0,H.e)(t)){e.next=36;break}if(null===t||void 0===t||!t.arcadeRequired){e.next=25;break}return i=new AbortController,this._rendererChangeAbortController=i,e.next=7,this._ensureArcade();case 7:if(n=e.sent,a=n.arcadeUtils,(0,G.k_)(i),s=a.hasGeometryOperations(t),e.t0=s,!e.t0){e.next=16;break}return e.next=15,a.enableGeometryOperations();case 15:(0,G.k_)(i);case 16:if(this.effectiveUpdatePolicy!==Be.j.ASYNC){e.next=21;break}return e.next=19,this._updateQueue.push((function(){return o._currentRendererChange(t,s)}),i.signal);case 19:e.next=22;break;case 21:this._currentRendererChange(t,s);case 22:this._rendererChangeAbortController=null,e.next=34;break;case 25:if(this.effectiveUpdatePolicy!==Be.j.ASYNC){e.next=33;break}return l=new AbortController,this._rendererChangeAbortController=l,e.next=30,this._updateQueue.push((function(){return o._currentRendererChange(t,!1)}),l.signal);case 30:this._rendererChangeAbortController=null,e.next=34;break;case 33:this._currentRendererChange(t,!1);case 34:e.next=37;break;case 36:this._currentRendererChange(t,!1);case 37:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_ensureArcade",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this._arcadeOnDemand){e.next=7;break}return e.next=3,(0,B.LC)();case 3:this._arcadeOnDemand=e.sent,e.t0=this._arcadeOnDemand,e.next=8;break;case 7:e.t0=this._arcadeOnDemand;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_currentRendererChange",value:function(e,t){var i;this.currentRenderer=e,this.rendererHasGeometryOperations=t,this.symbolCreationContext.arcade=this._arcadeOnDemand;var n=this.symbolCreationContext.renderer;if(e!==n){if(this._symbolConversionCache.clear(),this._unusedSymbolsCache.clear(),null==e)return this.symbolCreationContext.renderer=null,void this.recreateAllGraphicsAndSymbols();var r=(0,R.Hg)(n,e);this._updateUnchangedSymbolMappings(r,e,n),this.symbolCreationContext.renderer=e,null!=r&&("complete"===r.type?this.recreateAllGraphicsAndSymbols():"partial"===r.type&&(this._applyRendererDiff(r,e,n)?null===(i=this._labeler)||void 0===i||i.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}}},{key:"_diffHasSymbolChange",value:function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"uniqueValueGroups":case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1}},{key:"_applySymbolSetDiff",value:function(e,t,i){var n,r,a=this;e=e||[],t=t||[];var l,o=[],u=(0,s.Z)(t);try{var h=function(){var t=l.value,n=a._graphicsBySymbol.get(t.id);n&&n.forEach((function(r,s){var l=r.graphic,u=a.layer instanceof F.Z?a.layer:null,h=a._arcadeOnDemand;if(t!==i.defaultSymbol||i.getSymbol((0,M.mW)(l,u),{arcade:h})!==i.defaultSymbol){var c=r.usedMemory;e.length||i.defaultSymbol?o.push(l):a._graphicsWithoutSymbol.set(s,l);var d=a.graphics3DGraphics.get(s);a._conditionalRemove(d,s),r.destroy(),n.delete(s),a._removeGraphics3DGraphic(s,c),a._updateLayerVisibility()}})),a._whenSymbolRemoved.forAll((function(e){return e(t.id)}))};for(u.s();!(l=u.n()).done;)h()}catch(c){u.e(c)}finally{u.f()}(e.length||o.length)&&(this._graphicsWithoutSymbol.forEach((function(e){return o.push(e)})),this._graphicsWithoutSymbol.clear(),this.add(o)),this._cleanupSymbols(),null!==(n=this._labeler)&&void 0!==n&&n.setDirty(),null===(r=this._deconflictor)||void 0===r||r.setDirty()}},{key:"_applyUniqueValueRendererDiff",value:function(e,t,i){var n=e.diff.defaultSymbol,r=e.diff.uniqueValueInfos;if(n||r){var a=r?r.added.map((function(e){return e.symbol})).filter(g.pC):[],s=r?r.removed.map((function(e){return e.symbol})).filter(g.pC):[];if(r)for(var l=0;l<r.changed.length;l++)a.push(r.changed[l].newValue.symbol),s.push(r.changed[l].oldValue.symbol);return n?(i.defaultSymbol&&s.push(i.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):i.defaultSymbol&&a.length&&s.push(t.defaultSymbol),this._applySymbolSetDiff(a,s,t),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1}},{key:"_calculateUnchangedSymbolMapping",value:function(e,t,i){if("unique-value"!==(null===t||void 0===t?void 0:t.type)||"unique-value"!==(null===i||void 0===i?void 0:i.type)||null!=e&&"partial"!==e.type)return[];var n,r=function(e){return null!=e?e.id:null},a=e&&e.diff,l=null===a||void 0===a?void 0:a.defaultSymbol,o=a&&a.uniqueValueInfos;if(o)n=o.unchanged.map((function(e){return{oldId:r(e.oldValue.symbol),newId:r(e.newValue.symbol)}}));else{var u;n=[];var h,c=(0,s.Z)(null!==(u=i.uniqueValueInfos)&&void 0!==u?u:[]);try{var d=function(){var e,i=h.value,a=r(i.symbol),s=null===(e=t.uniqueValueInfos)||void 0===e?void 0:e.find((function(e){return e.value===i.value}));s&&a!==r(s.symbol)&&n.push({oldId:a,newId:r(s.symbol)})};for(c.s();!(h=c.n()).done;)d()}catch(p){c.e(p)}finally{c.f()}}return!l&&i.defaultSymbol&&n.push({oldId:r(i.defaultSymbol),newId:r(t.defaultSymbol)}),n}},{key:"_updateSymbolMapping",value:function(e,t){var i=null!=t&&t?"string"==typeof t?t:t.id:null;if(null!=e&&e!==i){var n=this._graphicsBySymbol.get(e);this._graphicsBySymbol.delete(e),void 0!==n&&this._graphicsBySymbol.set(i,n);var r=this._symbols.get(e);if(void 0!==r&&(this._symbols.delete(e),this._symbols.set(i,r),this._symbolMaterials=null,null!=r)){var a="string"==typeof t?null:t;null!=a?r.symbol=a:r.symbol.id=i}}}},{key:"_updateUnchangedSymbolMappings",value:function(e,t,i){var n,r=this._calculateUnchangedSymbolMapping(e,t,i),a=(0,s.Z)(r);try{for(a.s();!(n=a.n()).done;){var l=n.value,o=l.oldId,u=l.newId;this._updateSymbolMapping(o,u)}}catch(h){a.e(h)}finally{a.f()}}},{key:"_applyRendererDiff",value:function(e,t,i){if(this._diffHasSymbolChange(e))return!1;if(t instanceof p.Z&&i instanceof p.Z&&this._applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)return!0;var r,a=(0,s.Z)(this._graphicsBySymbol);try{for(a.s();!(r=a.n()).done;){var l=(0,n.Z)(r.value,1)[0],o=this._symbols.get(l);if(null!=o)switch(o.applyRendererDiff(e,t)){case me.W.RecreateSymbol:this._recreateSymbol(l);break;case me.W.RecreateGraphics:this._recreateGraphicsForSymbol(l);case me.W.FastUpdate:}}}catch(u){a.e(u)}finally{a.f()}return!0}},{key:"opacityChange",value:function(){this.forEachGraphics3DSymbol((function(e,t){return e.globalPropertyChanged("opacity",t)})),this._updateStageLayerVisibility()}},{key:"_slicePlaneEnabledChange",value:function(e){var t,i;e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.sliceable=e,this.forEachGraphics3DSymbol((function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)})),null!==(t=this._deconflictor)&&void 0!==t&&t.slicePlaneEnabledChange(),null===(i=this._labeler)||void 0===i||i.slicePlaneEnabledChange())}},{key:"_physicalBasedRenderingChange",value:function(e){var t=this;this.symbolCreationContext.physicalBasedRenderingEnabled=e,this.forEachGraphics3DSymbol((function(e,i,n){e.globalPropertyChanged("physicalBasedRenderingEnabled",i)||t._recreateSymbol(n)}))}},{key:"_skipHighSymbolLoDsChange",value:function(e){var t=this;this.symbolCreationContext.skipHighSymbolLods=e,this.forEachGraphics3DSymbol((function(e,i,n){e.globalPropertyChanged("skipHighSymbolLods",i)||t._recreateSymbol(n)}))}},{key:"_pixelRatioChange",value:function(){var e=this;this.forEachGraphics3DSymbol((function(t,i,n){t.globalPropertyChanged("pixelRatio",i)||e._recreateSymbol(n)}))}},{key:"_signalUpdatingDuringAsyncLoadedGraphicsChange",value:function(){var e=this;this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=(0,k.Os)((function(){e._updatingPendingLoadedGraphicsChange=null}))}},{key:"setClippingExtent",value:function(e,t){var i=this.symbolCreationContext.clippingExtent,n=(0,V.Ue)();return(0,Me.G)(e,n,t)?this.symbolCreationContext.clippingExtent=(0,Z.JR)((0,Z.Ue)(),n):this.symbolCreationContext.clippingExtent=null,!(0,Z.fS)(this.symbolCreationContext.clippingExtent,i)}},{key:"modifyGraphics3DGraphicVisibilities",value:function(e){var t,i;if(!this.destroyed){var n=!1;this.graphics3DGraphics.forEach((function(t){e(t)&&(n=!0)})),n&&(null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty())}}},{key:"forEachGraphics3DSymbol",value:function(e){var t,i=(0,s.Z)(this._symbols);try{for(i.s();!(t=i.n()).done;){var r=(0,n.Z)(t.value,2),a=r[0],l=r[1];if(null==l)return;e(l,this._graphicsBySymbol.get(a)||lt,a)}}catch(o){i.e(o)}finally{i.f()}}},{key:"updateAllGraphicsVisibility",value:function(){var e=this;null!=this._filterVisibility&&this._filterVisibility.reapply(),this.modifyGraphics3DGraphicVisibilities((function(t){var i=e._updateUserVisibility(t),n=null!=e._scaleVisibility&&e._scaleVisibility.updateVisibility(t);return i||n}))}},{key:"_hideAllGraphics",value:function(){this.modifyGraphics3DGraphicVisibilities((function(e){return e.setVisibilityFlag(X.E.GRAPHIC,X.P.USER,!1)}))}},{key:"_validateRenderer",value:function(e){var t,i=this,n=function(){return"'".concat(i.layer.title?"".concat(i.layer.title,", "):"","id:").concat(i.layer.id,"'")},r=(0,H.s)(e,{geometryType:null===(t=this.layer)||void 0===t?void 0:t.geometryType,logWarning:function(e){return y.Z.getLogger(i).warn("Symbology conversion for layer ".concat(n(),": ").concat(e))}});if(r){var a="Renderer for layer ".concat(n," is not supported in a SceneView");y.Z.getLogger(this).warn(a,r.message)}}},{key:"_cleanupSymbols",value:function(){var e=this;if(!(this._graphicsWaitingForSymbol.size>0||this._suspendSymbolCleanup)){var t=!1;this._symbols.forEach((function(i,n){if(!(null==i||i.referenced>0)){var r=e._graphicsBySymbol.get(n);r&&0!==r.size||(e._graphicsBySymbol.delete(n),e._symbols.delete(n),e._symbolMaterials=null,e._unusedSymbolsCache.put(n,i,xe(i),S.M4),t=!0)}})),t&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}}},{key:"test",get:function(){}},{key:"performanceInfo",get:function(){return new fe.J(this.graphics3DGraphics.size,this._graphicsWithoutSymbol.size,this._pendingUpdates.size)}}]),i}(v.default);it.tmpVec=(0,P.Ue)(),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"computedExtent",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"currentRenderer",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"rendererHasGeometryOperations",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_frameTaskHandle",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_dataUpdateQueue",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_updateQueue",void 0),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"_viewSpatialReference",null),(0,d._)([(0,E.Cb)()],it.prototype,"_rendererChangeAbortController",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_elevationInfoChangeAbortController",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_initializeAbortController",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_elevationAlignment",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_scaleVisibility",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_filterVisibility",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_initializePromise",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_spatialIndex",void 0),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"extentPadding",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_updatingPendingLoadedGraphicsChange",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_featureStore",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_objectStates",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_loadingSymbols",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"preferredUpdatePolicy",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_forcedUpdatePolicy",void 0),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"effectiveUpdatePolicy",null),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"elevationFeatureExpressionEnabled",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"owner",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"layer",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"graphicSymbolSupported",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"getRenderingInfoWithoutRenderer",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"componentFactories",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"setUidToIdOnAdd",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"featureStore",null),(0,d._)([(0,E.Cb)()],it.prototype,"initializePromise",null),(0,d._)([(0,E.Cb)()],it.prototype,"scaleVisibility",null),(0,d._)([(0,E.Cb)()],it.prototype,"elevationAlignment",null),(0,d._)([(0,E.Cb)()],it.prototype,"objectStates",null),(0,d._)([(0,E.Cb)()],it.prototype,"filterVisibility",null),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"updating",null),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"dataUpdating",null),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"running",null),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"suspendedOrOutsideOfView",null),(0,d._)([(0,E.Cb)({readOnly:!0,dependsOn:[]})],it.prototype,"updatingRemaining",null),(0,d._)([(0,E.Cb)({readOnly:!0})],it.prototype,"displayFeatureLimit",null),(0,d._)([(0,E.Cb)({readOnly:!0,dependsOn:[]})],it.prototype,"averageSymbolComplexity",null),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"hasZ",void 0),(0,d._)([(0,E.Cb)({constructOnly:!0})],it.prototype,"hasM",void 0),(0,d._)([(0,E.Cb)()],it.prototype,"_objectIdField",null),it=Le=(0,d._)([(0,I.j)("esri.views.3d.layers.graphics.Graphics3DCore")],it),function(e){e[e.NEW=0]="NEW",e[e.LOADING=1]="LOADING",e[e.READY=2]="READY",e[e.REJECTED=3]="REJECTED"}(Ue||(Ue={}));var nt=function(){function e(){(0,l.Z)(this,e),this.add=null,this.renderingInfo=null,this.state=Ue.NEW,this.abortController=null,this.remove=null}return(0,o.Z)(e,[{key:"clear",value:function(){this.add=null,this.renderingInfo=null,this.state=Ue.NEW,this.abortController=null,this.remove=null}}]),e}(),rt=10,at=(0,P.Ue)(),st=(0,P.Ue)(),lt=new Map},57848:function(e,t,i){i.d(t,{_:function(){return f}});var n=i(37762),r=i(15671),a=i(43144),s=i(60136),l=i(29388),o=i(27366),u=i(7138),h=i(91505),c=i(94172),d=i(49861),p=(i(93169),i(32718),i(84936),i(69912)),y=i(52404),v=i(78485),g=i(93463),f=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._dirtyExtents=new y.D,n._globalDirty=!1,n._averageExtentUpdateSize=0,n._dirtyGraphicsSet=new Set,n._updateElevation=!1,n.graphicsCoreOwner=null,n.graphicsCore=null,n.events=new h.Z,n}return(0,a.Z)(i,[{key:"initialize",value:function(){var e,t=this,i=this.elevationProvider,n=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=n.registerTask(_(null===(e=this.graphicsCore.layer.elevationInfo)||void 0===e?void 0:e.mode),this),this.addHandles([i.on("elevation-change",(function(e){return t._elevationChanged(e)})),(0,c.watch)((function(){return t.graphicsCoreOwner.suspended}),(function(){return t._suspendedChange()})),this._task,(0,c.watch)((function(){var e;return _(null===(e=t.graphicsCore.layer.elevationInfo)||void 0===e?void 0:e.mode)}),(function(e){return t._task.priority=e}))])}},{key:"destroy",value:function(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null}},{key:"clear",value:function(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}},{key:"_suspendedChange",value:function(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}},{key:"elevationInfoChange",value:function(){this._globalDirty=!0,this.notifyChange("updating")}},{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}},{key:"updatingRemaining",get:function(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}},{key:"runTask",value:function(e){var t=this;for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,e.madeProgress()),e.run((function(){return t._dirtyExtents.merge(e)}));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.notifyChange("updating")}},{key:"_updateDirtyGraphics",value:function(e){var t,i=this.graphicsCoreOwner.view.renderCoordsHelper,r=this.graphicsCore.effectiveUpdatePolicy===v.j.ASYNC,a=(0,n.Z)(this._dirtyGraphicsSet.keys());try{for(a.s();!(t=a.n()).done;){var s,l=t.value,o=this.graphicsCore.getGraphics3DGraphicById(l);if(this._dirtyGraphicsSet.delete(l),null!=o&&(o.alignWithElevation(this.elevationProvider,i,r),null!==(s=this.graphicsCore.deconflictor)&&void 0!==s&&s.setDirty(),e.madeProgress()),e.done)return}}catch(u){a.e(u)}finally{a.f()}}},{key:"_updateDirtyExtents",value:function(e){for(var t=this;!this._dirtyExtents.empty&&!e.done;){var i=this._dirtyExtents.pop(),n=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:i,spatialReference:n});var r=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(i,n,(function(e){var i=t.graphicsCore.getGraphics3DGraphicById(e);null!=i&&i.needsElevationUpdates()&&t._dirtyGraphicsSet.add(e)})),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-r)+.9*this._averageExtentUpdateSize,e.madeProgress()}}},{key:"_markAllGraphicsElevationDirty",value:function(){var e=this;this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,i){return e._dirtyGraphicsSet.add(i)}))}},{key:"_elevationChanged",value:function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){var i=this.graphicsCore.computedExtent;i&&t[2]>i.xmin&&t[0]<i.xmax&&t[3]>i.ymin&&t[1]<i.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",e)}else t[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}}}]),i}(u.default);function _(e){return null==e?g.T8.ELEVATION_ALIGNMENT:"relative-to-scene"===e?g.T8.ELEVATION_ALIGNMENT_SCENE:g.T8.ELEVATION_ALIGNMENT}(0,o._)([(0,d.Cb)()],f.prototype,"graphicsCoreOwner",void 0),(0,o._)([(0,d.Cb)()],f.prototype,"graphicsCore",void 0),(0,o._)([(0,d.Cb)()],f.prototype,"queryGraphicUIDsInExtent",void 0),(0,o._)([(0,d.Cb)()],f.prototype,"elevationProvider",void 0),(0,o._)([(0,d.Cb)({readOnly:!0})],f.prototype,"updating",null),(0,o._)([(0,d.Cb)({readOnly:!0})],f.prototype,"updatingRemaining",null),f=(0,o._)([(0,p.j)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],f)},24202:function(e,t,i){i.d(t,{L:function(){return g}});var n=i(15671),r=i(43144),a=i(60136),s=i(29388),l=i(27366),o=i(7138),u=i(94172),h=i(49861),c=(i(93169),i(32718),i(84936),i(69912)),d=i(83448),p=i(57557),y=i(93463),v=i(73553),g=function(e){(0,a.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).suspended=!1,r._extent=null,r._extentIntersectionDirty=!0,r._isVisibleBelowSurfaceInternal=!1,r.graphicsCoreOwner=null,r.updating=!0,r}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.graphicsCoreOwner;this._extentIntersection=new p.q({renderCoordsHelper:t.view.renderCoordsHelper});var i=t.view,n=i.basemapTerrain,r=i.resourceController.scheduler;this.addHandles([i.on("resize",(function(){return e._viewChange()})),(0,u.watch)((function(){return i.state.camera}),(function(){return e._viewChange()}),u.sync),r.registerTask(y.T8.FRUSTUM_VISIBILITY,this),(0,u.watch)((function(){return n.visibleElevationBounds}),(function(){return e._elevationBoundsChange()}))]),"local"===i.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,u.watch)((function(){var e,t,r;return[n.baseOpacity,n.wireframe,null===(e=i.map)||void 0===e||null===(t=e.ground)||void 0===t||null===(r=t.navigationConstraint)||void 0===r?void 0:r.type]}),(function(){return e._updateIsVisibleBelowSurface()}),u.initial)])}},{key:"destroy",value:function(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}},{key:"_setDirty",value:function(){this.updating||this._set("updating",!0)}},{key:"setExtent",value:function(e){this._extent=e,this._extentIntersectionDirty=!0,this._setDirty()}},{key:"_viewChange",value:function(){this._setDirty()}},{key:"_elevationBoundsChange",value:function(){this._setDirty(),this._extentIntersectionDirty=!0}},{key:"_isVisibleBelowSurface",set:function(e){this._isVisibleBelowSurfaceInternal=e,this._setDirty(),this._extentIntersectionDirty=!0}},{key:"_updateIsVisibleBelowSurface",value:function(){var e,t,i=this.graphicsCoreOwner.view,n=i.basemapTerrain,r="local"===i.viewingMode,a="none"===(null===(e=i.map.ground)||void 0===e||null===(t=e.navigationConstraint)||void 0===t?void 0:t.type);this._isVisibleBelowSurface=r||!n.opaque||a}},{key:"_updateExtentIntersection",value:function(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var e,t=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)e=-.3*(0,d.Iu)(t.spatialReference).radius;else{var i=t.basemapTerrain.visibleElevationBounds,n=i.min,r=i.max;e=n-Math.max(1,(r-n)*(1.2-1))}this._extentIntersection.update(this._extent,t.spatialReference,e)}}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),v.J;this._updateExtentIntersection();var t=this.graphicsCoreOwner.view.frustum,i=(0,d.Iu)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(t,i)),e.madeProgress()}}]),i}(o.default);(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"suspended",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],g.prototype,"graphicsCoreOwner",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"updating",void 0),g=(0,l._)([(0,c.j)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],g)},46568:function(e,t,i){i.d(t,{d:function(){return c}});var n,r=i(15671),a=i(43144),s=i(42537),l=(i(93169),i(68401));!function(e){e[e.Object=0]="Object",e[e.RenderGeometry=1]="RenderGeometry",e[e.External=2]="External",e[e.COUNT=3]="COUNT"}(n||(n={}));var o=function(){function e(){(0,r.Z)(this,e),this._items=[]}return(0,a.Z)(e,[{key:"addObject",value:function(e,t){this._items.push({type:n.Object,objectStateId:t,object:e})}},{key:"addRenderGeometry",value:function(e,t,i){this._items.push({type:n.RenderGeometry,objectStateId:t,renderGeometry:e,owner:i})}},{key:"addExternal",value:function(e,t){this._items.push({type:n.External,objectStateId:t,remove:e})}},{key:"remove",value:function(e){for(var t=this._items.length-1;t>=0;--t){var i=this._items[t];i.objectStateId===e&&(u(i),this._items.splice(t,1))}}},{key:"removeObject",value:function(e){for(var t=this._items.length-1;t>=0;--t){var i=this._items[t];i.type===n.Object&&i.object===e&&(u(i),this._items.splice(t,1))}}},{key:"removeRenderGeometry",value:function(e){for(var t=this._items.length-1;t>=0;--t){var i=this._items[t];i.type===n.RenderGeometry&&i.renderGeometry===e&&(u(i),this._items.splice(t,1))}}},{key:"removeAll",value:function(){this._items.forEach((function(e){u(e)})),this._items=[]}}]),e}();function u(e){switch(e.type){case n.Object:e.objectStateId.channel===l.V_.Highlight?e.object.removeHighlight(e.objectStateId):e.objectStateId.channel===l.V_.MaskOccludee&&e.object.removeOcclude(e.objectStateId);break;case n.RenderGeometry:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case n.External:e.remove(e.objectStateId)}}var h=function(){function e(t,i){(0,r.Z)(this,e),this.stateType=t,this.objectIdField=i,this.objectStateSet=new o,this.ids=new Set,this.paused=!1}return(0,a.Z)(e,[{key:"hasGraphic",value:function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}]),e}(),c=function(){function e(t){(0,r.Z)(this,e),this._graphicsCore=t,this._stateSets=new Array}return(0,a.Z)(e,[{key:"destroy",value:function(){this.reset(),this._stateSets=null}},{key:"reset",value:function(){this._stateSets&&(this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets.length=0)}},{key:"acquireSet",value:function(e,t){var i=this,n=new h(e,t);this._stateSets.push(n);var r=(0,s.kB)((function(){return i.releaseSet(n)}));return{set:n,handle:r}}},{key:"releaseSet",value:function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}},{key:"setUid",value:function(e,t){e.ids.add(t);var i=this._graphicsCore.graphics3DGraphics.get(t);i&&d(i,e)}},{key:"setUids",value:function(e,t){var i=this;t.forEach((function(t){return i.setUid(e,t)}))}},{key:"setObjectIds",value:function(e,t){t.forEach((function(t){return e.ids.add(t)})),this._initializeSet(e)}},{key:"addGraphic",value:function(e){this._stateSets.forEach((function(t){!t.paused&&t.hasGraphic(e)&&d(e,t)}))}},{key:"removeGraphic",value:function(e){this._stateSets.forEach((function(t){t.hasGraphic(e)&&function(e,t){e.removeObjectState(t.objectStateSet)}(e,t)}))}},{key:"allGraphicsDeleted",value:function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))}},{key:"_initializeSet",value:function(e){var t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach((function(t){t&&e.hasGraphic(t)&&d(t,e)})):e.ids.forEach((function(i){var n=t.get(i);n&&d(n,e)}))}},{key:"test",get:function(){}}]),e}();function d(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}},59453:function(e,t,i){i.d(t,{c:function(){return b}});var n=i(15671),r=i(43144),a=i(60136),s=i(29388),l=i(27366),o=i(7138),u=i(32718),h=i(49861),c=(i(93169),i(84936),i(69912)),d=i(46634),p=i(77258),y=i(65156),v=i(70446),g=i(69787),f=i(93463),_=i(73553),b=function(e){(0,a.Z)(i,e);var t=(0,s.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e))._scaleRangeActive=!1,r._layerScaleRangeVisibilityQuery=!1,r._extent=null,r._updatingHandles=new d.R,r.graphicsCoreOwner=null,r.layer=null,r.queryGraphicUIDsInExtent=null,r.graphicsCore=null,r.basemapTerrain=null,r.layerScaleEnabled=!0,r.suspended=!1,r._dirty=!0,r}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this;this.updateScaleRangeActive();var t=this.graphicsCoreOwner.view.resourceController.scheduler;this.addHandles(t.registerTask(f.T8.SCALE_VISIBILITY,this)),this._updatingHandles.add((function(){return e.layer.effectiveScaleRange}),(function(){return e.layerMinMaxScaleChangeHandler()}))}},{key:"destroy",value:function(){this._updatingHandles.destroy(),this.removeHandles(),this._dirty=!1,this._extent=null,this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null,this.basemapTerrain=null}},{key:"updating",get:function(){return this._dirty||this._updatingHandles.updating}},{key:"_setDirty",value:function(){this._dirty=!0}},{key:"setExtent",value:function(e){var t=this.graphicsCoreOwner.view.spatialReference,i=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(t===i)this._extent=null!==e&&void 0!==e?e:null;else{var n=(0,y.Ue)();(0,p.d)(e,t,n,i)?this._extent=n:this._extent=null}this._setDirty()}},{key:"scaleRangeActive",value:function(){return this._scaleRangeActive}},{key:"updateScaleRangeActive",value:function(){var e=this,t=this.layer,i=t.effectiveScaleRange,n=this.layerScaleEnabled&&null!=i&&m(i.minScale,i.maxScale);t.labelingInfo&&!n&&(n=t.labelingInfo.some((function(e){var t,i;return e&&m(null!==(t=e.minScale)&&void 0!==t?t:0,null!==(i=e.maxScale)&&void 0!==i?i:0)})));var r=this._scaleRangeActive!==n;return this._scaleRangeActive=n,n&&!this.hasHandles(C)&&this.basemapTerrain?(this.addHandles(this.basemapTerrain.on("scale-change",(function(t){return e._scaleUpdateHandler(t)})),C),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",(function(){return e._setDirty()})),C)):!n&&this.hasHandles(C)&&this.removeHandles(C),r}},{key:"running",get:function(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}},{key:"runTask",value:function(e){var t=this,i=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&i&&i.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return _.J;this._layerScaleRangeVisibilityQuery=!0;var n=this.layer.effectiveScaleRange,r=n.minScale,a=n.maxScale;i.queryVisibleScaleRange(this._extent,r,a,(function(e){return t._finishUpdate(e)}))}else this._finishUpdate(!0);e.madeProgress()}},{key:"_finishUpdate",value:function(e){this._layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e),this._dirty=!1}},{key:"_visibleAtLayerScale",value:function(e){var t=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||(0,g.rs)(e,t.minScale||0,t.maxScale||0)}},{key:"_visibleAtLabelScale",value:function(e,t){return(0,g.rs)(e,t.minScale||0,t.maxScale||0)}},{key:"_graphicScale",value:function(e){var t;return null!=e.centroid?t=e.centroid:null!=e.graphic.geometry&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(t):1:null}},{key:"_graphicVisible",value:function(e){if(!this.layerScaleEnabled)return!0;var t=this._graphicScale(e);return this._visibleAtLayerScale(t)}},{key:"updateVisibility",value:function(e){if(this._scaleRangeActive){var t=this._graphicVisible(e);return e.setVisibilityFlag(v.E.GRAPHIC,v.P.SCALE_RANGE,t)}return!1}},{key:"updateGraphicLabelScaleVisibility",value:function(e){var t,i;if(!this._scaleRangeActive)return!1;if(!e.labelLayers||0===e.labelLayers.length)return!1;var n=this._graphicScale(e),r=this._updateLabelScaleVisibility(e,n);return r&&(null!==(t=this.graphicsCore.deconflictor)&&void 0!==t&&t.setDirty(),null!==(i=this.graphicsCore.labeler)&&void 0!==i&&i.setDirty()),r}},{key:"_updateLabelScaleVisibility",value:function(e,t){if(!e.labelLayers||0===e.labelLayers.length)return!1;var i=e.labelLayers[0]._labelClass;if(null!=(null===i||void 0===i?void 0:i.minScale)&&null!=i.maxScale){var n=this._visibleAtLabelScale(t,i);if(e.setVisibilityFlag(v.E.LABEL,v.P.SCALE_RANGE,n))return!0}return!1}},{key:"_scaleUpdateHandler",value:function(e){var t,i,n=this;if(this._setDirty(),this.graphicsCore.visible){var r=e.extent,a=e.scale,s=this._visibleAtLayerScale(a),l=!1,o=this.graphicsCoreOwner.view.spatialReference,h=e.spatialReference;if(null!=h){var c=!h.equals(o);if(!c||(0,p.d)(r,h,S,o)){var d=c?S:r;this.queryGraphicUIDsInExtent(d,o,(function(e){var t=n.graphicsCore.getGraphics3DGraphicById(e);if(null!=t){var i=t.centroid;null!=i&&(r[0]>i.x||r[1]>i.y||r[2]<i.x||r[3]<i.y)||(t.setVisibilityFlag(v.E.GRAPHIC,v.P.SCALE_RANGE,s)&&(l=!0),n._updateLabelScaleVisibility(t,a)&&(l=!0))}})),l&&(null!==(t=this.graphicsCore.deconflictor)&&void 0!==t&&t.setDirty(),null===(i=this.graphicsCore.labeler)||void 0===i||i.setDirty())}else u.Z.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from "+h+" to wkid "+o)}else u.Z.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles")}}},{key:"layerMinMaxScaleChangeHandler",value:function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities((function(e){return e.setVisibilityFlag(v.E.GRAPHIC,v.P.SCALE_RANGE,!0)})):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility(),this._setDirty()}}]),i}(o.default);function m(e,t){return e>0||t>0}(0,l._)([(0,h.Cb)()],b.prototype,"graphicsCoreOwner",void 0),(0,l._)([(0,h.Cb)()],b.prototype,"layer",void 0),(0,l._)([(0,h.Cb)()],b.prototype,"queryGraphicUIDsInExtent",void 0),(0,l._)([(0,h.Cb)()],b.prototype,"graphicsCore",void 0),(0,l._)([(0,h.Cb)()],b.prototype,"basemapTerrain",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],b.prototype,"layerScaleEnabled",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],b.prototype,"suspended",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],b.prototype,"updating",null),(0,l._)([(0,h.Cb)()],b.prototype,"_dirty",void 0),b=(0,l._)([(0,c.j)("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],b);var C="terrain-events",S=(0,y.Ue)()},46281:function(e,t,i){i.d(t,{J:function(){return a}});var n=i(43144),r=i(15671),a=(0,n.Z)((function e(t,i,n){(0,r.Z)(this,e),this.visible=t,this.missing=i,this.pending=n}))},24405:function(e,t,i){i.d(t,{V5:function(){return u},e7:function(){return l},zc:function(){return h}});var n=i(74165),r=i(93433),a=i(15861),s=i(37270);function l(e){return o.apply(this,arguments)}function o(){return o=(0,a.Z)((0,n.Z)().mark((function e(t){var i,a,l,o,u,h,c,d,p,y,v,g=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(l=g.length>1&&void 0!==g[1]?g[1]:t.popupTemplate)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,l.getRequiredFields(t.fieldsIndex);case 5:if(o=e.sent,u=l.lastEditInfoEnabled,h=t.objectIdField,c=t.typeIdField,d=t.globalIdField,p=t.relationships,!o.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:return y=u?(0,s.CH)(t):[],v=(0,s.Q0)(t.fieldsIndex,[].concat((0,r.Z)(o),(0,r.Z)(y))),e.abrupt("return",(c&&v.push(c),v&&h&&null!==(i=t.fieldsIndex)&&void 0!==i&&i.has(h)&&!v.includes(h)&&v.push(h),v&&d&&null!==(a=t.fieldsIndex)&&void 0!==a&&a.has(d)&&!v.includes(d)&&v.push(d),p&&p.forEach((function(e){var i,n=e.keyField;v&&n&&(null===(i=t.fieldsIndex)||void 0===i?void 0:i.has(n))&&!v.includes(n)&&v.push(n)})),v));case 15:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function u(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function h(e,t){return null!=u(e,{defaultPopupTemplateEnabled:t})}}}]);
//# sourceMappingURL=50489.3c022e3c.chunk.js.map