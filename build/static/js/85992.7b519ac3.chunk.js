"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[85992],{47991:function(e,t,r){r.d(t,{SR:function(){return y},Ui:function(){return f}});var i=r(43144),n=r(15671),s=r(37762),a=r(29439),u=r(46784),o=r(65156),h=r(376),c=r(69662),l=r(77981),d=r(76335),p=r(92975);function f(e){return v(e,!0)}function y(e){return v(e,!1)}function v(e,t){if(null==e)return null;var r=e.spatialReference,i=(0,p.C5)(r),n=(0,u.AK)(e)?e.toJSON():e;if(!i)return n;var s=(0,p.sS)(r)?102100:4326,a=d.UZ[s].maxX,o=d.UZ[s].minX;if((0,l.wp)(n))return _(n,a,o);if((0,l.aW)(n))return n.points=n.points.map((function(e){return _(e,a,o)})),n;if((0,l.YX)(n))return m(n,i);if((0,l.oU)(n)||(0,l.l9)(n)){var c=(0,h.$P)(I,n),f={xmin:c[0],ymin:c[1],xmax:c[2],ymax:c[3]},y=(0,d.XZ)(f.xmin,o)*(2*a),v=0===y?n:(0,d.Sy)(n,y);return f.xmin+=y,f.xmax+=y,f.xmax>a?k(v,a,t):f.xmin<o?k(v,o,t):v}return n}function m(e,t){if(!t)return e;var r=function(e,t){var r=[],i=e.ymin,n=e.ymax,s=e.xmin,u=e.xmax,o=e.xmax-e.xmin,h=(0,a.Z)(t.valid,2),c=h[0],l=h[1],d=g(e.xmin,t),p=d.x,f=d.frameId,y=g(e.xmax,t),v=y.x,m=y.frameId,_=p===v&&o>0;if(o>2*l){var x={xmin:s<u?p:v,ymin:i,xmax:l,ymax:n},k={xmin:c,ymin:i,xmax:s<u?v:p,ymax:n},I={xmin:0,ymin:i,xmax:l,ymax:n},Z={xmin:c,ymin:i,xmax:0,ymax:n},S=[],T=[];b(x,I)&&S.push(f),b(x,Z)&&T.push(f),b(k,I)&&S.push(m),b(k,Z)&&T.push(m);for(var R=f+1;R<m;R++)S.push(R),T.push(R);r.push(new w(x,[f]),new w(k,[m]),new w(I,S),new w(Z,T))}else p>v||_?r.push(new w({xmin:p,ymin:i,xmax:l,ymax:n},[f]),new w({xmin:c,ymin:i,xmax:v,ymax:n},[m])):r.push(new w({xmin:p,ymin:i,xmax:v,ymax:n},[f]));return r}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}function _(e,t,r){if(Array.isArray(e)){var i=e[0];if(i>t){var n=(0,d.XZ)(i,t);e[0]=i+n*(-2*t)}else if(i<r){var s=(0,d.XZ)(i,r);e[0]=i+s*(-2*r)}}else{var a=e.x;if(a>t){var u=(0,d.XZ)(a,t);e.x+=u*(-2*t)}else if(a<r){var o=(0,d.XZ)(a,r);e.x+=o*(-2*r)}}return e}function g(e,t){var r,i=(0,a.Z)(t.valid,2),n=i[0],s=i[1],u=2*s,o=0;return e>s?(e-=(r=Math.ceil(Math.abs(e-s)/u))*u,o=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/u))*u,o=-r),{x:e,frameId:o}}function b(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,s=t.ymax;return x(e,r,i)&&x(e,r,s)&&x(e,n,s)&&x(e,n,i)}function x(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function k(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(0,l.l9)(e);if(i&&(0,c.Zy)(e),r)return(new Z).cut(e,t);for(var n=i?e.rings:e.paths,a=i?4:2,u=n.length,o=-2*t,h=0;h<u;h++){var d=n[h];if(d&&d.length>=a){var p,f=[],y=(0,s.Z)(d);try{for(y.s();!(p=y.n()).done;){var v=p.value;f.push([v[0]+o,v[1]])}}catch(m){y.e(m)}finally{y.f()}n.push(f)}}return i?e.rings=n:e.paths=n,e}var w=(0,i.Z)((function e(t,r){(0,n.Z)(this,e),this.extent=t,this.frameIds=r})),I=(0,o.Ue)(),Z=function(){function e(){(0,n.Z)(this,e),this._linesIn=[],this._linesOut=[]}return(0,i.Z)(e,[{key:"cut",value:function(e,t){var r;if(this._xCut=t,e.rings)this._closed=!0,r=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,r=e.paths,this._minPts=2}var i,n=(0,s.Z)(r);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a&&!(a.length<this._minPts)){var u,o=!0,h=(0,s.Z)(a);try{for(h.s();!(u=h.n()).done;){var c=u.value;o?(this.moveTo(c),o=!1):this.lineTo(c)}}catch(b){h.e(b)}finally{h.f()}this._closed&&this.close()}}}catch(b){n.e(b)}finally{n.f()}this._pushLineIn(),this._pushLineOut(),r=[];var l,d=(0,s.Z)(this._linesIn);try{for(d.s();!(l=d.n()).done;){var p=l.value;p&&p.length>=this._minPts&&r.push(p)}}catch(b){d.e(b)}finally{d.f()}var f,y=-2*this._xCut,v=(0,s.Z)(this._linesOut);try{for(v.s();!(f=v.n()).done;){var m=f.value;if(m&&m.length>=this._minPts){var _,g=(0,s.Z)(m);try{for(g.s();!(_=g.n()).done;){_.value[0]+=y}}catch(b){g.e(b)}finally{g.f()}r.push(m)}}}catch(b){v.e(b)}finally{v.f()}return this._closed?e.rings=r:e.paths=r,e}},{key:"moveTo",value:function(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}},{key:"lineTo",value:function(e){var t=this._side(e[0]);if(t*this._prevSide==-1){var r=this._intersect(this._prevPt,e);this._lineTo(this._xCut,r,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}},{key:"close",value:function(){var e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}},{key:"_moveTo",value:function(e,t,r){this._closed?(this._lineIn.push([r<=0?e:this._xCut,t]),this._lineOut.push([r>=0?e:this._xCut,t])):(r<=0&&this._lineIn.push([e,t]),r>=0&&this._lineOut.push([e,t]))}},{key:"_lineTo",value:function(e,t,r){this._closed?(S(this._lineIn,r<=0?e:this._xCut,t),S(this._lineOut,r>=0?e:this._xCut,t)):r<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):r>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}},{key:"_checkClosingPt",value:function(e){var t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}},{key:"_side",value:function(e){return e<this._xCut?-1:e>this._xCut?1:0}},{key:"_intersect",value:function(e,t){var r=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+r*(t[1]-e[1])}},{key:"_pushLineIn",value:function(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}},{key:"_pushLineOut",value:function(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}]),e}();function S(e,t,r){var i=e.length;i>1&&e[i-1][0]===t&&e[i-2][0]===t?e[i-1][1]=r:e.push([t,r])}},85992:function(e,t,r){r.d(t,{Z:function(){return pe}});var i=r(1413),n=r(74165),s=r(15861),a=r(37762),u=r(97326),o=r(60136),h=r(29388),c=r(93433),l=r(15671),d=r(43144),p=r(27366),f=r(7138),y=r(63780),v=r(93169),m=r(79056),_=r(92026),g=r(66978),b=r(94172),x=r(49861),k=(r(32718),r(69912)),w=r(65156),I=r(77981),Z=r(52410),S=r(78915),T=r(26707),R=r(61574),C=r(94109),M=r(77537),G=r(71942),O=r(9940),U=r(7326),P=r(88562);function z(e,t,r){return A.apply(this,arguments)}function A(){return A=(0,s.Z)((0,n.Z)().mark((function e(t,r,i){var s,u,o,h,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],u={scaleInfo:(0,P.UX)(t),scaleExpression:null},o=(0,a.Z)(r),e.prev=2,o.s();case 4:if((h=o.n()).done){e.next=18;break}l=h.value,e.t0=l.type,e.next="marker"===e.t0?9:"fill"===e.t0?11:"line"===e.t0?13:"text"===e.t0?15:16;break;case 9:return s.push.apply(s,(0,c.Z)((0,P.zw)(i.instances.marker,l,U.Jh,u))),e.abrupt("break",16);case 11:return null==l.spriteRasterizationParam?s.push.apply(s,(0,c.Z)((0,P.U9)(i.instances.fill,l,u))):s.push.apply(s,(0,c.Z)((0,P.ep)(i.instances.complexFill,l,!1,u))),e.abrupt("break",16);case 13:return l.spriteRasterizationParam?s.push.apply(s,(0,c.Z)((0,P.cs)(i.instances.texturedLine,l,!1,u))):s.push.apply(s,(0,c.Z)((0,P.KR)(i.instances.line,l,!1,u))),e.abrupt("break",16);case 15:s.push.apply(s,(0,c.Z)((0,P.QA)(i.instances.text,l,U.Jh,u)));case 16:e.next=4;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(2),o.e(e.t1);case 23:return e.prev=23,o.f(),e.finish(23);case 26:return e.abrupt("return",s);case 27:case"end":return e.stop()}}),e,null,[[2,20,23,26]])}))),A.apply(this,arguments)}var F=r(71873),q=r(96945),E=r(92186),j=r(67654),V=r(88301),D=r(61120),L=r(4954),X=r(83406),W=r(80457),H=function(e){(0,o.Z)(r,e);var t=(0,h.Z)(r);function r(e,i,n){var s;(0,l.Z)(this,r),(s=t.call(this,n))._items=e,s._tile=i,s._index=-1,s._cachedGeometry=null;var a=i.lod;return a.wrap&&(s._wrappingInfo={worldSizeX:a.worldSize[0]}),s}return(0,d.Z)(r,[{key:"_current",get:function(){return this._items[this._index]}},{key:"getItem",value:function(){return this._current}},{key:"getZOrder",value:function(){return this._current.zOrder}},{key:"getMeshWriters",value:function(){var e,t;return null!==(e=null===(t=this._current.symbolResource)||void 0===t?void 0:t.symbolInfo.meshWriters)&&void 0!==e?e:[]}},{key:"hasField",value:function(e){return null!=this._current.attributes[e]}},{key:"field",value:function(e){return this.readAttribute(e)}},{key:"geometryType",get:function(){var e=(0,I.Ji)(this._current.geometry);return"esriGeometryPoint"===e?"esriGeometryMultipoint":e}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var e=new r(this._items,this._tile,this.metadata);return this.copyInto(e),e}},{key:"copyInto",value:function(e){(0,V.Z)((0,D.Z)(r.prototype),"copyInto",this).call(this,e),e._cachedGeometry=this._cachedGeometry,e._index=this._index}},{key:"fields",get:function(){throw new Error("Fields reading not supported to graphics.")}},{key:"hasFeatures",get:function(){return!!this._items.length}},{key:"hasNext",get:function(){return this._index+1<this._items.length}},{key:"exceededTransferLimit",get:function(){throw new Error("InternalError: exceededTransferLimit not implemented for graphics.")}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}},{key:"getInTransform",value:function(){return this._tile.transform}},{key:"getSize",value:function(){return this._items.length}},{key:"getAttributeHash",value:function(){var e="";for(var t in this._current.attributes)e+=this._current.attributes[t];return e}},{key:"getObjectId",value:function(){return this._items[this._index].objectId}},{key:"getDisplayId",value:function(){return this._current.displayId}},{key:"setDisplayId",value:function(e){throw new Error("InternalError: Setting displayId not supported for graphics.")}},{key:"setIndex",value:function(e){this._index=e}},{key:"getIndex",value:function(){return this._index}},{key:"next",value:function(){for(this._cachedGeometry=null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}},{key:"readGeometryArea",value:function(){throw new Error("InternalError: readGeometryArea not supported for graphics.")}},{key:"_readGeometry",value:function(){if(!this._cachedGeometry){var e=(0,X.GH)(this._current.projectedGeometry,this.hasZ,this.hasM);if("esriGeometryPolyline"===this.geometryType&&(e=(0,X.zj)(new W.Z,e,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0])),this._cachedGeometry=(0,X.Nh)(new W.Z,e,this.hasZ,this.hasM,this.geometryType,this._tile.transform),!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}},{key:"_wrapGeometry",value:function(e){if(this._wrappingInfo){var t=this._wrappingInfo.worldSizeX;if(e.isPoint)return 1===t?(e.coords.push(C.i9,0),e.coords.push(2*-C.i9,0),void e.lengths.push(3)):2===t?(e.coords.push(2*C.i9,0),e.coords.push(4*-C.i9,0),void e.lengths.push(3)):void this._wrapVertex(e.coords,0,2,t);if("esriGeometryMultipoint"!==this.geometryType);else{if(1===t){var r,i=e.coords.slice();i[0]-=512;var n=e.coords.slice();n[0]+=512,(r=e.coords).push.apply(r,(0,c.Z)(i).concat((0,c.Z)(n)));var s=e.lengths[0];return void e.lengths.push(s,s)}this._wrapVertex(e.coords,0,2,t)}}}},{key:"_wrapVertex",value:function(e,t,r,i){var n=t*r,s=e[n];s<-C.i9*(i-2)?e[n]=s+C.i9*i:s>C.i9*(i-1)&&(e[n]=s-C.i9*i)}},{key:"_readX",value:function(){var e=this._readGeometry();return null!=e?e.coords[0]:0}},{key:"_readY",value:function(){var e=this._readGeometry();return null!=e?e.coords[1]:0}},{key:"_readServerCentroid",value:function(){switch(this.geometryType){case"esriGeometryPolygon":var e=(0,L.tO)(this._current.projectedGeometry),t=new W.Z([],e);return(0,X.Nh)(new W.Z,t,this.hasZ,this.hasM,this.geometryType,this._tile.transform);case"esriGeometryPolyline":var r=this._current.projectedGeometry,i=(0,L.a)(r.paths,this.hasZ),n=new W.Z([],i);return(0,X.Nh)(new W.Z,n,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}return null}},{key:"_readAttribute",value:function(e,t){var r=this._current.attributes[e];if(void 0!==r)return r;var i=e.toLowerCase();for(var n in this._current.attributes)if(n.toLowerCase()===i)return this._current.attributes[n]}},{key:"_readAttributes",value:function(){return this._current.attributes}}],[{key:"from",value:function(e,t,i){return new r(e,t,i)}}]),r}(r(92010).s),N=r(29439),B=r(17842),Y=r(31581),J=r(376),Q=r(91340),$=r(92975),K=r(28222),ee=r(69662),te=r(47991),re=r(19995),ie=r(95857),ne=function(){function e(t,r,i,n,s,a,u){(0,l.Z)(this,e),this.geometry=t,this.symbol=r,this.attributes=i,this.visible=n,this.objectId=s,this.zOrder=a,this.displayId=u,this.bounds=(0,w.Ue)(),this.prevBounds=(0,w.Ue)(),this.size=[0,0,0,0]}return(0,d.Z)(e,[{key:"linearCIM",get:function(){var e;return null===(e=this.symbolResource)||void 0===e?void 0:e.symbolInfo.linearCIM}},{key:"update",value:function(e,t,r){return(this.geometry!==e.geometry||JSON.stringify(this.attributes)!==JSON.stringify(e.attributes)||this.symbol!==t||this.zOrder!==r||this.visible!==e.visible)&&(this.prevBounds=this.bounds,this.bounds=(0,w.Ue)(),this.zOrder=r,this.geometry=e.geometry,this.attributes=(0,i.Z)({},e.attributes),this.symbol=t,this.visible=e.visible,this.symbolResource=null,this.projectedGeometry=null,!0)}},{key:"projectAndNormalize",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var r,i,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.geometry)&&r.spatialReference&&"mesh"!==r.type){e.next=3;break}return e.abrupt("return");case 3:return"extent"===r.type&&(r=(0,ie.XA)(r)),e.next=6,(0,re._W)(r.spatialReference,t);case 6:if(i=(0,te.SR)(r)){e.next=9;break}return e.abrupt("return");case 9:(s=(0,re.iV)(i,r.spatialReference,t))&&(0,ee.pW)(s),this.projectedGeometry=(0,I.YX)(s)?(0,ie.XA)(s):s;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fromGraphic",value:function(t,r,n,s){return new e(t.geometry,r,(0,i.Z)({},t.attributes),t.visible,t.uid,n,s)}}]),e}(),se=function(){function e(t,r,i){(0,l.Z)(this,e),this.added=t,this.updated=r,this.removed=i}return(0,d.Z)(e,[{key:"hasAnyUpdate",value:function(){return!!(this.added.length||this.updated.length||this.removed.length)}}]),e}(),ae=1e-5;function ue(e,t){return t.zOrder-e.zOrder}var oe=function(){function e(t,r,i,n,s){(0,l.Z)(this,e),this._items=new Map,this._boundsDirty=!1,this._outSpatialReference=t,this._cimResourceManager=r,this._hittestDrawHelper=new K.Tu(r),this._tileInfoView=i,this._store=s;var a=i.getClosestInfoForScale(n);this._resolution=this._tileInfoView.getTileResolution(a.level)}return(0,d.Z)(e,[{key:"items",value:function(){return this._items.values()}},{key:"getItem",value:function(e){return this._items.get(e)}},{key:"update",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,r,i){var s,u,o,h,c,l,d,p,f,y,v,m,_,g,b,x,k,w,I;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=[],u=[],o=[],h=new Set,c=[],l=0,d=(0,a.Z)(t.items),e.prev=3,d.s();case 5:if((p=d.n()).done){e.next=16;break}if(f=p.value,l++,y=f.uid,v=this._items.get(y),m=r(f),h.add(y),!v){e.next=12;break}return v.update(f,m,l)&&(u.push(v),c.push(this._updateItem(v,i))),e.abrupt("continue",14);case 12:_=this._store.createDisplayIdForObjectId(y),g=ne.fromGraphic(f,m,l,_),c.push(this._updateItem(g,i)),this._items.set(g.objectId,g),s.push(g);case 14:e.next=5;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),d.e(e.t0);case 21:return e.prev=21,d.f(),e.finish(21);case 24:b=(0,a.Z)(this._items.entries());try{for(b.s();!(x=b.n()).done;)k=(0,N.Z)(x.value,2),w=k[0],I=k[1],h.has(w)||(this._store.releaseDisplayIdForObjectId(w),this._items.delete(w),o.push(I))}catch(n){b.e(n)}finally{b.f()}return e.next=28,Promise.all(c);case 28:return this._index=null,e.abrupt("return",new se(s,u,o));case 30:case"end":return e.stop()}}),e,this,[[3,18,21,24]])})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"updateLevel",value:function(e){this._resolution!==e&&(this._index=null,this._boundsDirty=!0,this._resolution=e)}},{key:"hitTest",value:function(e,t,r,i,n){var s=(0,v.Z)("esri-mobile"),u=s?C.wN:C.S3,o=u+(s?0:C.pd);e=(0,Q.or)(e,this._tileInfoView.spatialReference);var h=i*window.devicePixelRatio*o,c=(0,w.Ue)();c[0]=e-h,c[1]=t-h,c[2]=e+h,c[3]=t+h;var l=i*window.devicePixelRatio*u,d=(0,w.Ue)();d[0]=e-l,d[1]=t-l,d[2]=e+l,d[3]=t+l;var p=.5*i*(o+ie.OC),f=this._searchIndex(e-p,t-p,e+p,t+p);if(!f||0===f.length)return[];var y,m=[],_=(0,w.Ue)(),g=(0,w.Ue)(),b=(0,a.Z)(f);try{for(b.s();!(y=b.n()).done;){var x=y.value;if(x.visible){var k=x.projectedGeometry,I=x.symbolResource;this._getSymbolBounds(_,I,k,g,n),g[3]=g[2]=g[1]=g[0]=0,(0,w.kK)(_,c)&&m.push(x)}}}catch(z){b.e(z)}finally{b.f()}if(0===m.length)return[];for(var Z=this._hittestDrawHelper,S=[],T=0,R=m;T<R.length;T++){var M=R[T],G=M.projectedGeometry,O=M.symbolResource;if(O){var U=O.textInfo,P=O.symbolInfo.cimSymbol;Z.hitTest(d,P.symbol,G,U,n,i)&&S.push(M)}}return S.sort(ue),S.map((function(e){return e.objectId}))}},{key:"queryItems",value:function(e){return 0===this._items.size?[]:this._searchForItems(e)}},{key:"clear",value:function(){this._items.clear(),this._index=null}},{key:"_updateItem",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.projectAndNormalize(this._outSpatialReference);case 2:return e.next=4,r(t);case 4:(i=t.size)[0]=i[1]=i[2]=i[3]=0,this._getSymbolBounds(t.bounds,t.symbolResource,t.projectedGeometry,t.size,0);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_searchIndex",value:function(e,t,r,i){var n=this;return this._boundsDirty&&(this._items.forEach((function(e){return n._getSymbolBounds(e.bounds,e.symbolResource,e.projectedGeometry,e.size,0)})),this._boundsDirty=!1),this._index||(this._index=(0,Y.r)(9,(function(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}})),this._index.load(Array.from(this._items.values()))),this._index.search({minX:e,minY:t,maxX:r,maxY:i})}},{key:"_searchForItems",value:function(e){var t=this._tileInfoView.spatialReference,r=e.bounds,i=(0,$.C5)(t);if(i&&t.isWrappable){var n=(0,N.Z)(i.valid,2),s=n[0],a=n[1],u=Math.abs(r[2]-a)<ae,o=Math.abs(r[0]-s)<ae;if((!u||!o)&&(u||o)){var h,l=e.resolution;h=(0,w.Ue)(u?[s,r[1],s+l*ie.OC,r[3]]:[a-l*ie.OC,r[1],a,r[3]]);var d=this._searchIndex(r[0],r[1],r[2],r[3]),p=this._searchIndex(h[0],h[1],h[2],h[3]);return(0,c.Z)(new Set([].concat((0,c.Z)(d),(0,c.Z)(p))))}}return this._searchIndex(r[0],r[1],r[2],r[3])}},{key:"_getSymbolBounds",value:function(e,t,r,i,n){if(!t||!t.symbolInfo.linearCIM||!r)return null;if(e||(e=(0,w.Ue)()),(0,J.$P)(e,r),!i||0===i[0]&&0===i[1]&&0===i[2]&&0===i[3]){var s=t.textInfo,a=t.symbolInfo.cimSymbol;i||(i=[0,0,0,0]);var u=S.bP.getSymbolInflateSize(i,a.symbol,this._cimResourceManager,n,s);i[0]=(0,B.F2)(u[0]),i[1]=(0,B.F2)(u[1]),i[2]=(0,B.F2)(u[2]),i[3]=(0,B.F2)(u[3])}var o=this._resolution,h=S.bP.safeSize(i);return e[0]-=h*o,e[1]-=h*o,e[2]+=h*o,e[3]+=h*o,e}}]),e}(),he=r(10507),ce=r(79004),le=function(){function e(t,r){(0,l.Z)(this,e),this.tile=t,this.metadata=r,this.addedOrModified=[],this.removed=[]}return(0,d.Z)(e,[{key:"reader",get:function(){return this._reader||(this._reader=H.from(this.addedOrModified,this.tile,this.metadata)),this._reader}}],[{key:"getOrCreate",value:function(t,r,i){var n=r.get(t.id);return n||(n=new e(t,i),r.set(t.id,n)),n}},{key:"fromItems",value:function(t,r,i){var n,s=new e(t,i);return(n=s.addedOrModified).push.apply(n,(0,c.Z)(r)),s}}]),e}(),de=function(e){(0,o.Z)(r,e);var t=(0,h.Z)(r);function r(e){var i;return(0,l.Z)(this,r),(i=t.call(this,e))._attached=!1,i._tiles=new Map,i._controller=new AbortController,i._hashToSymbolInfo=new Map,i._lastCleanup=performance.now(),i._cleanupRequired=!0,i.lastUpdateId=-1,i.renderer=null,i._updateTracking=new ce.x({debugName:"GraphicsView2D"}),i.updateRequested=!1,i.defaultPointSymbolEnabled=!0,i._commandQueue=new he.Z({process:function(e){if("update"===e.type)return i._update();throw new Error("InternalError: Unsupported command")}}),i.graphicUpdateHandler=i.graphicUpdateHandler.bind((0,u.Z)(i)),i}return(0,d.Z)(r,[{key:"destroy",value:function(){this.container.destroy(),this.view=null,this.renderer=null,this._set("graphics",null),this._controller.abort(),this._graphicStore.clear(),this._attributeStore=null,this._hashToSymbolInfo.clear(),this._updateTracking.destroy(),this._commandQueue.destroy()}},{key:"_initAttributeStore",value:function(){var e=this;this._storage=new E.O({spatialReference:this.view.spatialReference,fields:new Z.Z}),this._attributeStore=new q.p({isLocal:!0,update:function(t){(0,v.Z)("esri-2d-update-debug")&&console.debug("[Id: ".concat(e.layerId,"] GraphicsView2D.AttributeStoreView.updateStart"),{message:t}),e.container.attributeView.requestUpdate(t),e.container.requestRender(),(0,v.Z)("esri-2d-update-debug")&&console.debug("[Id: ".concat(e.layerId,"] GraphicsView2D.AttributeStoreView.updateEnd"),{message:t})}});var t=(0,F.$F)(null,[]);this._attributeStore.update(t,this._storage,null),this.container.checkHighlight=function(){return e._attributeStore.hasHighlight}}},{key:"initialize",value:function(){var e=this;this._initAttributeStore(),this._metadata=j.m.create(this.view.spatialReference),this._resourceProxy=new O.f({fetch:function(t){return Promise.all(t.map((function(t){return e.view.stage.textureManager.rasterizeItem(t)})))},fetchDictionary:function(e){throw new Error("InternalError: Graphics do not support Dictionary requests")}}),this.addHandles([(0,b.watch)((function(){return e._effectiveRenderer}),(function(){return e._pushUpdate()})),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(function(){e.addHandles([e.graphics.on("change",(function(){return e._pushUpdate()}))]),e._graphicStore=new oe(e.view.spatialReference,e._cimResourceManager,e.view.featuresTilingScheme,e.view.state.scale,e._attributeStore),e._attached=!0,e.requestUpdate(),e._pushUpdate()}))]),this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);var t=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:t,removed:[]})}},{key:"_effectiveRenderer",get:function(){return"function"==typeof this.renderer?this.renderer():this.renderer}},{key:"_cimResourceManager",get:function(){return this.view.stage.textureManager.resourceManager}},{key:"updating",get:function(){var e=!this._attached||this._updateTracking.updating;return(0,v.Z)("esri-2d-log-updating")&&console.log("Updating GraphicsView2D: ".concat(e,"\n  -> attaching ").concat(!this._attached,"\n  -> updateTracking ").concat(this._updateTracking.updating)),e}},{key:"hitTest",value:function(e){if(!this.view||this.view.suspended)return[];var t=this.view.state,r=t.resolution,i=t.rotation,n=this._graphicStore.hitTest(e.x,e.y,2,r,i),s=new Set(n),a=this.graphics.items.reduce((function(e,t){return s.has(t.uid)&&e.set(t.uid,t),e}),new Map);return n.map((function(e){return a.get(e)})).filter(y.pC)}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback()),this.notifyChange("updating")}},{key:"processUpdate",value:function(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"setHighlight",value:function(e){var t,r=[],i=(0,a.Z)(e);try{for(i.s();!(t=i.n()).done;){var n,s=t.value,u=s.objectId,o=s.highlightFlags,h=null===(n=this._graphicStore.getItem(u))||void 0===n?void 0:n.displayId;r.push({objectId:u,highlightFlags:o,displayId:h})}}catch(c){i.e(c)}finally{i.f()}this._attributeStore.setHighlight(r,e),this._pushUpdate()}},{key:"graphicUpdateHandler",value:function(e){this._pushUpdate()}},{key:"update",value:function(e){this.updateRequested=!1,this._attached&&this._graphicStore.updateLevel(e.state.resolution)}},{key:"pushUpdate",value:function(){this._pushUpdate()}},{key:"_pushUpdate",value:function(){(0,g.R8)(this._commandQueue.push({type:"update"}))}},{key:"_update",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(){var t,r,i,s,u,o,h,c,l=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(0,v.Z)("esri-2d-update-debug")&&console.debug("[Id: ".concat(this.layerId,"] GraphicsView._update start")),e.next=4,this._graphicStore.update(this.graphics,(function(e){return l._getSymbolForGraphic(e)}),(function(e){return l._ensureSymbolResource(e)}));case 4:if((t=e.sent).hasAnyUpdate()){e.next=7;break}return e.abrupt("return",void this._attributeStore.sendUpdates());case 7:return t.removed.length&&(this._cleanupRequired=!0),(0,v.Z)("esri-2d-update-debug")&&console.debug("[Id: ".concat(this.layerId,"] GraphicsView updateMessage"),t),r=this._createTileMessages(t),e.next=11,this._fetchResources(r);case 11:this._write(r),i=(0,a.Z)(t.added);try{for(i.s();!(s=i.n()).done;)u=s.value,this._setFilterState(u)}catch(n){i.e(n)}finally{i.f()}o=(0,a.Z)(t.updated);try{for(o.s();!(h=o.n()).done;)c=h.value,this._setFilterState(c)}catch(n){o.e(n)}finally{o.f()}(0,v.Z)("esri-2d-update-debug")&&console.debug("[Id: ".concat(this.layerId,"] GraphicsView sendUpdate"),t),this._attributeStore.sendUpdates(),(0,v.Z)("esri-2d-update-debug")&&console.debug("[Id: ".concat(this.layerId,"] GraphicsView sendUpdate.await"),t),e.next=21;break;case 19:e.prev=19,e.t0=e.catch(0);case 21:this._cleanupSharedResources();case 22:case"end":return e.stop()}}),e,this,[[0,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"_createTileMessages",value:function(e){var t,r=new Map,i=(0,a.Z)(e.added);try{for(i.s();!(t=i.n()).done;){var n,s=t.value,u=this.view.graphicsTileStore.getIntersectingTiles(s.bounds),o=(0,a.Z)(u);try{for(o.s();!(n=o.n()).done;){var h=n.value;le.getOrCreate(h,r,this._metadata).addedOrModified.push(s)}}catch(R){o.e(R)}finally{o.f()}}}catch(R){i.e(R)}finally{i.f()}var c,l=(0,a.Z)(e.updated);try{for(l.s();!(c=l.n()).done;){var d,p=c.value,f=this.view.graphicsTileStore.getIntersectingTiles(p.prevBounds),y=this.view.graphicsTileStore.getIntersectingTiles(p.bounds),v=(0,a.Z)(f);try{for(v.s();!(d=v.n()).done;){var m=d.value;le.getOrCreate(m,r,this._metadata).removed.push(p.displayId)}}catch(R){v.e(R)}finally{v.f()}var _,g=(0,a.Z)(y);try{for(g.s();!(_=g.n()).done;){var b=_.value;le.getOrCreate(b,r,this._metadata).addedOrModified.push(p)}}catch(R){g.e(R)}finally{g.f()}}}catch(R){l.e(R)}finally{l.f()}var x,k=(0,a.Z)(e.removed);try{for(k.s();!(x=k.n()).done;){var w,I=x.value,Z=this.view.graphicsTileStore.getIntersectingTiles(I.bounds),S=(0,a.Z)(Z);try{for(S.s();!(w=S.n()).done;){var T=w.value;le.getOrCreate(T,r,this._metadata).removed.push(I.displayId)}}catch(R){S.e(R)}finally{S.f()}}}catch(R){k.e(R)}finally{k.f()}return Array.from(r.values())}},{key:"_fetchResources",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var r,i,s,u,o,h,c,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(0,a.Z)(t);try{for(r.s();!(i=r.n()).done;)for(s=i.value,u=s.tile,o=s.reader,(0,v.Z)("esri-2d-update-debug")&&console.debug("Id[".concat(this.layerId,"] Tile[").concat(u.id,"] GraphicsView fetchResources"),t),h=o.getCursor();h.next();){c=(0,a.Z)(h.getMeshWriters());try{for(c.s();!(l=c.n()).done;)l.value.enqueueRequest(this._resourceProxy,h,u.createArcadeEvaluationOptions(this.view.timeZone))}catch(n){c.e(n)}finally{c.f()}}}catch(n){r.e(n)}finally{r.f()}return e.next=4,this._resourceProxy.fetchEnqueuedResources();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_write",value:function(e){var t,r=(0,a.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;(0,v.Z)("esri-2d-update-debug")&&console.debug("Id[".concat(this.layerId,"] Tile[").concat(i.tile.id,"] GraphicsView write"),i);var n=this._writeMeshes(i),s=this._tiles.get(i.tile.key);s||(s=this._createFeatureTile(i.tile.key)),(0,v.Z)("esri-2d-update-debug")&&console.debug("Id[".concat(this.layerId,"] Tile[").concat(i.tile.id,"] GraphicsView onTileData"),i),this.container.onTileData(s,{type:"update",modify:n,remove:i.removed,end:!1,attributeEpoch:this._attributeStore.epoch}),this.container.requestRender()}}catch(u){r.e(u)}finally{r.f()}}},{key:"_writeMeshes",value:function(e){for(var t=new G._(e.tile.id),r=e.reader.getCursor();r.next();){t.entityStart(r.getDisplayId(),r.getZOrder());var n,s=(0,a.Z)(r.getMeshWriters());try{for(s.s();!(n=s.n()).done;){n.value.write(t,this._resourceProxy,r,e.tile.createArcadeEvaluationOptions(this.view.timeZone),e.tile.level)}}catch(u){s.e(u)}finally{s.f()}t.entityEnd()}return(0,i.Z)((0,i.Z)({},t.serialize().message),{},{tileId:e.tile.id})}},{key:"_setFilterState",value:function(e){var t=e.displayId,r=this._attributeStore.getHighlightFlags(e.objectId);this._attributeStore.setData(t,0,0,r|(e.visible?C.g3:0))}},{key:"_getSymbolForGraphic",value:function(e){return null!=e.symbol?e.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(e):this._getNullSymbol(e)}},{key:"_ensureSymbolResource",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var r,i,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.symbol){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._getSymbolInfo(t.symbol);case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(i=r.linearCIM.filter((function(e){return"text"===e.type})),!(i.length>0)){e.next=15;break}return e.next=11,this._getTextResources(t,i);case 11:s=e.sent,t.symbolResource={symbolInfo:r,textInfo:s},e.next=16;break;case 15:t.symbolResource={symbolInfo:r};case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getSymbolInfo",value:function(e){var t=e.hash();return this._hashToSymbolInfo.has(t)||this._hashToSymbolInfo.set(t,this._createSymbolInfo(t,e).catch((function(e){return null}))),this._hashToSymbolInfo.get(t)}},{key:"_createSymbolInfo",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,r){var i,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._convertToCIMSymbol(r);case 2:return i=e.sent,e.next=5,this._createLinearCIM(i);case 5:return s=e.sent,e.t0=t,e.t1=i,e.t2=s,e.next=11,this._createMeshWriters(i,s);case 11:return e.t3=e.sent,e.abrupt("return",{hash:e.t0,cimSymbol:e.t1,linearCIM:e.t2,meshWriters:e.t3});case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_convertToCIMSymbol",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("web-style"!==(r=(0,S.rW)(t)).type){e.next=5;break}return e.next=4,r.fetchCIMSymbol();case 4:return e.abrupt("return",e.sent.data);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createLinearCIM",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(S.B$.fetchResources(t.symbol,this._cimResourceManager,[]));case 2:return e.abrupt("return",this.view.stage.cimAnalyzer.analyzeSymbolReference(t,!1));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createMeshWriters",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,r){var i,s,a,u=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,g.k_)(this._controller.signal),i=this.container.instanceStore,s=this.view.stage.meshWriterRegistry,e.next=5,z(t,r,i);case 5:return a=e.sent,e.abrupt("return",Promise.all(a.map((function(e){return s.createMeshWriter(u._storage,u._resourceProxy,{tileInfo:u.view.featuresTilingScheme.tileInfo},e)}))));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_onTileUpdate",value:function(e){if(e.added&&e.added.length>0){var t,r=(0,a.Z)(e.added);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._updateTracking.addPromise(this._addTile(i))}}catch(o){r.e(o)}finally{r.f()}}if(e.removed&&e.removed.length>0){var n,s=(0,a.Z)(e.removed);try{for(s.s();!(n=s.n()).done;){var u=n.value;this._removeTile(u.key)}}catch(o){s.e(o)}finally{s.f()}}}},{key:"_createFeatureTile",value:function(e){var t=this.view.featuresTilingScheme.getTileBounds((0,w.Ue)(),e),r=this.view.featuresTilingScheme.getTileResolution(e.level),i=new M.$(e,r,t[0],t[3]);return this._tiles.set(e,i),this.container.addChild(i),i}},{key:"_addTile",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var r,i,s,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._attached){e.next=2;break}return e.abrupt("return");case 2:if((r=this._graphicStore.queryItems(t)).length){e.next=5;break}return e.abrupt("return");case 5:return i=this._createFeatureTile(t.key),s=le.fromItems(t,r,this._metadata),e.next=8,this._fetchResources([s]);case 8:a=this._writeMeshes(s),i.onMessage({type:"append",append:a,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_removeTile",value:function(e){if(this._tiles.has(e)){var t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}}},{key:"_getNullSymbol",value:function(e){var t=e.geometry;return(0,I.l9)(t)?R.mW:(0,I.oU)(t)||(0,I.YX)(t)?R.kD:this.defaultPointSymbolEnabled?R.G:null}},{key:"_getTextResources",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,r){var i,s,a,u,o,h,c,l,d,p=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=new Array,s=new Array,a=function(e){var n=r[e],a=n.textRasterizationParam,u=a.resource,o=a.overrides;if((null===o||void 0===o?void 0:o.length)>0){var h=T.E.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:o,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:u.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:u.symbol,textString:u.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},t,p.view.spatialReference,null,(0,I.Ji)(t.projectedGeometry),null,null);h.then((function(e){var t=e.symbolLayers[0].markerGraphics[0].textString;s.push({type:"cim-rasterization-info",resource:{type:"text",textString:t||"",font:u.font}}),n.text=u.textString=t||""})),i.push(h)}else s.push({type:"cim-rasterization-info",resource:u})},u=0;u<r.length;u++)a(u);if(e.t0=i.length>0,!e.t0){e.next=7;break}return e.next=7,Promise.all(i);case 7:return o=s.map((function(e){return p.view.stage.textureManager.rasterizeItem(e)})),e.next=10,Promise.all(o);case 10:for(h=e.sent,(0,_.O3)(h),c=new Map,l=0;l<r.length;l++)d=r[l],c.set(d.textRasterizationParam.resource.symbol,{text:d.text,glyphMosaicItems:h[l]});return e.abrupt("return",c);case 15:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_cleanupSharedResources",value:function(){if(this._cleanupRequired){var e=performance.now();if(!(e-this._lastCleanup<5e3)){this._cleanupRequired=!1,this._lastCleanup=e;var t,r=new Set,i=(0,a.Z)(this._graphicStore.items());try{for(i.s();!(t=i.n()).done;){var n,s=null===(n=t.value.symbolResource)||void 0===n?void 0:n.symbolInfo.hash;r.add(s)}}catch(l){i.e(l)}finally{i.f()}var u,o=new Set(this._hashToSymbolInfo.keys()),h=(0,a.Z)(o.values());try{for(h.s();!(u=h.n()).done;){var c=u.value;r.has(c)||this._hashToSymbolInfo.delete(c)}}catch(l){h.e(l)}finally{h.f()}}}}}]),r}((0,m.IG)(f.default));(0,p._)([(0,x.Cb)()],de.prototype,"_effectiveRenderer",null),(0,p._)([(0,x.Cb)({constructOnly:!0})],de.prototype,"layerId",void 0),(0,p._)([(0,x.Cb)({constructOnly:!0})],de.prototype,"requestUpdateCallback",void 0),(0,p._)([(0,x.Cb)()],de.prototype,"container",void 0),(0,p._)([(0,x.Cb)({constructOnly:!0})],de.prototype,"graphics",void 0),(0,p._)([(0,x.Cb)()],de.prototype,"renderer",void 0),(0,p._)([(0,x.Cb)()],de.prototype,"_updateTracking",void 0),(0,p._)([(0,x.Cb)()],de.prototype,"updating",null),(0,p._)([(0,x.Cb)()],de.prototype,"view",void 0),(0,p._)([(0,x.Cb)()],de.prototype,"updateRequested",void 0),(0,p._)([(0,x.Cb)()],de.prototype,"defaultPointSymbolEnabled",void 0);var pe=de=(0,p._)([(0,k.j)("esri.views.2d.layers.graphics.GraphicsView2D")],de)}}]);
//# sourceMappingURL=85992.7b519ac3.chunk.js.map