"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[65225],{65225:function(e,t,r){r.r(t),r.d(t,{default:function(){return ue}});var i=r(37762),n=r(74165),a=r(93433),o=r(15861),s=r(60136),u=r(29388),l=r(43144),d=r(15671),c=r(27366),h=r(52639),p=r(63780),f=(r(93169),r(32718)),v=r(92026),g=r(94172),y=r(18722),_=r(49861),b=r(69912),m=r(32035),x=r(12400),k=r(50628),I=r(5986),E=r(34066),w=r(86372),C=r(93501),N=r(28970),O=r(65618),Z=r(55946),D=r(37818),S=r(50631),F=r(18661),A=r(21149),G=r(23037),P=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){return(0,d.Z)(this,r),t.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:function(e){return[e.geometryBuffer]}},e,{hasInitialize:!0})}return(0,l.Z)(r)}(r(46798).q),M=r(42069),R=r(53586),j=r(82607),L=r(831),q=r(91505),V=r(77427),H=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e,i){var n;return(0,d.Z)(this,r),(n=t.call(this))._updateAndCompare=e,n._notifyUpdated=i,n._nodes=new Map,n._graphics=new Map,n._duplicates=new Map,n}return(0,l.Z)(r,[{key:"clear",value:function(){if(this._graphics.size>0){var e=this.toArray();this._graphics.clear(),this.emit("change",{added:[],removed:e})}this._nodes.clear()}},{key:"length",get:function(){return this._graphics.size}},{key:"get",value:function(e){return this._graphics.get(e)}},{key:"getNode",value:function(e){return this._nodes.get(e)}},{key:"hasNode",value:function(e){return this._nodes.has(e)}},{key:"nodes",value:function(){return this._nodes.values()}},{key:"addNode",value:function(e,t){this._nodes.set(e,t);var r=t.graphics;if(0!==r.length){for(var i=new Set,n=0;n<r.length;n++){var a=r[n],o=a.objectId,s=this._graphics.get(o);if(s){i.add(o),a!==s&&(r[n]=s);var u=this._duplicates.get(o);u?u.push(e):this._duplicates.set(o,[s.nodeIndex,e])}else a.nodeIndex=e,this._graphics.set(o,a)}i.size&&this._updateForeignGraphics(t);var l=i.size>0?r.filter((function(e){return!i.has(e.objectId)})):r;l.length>0&&this.emit("change",{added:l,removed:[]})}}},{key:"removeNode",value:function(e){var t=this,r=this._nodes.get(e);if(r){this._nodes.delete(e);var n,a=new Set,o=[],s=(0,i.Z)(r.graphics);try{for(s.s();!(n=s.n()).done;){var u=n.value,l=u.objectId,d=this._graphics.get(l);if(d){var c=this._duplicates.get(l);if(c){var h=c.indexOf(e);if(-1===h)continue;if(c.splice(h,1),d.nodeIndex===e){for(var p=this.getNode(c[0]),f=1;f<c.length;f++){var v=this.getNode(c[f]);(null==p||null!=v&&v.node.level>p.node.level)&&(p=v)}null!=p&&a.add(p)}1===c.length&&this._duplicates.delete(l)}else this._graphics.delete(l),o.push(u)}}}catch(g){s.e(g)}finally{s.f()}o.length>0&&this.emit("change",{added:[],removed:o}),a.forEach((function(e){return t._updateForeignGraphics(e)}))}}},{key:"_updateForeignGraphics",value:function(e){for(var t=[],r=e.node.index,i=e.node.level,n=0;n<e.graphics.length;){var a=e.graphics[n].nodeIndex;if(a!==r){for(var o=1;n+o<e.graphics.length&&e.graphics[n+o].nodeIndex===a;)o++;var s=this.getNode(a);if(null!=s&&s.node.level>i)n+=o;else{for(var u=n;u<n+o;u++){var l=e.graphics[u];l.nodeIndex=r,this._updateAndCompare(l,e,u)&&t.push(l)}n+=o}}else n++}t.length>0&&this._notifyUpdated(t)}},{key:"toArray",value:function(){return Array.from(this._graphics.values())}},{key:"find",value:function(e){var t;return(0,V.oE)(this._graphics,(function(r){return!!e(r)&&(t=r,!0)})),t}},{key:"forEach",value:function(e){this._graphics.forEach((function(t){return e(t)}))}},{key:"forEachNode",value:function(e){this._nodes.forEach((function(t,r){return e(t,r)}))}},{key:"nodeCount",get:function(){return this._nodes.size}},{key:"_checkInvariants",value:function(){var e=this,t=new Map;this._nodes.forEach((function(r,i){r.graphics.forEach((function(r){var i;t.set(r.objectId,1+(null!==(i=t.get(r.objectId))&&void 0!==i?i:0)),e._duplicates.get(r.objectId)}))})),t.forEach((function(t,r){var i=e._graphics.get(r);if(i&&e._nodes.get(i.nodeIndex)){var n=e._duplicates.get(r);n&&n.forEach((function(t){e._nodes.get(t)}))}}))}}]),r}(q.Z),Q=r(75162),U=r(44011),T=r(1247),z=r(48252),B=r(20488),W=r(23224),K=r(6777),J=r(77057),X=r(94463),Y=r(89414),$=r(58890),ee=r(91526),te=r(78485),re=r(17006),ie=r(24405),ne=r(93463),ae=(0,z.v)(),oe=(0,l.Z)((function e(t,r,i,n){(0,d.Z)(this,e),this.graphics=t,this.featureIds=r,this.attributeInfo=i,this.node=n})),se=function(e){(0,s.Z)(c,e);var t=(0,u.Z)(c);function c(){var e;return(0,d.Z)(this,c),(e=t.apply(this,arguments)).type="scene-layer-graphics-3d",e._queryEngine=null,e._memCache=null,e._interactiveEditingSessions=new Map,e._pendingEditsQueue=Promise.resolve(),e.loadedGraphics=new H((function(e,t,r){return ce(e,t,r)}),(function(t){return e.processor.graphicsCore.recreateGraphics(t)})),e.holeFilling="always",e.progressiveLoadFactor=1,e.supportsHeightUnitConversion=!0,e._coordinatesOutsideExtentErrors=0,e._maxCoordinatesOutsideExtentErrors=20,e}return(0,l.Z)(c,[{key:"tryRecycleWith",value:function(e,t){var r=this;return e.url===this.layer.url&&this._i3sOverrides.isEmpty?e.load(t).then((function(){var t;(0,U.tq)(r.layer,e,r._i3sOverrides),r.layer=e,r._i3sOverrides.destroy();var i=null===(t=r.view.resourceController)||void 0===t?void 0:t.memoryController;r._i3sOverrides=new Q.v({view:r.view,layer:e,memoryController:i}),(0,v.SC)(r._queryEngine),r._setupQueryEngine(),r.processor.resetObjectStates()})):null}},{key:"initialize",value:function(){var e,t,i=this;this.addResolvingPromise(this.layer.indexInfo);var n=null===(e=this.view.resourceController)||void 0===e?void 0:e.memoryController;this._i3sOverrides=new Q.v({view:this.view,layer:this.layer,memoryController:n}),(0,U.OJ)(this.layer,this.view.spatialReference,this.view.viewingMode),this._fieldsHelper=new K.K({layerView:this}),this._updatingHandles.add((function(){return i.layer.rangeInfos}),(function(e){return i._rangeInfosChanged(e)}),g.initial),this._updatingHandles.add((function(){return i.layer.renderer}),(function(e,t){return i._rendererChange(e,t)})),this._updatingHandles.add((function(){return[i.parsedDefinitionExpression,i._excludeObjectIdsSorted]}),(function(){return i._filterChange()})),this.addHandles((0,g.watch)((function(){return X.h.I3S_TREE_SHOW_TILES}),(function(e){if(e&&!i._treeDebugger){var t=i._controller.crsIndex;r.e(80322).then(r.bind(r,80322)).then((function(e){var r=e.I3STreeDebugger;!i._treeDebugger&&X.h.I3S_TREE_SHOW_TILES&&(i._treeDebugger=new r({lv:i,view:i.view,nodeSR:t}))}))}else e||!i._treeDebugger||X.h.I3S_TREE_SHOW_TILES||(i._treeDebugger.destroy(),i._treeDebugger=null)}),g.initial)),this._set("processor",new R.I({owner:this,preferredUpdatePolicy:te.j.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:function(e){return i._updateClippingExtent(e)}})),null!==(t=this.processor.elevationAlignment)&&void 0!==t&&t.events.on("invalidate-elevation",(function(e){var t=e.extent,r=e.spatialReference;return i._controller.updateElevationChanged(t,r)})),this.supportsHeightUnitConversion&&(this._verticalScale=(0,C.k)("point",this.layer.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.processor.initializePromise),this._memCache=this.view.resourceController.memoryController.newCache("psl-".concat(this.uid)),this._controller=new S.Z({layerView:this}),(0,U.X5)(this.layer.geometryDefinitions)&&(this._worker=new P((function(e){return i.view.resourceController.immediate.schedule(e)}))),this.addHandles(this.layer.on("apply-edits",(function(e){return i._updatingHandles.addPromise(e.result)}))),this.addHandles(this.layer.on("edits",(function(e){var t=i._pendingEditsQueue.then((function(){return i._handleEdits(e)})).then();i._pendingEditsQueue=t,i._updatingHandles.addPromise(t)}))),this.when((function(){i._setupQueryEngine(),i._updatingHandles.add((function(){return i.maximumNumberOfFeatures}),(function(e){return i._controller.featureTarget=e}),g.initial),i._updatingHandles.add((function(){return i.suspended}),(function(e){e&&i._removeAllNodeData()}))}))}},{key:"destroy",value:function(){this._treeDebugger=(0,v.SC)(this._treeDebugger),this._i3sOverrides=(0,v.SC)(this._i3sOverrides),this._set("processor",(0,v.SC)(this.processor)),this._controller=(0,v.SC)(this._controller),this._queryEngine=(0,v.SC)(this._queryEngine),this._worker=(0,v.SC)(this._worker),this._memCache=(0,v.SC)(this._memCache),this.loadedGraphics.clear(),this._fieldsHelper=(0,v.SC)(this._fieldsHelper)}},{key:"i3slayer",get:function(){return this.layer}},{key:"updatingProgressValue",get:function(){var e,t;return null!==(e=null===(t=this._controller)||void 0===t?void 0:t.updatingProgress)&&void 0!==e?e:1}},{key:"requiredFields",get:function(){var e,t;return null!==(e=null===(t=this._fieldsHelper)||void 0===t?void 0:t.requiredFields)&&void 0!==e?e:[]}},{key:"maximumNumberOfFeatures",get:function(){var e,t,r,i=null===(e=this.processor)||void 0===e||null===(t=e.graphicsCore)||void 0===t?void 0:t.displayFeatureLimit;return null!==(r=null===i||void 0===i?void 0:i.maximumNumberOfFeatures)&&void 0!==r?r:0},set:function(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){var e;return!this.suspended&&!(null===(e=this._controller)||void 0===e||!e.useMaximumNumberOfFeatures)&&!this._controller.leavesReached}},{key:"_excludeObjectIdsSorted",get:function(){var e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((function(e,t){return e-t})):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"contentVisible",get:function(){var e;return!this.suspended&&!(null===(e=this._controller)||void 0===e||!e.rootNodeVisible)}},{key:"legendEnabled",get:function(){var e;return this.contentVisible&&!0===(null===(e=this.i3slayer)||void 0===e?void 0:e.legendEnabled)}},{key:"whenGraphicAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,U.bf)(this.layer,t,this._getObjectIdField(),r,(function(){return(0,a.Z)(i.loadedGraphics.nodes())})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getHit",value:function(e){var t;if(!this.loadedGraphics)return null;var r=(0,D.mW)(this.loadedGraphics.find((function(t){return t.uid===e})),this.layer),i=this._getObjectIdField();return null!==r&&void 0!==r&&null!==(t=r.attributes)&&void 0!==t&&t[i]?(r.layer=this.layer,r.sourceLayer=this.layer,{type:"graphic",graphic:r,layer:r.layer}):null}},{key:"whenGraphicBounds",value:function(e,t){return this.processor.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){return this.processor.computeAttachmentOrigin(e,t)}},{key:"isUpdating",value:function(){var e,t,r;return!!(null!==(e=this._controller)&&void 0!==e&&e.updating||null!==(t=this.processor)&&void 0!==t&&t.updating||null!==(r=this._fieldsHelper)&&void 0!==r&&r.updating||this.layerFilterUpdating)}},{key:"highlight",value:function(e){return this.processor.highlight(e,this.layer.objectIdField)}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"createInteractiveEditSession",value:function(e){return(0,L.sw)(this._attributeEditingContext,e)}},{key:"_decompressBinaryPointData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a,o=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={geometryBuffer:t.geometryBuffer},null==this._worker&&(this._worker=new P((function(e){return o.view.resourceController.immediate.schedule(e)}))),e.next=4,this._worker.invoke(i,r);case 4:if(null!=(a=e.sent)){e.next=7;break}throw new Error("Failed to decompress Draco point data");case 7:return e.abrupt("return",{positionData:a.positions,featureIds:a.featureIds});case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"addNode",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,a){var o,s,u,l,d,c,h,p,v,g,y,_,b,m,x,I,E,w;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(de(r)||le(r)){e.next=2;break}throw new Error;case 2:if(!this.loadedGraphics.hasNode(t.index)){e.next=4;break}return e.abrupt("return",void f.Z.getLogger(this).error("I3S node "+t.id+" already added"));case 4:if(o=null!=this.layer.fullExtent?pe(this.layer.fullExtent.clone(),.5):null,!de(r)){e.next=11;break}return e.next=8,this._extractBinaryPointPositions(t,r,a);case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=this._extractLegacyPointPositions(r);case 12:return s=e.t0,u=s.featureIds,l=s.pointPositions,d=new Array,this._validatePositions(t,u,l,o,d),c=this._controller.crsVertex,h=this.view.spatialReference,(0,k.projectBuffer)(l,c,0,l,h,0,u.length),p=de(r)?t.level:0,v=this._createGraphics(u,l,t.index,p),g=new oe(v,u,r.attributeDataInfo,t),e.next=22,this._i3sOverrides.applyAttributeOverrides(g.featureIds,r.attributeDataInfo,a);case 22:if(t.numFeatures=g.graphics.length,this._updateNodeMemory(t),he(g),d.length>0&&(this._computeObb(t,d,c),this._controller.updateVisibility(t.index)),this._controller.isGeometryVisible(t)){e.next=28;break}return e.abrupt("return",void this._cacheNodeData(g));case 28:if(null!=this._verticalScale){y=(0,i.Z)(g.graphics);try{for(y.s();!(_=y.n()).done;)b=_.value,this._verticalScale(b.geometry)}catch(n){y.e(n)}finally{y.f()}}if(null!=(m=this.view._stage.renderView.objectAndLayerIdRenderHelper))for(x=(0,G.ql)(this.view.map,this.layer.uid),I=0;I<g.featureIds.length;I++)w=g.featureIds[I],m.setUidToObjectAndLayerId(w,g.graphics[I].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled&&!x&&(0,ie.zc)(this.layer,null===(E=this.view.popup)||void 0===E?void 0:E.defaultPopupTemplateEnabled),g.node.resources.attributes,I);this.loadedGraphics.addNode(t.index,g),this._controller.updateLoadStatus(t.index,!0),this._filterNode(g),this._treeDebugger&&this._treeDebugger.update();case 32:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_computeObb",value:function(e,t,r){var i=this._controller.crsIndex,n=i.isGeographic?this.view.renderSpatialReference:i;(0,k.projectBuffer)(t,r,0,t,n,0,t.length/3),e.serviceObbInIndexSR=(0,Y.Qb)(new ee.U(t,3)),i.isGeographic&&((0,I.S)(e.serviceObbInIndexSR.center,n,ve,i),e.serviceObbInIndexSR.center=ve)}},{key:"isNodeLoaded",value:function(e){return this.loadedGraphics.hasNode(e)}},{key:"isNodeReloading",value:function(){return!1}},{key:"updateNodeState",value:function(){}},{key:"_extractBinaryPointPositions",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i){var a,o,s,u,l,d,c,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._decompressBinaryPointData(r,i);case 2:for(a=e.sent,o=a.positionData,3,s=o.length/3,u=(0,w.bg)(3*s),l=null!=t.serviceObbInIndexSR?t.serviceObbInIndexSR.center:x.AG,d=Math.abs(l[2])*Math.pow(2,-20),c=0;c<s;c++)u[h=3*c]=o[h]+l[0],u[h+1]=o[h+1]+l[1],u[h+2]=o[h+2]+l[2],Math.abs(u[h+2])<d&&(u[h+2]=0);return e.abrupt("return",{featureIds:a.featureIds?(0,w.QZ)(a.featureIds):[],pointPositions:u});case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_extractLegacyPointPositions",value:function(e){for(var t=e.pointData.length,r=(0,w.bg)(3*t),i=new Array,n=0;n<t;n++){var a,o,s,u,l=e.pointData[n],d=l.featureDataPosition,c=d.length,h=null!==(a=null===(o=l.geometries)||void 0===o?void 0:o[0])&&void 0!==a?a:fe[c],p=l.featureIds[0];if(!("Embedded"!==h.type||"points"!==h.params.type||c<2||c>3)){var f=null!==(s=null===(u=h.params.vertexAttributes)||void 0===u?void 0:u.position)&&void 0!==s?s:[0,0,0],v=3*i.length;r[v]=d[0]+f[0],r[v+1]=d[1]+f[1],r[v+2]=3===c?d[2]+f[2]:NaN,i.push(p)}}return{featureIds:i,pointPositions:r}}},{key:"_validatePositions",value:function(e,t,r,i,n){if(null!=i||!e.serviceObbInIndexSR)for(var a=t.length,o=0;o<a;o++){var s=3*o;(0,m.s)(ve,r[s],r[s+1],r[s+2]);var u=!Number.isNaN(r[2]);null==i||(u?(0,E.Qg)(i,ve):(0,E.OQ)(i,ve))||(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&f.Z.getLogger(this).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&f.Z.getLogger(this).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++),e.serviceObbInIndexSR||n.push(ve[0],ve[1],ve[2])}}},{key:"_createGraphics",value:function(e,t,r,i){for(var n=e.length,a=this._getObjectIdField(),o=this.processor.graphicsCore,s=new Array,u=this.view.spatialReference,l=0;l<n;l++){var d=e[l],c={};null!=d&&(c[a]=d);var p=null!==d&&void 0!==d?d:h.Z.generateUID(),f=3*l,v=isNaN(t[f+2])?void 0:t[f+2],g=(0,Z.T)(t[f],t[f+1],v,u),y=this.loadedGraphics.get(p);if(null!=y)(null==y.level||y.level<i)&&(ge.property="geometry",ge.graphic=y,ge.oldValue=y.geometry,ge.newValue=g,y.geometry=g,y.level=i,o.graphicUpdateHandler(ge)),s.push(y);else{var _=h.Z.generateUID();s.push({objectId:p,uid:_,geometry:g,attributes:c,visible:!0,nodeIndex:r,level:i})}}return s}},{key:"_updateNodeMemory",value:function(e){e.memory=4096+(null!=e.numFeatures?e.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}},{key:"_cacheNodeData",value:function(e){var t=e.graphics.reduce((function(e,t){return(0,O.Xw)(t)+e}),(0,y.Xw)(e.featureIds)+1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)}},{key:"_getMemCacheKey",value:function(e){return"".concat(e.index)}},{key:"_removeAllNodeData",value:function(){var e=this;this.loadedGraphics.forEachNode((function(t,r){if(t){var i=t.node;e._updateNodeMemory(i),e._cacheNodeData(t)}e._controller.updateLoadStatus(r,!1)})),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}},{key:"removeNode",value:function(e){var t=this._removeNodeStageData(e);t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t))}},{key:"_removeNodeStageData",value:function(e){var t=this.loadedGraphics.getNode(e);return null==t?null:(this._controller.updateLoadStatus(e,!1),this.loadedGraphics.removeNode(e),this._treeDebugger&&this._treeDebugger.update(),t)}},{key:"loadCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===(r=this._memCache)||void 0===r?void 0:r.pop(this._getMemCacheKey(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadedGraphics.hasNode(t.index)){e.next=4;break}f.Z.getLogger(this).error("I3S node "+t.id+" already added"),e.next=13;break;case 4:return e.next=6,this._i3sOverrides.applyAttributeOverrides(r.featureIds,i,a);case 6:r.attributeInfo=i,this.loadedGraphics.addNode(t.index,r),this._controller.updateLoadStatus(t.index,!0),this._updateNodeMemory(t),he(r),this._filterNode(r),this._treeDebugger&&this._treeDebugger.update();case 13:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"getLoadedNodeIds",value:function(){var e=[];return this.loadedGraphics.forEachNode((function(t){return e.push(t.node.id)})),e.sort()}},{key:"getVisibleNodes",value:function(){var e=new Array;return this.loadedGraphics.forEachNode((function(t){return e.push(t.node)})),e}},{key:"getLoadedNodeIndices",value:function(e){this.loadedGraphics.forEachNode((function(t,r){return e.push(r)}))}},{key:"getLoadedAttributes",value:function(e){var t=this.loadedGraphics.getNode(e);if(null!=(null===t||void 0===t?void 0:t.attributeInfo))return t.attributeInfo.loadedAttributes}},{key:"getAttributeData",value:function(e){var t=this.loadedGraphics.getNode(e);if(null!=(null===t||void 0===t?void 0:t.attributeInfo))return t.attributeInfo.attributeData}},{key:"_setAttributeData",value:function(e,t){var r=this.loadedGraphics.getNode(e);null!=(null===r||void 0===r?void 0:r.attributeInfo)&&(r.attributeInfo.attributeData=t,this._attributeValuesChanged(r))}},{key:"updateAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.loadedGraphics.getNode(t),e.t0=null!=a,!e.t0){e.next=7;break}return e.next=5,this._i3sOverrides.applyAttributeOverrides(a.featureIds,r,i);case 5:a.attributeInfo=r,this._attributeValuesChanged(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_attributeValuesChanged",value:function(e){if(he(e),this._filterNode(e),this.processor.graphicsCore.labelsEnabled){var t=e.node.index,r=new Array;e.graphics.forEach((function(e){return e.nodeIndex===t&&r.push(e.uid)})),this.processor.graphicsCore.updateLabelingInfo(r)}}},{key:"_updateClippingExtent",value:function(e){return this._controller&&this._controller.updateClippingArea(e),!1}},{key:"_getObjectIdField",value:function(){return this.layer.objectIdField||N.d}},{key:"_getGlobalIdField",value:function(){var e;return null===(e=this.layer.associatedLayer)||void 0===e?void 0:e.globalIdField}},{key:"_rendererChange",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer.fieldsIndex,a=new Set,!t){e.next=7;break}return e.next=4,t.collectRequiredFields(a,i);case 4:o=Array.from(a).sort(),e.next=8;break;case 7:o=[];case 8:if(a.clear(),!r){e.next=15;break}return e.next=12,r.collectRequiredFields(a,i);case 12:s=Array.from(a).sort(),e.next=16;break;case 15:s=[];case 16:o.length===s.length&&o.every((function(e,t){return o[t]===s[t]}))||this._reloadAllNodes();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_rangeInfosChanged",value:function(e){null!=e&&e.length>0&&f.Z.getLogger(this).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}},{key:"_filterChange",value:function(){var e=this;this.loadedGraphics.forEachNode((function(t){return e._filterNode(t)}))}},{key:"_reloadAllNodes",value:function(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}},{key:"_filterNode",value:function(e){var t,r=this.parsedDefinitionExpression,n=this._excludeObjectIdsSorted,a=this._getObjectIdField(),o=(0,i.Z)(e.graphics);try{for(o.s();!(t=o.n()).done;){var s=t.value,u=s.visible,l=!r||this._evaluateClause(r,s),d=null==n||(0,p.$A)(n,s.attributes[a])<0;s.visible=l&&d,u!==s.visible&&(ge.graphic=s,ge.property="visible",ge.oldValue=u,ge.newValue=s.visible,this.processor.graphicsCore.graphicUpdateHandler(ge))}}catch(c){o.e(c)}finally{o.f()}}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return null!=this.filter?this.filter.createQuery(e):new A.Z(e)}},{key:"queryFeatures",value:function(e,t){return this._queryEngine.executeQuery(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryObjectIds",value:function(e,t){return this._queryEngine.executeQueryForIds(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatureCount",value:function(e,t){return this._queryEngine.executeQueryForCount(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryExtent",value:function(e,t){return this._queryEngine.executeQueryForExtent(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"_ensureQuery",value:function(e){return this._addDefinitionExpressionToQuery(null==e?this.createQuery():A.Z.from(e))}},{key:"_setupQueryEngine",value:function(){var e=this;this._queryEngine=new j.q({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return e.processor.featureStore},hasZ:this.hasZ,hasM:this.hasM},priority:ne.T8.FEATURE_QUERY_ENGINE})}},{key:"usedMemory",get:function(){var e,t,r;return null!==(e=null===(t=this.processor)||void 0===t||null===(r=t.graphicsCore)||void 0===r?void 0:r.usedMemory)&&void 0!==e?e:0}},{key:"unloadedMemory",get:function(){var e,t,r,i,n;return.8*((null!==(e=null===(t=this._controller)||void 0===t?void 0:t.unloadedMemoryEstimate)&&void 0!==e?e:0)+(null!==(r=null===(i=this.processor)||void 0===i||null===(n=i.graphicsCore)||void 0===n?void 0:n.unprocessedMemoryEstimate)&&void 0!==r?r:0))}},{key:"ignoresMemoryFactor",get:function(){return this._controller&&this._controller.fixedFeatureTarget}},{key:"_handleEdits",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){var r,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._attributeEditingContext,e.next=3,(0,L.Qw)(r,t);case 3:i=e.sent,(0,L.Z6)(r,i);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_attributeEditingContext",get:function(){var e,t=this,r=this._getObjectIdField(),i=this._getGlobalIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:r,globalIdField:i,forEachNode:function(e){return t.loadedGraphics.forEachNode((function(t){return e(t.node,t.featureIds)}))},attributeStorageInfo:null!==(e=this.i3slayer.attributeStorageInfo)&&void 0!==e?e:[],i3sOverrides:this._i3sOverrides,getAttributeData:function(e){return t.getAttributeData(e)},setAttributeData:function(e,i,n){t._setAttributeData(e,i);var a=t.loadedGraphics.getNode(e);if(null!=n){var o=t.loadedGraphics.get(n.attributes[r]);null!=o&&t.processor.graphicsCore.recreateGraphics([o])}else null!=a&&t.processor.graphicsCore.recreateGraphics(a.graphics)},clearMemCache:function(){}}}},{key:"performanceInfo",get:function(){return new B.W(this.usedMemory,this.loadedGraphics.length,-1,this.maximumNumberOfFeatures,this.loadedGraphics.nodeCount,this.processor.graphicsCore.performanceInfo)}},{key:"test",get:function(){}}]),c}((0,J.q)((0,T.l)((0,W.i)((0,M.A)(re.Z)))));(0,c._)([(0,_.Cb)()],se.prototype,"processor",void 0),(0,c._)([(0,_.Cb)({type:F.Z})],se.prototype,"filter",void 0),(0,c._)([(0,_.Cb)()],se.prototype,"loadedGraphics",void 0),(0,c._)([(0,_.Cb)()],se.prototype,"i3slayer",null),(0,c._)([(0,_.Cb)()],se.prototype,"_controller",void 0),(0,c._)([(0,_.Cb)()],se.prototype,"updating",void 0),(0,c._)([(0,_.Cb)()],se.prototype,"suspended",void 0),(0,c._)([(0,_.Cb)()],se.prototype,"holeFilling",void 0),(0,c._)([(0,_.Cb)($.q)],se.prototype,"updatingProgress",void 0),(0,c._)([(0,_.Cb)()],se.prototype,"updatingProgressValue",null),(0,c._)([(0,_.Cb)(ae.requiredFields)],se.prototype,"requiredFields",null),(0,c._)([(0,_.Cb)(ae.availableFields)],se.prototype,"availableFields",void 0),(0,c._)([(0,_.Cb)()],se.prototype,"_fieldsHelper",void 0),(0,c._)([(0,_.Cb)({type:Number})],se.prototype,"maximumNumberOfFeatures",null),(0,c._)([(0,_.Cb)({readOnly:!0})],se.prototype,"maximumNumberOfFeaturesExceeded",null),(0,c._)([(0,_.Cb)()],se.prototype,"_excludeObjectIdsSorted",null),(0,c._)([(0,_.Cb)({readOnly:!0})],se.prototype,"lodFactor",null),(0,c._)([(0,_.Cb)({readOnly:!0})],se.prototype,"hasM",null),(0,c._)([(0,_.Cb)({readOnly:!0})],se.prototype,"hasZ",null),(0,c._)([(0,_.Cb)()],se.prototype,"contentVisible",null),(0,c._)([(0,_.Cb)({readOnly:!0})],se.prototype,"legendEnabled",null);var ue=se=(0,c._)([(0,b.j)("esri.views.3d.layers.SceneLayerGraphicsView3D")],se);function le(e){return"pointData"in e}function de(e){return"geometryBuffer"in e&&null!==e.geometryBuffer}function ce(e,t,r){var n=t.attributeInfo;if(null==(null===n||void 0===n?void 0:n.loadedAttributes)||null==n.attributeData)return!1;var a,o=!1,s=(0,i.Z)(n.loadedAttributes);try{for(s.s();!(a=s.n()).done;){var u=a.value.name;if(n.attributeData[u]){var l=(0,U.Jx)(n.attributeData[u],r);l!==e.attributes[u]&&(e.attributes[u]=l,o=!0)}}}catch(d){s.e(d)}finally{s.f()}return o}function he(e){var t=e.attributeInfo,r=e.node.index;if(null!=(null===t||void 0===t?void 0:t.loadedAttributes)&&null!=t.attributeData)for(var n=0;n<e.graphics.length;n++){var a=e.graphics[n];if(a.nodeIndex===r){a.attributes||(a.attributes={});var o,s=(0,i.Z)(t.loadedAttributes);try{for(s.s();!(o=s.n()).done;){var u=o.value.name;t.attributeData[u]&&(a.attributes[u]=(0,U.Jx)(t.attributeData[u],n))}}catch(l){s.e(l)}finally{s.f()}}}}function pe(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,null!=e.zmin&&null!=e.zmax&&(e.zmin-=t,e.zmax+=t),null!=e.mmin&&null!=e.mmax&&(e.mmin-=t,e.mmax+=t),e}var fe={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ve=(0,x.Ue)(),ge={graphic:null,property:null,oldValue:null,newValue:null}}}]);
//# sourceMappingURL=65225.7cb3c8e9.chunk.js.map