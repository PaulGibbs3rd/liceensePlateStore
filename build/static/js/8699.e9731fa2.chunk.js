"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[8699,67387,2502],{44619:function(e,t,r){r.d(t,{L:function(){return L},b:function(){return k}});var n,i,a,o,s,l,u,c,h,d,f,v=r(30168),p=r(13611),m=r(6644),y=r(86361),g=r(33280),_=r(28156),b=r(81879),x=r(55616),S=r(43565),T=r(62993),w=r(82999),P=r(95276),C=r(58406),O=r(98634),R=r(64201),E=r(4760);function k(e){var t=new R.kG,r=t.vertex,m=t.fragment;return r.include(_.H),t.include(b.R,e),t.include(g.f5,e),t.attributes.add(E.T.UV0,"vec2"),r.uniforms.add(new P.N("viewport",(function(e,t){return t.camera.fullViewport})),new C.p("lineSize",(function(e,t){return e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0})),new w.A("pixelToNDC",(function(e,t){return(0,p.t8)(Z,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])})),new C.p("borderSize",(function(e,t){return null!=e.borderColor?t.camera.pixelRatio:0})),new w.A("screenOffset",(function(e,t){return(0,p.t8)(Z,e.horizontalScreenOffset*t.camera.pixelRatio,0)}))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.multipassEnabled&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(x.P),e.hasScreenSizePerspective&&(0,T.m8)(r),r.code.add((0,O.H)(n||(n=(0,v.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint = projectPositionHUD(projectAux);\n\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the\n      // correct depth value\n      vec3 posView = (view * vec4(position, 1.0)).xyz;\n      ","\n\n      applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);\n      vec4 startPoint = proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy += screenOffsetNorm * startPoint.w;\n      endPoint.xy += screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n    ","\n      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize = lineSizeScaled * 0.5;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding = 1.0 + borderSizeScaled;\n      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize = 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n      coverageSampling = vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position = projectedPosition;\n    }\n  "])),e.occlusionTestEnabled?(0,O.H)(i||(i=(0,v.Z)(["\n      if (!testHUDVisibility(endPoint)) {\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",e.hasScreenSizePerspective?(0,O.H)(a||(a=(0,v.Z)(["\n      vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):(0,O.H)(o||(o=(0,v.Z)(["vec2 screenOffsetScaled = screenOffset;"]))),e.multipassEnabled?"depth = posView.z;":"",e.depthHudEnabled?e.depthHudAlignStartEnabled?(0,O.H)(s||(s=(0,v.Z)(["endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):(0,O.H)(l||(l=(0,v.Z)(["startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",e.hasScreenSizePerspective?(0,O.H)(u||(u=(0,v.Z)(["\n      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):(0,O.H)(c||(c=(0,v.Z)(["\n      float lineSizeScaled = lineSize;\n      float borderSizeScaled = borderSize;\n        "]))))),m.uniforms.add(new P.N("uColor",(function(e){return A(e.color)})),new P.N("borderColor",(function(e){return A(e.borderColor)}))),e.multipassEnabled&&(m.include(S.S,e),m.uniforms.add(new w.A("inverseViewport",(function(e,t){return t.inverseViewport})))),m.code.add((0,O.H)(h||(h=(0,v.Z)(["\n    void main() {\n      ","\n\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the\n      // border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha\n      float borderAlpha = uColor.a * borderColor.a * coverage.y;\n      float colorAlpha = uColor.a * coverage.x;\n\n      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n    ","\n  }\n  "])),e.multipassEnabled?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":"",e.depthHudEnabled?(0,O.H)(d||(d=(0,v.Z)(["\n      if (finalAlpha < 0.01) {\n        discard;\n      }\n      "]))):(0,O.H)(f||(f=(0,v.Z)(["\n      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);\n      fragColor = vec4(finalRgb, finalAlpha);\n      "]))))),t}function A(e){return null!=e?e:y.AG}var Z=(0,m.Ue)(),L=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}))},83609:function(e,t,r){r.d(t,{L:function(){return W},b:function(){return j}});var n,i,a,o,s,l,u,c,h,d,f,v,p,m,y,g,_,b,x,S,T,w=r(30168),P=r(2522),C=r(37081),O=r(33280),R=r(48353),E=r(40526),k=r(15226),A=r(26461),Z=r(116),L=r(78980),I=r(41012),U=r(82999),M=r(95276),D=r(58406),z=r(98634),N=r(8654),F=r(64201),V=r(19253),H=r(25920),G=r(4760),B=r(33720);function j(e){var t=new F.kG,r=e.multipassEnabled&&e.output===C.H_.Color,j=e.space===B.I9.World;t.include(R.U,e),t.include(E.Q,e);var W=t.vertex,q=t.fragment;return q.include(L.n),(0,I.Sv)(W,e),t.attributes.add(G.T.POSITION,"vec3"),t.attributes.add(G.T.PREVPOSITION,"vec3"),t.attributes.add(G.T.UV0,"vec2"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),r&&t.varyings.add("depth","float"),e.hasTip&&t.varyings.add("vLineWidth","float"),W.uniforms.add(new U.A("nearFar",(function(e,t){return t.camera.nearFar})),new M.N("viewport",(function(e,t){return t.camera.fullViewport}))),W.code.add((0,z.H)(n||(n=(0,w.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),W.code.add((0,z.H)(i||(i=(0,w.Z)(["void clip(vec4 pos, inout vec4 prev) {\nfloat vnp = nearFar[0] * 0.99;\nif (prev.z > -nearFar[0]) {\nfloat interpolation = (-vnp - pos.z) / (prev.z - pos.z);\nprev = mix(pos, prev, interpolation);\n}\n}"])))),j?(t.attributes.add(G.T.NORMAL,"vec3"),(0,I._8)(W),W.constants.add("tiltThreshold","float",.7),W.code.add((0,z.H)(a||(a=(0,w.Z)(["vec3 perpendicular(vec3 v) {\nvec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;\nvec3 n2 = cross(v, n);\nvec3 forward = vec3(0.0, 0.0, 1.0);\nfloat tiltDot = dot(forward, n);\nreturn abs(tiltDot) < tiltThreshold ? n : n2;\n}"]))))):W.code.add((0,z.H)(o||(o=(0,w.Z)(["vec2 perpendicular(vec2 v) {\nreturn vec2(v.y, -v.x);\n}"])))),W.code.add((0,z.H)(s||(s=(0,w.Z)(["\n      #define vecN ","\n\n      vecN normalizedSegment(vecN pos, vecN prev) {\n        vecN segment = pos - prev;\n        float segmentLen = length(segment);\n\n        // normalize or zero if too short\n        return (segmentLen > 0.001) ? segment / segmentLen : ",";\n      }\n\n      vecN displace(vecN pos, vecN prev, float displacementLen) {\n        vecN segment = normalizedSegment(pos, prev);\n\n        vecN displacementDirU = perpendicular(segment);\n        vecN displacementDirV = segment;\n\n        ","\n\n        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);\n      }\n    "])),j?"vec3":"vec2",j?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)",e.anchor===B.i5.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":"")),e.space===B.I9.Screen&&(W.uniforms.add(new N.g("inverseProjectionMatrix",(function(e,t){return t.camera.inverseProjectionMatrix}))),W.code.add((0,z.H)(l||(l=(0,w.Z)(["vec3 inverseProject(vec4 posScreen) {\nposScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;\nreturn (inverseProjectionMatrix * posScreen).xyz;\n}"])))),W.code.add((0,z.H)(u||(u=(0,w.Z)(["bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {\nfloat cos = dot(rayDir, planeNormal);\nfloat t = dot(planeOrigin, planeNormal) / cos;\nintersection = t * rayDir;\nreturn abs(cos) > 0.001 && t > 0.0;\n}"])))),W.uniforms.add(new D.p("perScreenPixelRatio",(function(e,t){return t.camera.perScreenPixelRatio}))),W.code.add((0,z.H)(c||(c=(0,w.Z)(["\n      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {\n        // Project displaced position back to camera space\n        vec3 displacedPos = inverseProject(displacedPosScreen);\n\n        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally\n        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).\n        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));\n        vec3 planeOrigin = posLeft;\n\n        ",";\n\n        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the\n        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.\n        float offset = lineWidth * perScreenPixelRatio;\n        planeOrigin *= (1.0 - offset);\n\n        // Intersect camera ray with the plane and make sure it is within clip space\n        vec3 rayDir = normalize(displacedPos);\n        vec3 intersection;\n        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {\n          return vec4(intersection.xyz, 1.0);\n        }\n\n        // Fallback: use depth of pos or prev, whichever is closer to the camera\n        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);\n        displacedPos *= minDepth / length(displacedPos);\n        return vec4(displacedPos.xyz, 1.0);\n      }\n  "])),e.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += perpendicular(diff) / 2.0;\n                }\n              ":""))),(0,I.ZI)(W),W.code.add((0,z.H)(h||(h=(0,w.Z)(["void main(void) {\nif (uv0.y == 0.0) {\ngl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n}\nelse {\nfloat lineWidth = getLineWidth();\nfloat screenMarkerSize = getScreenMarkerSize();\nvec4 pos  = view * vec4(position, 1.0);\nvec4 prev = view * vec4(prevPosition, 1.0);\nclip(pos, prev);"])))),j?(e.hideOnShortSegments&&W.code.add((0,z.H)(d||(d=(0,w.Z)(["if (areWorldMarkersHidden(pos, prev)) {\ngl_Position = vec4(1e038, 1e038, 1e038, 1.0);\nreturn;\n}"])))),W.code.add((0,z.H)(f||(f=(0,w.Z)(["pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));\nvec4 displacedPosScreen = projectAndScale(pos);"]))))):(W.code.add((0,z.H)(v||(v=(0,w.Z)(["vec4 posScreen = projectAndScale(pos);\nvec4 prevScreen = projectAndScale(prev);\nvec4 displacedPosScreen = posScreen;\ndisplacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);"])))),e.space===B.I9.Screen&&W.code.add((0,z.H)(p||(p=(0,w.Z)(["vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));\nvec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));\nvec3 lineLeft = pos.xyz + (pos.xyz - lineRight);\npos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);\ndisplacedPosScreen = projectAndScale(pos);"]))))),W.code.add((0,z.H)(m||(m=(0,w.Z)(["\n        ","\n\n        // Convert back into NDC\n        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;\n\n        // Convert texture coordinate into [0,1]\n        vUV = (uv0 + 1.0) / 2.0;\n\n        ","\n\n        ","\n\n        vSize = screenMarkerSize;\n        vColor = getColor();\n\n        // Use camera space for slicing\n        vpos = pos.xyz;\n\n        gl_Position = displacedPosScreen;\n      }\n    }\n  "])),r?"depth = pos.z;":"",j?"":"vUV *= displacedPosScreen.w;",e.hasTip?"vLineWidth = lineWidth;":"")),r&&t.include(k.l,e),t.include(O.f5,e),q.uniforms.add(new M.N("intrinsicColor",(function(e){return e.color})),new V.A("tex",(function(e){return e.markerTexture}))),q.include(Z.Y),t.constants.add("texelSize","float",1/P.OJ),q.code.add((0,z.H)(y||(y=(0,w.Z)(["float markerAlpha(vec2 samplePos) {\nsamplePos += vec2(0.5, -0.5) * texelSize;\nfloat sdf = rgba2float(texture(tex, samplePos)) - 0.5;\nfloat distance = sdf * vSize;\ndistance -= 0.5;\nreturn clamp(0.5 - distance, 0.0, 1.0);\n}"])))),e.hasTip&&(t.constants.add("relativeMarkerSize","float",P.qO/P.OJ),t.constants.add("relativeTipLineWidth","float",P.zA),q.code.add((0,z.H)(g||(g=(0,w.Z)(["\n    float tipAlpha(vec2 samplePos) {\n      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker\n      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);\n      samplePos *= vSize;\n\n      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;\n      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);\n\n      ","\n\n      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);\n      return clamp(0.5 - distance, 0.0, 1.0);\n    }\n  "])),j?"halfTipLineWidth *= fwidth(samplePos.y);":""))),e.transparencyPassType===H.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),t.constants.add("symbolAlphaCutoff","float",A.b),q.code.add((0,z.H)(_||(_=(0,w.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n\n    vec4 finalColor = intrinsicColor * vColor;\n\n    ","\n\n    ","\n\n    ","\n\n    if (finalColor.a < symbolAlphaCutoff) {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n  }\n  "])),r?"terrainDepthTest(depth);":"",j?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;",e.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);",e.output===C.H_.ObjectAndLayerIdColor?(0,z.H)(b||(b=(0,w.Z)(["finalColor.a = 1.0;"]))):"",e.output===C.H_.Color?(0,z.H)(x||(x=(0,w.Z)(["fragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===C.H_.Color&&e.transparencyPassType===H.A.ColorAlpha?(0,z.H)(S||(S=(0,w.Z)(["\n            fragColor = premultiplyAlpha(fragColor);\n            fragAlpha = fragColor.a;"]))):"",e.output===C.H_.Highlight?(0,z.H)(T||(T=(0,w.Z)(["fragColor = vec4(1.0);"]))):"")),t}var W=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},99337:function(e,t,r){r.d(t,{N:function(){return S},b:function(){return x}});var n,i,a,o,s,l=r(30168),u=r(37081),c=r(33280),h=r(94951),d=r(48655),f=r(137),v=r(26461),p=r(41012),m=r(95276),y=r(58406),g=r(98634),_=r(64201),b=r(4760);function x(e){var t=new _.kG,r=t.vertex,x=t.fragment;return t.include(h.w,e),t.include(d.c,e),(0,p.Sv)(r,e),t.attributes.add(b.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add((0,g.H)(n||(n=(0,l.Z)(["void main(void) {\nvpos = position;\nforwardNormalizedVertexColor();\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),e.output===u.H_.Highlight&&t.include(f.bA,e),t.include(c.f5,e),x.uniforms.add(new y.p("alphaCoverage",(function(e,t){return Math.min(1,e.width*t.camera.pixelRatio)}))),e.hasVertexColors||x.uniforms.add(new m.N("constantColor",(function(e){return e.color}))),x.code.add((0,g.H)(i||(i=(0,l.Z)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    ","\n\n    if (color.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.hasVertexColors?"vColor":"constantColor",e.output===u.H_.ObjectAndLayerIdColor?(0,g.H)(a||(a=(0,l.Z)(["color.a = 1.0;"]))):"",g.H.float(v.b),e.output===u.H_.Color?(0,g.H)(o||(o=(0,l.Z)(["fragColor = highlightSlice(color, vpos);"]))):"",e.output===u.H_.Highlight?(0,g.H)(s||(s=(0,l.Z)(["outputHighlight();"]))):"")),t}var S=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}))},21841:function(e,t,r){r.d(t,{P:function(){return N},b:function(){return z}});var n,i,a,o,s,l,u,c,h,d,f,v,p=r(30168),m=r(22357),y=r(37081),g=r(33280),_=r(94951),b=r(14801),x=r(75027),S=r(16574),T=r(137),w=r(30694),P=r(34975),C=r(92395),O=r(15226),R=r(96658),E=r(8555),k=r(93511),A=r(116),Z=r(41012),L=r(49450),I=r(58406),U=r(98634),M=r(64201),D=r(25920);function z(e){var t=new M.kG,r=t.vertex,z=t.fragment;switch((0,Z.Sv)(r,e),t.varyings.add("vpos","vec3"),t.include(x.W,e),e.output!==y.H_.Color&&e.output!==y.H_.ObjectAndLayerIdColor||(t.include(_.w,e),t.include(k.XE,e),t.include(m.qj,e),t.include(b.R,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.multipassEnabled&&t.varyings.add("depth","float"),r.code.add((0,U.H)(n||(n=(0,p.Z)(["\n      void main() {\n        vpos = calculateVPos();\n        vnormal = normalize(localNormal());\n\n        ","\n        gl_Position = transformPosition(proj, view, vpos);\n\n        ","\n        forwardObjectAndLayerIdColor();\n\n        vcolor = getColor();\n      }\n    "])),e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===y.H_.Color?"forwardLinearDepth();":""))),t.include(O.l,e),e.output){case y.H_.Color:t.include(g.f5,e),t.include(P.XP,e),t.include(w.K,e),t.include(k.XE,e),t.include(R.k,e),(0,Z.hY)(z,e),(0,P.PN)(z),(0,P.sC)(z),z.uniforms.add(r.uniforms.get("localOrigin"),new L.J("ambient",(function(e){return e.ambient})),new L.J("diffuse",(function(e){return e.diffuse})),new L.J("specular",(function(e){return e.specular})),new I.p("opacity",(function(e){return e.opacity}))),z.include(A.Y),e.transparencyPassType===D.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,C.F1)(z),z.code.add((0,U.H)(i||(i=(0,p.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          shadingParams.viewDirection = normalize(vpos - cameraPosition);\n          shadingParams.normalView = vnormal;\n          vec3 normal = shadingNormal(shadingParams);\n          float ssao = evaluateAmbientOcclusionInverse();\n\n          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n          ","\n          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n          float combinedOpacity = vcolor.a * opacity;\n          albedo += 0.25 * specular; // don't completely ignore specular for now\n\n          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n          fragColor = vec4(shadedColor, combinedOpacity);\n          fragColor = highlightSlice(fragColor, vpos);\n          ","\n        }\n      "])),e.multipassEnabled?"terrainDepthTest(depth);":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.transparencyPassType===D.A.ColorAlpha?(0,U.H)(a||(a=(0,p.Z)(["\n                  fragColor = premultiplyAlpha(fragColor);\n                  fragAlpha = fragColor.a;"]))):""));break;case y.H_.Depth:t.include(_.w,e),r.code.add((0,U.H)(o||(o=(0,p.Z)(["void main() {\nvpos = calculateVPos();\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),t.include(g.f5,e),z.code.add((0,U.H)(s||(s=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\n}"]))));break;case y.H_.Shadow:case y.H_.ShadowHighlight:case y.H_.ShadowExcludeHighlight:case y.H_.ViewshedShadow:t.include(_.w,e),(0,m.Zu)(t),t.varyings.add("depth","float"),r.code.add((0,U.H)(l||(l=(0,p.Z)(["void main() {\nvpos = calculateVPos();\ngl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n}"])))),t.include(g.f5,e),t.include(S.F,e),z.code.add((0,U.H)(u||(u=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\noutputDepth(depth);\n}"]))));break;case y.H_.ObjectAndLayerIdColor:t.include(g.f5,e),z.code.add((0,U.H)(c||(c=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\noutputObjectAndLayerIdColor();\n}"]))));break;case y.H_.Normal:t.include(_.w,e),t.include(E.n,e),(0,Z._8)(r),t.varyings.add("vnormal","vec3"),r.code.add((0,U.H)(h||(h=(0,p.Z)(["void main(void) {\nvpos = calculateVPos();\nvnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),t.include(g.f5,e),z.code.add((0,U.H)(d||(d=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\nvec3 normal = normalize(vnormal);\nif (gl_FrontFacing == false) normal = -normal;\nfragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n}"]))));break;case y.H_.Highlight:t.include(_.w,e),t.include(E.n,e),t.varyings.add("vnormal","vec3"),r.code.add((0,U.H)(f||(f=(0,p.Z)(["void main(void) {\nvpos = calculateVPos();\ngl_Position = transformPosition(proj, view, vpos);\n}"])))),t.include(g.f5,e),t.include(T.bA,e),z.code.add((0,U.H)(v||(v=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))}return t}var N=Object.freeze(Object.defineProperty({__proto__:null,build:z},Symbol.toStringTag,{value:"Module"}))},59771:function(e,t,r){r.d(t,{P:function(){return B},b:function(){return G}});var n,i,a,o,s,l,u,c,h,d,f,v,p,m,y,g,_,b,x,S=r(30168),T=r(37081),w=r(33280),P=r(94951),C=r(14801),O=r(48655),R=r(137),E=r(15226),k=r(18607),A=r(26461),Z=r(116),L=r(41012),I=r(95276),U=r(58406),M=r(98634),D=r(64201),z=r(25920),N=r(4760),F=r(17729),V=.70710678118,H=V;function G(e){var t=new D.kG,r=e.multipassEnabled&&e.output===T.H_.Color,G=t.vertex,B=t.fragment,j=t.attributes,W=t.varyings;(0,L.Sv)(G,e),t.include(P.w,e),t.include(O.c,e),t.include(k.k,e),t.include(C.R,e),e.draped?G.uniforms.add(new U.p("worldToScreenRatio",(function(e,t){return 1/t.screenToPCSRatio}))):j.add(N.T.BOUNDINGRECT,"mat3"),j.add(N.T.POSITION,"vec3"),j.add(N.T.UVMAPSPACE,"vec4"),e.vvColor&&j.add(N.T.COLORFEATUREATTRIBUTE,"float"),W.add("vColor","vec4"),W.add("vpos","vec3"),W.add("vuv","vec2"),r&&W.add("depth","float"),G.uniforms.add(new I.N("uColor",(function(e){return e.color})));var q=e.style===F.b.ForwardDiagonal||e.style===F.b.BackwardDiagonal||e.style===F.b.DiagonalCross;return q&&G.code.add((0,M.H)(n||(n=(0,S.Z)(["\n      const mat2 rotate45 = mat2(",", ",",\n                                 ",", ",");\n    "])),M.H.float(V),M.H.float(-H),M.H.float(H),M.H.float(V))),e.draped||((0,L.hY)(G,e),G.uniforms.add(new U.p("worldToScreenPerDistanceRatio",(function(e,t){return 1/t.camera.perScreenPixelRatio}))),G.code.add((0,M.H)(i||(i=(0,S.Z)(["vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {\nfloat projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);\nreturn center + halfVector * clamp(projectedLength, -1.0, 1.0);\n}"])))),G.code.add((0,M.H)(a||(a=(0,S.Z)(["vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {\nfloat d = dot(planeNormal, planePoint);\nfloat t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);\nreturn rayOrigin + t * rayDir;\n}"])))),G.code.add((0,M.H)(o||(o=(0,S.Z)(["\n      float boundingRectDistanceToCamera() {\n        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);\n        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);\n        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);\n        vec3 n = normalize(cross(halfU, halfV));\n\n        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);\n\n        float viewAngle = dot(viewDir, n);\n        float minViewAngle = ",";\n\n        if (abs(viewAngle) < minViewAngle) {\n          // view direction is (almost) parallel to plane -> clamp it to min angle\n          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;\n          viewDir = normalize(viewDir + normalComponent * n);\n        }\n\n        // intersect view direction with infinite plane that contains bounding rect\n        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);\n\n        // clip to bounds by projecting to u and v line segments individually\n        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);\n        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);\n\n        // use to calculate the closest point to camera on bounding rect\n        vec3 closestPoint = uProjected + vProjected - center;\n\n        return length(closestPoint - cameraPosition);\n      }\n    "])),M.H.float(.08715574274)))),G.code.add((0,M.H)(s||(s=(0,S.Z)(["\n    vec2 scaledUV() {\n      vec2 uv = uvMapSpace.xy ",";\n      vec2 uvCellOrigin = uvMapSpace.zw ",";\n\n      ","\n\n      // Logarithmically discretize ratio to avoid jittering\n      float step = 0.1;\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n\n      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ",");\n      return uvOffset + (uv * discreteWorldToScreenRatio);\n    }\n  "])),q?" * rotate45":"",q?" * rotate45":"",e.draped?"":(0,M.H)(l||(l=(0,S.Z)(["\n            float distanceToCamera = boundingRectDistanceToCamera();\n            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;\n          "]))),M.H.float(e.patternSpacing))),G.code.add((0,M.H)(u||(u=(0,S.Z)(["\n    void main(void) {\n      vuv = scaledUV();\n      vpos = position;\n      ","\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n      ","\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),r?"depth = (view * vec4(vpos, 1.0)).z;":"",e.hasVertexColors?"vColor *= uColor;":e.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;")),t.include(w.f5,e),B.include(Z.Y),e.draped&&B.uniforms.add(new U.p("texelSize",(function(e,t){return 1/t.camera.pixelRatio}))),e.output===T.H_.Highlight&&t.include(R.bA,e),r&&t.include(E.l,e),e.output!==T.H_.Highlight&&(B.code.add((0,M.H)(c||(c=(0,S.Z)(["\n      const float lineWidth = ",";\n      const float spacing = ",";\n      const float spacingINV = ",";\n\n      float coverage(float p, float txlSize) {\n        p = mod(p, spacing);\n\n        float halfTxlSize = txlSize / 2.0;\n\n        float start = p - halfTxlSize;\n        float end = p + halfTxlSize;\n\n        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;\n        coverage -= min(lineWidth, mod(start, spacing));\n        coverage -= max(lineWidth - mod(end, spacing), 0.0);\n\n        return coverage / txlSize;\n      }\n    "])),M.H.float(e.lineWidth),M.H.float(e.patternSpacing),M.H.float(1/e.patternSpacing))),e.draped||B.code.add((0,M.H)(h||(h=(0,S.Z)(["const int maxSamples = 5;\nfloat sampleAA(float p) {\nvec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));\nfloat fwidth = dxdy.x + dxdy.y;\nivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));\nvec2 invSamples = 1.0 / vec2(samples);\nfloat accumulator = 0.0;\nfor (int j = 0; j < maxSamples; j++) {\nif(j >= samples.y) {\nbreak;\n}\nfor (int i = 0; i < maxSamples; i++) {\nif(i >= samples.x) {\nbreak;\n}\nvec2 step = vec2(i,j) * invSamples - 0.5;\naccumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);\n}\n}\naccumulator /= float(samples.x * samples.y);\nreturn accumulator;\n}"]))))),e.transparencyPassType===z.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),B.code.add((0,M.H)(d||(d=(0,S.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      vec4 color = vColor;\n      color = highlightSlice(color, vpos);\n\n      ","\n\n      ","\n\n      if (color.a < ",") {\n        discard;\n      }\n\n      ","\n      ","\n      ","\n    }\n  "])),r?"terrainDepthTest(depth);":"",e.output!==T.H_.Highlight?(0,M.H)(f||(f=(0,S.Z)(["color.a *= ",";"])),function(e){function t(t){return e.draped?(0,M.H)(_||(_=(0,S.Z)(["coverage(vuv.",", texelSize)"])),t):(0,M.H)(b||(b=(0,S.Z)(["sampleAA(vuv.",")"])),t)}switch(e.style){case F.b.ForwardDiagonal:case F.b.Horizontal:return t("y");case F.b.BackwardDiagonal:case F.b.Vertical:return t("x");case F.b.DiagonalCross:case F.b.Cross:return(0,M.H)(x||(x=(0,S.Z)(["\n        1.0 - (1.0 - ",") * (1.0 - ",")\n      "])),t("x"),t("y"));default:return"0.0"}}(e)):"",e.output===T.H_.ObjectAndLayerIdColor?(0,M.H)(v||(v=(0,S.Z)(["color.a = 1.0;"]))):"",M.H.float(A.b),e.output===T.H_.Color?(0,M.H)(p||(p=(0,S.Z)(["fragColor = color; ",""])),e.transparencyPassType===z.A.ColorAlpha?(0,M.H)(m||(m=(0,S.Z)(["\n                    fragColor = premultiplyAlpha(fragColor);\n                    fragAlpha = fragColor.a;"]))):""):"",e.output===T.H_.Highlight?(0,M.H)(y||(y=(0,S.Z)(["outputHighlight();"]))):"",e.output===T.H_.ObjectAndLayerIdColor?(0,M.H)(g||(g=(0,S.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}var B=Object.freeze(Object.defineProperty({__proto__:null,build:G},Symbol.toStringTag,{value:"Module"}))},49810:function(e,t,r){r.d(t,{W:function(){return F},b:function(){return N}});var n,i,a,o,s,l,u,c,h,d,f,v,p=r(30168),m=r(22357),y=r(37081),g=r(33280),_=r(94951),b=r(14801),x=r(137),S=r(60750),T=r(92395),w=r(15226),P=r(8555),C=r(41481),O=r(93511),R=r(15107),E=r(79246),k=r(26461),A=r(116),Z=r(41012),L=r(95276),I=r(58406),U=r(98634),M=r(64201),D=r(25920),z=r(4760);function N(e){var t=new M.kG,r=t.vertex,N=t.fragment;(0,Z.Sv)(r,e),t.include(_.w,e),t.attributes.add(z.T.POSITION,"vec3"),t.attributes.add(z.T.UV0,"vec2");var F=new L.N("waterColor",(function(e){return e.color}));if(e.output===y.H_.Color&&e.draped)return t.varyings.add("vpos","vec3"),r.uniforms.add(F),r.code.add((0,U.H)(n||(n=(0,p.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),U.H.float(k.b))),N.uniforms.add(F),N.code.add((0,U.H)(i||(i=(0,p.Z)(["void main() {\nfragColor = waterColor;\n}"])))),t;switch(e.output===y.H_.Color&&(t.include(P.n,e),t.include(m.qj,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassEnabled&&t.varyings.add("depth","float"),r.uniforms.add(F),r.code.add((0,U.H)(a||(a=(0,p.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),U.H.float(k.b),e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===y.H_.Color?"forwardLinearDepth();":""))),t.include(w.l,e),e.output){case y.H_.Color:t.include(T.kR),t.include(S._,{pbrMode:C.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(E.M),t.include(g.f5,e),t.include(O.XE,e),t.include(R.B,e),N.uniforms.add(F,new I.p("timeElapsed",(function(e){return e.timeElapsed})),r.uniforms.get("view"),r.uniforms.get("localOrigin")),(0,Z.hY)(N,e),N.include(A.Y),e.transparencyPassType===D.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),(0,T.Pe)(N),(0,T.F1)(N),N.code.add((0,U.H)(o||(o=(0,p.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - cameraPosition);\n        float shadow = ",";\n        vec4 vPosView = view * vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);\n\n        // gamma correction\n        fragColor = delinearizeGamma(final);\n        fragColor = highlightSlice(fragColor, vpos);\n        ","\n      }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",e.receiveShadows?(0,U.H)(s||(s=(0,p.Z)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.transparencyPassType===D.A.ColorAlpha?(0,U.H)(l||(l=(0,p.Z)(["\n                fragColor = premultiplyAlpha(fragColor);\n                fragAlpha = fragColor.a;"]))):""));break;case y.H_.Normal:t.include(P.n,e),t.include(E.M,e),t.include(g.f5,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.uniforms.add(F),r.code.add((0,U.H)(u||(u=(0,p.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),U.H.float(k.b))),N.uniforms.add(new I.p("timeElapsed",(function(e){return e.timeElapsed}))),N.code.add((0,U.H)(c||(c=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\nfragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))));break;case y.H_.Highlight:t.include(x.bA,e),t.varyings.add("vpos","vec3"),r.uniforms.add(F),r.code.add((0,U.H)(h||(h=(0,p.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),U.H.float(k.b))),t.include(g.f5,e),N.code.add((0,U.H)(d||(d=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))));break;case y.H_.ObjectAndLayerIdColor:t.include(b.R,e),t.varyings.add("vpos","vec3"),r.uniforms.add(F),r.code.add((0,U.H)(f||(f=(0,p.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardObjectAndLayerIdColor();\n      }\n    "])),U.H.float(k.b))),t.include(g.f5,e),N.code.add((0,U.H)(v||(v=(0,p.Z)(["void main() {\ndiscardBySlice(vpos);\noutputObjectAndLayerIdColor();\n}"]))))}return t}var F=Object.freeze(Object.defineProperty({__proto__:null,build:N},Symbol.toStringTag,{value:"Module"}))},51e3:function(e,t,r){r.d(t,{Jl:function(){return v},n$:function(){return g},r7:function(){return f}});var n=r(74165),i=r(1413),a=r(15861),o=r(76200),s=r(10064),l=r(66978),u=r(35995),c=r(1370),h=null,d=!0;function f(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(d)try{return new ImageData(e,t)}catch(n){d=!1}return p(e,t,r)}function v(e,t,r,n){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(d)try{return new ImageData(e,t,r)}catch(h){d=!1}var i=p(t,r,n);return i.data.set(e,0),i}function p(e,t,r){return r||(h||((h=document.createElement("canvas")).width=1,h.height=1),r=h),r.getContext("2d").createImageData(e,t)}function m(e,t){return y.apply(this,arguments)}function y(){return y=(0,a.Z)((0,n.Z)().mark((function e(t,r){var a,u,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=window.URL.createObjectURL(t),e.prev=1,e.next=4,(0,o.Z)(a,(0,i.Z)((0,i.Z)({},r),{},{responseType:"image"}));case 4:return u=e.sent,c=u.data,e.abrupt("return",c);case 9:if(e.prev=9,e.t0=e.catch(1),(0,l.D_)(e.t0)){e.next=13;break}throw new s.Z("invalid-image","Could not fetch requested image at ".concat(a));case 13:throw e.t0;case 14:return e.prev=14,window.URL.revokeObjectURL(a),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,9,14,17]])}))),y.apply(this,arguments)}function g(e,t){return _.apply(this,arguments)}function _(){return(_=(0,a.Z)((0,n.Z)().mark((function e(t,i){var a,o,s,l,u,c,h,d,f,v;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(t,i);case 2:if(a=e.sent,o=a.arrayBuffer,s=a.mediaType,l="image/png"===s,"image/gif"!==s){e.next=14;break}return e.next=9,r.e(71625).then(r.bind(r,71625));case 9:if(u=e.sent,c=u.isAnimatedGIF,h=u.parseGif,!c(o)){e.next=14;break}return e.abrupt("return",h(o,i));case 14:if(!l){e.next=22;break}return e.next=17,r.e(35920).then(r.bind(r,35920));case 17:if(d=e.sent,f=d.isAnimatedPNG,v=d.parseApng,!f(o)){e.next=22;break}return e.abrupt("return",v(o,i));case 22:return e.abrupt("return",m(new Blob([o],{type:s}),i));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t){return x.apply(this,arguments)}function x(){return x=(0,a.Z)((0,n.Z)().mark((function e(t,r){var a,s,l,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(l=(0,u.sJ)(t))||void 0===l||!l.isBase64){e.next=3;break}return e.abrupt("return",{arrayBuffer:(0,c.R)(l.data),mediaType:l.mediaType});case 3:return e.next=5,(0,o.Z)(t,(0,i.Z)({responseType:"array-buffer"},r));case 5:return h=e.sent,e.abrupt("return",{arrayBuffer:h.data,mediaType:null!==(a=null===(s=h.getHeader)||void 0===s?void 0:s.call(h,"Content-Type"))&&void 0!==a?a:""});case 7:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}},77258:function(e,t,r){r.d(t,{d:function(){return s}});var n=r(12400),i=r(50628),a=r(65156),o=r(92975);function s(e,t,r,n){return null!=e&&((0,o.fS)(t,n)?((0,a.JG)(r,e),!0):(l[0]=e[0],l[1]=e[1],l[2]=0,!!(0,i.projectBuffer)(l,t,0,l,n,0,1)&&(r[0]=l[0],r[1]=l[1],l[0]=e[2],l[1]=e[3],l[2]=0,!!(0,i.projectBuffer)(l,t,0,l,n,0,1)&&(r[2]=l[0],r[3]=l[1],!0))))}var l=(0,n.Ue)()},5629:function(e,t,r){r.d(t,{A:function(){return u},f:function(){return l}});var n=r(74165),i=r(15861),a=r(12400),o=r(79803),s=r(5986);function l(e,t,r){return!!(0,s.S)(e,t,h,r.spatialReference)&&(r.x=h[0],r.y=h[1],r.z=h[2],!0)}function u(e,t,r,n){return c.apply(this,arguments)}function c(){return c=(0,i.Z)((0,n.Z)().mark((function e(t,r,i,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.initializeProjection)(r,i.spatialReference,null,a);case 2:return e.abrupt("return",l(t,r,i));case 3:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}var h=(0,a.Ue)()},64995:function(e,t,r){r.d(t,{Z:function(){return b}});var n,i=r(15671),a=r(43144),o=r(60136),s=r(29388),l=r(27366),u=r(46784),c=r(84652),h=r(32718),d=r(49861),f=r(89125),v=r(69912),p=r(25243),m=r(10891),y=r(11587),g=r(27474),_=n=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).faces=null,n.material=null,n.name=void 0,n.shading="source",n.trustSourceNormals=!1,n}return(0,a.Z)(r,[{key:"castFaces",value:function(e){return(0,g.X)(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},h.Z.getLogger(this))}},{key:"castMaterial",value:function(e){return(0,p.TJ)(e&&"object"==typeof e&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?y.Z:m.Z,e)}},{key:"clone",value:function(){return new n({faces:(0,c.d9)(this.faces),shading:this.shading,material:(0,c.d9)(this.material),trustSourceNormals:this.trustSourceNormals,name:this.name})}},{key:"cloneWithDeduplication",value:function(e,t){var r={faces:(0,c.d9)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals,name:this.name};return new n(r)}},{key:"memoryUsage",get:function(){var e=0;return null!=this.faces&&(e+=this.faces.byteLength),null!=this.material&&(e+=this.material.memoryUsage),e}}],[{key:"from",value:function(e){return(0,p.TJ)(n,e)}}]),r}(u.wq);(0,l._)([(0,d.Cb)({json:{write:!0}})],_.prototype,"faces",void 0),(0,l._)([(0,f.p)("faces")],_.prototype,"castFaces",null),(0,l._)([(0,d.Cb)({type:m.Z,json:{write:!0}})],_.prototype,"material",void 0),(0,l._)([(0,f.p)("material")],_.prototype,"castMaterial",null),(0,l._)([(0,d.Cb)()],_.prototype,"name",void 0),(0,l._)([(0,d.Cb)({type:String,json:{write:!0}})],_.prototype,"shading",void 0),(0,l._)([(0,d.Cb)({type:Boolean})],_.prototype,"trustSourceNormals",void 0);var b=_=n=(0,l._)([(0,v.j)("esri.geometry.support.MeshComponent")],_)},10891:function(e,t,r){r.d(t,{Z:function(){return m}});var n,i=r(15671),a=r(43144),o=r(60136),s=r(29388),l=r(27366),u=r(51995),c=r(46784),h=r(49861),d=(r(93169),r(32718),r(84936),r(69912)),f=r(79694),v=r(50565),p=n=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).color=null,n.colorTexture=null,n.colorTextureTransform=null,n.normalTexture=void 0,n.normalTextureTransform=void 0,n.alphaMode="auto",n.alphaCutoff=.5,n.doubleSided=!0,n}return(0,a.Z)(r,[{key:"clone",value:function(){return this.cloneWithDeduplication(null,new Map)}},{key:"cloneWithDeduplication",value:function(e,t){var r=null!=e?e.get(this):null;if(r)return r;var i=new n(this.clonePropertiesWithDeduplication(t));return null!=e&&e.set(this,i),i}},{key:"clonePropertiesWithDeduplication",value:function(e){var t,r,n,i;return{color:null!=this.color?this.color.clone():null,colorTexture:null===(t=this.colorTexture)||void 0===t?void 0:t.cloneWithDeduplication(e),normalTexture:null===(r=this.normalTexture)||void 0===r?void 0:r.cloneWithDeduplication(e),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:null===(n=this.colorTextureTransform)||void 0===n?void 0:n.clone(),normalTextureTransform:null===(i=this.normalTextureTransform)||void 0===i?void 0:i.clone()}}},{key:"memoryUsage",get:function(){return this.getMemoryUsage()}},{key:"getMemoryUsage",value:function(){var e=0;return e+=null!=this.color?16:0,null!=this.colorTexture&&(e+=this.colorTexture.memoryUsage),e+=null!=this.colorTextureTransform?20:0,null!=this.normalTexture&&(e+=this.normalTexture.memoryUsage),e+=null!=this.normalTextureTransform?20:0}}]),r}(c.wq);(0,l._)([(0,h.Cb)({type:u.Z,json:{write:!0}})],p.prototype,"color",void 0),(0,l._)([(0,h.Cb)({type:f.Z,json:{write:!0}})],p.prototype,"colorTexture",void 0),(0,l._)([(0,h.Cb)({type:v.Z,json:{write:!0}})],p.prototype,"colorTextureTransform",void 0),(0,l._)([(0,h.Cb)({type:f.Z,json:{write:!0}})],p.prototype,"normalTexture",void 0),(0,l._)([(0,h.Cb)({type:v.Z,json:{write:!0}})],p.prototype,"normalTextureTransform",void 0),(0,l._)([(0,h.Cb)({nonNullable:!0,json:{write:!0}})],p.prototype,"alphaMode",void 0),(0,l._)([(0,h.Cb)({nonNullable:!0,json:{write:!0}})],p.prototype,"alphaCutoff",void 0),(0,l._)([(0,h.Cb)({nonNullable:!0,json:{write:!0}})],p.prototype,"doubleSided",void 0);var m=p=n=(0,l._)([(0,d.j)("esri.geometry.support.MeshMaterial")],p)},11587:function(e,t,r){r.d(t,{Z:function(){return _}});var n,i=r(1413),a=r(15671),o=r(43144),s=r(88301),l=r(61120),u=r(60136),c=r(29388),h=r(27366),d=r(51995),f=r(49861),v=(r(93169),r(32718),r(84936),r(69912)),p=r(10891),m=r(79694),y=r(50565),g=n=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).emissiveColor=null,n.emissiveTexture=null,n.emissiveTextureTransform=void 0,n.occlusionTexture=null,n.occlusionTextureTransform=void 0,n.metallic=1,n.roughness=1,n.metallicRoughnessTexture=null,n.metallicRoughnessTextureTransform=void 0,n}return(0,o.Z)(r,[{key:"clone",value:function(){return this.cloneWithDeduplication(null,new Map)}},{key:"cloneWithDeduplication",value:function(e,t){var r=null!=e?e.get(this):null;if(r)return r;var i=new n(this.clonePropertiesWithDeduplication(t));return null!=e&&e.set(this,i),i}},{key:"getMemoryUsage",value:function(){var e=(0,s.Z)((0,l.Z)(r.prototype),"getMemoryUsage",this).call(this);return e+=null!=this.emissiveColor?16:0,null!=this.emissiveTexture&&(e+=this.emissiveTexture.memoryUsage),e+=null!=this.emissiveTextureTransform?20:0,null!=this.occlusionTexture&&(e+=this.occlusionTexture.memoryUsage),e+=null!=this.occlusionTextureTransform?20:0,null!=this.metallicRoughnessTexture&&(e+=this.metallicRoughnessTexture.memoryUsage),e+=null!=this.metallicRoughnessTextureTransform?20:0}},{key:"clonePropertiesWithDeduplication",value:function(e){var t,n,a,o,u,c,h;return(0,i.Z)((0,i.Z)({},(0,s.Z)((0,l.Z)(r.prototype),"clonePropertiesWithDeduplication",this).call(this,e)),{},{emissiveColor:null===(t=this.emissiveColor)||void 0===t?void 0:t.clone(),emissiveTexture:null===(n=this.emissiveTexture)||void 0===n?void 0:n.cloneWithDeduplication(e),emissiveTextureTransform:null===(a=this.emissiveTextureTransform)||void 0===a?void 0:a.clone(),occlusionTexture:null===(o=this.occlusionTexture)||void 0===o?void 0:o.cloneWithDeduplication(e),occlusionTextureTransform:null===(u=this.occlusionTextureTransform)||void 0===u?void 0:u.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:null===(c=this.metallicRoughnessTexture)||void 0===c?void 0:c.cloneWithDeduplication(e),metallicRoughnessTextureTransform:null===(h=this.metallicRoughnessTextureTransform)||void 0===h?void 0:h.clone()})}}]),r}(p.Z);(0,h._)([(0,f.Cb)({type:d.Z,json:{write:!0}})],g.prototype,"emissiveColor",void 0),(0,h._)([(0,f.Cb)({type:m.Z,json:{write:!0}})],g.prototype,"emissiveTexture",void 0),(0,h._)([(0,f.Cb)({type:y.Z,json:{write:!0}})],g.prototype,"emissiveTextureTransform",void 0),(0,h._)([(0,f.Cb)({type:m.Z,json:{write:!0}})],g.prototype,"occlusionTexture",void 0),(0,h._)([(0,f.Cb)({type:y.Z,json:{write:!0}})],g.prototype,"occlusionTextureTransform",void 0),(0,h._)([(0,f.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],g.prototype,"metallic",void 0),(0,h._)([(0,f.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],g.prototype,"roughness",void 0),(0,h._)([(0,f.Cb)({type:m.Z,json:{write:!0}})],g.prototype,"metallicRoughnessTexture",void 0),(0,h._)([(0,f.Cb)({type:y.Z,json:{write:!0}})],g.prototype,"metallicRoughnessTextureTransform",void 0);var _=g=n=(0,h._)([(0,v.j)("esri.geometry.support.MeshMaterialMetallicRoughness")],g)},79694:function(e,t,r){r.d(t,{Z:function(){return T}});var n,i=r(15671),a=r(43144),o=r(60136),s=r(29388),l=r(27366),u=(r(93169),r(51e3)),c=r(46784),h=r(49861),d=r(25243),f=(r(84936),r(38511)),v=r(69912),p=r(31201),m=r(53283),y=new WeakMap,g=0,_=n=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).wrap="repeat",n}return(0,a.Z)(r,[{key:"url",get:function(){return this._get("url")||null},set:function(e){this._set("url",e),e&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(e){this._set("data",e),e&&this._set("url",null)}},{key:"writeData",value:function(e,t,r,n){if(e instanceof HTMLImageElement){var i={type:"image-element",src:(0,m.t)(e.src,n),crossOrigin:e.crossOrigin};t[r]=i}else if(e instanceof HTMLCanvasElement){var a={type:"canvas-element",imageData:b(e.getContext("2d").getImageData(0,0,e.width,e.height))};t[r]=a}else if(e instanceof HTMLVideoElement){var o={type:"video-element",src:(0,m.t)(e.src,n),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[r]=o}else if(e instanceof ImageData){var s={type:"image-data",imageData:b(e)};t[r]=s}}},{key:"readData",value:function(e){switch(e.type){case"image-element":var t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t;case"canvas-element":var r=x(e.imageData),n=document.createElement("canvas");return n.width=r.width,n.height=r.height,n.getContext("2d").putImageData(r,0,0),n;case"image-data":return x(e.imageData);case"video-element":var i=document.createElement("video");return i.src=e.src,i.crossOrigin=e.crossOrigin,i.autoplay=e.autoplay,i.loop=e.loop,i.muted=e.muted,i.preload=e.preload,i;default:return}}},{key:"transparent",get:function(){var e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return S(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return S(e);if(t){var r=t.substr(t.length-4,4).toLowerCase(),n=t.substr(0,15).toLocaleLowerCase();if(".png"===r||"data:image/png;"===n)return!0}return!1},set:function(e){this._overrideIfSome("transparent",e)}},{key:"contentHash",get:function(){var e=this,t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?"".concat(this.wrap.horizontal,"/").concat(this.wrap.vertical):"",r=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"d:".concat(r,",t:").concat(e.transparent,",w:").concat(t)};return null!=this.url?r(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?r(this.data.src):(y.has(this.data)||y.set(this.data,++g),r(y.get(this.data))):r()}},{key:"memoryUsage",get:function(){var e=0;if(e+=null!=this.url?this.url.length:0,null!=this.data){var t=this.data;"data"in t?e+=t.data.byteLength:t instanceof HTMLImageElement?e+=t.naturalWidth*t.naturalHeight*3:t instanceof HTMLCanvasElement&&(e+=t.width*t.height*3)}return e}},{key:"clone",value:function(){var e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new n(e)}},{key:"cloneWithDeduplication",value:function(e){var t=e.get(this);if(t)return t;var r=this.clone();return e.set(this,r),r}},{key:"_cloneWrap",value:function(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}}],[{key:"from",value:function(e){return"string"==typeof e?new n({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new n({data:e}):(0,d.TJ)(n,e)}}]),r}(c.wq);function b(e){for(var t="",r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}}function x(e){for(var t=atob(e.data),r=new Uint8ClampedArray(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return(0,u.Jl)(r,e.width,e.height)}function S(e){for(var t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1}(0,l._)([(0,h.Cb)({type:String,json:{write:m.w}})],_.prototype,"url",null),(0,l._)([(0,h.Cb)({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),(0,h.Cb)()],_.prototype,"data",null),(0,l._)([(0,p.c)("data")],_.prototype,"writeData",null),(0,l._)([(0,f.r)("data")],_.prototype,"readData",null),(0,l._)([(0,h.Cb)({type:Boolean,json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],_.prototype,"transparent",null),(0,l._)([(0,h.Cb)({json:{write:!0}})],_.prototype,"wrap",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],_.prototype,"contentHash",null);var T=_=n=(0,l._)([(0,v.j)("esri.geometry.support.MeshTexture")],_)},50565:function(e,t,r){r.d(t,{Z:function(){return f}});var n=r(43144),i=r(15671),a=r(60136),o=r(29388),s=r(27366),l=r(11582),u=r(46784),c=r(49861),h=(r(93169),r(32718),r(84936),r(69912)),d=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).offset=[0,0],n.rotation=0,n.scale=[1,1],n}return(0,n.Z)(r)}((0,l.J)(u.wq));(0,s._)([(0,c.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],d.prototype,"offset",void 0),(0,s._)([(0,c.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],d.prototype,"rotation",void 0),(0,s._)([(0,c.Cb)({type:[Number],nonNullable:!0,json:{write:!0}})],d.prototype,"scale",void 0);var f=d=(0,s._)([(0,h.j)("esri.geometry.support.MeshTextureTransform")],d)},5354:function(e,t,r){r.d(t,{Ku:function(){return d},Wt:function(){return u},qC:function(){return m},vu:function(){return l}});r(93169);var n,i,a=r(10064),o=r(90724),s=r(25899);function l(e,t){if(!e)return null;if(!h(e))return new a.Z("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});var r=e.heightUnit,n=o.Z.deriveUnitFromSR(e,t).heightUnit;return r!==n?new a.Z("webscene:incompatible-height-unit","The vertical units of the scene (".concat(r,") must match the horizontal units of the scene (").concat(n,")"),{verticalUnit:r,horizontalUnit:n}):null}function u(e,t,r){var i,s=d(e),l=t,u=c(s,l,r);if(s){var h=o.Z.deriveUnitFromSR(s,e.spatialReference).heightUnit;if(!r&&h!==s.heightUnit){var f=new a.Z("layerview:unmatched-height-unit","The vertical units of the layer must match the horizontal units (".concat(h,")"),{horizontalUnit:h});return new a.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:s,error:f})}}if(!("heightModelInfo"in(i=e)&&null!=i.heightModelInfo||null!=i.spatialReference)&&p(i)||u===n.Unsupported)return new a.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:s});switch(u){case n.Units:var v=(null===s||void 0===s?void 0:s.heightUnit)||"unknown",m=(null===l||void 0===l?void 0:l.heightUnit)||"unknown",y=new a.Z("layerview:incompatible-height-unit","The vertical units of the layer (".concat(v,") must match the vertical units of the scene (").concat(m,")"),{layerUnit:v,sceneUnit:m});return new a.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:l,error:y});case n.HeightModel:var g=(null===s||void 0===s?void 0:s.heightModel)||"unknown",_=(null===l||void 0===l?void 0:l.heightModel)||"unknown",b=new a.Z("layerview:incompatible-height-model","The height model of the layer (".concat(g,") must match the height model of the scene (").concat(_,")"),{layerHeightModel:g,sceneHeightModel:_});return new a.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:l,error:b});case n.CRS:var x=(null===s||void 0===s?void 0:s.vertCRS)||"unknown",S=(null===l||void 0===l?void 0:l.vertCRS)||"unknown",T=new a.Z("layerview:incompatible-vertical-datum","The vertical datum of the layer (".concat(x,") must match the vertical datum of the scene (").concat(S,")"),{layerDatum:x,sceneDatum:S});return new a.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:s,sceneHeightModelInfo:l,error:T})}return null}function c(e,t,r){if(!h(e)||!h(t))return n.Unsupported;if(null==e||null==t)return n.Ok;if(!r&&e.heightUnit!==t.heightUnit)return n.Units;if(e.heightModel!==t.heightModel)return n.HeightModel;switch(e.heightModel){case"gravity-related-height":return n.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?n.Ok:n.CRS;default:return n.Unsupported}}function h(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function d(e){var t;if("integrated-mesh-3dtiles"===e.type)return null;var r=e.url?(0,s.Qc)(e.url):void 0;return(null!=(null===(t=e.spatialReference)||void 0===t?void 0:t.vcsWkid)||null==r||"ImageServer"!==r.serverType)&&f(e)&&e.heightModelInfo?e.heightModelInfo:p(e)?o.Z.deriveUnitFromSR(g,e.spatialReference):null}function f(e){return"heightModelInfo"in e}function v(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function p(e){return v(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):y(e)}function m(e){return null!=e.layers||y(e)||v(e)||f(e)}function y(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"integrated-mesh-3dtiles":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"catalog":case"catalog-footprint":case"catalog-dynamic-group":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(i=n||(n={}))[i.Ok=0]="Ok",i[i.Units=1]="Units",i[i.HeightModel=2]="HeightModel",i[i.CRS=3]="CRS",i[i.Unsupported=4]="Unsupported";var g=new o.Z({heightModel:"gravity-related-height"})},35888:function(e,t,r){r.d(t,{d:function(){return a}});var n=r(16889),i=r(39406);function a(e,t,r){var a,c=Array.isArray(e),h=c?e.length/t:e.byteLength/(4*t),d=c?e:new Uint32Array(e,0,h*t),f=null!==(a=null===r||void 0===r?void 0:r.minReduction)&&void 0!==a?a:0,v=(null===r||void 0===r?void 0:r.originalIndices)||null,p=v?v.length:0,m=(null===r||void 0===r?void 0:r.componentOffsets)||null,y=0;if(m)for(var g=0;g<m.length-1;g++){var _=m[g+1]-m[g];_>y&&(y=_)}else y=h;var b=Math.floor(1.1*y)+1;(null==u||u.length<2*b)&&(u=new Uint32Array((0,n.Sf)(2*b)));for(var x=0;x<2*b;x++)u[x]=0;for(var S=0,T=!!m&&!!v,w=T?p:h,P=(0,i.$z)(h),C=new Uint32Array(p),O=1.96,R=0!==f?Math.ceil(4*O*O/(f*f)*f*(1-f)):w,E=1,k=m?m[1]:w,A=0;A<w;A++){if(A===R){var Z=1-S/A;if(Z+O*Math.sqrt(Z*(1-Z)/A)<f)return null;R*=2}if(A===k){for(var L=0;L<2*b;L++)u[L]=0;if(v)for(var I=m[E-1];I<m[E];I++)C[I]=P[v[I]];k=m[++E]}for(var U=T?v[A]:A,M=U*t,D=l(d,M,t),z=D%b,N=S;0!==u[2*z+1];){if(u[2*z]===D){var F=u[2*z+1]-1;if(o(d,M,F*t,t)){N=P[F];break}}++z>=b&&(z-=b)}N===S&&(u[2*z]=D,u[2*z+1]=U+1,S++),P[U]=N}if(0!==f&&1-S/h<f)return null;if(T){for(var V=m[E-1];V<C.length;V++)C[V]=P[v[V]];P=(0,i.mi)(C)}var H=c?new Array(S):new Uint32Array(S*t);S=0;for(var G=0;G<w;G++)P[G]===S&&(s(d,(T?v[G]:G)*t,H,S*t,t),S++);if(v&&!T){for(var B=new Uint32Array(p),j=0;j<B.length;j++)B[j]=P[v[j]];P=(0,i.mi)(B)}return{buffer:Array.isArray(H)?H:H.buffer,indices:P,uniqueCount:S}}function o(e,t,r,n){for(var i=0;i<n;i++)if(e[t+i]!==e[r+i])return!1;return!0}function s(e,t,r,n,i){for(var a=0;a<i;a++)r[n+a]=e[t+a]}function l(e,t,r){for(var n=0,i=0;i<r;i++)n=(n=e[t+i]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}var u=null},26844:function(e,t,r){r.d(t,{i:function(){return l}});var n=r(16889),i=r(68860),a=r(32035),o=r(14320),s=r(55652);function l(e,t,r){var l=function(e,t,r,n){var o=function(e){return!Array.isArray(e[0])}(t)?function(e,r){return t[3*e+r]}:function(e,r){return t[e][r]},l=n?(0,i.c9)(n)/(0,i._R)(n):1;return(0,s.zu)(e,(function(e,t){return(0,a.s)(e,o(t,0)*l,o(t,1)*l,o(t,2))}),r)}(u,e,t,r)?(0,s.st)(u):[0,0,1];return Math.abs(l[2])>Math.cos((0,n.Vl)(80))?o.R.Z:Math.abs(l[1])>Math.abs(l[0])?o.R.Y:o.R.X}var u=(0,s.Ue)()},91320:function(e,t,r){r.d(t,{Ni:function(){return v},ZI:function(){return n},bT:function(){return f}});var n,i,a=r(37762),o=r(79347),s=r(14320),l=r(69662),u=r(86372),c=r(39406),h=r(26844),d=r(35888);function f(e){var t,r=v(e.rings,e.hasZ,n.CCW_IS_HOLE,e.spatialReference),i=new Array,s=0,l=0,h=(0,a.Z)(r.polygons);try{var f=function(){var e=t.value,n=e.count,a=e.index,h=(0,u.Rq)(r.position,3*a,3*n),d=e.holeIndices.map((function(e){return e-a})),f=(0,c.mi)((0,o.e)(h,d,3));i.push({position:h,faces:f}),s+=h.length,l+=f.length};for(h.s();!(t=h.n()).done;)f()}catch(y){h.e(y)}finally{h.f()}var p=function(e,t,r){if(1===e.length)return e[0];var n,i=(0,u.bg)(t),o=new Array(r),s=0,l=0,h=0,d=(0,a.Z)(e);try{for(d.s();!(n=d.n()).done;){for(var f=n.value,v=0;v<f.position.length;v++)i[s++]=f.position[v];var p,m=(0,a.Z)(f.faces);try{for(m.s();!(p=m.n()).done;){var g=p.value;o[l++]=g+h}}catch(y){m.e(y)}finally{m.f()}h=s/3}}catch(y){d.e(y)}finally{d.f()}return{position:i,faces:(0,c.mi)(o)}}(i,s,l),m=Array.isArray(p.position)?(0,d.d)(p.position,3,{originalIndices:p.faces}):(0,d.d)(p.position.buffer,6,{originalIndices:p.faces});return p.position=(0,u.QZ)(new Float64Array(m.buffer)),p.faces=m.indices,p}function v(e,t,r,i){for(var a=e.length,o=new Array(a),s=new Array(a),l=new Array(a),c=0,h=0;h<a;++h)c+=e[h].length;for(var d=0,f=0,v=0,y=(0,u.bg)(3*c),g=0,_=a-1;_>=0;_--){var b=e[_],x=r===n.CCW_IS_HOLE&&m(b,t,i);if(x&&1!==a)o[d++]=b;else{for(var S=b.length,T=0;T<d;++T)S+=o[T].length;var w={index:g,pathLengths:new Array(d+1),count:S,holeIndices:new Array(d)};w.pathLengths[0]=b.length,b.length>0&&(l[v++]={index:g,count:b.length}),g=x?p(b,b.length-1,-1,y,g,b.length,t):p(b,0,1,y,g,b.length,t);for(var P=0;P<d;++P){var C=o[P];w.holeIndices[P]=g,w.pathLengths[P+1]=C.length,C.length>0&&(l[v++]={index:g,count:C.length}),g=p(C,0,1,y,g,C.length,t)}d=0,w.count>0&&(s[f++]=w)}}for(var O=0;O<d;++O){var R=o[O];R.length>0&&(l[v++]={index:g,count:R.length}),g=p(R,0,1,y,g,R.length,t)}return s.length=f,l.length=v,{position:y,polygons:s,outlines:l}}function p(e,t,r,n,i,a,o){i*=3;for(var s=0;s<a;++s){var l=e[t];n[i++]=l[0],n[i++]=l[1],n[i++]=o?l[2]:0,t+=r}return i/3}function m(e,t,r){if(!t)return!(0,l.bu)(e);var n=e.length-1;switch((0,h.i)(e,n,r)){case s.R.X:return!(0,l.bu)(e,s.R.Y,s.R.Z);case s.R.Y:return!(0,l.bu)(e,s.R.X,s.R.Z);case s.R.Z:return!(0,l.bu)(e,s.R.X,s.R.Y)}}(i=n||(n={}))[i.NONE=0]="NONE",i[i.CCW_IS_HOLE=1]="CCW_IS_HOLE"},34311:function(e,t,r){function n(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function i(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return{objectId:e,target:t,distance:r,type:"edge",start:n,end:i,draped:a}}r.d(t,{p:function(){return i},u:function(){return n}})},65618:function(e,t,r){r.d(t,{FS:function(){return T},MS:function(){return P},PA:function(){return g},Pj:function(){return y},R3:function(){return x},S6:function(){return m},TF:function(){return w},Wh:function(){return p},Xw:function(){return b},_0:function(){return C},dF:function(){return S}});var n=r(37762),i=r(43144),a=r(15671),o=r(59896),s=(r(93169),r(18722)),l=r(95439),u=r(78952),c=r(41414),h=r(65156),d=r(58971),f=r(27823),v=r(83040),p=(r(70178),(0,i.Z)((function e(t,r,n){(0,a.Z)(this,e),this.uid=t,this.geometry=r,this.attributes=n,this.visible=!0,this.objectId=null,this.centroid=null})));function m(e){return null!=e.geometry}var y=(0,i.Z)((function e(){(0,a.Z)(this,e),this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}));function g(e,t){var r,n,i,a=f.M.fromJSON(e.geometryType),o=u.Z.fromJSON(e.spatialReference),s=e.transform,c=e.objectIdFieldName,h=null===t||void 0===t?void 0:t.maxStringAttributeLength,p=null===t||void 0===t?void 0:t.maxStringAttributeFields,m=e.features.map((function(t){var r=function(e,t,r,n){return{uid:(0,l.D)(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:_(e.geometry,t,r),visible:!0}}(t,a,o,e.objectIdFieldName),n=r.geometry;if(C(r.attributes,p,h,(function(e){var t;null!==(t=i)&&void 0!==t||(i=[]);var n=P(r,c);null!=n&&i.push({objectId:n,attribute:e})})),null!=n&&s)switch(n.type){case"point":r.geometry=(0,d.U1)(s,n,n);break;case"multipoint":r.geometry=(0,d.J9)(s,n,n);break;case"polygon":r.geometry=(0,d.Ie)(s,n,n);break;case"polyline":r.geometry=(0,d.G6)(s,n,n);break;case"extent":case"mesh":r.geometry=n}return r}));return{geometryType:a,features:m,spatialReference:o,fields:null!==(r=null===(n=e.fields)||void 0===n?void 0:n.map((function(e){return v.Z.fromJSON(e)})))&&void 0!==r?r:[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null,missingAttributes:i}}function _(e,t,r){if(null==e)return null;switch(t){case"point":var n=e;return{x:n.x,y:n.y,z:n.z,m:n.m,hasZ:null!=n.z,hasM:null!=n.m,type:"point",spatialReference:r};case"polyline":var i=e;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r};case"polygon":var a=e;return{rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polygon",spatialReference:r};case"multipoint":var o=e;return{points:o.points,hasZ:!!o.hasZ,hasM:!!o.hasM,type:"multipoint",spatialReference:r}}}function b(e){var t=32;return t+=(0,o.f2)(e.attributes),t+=3,t+=8+function(e){if(null==e)return 0;var t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":var r,i=0,a=2+(e.hasZ?1:0)+(e.hasM?1:0),o="polyline"===e.type?e.paths:e.rings,l=(0,n.Z)(o);try{for(l.s();!(r=l.n()).done;)i+=r.value.length}catch(h){l.e(h)}finally{l.f()}t+=8*i*a+64,t+=128*i,t+=34,t+=32*(o.length+1);break;case"multipoint":var u=2+(e.hasZ?1:0)+(e.hasM?1:0),c=e.points.length;t+=8*c*u+64,t+=128*c,t+=34,t+=32;break;case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=(0,s.Xw)(e.vertexAttributes.position,e.vertexAttributes.normal,e.vertexAttributes.uv,e.vertexAttributes.tangent)}return t}(e.geometry)}function x(e){if(null==e)return 0;switch(e.type){case"point":return 1;case"polyline":var t,r=0,i=(0,n.Z)(e.paths);try{for(i.s();!(t=i.n()).done;){r+=t.value.length}}catch(u){i.e(u)}finally{i.f()}return r;case"polygon":var a,o=0,s=(0,n.Z)(e.rings);try{for(s.s();!(a=s.n()).done;){o+=a.value.length}}catch(u){s.e(u)}finally{s.f()}return o;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var l=e.vertexAttributes&&e.vertexAttributes.position;return l?l.length/3:0;default:return}}function S(e){if(null==e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":var t,r=(0,n.Z)(e.paths);try{for(r.s();!(t=r.n()).done;){if(t.value.length>0)return!0}}catch(o){r.e(o)}finally{r.f()}return!1;case"polygon":var i,a=(0,n.Z)(e.rings);try{for(a.s();!(i=a.n()).done;){if(i.value.length>0)return!0}}catch(o){a.e(o)}finally{a.f()}return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function T(e,t){switch((0,c.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)(0,c.Wi)(t,e.paths[r],!!e.hasZ);break;case"polygon":for(var n=0;n<e.rings.length;n++)(0,c.Wi)(t,e.rings[n],!!e.hasZ);break;case"multipoint":(0,c.Wi)(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function w(e,t){switch((0,h.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)(0,h.Wi)(t,e.paths[r]);break;case"polygon":for(var n=0;n<e.rings.length;n++)(0,h.Wi)(t,e.rings[n]);break;case"multipoint":(0,h.Wi)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function P(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function C(e,t,r,n){if(null!==t&&void 0!==t&&t.size&&null!=r&&e)for(var i in e)if(t.has(i)){var a=e[i];"string"==typeof a&&a.length>r&&(n(i),e[i]="")}}},67331:function(e,t,r){var n;r.d(t,{u:function(){return n}}),function(e){e[e.EnableFastUpdates=0]="EnableFastUpdates",e[e.DisableFastUpdates=1]="DisableFastUpdates",e[e.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"}(n||(n={}))},67387:function(e,t,r){r.r(t),r.d(t,{getGeometryServiceURL:function(){return c},projectGeometry:function(){return d}});var n=r(74165),i=r(15861),a=r(42265),o=r(10064),s=r(7575),l=r(45362),u=r(81943);function c(){return h.apply(this,arguments)}function h(){return h=(0,i.Z)((0,n.Z)().mark((function e(){var t,r,i,l,u,c,h=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=h.length>0&&void 0!==h[0]?h[0]:null,l=h.length>1?h[1]:void 0,!a.Z.geometryServiceUrl){e.next=4;break}return e.abrupt("return",a.Z.geometryServiceUrl);case 4:if(i){e.next=6;break}throw new o.Z("internal:geometry-service-url-not-configured");case 6:return u="portal"in i?i.portal||s.Z.getDefault():i,e.next=9,u.load({signal:l});case 9:if(c=null===(t=u.helperServices)||void 0===t||null===(r=t.geometry)||void 0===r?void 0:r.url){e.next=12;break}throw new o.Z("internal:geometry-service-url-not-configured");case 12:return e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function d(e,t){return f.apply(this,arguments)}function f(){return f=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,h,d,f=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=f.length>2&&void 0!==f[2]?f[2]:null,a=f.length>3?f[3]:void 0,e.next=4,c(i,a);case 4:return s=e.sent,h=new u.Z({geometries:[t],outSpatialReference:r}),e.next=8,(0,l.i)(s,h,{signal:a});case 8:if(!(d=e.sent)||!Array.isArray(d)||1!==d.length){e.next=11;break}return e.abrupt("return",d[0]);case 11:throw new o.Z("internal:geometry-service-projection-failed");case 12:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}},34610:function(e,t,r){r.d(t,{Kb:function(){return u},o2:function(){return p},sV:function(){return v},xn:function(){return d}});var n=r(74165),i=r(15861),a=r(37762),o=r(51995),s=r(56011);function l(e,t){if(!e||e.symbol)return null;var r=null===t||void 0===t?void 0:t.renderer;return e&&null!=r&&r.getObservationRenderer?r.getObservationRenderer(e):r}function u(e,t){var r,n=l(e,t),i=function(e,t){if(null!=e.symbol)return e.symbol;var r=l(e,t);return null!=r&&"dot-density"!==r.type?r.getSymbol(e,t):null}(e,t);if(null==i)return null;var o={renderer:n,symbol:i};if(null==n||!("visualVariables"in n)||!n.visualVariables)return o;var u,c=null!==(r=(0,s.getVisualVariableValues)(n,e,t))&&void 0!==r?r:[],h=["proportional","proportional","proportional"],d=(0,a.Z)(c);try{for(d.s();!(u=d.n()).done;){var f=u.value,v=f.variable,p=f.value;switch(v.type){case"color":o.color=p.toRgba();break;case"size":if("outline"===v.target)o.outlineSize=p;else{var m=v.axis,y=v.useSymbolValue?"symbol-value":p;switch(m){case"width":h[0]=y;break;case"depth":h[1]=y;break;case"height":h[2]=y;break;case"width-and-depth":h[0]=h[1]=y;break;default:h[0]=h[1]=h[2]=y}}break;case"opacity":o.opacity=p;break;case"rotation":switch(v.axis){case"tilt":o.tilt=p;break;case"roll":o.roll=p;break;default:o.heading=p}}}}catch(g){d.e(g)}finally{d.f()}return"proportional"===h[0]&&"proportional"===h[1]&&"proportional"===h[2]||(o.size=h),o}function c(e,t){return h.apply(this,arguments)}function h(){return h=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.symbol){e.next=2;break}return e.abrupt("return",t.symbol);case 2:return i=l(t,r),e.abrupt("return",null!=i?i.getSymbolAsync(t,r):null);case 4:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function d(e,t){return f.apply(this,arguments)}function f(){return f=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,u,h,d,f,v,p,m,y,g,_,b,x;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=l(t,r),e.next=3,c(t,r);case 3:if(h=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:if(d={renderer:u,symbol:h},u&&"visualVariables"in u&&u.visualVariables){e.next=9;break}return e.abrupt("return",d);case 9:f=null!==(i=(0,s.getVisualVariableValues)(u,t,r))&&void 0!==i?i:[],v=["proportional","proportional","proportional"],p=(0,a.Z)(f);try{for(p.s();!(m=p.n()).done;)y=m.value,g=y.variable,_=y.value,"color"===g.type?d.color=o.Z.toUnitRGBA(_):"size"===g.type?"outline"===g.target?d.outlineSize=_:(b=g.axis,x=g.useSymbolValue?"symbol-value":_,"width"===b?v[0]=x:"depth"===b?v[1]=x:"height"===b?v[2]=x:v[0]=v[1]="width-and-depth"===b?x:v[2]=x):"opacity"===g.type?d.opacity=_:"rotation"===g.type&&"tilt"===g.axis?d.tilt=_:"rotation"===g.type&&"roll"===g.axis?d.roll=_:"rotation"===g.type&&(d.heading=_)}catch(n){p.e(n)}finally{p.f()}return e.abrupt("return",((isFinite(v[0])||isFinite(v[1])||isFinite(v[2]))&&(d.size=v),d));case 13:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e[t];return"number"==typeof r&&isFinite(r)?r:null}function p(e){for(var t=0;t<3;t++){var r=e[t];if("number"==typeof r)return isFinite(r)?r:0}return 0}},45362:function(e,t,r){r.d(t,{i:function(){return f}});var n=r(74165),i=r(1413),a=r(15861),o=r(76200),s=r(25243),l=r(77981),u=r(23084),c=r(35594),h=r(81943),d=(0,s.se)(h.Z);function f(e,t,r){return v.apply(this,arguments)}function v(){return v=(0,a.Z)((0,n.Z)().mark((function e(t,r,a){var s,h,f,v,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d(r),s=(0,u.en)(t),h=(0,i.Z)((0,i.Z)({},s.query),{},{f:"json"},r.toJSON()),f=r.outSpatialReference,v=(0,l.Ji)(r.geometries[0]),p=(0,u.lA)(h,a),e.abrupt("return",(0,o.Z)(s.path+"/project",p).then((function(e){var t=e.data.geometries;return(0,c.o)(t,v,f)})));case 3:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}},81943:function(e,t,r){r.d(t,{Z:function(){return v}});var n=r(15671),i=r(43144),a=r(60136),o=r(29388),s=r(27366),l=r(46784),u=r(49861),c=(r(93169),r(32718),r(84936),r(69912)),h=r(77981),d=r(92975),f=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).geometries=[],i.outSpatialReference=null,i.transformation=null,i.transformForward=null,i}return(0,i.Z)(r,[{key:"toJSON",value:function(){var e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],r={};return r.outSR=(0,d.B9)(this.outSpatialReference),r.inSR=(0,d.B9)(t.spatialReference),r.geometries=JSON.stringify({geometryType:(0,h.Ji)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}}]),r}(l.wq);(0,s._)([(0,u.Cb)()],f.prototype,"geometries",void 0),(0,s._)([(0,u.Cb)({json:{read:{source:"outSR"}}})],f.prototype,"outSpatialReference",void 0),(0,s._)([(0,u.Cb)()],f.prototype,"transformation",void 0),(0,s._)([(0,u.Cb)()],f.prototype,"transformForward",void 0);var v=f=(0,s._)([(0,c.j)("esri.rest.support.ProjectParameters")],f)},19951:function(e,t,r){r.r(t),r.d(t,{fetchSymbolFromStyle:function(){return p},getStyleItemFromStyle:function(){return v},resolveWebStyleSymbol:function(){return f}});var n=r(51508),i=r(71277),a=r(10064),o=r(35995),s=r(7575),l=r(53283),u=r(192),c=r(1472),h=r(38048),d=r(81854);function f(e,t,r,n){var i=e.name;return null==i?Promise.reject(new a.Z("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,r){var n=h.wm.replaceAll(/\{SymbolName\}/gi,e),i=null!=t.portal?t.portal:s.Z.getDefault();return(0,h.EJ)(n,r).then((function(e){var t=(0,h.KV)(e.data);return(0,u.im)(t,{portal:i,url:(0,o.mN)((0,o.Yd)(n)),origin:"portal-item"})}))}(i,t,n):(0,h.n2)(e,t,n).then((function(e){return p(e,i,t,r,h.v9,n)}))}function v(e,t){return t.items.find((function(t){return t.name===e}))}function p(e,t,r,f,p,m){var y,g,_,b,x=null!=(null===r||void 0===r?void 0:r.portal)?r.portal:s.Z.getDefault(),S={portal:x,url:(0,o.mN)(e.baseUrl),origin:"portal-item"},T=v(t,e.data);if(!T){var w="The symbol name '".concat(t,"' could not be found");return Promise.reject(new a.Z("symbolstyleutils:symbol-name-not-found",w,{symbolName:t}))}var P=(0,l.f)(p(T,f),S),C=null!==(y=null===(g=T.thumbnail)||void 0===g?void 0:g.href)&&void 0!==y?y:null,O=null===(_=T.thumbnail)||void 0===_?void 0:_.imageData;(0,i.XO)()&&(P=null!==(b=(0,i.pJ)(P))&&void 0!==b?b:"",C=(0,i.pJ)(C));var R={portal:x,url:(0,o.mN)((0,o.Yd)(P)),origin:"portal-item"};return(0,h.EJ)(P,m).then((function(i){var a="cimRef"===f?(0,h.KV)(i.data):i.data,o=(0,u.im)(a,R);if(o&&(0,n.dU)(o)){if(C){var s=(0,l.f)(C,S);o.thumbnail=new d.p({url:s})}else O&&(o.thumbnail=new d.p({url:"data:image/png;base64,".concat(O)}));e.styleUrl?o.styleOrigin=new c.Z({portal:r.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(o.styleOrigin=new c.Z({portal:r.portal,styleName:e.styleName,name:t}))}return o}))}},52919:function(e,t,r){r.d(t,{Lz:function(){return _},RX:function(){return g},Wf:function(){return p},j3:function(){return m}});var n=r(37762),i=r(29134),a=r(7025),o=r(32035),s=r(12400),l=r(37998),u=r(50628),c=r(69691),h=r(94463),d=r(77648),f=r(17579),v=r(4760);function p(e,t,r,i,a){var o,s=e.stageObject,l=s.geometries,u=0,c=(0,n.Z)(l);try{for(c.s();!(o=c.n()).done;){var h=o.value;if((0,f.T)(h)){var d=O(h,t,r,i,a),p=d.update;u+=d.averageGeometrySampledElevation,p&&s.geometryVertexAttributeUpdated(h,v.T.POSITION)}}}catch(m){c.e(m)}finally{c.f()}return u/l.length}function m(e,t,r,n,a,s){var u=e.stageObject,d=t.centerPointInElevationSR,f=0;u.usesVerticalDistanceToGround?(n(d,C),(0,c.ub)(u,C.verticalDistanceToGround),f=C.sampledElevation):(n(d,C),"absolute-height"!==t.mode&&(f=C.sampledElevation));var v=(0,i.JG)(y,null!==s&&void 0!==s?s:u.transformation),p=(0,o.s)(P,v[12],v[13],v[14]);h.h.TESTS_DISABLE_OPTIMIZATIONS?(x[0]=d.x,x[1]=d.y,x[2]=C.z,(0,l.B)(d.spatialReference,x,v,a.spatialReference)&&(s?(0,i.JG)(s,v):u.transformation=v)):a.setAltitudeOfTransformation(C.z,v);var m=b/a.unitInMeters;return(Math.abs(v[12]-p[0])>=m||Math.abs(v[13]-p[1])>=m||Math.abs(v[14]-p[2])>=m)&&(s?(0,i.JG)(s,v):u.transformation=v),f}var y=(0,a.Ue)();function g(e,t,r,n,i){var a=e.graphics3DSymbolLayer.lodRenderer;if(null==a)return 0;var s=t.centerPointInElevationSR;n(s,C);var u="absolute-height"!==t.mode?C.sampledElevation:0,c=a.instanceData,d=e.instanceIndex,f=w;c.getGlobalTransform(d,f);var v=(0,o.s)(P,f[12],f[13],f[14]);h.h.TESTS_DISABLE_OPTIMIZATIONS?(x[0]=s.x,x[1]=s.y,x[2]=C.z,(0,l.B)(s.spatialReference,x,f,i.spatialReference)&&c.setGlobalTransform(d,f)):i.setAltitudeOfTransformation(C.z,f);var p=b/i.unitInMeters;return(h.h.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(f[12]-v[0])>=p||Math.abs(f[13]-v[1])>=p||Math.abs(f[14]-v[2])>=p)&&c.setGlobalTransform(d,f),u}function _(e,t,r,i,a){var o=e.stageObject,s=o.geometries;if(0===s.length)return 0;var l,u=0,c=null,h=0,d=!1,p=(0,n.Z)(s);try{for(p.s();!(l=p.n()).done;){var m=l.value;if((0,f.T)(m)){var y=m.attributes.get(v.T.POSITION);if(y!==c){var g=O(m,t,r,i,a),_=g.update;h=g.averageGeometrySampledElevation,c=y,d=_}d&&o.geometryVertexAttributeUpdated(m,v.T.POSITION),u+=h}}}catch(b){p.e(b)}finally{p.f()}return u/s.length}var b=.01,x=(0,s.Ue)(),S=(0,s.Ue)(),T=(0,s.Ue)(),w=(0,a.Ue)(),P=(0,s.Ue)(),C=new c.Lm;function O(e,t,r,n,i){var a=!1,o=e.transformation,s=t.requiresSampledElevationInfo;S[0]=o[12],S[1]=o[13],S[2]=o[14],e.invalidateBoundingInfo();for(var l=e.getMutableAttribute(v.T.POSITION),c=l.data,f=l.size,p=c.length/f,m=new d.sb(e.mapPositions,r),y=0,g=0,_=0;_<p;_++){if(T[0]=c[y],T[1]=c[y+1],T[2]=c[y+2],n(m,C),s&&(g+=C.sampledElevation),h.h.TESTS_DISABLE_OPTIMIZATIONS)c[y]=m.array[m.offset],c[y+1]=m.array[m.offset+1],c[y+2]=C.z,(0,u.projectBuffer)(c,r,y,c,i.spatialReference,y,1),c[y]-=S[0],c[y+1]-=S[1],c[y+2]-=S[2],a=!0;else{x[0]=c[y]+S[0],x[1]=c[y+1]+S[1],x[2]=c[y+2]+S[2],i.setAltitude(x,C.z),c[y]=x[0]-S[0],c[y+1]=x[1]-S[1],c[y+2]=x[2]-S[2];var w=b/i.unitInMeters;(Math.abs(T[0]-c[y])>=w||Math.abs(T[1]-c[y+1])>=w||Math.abs(T[2]-c[y+2])>=w)&&(a=!0)}y+=f,m.offset+=3}return{update:a,averageGeometrySampledElevation:g/=p}}},91293:function(e,t,r){r.d(t,{K:function(){return v},Y:function(){return f}});var n=r(37762),i=r(1413),a=r(74165),o=r(15861),s=r(15671),l=r(43144),u=(r(59486),r(63780)),c=(r(93169),r(66978)),h=r(93463),d=r(77577),f=function(){function e(t,r){(0,s.Z)(this,e),this.spatialReference=t,this._view=r}return(0,l.Z)(e,[{key:"getElevation",value:function(e,t,r){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,r)}},{key:"queryElevation",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,o){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._view.elevationProvider.queryElevation(t,r,0,this.spatialReference,o,n,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()}]),e}(),v=function(){function e(t,r,n,a){(0,s.Z)(this,e),this.spatialReference=r,this._getElevationQueryProvider=n,this._queries=new Array,this._queryOptions=(0,i.Z)((0,i.Z)({},a),{},{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(h.T8.ELEVATION_QUERY,this)}return(0,l.Z)(e,[{key:"destroy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{completeTasks:!1},t=e.completeTasks;if(this._frameTask.remove(),this.running)if(t)this.runTask(h.G5);else{var r,i=(0,n.Z)(this._queries);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.result.reject((0,c.zE)())}}catch(o){i.e(o)}finally{i.f()}}}},{key:"queryElevation",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=(0,c.hh)(),o={x:e,y:t,minDemResolution:i,result:a,signal:r};return this._queries.push(o),(0,c.fu)(r,(function(){(0,u.Od)(n._queries,o),a.reject((0,c.zE)())})),a.promise}},{key:"running",get:function(){return this._queries.length>0}},{key:"runTask",value:function(e){var t=this._queries;this._queries=[];var r=this._getElevationQueryProvider();if(!r)return t.forEach((function(e){return e.result.reject()})),void e.madeProgress();var n=t.map((function(e){return[e.x,e.y]})),a=t.reduce((function(e,t){return Math.min(e,t.minDemResolution)}),1/0),o=new d.Z({points:n,spatialReference:this.spatialReference}),s=t.length>1&&t.some((function(e){return!!e.signal}))?new AbortController:null,l=null!=s?s.signal:t[0].signal;if(null!=s){var u=0;t.forEach((function(e){return(0,c.fu)(e.signal,(function(){u++,e.result.reject((0,c.zE)()),u===t.length&&s.abort()}))}))}var h=(0,i.Z)((0,i.Z)({},this._queryOptions),{},{minDemResolution:a,signal:l});r.queryElevation(o,h).then((function(e){t.forEach((function(t,r){null!=t.signal&&t.signal.aborted?t.result.reject((0,c.zE)()):t.result.resolve(e.geometry.points[r][2])}))})).catch((function(e){t.forEach((function(t){return t.result.reject(e)}))})),e.madeProgress()}},{key:"test",get:function(){}}]),e}()},67166:function(e,t,r){r.d(t,{S:function(){return s}});var n=r(32718),i=r(29481),a=r(95437),o=function(){return n.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory")};function s(e,t){if(!(0,i.Pd)(e))return o().error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '".concat(e.type,"' does not support callouts")),null;if(!e.callout)return null;var r=l[e.callout.type];return r?new r(e,t):(o().error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type ".concat(e.callout.type)),null)}var l={line:a.YT}},91107:function(e,t,r){r.d(t,{z:function(){return a}});var n=r(43144),i=r(15671),a=(0,n.Z)((function e(t,r,n){(0,i.Z)(this,e),this.graphic=t,this.renderingInfo=r,this.layer=n}))},95437:function(e,t,r){r.d(t,{YT:function(){return ie},_D:function(){return ue},Ly:function(){return le}});var n=r(74165),i=r(15861),a=r(15671),o=r(43144),s=r(88301),l=r(61120),u=r(60136),c=r(29388),h=r(51995),d=r(17842),f=r(12400),v=r(86361),p=r(29481),m=r(52919),y=r(69691),g=r(78935),_=r(91107),b=r(58063),x=r(3173),S=r(73614),T=r(96387),w=r(36759),P=r(60314),C=r(91526),O=r(79100),R=r(40779),E=r(4760),k=r(30168),A=r(643),Z=r(30932),L=r(55158),I=r(37081),U=r(23620),M=r(56529),D=r(93822),z=r(33236),N=r(50951),F=r(82144),V=r(31132),H=r(7566),G=r(27627),B=r(44619),j=r(8548),W=r(36207),q=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"initializeConfiguration",value:function(e,t){t.spherical=e.viewingMode===N.JY.Global}},{key:"initializeProgram",value:function(e){return new G.$(e.rctx,r.shader.get().build(this.configuration),H.i)}},{key:"setPipelineState",value:function(e){var t=e?j.wb.ALWAYS:j.wb.LESS;return this.configuration.depthHudEnabled?(0,W.sm)({depthTest:{func:t},depthWrite:W.LZ}):(0,W.sm)({blending:(0,W.wK)(j.zi.ONE,j.zi.SRC_ALPHA,j.zi.ONE_MINUS_SRC_ALPHA,j.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:t},colorWrite:W.BK})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.multipassEnabled)}}]),r}(V.A);q.shader=new F.J(B.L,(function(){return r.e(20658).then(r.bind(r,20658))}));var J,Y=r(27366),X=r(33559),K=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).screenCenterOffsetUnitsEnabled=!1,e.spherical=!1,e.occlusionTestEnabled=!0,e.hasVerticalOffset=!1,e.hasScreenSizePerspective=!1,e.depthHudEnabled=!1,e.depthHudAlignStartEnabled=!1,e.hasSlicePlane=!1,e.multipassEnabled=!1,e}return(0,o.Z)(r)}(r(8883).W);(0,Y._)([(0,X.o)()],K.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,Y._)([(0,X.o)()],K.prototype,"spherical",void 0),(0,Y._)([(0,X.o)()],K.prototype,"occlusionTestEnabled",void 0),(0,Y._)([(0,X.o)()],K.prototype,"hasVerticalOffset",void 0),(0,Y._)([(0,X.o)()],K.prototype,"hasScreenSizePerspective",void 0),(0,Y._)([(0,X.o)()],K.prototype,"depthHudEnabled",void 0),(0,Y._)([(0,X.o)()],K.prototype,"depthHudAlignStartEnabled",void 0),(0,Y._)([(0,X.o)()],K.prototype,"hasSlicePlane",void 0),(0,Y._)([(0,X.o)()],K.prototype,"multipassEnabled",void 0),(0,Y._)([(0,X.o)({constValue:!0})],K.prototype,"hasSliceInVertexProgram",void 0),(0,Y._)([(0,X.o)({constValue:!1})],K.prototype,"draped",void 0);var $=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e,new ee)).produces=new Map([[D.r.LINE_CALLOUTS,function(e){return e===I.H_.Color}],[D.r.LINE_CALLOUTS_HUD_DEPTH,function(e){return e===I.H_.Color}]]),n._configuration=new K,n._uniqueMaterialIdentifier=r.uniqueMaterialIdentifier(n.parameters),n}return(0,o.Z)(r,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}},{key:"passParameters",value:function(){return this.parameters}},{key:"getConfiguration",value:function(e,t){var r=(null===t||void 0===t?void 0:t.slot)!==D.r.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration}},{key:"intersect",value:function(){}},{key:"createGLMaterial",value:function(e){return new Q(e)}},{key:"createBufferWriter",value:function(){return new ne}},{key:"validateParameters",value:function(e){var t=r.uniqueMaterialIdentifier(e);t!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=t)}}],[{key:"uniqueMaterialIdentifier",value:function(e){var t=e.renderOccluded,r=e.isDecoration,n=e.horizontalScreenOffset,i=e.color,a=e.size,o=e.occlusionTest,s=e.shaderPolygonOffset,l=e.depthHUDAlignStart,u=e.centerOffsetUnits,c=e.hasSlicePlane,h=e.screenSizePerspective,d=e.verticalOffset,f=e.borderColor;return(0,A.pv)(J||(J=(0,k.Z)(["",":",":",":[","]:",":",":",":",":",":",":",":{",":",":","}:[","]"])),t,r,n,i,a,o,s,l,u,c,null!=h,d.screenLength,d.minWorldLength,d.maxWorldLength,f)}}]),r}(M.F5),Q=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"beginSlot",value:function(e){return this.ensureTechnique(q,e)}}]),r}(U.Z),ee=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).horizontalScreenOffset=0,e.color=[0,0,0,1],e.size=1,e.occlusionTest=!1,e.shaderPolygonOffset=1e-5,e.depthHUDAlignStart=!1,e.centerOffsetUnits="world",e.hasSlicePlane=!1,e}return(0,o.Z)(r)}(M.Mt),te=(0,L.U$)().vec3f(E.T.POSITION).vec3f(E.T.NORMAL).vec2f(E.T.UV0).vec4f(E.T.CENTEROFFSETANDDISTANCE),re=[(0,Z.al)(0,0),(0,Z.al)(1,0),(0,Z.al)(0,1),(0,Z.al)(1,0),(0,Z.al)(1,1),(0,Z.al)(0,1)],ne=function(){function e(){(0,a.Z)(this,e),this.vertexBufferLayout=te}return(0,o.Z)(e,[{key:"elementCount",value:function(e){return 6*e.attributes.get(E.T.POSITION).indices.length}},{key:"write",value:function(e,t,r,n,i){(0,z.ho)(r.attributes.get(E.T.POSITION),e,n.position,i,6),(0,z.s5)(r.attributes.get(E.T.NORMAL),t,n.normal,i,6),(0,z.SW)(r.attributes.get(E.T.CENTEROFFSETANDDISTANCE),n.centerOffsetAndDistance,i,6);for(var a=0;a<re.length;++a)n.uv0.setVec(i+a,re[a])}}]),e}(),ie=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e,n){var i;return(0,a.Z)(this,r),(i=t.call(this,e,null,n,se))._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},i.ensureDrapedStatus(!1),i}return(0,o.Z)(r,[{key:"doLoad",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._materials[0]=new $(this._materialParameters),this._context.stage.add(this._materials[0]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,s.Z)((0,l.Z)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._materials[0]),this._materials.length=0}},{key:"_perInstanceMaterialParameters",value:function(e){var t,r=this._materialParameters;return r.horizontalScreenOffset=null!==(t=e.horizontalScreenOffset)&&void 0!==t?t:0,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}},{key:"_materialParameters",get:function(){var e,t=new ee,r=this.symbol,n=r.callout;if(t.color=null!=n.color?h.Z.toUnitRGBA(n.color):[0,0,0,0],t.color[3]*=this._getLayerOpacity(),t.size=(0,d.F2)(n.size||0),r.verticalOffset){var i=r.verticalOffset,a=i.screenLength,o=i.minWorldLength,s=i.maxWorldLength;t.verticalOffset={screenLength:(0,d.F2)(a),minWorldLength:o||0,maxWorldLength:null!=s?s:1/0}}t.borderColor=null!=(null===(e=n.border)||void 0===e?void 0:e.color)?h.Z.toUnitRGBA(n.border.color):null;var l="object"===r.symbolLayers.at(0).type,u="label-3d"===r.type;return t.occlusionTest=!l,t.shaderPolygonOffset=l?0:void 0,t.depthHUDAlignStart=u,t.hasSlicePlane=this._context.slicePlaneEnabled,t.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,t}},{key:"_defaultElevationInfoNoZ",value:function(){return oe}},{key:"createGraphics3DGraphic",value:function(e){var t=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new g.o,t.elevationOffset||0),i=t.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===i.type||!i.symbolLayers.some((function(e){return"object"===e.type||"text"===e.type})));if("label-3d"!==i.type&&a)return null;if("point-3d"===i.type&&i.symbolLayers.every((function(e){return"text"===e.type&&!(0,p.as)(e)})))return null;var o=(0,T.zE)(r.geometry);return null==o?null:this._createAs3DShape(o,n,t,r.uid)}},{key:"layerOpacityChanged",value:function(){var e;null===(e=this._materials[0])||void 0===e||e.setParameters(this._materialParameters)}},{key:"layerElevationInfoChanged",value:function(e,t,n){var i=this,a=this._elevationContext.mode,o=(0,y.GC)(r.elevationModeChangeTypes,n,a);return o!==y.lO.UPDATE||e.forEach((function(e){var r=t(e);null!=r&&i.updateGraphicElevationContext(e.graphic,r)})),o}},{key:"slicePlaneEnabledChanged",value:function(){var e;return null!==(e=this._materials[0])&&void 0!==e&&e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"setGraphicElevationContext",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,s.Z)((0,l.Z)(r.prototype),"setGraphicElevationContext",this).call(this,e,t),t.addOffsetRenderUnits(n),t}},{key:"updateGraphicElevationContext",value:function(e,t){this.setGraphicElevationContext(e,t.elevationContext,null!=t.metadata?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,y.Xf)(t.elevationContext.mode)}},{key:"computeComplexity",value:function(){return new P.eH({verticesPerFeature:6})}},{key:"_getOrCreateMaterial",value:function(e){var t,r=this._perInstanceMaterialParameters(e),n=$.uniqueMaterialIdentifier(r);if(n===(null===(t=this._materials[0])||void 0===t?void 0:t.uniqueMaterialIdentifier))return{material:this._materials[0],isUnique:!1};if(null!=e.materialCollection){var i=e.materialCollection.get(n);return null==i&&(i=new $(r),e.materialCollection.add(n,i)),{material:i,isUnique:!1}}return{material:new $(r),isUnique:!0}}},{key:"_createAs3DShape",value:function(e,t,r,n){var i=this._context.layer.uid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:i}),o=this._getOrCreateMaterial(r),s=new R.Z(o.material,function(e){var t=e.translation,r=e.centerOffset,n=new C.a(t?[t[0],t[1],t[2]]:[0,0,0],ae,3,!0),i=new C.a(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],ae,4,!0);return[[E.T.POSITION,n],[E.T.NORMAL,new C.a([0,0,1],ae,3,!0)],[E.T.CENTEROFFSETANDDISTANCE,i]]}(r),null,O.U.Point,a),l=(0,w.ZC)(this._context,e,s,t,n);if(null==l)return null;var u=new b.z(this,l.object,[s],o.isUnique?[o.material]:null,null,m.j3,t);return u.metadata=new x.n(r.elevationOffset),u.alignedSampledElevation=l.sampledElevation,u.needsElevationUpdates=(0,y.Xf)(t.mode),(0,w.dO)(u,e,this._context.elevationProvider),u}}]),r}(S.k);ie.elevationModeChangeTypes={definedChanged:y.lO.UPDATE,staysOnTheGround:y.lO.UPDATE,onTheGroundChanged:y.lO.RECREATE};var ae=[0],oe={mode:"relative-to-ground",offset:0},se={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},le=(0,o.Z)((function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,f.Ue)(),i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,v.Ue)(),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,a.Z)(this,e),this.renderer=t,this.symbol=r,this.translation=n,this.centerOffset=i,this.horizontalScreenOffset=o,this.centerOffsetUnits=s,this.elevationOffset=l,this.materialCollection=u})),ue=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r)}(_.z)},58063:function(e,t,r){r.d(t,{n:function(){return y},z:function(){return g}});var n=r(74165),i=r(15861),a=r(37762),o=r(43144),s=r(15671),l=r(32035),u=r(12400),c=r(41414),h=r(23470),d=r(69691),f=r(8821),v=r(96387),p=r(68401),m=r(77958),y=(0,o.Z)((function e(t,r,n){(0,s.Z)(this,e),this.baseMaterial=t,this.edgeMaterials=r,this.properties=n})),g=function(){function e(t,r,n,i,a,o,l){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,s.Z)(this,e),this.graphics3DSymbolLayer=t,this.stageObject=r,this._uniqueGeometries=n,this._uniqueMaterials=i,this._sharedResource=a,this.elevationAligner=o,this.elevationContext=l,this._edgeState=u,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}return(0,o.Z)(e,[{key:"isElevationSource",get:function(){return!!this.stageObject.lastValidElevationBB}},{key:"initialize",value:function(e){this._stageLayer=e;var t=e.stage;t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}},{key:"destroy",value:function(){var e,t;if(this._stageLayer){var r=this._stageLayer.stage;r.removeMany(this._uniqueMaterials),r.removeMany(this._uniqueGeometries),r.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),null!==(e=r.renderer.edgeView)&&void 0!==e&&e.removeObject(this.stageObject),this.stageObject.dispose(),null!==(t=this._sharedResource)&&void 0!==t&&t.release(),this._visible=!1,this._stageLayer=null}}},{key:"layerOpacityChanged",value:function(e,t){var r=this.stageObject,n=this._edgeState,i=this._stageLayer;if(null!=n){var o,s=_(n.baseMaterial),l=!1,u=(0,a.Z)(n.edgeMaterials);try{for(u.s();!(o=u.n()).done;){var c=o.value;c.objectTransparency!==s&&(c.objectTransparency=s,l=!0)}}catch(h){u.e(h)}finally{u.f()}l&&this.resetEdgeObject(t),i.stage.renderer.withEdgeView((function(t){t.updateAllComponentOpacities(r,[e])}))}}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this.stageObject,n=this._edgeState,i=this._stageLayer;null!=n&&i.stage.renderer.withEdgeView((function(i){i.updateAllComponentMaterials(r,n.edgeMaterials,{hasSlicePlane:e},!t),n.properties.hasSlicePlane=e}))}},{key:"setVisibility",value:function(e){var t=this,r=this._edgeState,n=this.stageObject,i=this._stageLayer;null!=i&&this.visible!==e&&(this._visible=e,n.visible=e,e&&!this._addedToStage&&(i.add(n),this._addedToStage=!0),null!=r&&i.stage.renderer.withEdgeView((function(i){i.hasObject(n)?i.updateObjectVisibility(n,e):e&&t._addOrUpdateEdgeObject(r,i,!1)})))}},{key:"visible",get:function(){return this._visible}},{key:"alignWithElevation",value:function(e,t,r,n){var i=this;if(null!=this.elevationAligner){null!=r&&(0,f.aO)(this.elevationContext.featureExpressionInfoContext,r);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,(function(r,n){return(0,d.qZ)(r,e,i.elevationContext,t,n)}),t),this.resetEdgeObject(n)}}},{key:"alignWithAbsoluteElevation",value:function(e,t,r){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(function(t,r){r.sampledElevation=e,r.verticalDistanceToGround=0,r.z=e}),t),this.resetEdgeObject(r)}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,u.Ue)();return(0,l.c)(e,(0,h.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,c.Ue)(),t=this.stageObject.boundingVolumeObjectSpace;return(0,c.op)(e,t.min),(0,c.Tn)(e,t.max),e}},{key:"computeAttachmentOrigin",value:function(e){var t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else{var r,n=(0,a.Z)(this.stageObject.geometries);try{for(n.s();!(r=n.n()).done;){r.value.computeAttachmentOrigin(S)&&((0,l.h)(S,S,t),(0,l.g)(e.render.origin,e.render.origin,S),e.render.num++)}}catch(i){n.e(i)}finally{n.f()}}}},{key:"getProjectedBoundingBox",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r,i,a,o){var s,u,h,d,f,p,m,y,g,_,w,P,C;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.getBoundingBoxObjectSpace(o),u=T,h=(0,c.wp)(s)?1:u.length,d=0;d<h;d++)f=u[d],x[0]=s[f[0]],x[1]=s[f[1]],x[2]=s[f[2]],(0,l.h)(x,x,this.stageObject.transformation),b[3*d]=x[0],b[3*d+1]=x[1],b[3*d+2]=x[2];if(t(b,0,h)){e.next=4;break}return e.abrupt("return",null);case 4:for((0,c.cS)(s),p=null,this.calculateRelativeScreenBounds&&(p=this.calculateRelativeScreenBounds()),m=0;m<3*h;m+=3){for(y=0;y<3;y++)s[y]=Math.min(s[y],b[m+y]),s[y+3]=Math.max(s[y+3],b[m+y]);p&&i.push({location:b.slice(m,m+3),screenSpaceBoundingRect:p})}if(null===r||void 0===r||!r.service||"absolute-height"===this.elevationContext.mode){e.next=35;break}if((0,c.be)(s,S),_="relative-to-scene"===this.elevationContext.mode?"scene":"ground",w=0,!r.useViewElevation){e.next=16;break}w=null!==(g=r.service.getElevation(S[0],S[1],_))&&void 0!==g?g:0,e.next=34;break;case 16:return e.prev=16,C=(0,v.Si)(s,r.service.spatialReference,r),e.next=20,r.service.queryElevation(S[0],S[1],a,C,_);case 20:if(e.t1=P=e.sent,e.t0=null!==e.t1,!e.t0){e.next=24;break}e.t0=void 0!==P;case 24:if(!e.t0){e.next=28;break}e.t2=P,e.next=29;break;case 28:e.t2=0;case 29:w=e.t2,e.next=34;break;case 32:e.prev=32,e.t3=e.catch(16);case 34:(0,c.cv)(s,0,0,-this.alignedSampledElevation+w);case 35:return e.abrupt("return",s);case 36:case"end":return e.stop()}}),e,this,[[16,32]])})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"addObjectState",value:function(e,t){e===p.V_.Highlight&&t.addObject(this.stageObject,this.stageObject.highlight()),e===p.V_.MaskOccludee&&t.addObject(this.stageObject,this.stageObject.maskOccludee())}},{key:"removeObjectState",value:function(e){e.removeObject(this.stageObject)}},{key:"resetEdgeObject",value:function(e){var t=this,r=this._edgeState,n=this.stageObject,i=this._stageLayer,a=this._visible;null!=r&&i.stage.renderer.withEdgeView((function(i){a?t._addOrUpdateEdgeObject(r,i,e):i.removeObject(n)}))}},{key:"_addOrUpdateEdgeObject",value:function(e,t,r){var n,i=this,o=_(e.baseMaterial),s=(0,a.Z)(e.edgeMaterials);try{for(s.s();!(n=s.n()).done;){n.value.objectTransparency=o}}catch(l){s.e(l)}finally{s.f()}t.addOrUpdateObject3D(this.stageObject,e.edgeMaterials,e.properties,!r).then((function(){var e;return null===(e=i._stageLayer)||void 0===e?void 0:e.sync()}))}}]),e}();function _(e){return e.isVisible()?e.parameters.transparent?m.i.TRANSPARENT:m.i.OPAQUE:m.i.INVISIBLE}var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=(0,u.Ue)(),S=(0,u.Ue)(),T=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},3173:function(e,t,r){r.d(t,{n:function(){return a}});var n=r(43144),i=r(15671),a=(0,n.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,i.Z)(this,e),this.labelText=r,this.elevationOffset=null!==t&&void 0!==t?t:0}))},53727:function(e,t,r){r.d(t,{JK:function(){return a},t7:function(){return n},wg:function(){return i}});var n=3,i=3,a=10},24168:function(e,t,r){r.d(t,{q:function(){return zl}});var n=r(37762),i=r(93433),a=r(74165),o=r(15861),s=r(15671),l=r(43144),u=r(88301),c=r(61120),h=r(60136),d=r(29388),f=r(63780),v=r(14921),p=r(93169),m=r(66978),y=r(55244),g=r(59896),_=r(13005),b=r(13611),x=r(6644),S=r(32035),T=r(12400),w=r(80885),P=r(77258),C=r(41414),O=r(65156),R=r(92975),E=r(65618),k=r(83406),A=r(70446),Z=r(8821),L=new _.Z(Array,(function(e){return(0,C.t8)(e,C.bM)}),null,10,5),I=(0,O.Ue)(),U=function(){function e(t,r,n,i,a){(0,s.Z)(this,e),this.graphic=t,this.graphics3DSymbol=r,this.layers=n,this._visibleFlags=A.P.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=a?(0,Z.Tz)(a,t,i):null}return(0,l.Z)(e,[{key:"labelLayers",get:function(){return this._labelLayers||f.ow}},{key:"extent",get:function(){return this._extent}},{key:"isElevationSource",get:function(){return this.layers.some((function(e){return null===e||void 0===e?void 0:e.isElevationSource}))}},{key:"initialize",value:function(e){var t=this;this._layer=e,this._forEachSymbolLayerGraphic((function(r){r.initialize(e),r.setVisibility(t.isVisible())}))}},{key:"destroy",value:function(){this._forEachSymbolLayerGraphic((function(e){return e.destroy()})),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}},{key:"destroyed",get:function(){return null==this.layers}},{key:"clearLabelGraphics",value:function(){this._forEachLabelGraphic((function(e){return e.destroy()})),this._labelLayers=null}},{key:"addLabelGraphic",value:function(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(A.E.LABEL))}},{key:"setCalloutGraphic",value:function(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}},{key:"calloutLayer",get:function(){return this._calloutLayer}},{key:"isDraped",get:function(){var e=!1;return this._forEachSymbolLayerGraphic((function(t){"draped"===t.type&&(e=!0)})),e}},{key:"isVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.E.GRAPHIC,t=arguments.length>1?arguments[1]:void 0,r=t?this._visibleFlags|t|A.E.LABEL*t:this._visibleFlags;return e===A.E.GRAPHIC?(r&A.P.ALL_GRAPHIC)===A.P.ALL_GRAPHIC:(r&A.P.ALL_LABEL)===A.P.ALL_LABEL}},{key:"setVisibilityFlag",value:function(e,t,r){var n=this.isVisible(e);r?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);var i=this.isVisible(e);if(n===i)return!1;if(e===A.E.LABEL)this._forEachLabelGraphic((function(e){return e.setVisibility(i)}));else{this._forEachSymbolLayerGraphic((function(e){return e.setVisibility(i)}));var a=this.isVisible(A.E.LABEL);this._forEachLabelGraphic((function(e){return e.setVisibility(a)}))}return!0}},{key:"getVisibilityFlag",value:function(e,t){return!!(this._visibleFlags&e*t)}},{key:"computeExtent",value:function(e){if(!this._extent){var t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,O.Ue)(),(0,E.TF)(t,this._extent);var r=t.spatialReference;if(!(0,R.fS)(r,e)&&!(0,P.d)(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}},{key:"getAsOptimizedGeometry",value:function(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}},{key:"_convertGraphicToOptimizedGeometry",value:function(e,t,r){var n=e.geometry;return"mesh"!==n.type&&"extent"!==n.type||(n=w.Z.fromExtent("mesh"===n.type?n.extent:n)),(0,k.GH)(n,t,r)}},{key:"usedMemory",get:function(){var e=(0,g.f2)(this.graphic.attributes);return this._forEachSymbolLayerGraphic((function(t){return e+=t.graphics3DSymbolLayer.usedMemory})),e}},{key:"computeAttachmentOrigin",value:function(){var e,t={render:{origin:(0,T.Ue)(),num:0},draped:{origin:(0,x.Ue)(),num:0}},r=(0,n.Z)(this.layers);try{for(r.s();!(e=r.n()).done;){var i=e.value;null!=i&&i.computeAttachmentOrigin(t)}}catch(a){r.e(a)}finally{r.f()}return t.render.num>1&&(0,S.j)(t.render.origin,t.render.origin,1/t.render.num),t.draped.num>1&&(0,b.bA)(t.draped.origin,t.draped.origin,1/t.draped.num),t}},{key:"getProjectedBoundingBox",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?(0,C.cS)(s.boundingBox):s.boundingBox=(0,C.cS)(),s.requiresDrapedElevation=!1,e.next=5,(0,v.Ed)(this.layers,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(o){var l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=o){e.next=2;break}return e.abrupt("return");case 2:return l="draped"===o.type?r:t,u=L.acquire(),e.next=6,o.getProjectedBoundingBox(l,n,s.screenSpaceObjects,i,u);case 6:c=e.sent,isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&(0,C.TC)(s.boundingBox,u),L.release(u);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:return e.abrupt("return",(0,C.sU)(s.boundingBox)||(0,O.sU)((0,C.y8)(s.boundingBox,I))?s:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"needsElevationUpdates",value:function(){var e,t,r,i=(0,n.Z)(this.layers);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(null!=a&&("object3d"===a.type||"lod-instance"===a.type)&&a.needsElevationUpdates)return!0}}catch(o){i.e(o)}finally{i.f()}return null!==(e=null===(t=this._labelLayers)||void 0===t?void 0:t.some((function(e){var t;return null!==(t=null===e||void 0===e?void 0:e.needsElevationUpdates)&&void 0!==t&&t})))&&void 0!==e&&e}},{key:"alignWithElevation",value:function(e,t,r){var n=this;this._forEachRenderedGraphic((function(i){"object3d"!==i.type&&"lod-instance"!==i.type||i.alignWithElevation(e,t,n._featureExpressionFeature,r)}))}},{key:"alignWithAbsoluteElevation",value:function(e,t,r){this._forEachRenderedGraphic((function(n){"object3d"===n.type&&n.alignWithAbsoluteElevation(e,t,r)}))}},{key:"addObjectStateSet",value:function(e,t){this._forEachSymbolLayerGraphic((function(r){return r.addObjectState(e,t)}))}},{key:"removeObjectState",value:function(e){this._forEachSymbolLayerGraphic((function(t){return t.removeObjectState(e)}))}},{key:"_forEachGraphicList",value:function(e,t){null===e||void 0===e||e.forEach((function(e){return e&&t(e)}))}},{key:"_forEachSymbolLayerGraphic",value:function(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}},{key:"_forEachLabelGraphic",value:function(e){this._forEachGraphicList(this._labelLayers,e)}},{key:"_forEachRenderedGraphic",value:function(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}},{key:"test",get:function(){}}]),e}(),M=r(58063),D=r(49253),z=r(32718),N=r(1413),F=r(10064),V=r(84652),H=r(68860),G=r(79347),B=r(29303),j=r(21389),W=r(29134),q=r(7025),J=r(37998),Y=r(86372),X=r(39406),K=r(11186),$=r(34311),Q=r(34610),ee=r(50951),te=r(69691),re=r(73614),ne=r(96387),ie=r(41325),ae=(r(59486),r(14320)),oe=r(26844),se=r(91526),le=r(79100),ue=r(40779),ce=r(4760),he=r(53866);function de(e,t,r){var n=(t.length>0?t[0]:e.length/3)-1,i=(0,oe.i)(e,n,r);if(i!==ae.R.Z){e=e.slice();for(var a=0;a<e.length;a+=3)e[a+i]=e[a+2]}return(0,G.e)(e,t,3)}function fe(e){var t=[[ce.T.POSITION,new se.a(e.attributeData.position,e.indices,3,!0)]],r=(0,X.LE)(e.indices.length);return null!=e.attributeData.colorFeature?t.push([ce.T.COLORFEATUREATTRIBUTE,new se.a([e.attributeData.colorFeature],r,1,!0)]):e.attributeData.color&&t.push([ce.T.COLOR,new se.a(e.attributeData.color,r,4,!0)]),e.attributeData.uvMapSpace&&t.push([ce.T.UVMAPSPACE,new se.a(e.attributeData.uvMapSpace,e.indices,4,!0)]),e.attributeData.boundingRect&&t.push([ce.T.BOUNDINGRECT,new se.a(e.attributeData.boundingRect,e.indices,9,!0)]),new ue.Z(e.material,t,e.mapPositions,le.U.Mesh,e.attributeData.objectAndLayerIdColor)}function ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=[[ce.T.POSITION,new se.a(e.attributeData.position,e.indices,3,!0)],[ce.T.UV0,new se.a(e.attributeData.uv0,e.indices,2,!0)]];return new ue.Z(e.material,r,e.mapPositions,le.U.Mesh,t)}function pe(e){switch(e.type){case"extent":if(e instanceof he.Z)return w.Z.fromExtent(e);break;case"polygon":return e}return null}var me=(0,l.Z)((function e(t,r,n){(0,s.Z)(this,e),this.renderData=t,this.layerUid=r,this.graphicUid=n,this.outGeometries=new Array})),ye=r(97689),ge=r(94463),_e=r(77648),be=r(50628),xe=r(91320),Se=r(19265);function Te(e,t,r,n){var i=(0,xe.Ni)(e.rings,!!e.hasZ&&"on-the-ground"!==n.mode,xe.ZI.CCW_IS_HOLE,e.spatialReference),a=(0,Y.bg)(i.position.length),o=(0,te.rR)(i.position,e.spatialReference,0,a,0,i.position,0,i.position.length/3,t,r,n),s=null!=o;return new Ae(i.position,a,Ce(i.polygons,i.position,a),Pe(i.outlines,i.position,a),s,o)}function we(e,t){for(var r=(0,xe.Ni)(e.rings,!1,xe.ZI.CCW_IS_HOLE),n=(0,be.projectBuffer)(r.position,e.spatialReference,0,r.position,t,0,r.position.length/3),i=2;i<r.position.length;i+=3)r.position[i]=Se.gi;return{position:r.position,polygons:Ce(r.polygons,r.position),outlines:Pe(r.outlines,r.position),projectionSuccess:n}}function Pe(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.filter((function(e){return e.count>1})).map((function(e){var n=e.index,i=e.count,a=3*n,o=3*i;return null!=r?new Re(n,i,(0,Y.Rq)(t,a,o),(0,Y.Rq)(r,a,o)):new Oe(n,i,(0,Y.Rq)(t,a,o))}))}function Ce(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=new Array,o=(0,n.Z)(e);try{var s=function(){var e=r.value,n=e.index,o=e.count,s=e.holeIndices,l=e.pathLengths;if(o<=1)return"continue";var u=3*n,c=3*o,h=s.map((function(e){return e-n})),d=null!=i?new Ee(n,o,(0,Y.Rq)(t,3*n,3*o),(0,Y.Rq)(i,u,c),h,l):new ke(n,o,(0,Y.Rq)(t,3*n,3*o),h,l);a.push(d)};for(o.s();!(r=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}return a}var Oe=(0,l.Z)((function e(t,r,n){(0,s.Z)(this,e),this.index=t,this.count=r,this.position=n})),Re=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,i)).mapPositions=a,o}return(0,l.Z)(r)}(Oe),Ee=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,o,l){var u;return(0,s.Z)(this,r),(u=t.call(this,e,n,i,a)).holeIndices=o,u.pathLengths=l,u}return(0,l.Z)(r)}(Re),ke=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,o){var l;return(0,s.Z)(this,r),(l=t.call(this,e,n,i)).holeIndices=a,l.pathLengths=o,l}return(0,l.Z)(r)}(Oe),Ae=(0,l.Z)((function e(t,r,n,i,a,o){(0,s.Z)(this,e),this.position=t,this.mapPositions=r,this.polygons=n,this.outlines=i,this.projectionSuccess=a,this.sampledElevation=o})),Ze=r(16010),Le=r(68401),Ie=r(17579),Ue=r(52920),Me=r(66327),De=r(86802),ze=["polygon","extent"],Ne=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,i,a)).ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i,o,s,l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=4;break}if(!(n=(0,ne.bh)(this._getSymbolSize()))){e.next=4;break}throw new F.Z("graphics3dextrudesymbollayer:invalid-size",n);case 4:i=null===(t=this.symbolLayer)||void 0===t||null===(r=t.material)||void 0===r?void 0:r.color,o=this._getCombinedOpacityAndColor(i),s=(0,T.nI)(o),l=o[3],u=l<1||this.needsDrivenTransparentPass,c={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:s,ambient:s,opacity:l,transparent:u,cullFace:u?Le.Vr.None:Le.Vr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Ze.r.Compressed},this._materials[Qe.Main]=new De.Gp(c),this._materials[Qe.Bottom]=new De.Gp((0,N.Z)((0,N.Z)({},c),{},{cullFace:Le.Vr.Back})),this._context.stage.addMany(this._materials);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.removeMany(this._materials),this._materials.length=0}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,ze,this.symbolLayer.type))return null;var r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(t);return this._createAs3DShape(t,e.renderingInfo,r,n,t.uid)}},{key:"layerOpacityChanged",value:function(e,t){var r,n,i,a,o=this,s=null===(r=this.symbolLayer)||void 0===r||null===(n=r.material)||void 0===n?void 0:n.color,l=this._getCombinedOpacity(s),u=l<1||this.needsDrivenTransparentPass;null!==(i=this._materials[Qe.Main])&&void 0!==i&&i.setParameters({opacity:l,transparent:u}),null===(a=this._materials[Qe.Bottom])||void 0===a||a.setParameters({opacity:l,transparent:u});var c=this._getLayerOpacity();e.forEach((function(e){var r=t(e);null!=r&&r.layerOpacityChanged(c,o._context.isAsync)}))}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,te.B5)}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r,n,i=this;return null!==(r=this._materials[Qe.Main])&&void 0!==r&&r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),null!==(n=this._materials[Qe.Bottom])&&void 0!==n&&n.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach((function(e){var r=t(e);null!=r&&r.slicePlaneEnabledChanged(i._context.slicePlaneEnabled,i._context.isAsync)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){var e,t,r={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0};return null!==(e=this._materials[Qe.Main])&&void 0!==e&&e.setParameters(r),null!==(t=this._materials[Qe.Bottom])&&void 0!==t&&t.setParameters(r),!0}},{key:"_getExtrusionSize",value:function(e){var t,r;return r=e.size&&this._drivenProperties.size?null!==(t=(0,Q.sV)(e.size,2))&&void 0!==t?t:0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters}},{key:"applyRendererDiff",value:function(e,t){return this._drivenPropertiesChanged(t)?ie.W.RecreateSymbol:ie.W.RecreateGraphics}},{key:"queryForSnapping",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){var o,s,l,u,c,h,d,f,v,p,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=this._getExtrusionSize(n)*this._context.renderCoordsHelper.unitInMeters/(0,H._R)(r),l=t.objectId,u=t.target,c=(0,V.d9)(u),e.t0=(c.z=(null!==(o=c.z)&&void 0!==o?o:0)+s,t.type),e.next="edge"===e.t0?4:"vertex"===e.t0?6:7;break;case 4:return f=t.start,v=t.end,p=(0,V.d9)(f),m=(0,V.d9)(v),e.abrupt("return",(p.z=(null!==(h=p.z)&&void 0!==h?h:0)+s,m.z=(null!==(d=m.z)&&void 0!==d?d:0)+s,[(0,$.p)(l,c,1/0,p,m)]));case 6:return e.abrupt("return",[(0,$.u)(l,c,1/0),(0,$.p)(l,u,1/0,u,c)]);case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_getSymbolSize",value:function(){var e;return null!==(e=this.symbolLayer.size)&&void 0!==e?e:1}},{key:"_createAs3DShape",value:function(e,t,r,i,a){var o=pe(e.geometry);if(null==o)return null;if(0===o.rings.length||!o.rings.some((function(e){return e.length>0})))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;var s=Te(o,this._context.elevationProvider,this._context.renderCoordsHelper,i);this._logGeometryCreationWarnings(s,o.rings,"rings","ExtrudeSymbol3DLayer");var l=(0,ne.zE)(o);if(null==l)return null;var u=new Array,c=new Array,h=(0,C.Ue)(),d=(0,q.Ue)(),f=(0,T.Ue)(),v=this._context.renderCoordsHelper.viewingMode===ee.JY.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,f),(0,J.B)(o.spatialReference,[l.x,l.y,0],d,this._context.renderCoordsHelper.spatialReference);var p=(0,q.Ue)();(0,W.U_)(p,d);var m=(0,j.Ue)();(0,B.XL)(m,p);var y,g=s.polygons,_=s.mapPositions,b=s.position,x=new Map,w=this._materials[Qe.Main],P=(0,n.Z)(g);try{for(P.s();!(y=P.n()).done;){var O=y.value,R=O.count;if(!this._context.clippingExtent||((0,C.cS)(h),(0,C.G1)(h,O.mapPositions),(0,C.Zp)(h,this._context.clippingExtent))){var E=(0,G.e)(O.mapPositions,O.holeIndices,3);if(0!==E.length){var k=E.length,A=6*R,Z=(0,X.$z)(A+k),L=(0,X.$z)(k),I=(0,Y.bg)(3*A),U=(0,Y.bg)(3*A),D=(0,Y.bg)(3*A),z=(0,Y.bg)(A);Ve(b,_,E,O,I,D,U,z,Z,L,this._getExtrusionSize(t),f,v),(0,K.a)(I,I,p);var N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),F=new ct(I,D,(0,Ue.nG)(U),z),V=Fe(w,Z,Z.length-L.length,F,r,N),H=R,$=R,Q=2*O.count,re=new ht(H,$,Q,k/3);$e(V,re,d),x.set(V,re),u.push(V,Fe(this._materials[Qe.Bottom],L,0,F,r,N)),c.push(F.heights)}}}}catch(le){P.e(le)}finally{P.f()}if(0===u.length)return null;var ie=new Me.T({geometries:u,layerUid:this._context.layer.uid,graphicUid:a,isElevationSource:!0});ie.transformation=d;var ae=(0,ye.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),oe=null!=ae?{baseMaterial:this._materials[Qe.Main],edgeMaterials:[ae],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,se=new M.z(this,ie,u,null,null,(function(e,t,r,n,i){return function(e,t,r,n,i,a,o){for(var s=e.stageObject,l=s.geometries,u=l.length,c="absolute-height"!==t.mode,h=0,d=s.transformation,f=(0,W.iS)((0,q.Ue)(),d),v=0;v<u;v+=2){var p=l[v];if((0,Ie.T)(p)){for(var m=p.getMutableAttribute(ce.T.POSITION).data,y=a[v/2],g=new _e.sb(p.mapPositions),_=m.length/3,b=!1,x=0,T=0,w=0;w<_;w++){Ke[0]=m[T],Ke[1]=m[T+1],Ke[2]=m[T+2],n(g,rt),c&&(x+=rt.sampledElevation),ge.h.TESTS_DISABLE_OPTIMIZATIONS?((0,S.s)(et,g.array[g.offset],g.array[g.offset+1],rt.z+y[T/3]),null!=r&&i.toRenderCoords(et,r,et),(0,S.h)(et,et,f)):((0,S.s)(et,m[T],m[T+1],m[T+2]),(0,S.h)(et,et,d),i.setAltitude(et,rt.z+y[T/3]),(0,S.h)(et,et,f)),m[T]=et[0],m[T+1]=et[1],m[T+2]=et[2];var P=at/i.unitInMeters;(Math.abs(Ke[0]-m[T])>=P||Math.abs(Ke[1]-m[T+1])>=P||Math.abs(Ke[2]-m[T+2])>=P)&&(b=!0),g.offset+=3,T+=3}if(b){var C=o.get(p);C&&$e(p,C,d),s.geometryVertexAttributeUpdated(l[v],ce.T.NORMALCOMPRESSED),p.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l[v],ce.T.POSITION),l[v+1].invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(l[v+1],ce.T.POSITION)}h+=x/_}}return h/u}(e,t,r,n,i,c,x)}),i,oe);return se.alignedSampledElevation=s.sampledElevation,se.needsElevationUpdates=(0,te.B5)(i.mode),se}}]),r}(re.k);function Fe(e,t,r,n,i,a){var o=(0,X.LE)(t.length),s=[[ce.T.POSITION,new se.a(n.positions,t,3,!0)],[ce.T.NORMALCOMPRESSED,new se.a(n.normals,t,2,!0)],[ce.T.COLOR,new se.a(i,o,4,!0)]];return new ue.Z(e,s,n.elevation,le.U.Mesh,a,r)}function Ve(e,t,r,n,i,a,o,s,l,u,c,h,d){var f=r.length/3,v=2*n.count;!function(e,t,r,n,i,a,o,s,l,u,c,h,d,f,v,p,m){(0,S.c)(tt,p);for(var y=v>0?1:-1,g=3*r,_=0,b=3*_,x=n,T=3*x,w=0;w<n;++w){var P=e[g],C=e[g+1],O=e[g+2];m&&(tt[0]=P,tt[1]=C,tt[2]=O,(0,S.n)(tt,tt)),s[b+0]=P,s[b+1]=C,s[b+2]=O;var R=t[g+0],E=t[g+1],k=t[g+2];l[b+0]=R,l[b+1]=E,l[b+2]=k,u[b+0]=-y*tt[0],u[b+1]=-y*tt[1],u[b+2]=-y*tt[2],c[_]=0,s[T+0]=P+v*tt[0],s[T+1]=C+v*tt[1],s[T+2]=O+v*tt[2],l[T+0]=R,l[T+1]=E,l[T+2]=k,c[x]=v,b+=3,T+=3,g+=3,_+=1,x+=1}for(var A=3*a,Z=0,L=3*f,I=v<0?it:nt,U=v<0?nt:it,M=0;M<o;++M)d[Z]=i[A+I[0]],d[Z+1]=i[A+I[1]],d[Z+2]=i[A+I[2]],h[L]=i[A+U[0]]+n,h[L+1]=i[A+U[1]]+n,h[L+2]=i[A+U[2]]+n,Z+=3,L+=3,A+=3}(e,t,n.index,n.count,r,0,f,i,a,o,s,l,u,v,c,h,d);var p=0,m=2*n.count,y=0,g=n.pathLengths[0];Be(i,a,s,o,p,g,n.count,m,l,y,c),m+=4*g,y+=2*g,p+=g;for(var _=1;_<n.pathLengths.length;++_){var b=n.pathLengths[_];Be(i,a,s,o,p,b,n.count,m,l,y,c),m+=4*b,y+=2*b,p+=b}}function He(e,t,r,n,i,a,o){n[a]=n[o],o*=3,e[a*=3]=e[o],e[a+1]=e[o+1],e[a+2]=e[o+2],t[a]=t[o],t[a+1]=t[o+1],t[a+2]=t[o+2],r[a]=i[0],r[a+1]=i[1],r[a+2]=i[2]}var Ge=(0,T.Ue)();function Be(e,t,r,n,i,a,o,s,l,u,c){var h=i,d=i+1,f=i+o,v=i+o+1,p=s,m=s+1,y=s+2*a,g=s+2*a+1;c<0&&(h=i+o+1,v=i);for(var _=3*u,b=0;b<a;++b)b===a-1&&(d=i,c>0?v=i+o:h=i+o),Xe(e,h,d,f,Ge),He(e,t,n,r,Ge,p,h),He(e,t,n,r,Ge,m,d),He(e,t,n,r,Ge,y,f),He(e,t,n,r,Ge,g,v),l[_]=p,l[_+1]=y,l[_+2]=g,l[_+3]=p,l[_+4]=g,l[_+5]=m,_+=6,h++,d++,f++,v++,p+=2,m+=2,y+=2,g+=2}var je=(0,T.Ue)(),We=(0,T.Ue)(),qe=(0,T.Ue)(),Je=(0,T.Ue)(),Ye=(0,T.Ue)();function Xe(e,t,r,n,i){t*=3,r*=3,n*=3,(0,S.s)(je,e[t++],e[t++],e[t++]),(0,S.s)(We,e[r++],e[r++],e[r++]),(0,S.s)(qe,e[n++],e[n++],e[n++]),(0,S.f)(Je,We,je),(0,S.f)(Ye,qe,je),(0,S.b)(i,Ye,Je),(0,S.n)(i,i)}var Ke=(0,T.Ue)();function $e(e,t,r){for(var n=e.getMutableAttribute(ce.T.POSITION),i=e.getMutableAttribute(ce.T.NORMALCOMPRESSED).data,a=t.topVertexStart,o=t.topVertexCount,s=t.topFaceStart,l=t.topFaceCount,u=n.data,c=o,h=e.attributes.get(ce.T.POSITION).indices,d=s+l,f=a+o,v=(0,Y.bg)(3*c),p=0;p<c;++p){var m=3*p;v[m+0]=0,v[m+1]=0,v[m+2]=0}for(var y=ot,g=st,_=lt,b=ut,x=tt,T=s;T<d;++T){for(var w=3*T,P=0;P<3;++P){var C=h[w+P];b[P]=C;var O=3*C;(0,S.s)(et,u[O+0],u[O+1],u[O+2]),(0,S.h)(y[P],et,r)}(0,S.z)(g,y[1],y[0]),(0,S.z)(_,y[2],y[0]),(0,S.b)(x,g,_),(0,S.n)(x,x);for(var R=0;R<3;++R){var E=3*(b[R]-a);v[E+0]+=x[0],v[E+1]+=x[1],v[E+2]+=x[2]}}for(var k=a;k<f;++k){var A=3*(k-a),Z=v[A+0],L=v[A+1],I=v[A+2],U=Math.sqrt(Z*Z+L*L+I*I);(0,Ue.hd)(i,k,Z/U,L/U,I/U)}}var Qe,et=(0,T.Ue)(),tt=(0,T.Ue)(),rt=new te.Lm,nt=[0,2,1],it=[0,1,2],at=.01,ot=[(0,T.Ue)(),(0,T.Ue)(),(0,T.Ue)()],st=(0,T.Ue)(),lt=(0,T.Ue)(),ut=[0,0,0];!function(e){e[e.Main=0]="Main",e[e.Bottom=1]="Bottom"}(Qe||(Qe={}));var ct=(0,l.Z)((function e(t,r,n,i){(0,s.Z)(this,e),this.positions=t,this.elevation=r,this.normals=n,this.heights=i})),ht=(0,l.Z)((function e(t,r,n,i){(0,s.Z)(this,e),this.topVertexStart=t,this.topVertexCount=r,this.topFaceStart=n,this.topFaceCount=i})),dt=r(29439),ft=r(51995),vt=r(92026),pt=r(17842),mt=r(643),yt=r(35995),gt=r(86361),_t=r(68859),bt=r(819),xt=r(78915),St=r(26707),Tt=r(31027),wt=r(49729),Pt=r(29122),Ct=r(83748),Ot=r(74579),Rt=r(91935),Et=r(61310),kt=r(52919),At=r(78289),Zt=function(){function e(t,r,n,i){(0,s.Z)(this,e),this.graphics3DSymbolLayer=t,this.renderGeometries=r,this.boundingBox=n,this._drapeSourceRenderer=i,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}return(0,l.Z)(e,[{key:"initialize",value:function(e){this.stage=e.stage}},{key:"setVisibility",value:function(e){if(null!=this.stage&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,At.T.ADD);if(e||this._addedToStage){var t,r=(0,n.Z)(this.renderGeometries);try{for(r.s();!(t=r.n()).done;){t.value.visible=this._visible}}catch(i){r.e(i)}finally{r.f()}this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,At.$.VISIBILITY)}}}},{key:"destroy",value:function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,At.T.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,T.Ue)();return(0,S.s)(e,0,0,0)}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,C.Ue)();return(0,C.cS)(e)}},{key:"addObjectState",value:function(e,t){var r=this;e===Le.V_.Highlight&&(this.renderGeometries.forEach((function(e){var n=e.geometry.addHighlight();t.addRenderGeometry(e,n,r)})),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,At.$.HIGHLIGHT))}},{key:"removeObjectState",value:function(e){this.renderGeometries.forEach((function(t){e.removeRenderGeometry(t)}))}},{key:"removeRenderGeometryObjectState",value:function(e,t){e.geometry.removeHighlight(t),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,At.$.HIGHLIGHT)}},{key:"computeAttachmentOrigin",value:function(e){var t,r=(0,n.Z)(this.renderGeometries);try{for(r.s();!(t=r.n()).done;){t.value.geometry.computeAttachmentOrigin(Ut)&&(e.draped.origin[0]+=Ut[0],e.draped.origin[1]+=Ut[1],e.draped.num++)}}catch(i){r.e(i)}finally{r.f()}}},{key:"getProjectedBoundingBox",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,o){var s,l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for((0,C.cS)(o),s=0;s<this.renderGeometries.length;s++)l=this.renderGeometries[s],this._getRenderGeometryProjectedBoundingRect(l,t,Lt,n),(0,C.VK)(o,Lt);if(!r){e.next=14;break}return(0,C.be)(o,Ut),c=(0,ne.Si)(o,r.service.spatialReference,r),e.prev=5,e.next=8,r.service.queryElevation(Ut[0],Ut[1],i,c,"ground");case 8:u=e.sent,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:null!=u&&(o[2]=Math.min(o[2],u),o[5]=Math.max(o[5],u));case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"_getRenderGeometryProjectedBoundingRect",value:function(e,t,r,n){if(this.boundingBox)(0,C.t8)(It,this.boundingBox);else{var i=e.boundingSphere,a=i[3];It[0]=i[0]-a,It[1]=i[1]-a,It[2]=i[2]-a,It[3]=i[0]+a,It[4]=i[1]+a,It[5]=i[2]+a}return t(It,0,2),this.calculateRelativeScreenBounds&&n.push({location:(0,C.be)(It),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,C.y8)(It,r)}}]),e}(),Lt=(0,O.Ue)(),It=(0,C.Ue)(),Ut=(0,T.Ue)(),Mt=r(31908),Dt=r(36759),zt=r(66202),Nt=r(67794),Ft=r(70619),Vt=r(39077),Ht=r(1487),Gt=r(21400),Bt=(0,T.al)(0,0,1),jt=Nt.hy,Wt=[jt/2,jt/2,1-jt/2,1-jt/2],qt=[Nt.wm*jt,Nt.wm*jt],Jt=function(e){(0,h.Z)(n,e);var t=(0,d.Z)(n);function n(e,r,i,a){var o;return(0,s.Z)(this,n),(o=t.call(this,e,r,i,a))._cimSymbolMaterials=new Map,o._cimSymbolTextures=new Map,o._cimMaterialParametersInfo=null,o._size=null,o._symbolTextureRatio=1,o._outlineSize=0,o._patchTask=null,o._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0},o}return(0,l.Z)(n,[{key:"getCachedSize",value:function(){return{size:this._getIconSize()}}},{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._validateOrThrow(),r=this._prepareMaterialParameters(),null==(n=this._getPrimitive())){e.next=6;break}this._prepareResourcesPrimitive(r,n),e.next=14;break;case 6:if(i=(0,Ot.nf)(this.symbolLayer),null==(o=Xt(i))){e.next=12;break}return e.next=10,this._prepareResourcesCIM(r,JSON.parse(o),t);case 10:e.next=14;break;case 12:return e.next=14,this._prepareResourcesHref(r,i,t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_validateOrThrow",value:function(){if(!this._drivenProperties.size){var e=(0,ne.bh)(this._getIconSize());if(e)throw new F.Z("graphics3diconsymbollayer:invalid-size",e)}}},{key:"_getIconSize",value:function(){var e=this.symbolLayer,t=Math.round(null!=e.size?(0,pt.F2)(e.size):16);return this._drivenProperties.size?Math.max(t,64):t}},{key:"_generateTextureCIM",value:function(e){var t=this._cimData;if(t&&t.symbol||this.logger.error("Can't create texture, CIM data is undefined"),t.primitiveOverrides){var r=(t=(0,V.d9)(t)).primitiveOverrides;St.E.evaluateOverrides(r,e,this._arcadeInfo.geometryType,null,null),St.E.applyOverrides(t.symbol,r)}var n=(0,mt.hP)(JSON.stringify(t)),i=this._cimSymbolTextures.get(n);if(i)return i;var a=this._context.sharedResources.cimSymbolRasterizer,o=this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null;o&&St.E.applyDictionaryTextOverrides(t.symbol,e,o,null);var s=null!=this._cimScaleFactorOrFunction?(0,Tt.hf)(this._cimScaleFactorOrFunction,e):1;1!==s&&t.symbol&&(0,wt.YV)(t.symbol,s,!0);var l=xt.B$.getEnvelope(t,null,a.resourceManager);if(null!==l&&void 0!==l&&l.width&&l.height){var u,c,h=l.x+l.width/2,d=l.y+l.height/2,f=a.rasterize({type:"cim",data:t},l.width,l.height,h,d,1,"esriGeometryPoint"),v=new Ct.e({x:-l.x/l.width-.5,y:(l.height+l.y)/l.height-.5});this._cimMaterialParametersInfo.anchorPosition=Kt("relative",v),i=new Ht.x(f,{width:null!==(u=null===f||void 0===f?void 0:f.width)&&void 0!==u?u:1,height:null!==(c=null===f||void 0===f?void 0:f.height)&&void 0!==c?c:1,reloadable:!0})}else i=new Ht.x(new ImageData(1,1),{width:1,height:1,reloadable:!0});return this._cimSymbolTextures.set(n,i),this._context.stage.add(i),i}},{key:"_prepareMaterialParameters",value:function(){var e={anchorPosition:Kt(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},t=this.symbol;if(function(e){return e&&"point-3d"===e.type&&e.hasVisibleVerticalOffset()}(t)){var r=t.verticalOffset,n=r.screenLength,i=r.minWorldLength,a=r.maxWorldLength;e.verticalOffset={screenLength:(0,pt.F2)(n),minWorldLength:i||0,maxWorldLength:null!=a?a:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!(0,p.Z)("enable-feature:non-occluded-hud"),e.hasSlicePlane=this._context.slicePlaneEnabled,e}},{key:"_prepareResourcesPrimitive",value:function(e,t){var r=this._getOutlineSize();if(Yt(t)&&0===r)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,null!=this._context.sharedResources.textures){var n=this._context.sharedResources.textures.fromData("".concat(t,"-icon"),(function(){return(0,Nt.cU)(t)}));this._textureHandle=n,e.textureId=n.texture.id}e.textureIsSignedDistanceField=!0,e.sampleSignedDistanceFieldTexelCenter=(0,Nt.Rg)(t),e.distanceFieldBoundingBox=Wt;var i=this._getIconSize();this._size=[i,i],this._symbolTextureRatio=1/jt,this._createMaterialAndAddToStage(e,this._context.stage)}},{key:"_prepareResourcesHref",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1,i=this._getIconSize(),o=i*this._context.graphicsCoreOwner.view.state.rasterPixelRatio,null==this._context.sharedResources.textures){e.next=12;break}return e.next=5,(0,v.q6)(this._context.sharedResources.textures.fromUrl(r,o,{signal:n}));case 5:if(!1!==(s=e.sent).ok){e.next=9;break}throw(0,m.r9)(s.error),new F.Z("graphics3diconsymbollayer:request-failed","Failed to load (Request for icon resource failed: ".concat(r,")"));case 9:this._textureHandle=s.value,l=s.value.texture,this._size=$t(l,i),t.textureId=l.id;case 12:this._createMaterialAndAddToStage(t,this._context.stage);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_prepareResourcesCIM",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,i){var o,s,l,u,c,h,d,f,v,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cimData=n,this._context.sharedResources.cimSymbolRasterizer){e.next=5;break}return e.next=3,r.e(94304).then(r.bind(r,94304));case 3:o=e.sent.CIMSymbolRasterizer,(0,m.k_)(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new o(this._context.renderCoordsHelper.spatialReference));case 5:if(s=this._context.sharedResources.cimSymbolRasterizer,l=[],c=null===(u=n)||void 0===u?void 0:u.symbol,xt.B$.fetchResources(c,s.resourceManager,l,i),xt.B$.fetchFonts(c,s.resourceManager,l),h=this._context.layer.fields?this._context.layer.fields.map((function(e){return e.toJSON()})):[],d=this._context.renderCoordsHelper.spatialReference,this._arcadeInfo={spatialReference:d,fields:h,geometryType:"esriGeometryPoint"},null!==u&&void 0!==u&&u.primitiveOverrides&&l.push(St.E.createRenderExpressions(u.primitiveOverrides,this._arcadeInfo)),e.t0=l.length>0,!e.t0){e.next=15;break}return e.next=14,Promise.all(l);case 14:(0,m.k_)(i);case 15:if(!this._context.renderer||"dictionary"!==this._context.renderer.type||!this._context.renderer.scaleExpression){e.next=23;break}if(!(f=this._context.renderer).scaleExpression){e.next=23;break}return v=f.scaleExpression,e.next=21,(0,bt.Yi)(v,this._context.layer.spatialReference,h);case 21:p=e.sent,this._cimScaleFactorOrFunction=function(e,t,r){var n=(0,Rt.Z)(p,e,{$view:r},"esriGeometryPoint",t);return null!==n?n:1};case 23:(0,m.k_)(i),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1;case 24:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getPrimitive",value:function(){var e,t,r;return null!==(e=this.symbolLayer.resource)&&void 0!==e&&e.href?null:null!==(t=null===(r=this.symbolLayer.resource)||void 0===r?void 0:r.primitive)&&void 0!==t?t:Pt.S}},{key:"_getOutlineSize",value:function(){var e,t,r=this.symbolLayer;return null!=(null===(e=r.outline)||void 0===e?void 0:e.size)?Math.max((0,pt.F2)(r.outline.size),0):(t=Yt(this._getPrimitive())?1.5:0,Math.max(t,0))}},{key:"_getOutlineColor",value:function(){var e,t=this._getLayerOpacity(),r=this.symbolLayer,n=null===r||void 0===r||null===(e=r.outline)||void 0===e?void 0:e.color;if(null!=n){var i=ft.Z.toUnitRGB(n),a=n.a*t;return[i[0],i[1],i[2],a]}return[0,0,0,0]}},{key:"_getFillColor",value:function(){var e,t;if(Yt(this._getPrimitive()))return Et.Cj;var r=null==this._getPrimitive(),n=null===(e=this.symbolLayer)||void 0===e||null===(t=e.material)||void 0===t?void 0:t.color;return this._getCombinedOpacityAndColor(n,{hasIntrinsicColor:r})}},{key:"_createMaterialAndAddToStage",value:function(e,t){if(this._cimData){var r;this._fastUpdates=null;var n=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return n||(n=new Gt.A(e),this._cimSymbolMaterials.set(null!==(r=e.textureId)&&void 0!==r?r:0,n),t.add(n)),n}return this._fastUpdates=(0,zt.vT)(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e=(0,N.Z)((0,N.Z)({},e),this._fastUpdates.materialParameters)),this._materials[0]=new Gt.A(e),t.add(this._materials[0]),this._materials[0]}},{key:"_setDrapingDependentMaterialParameters",value:function(){var e=this;this.draped&&(this._forEachMaterial((function(t){t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,draped:e.draped})})),this.layerOpacityChanged())}},{key:"destroy",value:function(){var e=this;(0,u.Z)((0,c.Z)(n.prototype),"destroy",this).call(this),this._patchTask=(0,vt.IM)(this._patchTask),this._forEachMaterial((function(t){return e._context.stage.remove(t)})),this._materials.length=0,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach((function(t){return e._context.stage.remove(t)})),this._cimSymbolTextures.clear(),this._textureHandle=(0,vt.RY)(this._textureHandle)}},{key:"_getScaleFactor",value:function(e,t){if(this._drivenProperties.size&&e.size){for(var r=0;r<3;r++){var n=e.size[r];n&&"symbol-value"!==n&&"proportional"!==n&&(e.size[r]=(0,pt.F2)(n))}if("symbol-value"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/t;if(isFinite(+e.size[2]))return+e.size[2]/t}return 1}},{key:"createGraphics3DGraphic",value:function(e){var t,r=e.graphic;if(!this._validateGeometry(r.geometry))return null;var n,i=[0,0];if(this._cimData){if(!this._cimData.symbol)return null;var a=this._generateTextureCIM(r),o=(0,N.Z)({textureId:a.id},this._cimMaterialParametersInfo);n=this._createMaterialAndAddToStage(o,this._context.stage);var s=window.devicePixelRatio||1;i=[a.parameters.width/s,a.parameters.height/s]}else i=this._size,n=this._materials[0];var l=(0,Dt.S_)(r.geometry);if(null==l)return this.logger.warn("unsupported geometry type for icon symbol: ".concat(r.geometry.type)),null;var u=e.renderingInfo,c=this._getVertexOpacityAndColor(u),h=1;if(null===(t=this._fastUpdates)||void 0===t||!t.visualVariables.size){var d=i[0]>i[1]?i[0]:i[1];h=this._getScaleFactor(u,d)}h*=this._symbolTextureRatio;var f=(0,x.al)(i[0]*h,i[1]*h),v=this.setGraphicElevationContext(r);return this.ensureDrapedStatus("on-the-ground"===v.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,l,n,c,f,e.layer.uid):this._createAs3DShape(r,l,n,c,f,v,r.uid)}},{key:"layerOpacityChanged",value:function(){var e=this._getFillColor(),t=this._getOutlineColor();this._forEachMaterial((function(r){r.setParameters({color:e}),r.setParameters({outlineColor:t})}))}},{key:"updateGeometry",value:function(e,t){if(this.draped||!this._validateGeometry(t))return!1;var r=e.elevationContext,n=e.stageObject;if(r.mode!==this.getGeometryElevationMode(t))return!1;var i=(0,Dt.S_)(t);if(!i)return!1;var a=(0,Dt.Cd)(n,this._context,i,r);if(null==a)return!1;var o=(0,Dt.S9)(this._context,i);return n.geometries[0].localOrigin===o&&(e.alignedSampledElevation=a,(0,Dt.dO)(e,i,this._context.elevationProvider),!0)}},{key:"layerElevationInfoChanged",value:function(e,t,r){var i=this._elevationContext.mode,a=(0,te.GC)(n.elevationModeChangeTypes,r,i);if(a!==te.lO.UPDATE)return a;var o=(0,te.Xf)(i)||"absolute-height"===i;return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){var e=this;return this.draped||this._forEachMaterial((function(t){t.setParameters({hasSlicePlane:e._context.slicePlaneEnabled})})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",get:function(){return null!=this._getPrimitive()}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){var n;if("visualVariables"!==r)return ie.W.RecreateSymbol;if(!(0,zt.Tc)(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return ie.W.RecreateSymbol;null===(n=this._materials[0])||void 0===n||n.setParameters(this._fastUpdates.materialParameters)}return ie.W.FastUpdate}},{key:"prepareSymbolLayerPatch",value:function(e){var t;if(null!==(t=this._patchTask)&&void 0!==t&&t.abort(),"partial"===e.diff.type){var r=e.diff.diff;this._preparePatchResource(e,r)}}},{key:"_preparePatchResource",value:function(e,t){var r,n=this;if(t.resource&&"partial"===t.resource.type){var i=t.resource.diff;if("complete"===(null===i||void 0===i||null===(r=i.href)||void 0===r?void 0:r.type)){var s=i.href.newValue,l=this._context.sharedResources.textures;if(null!=s&&null!=l&&null==Xt(s)){var u=this._getIconSize(),c=u*this._context.graphicsCoreOwner.view.state.pixelRatio;e.symbolLayerStatePatches.push((function(){n._patchTask=(0,vt.IM)(n._patchTask),n._patchTask=(0,v.vr)((function(e){return n._context.schedule(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i,o,h,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.q6)(l.fromUrl(s,c,{signal:r}));case 2:if(i=e.sent,(0,m.k_)(r),(o=!i.ok)&&(0,m.r9)(i.error),n._textureHandle=(0,vt.RY)(n._textureHandle),n._patchTask=null,!o){e.next=9;break}return n._forEachMaterial((function(e){e.visible=!1,e.setParameters({textureId:null})})),h="Failed to load (Request for icon resource failed: ".concat(s,")"),e.abrupt("return",void n.logger.error(new F.Z("graphics3diconsymbollayer:request-failed",h)));case 9:n._textureHandle=i.value,d=i.value.texture,n._size=$t(d,u),n._forEachMaterial((function(e){e.setParameters({textureId:d.id}),e.visible=!0}));case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e)}))})),delete i.href}}}}},{key:"_defaultElevationInfoNoZ",value:function(){return Qt}},{key:"_createAs3DShape",value:function(e,t,r,n,i,a,o){var s=this.getFastUpdateAttrValues(e),l=this._context.layer.uid,u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:l}),c=(0,Ft.dV)(r,Bt,null,n,i,er,null,s,u),h=(0,Dt.ZC)(this._context,t,c,a,o);if(null==h)return null;var d=new M.z(this,h.object,[c],null,null,kt.j3,a);return d.alignedSampledElevation=h.sampledElevation,d.needsElevationUpdates=(0,te.Xf)(a.mode)||"absolute-height"===a.mode,d.getScreenSize=this._createScreenSizeGetter(i,s),d.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(d.getScreenSize(),1,e)},(0,Dt.dO)(d,t,this._context.elevationProvider),d}},{key:"_createAsOverlay",value:function(e,t,r,n,i,a){r.renderPriority=this._renderPriority;var o=(0,T.Ue)();(0,_t.K)(t,o,this._context.overlaySR),o[2]=Se.gi;var s=this._context.clippingExtent;if(null!=s&&!(0,C.BD)(s,o))return null;var l=this.getFastUpdateAttrValues(e),u=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),c=(0,Ft.dV)(r,Bt,o,n,i,null,null,l,u),h=new Vt.z(c,{layerUid:a,graphicUid:e.uid}),d=new Zt(this,[h],null,this._context.drapeSourceRenderer);return d.getScreenSize=this._createScreenSizeGetter(i,l),d.calculateRelativeScreenBounds=function(e){return r.calculateRelativeScreenBounds(d.getScreenSize(),1,e)},d}},{key:"_createScreenSizeGetter",value:function(e,t){var r=this,n=this._outlineSize+2;if(this._fastUpdates&&t){var i=e[0]/this._symbolTextureRatio,a=e[1]/this._symbolTextureRatio;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,x.Ue)(),o=(0,zt.FE)(tr,r._fastUpdates.materialParameters,t),s=(0,dt.Z)(o,2),l=s[0],u=s[1];return e[0]=l*i+n,e[1]=u*a+n,e}}var o=e[0]/this._symbolTextureRatio+n,s=e[1]/this._symbolTextureRatio+n;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,x.Ue)();return e[0]=o,e[1]=s,e}}},{key:"_fastVisualVariableConvertOptions",value:function(){var e=Math.max(this._size[0],this._size[1]),t=(0,T.al)(e,e,e),r=(0,pt.Wz)(1),n=e*r,i=(0,T.al)(n,n,n);return new zt.Z3({size:!0,color:!0,rotation:!0,opacity:!1},t,i,r)}},{key:"_forEachMaterial",value:function(e){this._materials.forEach(e),this._cimSymbolMaterials.forEach(e)}},{key:"test",value:function(){return(0,N.Z)((0,N.Z)({},(0,u.Z)((0,c.Z)(n.prototype),"test",this).call(this)),{},{material:this._materials[0]})}}]),n}(re.k);function Yt(e){return null!=e&&("cross"===e||"x"===e)}function Xt(e){var t=(0,yt.sJ)(e);return"application/json"===(null===t||void 0===t?void 0:t.mediaType)?t.data:void 0}function Kt(e,t){return"relative"===e?(0,x.al)((t.x||0)+.5,.5-(t.y||0)):e in Mt.yY?Mt.yY[e]:Mt.yY.center}function $t(e,t){var r,n,i=e.parameters,a=(null!==(r=i.width)&&void 0!==r?r:1)/(null!==(n=i.height)&&void 0!==n?n:1);return a>1?[t,Math.round(t/a)]:[Math.round(t*a),t]}Jt.PRIMITIVE_SIZE=qt,Jt.elevationModeChangeTypes={definedChanged:te.lO.UPDATE,staysOnTheGround:te.lO.NONE,onTheGroundChanged:te.lO.RECREATE};var Qt={mode:"relative-to-ground",offset:0},er=(0,gt.al)(0,0,0,1),tr=(0,T.Ue)(),rr=r(737);function nr(e){switch(e){case"butt":return rr.R.BUTT;case"square":return rr.R.SQUARE;case"round":return rr.R.ROUND;default:return null}}function ir(e){return"diamond"===e?"kite":e}var ar,or,sr=r(79685),lr=r(78081),ur=r(21317),cr=r(86700),hr=r(58901),dr=["polyline","polygon","extent"],fr=new zt.Z3({size:!0,color:!0,rotation:!1,opacity:!0}),vr=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){return(0,s.Z)(this,r),t.call(this,e,n,i,a)}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fastUpdates=(0,zt.vT)(this._context.renderer,fr),this._drivenProperties.size){e.next=3;break}if(!((null!=this.symbolLayer.size?this.symbolLayer.size:(0,pt.Wz)(1))<0)){e.next=3;break}throw new F.Z("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getMaterialParameters",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._getCombinedOpacityAndColor(n&&this._markerColor||this._materialColor);this._patternHidesLine&&!n&&(i[3]=0);var a={width:this._computeMaterialWidth(null===(t=this.symbolLayer)||void 0===t?void 0:t.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:nr(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:(0,cr.Dp)(this.symbolLayer.pattern)};return null!==(r=this._fastUpdates)&&void 0!==r&&r.visualVariables?(0,N.Z)((0,N.Z)({},a),this._fastUpdates.materialParameters):a}},{key:"_materialColor",get:function(){var e;return null===(e=this.symbolLayer.material)||void 0===e?void 0:e.color}},{key:"_markerColor",get:function(){var e;return null===(e=this.symbolLayer.marker)||void 0===e?void 0:e.color}},{key:"_lineMaterial",get:function(){return null==this._materials[or.Line]&&(this._materials[or.Line]=new hr.U(this._getMaterialParameters(!1)),this._context.stage.add(this._materials[or.Line])),this._materials[or.Line]}},{key:"_ringMaterial",get:function(){return null==this._materials[or.Ring]&&(this._materials[or.Ring]=new hr.U(this._getMaterialParameters(!0)),this._context.stage.add(this._materials[or.Ring])),this._materials[or.Ring]}},{key:"_wireframeLineMaterial",get:function(){return null==this._materials[or.LineWireframe]&&(this._materials[or.LineWireframe]=new hr.U((0,N.Z)((0,N.Z)({},this._getMaterialParameters(!1)),{},{wireframe:!0})),this._context.stage.add(this._materials[or.LineWireframe])),this._materials[or.LineWireframe]}},{key:"_wireframeRingMaterial",get:function(){return null==this._materials[or.RingWireframe]&&(this._materials[or.RingWireframe]=new hr.U((0,N.Z)((0,N.Z)({},this._getMaterialParameters(!0)),{},{wireframe:!0})),this._context.stage.add(this._materials[or.RingWireframe])),this._materials[or.RingWireframe]}},{key:"_markerMaterial",get:function(){return null==this._materials[or.Marker]&&null!=this.symbolLayer.marker&&(this._materials[or.Marker]=new ur.X((0,N.Z)((0,N.Z)({},this._getMaterialParameters(!1,!0)),{},{placement:this.symbolLayer.marker.placement,markerPrimitive:ir(this.symbolLayer.marker.style)})),this._context.stage.add(this._materials[or.Marker])),this._materials[or.Marker]}},{key:"destroy",value:function(){var e=this;(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._forEachMaterial((function(t){return e._context.stage.remove(t)})),this._materials.length=0}},{key:"_getDrivenSize",value:function(e){return this._drivenProperties.size&&e.size?(0,pt.F2)((0,Q.o2)(e.size)):1}},{key:"_getDrivenColor",value:function(e){var t=(0,gt.al)(1,1,1,1);return this._drivenProperties.color&&e.color&&(t[0]=e.color[0],t[1]=e.color[1],t[2]=e.color[2],e.color.length>0&&(t[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(t[3]=e.opacity),t}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,dr,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,t.uid)}},{key:"applyRendererDiff",value:function(e,t){var r=this;for(var n in e.diff){if("visualVariables"!==n)return ie.W.RecreateSymbol;var i=function(){var e=r._fastUpdates;if(!(0,zt.Tc)(e,t,fr))return{v:ie.W.RecreateSymbol};r._forEachMaterial((function(t){return null===t||void 0===t?void 0:t.setParameters(e.materialParameters)}))}();if("object"===typeof i)return i.v}return ie.W.FastUpdate}},{key:"prepareSymbolLayerPatch",value:function(e){var t,r,n,i=this;if("partial"===e.diff.type){var a=e.diff.diff,o={};"complete"===(null===(t=a.size)||void 0===t?void 0:t.type)&&(o.width=this._computeMaterialWidth(a.size.newValue),delete a.size),"complete"===(null===(r=a.cap)||void 0===r?void 0:r.type)&&(o.cap=nr(null!==(n=a.cap.newValue)&&void 0!==n?n:"butt"),delete a.cap);var s=this._prepareMarkerPatch(e,a);this._prepareMaterialPatch(e,a,s),e.symbolLayerStatePatches.push((function(){return i._forEachMaterial((function(e){return null===e||void 0===e?void 0:e.setParameters(o)}))}))}}},{key:"layerOpacityChanged",value:function(){var e=this;this._forEachMaterial((function(t,r){return e._updateMaterialLayerOpacity(t,r===or.Marker)}))}},{key:"_forEachMaterial",value:function(e){this._materials.forEach(e)}},{key:"_updateMaterialLayerOpacity",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=e){var i=e.parameters.color,a=null===(t=this.symbolLayer)||void 0===t||null===(r=t.material)||void 0===r?void 0:r.color,o=this._patternHidesLine&&!n?0:this._getCombinedOpacity(a),s=(0,gt.al)(i[0],i[1],i[2],o);e.setParameters({color:s})}}},{key:"layerElevationInfoChanged",value:function(e,t,n){var i=this._elevationContext.mode,a=(0,te.GC)(r.elevationModeChangeTypes,n,i);if(a!==te.lO.UPDATE)return a;var o=(0,te.Xf)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){var e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial((function(t){return null===t||void 0===t?void 0:t.setParameters(e)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"_createAs3DShape",value:function(e,t,r){var n=pr(e.graphic.geometry),i="polygon"===n.type?n.rings:n.paths,a=new Array,o=(0,C.Ue)(),s=(0,lr.V)(n,this._context.elevationProvider,this._context.renderCoordsHelper,t),l="polygon"===n.type?"rings":"paths";this._logGeometryCreationWarnings(s,i,l,"LineSymbol3DLayer");for(var u=0;u<s.lines.length;u++){var c=s.lines[u],h=c.position,d=c.mapPositions;if(null==this._context.clippingExtent||((0,C.cS)(o),(0,C.G1)(o,d),(0,C.Zp)(o,this._context.clippingExtent))){var f=this._createGeometry("polygon"===n.type?this._ringMaterial:this._lineMaterial,e,h,d,n.type,ar.ELEVATED,r);a.push(f),ge.h.LINE_WIREFRAMES&&a.push(f.instantiate({material:"polygon"===n.type?this._wireframeRingMaterial:this._wireframeLineMaterial})),null!=this._markerMaterial&&a.push(f.instantiate({material:this._markerMaterial}))}}if(0===a.length)return null;var v=new Me.T({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),p=new M.z(this,v,a,null,null,kt.Lz,t);return p.alignedSampledElevation=s.sampledElevation,p.needsElevationUpdates=(0,te.Xf)(t.mode),p}},{key:"_createGeometry",value:function(e,t,r,n,i,a,o){var s,l,u,c=a===ar.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,h="polygon"===i,d=null===(s=this._fastUpdates)||void 0===s?void 0:s.visualVariables.color,f=null===(l=this._fastUpdates)||void 0===l?void 0:l.visualVariables.size,v=null===(u=this._fastUpdates)||void 0===u?void 0:u.visualVariables.opacity,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:o,layerUid:this._context.layer.uid}),m={position:r,size:f?null:this._getDrivenSize(t.renderingInfo),color:d?null:this._getDrivenColor(t.renderingInfo),sizeFeature:f?(0,zt.kD)(f.field,t.graphic):null,colorFeature:d?(0,zt.kD)(d.field,t.graphic):null,opacityFeature:v?(0,zt.kD)(v.field,t.graphic):null};return(0,sr.Y)(e,{overlayInfo:c,removeDuplicateStartEnd:h,mapPositions:n,attributeData:m},p)}},{key:"_createAsOverlay",value:function(e,t){var r=this,i=e.graphic,a=pr(i.geometry),o="polygon"===a.type?a.rings:a.paths,s="polygon"===a.type?this._ringMaterial:this._lineMaterial;s.renderPriority=this._renderPriority;var l=ge.h.LINE_WIREFRAMES?"polygon"===a.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,u=this._markerMaterial;null!=l&&(l.renderPriority=this._renderPriority-.001),null!=u&&(u.renderPriority=this._renderPriority-.002);var c=new Array,h=(0,C.Ue)(),d=(0,C.cS)(),f=(0,lr.r)(a,this._context.overlaySR),v="polygon"===a.type?"rings":"paths";this._logGeometryCreationWarnings(f,o,v,"LineSymbol3DLayer");var p,m=(0,n.Z)(f.lines);try{var y=function(){var n=p.value;if((0,C.cS)(h),(0,C.G1)(h,n.position),!(0,C.Zp)(h,r._context.clippingExtent))return"continue";(0,C.TC)(d,h);var o=function(o){var s=r._createGeometry(o,e,n.position,void 0,a.type,ar.DRAPED,i.uid),l=new Vt.z(s,{layerUid:t,graphicUid:i.uid});c.push(l)};if(null!=u){o(u);var f=r.symbolLayer.marker.placement;"begin"!==f&&"begin-end"!==f||(0,C.G1)(h,n.position,0,1),"end"!==f&&"begin-end"!==f||(0,C.G1)(h,n.position,n.position.length-3,1)}o(s),ge.h.LINE_WIREFRAMES&&o(l)};for(m.s();!(p=m.n()).done;)y()}catch(g){m.e(g)}finally{m.f()}return new Zt(this,c,d,this._context.drapeSourceRenderer)}},{key:"_patternHidesLine",get:function(){var e=this.symbolLayer.pattern;return null!=e&&"style"===e.type&&"none"===e.style}},{key:"_computeMaterialWidth",value:function(e){var t,r;return e=null!==(t=e)&&void 0!==t?t:(0,pt.Wz)(1),this._drivenProperties.size?null!==(r=this._fastUpdates)&&void 0!==r&&r.visualVariables.size?(0,pt.F2)(1):1:(0,pt.F2)(e)}},{key:"_prepareMaterialPatch",value:function(e,t,r){var n,i,a=t.material;if(null!=a){if("collection"!==a.type){var o="complete"===a.type?null===(n=a.newValue)||void 0===n?void 0:n.color:"complete"===(null===(i=a.diff.color)||void 0===i?void 0:i.type)?a.diff.color.newValue:null,s=this._getCombinedOpacityAndColor(o);r.useMaterialColor&&mr((0,gt.d9)(s),this._materials[or.Marker],e),this._patternHidesLine&&(s[3]=0),mr(s,this._materials[or.Line],e),delete t.material}}else r.changed&&r.useMaterialColor&&mr(this._getCombinedOpacityAndColor(this._materialColor),this._materials[or.Marker],e)}},{key:"_prepareMarkerPatch",value:function(e,t){var r,n=t.marker,i=this._markerMaterial;if(null==n||"partial"!==n.type||null==n.diff||null!=n.diff.placement||null!=n.diff.style&&"complete"!==n.diff.style.type||null!=n.diff.color&&"complete"!==n.diff.color.type||null==i)return{changed:!1,useMaterialColor:null==this._markerColor};var a=n.diff.color,o=null!=a,s=o?a.newValue:null,l=null==s&&null==this._markerColor;s&&mr(this._getCombinedOpacityAndColor(s),i,e);var u=null===(r=n.diff.style)||void 0===r?void 0:r.newValue;return u&&e.symbolLayerStatePatches.push((function(){return i.setParameters({markerPrimitive:ir(u)})})),delete t.marker,{changed:o,useMaterialColor:l}}}]),r}(re.k);function pr(e){switch(e.type){case"extent":if(e instanceof he.Z)return w.Z.fromExtent(e);break;case"polygon":case"polyline":return e}return null}function mr(e,t,r){null!=t&&r.symbolLayerStatePatches.push((function(){return t.setParameters({color:e})}))}vr.elevationModeChangeTypes={definedChanged:te.lO.RECREATE,staysOnTheGround:te.lO.NONE,onTheGroundChanged:te.lO.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(ar||(ar={})),function(e){e[e.Line=0]="Line",e[e.Ring=1]="Ring",e[e.LineWireframe=2]="LineWireframe",e[e.RingWireframe=3]="RingWireframe",e[e.Marker=4]="Marker"}(or||(or={}));var yr=r(16889),gr=r(79803),_r=r(5629),br=r(38461),xr=r(64995),Sr=r(11587),Tr=r(50565),wr=r(69048),Pr=r(11700),Cr=r(55946),Or=r(67331),Rr=r(57661),Er=r(99760),kr=2e3,Ar=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).fastTransformUpdatesAllowed=!1,e._originalGeometries=[],e._fastTransformUpdatesEnabled=!1,e._autoDisableFastUpdatesTimeoutId=0,e}return(0,l.Z)(r,[{key:"fastTransformUpdatesEnabled",get:function(){return this._fastTransformUpdatesEnabled}},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._cancelAutoDisableFastUpdates()}},{key:"enableFastTransformUpdates",value:function(e,t){if(this.fastTransformUpdatesAllowed&&!this._fastTransformUpdatesEnabled){this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!0;var r=this.stageObject,i=r.geometries.slice();r.removeAllGeometries();var a,o=(0,W.i0)(Zr,r.transformation),s=t.getOrigin(o),l=(0,n.Z)(i);try{for(l.s();!(a=l.n()).done;){var u=a.value,c=e(u.material),h=u.instantiate({material:c});h.localOrigin=s,r.addGeometry(h)}}catch(d){l.e(d)}finally{l.f()}this._originalGeometries=i}}},{key:"autoDisableFastTransformUpdates",value:function(e){var t=this;this._cancelAutoDisableFastUpdates(),this._autoDisableFastUpdatesTimeoutId=setTimeout((function(){t._autoDisableFastUpdatesTimeoutId=0,e()}),kr)}},{key:"updateAutoDisableFastTransformUpdates",value:function(e){this._autoDisableFastUpdatesTimeoutId&&this.autoDisableFastTransformUpdates(e)}},{key:"_cancelAutoDisableFastUpdates",value:function(){clearTimeout(this._autoDisableFastUpdatesTimeoutId),this._autoDisableFastUpdatesTimeoutId=0}},{key:"disableFastTransformUpdates",value:function(e){if(this._fastTransformUpdatesEnabled){this._cancelAutoDisableFastUpdates(),this._fastTransformUpdatesEnabled=!1;var t=this.stageObject,r=t.geometries.map((function(t){return e(t.material)}));t.removeAllGeometries();for(var n=0;n<this._originalGeometries.length;n++){var i=this._originalGeometries[n],a=r[n];a.setParameters({modelTransformation:null}),a===i.material?t.addGeometry(i):t.addGeometry(i.instantiate({material:a}))}this._originalGeometries.length=0}}},{key:"updateFastLocalOrigin",value:function(e,t,r){var n;if(this._fastTransformUpdatesEnabled){var i=this.stageObject;if(0!==i.geometries.length){var a=i.geometries[0].localOrigin,o=(0,W.i0)(Zr,e),s=r.getOrigin(o);if(s!==a){var l=null!==(n=null===t||void 0===t?void 0:t.localMatrix)&&void 0!==n?n:q.Wd;i.shaderTransformation=null,i.transformation=e,i.geometries.forEach((function(e){e.transformation=l,e.localOrigin=s}))}}}}},{key:"updateTransform",value:function(e,t,r){var n,i=this.stageObject,a=null!==(n=null===t||void 0===t?void 0:t.localMatrix)&&void 0!==n?n:q.Wd;if(!this._fastTransformUpdatesEnabled)return i.shaderTransformation=null,i.transformation=e,i.geometries.forEach((function(e){return e.transformation=a})),void this._updateEdgeTransform(r);var o=i.transformation,s=i.geometries[0].transformation,l=e,u=a,c=(0,W.Jp)(Lr,o,s),h=(0,W.Jp)(Ir,l,u),d=(0,W.Jp)(Mr,h,(0,W.U_)(Mr,s));i.shaderTransformation=d,this._setFastMaterialTransformation({matA:c,matB:h}),this._updateEdgeTransform(r)}},{key:"alignWithElevation",value:function(e,t,n,i){var a=this;if(this._fastTransformUpdatesEnabled){null!=n&&(0,Z.aO)(this.elevationContext.featureExpressionInfoContext,n);var o=this.stageObject;if(o.geometries[0].material.parameters.modelTransformation){var s=o.transformation,l=o.geometries[0].transformation,h=(0,W.Jp)(Lr,s,l),d=o.effectiveTransformation,f=(0,W.JG)(Ur,d);this.alignedSampledElevation=(0,kt.j3)(this,this.elevationContext,e.spatialReference,(function(r,n){return(0,te.qZ)(r,e,a.elevationContext,t,n)}),t,f),o.shaderTransformation=f;var v=o.geometries[0].transformation,p=(0,W.Jp)(Ir,f,v);this._setFastMaterialTransformation({matA:h,matB:p}),this._updateEdgeTransform(i)}}else(0,u.Z)((0,c.Z)(r.prototype),"alignWithElevation",this).call(this,e,t,n,i)}},{key:"_setFastMaterialTransformation",value:function(e){var t=e.matA,r=e.matB,i=this.stageObject;if(0!==i.geometries.length){var a,o=i.geometries[0].localOrigin,s=(0,W.vc)(Nr,(0,S.j)(Zr,o.vec3,-1)),l=(0,W.Jp)(Dr,s,t),u=(0,W.Jp)(zr,s,r),c=(0,W.U_)(Dr,l),h=(0,W.Jp)(zr,u,c),d=(0,n.Z)(i.geometries);try{for(d.s();!(a=d.n()).done;){a.value.material.setParameters({modelTransformation:h})}}catch(f){d.e(f)}finally{d.f()}}}},{key:"_updateEdgeTransform",value:function(e){var t=this,r=this.stageObject;this._stageLayer.stage.renderer.withEdgeView((function(n){n.fastUpdateObject3DEdgesTransform(r)||t.resetEdgeObject(e)}))}}]),r}(M.z),Zr=(0,T.Ue)(),Lr=(0,q.Ue)(),Ir=(0,q.Ue)(),Ur=(0,q.Ue)(),Mr=(0,q.Ue)(),Dr=(0,q.Ue)(),zr=(0,q.Ue)(),Nr=(0,q.Ue)(),Fr=function(){function e(){(0,s.Z)(this,e),this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}return(0,l.Z)(e,[{key:"enable",value:function(e,t,r){var n=this;e.enableFastTransformUpdates((function(e){if(n._graphicReferenceCount<=1){if(n._fastTransformOriginalMaterials.has(e))return e;var i=t.byMaterial(e);return n._fastTransformOriginalMaterials.set(e,i),t.delete(e),e}var a=new De.Gp(e.parameters);return r.stage.add(a),n._fastTransformClonedMaterials.set(a,e),a}),r.localOriginFactory)}},{key:"disable",value:function(e,t,r){var i=this,a=new Set,o=new Set;e.disableFastTransformUpdates((function(e){if(!i._fastTransformClonedMaterials.has(e)){var n=e,s=i._fastTransformOriginalMaterials.get(n);return t.has(s.uid)?(a.add(n),t.byUid(s.uid).material):(o.add(n),s.material)}var l=e,u=i._fastTransformClonedMaterials.get(l);return i._fastTransformClonedMaterials.delete(l),r.stage.remove(l),u}));var s,l=(0,n.Z)(a);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._fastTransformOriginalMaterials.delete(u),r.stage.remove(u)}}catch(v){l.e(v)}finally{l.f()}var c,h=(0,n.Z)(o);try{for(h.s();!(c=h.n()).done;){var d=c.value,f=this._fastTransformOriginalMaterials.get(d);this._fastTransformOriginalMaterials.delete(d),t.set(f.uid,f)}}catch(v){h.e(v)}finally{h.f()}}},{key:"onAddGraphic",value:function(){this._graphicReferenceCount++}},{key:"onRemoveGraphic",value:function(e,t,r){this._graphicReferenceCount--,this.disable(e,t,r)}},{key:"forEachMaterialInfo",value:function(e){this._fastTransformOriginalMaterials.forEach(e)}},{key:"forEachClonedMaterial",value:function(e){this._fastTransformClonedMaterials.forEach(e)}},{key:"destroy",value:function(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),(function(e){return e.material}))),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}}]),e}(),Vr=function(){function e(){(0,s.Z)(this,e),this._byUid=new Map,this._byMaterial=new Map}return(0,l.Z)(e,[{key:"materials",get:function(){return Array.from(this._byUid.values(),(function(e){return e.material}))}},{key:"byUid",value:function(e){return this._byUid.get(e)}},{key:"byMaterial",value:function(e){return this._byMaterial.get(e)}},{key:"set",value:function(e,t){this._byUid.set(e,t),this._byMaterial.set(t.material,t)}},{key:"delete",value:function(e){var t,r=null===(t=this._byMaterial.get(e))||void 0===t?void 0:t.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}},{key:"has",value:function(e){return this._byUid.has(e)}},{key:"forEachMaterialInfo",value:function(e){this._byUid.forEach(e)}},{key:"clear",value:function(){this._byUid.clear(),this._byMaterial.clear()}}]),e}(),Hr=r(49420),Gr=r(95773),Br=r(85981),jr=r(55652),Wr=r(37081),qr=r(23620),Jr=r(56529),Yr=r(93822),Xr=r(97731),Kr=r(12594),$r=r(64642),Qr=r(82144),en=r(31132),tn=r(7566),rn=r(27627),nn=r(50411),an=r(99337),on=r(8548),sn=r(36207),ln=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"initializeProgram",value:function(e){return new rn.$(e.rctx,r.shader.get().build(this.configuration),tn.i)}},{key:"initializePipeline",value:function(){var e=this.configuration,t=(0,sn.wK)(on.zi.SRC_ALPHA,on.zi.ONE,on.zi.ONE_MINUS_SRC_ALPHA,on.zi.ONE_MINUS_SRC_ALPHA),r=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,sn.sm)({blending:r,depthTest:nn.JN,depthWrite:n,colorWrite:sn.BK,stencilWrite:e.hasOccludees?nn.s3:null,stencilTest:e.hasOccludees?t?nn.eD:nn.RY:null})};return e.output===Wr.H_.Color?(this._occludeePipelineState=r(!0,e.transparent?t:null,sn.LZ),r(!1,e.transparent?t:null,sn.LZ)):r(!1)}},{key:"primitiveType",get:function(){return on.MX.LINES}},{key:"getPipeline",value:function(e){return e?this._occludeePipelineState:(0,u.Z)((0,c.Z)(r.prototype),"getPipeline",this).call(this)}}]),r}(en.A);ln.shader=new Qr.J(an.N,(function(){return r.e(78569).then(r.bind(r,78569))}));var un=r(27366),cn=r(33559),hn=r(8883),dn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).output=Wr.H_.Color,e.hasSlicePlane=!1,e.hasVertexColors=!1,e.transparent=!1,e.hasOccludees=!1,e}return(0,l.Z)(r)}(hn.W);(0,un._)([(0,cn.o)({count:Wr.H_.COUNT})],dn.prototype,"output",void 0),(0,un._)([(0,cn.o)()],dn.prototype,"hasSlicePlane",void 0),(0,un._)([(0,cn.o)()],dn.prototype,"hasVertexColors",void 0),(0,un._)([(0,cn.o)()],dn.prototype,"transparent",void 0),(0,un._)([(0,cn.o)()],dn.prototype,"hasOccludees",void 0);var fn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e,new pn))._configuration=new dn,n.produces=new Map([[Yr.r.OPAQUE_MATERIAL,function(e){return e===Wr.H_.Color||e===Wr.H_.Highlight||e===Wr.H_.ObjectAndLayerIdColor}]]),n}return(0,l.Z)(r,[{key:"getConfiguration",value:function(e){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration}},{key:"intersect",value:function(e,t,r,n,i,a){if(r.options.selectionMode&&e.visible)if((0,Xr.kG)(t)){var o=e.attributes.get(ce.T.POSITION).data,s=r.camera,l=Cn;(0,b.JG)(l,r.point);(0,S.s)(On[0],l[0]-2,l[1]+2,0),(0,S.s)(On[1],l[0]+2,l[1]+2,0),(0,S.s)(On[2],l[0]+2,l[1]-2,0),(0,S.s)(On[3],l[0]-2,l[1]-2,0);for(var u=0;u<4;u++)if(!s.unprojectFromRenderScreen(On[u],Rn[u]))return;(0,jr.zk)(s.eye,Rn[0],Rn[1],En),(0,jr.zk)(s.eye,Rn[1],Rn[2],kn),(0,jr.zk)(s.eye,Rn[2],Rn[3],An),(0,jr.zk)(s.eye,Rn[3],Rn[0],Zn);for(var c=Number.MAX_VALUE,h=0,d=0;d<o.length-5;d+=3)if(mn[0]=o[d]+t[12],mn[1]=o[d+1]+t[13],mn[2]=o[d+2]+t[14],yn[0]=o[d+3]+t[12],yn[1]=o[d+4]+t[13],yn[2]=o[d+5]+t[14],!((0,jr.jH)(En,mn)<0&&(0,jr.jH)(En,yn)<0||(0,jr.jH)(kn,mn)<0&&(0,jr.jH)(kn,yn)<0||(0,jr.jH)(An,mn)<0&&(0,jr.jH)(An,yn)<0||(0,jr.jH)(Zn,mn)<0&&(0,jr.jH)(Zn,yn)<0)){if(s.projectToRenderScreen(mn,bn),s.projectToRenderScreen(yn,xn),bn[2]<0&&xn[2]>0){(0,S.f)(gn,mn,yn);var f=s.frustum,v=-(0,jr.jH)(f[Gr.Nu.NEAR],mn)/(0,S.m)(gn,(0,jr.st)(f[Gr.Nu.NEAR]));(0,S.j)(gn,gn,v),(0,S.g)(mn,mn,gn),s.projectToRenderScreen(mn,bn)}else if(bn[2]>0&&xn[2]<0){(0,S.f)(gn,yn,mn);var p=s.frustum,m=-(0,jr.jH)(p[Gr.Nu.NEAR],yn)/(0,S.m)(gn,(0,jr.st)(p[Gr.Nu.NEAR]));(0,S.j)(gn,gn,m),(0,S.g)(yn,yn,gn),s.projectToRenderScreen(yn,xn)}else if(bn[2]<0&&xn[2]<0)continue;bn[2]=0,xn[2]=0;var y=(0,Br.Jk)((0,Br.zk)(bn,xn,wn),l);y<c&&(c=y,(0,S.c)(Sn,mn),(0,S.c)(Tn,yn),h=d/3)}var g=r.rayBegin,_=r.rayEnd;if(c<4){var x=Number.MAX_VALUE;if((0,Br.AR)((0,Br.zk)(Sn,Tn,wn),(0,Br.zk)(g,_,Pn),_n)){(0,S.f)(_n,_n,g);var T=(0,S.l)(_n);(0,S.j)(_n,_n,1/T),x=T/(0,S.p)(g,_)}a(x,_n,h,!1)}}else z.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")}},{key:"intersectDraped",value:function(e,t,r,n,i,a){if(r.options.selectionMode){for(var o=e.attributes.get(ce.T.POSITION).data,s=e.attributes.get(ce.T.SIZE),l=s?s.data[0]:0,u=n[0],c=n[1],h=((l+1)/2+4)*e.screenToWorldRatio,d=Number.MAX_VALUE,f=0,v=0;v<o.length-5;v+=3){var p=o[v],m=o[v+1],y=u-p,g=c-m,_=o[v+3]-p,b=o[v+4]-m,x=(0,yr.uZ)((_*y+b*g)/(_*_+b*b),0,1),S=_*x-y,T=b*x-g,w=S*S+T*T;w<d&&(d=w,f=v/3)}d<h*h&&i(a.dist,a.normal,f,!1)}}},{key:"createGLMaterial",value:function(e){return new vn(e)}},{key:"createBufferWriter",value:function(){var e=this.parameters.hasVertexColors?$r.IM:$r.wp;return new Kr.G(e)}}]),r}(Jr.F5),vn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output===Wr.H_.Color&&this._updateOccludeeState(e),this.ensureTechnique(ln,e)}}]),r}(qr.Z),pn=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).color=gt.hq,e.hasVertexColors=!1,e.hasSlicePlane=!1,e.width=1,e.hasOccludees=!1,e}return(0,l.Z)(r)}(Jr.Mt),mn=(0,T.Ue)(),yn=(0,T.Ue)(),gn=(0,T.Ue)(),_n=(0,T.Ue)(),bn=(0,pt.J$)(),xn=(0,pt.J$)(),Sn=(0,T.Ue)(),Tn=(0,T.Ue)(),wn=(0,Br.Ue)(),Pn=(0,Br.Ue)(),Cn=(0,T.Ue)(),On=[(0,pt.J$)(),(0,pt.J$)(),(0,pt.J$)(),(0,pt.J$)()],Rn=[(0,T.Ue)(),(0,T.Ue)(),(0,T.Ue)(),(0,T.Ue)()],En=(0,jr.Ue)(),kn=(0,jr.Ue)(),An=(0,jr.Ue)(),Zn=(0,jr.Ue)(),Ln=r(45856),In=["mesh"],Un=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,i,a))._materialInfoCache=new Vr,o._fastUpdateProcessor=new Fr,o._textures=new Map,o.ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ge.h.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new fn({color:[1,0,1,1]}),this._debugTangentNormalMaterial=new fn({color:[1,.5,0,1]}),this._debugFaceNormalMaterial=new fn({color:[0,1,1,1]}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._textures.forEach((function(e){return e.unload()})),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}},{key:"materials",get:function(){return this._materialInfoCache.materials}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,In,"fill on mesh-3d"))return null;var r=this.setGraphicElevationContext(t),n=e.renderingInfo;return this._createAs3DShape(t,n,r,t.uid)}},{key:"onRemoveGraphic",value:function(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}},{key:"layerOpacityChanged",value:function(e,t){var r=this,n=this._getLayerOpacity();this._updateMaterialParameters((function(e){e.material.setParameters({layerOpacity:n});var t=e.material.parameters;r._setMaterialTransparentParameter(t,e),e.material.setParameters({transparent:t.transparent})})),e.forEach((function(e){var i;return null===(i=t(e))||void 0===i?void 0:i.layerOpacityChanged(n,r._context.isAsync)}))}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,te.B5)}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return this._updateMaterialParameters((function(e){e.material.setParameters({hasSlicePlane:r._context.slicePlaneEnabled})})),e.forEach((function(e){var n;return null===(n=t(e))||void 0===n?void 0:n.slicePlaneEnabledChanged(r._context.slicePlaneEnabled,r._context.isAsync)})),!0}},{key:"physicalBasedRenderingChanged",value:function(){var e=this._usePBR();return this._updateMaterialParameters((function(t){return t.material.setParameters({usePBR:e})})),!0}},{key:"updateTransform",value:function(e,t,r,n){var i,a=this;if(!e.fastTransformUpdatesAllowed)return!1;var o=e.fastTransformUpdatesEnabled;switch(n){case Or.u.EnableFastUpdates:if(o)return!0;break;case Or.u.DisableFastUpdates:if(!o)return!0;break;default:if(!o)return!!this.updateTransform(e,t,r,Or.u.EnableFastUpdates)&&(e.autoDisableFastTransformUpdates((function(){return a.updateTransform(e,t,r,Or.u.DisableFastUpdates)})),!0)}var s=this._context.renderCoordsHelper.spatialReference,l=ti,u=r.origin,c=r.transform;if(!(0,J.B)(t,(0,S.s)(Xn,u.x,u.y,null!==(i=u.z)&&void 0!==i?i:0),l,s))return!1;switch(n){case Or.u.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case Or.u.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case Or.u.UpdateFastLocalOrigin:e.updateFastLocalOrigin(l,c,this._context.localOriginFactory)}var h=e.elevationContext;h.centerPointInElevationSR=this._getCenterPointInElevationSR(l);var d=this._context,f=d.elevationProvider,v=d.renderCoordsHelper;return e.alignedSampledElevation=(0,kt.j3)(e,h,f.spatialReference,(function(e,t){return(0,te.qZ)(e,f,h,v,t)}),v,l),e.updateTransform(l,c,this._context.isAsync),e.updateAutoDisableFastTransformUpdates((function(){return a.updateTransform(e,t,r,Or.u.DisableFastUpdates)})),!0}},{key:"_requiresSymbolVertexColors",value:function(){return this._drivenProperties.color||this._drivenProperties.opacity}},{key:"_materialPropertiesDefault",value:function(e,t){var r=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,i=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:n,hasVertexTangents:i,uid:"vc:".concat(n,",vt:").concat(i,",vct").concat(t,",svc:").concat(r)}}},{key:"_materialProperties",value:function(e,t,r){var n=this._materialPropertiesDefault(e,r);if(!t.material)return n;var i=t.material,a=i.color,o=i.colorTexture,s=i.colorTextureTransform,l=i.normalTexture,u=i.normalTextureTransform,c=i.doubleSided,h=i.alphaCutoff,d=i.alphaMode,f=jn(a),v=jn(o),p=Wn(s),m=jn(l),y=Wn(u);if(n.color=a,n.colorTexture=o,n.normalTexture=l,n.uid="".concat(n.uid,",cmuid:").concat(f,",ctmuid:").concat(v,",cttuid:").concat(p,",ntmuid:").concat(m,",nttuid:").concat(y,",ds:").concat(c,",ac:").concat(h,",am:").concat(d),t.material instanceof Sr.Z){var g=t.material,_=g.metallic,b=g.roughness,x=g.metallicRoughnessTexture,S=g.metallicRoughnessTextureTransform,T=g.emissiveColor,w=g.emissiveTexture,P=g.emissiveTextureTransform,C=g.occlusionTexture,O=g.occlusionTextureTransform,R=jn(x),E=Wn(S),k=jn(T),A=jn(w),Z=Wn(P),L=jn(C),I=Wn(O);n.metallic=_,n.roughness=b,n.metallicRoughnessTexture=x,n.emissiveColor=T,n.emissiveTexture=w,n.occlusionTexture=C,n.colorTextureTransform=Hn(s),n.normalTextureTransform=Hn(u),n.emissiveTextureTransform=Hn(P),n.occlusionTextureTransform=Hn(O),n.metallicRoughnessTextureTransform=Hn(S),n.uid="".concat(n.uid,",mrm:").concat(_,",mrr:").concat(b,",mrt:").concat(R,",mrtt:").concat(E,",emuid:").concat(k,",etmuid:").concat(A,",ett:").concat(Z,",otmuid:").concat(L,",ott:").concat(I)}return n}},{key:"_getInternalTextureId",value:function(e){var t=this._getInternalTexture(e,Le.JJ.Opaque);return null===t||void 0===t?void 0:t.id}},{key:"_getInternalTexture",value:function(e,t){var r=function(e){var t;return null!==(t=e.data)&&void 0!==t?t:e.url}(e);if(!r)return null;var n="".concat(e.contentHash,"/").concat(t),i=this._textures.get(n);if(!i){var a=null,o=this._context.stage.renderView.renderingContext.parameters.maxMaxAnisotropy,s={wrap:Gn(e.wrap),noUnpackFlip:!0,maxAnisotropy:o,mipmap:o>1};(0,Rr.$A)(r)?(a=r.data,s.preMultiplyAlpha=!1,s.encoding=r.encoding):(a=r,s.preMultiplyAlpha=t!==Le.JJ.Opaque,s.downsampleUncompressed=this._context.graphicsCoreOwner.view.qualitySettings.graphics3D.uncompressedTextureDownsamplingEnabled),i=new Ht.x(a,s),this._textures.set(n,i),i.load(this._context.stage.renderView.renderingContext),this._context.stage.add(i)}return i}},{key:"_setInternalMaterialParameters",value:function(e,t){var r,n;if(null!=e.color&&function(e,t){t.diffuse=ft.Z.toUnitRGB(e),t.opacity=e.a}(e.color,t),null!=e.colorTexture){var i=this._getInternalTexture(e.colorTexture,t.textureAlphaMode);i?(t.textureId=i.id,t.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):t.textureId=void 0}e.normalTexture&&(t.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor&&(t.emissiveFactor=ft.Z.toUnitRGB(e.emissiveColor)),e.emissiveTexture&&(t.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture&&(t.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture&&(t.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),t.colorTextureTransformMatrix=(0,Er.i)(e.colorTextureTransform),t.normalTextureTransformMatrix=(0,Er.i)(e.normalTextureTransform);var a=null!=(null===(r=e.normalTextureTransform)||void 0===r?void 0:r.scale)?null===(n=e.normalTextureTransform)||void 0===n?void 0:n.scale:x.hq;t.scale=[a[0],a[1]],t.occlusionTextureTransformMatrix=(0,Er.i)(e.occlusionTextureTransform),t.emissiveTextureTransformMatrix=(0,Er.i)(e.emissiveTextureTransform),t.metallicRoughnessTextureTransformMatrix=(0,Er.i)(e.metallicRoughnessTextureTransform)}},{key:"_setExternalMaterialParameters",value:function(e){var t,r,n=this._drivenProperties.color,i=null!==(t=null===(r=this.symbolLayer.material)||void 0===r?void 0:r.colorMixMode)&&void 0!==t?t:null;if(n)e.externalColor=gt.hq;else{var a,o,s=null!==(a=null===(o=this.symbolLayer.material)||void 0===o?void 0:o.color)&&void 0!==a?a:null;s?e.externalColor=ft.Z.toUnitRGBA(s):(i=null,e.externalColor=gt.hq)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}},{key:"_getOrCreateMaterial",value:function(e,t){var r,n,a,o=null===(r=t.material)||void 0===r?void 0:r.color,s=null===(n=t.material)||void 0===n?void 0:n.colorTexture,l=null===(a=t.material)||void 0===a?void 0:a.alphaMode,u="blend"===l,c=!("opaque"===l)&&(function(e){var t=e.vertexAttributes.color;if(null==t)return!1;for(var r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1}(e)||null!=o&&o.a<1||(null===s||void 0===s?void 0:s.transparent)||u),h=this._materialProperties(e,t,c),d=this._materialInfoCache.byUid(h.uid);if(d)return d.material;var f={uid:h.uid,material:null,isComponentTransparent:c,alphaMode:t.material?t.material.alphaMode:"opaque"},v=(0,Ln.Ih)({normalTexture:h.normalTexture,metallicRoughnessTexture:h.metallicRoughnessTexture,metallicFactor:h.metallic,roughnessFactor:h.roughness,emissiveTexture:h.emissiveTexture,emissiveFactor:ft.Z.toUnitRGB(h.emissiveColor),occlusionTexture:h.occlusionTexture}),p={usePBR:this._usePBR(),isSchematic:v,hasVertexColors:h.hasVertexColors,hasSymbolColors:h.hasSymbolVertexColors,hasVertexTangents:h.hasVertexTangents,ambient:T.AG,diffuse:T.hq,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Le.Vr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p.mrrFactors=v?(0,i.Z)(Ln.yI):[h.metallic,h.roughness,Ln.ml[2]],t.material&&(p.doubleSided=t.material.doubleSided,p.cullFace=t.material.doubleSided?Le.Vr.None:Le.Vr.Back,p.textureAlphaCutoff=t.material.alphaCutoff),this._setExternalMaterialParameters(p),this._setMaterialTransparentParameter(p,f),this._setInternalMaterialParameters(h,p);var m=new De.Gp(p);return f.material=m,this._materialInfoCache.set(h.uid,f),this._context.stage.add(m),m}},{key:"_usePBR",value:function(){return this._context.physicalBasedRenderingEnabled}},{key:"_setMaterialTransparentParameter",value:function(e,t){e.transparent=this.needsDrivenTransparentPass||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?Le.JJ.MaskBlend:Le.JJ.Opaque:e.textureAlphaMode="opaque"===t.alphaMode?Le.JJ.Opaque:"mask"===t.alphaMode?Le.JJ.Mask:Le.JJ.Blend}},{key:"_createFaceDebugNormals",value:function(e,t){for(var r=t.length,n=e.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],s=[],l=t[0].transformation,u=(0,B.XL)((0,j.Ue)(),l),c=0;c<r;c++){var h=t[c].attributes.get(ce.T.POSITION);if(h)for(var d=h.data,f=h.indices,v=0;v<f.length;v+=3)Vn(d,f,v,Qn),Fn(d,f,v,Xn,Kn,$n),(0,S.g)(Xn,Xn,Kn),(0,S.g)(Xn,Xn,$n),(0,S.j)(Xn,Xn,1/3),(0,S.h)(Xn,Xn,l),o.push.apply(o,(0,i.Z)(Xn)),(0,S.t)(Qn,Qn,u),(0,S.n)(Qn,Qn),(0,S.r)(Xn,Xn,Qn,a),o.push.apply(o,(0,i.Z)(Xn)),s.push(s.length),s.push(s.length)}return o.length?new ue.Z(this._debugFaceNormalMaterial,[[ce.T.POSITION,new se.a(o,s,3,!0)]],null,le.U.Line):null}},{key:"_createPerVertexDebugVectors",value:function(e,t,r,n,a){var o=t.length,s=e.spatialReference.isGeographic?20015077/180:1,l=.1*a*Math.max(e.extent.width*s,e.extent.height*s,e.extent.zmax-e.extent.zmin),u=[],c=[],h=t[0].transformation,d=(0,B.XL)((0,j.Ue)(),h);r===ce.T.TANGENT&&(0,B.xO)(d,h);for(var f=0;f<o;f++){var v=t[f],p=v.attributes.get(ce.T.POSITION),m=v.attributes.get(r);if(p&&m)for(var y=p.data,g=p.indices,_=m.data,b=m.indices,x=0;x<g.length;x++){var T=3*g[x],w=b[x]*m.stride;(0,S.s)(Xn,y[T+0],y[T+1],y[T+2]),(0,S.h)(Xn,Xn,h),u.push.apply(u,(0,i.Z)(Xn)),(0,S.s)(Kn,_[w+0],_[w+1],_[w+2]),(0,S.t)(Kn,Kn,d),(0,S.n)(Kn,Kn),(0,S.r)(Xn,Xn,Kn,l),u.push.apply(u,(0,i.Z)(Xn)),c.push(c.length),c.push(c.length)}}return u.length?new ue.Z(n,[[ce.T.POSITION,new se.a(u,c,3,!0)]],null,le.U.Line):null}},{key:"_createAs3DShape",value:function(e,t,r,n){var i=e.geometry;if("mesh"!==i.type)return null;var a=this._createGeometryInfo(i,t,n);if(null==a)return null;var o=a.geometries,s=a.objectTransformation;if(ge.h.DRAW_MESH_GEOMETRY_NORMALS){var l=this._createPerVertexDebugVectors(i,o,ce.T.NORMAL,this._debugVertexNormalMaterial,1),u=this._createPerVertexDebugVectors(i,o,ce.T.TANGENT,this._debugTangentNormalMaterial,.5),c=this._createFaceDebugNormals(i,o);l&&o.push(l),u&&o.push(u),c&&o.push(c)}var h=new Me.T({geometries:o,layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0});h.transformation=s;var d=(0,ye.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),f=d?new M.n(o[0].material,[d],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,v=new Ar(this,h,o,null,null,kt.j3,r,f);this._fastUpdateProcessor.onAddGraphic(),v.needsElevationUpdates=(0,te.B5)(r.mode),v.useObjectOriginAsAttachmentOrigin=!0,v.fastTransformUpdatesAllowed=this._fastTransformUpdatesAllowed(i),r.centerPointInElevationSR=this._getCenterPointInElevationSR(h.transformation);var p=this._context,m=p.elevationProvider,y=p.renderCoordsHelper;return v.alignedSampledElevation=(0,kt.j3)(v,r,m.spatialReference,(function(e,t){return(0,te.qZ)(e,m,r,y,t)}),y),v}},{key:"_fastTransformUpdatesAllowed",value:function(e){var t=e.vertexSpace,r=e.spatialReference;if(!(0,wr.zZ)(t))return!1;var n=t.type,i=this._context.graphicsCoreOwner.view,a=i.state.viewingMode,o=i.spatialReference;return a===ee.JY.Global&&"local"===n||a===ee.JY.Local&&(0,R.fS)(o,r)&&"georeferenced"===n&&!r.isGeographic}},{key:"_getCenterPointInElevationSR",value:function(e){var t=(0,Cr.T)(0,0,0,null!=this._context.elevationProvider.spatialReference?this._context.elevationProvider.spatialReference:null);return(0,_r.f)([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,t),t}},{key:"_passthroughReprojectionInfo",value:function(e){return e.reprojection===qn.NONE&&!!e.objectTransformation}},{key:"_createPositionBuffer",value:function(e,t){var r=e.vertexAttributes.position,n=r,i=null;if(t.reprojection===qn.NONE)return{position:n,georeferencedPositionBuffer:i};var a=t.reprojection===qn.RENDER?t.transformBeforeProject:null;a&&(n=(0,K.a)(new Float64Array(n.length),n,a));var o=e.vertexAttributes,s=o.normal,l=o.tangent;this._passthroughReprojectionInfo(t)||!s&&!l||(i=n);var u=n===r||n===i?new Float64Array(n.length):n;return(0,be.projectBuffer)(n,e.spatialReference,0,u,this._context.renderCoordsHelper.spatialReference,0,n.length/3),{position:u,georeferencedPositionBuffer:i}}},{key:"_createNormalBuffer",value:function(e,t,r,n){var i=e.vertexAttributes.normal;if(null==i)return null;var a=i,o=n.reprojection===qn.RENDER?n.transformBeforeProject:null;o&&(a=(0,Pr.transformNormal)(a,new Float32Array(a.length),o));var s=this._context.graphicsCoreOwner.view.viewingMode;if(n.reprojection===qn.NONE)return a;if("local"===s){if(!(0,R.QM)(this._context.renderCoordsHelper.spatialReference))return a;if(null==r)return null;if(e.spatialReference.isGeographic){var l=a===i?new Float32Array(a.length):a;return(0,Pr.transformVectorENUPlateCarree)(a,Pr.VectorType.NORMAL,r,l)}if(e.spatialReference.isWebMercator){var u=a===i?new Float32Array(a.length):a;return(0,Pr.transformVectorWMPlateCarree)(a,Pr.VectorType.NORMAL,r,u)}return a}if(null==r)return null;var c=a===i?new Float32Array(a.length):a;return(0,Pr.projectNormalToPCPF)(a,r,t,e.spatialReference,c)}},{key:"_createTangentBuffer",value:function(e,t,r,n){var i=e.vertexAttributes.tangent;if(null==i)return null;var a=i,o=n.reprojection===qn.RENDER?n.transformBeforeProject:null;o&&(a=(0,Pr.transformTangent)(a,new Float32Array(a.length),o));var s=this._context.graphicsCoreOwner.view.viewingMode;if(n.reprojection===qn.NONE)return a;if("local"===s){if(!(0,R.QM)(this._context.renderCoordsHelper.spatialReference))return a;if(null==r)return null;if(e.spatialReference.isGeographic){var l=a===i?new Float32Array(a.length):a;return(0,Pr.transformVectorENUPlateCarree)(a,Pr.VectorType.TANGENT,r,l)}if(e.spatialReference.isWebMercator){var u=a===i?new Float32Array(a.length):a;return(0,Pr.transformVectorWMPlateCarree)(a,Pr.VectorType.TANGENT,r,u)}return a}if(null==r)return null;var c=a===i?new Float32Array(a.length):a;return(0,Pr.projectTangentToPCPF)(a,r,t,e.spatialReference,c)}},{key:"_createSymbolColorBuffer",value:function(e){if(this._requiresSymbolVertexColors()){var t,r,n=this._getVertexOpacityAndColor(e),i=(0,Hr.F5)(null===(t=this.symbolLayer)||void 0===t||null===(r=t.material)||void 0===r?void 0:r.colorMixMode),a=new Uint8Array(4);return(0,Hr.HB)(n,i,a),a}return null}},{key:"_createBuffers",value:function(e,t){var r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var n=e.vertexAttributes.normal,i=e.vertexAttributes.uv,a=e.vertexAttributes.tangent;if(n&&n.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(a&&a.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(i&&i.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;var o=this._computeReprojectionInfo(e),s=this._createPositionBuffer(e,o),l=s.position,u=s.georeferencedPositionBuffer,c=function(e){return e.vertexAttributes.color}(e),h=this._createSymbolColorBuffer(t),d=this._createNormalBuffer(e,l,u,o),f=this._createTangentBuffer(e,l,u,o),v=i,p=this._passthroughReprojectionInfo(o)?{transformation:o.objectTransformation,position:l,normal:d,tangent:f}:this._transformOriginLocal(e,l,d,f),m=p.transformation;return{positionBuffer:p.position,normalBuffer:p.normal,tangentBuffer:p.tangent,uvBuffer:v,colorBuffer:c,symbolColorBuffer:h,objectTransformation:m,geometryTransformation:o.reprojection===qn.NONE&&o.geometryTransformation?o.geometryTransformation:(0,q.Ue)()}}},{key:"_computeReprojectionInfo",value:function(e){var t,r,n=e.vertexSpace,i="georeferenced"===n.type?(0,R.fS)(this._context.renderCoordsHelper.spatialReference,e.spatialReference)?qn.NONE:qn.RENDER:qn.NONE;if((0,wr.z1)(n))return{reprojection:i};var a=n.origin,o=(0,q.Ue)(),s=null!==(t=null===(r=e.transform)||void 0===r?void 0:r.localMatrix)&&void 0!==t?t:q.Wd;if(i===qn.NONE)return(0,J.B)(e.spatialReference,a,o,this._context.renderCoordsHelper.spatialReference),{reprojection:i,objectTransformation:o,geometryTransformation:(0,q.d9)(s)};var l=(0,W.vc)((0,q.Ue)(),a);return(0,W.Jp)(l,l,s),{reprojection:i,transformBeforeProject:l}}},{key:"_transformOriginLocal",value:function(e,t,r,n){var i,a=this._context.renderCoordsHelper.spatialReference,o=e.anchor;Yn[0]=o.x,Yn[1]=o.y,Yn[2]=null!==(i=o.z)&&void 0!==i?i:0;var s=(0,q.Ue)();(0,J.B)(e.spatialReference,Yn,s,a),(0,W.U_)(ei,s);var l=e.vertexAttributes,u=l.position,c=l.normal,h=l.tangent,d=t===u?new Float64Array(t.length):t;(0,K.a)(d,t,ei);var f=r?r===c?new Float32Array(r.length):r:null,v=n?n===h?new Float32Array(n.length):n:null;return r&&f&&(0,Pr.transformNormal)(r,f,ei),n&&v&&(0,Pr.transformTangent)(n,v,ei),{transformation:s,position:d,normal:f,tangent:v}}},{key:"_validateFaces",value:function(e,t){var r=e.vertexAttributes.position.length/3,n=t.faces;if(n){for(var i=-1,a=0;a<n.length;a++){var o=n[a];o>i&&(i=o)}if(r<=i)return this.logger.warn("Vertex index ".concat(i," is out of bounds of the mesh position buffer")),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}},{key:"_isOutsideClippingArea",value:function(e){var t;if(!this._context.clippingExtent)return!1;var r=null===(t=e.vertexAttributes)||void 0===t?void 0:t.position;if(!r)return!1;var n=this._context.elevationProvider.spatialReference,i=(0,Pr.project)({positions:r,transform:e.transform,vertexSpace:e.vertexSpace,inSpatialReference:e.spatialReference,outSpatialReference:null!==n&&void 0!==n?n:e.spatialReference,localMode:this._context.stage.viewingMode===ee.JY.Local});if(!i)return!1;var a=i.length/3;return(0,C.cS)(ri),(0,C.G1)(ri,i,0,a),!(0,C.Zp)(ri,this._context.clippingExtent)}},{key:"_createGeometryInfo",value:function(e,t,r){if(!(0,gr.canProjectWithoutEngine)(e.spatialReference,this._context.renderCoordsHelper.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(!this._validateVertexSpace(e))return null;if(this._isOutsideClippingArea(e))return null;var i=this._createBuffers(e,t);if(null==i)return null;var a,o=i.positionBuffer,s=i.uvBuffer,l=i.colorBuffer,u=i.symbolColorBuffer,c=i.normalBuffer,h=i.tangentBuffer,d=i.objectTransformation,f=i.geometryTransformation,v=function(e){var t;return null!==(t=e.components)&&void 0!==t?t:ni}(e),p=new Array,m=!1,y=(0,W.i0)(Xn,d),g=this._context.localOriginFactory.getOrigin(y),_=(0,n.Z)(v);try{for(_.s();!(a=_.n()).done;){var b=a.value;if(!this._validateFaces(e,b))return null;var x=Dn(e,b);if(0!==x.length){var S=zn(o,c,b,x);S.didFlipNormals&&(m=!0);var T=[[ce.T.POSITION,new se.a(o,x,3,!0)],[ce.T.NORMAL,new se.a(S.normals,S.indices,3,!0)]];l&&T.push([ce.T.COLOR,new se.a(l,x,4,!0)]),u&&T.push([ce.T.SYMBOLCOLOR,new se.a(u,(0,X.LE)(x.length),4,!0)]),s&&T.push([ce.T.UV0,new se.a(s,x,2,!0)]),h&&T.push([ce.T.TANGENT,new se.a(h,x,4,!0)]);var w=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),P=this._getOrCreateMaterial(e,b),C=new ue.Z(P,T,null,le.U.Mesh,w);C.transformation=f,C.localOrigin=g,p.push(C)}}}catch(O){_.e(O)}finally{_.f()}return m&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:p,objectTransformation:d}}},{key:"_updateMaterialParameters",value:function(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((function(e,t){t.setParameters(e.parameters)}))}},{key:"_validateVertexSpace",value:function(e){var t=this._context.graphicsCoreOwner.view.state.viewingMode,r=e.vertexSpace;return t!==ee.JY.Local||"local"!==r.type||(this.logger.warn("Displaying a mesh with a local vertex space in a view in local viewing mode is not supported."),!1)}},{key:"test",value:function(){return(0,N.Z)((0,N.Z)({},(0,u.Z)((0,c.Z)(r.prototype),"test",this).call(this)),{},{materials:this._materialInfoCache.materials})}}]),r}(re.k),Mn=(0,l.Z)((function e(t,r,n){(0,s.Z)(this,e),this.normals=t,this.indices=r,this.didFlipNormals=n}));function Dn(e,t){var r;return null!==(r=t.faces)&&void 0!==r?r:(0,X.KF)(e.vertexAttributes.position.length/3)}function zn(e,t,r,n){switch(r.shading||"flat"){default:case"source":return function(e,t,r,n){if(null==t)return Nn(e,n);var i=!1;if(!r.trustSourceNormals)for(var a=0;a<n.length;a+=3){Vn(e,n,a,Qn);for(var o=0;o<3;o++){var s=3*n[a+o];Xn[0]=t[s],Xn[1]=t[s+1],Xn[2]=t[s+2],(0,S.m)(Qn,Xn)<0&&(t[s]=-t[s],t[s+1]=-t[s+1],t[s+2]=-t[s+2],i=!0)}}return new Mn(t,n,i)}(e,t,r,n);case"flat":return Nn(e,n);case"smooth":return function(e,t){for(var r={},n=0;n<t.length;n+=3)for(var i=Vn(e,t,n,Qn),a=0;a<3;a++){var o=t[n+a],s=r[o];s||(s={normal:(0,T.Ue)(),count:0},r[o]=s),(0,S.g)(s.normal,s.normal,i),s.count++}for(var l=(0,br.xx)(3*t.length),u=new Array(3*t.length),c=0;c<t.length;c++){var h=r[t[c]];1!==h.count&&((0,S.n)(h.normal,h.normal),h.count=1);for(var d=0;d<3;d++)l[3*c+d]=h.normal[d];u[c]=c}return new Mn(l,u,!1)}(e,n)}}function Nn(e,t){for(var r=(0,br.xx)(t.length),n=new Array(3*t.length),i=0;i<t.length;i+=3)for(var a=Vn(e,t,i,Qn),o=0;o<3;o++)r[i+o]=a[o],n[i+o]=i/3;return new Mn(r,n,!1)}function Fn(e,t,r,n,i,a){var o=3*t[r],s=3*t[r+1],l=3*t[r+2];n[0]=e[o],n[1]=e[o+1],n[2]=e[o+2],i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],a[0]=e[l],a[1]=e[l+1],a[2]=e[l+2]}function Vn(e,t,r,n){return Fn(e,t,r,Xn,Kn,$n),(0,S.f)(Kn,Kn,Xn),(0,S.f)($n,$n,Xn),(0,S.b)(Xn,Kn,$n),(0,S.n)(n,Xn),n}function Hn(e){if(!e)return null;var t=e.scale,r=e.offset,n=e.rotation;return{scale:t,offset:r,rotation:(0,yr.Vl)(n)}}function Gn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"repeat";if("string"==typeof e){var t=Bn(e);return{s:t,t:t}}return{s:Bn(e.horizontal),t:Bn(e.vertical)}}function Bn(e){switch(e){case"clamp":return on.e8.CLAMP_TO_EDGE;case"mirror":return on.e8.MIRRORED_REPEAT;default:return on.e8.REPEAT}}function jn(e){return null==e?"-":e instanceof ft.Z?e.toHex():e.contentHash}function Wn(e){var t=null!==e&&void 0!==e?e:Jn,r=t.offset,n=t.scale,i=t.rotation;return"".concat(r[0],",").concat(r[1],",").concat(i,",").concat(n[0],",").concat(n[1])}var qn,Jn=new Tr.Z,Yn=(0,T.Ue)(),Xn=(0,T.Ue)(),Kn=(0,T.Ue)(),$n=(0,T.Ue)(),Qn=(0,T.Ue)(),ei=(0,q.Ue)(),ti=(0,q.Ue)(),ri=(0,C.Ue)(),ni=[new xr.Z];!function(e){e[e.NONE=0]="NONE",e[e.RENDER=1]="RENDER"}(qn||(qn={}));var ii=r(18722),ai=r(73627),oi=r(53720),si=r(47669),li=function(){function e(t,r,n,i){(0,s.Z)(this,e),this.graphics3DSymbolLayer=t,this.instanceIndex=r,this.elevationAligner=n,this.elevationContext=i,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}return(0,l.Z)(e,[{key:"initialize",value:function(){}},{key:"setVisibility",value:function(e){var t=this._lodRenderer.instanceData;e!==t.getVisible(this.instanceIndex)&&t.setVisible(this.instanceIndex,e)}},{key:"destroy",value:function(){null!=this.instanceIndex&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}},{key:"alignWithElevation",value:function(e,t,r){var n=this;if(this.elevationAligner){(0,Z.aO)(this.elevationContext.featureExpressionInfoContext,r);var i=this.elevationAligner(this,this.elevationContext,e.spatialReference,(function(r,i){return(0,te.qZ)(r,e,n.elevationContext,t,i)}),t);null!=i&&(this.alignedSampledElevation=i)}}},{key:"getCenterObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,T.Ue)();return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,fi),(0,S.h)(e,this._lodRenderer.baseBoundingSphere.center,fi)}},{key:"getBoundingBoxObjectSpace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,C.Ue)();this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,fi);var t=this._lodRenderer.baseBoundingBox;(0,C.cS)(e);for(var r=0;r<8;++r)(0,S.s)(ci,1&r?t[3]:t[0],2&r?t[4]:t[1],4&r?t[5]:t[2]),(0,S.h)(ci,ci,fi),(0,C.pp)(e,ci);return e}},{key:"computeAttachmentOrigin",value:function(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,fi),e.render.origin[0]+=fi[12],e.render.origin[1]+=fi[13],e.render.origin[2]+=fi[14],e.render.num++}},{key:"getProjectedBoundingBox",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,o){var s,l,u,c,h,d,f,v,p,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.getBoundingBoxObjectSpace(o),l=di,u=(0,C.wp)(s)?1:l.length,this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,fi),c=0;c<u;c++)h=l[c],ci[0]=s[h[0]],ci[1]=s[h[1]],ci[2]=s[h[2]],(0,S.h)(ci,ci,fi),ui[3*c]=ci[0],ui[3*c+1]=ci[1],ui[3*c+2]=ci[2];if(t(ui,0,u)){e.next=5;break}return e.abrupt("return",null);case 5:for((0,C.cS)(s),d=null,this.calculateRelativeScreenBounds&&(d=this.calculateRelativeScreenBounds()),f=0;f<3*u;f+=3){for(v=0;v<3;v++)s[v]=Math.min(s[v],ui[f+v]),s[v+3]=Math.max(s[v+3],ui[f+v]);d&&n.push({location:ui.slice(f,f+3),screenSpaceBoundingRect:d})}if(!r||((0,C.be)(s,hi),"absolute-height"===this.elevationContext.mode)){e.next=20;break}return m=(0,ne.Si)(s,r.service.spatialReference,r),e.prev=11,e.next=14,r.service.queryElevation(hi[0],hi[1],i,m,"ground");case 14:p=e.sent,e.next=19;break;case 17:e.prev=17,e.t0=e.catch(11);case 19:null!=p&&(0,C.cv)(s,0,0,-this.alignedSampledElevation+p);case 20:return e.abrupt("return",s);case 21:case"end":return e.stop()}}),e,this,[[11,17]])})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"addObjectState",value:function(e,t){var r=this;if(e===Le.V_.Highlight){var n=new si.O(e);this._addHighlightId(n),t.addExternal((function(e){r._removeHighlightId(e)}),n)}}},{key:"removeObjectState",value:function(e){this._highlights.forEach((function(t){return e.remove(t)}))}},{key:"_addHighlightId",value:function(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}},{key:"_removeHighlightId",value:function(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}},{key:"_lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]),e}(),ui=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ci=(0,T.Ue)(),hi=(0,T.Ue)(),di=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],fi=(0,q.Ue)(),vi=r(85042),pi=r(72635);function mi(e,t){var r=e.stageResources.geometries.map((function(t){return new pi.QD(t,e.stageResources.textures)})),n=null==e.lodThreshold||0===e.lodThreshold&&t>0?function(e){var t=e.reduce((function(e,t){return e+t.geometry.indexCount/3}),0);return Math.sqrt(t*gi/Math.PI)}(r):e.lodThreshold;return new pi.T6(r,n,e.pivotOffset)}function yi(e){return new pi.hO(e.map((function(e,t){return mi(e,t)})))}var gi=20,_i=r(47858),bi=r(22894),xi=r(60314),Si=r(38048),Ti=r(19951);function wi(e){return Pi.apply(this,arguments)}function Pi(){return Pi=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o,s,l,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&(null!=t.styleName||null!=t.styleUrl)){e.next=2;break}return e.abrupt("return",null);case 2:if(null!=(n=t.name)){e.next=5;break}throw new F.Z("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");case 5:return i={portal:t.portal},e.next=8,(0,Si.n2)(t,i).catch((function(){return null}));case 8:if(null!==(o=e.sent)){e.next=11;break}return e.abrupt("return",null);case 11:if(!(s=(0,Ti.getStyleItemFromStyle)(n,o.data))||null!==(r=s.formatInfos)&&void 0!==r&&r.some((function(e){return"gltf_basisu"===e.type}))){e.next=14;break}return e.abrupt("return",null);case 14:return e.next=16,(0,Ti.fetchSymbolFromStyle)(o,n,i,"webRef",(function(e,t){return(0,Si.v9)(e,t,["gltf_basisu","gltf"])})).catch((function(){return null}));case 16:if(null!==(l=e.sent)&&"point-3d"===l.type){e.next=19;break}return e.abrupt("return",null);case 19:return u=l.symbolLayers.items[0],e.abrupt("return","object"===u.type?u.resource:null);case 21:case"end":return e.stop()}}),e)}))),Pi.apply(this,arguments)}var Ci,Oi=r(97326),Ri=r(49861),Ei=r(69912),ki=r(50256),Ai=r(55158),Zi=r(81296),Li=r(70374),Ii=r(54463),Ui=r(78329),Mi=r(7138),Di=r(91505),zi=r(25158),Ni=r(80064),Fi=r(44070),Vi=function(){function e(t,r,n){(0,s.Z)(this,e),this._elementSize=r,this._buffer=Fi.f.createVertex(t,on.l1.STATIC_DRAW),this.resize(n)}return(0,l.Z)(e,[{key:"destroy",value:function(){this._buffer.dispose()}},{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"usedMemory",get:function(){return this._array.byteLength+this._buffer.usedMemory}},{key:"copyRange",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(i)}},{key:"transferAll",value:function(){this._buffer.setData(this._array)}},{key:"transferRange",value:function(e,t){var r=e*this._elementSize,n=t*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}},{key:"resize",value:function(e){var t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}}]),e}(),Hi=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.modelOriginHi=t.getField(ce.T.INSTANCEMODELORIGINHI,zi.ct),this.modelOriginLo=t.getField(ce.T.INSTANCEMODELORIGINLO,zi.ct),this.model=t.getField(ce.T.INSTANCEMODEL,zi.gK),this.modelNormal=t.getField(ce.T.INSTANCEMODELNORMAL,zi.gK),this.featureAttribute=t.getField(ce.T.INSTANCEFEATUREATTRIBUTE,zi.ek),this.color=t.getField(ce.T.INSTANCECOLOR,zi.mc),this.objectAndLayerIdColor=t.getField(ce.T.INSTANCEOBJECTANDLAYERIDCOLOR,zi.mc)})),Gi=function(){function e(t,r){(0,s.Z)(this,e),this._rctx=t,this._instanceBufferLayout=r,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}return(0,l.Z)(e,[{key:"destroy",value:function(){this._buffer&&this._buffer.destroy()}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){var e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"usedMemory",get:function(){var e,t;return null!==(e=null===(t=this._buffer)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0}},{key:"reset",value:function(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}},{key:"startUpdateCycle",value:function(){this._captureFirstIndex=!0}},{key:"beginUpdate",value:function(){(0,Xr.hu)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}},{key:"endUpdate",value:function(){(0,Xr.hu)(this._updating,"not updating"),this.size<f.p$*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}},{key:"allocateHead",value:function(){(0,Xr.hu)(this._updating,"not updating"),this.isFull&&this._grow();var e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),(0,Xr.hu)(this._headIndex!==this._tailIndex,"invalid pointers"),e}},{key:"freeTail",value:function(){(0,Xr.hu)(this._updating,"not updating"),(0,Xr.hu)(this.size>0,"invalid size");var e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}},{key:"_grow",value:function(){var e=Math.max(Bi,Math.floor(this._capacity*f._x));this._resize(e)}},{key:"_shrink",value:function(){var e=Math.max(Bi,Math.floor(this._capacity*f.$L));this._resize(e)}},{key:"_resize",value:function(e){if((0,Xr.hu)(this._updating,"not updating"),e!==this._capacity){var t=new Vi(this._rctx,this._instanceBufferLayout.stride,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var r=this.size,n=this._compactInstances(t);(0,Xr.hu)(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Hi(this._instanceBufferLayout.createView(this._buffer.array))}}},{key:"_compactInstances",value:function(e){var t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}},{key:"_incrementHead",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._headIndex=(this._headIndex+e)%this._capacity}},{key:"_incrementTail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._tailIndex=(this._tailIndex+e)%this._capacity}},{key:"_transferRange",value:function(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}}]),e}(),Bi=64;!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"}(Ci||(Ci={}));var ji=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.localTransform=t.getField(ce.T.LOCALTRANSFORM,zi.O1),this.globalTransform=t.getField(ce.T.GLOBALTRANSFORM,zi.O1),this.modelOrigin=t.getField(ce.T.MODELORIGIN,zi.fP),this.model=t.getField(ce.T.INSTANCEMODEL,zi.gK),this.modelNormal=t.getField(ce.T.INSTANCEMODELNORMAL,zi.gK),this.modelScaleFactors=t.getField(ce.T.MODELSCALEFACTORS,zi.Eu),this.boundingSphere=t.getField(ce.T.BOUNDINGSPHERE,zi.Cd),this.featureAttribute=t.getField(ce.T.FEATUREATTRIBUTE,zi.ek),this.color=t.getField(ce.T.COLOR,zi.mc),this.objectAndLayerIdColor=t.getField(ce.T.OBJECTANDLAYERIDCOLOR,zi.mc),this.state=t.getField(ce.T.STATE,zi.D_),this.lodLevel=t.getField(ce.T.LODLEVEL,zi.D_)})),Wi=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).events=new Di.Z,i._capacity=0,i._size=0,i._next=0,i._layout=function(e){var t=(0,Ai.U$)().mat4f64(ce.T.LOCALTRANSFORM).mat4f64(ce.T.GLOBALTRANSFORM).vec4f64(ce.T.BOUNDINGSPHERE).vec3f64(ce.T.MODELORIGIN).mat3f(ce.T.INSTANCEMODEL).mat3f(ce.T.INSTANCEMODELNORMAL).vec2f(ce.T.MODELSCALEFACTORS);return e.includes(ce.T.FEATUREATTRIBUTE)&&(t=t.vec4f(ce.T.FEATUREATTRIBUTE)),e.includes(ce.T.COLOR)&&(t=t.vec4u8(ce.T.COLOR)),e.includes(ce.T.OBJECTANDLAYERIDCOLOR)&&(t=t.vec4u8(ce.T.OBJECTANDLAYERIDCOLOR)),t.u8(ce.T.STATE).u8(ce.T.LODLEVEL)}(n),i._capacity=Bi,i._buffer=i._layout.createBuffer(i._capacity),i._view=new ji(i._buffer),i}return(0,l.Z)(r,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"view",get:function(){return this._view}},{key:"addInstance",value:function(){this._size+1>this._capacity&&this._grow();var e=this._findSlot();return this._view.state.set(e,Ci.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}},{key:"removeInstance",value:function(e){var t=this._view.state;(0,Xr.hu)(e>=0&&e<this._capacity&&!!(t.get(e)&Ci.ALLOCATED),"invalid instance handle"),this._getStateFlag(e,Ci.ACTIVE)?this._setStateFlags(e,Ci.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}},{key:"freeInstance",value:function(e){var t=this._view.state;(0,Xr.hu)(e>=0&&e<this._capacity&&!!(t.get(e)&Ci.ALLOCATED),"invalid instance handle"),t.set(e,0),this._size--}},{key:"setLocalTransform",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}},{key:"getLocalTransform",value:function(e,t){this._view.localTransform.getMat(e,t)}},{key:"setGlobalTransform",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}},{key:"getGlobalTransform",value:function(e,t){this._view.globalTransform.getMat(e,t)}},{key:"updateModelTransform",value:function(e){var t=this._view,r=qi,n=Ji;t.localTransform.getMat(e,Yi),t.globalTransform.getMat(e,Xi);var i=(0,W.Jp)(Xi,Xi,Yi);(0,S.s)(r,i[12],i[13],i[14]),t.modelOrigin.setVec(e,r),(0,B.xO)(n,i),t.model.setMat(e,n);var a=(0,Ni.mw)(qi,i);a.sort(),t.modelScaleFactors.set(e,0,a[1]),t.modelScaleFactors.set(e,1,a[2]),(0,B.U_)(n,n),(0,B.p4)(n,n),t.modelNormal.setMat(e,n),this._setStateFlags(e,Ci.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}},{key:"getModelTransform",value:function(e,t){var r=this._view;r.model.getMat(e,Ji),r.modelOrigin.getVec(e,qi),t[0]=Ji[0],t[1]=Ji[1],t[2]=Ji[2],t[3]=0,t[4]=Ji[3],t[5]=Ji[4],t[6]=Ji[5],t[7]=0,t[8]=Ji[6],t[9]=Ji[7],t[10]=Ji[8],t[11]=0,t[12]=qi[0],t[13]=qi[1],t[14]=qi[2],t[15]=1}},{key:"applyShaderTransformation",value:function(e,t){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}},{key:"getCombinedModelTransform",value:function(e,t){return this.getModelTransform(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t),t}},{key:"getCombinedLocalTransform",value:function(e,t){this._view.localTransform.getMat(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}},{key:"getCombinedMaxScaleFactor",value:function(e){var t=this._view.modelScaleFactors.get(e,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(qi,this,e),t*=Math.max(qi[0],qi[1],qi[2])),t}},{key:"getCombinedMedianScaleFactor",value:function(e){var t=this._view.modelScaleFactors.get(e,0);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(qi,this,e),t*=function(e,t,r){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),r))}(qi[0],qi[1],qi[2])),t}},{key:"getModel",value:function(e,t){this._view.model.getMat(e,t)}},{key:"setFeatureAttribute",value:function(e,t){this._view.featureAttribute.setVec(e,t)}},{key:"getFeatureAttribute",value:function(e,t){this._view.featureAttribute.getVec(e,t)}},{key:"setColor",value:function(e,t){this._view.color.setVec(e,t)}},{key:"setObjectAndLayerIdColor",value:function(e,t){this._view.objectAndLayerIdColor.setVec(e,t)}},{key:"setVisible",value:function(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,Ci.VISIBLE,t),this.events.emit("instance-visibility-changed",{index:e}))}},{key:"getVisible",value:function(e){return this._getStateFlag(e,Ci.VISIBLE)}},{key:"setHighlight",value:function(e,t){t!==this.getHighlight(e)&&(this._setStateFlag(e,Ci.HIGHLIGHT,t),this.events.emit("instance-highlight-changed"))}},{key:"getHighlight",value:function(e){return this._getStateFlag(e,Ci.HIGHLIGHT)}},{key:"getState",value:function(e){return this._view.state.get(e)}},{key:"getLodLevel",value:function(e){return this._view.lodLevel.get(e)}},{key:"countFlags",value:function(e){for(var t=0,r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}},{key:"_setStateFlags",value:function(e,t){var r=this._view.state;t=r.get(e)|t,r.set(e,t)}},{key:"_clearStateFlags",value:function(e,t){var r=this._view.state;t=r.get(e)&~t,r.set(e,t)}},{key:"_setStateFlag",value:function(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}},{key:"_getStateFlag",value:function(e,t){return!!(this._view.state.get(e)&t)}},{key:"_grow",value:function(){this._capacity=Math.max(Bi,Math.floor(this._capacity*f._x)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new ji(this._buffer)}},{key:"_findSlot",value:function(){for(var e=this._view.state,t=this._next;e.get(t)&Ci.ALLOCATED;)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}}]),r}(Mi.default);(0,un._)([(0,Ri.Cb)({constructOnly:!0})],Wi.prototype,"shaderTransformation",void 0),(0,un._)([(0,Ri.Cb)()],Wi.prototype,"_size",void 0),(0,un._)([(0,Ri.Cb)({readOnly:!0})],Wi.prototype,"size",null),Wi=(0,un._)([(0,Ei.j)("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],Wi);var qi=(0,T.Ue)(),Ji=(0,j.Ue)(),Yi=(0,q.Ue)(),Xi=(0,q.Ue)(),Ki=r(23470),$i=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),i=t.call(this,(function(e){return(0,Ki.w)(i._instanceData.view.boundingSphere.getVec(e,i._tmpSphere))}),{maximumDepth:25}),i._instanceData=e,i._boundingSphere=n,i._tmpSphere=(0,Ki.c)(),i._tmpMat4=(0,q.Ue)(),i}return(0,l.Z)(r,[{key:"addInstance",value:function(e){var t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);(0,S.h)((0,Ki.g)(this._tmpSphere),this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*(0,Ni.u1)(r),t.setVec(e,this._tmpSphere),this.add([e])}},{key:"removeInstance",value:function(e){this.remove([e])}}]),r}(Ui.Z),Qi=function(){function e(t,r){(0,s.Z)(this,e),this._worldSpaceRadius=t,this._minScreenSpaceRadii=r}return(0,l.Z)(e,[{key:"selectLevel",value:function(e,t,r){for(var n=r.computeScreenPixelSizeAt(e),i=this._worldSpaceRadius*t/n,a=0,o=1;o<this._minScreenSpaceRadii.length;++o)i>=this._minScreenSpaceRadii[o]&&(a=o);return a}}]),e}(),ea=r(94425),ta=r(88153),ra=r(80658),na=r(22255),ia=function(){function e(t,r){(0,s.Z)(this,e);var n=t.renderContext.rctx,i=r.geometry;this._materials=t.materials,i.material.setParameters({instancedDoublePrecision:!0});var a=i.material.createBufferWriter(),o=a.vertexBufferLayout,l=a.elementCount(i),u=o.createBuffer(l);a.write(null,null,i,u,0),this.geometry=i,this.material=i.material,this.glMaterials=new ea.p(i.material,this._materials),this.vertexBufferLayout=o,this.vbo=Fi.f.createVertex(n,on.l1.STATIC_DRAW,u.buffer),this.vao=new ra.U(n,tn.i,{geometry:(0,ki.K)(o)},{geometry:this.vbo}),this.vertexCount=l}return(0,l.Z)(e,[{key:"destroy",value:function(){this.glMaterials.dispose(),this.vbo.dispose(),this.vao.dispose()}},{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}},{key:"intersect",value:function(e,t,r,n,i,a,o,s){var l=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,(function(r,n,u,c,h){if(r>=0){if(null!=t&&!t(e.rayBegin,e.rayEnd,r))return;var d=new na.x(a.layerUid,a.graphicUid(i),l,u,o,s);if((null==e.results.min.drapedLayerOrder||h>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&e.results.min.set(Ii.q7.LOD,d,r,n,e.transform.transform,h),e.options.store!==Ii.eC.MIN&&(null==e.results.max.drapedLayerOrder||h>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&e.results.max.set(Ii.q7.LOD,d,r,n,e.transform.transform,h),e.options.store===Ii.eC.ALL){var f=(0,ta.LP)(e.results.min.ray);f.set(Ii.q7.LOD,d,r,n,e.transform.transform,h),e.results.all.push(f)}}}))}}]),e}(),aa=function(){function e(t,r){(0,s.Z)(this,e),this.minScreenSpaceRadius=t,this.components=r}return(0,l.Z)(e,[{key:"destroy",value:function(){this.components.forEach((function(e){return e.destroy()}))}},{key:"intersect",value:function(e,t,r,n,i,a,o){var s=this;this.components.forEach((function(l){return l.intersect(e,t,r,n,i,a,s.boundingSphere,o)}))}},{key:"boundingBox",get:function(){if(null==this._boundingBox){var e=(0,C.cS)();this.components.forEach((function(t){null!=t.boundingInfo&&((0,C.pp)(e,t.boundingInfo.bbMin),(0,C.pp)(e,t.boundingInfo.bbMax))})),this._boundingBox=e}return this._boundingBox}},{key:"boundingSphere",get:function(){if(null==this._boundingSphere){var e=this.boundingBox,t=(0,T.Ue)();(0,C.be)(e,t),this._boundingSphere={center:t,radius:.5*(0,C.wz)(e)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((function(e,t){return e+t.triangleCount}),0)}}],[{key:"create",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(r,i,o){var s,l,u,c,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.allSettled(i.components.map((function(e){return r.controller.schedule((function(){return new ia(r,e)}),o)})));case 2:if(s=t.sent,l=s.map((function(e){return"fulfilled"===e.status?e.value:null})).filter(f.pC),!(0,m.Hc)(o)&&l.length===s.length){t.next=23;break}l.forEach((function(e){return e.destroy()})),(0,m.k_)(o),u=(0,n.Z)(s),t.prev=7,u.s();case 9:if((c=u.n()).done){t.next=15;break}if("rejected"!==(h=c.value).status){t.next=13;break}throw h.reason;case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),u.e(t.t0);case 20:return t.prev=20,u.f(),t.finish(20);case 23:return t.abrupt("return",new e(i.minScreenSpaceRadius,l));case 24:case"end":return t.stop()}}),t,null,[[7,17,20,23]])})));return function(e,r,n){return t.apply(this,arguments)}}()}]),e}(),oa=r(22909),sa=r(32683),la=r(50531),ua=r(93463),ca=r(3384),ha=function(e){var t=e.baseBoundingSphere.radius,r=e.levels.map((function(e){return e.minScreenSpaceRadius}));return new Qi(t,r)},da=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).type=Ii.q7.LOD,i.isGround=!1,i._levels=[],i._defaultRenderInstanceData=[new Array],i._highlightRenderInstanceData=[new Array],i._allRenderInstanceData=[i._defaultRenderInstanceData[0],i._highlightRenderInstanceData[0]],i._instanceIndex=0,i._cycleStartIndex=0,i._slicePlane=!1,i._camera=new Zi.Z,i._updateCyclesWithStaticCamera=-1,i._needFullCycle=!1,i.produces=new Map([[Yr.r.OPAQUE_MATERIAL,function(e){return i._produces(e)}],[Yr.r.TRANSPARENT_MATERIAL,function(e){return!!i._hasTransparentLevels()&&i._produces(e)}]]),i._instanceData=new Wi({shaderTransformation:e.shaderTransformation},e.optionalFields),i.addHandles(n.registerTask(ua.T8.LOD_RENDERER,(0,Oi.Z)(i))),i}return(0,l.Z)(r,[{key:"initialize",value:function(){var e=this;this._instanceBufferLayout=function(e){var t=(0,Ai.U$)().vec3f(ce.T.INSTANCEMODELORIGINHI).vec3f(ce.T.INSTANCEMODELORIGINLO).mat3f(ce.T.INSTANCEMODEL).mat3f(ce.T.INSTANCEMODELNORMAL);return null!=e&&e.includes("featureAttribute")&&(t=t.vec4f(ce.T.INSTANCEFEATUREATTRIBUTE)),null!=e&&e.includes("color")&&(t=t.vec4u8(ce.T.INSTANCECOLOR)),null!=e&&e.includes("objectAndLayerIdColor")&&(t=t.vec4u8(ce.T.INSTANCEOBJECTANDLAYERIDCOLOR)),t}(this.optionalFields),this._glInstanceBufferLayout=(0,ki.K)(this._instanceBufferLayout,1),this.addHandles([this._instanceData.events.on("instances-changed",(function(){return e._requestUpdateCycle()})),this._instanceData.events.on("instance-transform-changed",(function(t){var r=t.index;e._requestUpdateCycle(),e.metadata.notifyGraphicGeometryChanged(r)})),this._instanceData.events.on("instance-visibility-changed",(function(t){var r=t.index;e._requestUpdateCycle(!0),e.metadata.notifyGraphicVisibilityChanged(r)})),this._instanceData.events.on("instance-highlight-changed",(function(){return e._requestUpdateCycle(!0)}))])}},{key:"_enableLevelSelection",get:function(){return this.symbol.levels.length>1}},{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(e){this._slicePlane=e}},{key:"layerUid",get:function(){return this.metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"usedMemory",get:function(){return this._allRenderInstanceData.reduce((function(e,t){return t.reduce((function(e,t){return e+t.usedMemory}),e)}),0)}},{key:"renderStats",get:function(){var e=this,t=this._instanceData.size,r=[];return this._levels.forEach((function(t,n){var i=e._allRenderInstanceData[0][n].size+e._allRenderInstanceData[1][n].size,a=t.triangleCount;r.push({renderedInstances:i,renderedTriangles:i*a,trianglesPerInstance:a})})),{totalInstances:t,renderedInstances:r.reduce((function(e,t){return e+t.renderedInstances}),0),renderedTriangles:r.reduce((function(e,t){return e+t.renderedTriangles}),0),levels:r}}},{key:"initializeRenderContext",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i,o,s,l,u,c,h=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._context=t,i=t.renderContext.rctx,e.next=4,Promise.allSettled(this.symbol.levels.map((function(e){return h._defaultRenderInstanceData[0].push(new Gi(i,h._instanceBufferLayout)),h._highlightRenderInstanceData[0].push(new Gi(i,h._instanceBufferLayout)),aa.create(t,e,r)})));case 4:if(o=e.sent,s=o.map((function(e){return"fulfilled"===e.status?e.value:null})).filter(f.pC),!(0,m.Hc)(r)&&s.length===o.length){e.next=25;break}s.forEach((function(e){return e.destroy()})),(0,m.k_)(r),l=(0,n.Z)(o),e.prev=9,l.s();case 11:if((u=l.n()).done){e.next=17;break}if("rejected"!==(c=u.value).status){e.next=15;break}throw c.reason;case 15:e.next=11;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),l.e(e.t0);case 22:return e.prev=22,l.f(),e.finish(22);case 25:this._levels=s,this._levelSelector=ha(this);case 26:case"end":return e.stop()}}),e,this,[[9,19,22,25]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"uninitializeRenderContext",value:function(){this._invalidateOctree(),this._levels.forEach((function(e){return e.destroy()})),this._defaultRenderInstanceData[0].forEach((function(e){return e.destroy()})),this._highlightRenderInstanceData[0].forEach((function(e){return e.destroy()}))}},{key:"_hasTransparentLevels",value:function(){return this._levels.some((function(e){return e.components.some((function(e){var t=e.material.produces.get(Yr.r.TRANSPARENT_MATERIAL);return null===t||void 0===t?void 0:t(Wr.H_.Color)}))}))}},{key:"hasHighlights",value:function(){return this._highlightRenderInstanceData[0].some((function(e){return e.size>0}))}},{key:"_produces",value:function(e){return e!==Wr.H_.Highlight&&e!==Wr.H_.ShadowHighlight||this.hasHighlights()}},{key:"prepareRender",value:function(e){if(!ge.h.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var t=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),t||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(ua.G5),this._needFullCycle=!1)}}},{key:"prepareTechniques",value:function(e){var t=this;if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;var r=this._getInstanceDatas(e.output);if(!r)return null;var n=new Array;return r.forEach((function(r){return t.levels.forEach((function(i,a){i.components.forEach((function(i){return n.push(t._beginComponent(e,r[a],i))}))}))})),n}},{key:"renderNode",value:function(e,t){var r=this,n=this._getInstanceDatas(e.output);if(n&&null!=t){var i=0;e.rctx.bindVAO(),n.forEach((function(n){return r.levels.forEach((function(a,o){a.components.forEach((function(a){return r._renderComponent(e,t[i++],n[o],a,o)}))}))}))}}},{key:"_getInstanceDatas",value:function(e){var t=e!==Wr.H_.Highlight&&e!==Wr.H_.ShadowHighlight,r=e!==Wr.H_.ShadowExcludeHighlight;return t&&r?this._allRenderInstanceData:t?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}},{key:"intersect",value:function(e,t,r,n){var i=this;if(this.baseMaterial.isVisible()&&null!=this._octree){var a=(0,T.Ue)();(0,S.f)(a,n,r);var o=function(a){i._instanceData.getCombinedModelTransform(a,ma),e.transform.set(ma),(0,S.h)(ya,r,e.transform.inverse),(0,S.h)(ga,n,e.transform.inverse);var o=i._instanceData.getState(a),s=i._instanceData.getLodLevel(a),l=i._levels.length;(0,Xr.hu)(!!(o&Ci.ACTIVE),"invalid instance state"),(0,Xr.hu)(s>=0&&s<l,"invaid lod level"),i._levels[s].intersect(e,t,ya,ga,a,i.metadata,l)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,a,o)}}},{key:"notifyShaderTransformationChanged",value:function(){this._invalidateOctree(),this._requestUpdateCycle()}},{key:"_octree",get:function(){if(null==this._octreeCached){var e,t=this._instanceData,r=null===(e=t.view)||void 0===e?void 0:e.state;if(!r)return null;this._octreeCached=new $i(t,this.baseBoundingSphere);for(var n=0;n<t.capacity;++n)r.get(n)&Ci.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}},{key:"_invalidateOctree",value:function(){this._octreeCached=(0,vt.SC)(this._octreeCached)}},{key:"queryDepthRange",value:function(e){if(null==this._octree)return{near:1/0,far:-1/0};var t=e.viewForward,r=this._octree.findClosest(t,Ui.Z.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(t,Ui.Z.DepthOrder.BACK_TO_FRONT,e.frustum);if(null==r||null==n)return{near:1/0,far:-1/0};var i=e.eye,a=this._instanceData.view;a.boundingSphere.getVec(r,pa),(0,S.f)(pa,pa,i);var o=(0,S.m)(pa,t)-pa[3];a.boundingSphere.getVec(n,pa),(0,S.f)(pa,pa,i);var s=(0,S.m)(pa,t)+pa[3];return{near:Math.max(e.near,o),far:Math.min(e.far,s)}}},{key:"_requestUpdateCycle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}},{key:"_startUpdateCycle",value:function(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach((function(e){return e.forEach((function(e){return e.startUpdateCycle()}))}))}},{key:"running",get:function(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}},{key:"runTask",value:function(e){var t=this._enableLevelSelection,r=this._camera,n=this._levelSelector;this._allRenderInstanceData.forEach((function(e){return e.forEach((function(e){return e.beginUpdate()}))}));for(var i=this._instanceData,a=i.view,o=i.size,s=i.capacity,l=this._instanceIndex,u=Math.ceil(s/500),c=0;c<o&&!e.done;++c){l===this._cycleStartIndex&&this._startUpdateCycle();var h=a.state.get(l),d=0;if(h&Ci.ALLOCATED){var f=a.lodLevel.get(l);if(h&Ci.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][f].freeTail(),h&Ci.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][f].freeTail(),h&Ci.REMOVE)i.freeInstance(l);else if(h&Ci.VISIBLE){var v=0;t&&(a.modelOrigin.getVec(l,va),v=n.selectLevel(va,i.getCombinedMedianScaleFactor(l),r)),d=h&~(Ci.ACTIVE|Ci.TRANSFORM_CHANGED),v>=0&&(h&Ci.HIGHLIGHT?(fa(this._highlightRenderInstanceData[0][v],a,l),d|=Ci.HIGHLIGHT_ACTIVE):(fa(this._defaultRenderInstanceData[0][v],a,l),d|=Ci.DEFAULT_ACTIVE)),a.state.set(l,d),a.lodLevel.set(l,v)}else d=h&~(Ci.ACTIVE|Ci.TRANSFORM_CHANGED),a.state.set(l,d);if(null!=this._octreeCached){var p=!!(h&Ci.ACTIVE),m=!!(d&Ci.ACTIVE);!p&&m?this._octreeCached.addInstance(l):p&&!m?this._octreeCached.removeInstance(l):p&&m&&h&Ci.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(l),this._octreeCached.addInstance(l))}(l=l+1===s?0:l+1)%u==0&&e.madeProgress()}else l=l+1===s?0:l+1,o++}this._instanceIndex=l,this._allRenderInstanceData.forEach((function(e){return e.forEach((function(e){return e.endUpdate()}))})),this._context.requestRender()}},{key:"_beginComponent",value:function(e,t,r){if(0===t.size)return null;var n=r.glMaterials.load(e.rctx,e.bindParameters.slot,e.output);return null!=n?n.beginSlot(e.bindParameters):null}},{key:"_renderComponent",value:function(e,t,r,n,i){if(t){var a=e.bindParameters,o=e.rctx;o.runAppleAmdDriverHelper();var s=o.bindTechnique(t,a,n.material.parameters,ba);o.bindVAO(n.vao),t.ensureAttributeLocations(n.vao),ge.h.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===Wr.H_.Color&&(s.setUniform4fv("externalColor",_a[Math.min(i,_a.length-1)]),s.setUniform1i("colorMixMode",oa.FZ.replace));var l=r.capacity,u=r.headIndex,c=r.tailIndex,h=r.firstIndex,d=this._glInstanceBufferLayout,f=function(e,i){(0,ca.XP)(o,tn.i,r.buffer,d,e),o.drawArraysInstanced(t.primitiveType,0,n.vertexCount,i-e),(0,ca.UF)(o,tn.i,r.buffer,d)};n.material.parameters.transparent&&null!=h?u>c?((0,Xr.hu)(h>=c&&h<=u,"invalid firstIndex"),f(h,u),f(c,h)):u<c&&(h<=u?((0,Xr.hu)(h>=0&&h<=u,"invalid firstIndex"),f(h,u),f(c,l),f(0,h)):((0,Xr.hu)(h>=c&&h<=l,"invalid firstIndex"),f(h,l),f(0,u),f(c,h))):u>c?f(c,u):u<c&&(f(0,u),f(c,l)),o.bindVAO(null)}}}]),r}(Li.vO);function fa(e,t,r){var n=e.allocateHead();!function(e,t,r,n){(0,sa.EE)(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,n),r.model.copyFrom(n,e.model,t),r.modelNormal.copyFrom(n,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(n,e.color,t),e.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(n,e.objectAndLayerIdColor,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(n,e.featureAttribute,t)}(t,r,e.view,n)}(0,un._)([(0,Ri.Cb)({constructOnly:!0})],da.prototype,"symbol",void 0),(0,un._)([(0,Ri.Cb)({constructOnly:!0})],da.prototype,"optionalFields",void 0),(0,un._)([(0,Ri.Cb)({constructOnly:!0})],da.prototype,"metadata",void 0),(0,un._)([(0,Ri.Cb)({constructOnly:!0})],da.prototype,"shaderTransformation",void 0),(0,un._)([(0,Ri.Cb)()],da.prototype,"_instanceData",void 0),(0,un._)([(0,Ri.Cb)()],da.prototype,"_cycleStartIndex",void 0),(0,un._)([(0,Ri.Cb)({readOnly:!0})],da.prototype,"_enableLevelSelection",null),(0,un._)([(0,Ri.Cb)()],da.prototype,"_updateCyclesWithStaticCamera",void 0),(0,un._)([(0,Ri.Cb)({readOnly:!0})],da.prototype,"running",null),da=(0,un._)([(0,Ei.j)("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],da);var va=(0,T.Ue)(),pa=(0,gt.Ue)(),ma=(0,q.Ue)(),ya=(0,T.Ue)(),ga=(0,T.Ue)(),_a=[(0,gt.al)(1,0,1,1),(0,gt.al)(0,0,1,1),(0,gt.al)(0,1,0,1),(0,gt.al)(1,1,0,1),(0,gt.al)(1,0,0,1)],ba=new la.Qm,xa=(0,l.Z)((function e(t,r,n,i,a,o,l,u,c,h,d,f){(0,s.Z)(this,e),this.lodResources=t,this.lodRenderer=r,this.stageResources=n,this.originalMaterialParameters=i,this.resourceSize=a,this.isEsriSymbolResource=o,this.isWosr=l,this.resourceBoundingBox=u,this.symbolSize=c,this.extentPadding=h,this.physicalBasedRenderingEnabled=d,this.pivotOffset=f})),Sa=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,i,a))._resources=null,o._optionalFields=new Array,o._instanceIndexToGraphicUid=new Map,o._hasLoadedPBRTextures=!1,o._disposeResourceHandles=new Array,o.skipHighSymbolLodsChanged=!1,o.ensureDrapedStatus(!1),o._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled,o}return(0,l.Z)(r,[{key:"getCachedSize",value:function(){var e=null!=this._resources?this._resources.symbolSize:[1,1,1],t=(0,dt.Z)(e,3);return{width:t[0],depth:t[1],height:t[2]}}},{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o,s,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=3;break}if(!(0,ne.bh)(this.symbolLayer)){e.next=3;break}throw new Error;case 3:if(!this._isPrimitive){e.next=10;break}return r=this.symbolLayer.resource,n=r&&(0,bi.F)(null===r||void 0===r?void 0:r.primitive)?r.primitive:ai.S,e.next=7,this._createResourcesForPrimitive(n,t);case 7:this._resources=e.sent,e.next=17;break;case 10:return e.next=12,wi(this.symbol.styleOrigin);case 12:return s=e.sent,l=null!==(i=null===s||void 0===s?void 0:s.href)&&void 0!==i?i:null===(o=this.symbolLayer.resource)||void 0===o?void 0:o.href,e.next=16,this._createResourcesForUrl(l,t);case 16:this._resources=e.sent;case 17:this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity();case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extentPadding",get:function(){return null!=this._resources?this._resources.extentPadding:0}},{key:"_isPrimitive",get:function(){var e;return!(null!==(e=this.symbolLayer.resource)&&void 0!==e&&e.href)}},{key:"lodRenderer",get:function(){var e;return null===(e=this._resources)||void 0===e?void 0:e.lodRenderer}},{key:"materials",get:function(){var e,t;return null!==(e=null===(t=this._resources)||void 0===t?void 0:t.stageResources.materials)&&void 0!==e?e:[]}},{key:"_setMaterialTransparencyParameters",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===(t=this.symbolLayer)||void 0===t||null===(r=t.material)||void 0===r?void 0:r.color,i=this._getCombinedOpacity(n),a=i<1||this.needsDrivenTransparentPass;return e.transparent=a,e.opacity=i,e.cullFace=a?Le.Vr.None:Le.Vr.Back,e}},{key:"_createResourcesForPrimitive",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,o,s,l,u,c,h,d,f,v,m,y,g,_,b,x,w,P,O,R,E;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.symbolLayer,o=(0,C.Ue)((0,oi.Uz)(t)),s=(0,T.nI)((0,C.dp)(o)),l=(0,T.nI)((0,oi.$K)(s,n)),u=(0,S.l)(l),c=!1,h=!1,d={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:(0,i.Z)(Ln.yI),ambient:T.hq,diffuse:T.hq,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},f=!!d.usePBR,this._setMaterialTransparencyParameters(d),"point-3d"===(v=this.symbol).type&&v.verticalOffset&&(m=v.verticalOffset,y=m.screenLength,g=m.minWorldLength,_=m.maxWorldLength,d.verticalOffset={screenLength:(0,pt.F2)(y),minWorldLength:g||0,maxWorldLength:null!=_?_:1/0},d.castShadows=!1),this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color?d.externalColor=gt.hq:(b=null!=n.material?n.material.color:null,x=null!=b?ft.Z.toUnitRGBA(b):gt.hq,d.externalColor=x),this._fastUpdates=(0,zt.vT)(this._context.renderer,this._fastVisualVariableConvertOptions(o,l,s,null)),d.isInstanced=!0,this._fastUpdates?(Object.assign(d,this._fastUpdates.materialParameters),this._optionalFields.push(ce.T.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(d.hasInstancedColor=!0,this._optionalFields.push(ce.T.COLOR)),(0,p.Z)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(ce.T.OBJECTANDLAYERIDCOLOR),w=new De.Gp(d),P=(0,bi.t)(t,w)){e.next=9;break}throw new Error("Unknown object symbol primitive: ".concat(t));case 9:return O=(0,pi.aH)(P).map((function(e){return{opacity:1,transparent:e.parameters.transparent}})),e.next=12,this._createStageResources(P,f,r);case 12:return R=e.sent,e.next=15,this._createLodRenderer(P,r);case 15:return E=e.sent,e.abrupt("return",new xa(P,E,R,O,s,c,h,o,l,u,f,null));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createResourcesForUrl",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i,o,s,l,u,c,h,d,f,v,m,y,g,_,b,x,w,P,O,R,E,k,A,Z,L,I,U,M;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={materialParameters:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache},this._fastUpdates=(0,zt.vT)(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(o.materialParameters,this._fastUpdates.materialParameters),this._optionalFields.push(ce.T.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(o.materialParameters.hasInstancedColor=!0,this._optionalFields.push(ce.T.COLOR)),(0,p.Z)("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(ce.T.OBJECTANDLAYERIDCOLOR),"point-3d"===(s=this.symbol).type&&s.verticalOffset&&(l=s.verticalOffset,u=l.screenLength,c=l.minWorldLength,h=l.maxWorldLength,o.materialParameters.verticalOffset={screenLength:(0,pt.F2)(u),minWorldLength:c||0,maxWorldLength:null!=h?h:1/0},o.materialParameters.castShadows=!1),d=this._context.physicalBasedRenderingEnabled,o.signal=r,o.usePBR=d,o.skipHighLods=this._context.skipHighSymbolLods,e.next=8,(0,_i.fetch)(t,o);case 8:return f=e.sent,v=f.isEsriSymbolResource,m=f.isWosr,y=yi(f.lods),g=this._context,_=this.symbolLayer.material,b=this._getExternalColorParameters(_),x=null===(n=this.symbolLayer)||void 0===n||null===(i=n.material)||void 0===i?void 0:i.color,w=this._getCombinedOpacity(x,{hasIntrinsicColor:!0}),P=this.needsDrivenTransparentPass,O=(0,pi.aH)(y),R=(0,pi.aH)(y).map((function(e){return{opacity:e.parameters.opacity||1,transparent:e.parameters.transparent}})),O.forEach((function(e){var t=e.parameters;e.setParameters(b);var r=t.opacity*w,n=r<1||P||t.transparent;e.setParameters({opacity:r,transparent:n}),g.screenSizePerspectiveEnabled&&e.setParameters({screenSizePerspective:g.sharedResources.screenSizePerspectiveSettings})})),E=f.referenceBoundingBox,k=(0,T.nI)((0,C.dp)(E)),A=(0,T.nI)(y.levels[0].pivotOffset),Z=(0,T.nI)((0,oi.$K)(k,this.symbolLayer)),L=(0,S.l)(Z),I=this._fastUpdates,(0,zt.Tc)(I,this._context.renderer,this._fastVisualVariableConvertOptions(E,Z,k,A))&&O.forEach((function(e){return e.setParameters(I.materialParameters)})),e.next=25,this._createStageResources(y,d,r);case 25:return U=e.sent,e.next=28,this._createLodRenderer(y,r);case 28:return M=e.sent,e.abrupt("return",new xa(y,M,U,R,k,v,m,E,Z,L,d,A));case 30:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_addDisposeResource",value:function(e){this._disposeResourceHandles.push(e)}},{key:"_createStageResources",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n){var i,o,s,l,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._context.stage,o=(0,pi.aH)(t),r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),i.addMany(o),this._addDisposeResource((function(){return i.removeMany(o)})),s=(0,pi.VQ)(t),i.addMany(s),this._addDisposeResource((function(){s.forEach((function(e){return e.unload()})),i.removeMany(s)})),e.next=7,Promise.all(s.map((function(e){return u._context.stage.schedule((function(){return e.load(i.renderView.renderingContext)}),n)})));case 7:return(0,m.k_)(n),l=(0,pi.ci)(t),e.abrupt("return",(i.addMany(l),this._addDisposeResource((function(){return i.removeMany(l)})),{materials:o,textures:s,geometries:l}));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_createLodRenderer",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i,o,s,l,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._context.stage,i={layerUid:this._context.layer.uid,graphicUid:function(e){return u._instanceIndexToGraphicUid.get(e)},notifyGraphicGeometryChanged:function(e){return u._context.notifyGraphicGeometryChanged(u._instanceIndexToGraphicUid.get(e))},notifyGraphicVisibilityChanged:function(e){return u._context.notifyGraphicVisibilityChanged(u._instanceIndexToGraphicUid.get(e))}},o=this._fastUpdates,s=o?{applyTransform:function(e,t,r){e.getFeatureAttribute(t,Ra),(0,W.JG)(r,(0,zt.z2)(o.materialParameters,Ra,r))},scaleFactor:function(e,t,r){t.getFeatureAttribute(r,Ra),(0,zt.FE)(e,o.materialParameters,Ra)}}:null,(l=new da({symbol:t,optionalFields:this._optionalFields,metadata:i,shaderTransformation:s},this._context.scheduler)).slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource((function(){n.removeRenderPlugin(l),l.destroy()})),e.next=5,n.addRenderPlugin(l,r);case 5:return e.abrupt("return",l);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getExternalColorParameters",value:function(e){var t={};return this._drivenProperties.color?t.externalColor=gt.hq:null!=(null===e||void 0===e?void 0:e.color)?t.externalColor=ft.Z.toUnitRGBA(e.color):(t.externalColor=gt.hq,t.colorMixMode="ignore"),t}},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._cleanupResources()}},{key:"_cleanupResources",value:function(){this._disposeResourceHandles.forEach((function(e){return e()})),this._disposeResourceHandles.length=0,this._resources=null}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var r=(0,Dt.S_)(t.geometry);if(null==r)return this.logger.warn("unsupported geometry type for icon symbol: ".concat(t.geometry.type)),null;var n=this.setGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,r,i,n,t.uid,e.layer.uid)}},{key:"notifyDestroyGraphicLayer",value:function(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}},{key:"graphicLayerToGraphicId",value:function(){return 0}},{key:"layerOpacityChanged",value:function(){if(null!=this._resources)for(var e=this._drivenProperties.opacity,t=!this._isPrimitive,r=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters,i=0;i<r.length;i++){var a,o,s=r[i],l=null===(a=this.symbolLayer)||void 0===a||null===(o=a.material)||void 0===o?void 0:o.color,u=n[i],c=this._getCombinedOpacity(l,{hasIntrinsicColor:t})*u.opacity,h=c<1||e||u.transparent;s.setParameters({opacity:c,transparent:h}),this._isPrimitive&&s.setParameters({cullFace:h?Le.Vr.None:Le.Vr.Back})}}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,te.B5)}},{key:"slicePlaneEnabledChanged",value:function(){if(null==this._resources)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;var e,t=(0,n.Z)(this._resources.stageResources.materials);try{for(t.s();!(e=t.n()).done;){e.value.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}}catch(r){t.e(r)}finally{t.f()}return!0}},{key:"physicalBasedRenderingChanged",value:function(){if(null==this._resources)return!0;var e,t=this._resources,r=t.stageResources,i=t.isWosr,a=(0,n.Z)(r.materials);try{for(a.s();!(e=a.n()).done;){var o=e.value;this._isPrimitive?o.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||o.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1})}}catch(s){a.e(s)}finally{a.f()}return!1!==this._hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this._hasLoadedPBRTextures=!0,!1)}},{key:"applyRendererDiff",value:function(e,t){if(null==this._resources)return ie.W.RecreateSymbol;var r=this._resources,i=r.stageResources.materials,a=r.lodRenderer,o=r.resourceBoundingBox,s=r.symbolSize,l=r.resourceSize,u=r.pivotOffset;for(var c in e.diff){if("visualVariables"!==c)return ie.W.RecreateSymbol;if(!(0,zt.Tc)(this._fastUpdates,t,this._fastVisualVariableConvertOptions(o,s,l,u)))return ie.W.RecreateSymbol;var h,d=(0,n.Z)(i);try{for(d.s();!(h=d.n()).done;){h.value.setParameters(this._fastUpdates.materialParameters)}}catch(f){d.e(f)}finally{d.f()}a.notifyShaderTransformationChanged()}return ie.W.FastUpdate}},{key:"computeComplexity",value:function(){if(null==this._resources)return(0,u.Z)((0,c.Z)(r.prototype),"computeComplexity",this).call(this);var e=this._resources.lodResources,t=(0,y.iu)(e.levels),n=(0,pi.ci)(e).reduce((function(e,t){return e+function(e){return Array.from(e.attributes.values()).reduce((function(e,t){return e+(0,ii.Xw)(t.data,t.indices)}),0)}(t)}),0),i=(0,pi.VQ)(e).reduce((function(e,t){return e+t.memoryEstimate}),0)+n,a=(0,N.Z)((0,N.Z)({},(0,y.BN)(this.symbol,this.symbolLayer)),{},{resourceBytes:i});return new xi.eH({verticesPerFeature:t,memory:a})}},{key:"_hasLodRenderer",value:function(){return null!=this._resources}},{key:"_createAs3DShape",value:function(e,t,r,n,i,a){if(!this._hasLodRenderer()||null==this._resources)return null;var o=this.getFastUpdateAttrValues(e),s=this._context.clippingExtent;if((0,_t.K)(t,Pa,this._context.elevationProvider.spatialReference),null!=s&&!(0,C.BD)(s,Pa))return null;var l=wa(n),u=this._computeGlobalTransform(t,n,Oa,Ea),c=this._computeLocalTransform(this._resources,this.symbolLayer,r,Ca),h=this._resources.lodRenderer.instanceData,d=h.addInstance();this._instanceIndexToGraphicUid.set(d,i),h.setLocalTransform(d,c,!1),h.setGlobalTransform(d,u),o&&h.setFeatureAttribute(d,o),null==this._fastUpdates&&this._hasPerInstanceColor()&&h.setColor(d,(0,ne.Uu)(r.color,r.opacity,255)),null!=this._context.stage.renderView.objectAndLayerIdRenderHelper&&h.setObjectAndLayerIdColor(d,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:i,layerUid:a}));var f=new li(this,d,kt.RX,n);return l&&(f.alignedSampledElevation=Ea.sampledElevation),f.needsElevationUpdates=(0,te.B5)(n.mode),(0,Dt.dO)(f,t,this._context.elevationProvider),f}},{key:"_computeGlobalTransform",value:function(e,t,r,n){return(0,te.qZ)(e,this._context.elevationProvider,t,this._context.renderCoordsHelper,n),Pa[0]=e.x,Pa[1]=e.y,Pa[2]=n.z,(0,J.B)(e.spatialReference,Pa,r,this._context.renderCoordsHelper.spatialReference),r}},{key:"_computeLocalTransform",value:function(e,t,r,n){return(0,W.yR)(n),this._applyObjectRotation(r,!1,n),this._applyObjectRotation(t,!0,n),this._applyObjectScale(e,r,n),this._applyAnchor(e,t,n),n}},{key:"_applyObjectScale",value:function(e,t,r){var n;if(null===(n=this._fastUpdates)||void 0===n||!n.requiresShaderTransformation){var i=this._drivenProperties.size&&t.size?t.size:e.symbolSize,a=(0,ne.bD)(i,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===a[0]&&1===a[1]&&1===a[2]||(0,W.bA)(r,r,a)}}},{key:"prepareSymbolLayerPatch",value:function(e){if("partial"===e.diff.type){var t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}}},{key:"updateGeometry",value:function(e,t){if(null==this._resources)return!0;var r=t&&(0,Dt.S_)(t);if(null==r)return!1;var n=this.getGeometryElevationMode(t);return e.elevationContext.mode===n&&(this._computeGlobalTransform(r,e.elevationContext,Oa,Ea),wa(e.elevationContext)&&(e.alignedSampledElevation=Ea.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,Oa,!0),(0,Dt.dO)(e,r,this._context.elevationProvider),!0)}},{key:"_preparePatchTransform",value:function(e,t){var r=this;if((t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition)&&null!=this._resources){var n=function(e,t,r){var n;return null!==(n=null!=e&&"complete"===e.type?e.newValue:t)&&void 0!==n?n:r},i=n(t.heading,this.symbolLayer.heading,0),a=n(t.tilt,this.symbolLayer.tilt,0),o=n(t.roll,this.symbolLayer.roll,0),s=n(t.width,this.symbolLayer.width,void 0),l=n(t.height,this.symbolLayer.height,void 0),u=n(t.depth,this.symbolLayer.depth,void 0),c=n(t.anchor,this.symbolLayer.anchor,void 0),h=n(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;var d={heading:i,tilt:a,roll:o,anchor:c,anchorPosition:h},f=this._resources;this.loadStatus===vi.P.LOADED&&e.symbolLayerStatePatches.push((function(){f.symbolSize=(0,T.nI)((0,oi.$K)(f.resourceSize,{width:s,height:l,depth:u,isPrimitive:r.symbolLayer.isPrimitive}))})),e.graphics3DGraphicPatches.push((function(e,t){var n=r._computeLocalTransform(f,d,t,Ca),i=e.instanceIndex;f.lodRenderer.instanceData.setLocalTransform(i,n,!0)}))}}},{key:"_preparePatchColor",value:function(e,t){var r=this;if(t.material&&"partial"===t.material.type){var i=t.material.diff;if(i.color&&"complete"===i.color.type&&null!=i.color.newValue&&null!=i.color.oldValue){var a=i.color.newValue,o=null!=a?ft.Z.toUnitRGBA(a):gt.hq;delete i.color;var s=this._resources;null!=s&&e.graphics3DGraphicPatches.push((function(e){var t;r._hasPerInstanceColor()?(s.lodRenderer.instanceData.setColor(e.instanceIndex,o),t=r._setMaterialTransparencyParameters({},a)):t=r._setMaterialTransparencyParameters({externalColor:o},a);var i,l=(0,n.Z)(s.stageResources.materials);try{for(l.s();!(i=l.n()).done;){i.value.setParameters(t)}}catch(u){l.e(u)}finally{l.f()}}))}}}},{key:"_applyObjectRotation",value:function(e,t,r){var n;if(null===(n=this._fastUpdates)||void 0===n||!n.requiresShaderTransformation||!t)return(0,ne._Z)(e.heading,e.tilt,e.roll,r)}},{key:"_applyAnchor",value:function(e,t,r){var n;if(null===(n=this._fastUpdates)||void 0===n||!n.requiresShaderTransformation){var i=Ta(e.resourceBoundingBox,e.pivotOffset,t);i&&(0,W.Iu)(r,r,i)}}},{key:"_hasPerInstanceColor",value:function(){return this._drivenProperties.color||this._drivenProperties.opacity}},{key:"_fastVisualVariableConvertOptions",value:function(e,t,r,n){var i=null!=e?(0,T.nI)((0,C.dp)(e)):T.hq,a=null!=e?Ta(e,n,this.symbolLayer):T.AG,o=this._context.renderCoordsHelper.unitInMeters,s=(0,ne.bD)(null!=t?t:void 0,t,r,o),l=(0,T.al)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new zt.Z3({size:!0,color:!0,rotation:!0,opacity:!1},i,null!==t&&void 0!==t?t:T.hq,o,a,s,l)}}]),r}(re.k);function Ta(e,t,r){var n=(0,T.Ue)();switch(r.anchor){case"center":(0,S.c)(n,(0,C.be)(e)),(0,S.k)(n,n);break;case"top":var i=(0,C.be)(e);(0,S.s)(n,-i[0],-i[1],-e[5]);break;case"bottom":var a=(0,C.be)(e);(0,S.s)(n,-a[0],-a[1],-e[2]);break;case"relative":var o=(0,C.be)(e),s=(0,C.dp)(e),l=r.anchorPosition,u=l?(0,T.al)(l.x,l.y,l.z):T.AG;(0,S.B)(n,s,u),(0,S.g)(n,n,o),(0,S.k)(n,n);break;default:null!=t?(0,S.k)(n,t):(0,S.c)(n,T.AG)}return n}function wa(e){return"absolute-height"!==e.mode}var Pa=(0,T.Ue)(),Ca=(0,q.Ue)(),Oa=(0,q.Ue)(),Ra=(0,gt.Ue)(),Ea=new te.Lm,ka=r(53727),Aa=function(){function e(t,r,n,i){(0,s.Z)(this,e),this.vertices=t,this.positionsES=r,this.offset=i;var a=t.length,o=Math.floor(a/2),l=this.offset+3*o,u=n[l],c=n[l+1],h=n[l+2];this.origin=(0,T.al)(u,c,h),this.positions=(0,br.xx)(3*a);for(var d=this.offset+3*a,f=this.offset;f<d;f+=3)this.positions[f]=n[f]-u,this.positions[f+1]=n[f+1]-c,this.positions[f+2]=n[f+2]-h;this.updatePathVertexInformation()}return(0,l.Z)(e,[{key:"usedMemory",get:function(){return(0,ii.Xw)(this.positions)}},{key:"updatePathVertexInformation",value:function(){var e=this.vertices.length,t=this.vertices[0],r=this.offset,n=this.positions;t.vRight[0]=n[r+3]-n[r],t.vRight[1]=n[r+4]-n[r+1],t.vRight[2]=n[r+5]-n[r+2],r+=3;var i=(0,S.l)(t.vRight);t.vMinSiblingLength=i,(0,S.n)(t.vRight,t.vRight);for(var a=t,o=1;o<e;++o){var s=this.vertices[o];if(s.vLeft=a.vRight,o<e-1){s.vRight[0]=n[r+3]-n[r],s.vRight[1]=n[r+4]-n[r+1],s.vRight[2]=n[r+5]-n[r+2];var l=(0,S.l)(s.vRight);s.vMinSiblingLength=Math.min(i,l),i=l,(0,S.n)(s.vRight,s.vRight)}else(0,S.c)(s.vRight,s.vLeft),s.vMinSiblingLength=i;a=s,r+=3}}}]),e}(),Za=function(){function e(t,r,n,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};(0,s.Z)(this,e),this.path=t,this.profile=r,this.extruder=n,this.startCap=i,this.endCap=a,this.options=o,this._extrusionVertexCount=0;var l=this.path.vertices.length-2;this.numExtrusionProfiles=n.numProfilesPerJoin()*l+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;var u=this.startCap.numVertices;this.numVerticesTotal+=u,this.endCap.vertexBufferStart=this.numVerticesTotal;var c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=(0,X.X9)(1*this.numVerticesTotal),this.profileRightAxes=(0,br.xx)(4*this.numVerticesTotal),this.profileUpAxes=(0,br.xx)(4*this.numVerticesTotal),this.profileVertexAndNormals=(0,br.xx)(4*this.numVerticesTotal),this.positions=(0,br.AA)(t.positions,t.offset,3*t.vertices.length),this._rebuildGeometry(),this.buildTopology()}return(0,l.Z)(e,[{key:"usedMemory",get:function(){return(0,ii.Xw)(this.pathVertexData,this.profileRightAxes,this.profileUpAxes,this.profileVertexAndNormals)+this.path.usedMemory+this.profile.usedMemory}},{key:"emitVertex",value:function(e,t,r,n,i){var a=4*this._extrusionVertexCount;if(this.profileRightAxes[a]=t.right[0],this.profileRightAxes[a+1]=t.right[1],this.profileRightAxes[a+2]=t.right[2],this.profileUpAxes[a]=t.up[0],this.profileUpAxes[a+1]=t.up[1],this.profileUpAxes[a+2]=t.up[2],this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,i){var o=this.path.vertices[e],s=o.maxStretchDistance;this.profileRightAxes[a+3]=o.rotationRight[0]*s,this.profileUpAxes[a+3]=o.rotationRight[1]*s}else this.profileRightAxes[a+3]=0,this.profileUpAxes[a+3]=0;++this._extrusionVertexCount}},{key:"emitCapVertex",value:function(e,t,r,n,i,a){var o=4*this._extrusionVertexCount;this.profileRightAxes[o]=t.right[0],this.profileRightAxes[o+1]=t.right[1],this.profileRightAxes[o+2]=t.right[2],this.profileRightAxes[o+3]=i,this.profileUpAxes[o]=t.up[0],this.profileUpAxes[o+1]=t.up[1],this.profileUpAxes[o+2]=t.up[2],this.profileUpAxes[o+3]=a,this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}},{key:"_rebuildGeometry",value:function(){var e=this;this._extrusionVertexCount=0;var t=this.path,r=t.positions,n=t.offset,i=t.vertices;this.positions=(0,br.AA)(r,n,3*i.length);var a=0,o=function(t,r,n,i,o){return e.emitCapVertex(a,t,r,n,i,o)},s=function(t,r,n,i){return e.emitVertex(a,t,r,n,i)};for(this.startCap.rebuildConnectingProfileGeometry(i[a],this.profile,o),a=1;a<i.length-1;++a)this.extruder.extrude(i[a],this.profile,s);this.endCap.rebuildConnectingProfileGeometry(i[a],this.profile,o),a=0,this.startCap.rebuildCapGeometry(i[a],o),a=i.length-1,this.endCap.rebuildCapGeometry(i[a],o)}},{key:"buildTopology",value:function(){var e=this,t=this.profile.vertices.length,r=this.profile.numSegments,n=this.numExtrusionProfiles-1,i=r*n*2*3;this.startCap.indexBufferStart=i,this.startCap.firstProfileVertexIndex=0,i+=this.startCap.numIndices,this.endCap.indexBufferStart=i,this.endCap.firstProfileVertexIndex=t*(this.numExtrusionProfiles-1);for(var a=new Array,o=new Array,s=new Array,l=function(t,r,n){a.push(t),a.push(r),a.push(n),o.push(t),o.push(r),o.push(n),s.push(e.pathVertexData[t]),s.push(e.pathVertexData[r]),s.push(e.pathVertexData[n])},u=0;u<r;++u)for(var c=this.profile.indices[2*u],h=this.profile.indices[2*u+1],d=0;d<n;++d){var f=d*t+c,v=(d+1)*t+h,p=d*t+h;l(f,(d+1)*t+c,v),l(f,v,p)}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=(0,X.mi)(a),this.normalIndices=(0,X.mi)(o),this.pathVertexIndices=(0,X.mi)(s)}},{key:"onPathChanged",value:function(){this._rebuildGeometry()}}]),e}(),La=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"rebuildConnectingProfileGeometry",value:function(e,t,r){for(var n=0;n<t.vertices.length;++n)r(e.frame,t.vertices[n],t.normals[n],0,0)}}]),e}(),Ia=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.call(this)).numVertices=0,e.numIndices=0,e}return(0,l.Z)(r,[{key:"rebuildCapGeometry",value:function(){}},{key:"buildTopology",value:function(){}}]),r}(La),Ua=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,s.Z)(this,r),(n=t.call(this)).profile=e,n.profilePlaneOffset=i,n.flip=a,n}return(0,l.Z)(r,[{key:"numVertices",get:function(){return this.profile.vertices.length}},{key:"numIndices",get:function(){return 3*this.profile.numSegments}},{key:"rebuildConnectingProfileGeometry",value:function(e,t,r){for(var n=this.profilePlaneOffset,i=0;i<t.vertices.length;++i)r(e.frame,t.vertices[i],t.normals[i],n,0)}},{key:"rebuildCapGeometry",value:function(e,t){var r=this.profile,n=this.flip?1:-1,i=this.profilePlaneOffset,a=za;(0,b.t8)(a,0,0);for(var o=0;o<r.vertices.length;++o)t(e.frame,r.vertices[o],a,i,n)}},{key:"buildTopology",value:function(e,t){for(var r=this.profile,n=this.vertexBufferStart+r.indices[0],i=1;i<r.numSegments;++i){var a=r.indices[2*i],o=r.indices[2*i+1],s=this.vertexBufferStart+a,l=this.vertexBufferStart+o;this.flip?t(l,s,n):t(n,s,l)}}}]),r}(La),Ma=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this)).flip=!1,n.sign=0,n.breakNormals=!1,n.numSegments=3,n.profile=e.profile,n.flip=e.flip,n.sign=n.flip?1:-1,n.breakNormals=e.breakNormals,n.numSegments=e.subdivisions,n}return(0,l.Z)(r,[{key:"numVertices",get:function(){var e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}},{key:"numIndices",get:function(){var e=0,t=this.profile;e+=2*t.numSegments*(this.numSegments-1);for(var r=0;r<t.numSegments;++r){var n=t.indices[2*r],i=t.indices[2*r+1];t.poleIndices[n]===t.poleIndices[i]?e+=1:e+=2}return 3*e}},{key:"rebuildCapGeometry",value:function(e,t){var r=this.profile,i=e.frame,a=.5*this.sign,o=Da,s=za;(0,b.t8)(s,0,0);var l,u=(0,n.Z)(r.poles);try{for(u.s();!(l=u.n()).done;){var c=l.value;c.normal?t(i,c.position,c.normal,a,0):t(i,c.position,s,a,this.sign)}}catch(g){u.e(g)}finally{u.f()}if(this.breakNormals)for(var h=0;h<r.vertices.length;++h)t(i,r.vertices[h],r.normals[h],0,0);for(var d=0;d<this.numSegments-1;++d)for(var f=(1-(d+1)/this.numSegments)*Math.PI*.5,v=Math.sin(f),p=Math.cos(f),m=0;m<r.vertices.length;++m){var y=r.poles[r.poleIndices[m]];(0,b.$X)(o,r.vertices[m],y.position),(0,b.bA)(o,o,v),y.normal?((0,b.IH)(o,o,y.position),t(i,o,y.normal,a*p,0)):((0,b.Fv)(s,o),(0,b.bA)(s,s,v),(0,b.IH)(o,o,y.position),t(i,o,s,a*p,this.sign*p))}}},{key:"buildTopology",value:function(e,t){for(var r=this.profile,n=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,i=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length,a=0;a<r.numSegments;++a){for(var o=r.indices[2*a],s=r.indices[2*a+1],l=this.vertexBufferStart+r.poleIndices[o],u=this.vertexBufferStart+r.poleIndices[s],c=n+o,h=n+s,d=0;d<this.numSegments-1;++d){var f=i+d*r.vertices.length+o,v=i+d*r.vertices.length+s;this.flip?(t(f,h,c),t(h,f,v)):(t(c,h,f),t(v,f,h)),c=f,h=v}this.flip?(t(l,h,c),l!==u&&t(l,u,h)):(t(c,h,l),l!==u&&t(h,u,l))}}}]),r}(La),Da=(0,x.Ue)(),za=(0,x.Ue)(),Na=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"numProfilesPerJoin",value:function(){return 1}},{key:"extrude",value:function(e,t,r){for(var n=0;n<t.vertices.length;++n)r(e.frame,t.vertices[n],t.normals[n],!1)}}]),e}(),Fa=function(){function e(t,r){(0,s.Z)(this,e),this.cutoffAngle=t,this.numBendSubdivisions=r}return(0,l.Z)(e,[{key:"numProfilesPerJoin",value:function(){return this.numBendSubdivisions+1}},{key:"extrude",value:function(e,t,r){var n=Wa,i=e.rotationAngle,a=e.rotationRight,o=e.frame;if(Math.abs(i)>=this.cutoffAngle)for(var s=e.rotationFrameUp,l=0;l<this.numBendSubdivisions+1;++l){(0,W.Us)(ja,.5*-i+l*i/this.numBendSubdivisions,s),Ha(n,o,ja);for(var u=0;u<t.vertices.length;++u)(0,b.AK)(t.vertices[u],a)*i>=0?r(n,t.vertices[u],t.normals[u],!1):r(o,e.applyMiterStretch(Ba,t.vertices[u]),t.normals[u],!0)}else for(var c=0;c<this.numBendSubdivisions+1;++c)for(var h=0;h<t.vertices.length;++h){var d=(0,b.AK)(t.vertices[h],a)*i>=0;r(o,e.applyMiterStretch(Ba,t.vertices[h]),t.normals[h],!d)}}}]),e}(),Va=(0,l.Z)((function e(){(0,s.Z)(this,e),this.up=(0,T.Ue)(),this.right=(0,T.Ue)()}));function Ha(e,t,r){(0,S.h)(e.up,t.up,r),(0,S.h)(e.right,t.right,r)}var Ga,Ba=(0,x.Ue)(),ja=(0,q.Ue)(),Wa=new Va,qa=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a,o,l){var u;return(0,s.Z)(this,r),(u=t.call(this,e,n,null,le.U.Mesh,l)).path=i,u.geometrySR=a,u.stencilWidth=o,u}return(0,l.Z)(r)}(ue.Z);function Ja(e){return"path"in e}!function(e){e[e.World=0]="World",e[e.Path=1]="Path"}(Ga||(Ga={}));var Ya=r(42235),Xa=function(){function e(t){(0,s.Z)(this,e),this.builder=t}return(0,l.Z)(e,[{key:"onPathChanged",value:function(e){this.builder.onPathChanged()}}]),e}(),Ka=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).vertexAttributeColor=(0,gt.al)(255,255,255,255),n.size=new Array,n.vertexAttributePosition=(0,br.xx)(3*n.builder.numVerticesTotal),n.vertexAttributeNormal=new Int16Array(2*n.builder.numVerticesTotal),n}return(0,l.Z)(r,[{key:"bakeVertexColors",value:function(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}},{key:"bake",value:function(e){this.size=e;for(var t=this.builder,r=t.numVerticesTotal,n=t.pathVertexData,i=t.path,a=t.positions,o=t.profileRightAxes,s=t.profileUpAxes,l=t.profileVertexAndNormals,u=0;u<r;++u){var c=n[u],h=0===c||c===i.vertices.length-1;c*=3;var d=no,f=0,v=0,p=4*u,m=(0,S.s)(io,o[p],o[p+1],o[p+2]),y=(0,S.s)(ao,s[p],s[p+1],s[p+2]),g=(0,b.t8)(Qa,l[p]*e[0],l[p+1]*e[1]);if(h)(0,S.b)(d,y,m),f=o[p+3]*e[0],v=s[p+3];else{var _=eo,x=to;(0,b.t8)(_,o[p+3],s[p+3]);var T=(0,b.kE)(_);(0,b.Fv)(_,_);var w=(0,b.AK)(g,_);if(Math.abs(w)>T){(0,b.t8)(x,-_[1],_[0]);var P=(0,b.AK)(g,x);(0,b.bA)(_,_,T*Math.sign(w)),(0,b.bA)(x,x,P),(0,b.IH)(g,_,x)}(0,S.s)(d,0,0,0)}var C=(0,S.s)(ro,m[0]*g[0]+y[0]*g[1],m[1]*g[0]+y[1]*g[1],m[2]*g[0]+y[2]*g[1]),O=3*u;this.vertexAttributePosition[O]=a[c]+C[0]+d[0]*f,this.vertexAttributePosition[O+1]=a[c+1]+C[1]+d[1]*f,this.vertexAttributePosition[O+2]=a[c+2]+C[2]+d[2]*f;var R=(0,b.t8)(Qa,l[p+2],l[p+3]);(0,Ue.hd)(this.vertexAttributeNormal,u,m[0]*R[0]+y[0]*R[1]+d[0]*v,m[1]*R[0]+y[1]*R[1]+d[1]*v,m[2]*R[0]+y[2]*R[1]+d[2]*v)}}},{key:"createGeometryData",value:function(){var e=this.builder.vertexIndices.length,t=this.builder,r=t.normalIndices,n=t.vertexIndices;return[[ce.T.POSITION,new se.a(this.vertexAttributePosition,n,3,!0)],[ce.T.NORMALCOMPRESSED,new se.a(this.vertexAttributeNormal,r,2,!0)],[ce.T.COLOR,new se.a(this.vertexAttributeColor,(0,X.LE)(e),4)]]}},{key:"onPathChanged",value:function(e){(0,u.Z)((0,c.Z)(r.prototype),"onPathChanged",this).call(this,e),this.bake(this.size)}},{key:"intersect",value:function(e,t,r,n){var i=this.builder.vertexIndices,a=new se.U(this.vertexAttributePosition,3),o=i.length/3;(0,Ya.CN)(e,t,0,o,i,a,void 0,r,(function(e,t,r){n(e,r,t,!1)}))}}]),r}(Xa),$a=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;(0,s.Z)(this,r),(o=t.call(this,e)).sizeAttributeValue=n,o.colorAttributeValue=i,o.opacityAttributeValue=a,o.vvData=null,o.baked=new Ka(e),o.vvData=(0,br.xx)(4*o.builder.path.vertices.length);for(var l=0;l<o.builder.path.vertices.length;++l){o.vvData[4*l]=n,o.vvData[4*l+1]=i,o.vvData[4*l+2]=a;var u=0===l||l===o.builder.path.vertices.length-1;o.vvData[4*l+3]=u?1:0}return o}return(0,l.Z)(r,[{key:"createGeometryData",value:function(){var e=this.builder,t=e.positions,r=e.profileRightAxes,n=e.profileUpAxes,i=e.profileVertexAndNormals,a=e.pathVertexIndices,o=e.vertexIndices;return[[ce.T.POSITION,new se.a(t,a,3,!0)],[ce.T.PROFILERIGHT,new se.a(r,o,4,!0)],[ce.T.PROFILEUP,new se.a(n,o,4,!0)],[ce.T.PROFILEVERTEXANDNORMAL,new se.a(i,o,4,!0)],[ce.T.FEATUREVALUE,new se.a(this.vvData,a,4,!0)]]}},{key:"onPathChanged",value:function(e){(0,u.Z)((0,c.Z)(r.prototype),"onPathChanged",this).call(this,e);var t=e.getMutableAttribute(ce.T.POSITION);t&&(t.data=this.builder.positions)}}]),r}(Xa),Qa=(0,x.Ue)(),eo=(0,x.Ue)(),to=(0,x.Ue)(),ro=(0,T.Ue)(),no=(0,T.Ue)(),io=(0,T.Ue)(),ao=(0,T.Ue)(),oo=r(40885);var so=(0,T.Ue)(),lo=function(){function e(){(0,s.Z)(this,e),this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}return(0,l.Z)(e,[{key:"addVertex",value:function(e,t){return this.vertices.push((0,x.d9)(e)),this.normals.push((0,x.d9)(t)),this.vertices.length-1}},{key:"addPole",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.poles.push({position:(0,x.d9)(e),normal:t?(0,x.d9)(t):null}),this.poles.length-1}},{key:"addSegment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.indices.push(e.v0),this.indices.push(e.v1),t&&(this.poleIndices.push(t.v0),this.poleIndices.push(t.v1))}},{key:"numSegments",get:function(){return this.indices.length/2}},{key:"translate",value:function(e,t){var r,i=(0,n.Z)(this.vertices);try{for(i.s();!(r=i.n()).done;){var a=r.value;a[0]+=e,a[1]+=t}}catch(u){i.e(u)}finally{i.f()}var o,s=(0,n.Z)(this.poles);try{for(s.s();!(o=s.n()).done;){var l=o.value;l.position[0]+=e,l.position[1]+=t}}catch(u){s.e(u)}finally{s.f()}}},{key:"usedMemory",get:function(){return this.vertices.length*(0,ii.Xw)(this.vertices[0])*2+(0,ii.Xw)(this.indices)}}]),e}(),uo={top:[0,-.5],bottom:[0,.5]};function co(e){var t=ka.JK,r=new lo,n={v0:0,v1:0};r.addPole((0,x.al)(0,0));for(var i=0;i<t;++i){var a=2*i*Math.PI/t,o=Math.cos(a),s=Math.sin(a),l=(0,x.al)(.5*o,.5*s),u=(0,x.al)(o,s);r.addVertex(l,u)}for(var c=0;c<t-1;++c){var h={v0:c,v1:c+1};r.addSegment(h,n)}var d={v0:t-1,v1:0};if(r.addSegment(d,n),"center"!==e){var f=uo[e];r.translate(f[0],f[1])}return r}var ho={center:co("center"),top:co("top"),bottom:co("bottom")},fo={center:vo("center"),top:vo("top"),bottom:vo("bottom")};function vo(e){var t=new lo,r=(0,x.al)(-.5,-.5),n=(0,x.al)(.5,-.5),i=(0,x.al)(.5,.5),a=(0,x.al)(-.5,.5),o=(0,x.al)(0,-1),s=(0,x.al)(1,0),l=(0,x.al)(0,1),u=(0,x.al)(-1,0);if(t.addPole((0,x.al)(0,.5),l),t.addPole((0,x.al)(0,.5)),t.addPole((0,x.al)(0,-.5)),t.addPole((0,x.al)(0,-.5),o),t.addVertex(r,o),t.addVertex(n,o),t.addSegment({v0:0,v1:1},{v0:3,v1:3}),t.addVertex(n,s),t.addVertex(i,s),t.addSegment({v0:2,v1:3},{v0:2,v1:1}),t.addVertex(i,l),t.addVertex(a,l),t.addSegment({v0:4,v1:5},{v0:0,v1:0}),t.addVertex(a,u),t.addVertex(r,u),t.addSegment({v0:6,v1:7},{v0:1,v1:2}),"center"!==e){var c=uo[e];t.translate(c[0],c[1])}return t}var po=r(24204);function mo(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function yo(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*s+a*l,e[1]=i*s+o*l,e[2]=n*u+a*c,e[3]=i*u+o*c,e}function go(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}var _o=yo,bo=go;Object.freeze(Object.defineProperty({__proto__:null,LDU:function(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]},add:function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},adjoint:function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},equals:function(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=t[0],s=t[1],l=t[2],u=t[3],c=(0,po.bn)();return Math.abs(r-o)<=c*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=c*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=c*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-u)<=c*Math.max(1,Math.abs(a),Math.abs(u))},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},fromRotation:function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},invert:function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*a-i*n;return o?(o=1/o,e[0]=a*o,e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e):null},mul:_o,multiply:yo,multiplyScalar:function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},multiplyScalarAndAdd:function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},rotate:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=n*-s+a*l,e[3]=i*-s+o*l,e},scale:function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1];return e[0]=n*s,e[1]=i*s,e[2]=a*l,e[3]=o*l,e},set:mo,str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},sub:bo,subtract:go,transpose:function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}},Symbol.toStringTag,{value:"Module"}));function xo(){return[1,0,0,1]}Object.freeze(Object.defineProperty({__proto__:null,clone:function(e){return[e[0],e[1],e[2],e[3]]},create:xo,createView:function(e,t){return new Float64Array(e,t,4)},fromValues:function(e,t,r,n){return[e,t,r,n]}},Symbol.toStringTag,{value:"Module"}));var So=function(){function e(){(0,s.Z)(this,e),this.vLeft=(0,T.Ue)(),this.vRight=(0,T.Ue)(),this.vMinSiblingLength=0,this.frame=new Va}return(0,l.Z)(e,[{key:"setFrameFromUpVector",value:function(e){(0,S.c)(this.frame.up,e),(0,S.g)(Io,this.vLeft,this.vRight),(0,S.n)(Io,Io),(0,S.j)(Lo,this.frame.up,(0,S.m)(Io,this.frame.up)),(0,S.f)(Uo,Io,Lo),(0,S.n)(Uo,Uo),(0,S.b)(this.frame.right,Uo,this.frame.up)}},{key:"foldingAngle",get:function(){return Math.PI-this.rotationAngle}}]),e}(),To=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"rotationFrameUp",get:function(){return this.frame.up}},{key:"rotationRight",get:function(){return x.E9}},{key:"rotationAngle",get:function(){return(0,S.j)(Ao,this.frame.up,(0,S.m)(this.frame.up,this.vLeft)),(0,S.f)(Ao,this.vLeft,Ao),(0,S.k)(Ao,Ao),(0,S.n)(Ao,Ao),(0,S.j)(Zo,this.frame.up,(0,S.m)(this.frame.up,this.vRight)),(0,S.f)(Zo,this.vRight,Zo),(0,S.n)(Zo,Zo),(0,S.b)(ko,this.rotationFrameUp,this.vLeft),Math.sign((0,S.m)(ko,this.vRight))*(Math.PI-(0,yr.ZF)((0,S.m)(Ao,Zo)))}},{key:"maxStretchDistance",get:function(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}},{key:"applyMiterStretch",value:function(e,t){var r=this.rotationAngle;if(Math.abs(r)<=0)return t;var n=(0,yr.b_)(Math.cos(.5*r));return(0,b.t8)(e,(n-1+1)*t[0],t[1])}}]),r}(So),wo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"rotationFrameUp",get:function(){var e=Math.sign((0,S.m)(this.frame.right,this.vRight));return(0,S.b)(Co,this.vRight,this.vLeft),(0,S.j)(Co,Co,e),(0,S.n)(Co,Co)}},{key:"rotationRight",get:function(){var e=this.rotationFrameUp,t=(0,S.m)(e,this.frame.up),r=(0,S.m)(e,this.frame.right);return(0,S.j)(Ro,this.frame.up,-r),(0,S.j)(Eo,this.frame.right,t),(0,S.g)(Ro,Ro,Eo),(0,S.n)(Ro,Ro),function(e,t,r){(0,b.t8)(e,(0,S.m)(r,t.right),(0,S.m)(r,t.up))}(Oo,this.frame,Ro),Oo}},{key:"rotationAngle",get:function(){var e=Math.sign((0,S.m)(this.frame.right,this.vRight));return(0,S.k)(ko,this.vLeft),-e*(Math.PI-(0,yr.ZF)((0,S.m)(ko,this.vRight)))}},{key:"maxStretchDistance",get:function(){return Math.abs(this.vMinSiblingLength*(0,yr.b_)(Math.cos(.5*this.foldingAngle)))}},{key:"applyMiterStretch",value:function(e,t){var r=this.rotationAngle;if(0===Math.abs(r))return t;var n=(0,yr.b_)(Math.cos(.5*r)),i=this.rotationRight,a=mo(Mo,1+(n-1)*i[0]*i[0],(n-1)*i[0]*i[1],(n-1)*i[0]*i[1],1+(n-1)*i[1]*i[1]);return(0,b.c)(e,t,a)}}]),r}(So);function Po(e){switch(e){case Ga.World:return new To;case Ga.Path:return new wo}}var Co=(0,T.Ue)(),Oo=(0,x.Ue)(),Ro=(0,T.Ue)(),Eo=(0,T.Ue)(),ko=(0,T.Ue)(),Ao=(0,T.Ue)(),Zo=(0,T.Ue)(),Lo=(0,T.Ue)(),Io=(0,T.Ue)(),Uo=(0,T.Ue)(),Mo=[1,0,0,1],Do=r(96658),zo=r(75027),No=r(41481),Fo=r(78041),Vo=r(25920),Ho=r(21841),Go=new Map([[ce.T.POSITION,0],[ce.T.PROFILERIGHT,1],[ce.T.PROFILEUP,2],[ce.T.PROFILEVERTEXANDNORMAL,3],[ce.T.FEATUREVALUE,4],[ce.T.OBJECTANDLAYERIDCOLOR,5]]),Bo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).ambient=(0,T.al)(.2,.2,.2),e.diffuse=(0,T.al)(.8,.8,.8),e.specular=(0,T.al)(0,0,0),e.opacity=1,e.origin=(0,T.Ue)(),e.modelTransformation=null,e}return(0,l.Z)(r)}(zo.C),jo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"initializeConfiguration",value:function(e,t){t.spherical=e.viewingMode===ee.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},{key:"initializeProgram",value:function(e){return new rn.$(e.rctx,r.shader.get().build(this.configuration),Go)}},{key:"initializePipeline",value:function(){var e=this.configuration.transparencyPassType,t=this.configuration,r=e===Vo.A.NONE,n=e===Vo.A.FrontFace;return(0,sn.sm)({blending:t.output===Wr.H_.Color&&t.transparent?r?Fo.wu:(0,Fo.j7)(e):null,culling:t.hasSlicePlane&&!t.transparent&&t.doubleSidedMode!==Do.q.None?sn.sg:null,depthTest:{func:(0,Fo.Bh)(e)},depthWrite:r||n?sn.LZ:null,drawBuffers:t.output===Wr.H_.Depth?{buffers:[on.Xg.NONE]}:(0,Fo.V7)(e),colorWrite:sn.BK,stencilWrite:t.hasOccludees?nn.s3:null,stencilTest:t.hasOccludees?nn.RY:null,polygonOffset:r||n?null:Fo.E0})}}]),r}(en.A);jo.shader=new Qr.J(Ho.P,(function(){return r.e(24321).then(r.bind(r,24321))}));var Wo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).output=Wr.H_.Color,e.doubleSidedMode=Do.q.None,e.transparencyPassType=Vo.A.NONE,e.spherical=!1,e.receiveShadows=!1,e.receiveAmbientOcclusion=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.hasSlicePlane=!1,e.transparent=!1,e.hasOccludees=!1,e.multipassEnabled=!1,e.cullAboveGround=!1,e.doublePrecisionRequiresObfuscation=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,l.Z)(r)}(hn.W);(0,un._)([(0,cn.o)({count:Wr.H_.COUNT})],Wo.prototype,"output",void 0),(0,un._)([(0,cn.o)({count:Do.q.COUNT})],Wo.prototype,"doubleSidedMode",void 0),(0,un._)([(0,cn.o)({count:Vo.A.COUNT})],Wo.prototype,"transparencyPassType",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"spherical",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"receiveShadows",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"receiveAmbientOcclusion",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"vvSize",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"vvColor",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"vvOpacity",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"hasSlicePlane",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"transparent",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"hasOccludees",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"multipassEnabled",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"cullAboveGround",void 0),(0,un._)([(0,cn.o)()],Wo.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Wo.prototype,"occlusionPass",void 0),(0,un._)([(0,cn.o)({constValue:No.f7.Disabled})],Wo.prototype,"pbrMode",void 0),(0,un._)([(0,cn.o)({constValue:!0})],Wo.prototype,"hasVvInstancing",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Wo.prototype,"useCustomDTRExponentForWater",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Wo.prototype,"useFillLights",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Wo.prototype,"hasColorTexture",void 0);var qo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e,new Xo)).supportsEdges=!0,n.produces=new Map([[Yr.r.OPAQUE_MATERIAL,function(e){return(n.parameters.castShadows&&(0,Wr.Kr)(e)||(0,Wr.Jb)(e))&&!n.parameters.transparent}],[Yr.r.TRANSPARENT_MATERIAL,function(e){return(n.parameters.castShadows&&(0,Wr.Kr)(e)||(0,Wr.Jb)(e))&&n.parameters.transparent}]]),n._vertexAttributeLocations=Go,n._configuration=new Wo,n._vertexBufferLayout=r.getVertexBufferLayout(),n}return(0,l.Z)(r,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e===Wr.H_.Color&&(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?Do.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?Do.q.WindingOrder:Do.q.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=null!=t.ssao),this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"isVisibleForOutput",value:function(e){return e!==Wr.H_.Shadow&&e!==Wr.H_.ShadowExcludeHighlight&&e!==Wr.H_.ShadowHighlight||this.parameters.castShadows}},{key:"isVisible",value:function(){return(0,u.Z)((0,c.Z)(r.prototype),"isVisible",this).call(this)&&this.parameters.opacity>0}},{key:"intersect",value:function(e,t,r,n,i,a){var o=e;if(Ja(o)){var s=o.path,l=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){var u=this.parameters.vvSize,c=u.offset,h=u.factor,d=u.minSize,f=u.maxSize,v=s.sizeAttributeValue;l[0]*=(0,yr.uZ)(c[0]+v*h[0],d[0],f[0]),l[1]*=(0,yr.uZ)(c[2]+v*h[2],d[2],f[2])}var p=new Ya.sT(!1,r.options.normalRequired),m=Math.max(l[0],l[1]),y=e.boundingInfo;if(null!=y){var g=(0,C.al)(y.bbMin[0]-m,y.bbMin[1]-m,y.bbMin[2]-m,y.bbMax[0]+m,y.bbMax[1]+m,y.bbMax[2]+m),_=[i[0]-n[0],i[1]-n[1],i[2]-n[2]],b=Math.sqrt(_[0]*_[0]+_[1]*_[1]+_[2]*_[2]),x=[b/_[0],b/_[1],b/_[2]];(0,Ya.Tw)(g,n,x,r.tolerance)&&Yo(s,l,n,i,p,a)}else Yo(s,l,n,i,p,a)}}},{key:"createBufferWriter",value:function(){return new Kr.G(this._vertexBufferLayout)}},{key:"createGLMaterial",value:function(e){return new Jo(e)}}],[{key:"getVertexBufferLayout",value:function(){var e=(0,Ai.U$)().vec3f(ce.T.POSITION).vec4f(ce.T.PROFILERIGHT).vec4f(ce.T.PROFILEUP).vec4f(ce.T.PROFILEVERTEXANDNORMAL).vec4f(ce.T.FEATUREVALUE);return(0,p.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(ce.T.OBJECTANDLAYERIDCOLOR),e}}]),r}(Jr.F5),Jo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"_updateShadowState",value:function(e){null!=this.technique&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}},{key:"beginSlot",value:function(e){return this._output===Wr.H_.Color&&(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(jo,e)}}]),r}(qr.Z);function Yo(e,t,r,n,i,a){e.baked.size&&e.baked.size[0]===t[0]&&e.baked.size[1]===t[1]||e.baked.bake(t),e.baked.intersect(r,n,i,a)}var Xo=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).doubleSided=!1,e.doubleSidedType="normal",e.receiveShadows=!1,e.castShadows=!0,e.hasSlicePlane=!1,e.transparent=!1,e.hasOccludees=!1,e}return(0,l.Z)(r)}(Bo),Ko=["polyline"],$o=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,i,a))._intrinsicSize=(0,x.al)(1,1),o._upVectorAlignment=Ga.Path,o._stencilWidth=.1,o.usedMemory=0,o.ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i,o,s,l,u,c,h,d,f,v,p,m,y,g,_;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=null!=this.symbolLayer.width?this.symbolLayer.width:this.symbolLayer.height,l=null!=this.symbolLayer.height?this.symbolLayer.height:s,this._vvConvertOptions=new zt.Z3({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[s,1,l],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=(null===(t=this._context.renderer)||void 0===t||null===(r=t.visualVariables)||void 0===r?void 0:r.length)>0?(0,zt.vT)(this._context.renderer,this._vvConvertOptions):null,u=this.symbolLayer.anchor||"center",this._upVectorAlignment="heading"===this.symbolLayer.profileRotation?Ga.World:Ga.Path,c=this.symbolLayer.profile||"circle",e.t0=c,e.next="circle"===e.t0?8:"quad"===e.t0?10:8;break;case 8:return this._profile=ho[u],e.abrupt("break",11);case 10:this._profile=fo[u];case 11:e.t1=this.symbolLayer.join,e.next="round"===e.t1?14:"bevel"===e.t1?16:"miter"===e.t1?18:20;break;case 14:return this._extruder=new Fa(0,ka.t7),e.abrupt("break",21);case 16:return this._extruder=new Fa(0,1),e.abrupt("break",21);case 18:return this._extruder=new Fa(.8*Math.PI,1),e.abrupt("break",21);case 20:this._extruder=new Na;case 21:h=this.symbolLayer.cap||"butt",e.t2=h,e.next="none"===e.t2?25:"butt"===e.t2?27:"square"===e.t2?29:"round"===e.t2?31:27;break;case 25:return this._startCap=new Ia,this._endCap=new Ia,e.abrupt("break",34);case 27:return this._startCap=new Ua(this._profile,0),this._endCap=new Ua(this._profile,0,!0),e.abrupt("break",34);case 29:return this._startCap=new Ua(this._profile,-.5),this._endCap=new Ua(this._profile,.5,!0),e.abrupt("break",34);case 31:return d="quad"===c,this._startCap=new Ma({profile:this._profile,flip:!1,breakNormals:d,subdivisions:ka.wg}),this._endCap=new Ma({profile:this._profile,flip:!0,breakNormals:d,subdivisions:ka.wg}),e.abrupt("break",34);case 34:if(f=null===(n=this.symbolLayer)||void 0===n||null===(i=n.material)||void 0===i?void 0:i.color,v=this._getCombinedOpacityAndColor(f),p=(0,T.nI)(v),m=v[3],y=m<1||this.needsDrivenTransparentPass,g={diffuse:p,ambient:p,opacity:m,transparent:y,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:y||"none"===h?Le.Vr.None:Le.Vr.Back,offsetTransparentBackfaces:!0},this._drivenProperties.size||((0,b.t8)(this._intrinsicSize,s,l),(0,ne.ZL)(this._intrinsicSize[0])&&(0,ne.ZL)(this._intrinsicSize[1]))){e.next=37;break}throw new F.Z("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");case 37:null!==(o=this._fastUpdates)&&void 0!==o&&o.visualVariables.size||(0,b.bA)(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates?(_=(0,N.Z)((0,N.Z)((0,N.Z)({},g),this._fastUpdates.materialParameters),{},{size:(0,x.nI)(this._intrinsicSize)}),this._materials[0]=new qo(_)):(g.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,g.normalType=Ze.r.Compressed,this._materials[0]=new De.Gp(g)),this._materials[0].setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._materials[0]);case 39:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._materials[0]),this._materials[0]=null,this._materials.length=0}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Ko,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t),n=e.renderingInfo;return this._createAs3DShape(t,n,r,t.uid)}},{key:"layerOpacityChanged",value:function(){var e,t,r,n=null===(e=this.symbolLayer)||void 0===e||null===(t=e.material)||void 0===t?void 0:t.color,i=this._getCombinedOpacity(n),a=i<1||this.needsDrivenTransparentPass;null===(r=this._materials[0])||void 0===r||r.setParameters({opacity:i,transparent:a})}},{key:"layerElevationInfoChanged",value:function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,te.B5)}},{key:"slicePlaneEnabledChanged",value:function(){var e;return null!==(e=this._materials[0])&&void 0!==e&&e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){var e;return null!==(e=this._materials[0])&&void 0!==e&&e.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){var n;if("visualVariables"!==r)return ie.W.RecreateSymbol;if(!(0,zt.Tc)(this._fastUpdates,t,this._vvConvertOptions))return ie.W.RecreateSymbol;null===(n=this._materials[0])||void 0===n||n.setParameters(this._fastUpdates.materialParameters)}return ie.W.FastUpdate}},{key:"_getVertexData",value:function(e){var t,r=0,i=e.paths,a=[],o=e.spatialReference,s=this._context.elevationProvider.spatialReference,l=this._context.renderCoordsHelper.spatialReference,u=(0,n.Z)(i);try{for(u.s();!(t=u.n()).done;){r+=t.value.length}}catch(_){u.e(_)}finally{u.f()}var c,h,d=(0,Y.bg)(3*r),f=0,v=(0,n.Z)(i);try{for(v.s();!(h=v.n()).done;){var p=h.value;a.push({offset:f,numVertices:p.length});var m,y=(0,n.Z)(p);try{for(y.s();!(m=y.n()).done;){var g=m.value;d[f++]=g[0],d[f++]=g[1],d[f++]=e.hasZ?g[2]:0}}catch(_){y.e(_)}finally{y.f()}}}catch(_){v.e(_)}finally{v.f()}return null==s||o.equals(s)||(0,be.projectBuffer)(d,o,0,d,s,0,r)?(null==s||s.equals(l)?c=(0,Y.QZ)(d):(c=(0,Y.bg)(3*r),(0,be.projectBuffer)(d,s,0,c,l,0,r)),{pathVertexDataInfos:a,vertexDataES:d,vertexDataRS:c}):null}},{key:"_createAs3DShape",value:function(e,t,r,i){var a=this;this.usedMemory=0;var o=e.geometry,s=this._getVertexData(o);if(null==s)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0===s.pathVertexDataInfos.length)return 0!==o.paths.length&&o.paths.some((function(e){return e.length>0}))||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;var l,u=new Array,c=o.spatialReference,h=(0,C.Ue)(),d=this._context.renderCoordsHelper,f=new _e.sb(s.vertexDataES),v=(0,n.Z)(s.pathVertexDataInfos);try{for(v.s();!(l=v.n()).done;){var p=l.value,m=p.numVertices;if(!(m<2)){var y=p.offset;if(null==this._context.clippingExtent||((0,C.cS)(h),(0,C.G1)(h,s.vertexDataES,y,m),(0,C.Zp)(h,this._context.clippingExtent))){for(var g=new Array,_=y+3*m,b=y;b<_;b+=3){f.offset=b;var x=(0,te.w7)(f,this._context.elevationProvider,r,d);(0,S.s)(rs,s.vertexDataRS[b],s.vertexDataRS[b+1],s.vertexDataRS[b+2]),d.setAltitude(rs,x),s.vertexDataRS[b]=rs[0],s.vertexDataRS[b+1]=rs[1],s.vertexDataRS[b+2]=rs[2],g.push(Po(this._upVectorAlignment))}var T=new Aa(g,s.vertexDataES,s.vertexDataRS,y);Qo(T,this._upVectorAlignment,this._context.renderCoordsHelper);var w=new Za(T,this._profile,this._extruder,this._startCap,this._endCap),P=null;if(this._fastUpdates){var O,R,E,k,A,Z,L=this._fastUpdates.visualVariables,I=null!==(O=(0,zt.kD)(null===(R=L.size)||void 0===R?void 0:R.field,e))&&void 0!==O?O:0,U=null!==(E=(0,zt.kD)(null===(k=L.color)||void 0===k?void 0:k.field,e))&&void 0!==E?E:0,D=null!==(A=(0,zt.kD)(null===(Z=L.opacity)||void 0===Z?void 0:Z.field,e))&&void 0!==A?A:0;P=new $a(w,I,U,D)}else{var z=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){var N=t.size;z[0]*=es(N[0],"symbol-value"===N[2]?this.symbolLayer.height||0:N[2],this.symbolLayer.width||0),z[1]*=es(N[2],"symbol-value"===N[0]?this.symbolLayer.width||0:N[0],this.symbolLayer.height||0)}var F=void 0;this._drivenProperties.color&&(F=t.color),this._drivenProperties.opacity&&null!=t.opacity&&(F=F?[F[0],F[1],F[2],t.opacity]:[1,1,1,t.opacity]);var V=new Ka(w);V.bake(z),F&&V.bakeVertexColors(F),P=V}var H=P.createGeometryData(),G=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),B=new qa(this._materials[0],H,P,c,this._stencilWidth,G);B.transformation=(0,W.Iu)((0,q.Ue)(),q.Wd,w.path.origin),u.push(B),this.usedMemory+=w.usedMemory}}}}catch(Y){v.e(Y)}finally{v.f()}if(0===u.length)return null;var j=new Me.T({geometries:u,layerUid:this._context.layer.uid,graphicUid:i}),J=new M.z(this,j,u,null,null,(function(e,t,r,i,o){return function(e,t,r,i,a){var o,s=e.stageObject,l=s.geometries,u=0,c=(0,n.Z)(l);try{for(c.s();!(o=c.n()).done;){var h=o.value;if(Ja(h)){var d=h.path,f=d.builder.path;u+=ts(f,t,r,i),a!==Ga.World&&Qo(f,a,i),d.onPathChanged(h),h.invalidateBoundingInfo(),s.geometryVertexAttributeUpdated(h,ce.T.POSITION)}}}catch(Y){c.e(Y)}finally{c.f()}return u/l.length}(e,t,i,o,a._upVectorAlignment)}),r);return J.alignedSampledElevation=0,J.needsElevationUpdates=(0,te.B5)(r.mode),J}}]),r}(re.k);function Qo(e,t,r){var i=e.origin,a=e.positions,o=e.offset;switch(t){default:case Ga.World:var s,l=(0,n.Z)(e.vertices);try{for(l.s();!(s=l.n()).done;){var u=s.value;rs[0]=a[o++]+i[0],rs[1]=a[o++]+i[1],rs[2]=a[o++]+i[2],r.worldUpAtPosition(rs,rs),u.setFrameFromUpVector(rs)}}catch(c){l.e(c)}finally{l.f()}break;case Ga.Path:rs[0]=a[o]+i[0],rs[1]=a[o+1]+i[1],rs[2]=a[o+2]+i[2],r.worldUpAtPosition(rs,rs),function(e,t){var r=null,n=e.vertices.length,i=.99619469809,a=(0,T.Ue)(),o=(0,T.Ue)(),s=(0,T.Ue)(),l=(0,T.Ue)(),u=(0,T.Ue)(),c=(0,T.Ue)(),h=(0,jr.Ue)(),d=e.vertices[0];(0,S.c)(o,t),(0,S.s)(a,0,1,0),(0,Ft.Ay)(d.vRight,o,a,a,s,o,i),(0,S.c)(d.frame.up,o),(0,S.c)(d.frame.right,s);var f=e.positions,v=e.offset;r=d;for(var p=1;p<n;++p){d=e.vertices[p],(0,S.g)(u,d.vLeft,d.vRight);var m=(0,S.l)(u);m>0?(m=1/Math.sqrt(m),u[0]=u[0]*m,u[1]=u[1]*m,u[2]=u[2]*m):(u[0]=d.vRight[0],u[1]=d.vRight[1],u[2]=d.vRight[2]),c[0]=f[v]+r.frame.up[0],c[1]=f[v+1]+r.frame.up[1],c[2]=f[v+2]+r.frame.up[2],v+=3;var y=(0,S.s)(so,f[v],f[v+1],f[v+2]);(0,jr.Yq)(y,u,h),(0,jr.BR)(h,(0,oo.re)(c,d.vLeft),l)?(l[0]-=f[v],l[1]-=f[v+1],l[2]-=f[v+2],(0,S.n)(o,l),(0,S.b)(s,u,o),(0,S.n)(s,s)):(0,Ft.Ay)(u,r.frame.up,r.frame.right,a,s,o,i),(0,S.c)(d.frame.up,o),(0,S.c)(d.frame.right,s),r=d}}(e,rs)}}function es(e,t,r){switch(e){case"symbol-value":return r;case"proportional":return t;default:return e}}function ts(e,t,r,n){for(var i=0,a=e.origin,o=e.vertices,s=e.positions,l=e.positionsES,u=e.offset+3*o.length,c=e.offset;c<u;c+=3)(0,S.s)(rs,l[c],l[c+1],l[c+2]),r(rs,ns),i+=ns.sampledElevation,rs[0]=s[c]+a[0],rs[1]=s[c+1]+a[1],rs[2]=s[c+2]+a[2],n.setAltitude(rs,ns.z),s[c]=rs[0]-a[0],s[c+1]=rs[1]-a[1],s[c+2]=rs[2]-a[2];return e.updatePathVertexInformation(),i/o.length}var rs=(0,T.Ue)(),ns=new te.Lm,is=r(83448),as=r(96334);function os(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;(0,S.s)(cs,1,0,0),(0,S.s)(hs,0,1,0),(0,S.s)(ds,0,0,1),Ts(ss,r),(0,jr.nI)(us,r)&&gs(us,cs,hs,ds,n,ss),(0,b.t8)(fs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,b.t8)(vs,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(var a=0;a<r.length;a+=3){(0,S.s)(ls,r[a],r[a+1],r[a+2]);var o=(0,S.m)(cs,ls),s=(0,S.m)(hs,ls);fs[0]=Math.min(fs[0],o),fs[1]=Math.min(fs[1],s),vs[0]=Math.max(vs[0],o),vs[1]=Math.max(vs[1],s)}var l=(0,S.m)(ds,ss);Ps(ps,fs[0],fs[1],l,cs,hs,ds),Ps(ms,vs[0],fs[1],l,cs,hs,ds),Ps(ys,fs[0],vs[1],l,cs,hs,ds),(0,S.f)(ms,ms,ps),(0,S.j)(ms,ms,.5),(0,S.f)(ys,ys,ps),(0,S.j)(ys,ys,.5),(0,S.g)(ps,ps,ms),(0,S.g)(ps,ps,ys);for(var u=fs[0]%i,c=fs[1]%i,h=fs[0]-u,d=fs[1]-c,f=0;f<r.length;f+=3){(0,S.s)(ls,r[f],r[f+1],r[f+2]);var v=f/3,p=4*v;e[p]=((0,S.m)(cs,ls)-h)/i,e[p+1]=((0,S.m)(hs,ls)-d)/i,e[p+2]=h/i,e[p+3]=d/i;for(var m=9*v,y=0;y<3;y++)t[m+y]=ps[y],t[m+y+3]=ms[y],t[m+y+6]=ys[y]}}var ss=(0,T.Ue)(),ls=(0,T.Ue)(),us=(0,jr.Ue)(),cs=(0,T.Ue)(),hs=(0,T.Ue)(),ds=(0,T.Ue)(),fs=(0,x.Ue)(),vs=(0,x.Ue)(),ps=(0,T.Ue)(),ms=(0,T.Ue)(),ys=(0,T.Ue)();function gs(e,t,r,n,i,a){null!=i?(i.basisMatrixAtPosition(a,_s),(0,S.s)(bs,_s[0],_s[1],_s[2]),(0,S.s)(xs,_s[4],_s[5],_s[6]),(0,S.s)(Ss,_s[8],_s[9],_s[10])):((0,S.s)(bs,1,0,0),(0,S.s)(xs,0,1,0),(0,S.s)(Ss,0,0,1));var o=(0,jr.st)(e);(0,S.m)(o,Ss)<0&&(0,S.j)(o,o,-1),(0,S.c)(n,o);var s=(0,S.m)(o,xs),l=(0,S.m)(o,bs);Math.abs(s)>Math.abs(l)?((0,S.r)(t,bs,o,-l),(0,S.n)(t,t),(0,S.b)(r,t,o),(0,S.n)(r,r),(0,S.j)(r,r,-1)):((0,S.r)(r,xs,o,-s),(0,S.n)(r,r),(0,S.b)(t,r,o),(0,S.n)(t,t))}var _s=(0,q.Ue)(),bs=(0,T.Ue)(),xs=(0,T.Ue)(),Ss=(0,T.Ue)();function Ts(e,t){(0,S.s)(ws,0,0,0);for(var r=0;r<t.length-3;r+=3)ws[0]+=t[r],ws[1]+=t[r+1],ws[2]+=t[r+2];(0,S.j)(e,ws,1/(t.length/3-1))}var ws=(0,T.Ue)();function Ps(e,t,r,n,i,a,o){(0,S.s)(e,t*i[0]+r*a[0]+n*o[0],t*i[1]+r*a[1]+n*o[1],t*i[2]+r*a[2]+n*o[2])}var Cs=r(66832),Os=r(17729),Rs=r(11983),Es=r(65964),ks=r(33236),As=r(59771),Zs=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"initializeProgram",value:function(e){return new rn.$(e.rctx,r.shader.get().build(this.configuration),(0,p.Z)("enable-feature:objectAndLayerId-rendering")?Ms:Us)}},{key:"_setPipelineState",value:function(e,t){var r=this.configuration,n=e===Vo.A.NONE,i=e===Vo.A.FrontFace;return(0,sn.sm)({blending:r.output===Wr.H_.Color?n?Fo.wu:(0,Fo.j7)(e):null,culling:(0,sn.zp)(r.cullFace),depthTest:r.draped?null:{func:(0,Fo.Bh)(e)},depthWrite:r.draped?null:n?sn.LZ:(0,Fo.K5)(e),drawBuffers:r.output===Wr.H_.Depth?{buffers:[on.Xg.NONE]}:(0,Fo.V7)(e),colorWrite:sn.BK,stencilWrite:r.hasOccludees?nn.s3:null,stencilTest:r.hasOccludees?t?nn.eD:nn.RY:null,polygonOffset:n||i?r.polygonOffset?Ls:null:(0,Fo.je)(r.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipeline",value:function(e){return e?this._occludeePipelineState:(0,u.Z)((0,c.Z)(r.prototype),"getPipeline",this).call(this)}}]),r}(en.A);Zs.shader=new Qr.J(As.P,(function(){return r.e(97494).then(r.bind(r,97494))}));var Ls={factor:1,units:1},Is=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).output=Wr.H_.Color,e.cullFace=Le.Vr.None,e.transparencyPassType=Vo.A.NONE,e.hasSlicePlane=!1,e.hasVertexColors=!1,e.polygonOffset=!1,e.hasOccludees=!1,e.enableOffset=!0,e.multipassEnabled=!1,e.cullAboveGround=!1,e.vvColor=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,l.Z)(r)}(hn.W);(0,un._)([(0,cn.o)({count:Wr.H_.COUNT})],Is.prototype,"output",void 0),(0,un._)([(0,cn.o)({count:Le.Vr.COUNT})],Is.prototype,"cullFace",void 0),(0,un._)([(0,cn.o)({count:Os.b.COUNT})],Is.prototype,"style",void 0),(0,un._)([(0,cn.o)({count:Vo.A.COUNT})],Is.prototype,"transparencyPassType",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"hasSlicePlane",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"hasVertexColors",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"polygonOffset",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"hasOccludees",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"patternSpacing",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"lineWidth",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"enableOffset",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"draped",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"multipassEnabled",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"cullAboveGround",void 0),(0,un._)([(0,cn.o)()],Is.prototype,"vvColor",void 0),(0,un._)([(0,cn.o)({constValue:!0})],Is.prototype,"writeDepth",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Is.prototype,"occlusionPass",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Is.prototype,"hasVvInstancing",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Is.prototype,"vvSize",void 0),(0,un._)([(0,cn.o)({constValue:!1})],Is.prototype,"vvOpacity",void 0);var Us=new Map([[ce.T.POSITION,0],[ce.T.COLOR,3],[ce.T.UVMAPSPACE,4],[ce.T.COLORFEATUREATTRIBUTE,5],[ce.T.BOUNDINGRECT,6]]),Ms=new Map([[ce.T.POSITION,0],[ce.T.COLOR,3],[ce.T.UVMAPSPACE,4],[ce.T.COLORFEATUREATTRIBUTE,5],[ce.T.BOUNDINGRECT,6],[ce.T.OBJECTANDLAYERIDCOLOR,9]]),Ds=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e,new Vs)).supportsEdges=!0,n.produces=new Map([[Yr.r.OPAQUE_MATERIAL,function(e){return(0,Wr.ou)(e)}],[Yr.r.TRANSPARENT_MATERIAL,function(e){return(0,Wr.D5)(e)}],[Yr.r.TRANSPARENT_NO_SSAO_DEPTH,function(e){return(0,Wr.BX)(e)&&n.parameters.writeLinearDepth}],[Yr.r.DRAPED_MATERIAL,function(e){return n.parameters.draped&&e===Wr.H_.Color||(0,Wr.ou)(e)}]]),n._vertexAttributeLocations=(0,p.Z)("enable-feature:objectAndLayerId-rendering")?Ms:Us,n._configuration=new Is,n}return(0,l.Z)(r,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Fo.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}},{key:"createGLMaterial",value:function(e){return new zs(e)}},{key:"createBufferWriter",value:function(){var e=(0,Ai.U$)().vec3f(ce.T.POSITION).vec4f(ce.T.UVMAPSPACE);return this.parameters.draped||e.mat3f(ce.T.BOUNDINGRECT),this.parameters.vvColor?e.f32(ce.T.COLORFEATUREATTRIBUTE):e.vec4u8(ce.T.COLOR),(0,p.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(ce.T.OBJECTANDLAYERIDCOLOR),new Ns(e)}}]),r}(Rs.c),zs=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"_updateParameters",value:function(e){return this.ensureTechnique(Zs,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output===Wr.H_.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}]),r}(qr.Z),Ns=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"write",value:function(e,t,r,i,a){(0,ks.NK)(r,this.vertexBufferLayout,e,t,i,a);var o,s=(0,n.Z)(this.vertexBufferLayout.fields.keys());try{for(s.s();!(o=s.n()).done;){var l=o.value,u=r.attributes.get(l),c=null===u||void 0===u?void 0:u.indices;if(u&&c)switch(l){case ce.T.UVMAPSPACE:(0,Xr.hu)(4===u.size);var h=i.getField(l,zi.ek);h&&(0,ks.SW)(u,h,a);break;case ce.T.BOUNDINGRECT:(0,Xr.hu)(9===u.size);var d=i.getField(l,zi.gK);d&&Fs(u,e,d,a)}}}catch(f){s.e(f)}finally{s.f()}}}]),r}(Kr.G);function Fs(e,t,r,n){var i=e.data,a=e.indices,o=t,s=r.typedBuffer,l=r.typedBufferStride,u=a.length;n*=l;for(var c=0;c<u;++c){var h=9*a[c],d=i[h],f=i[h+1],v=i[h+2];s[n]=o[0]*d+o[4]*f+o[8]*v+o[12],s[n+1]=o[1]*d+o[5]*f+o[9]*v+o[13],s[n+2]=o[2]*d+o[6]*f+o[10]*v+o[14];for(var p=3;p<9;++p)s[n+p]=i[h+p];n+=l}}var Vs=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).color=(0,gt.al)(1,1,1,1),e.writeLinearDepth=!1,e.hasVertexColors=!1,e.polygonOffset=!1,e.hasSlicePlane=!1,e.cullFace=Le.Vr.None,e.hasOccludees=!1,e.style=Os.b.Cross,e.patternSpacing=10,e.lineWidth=1,e.draped=!0,e}return(0,l.Z)(r)}(Es.n);function Hs(e,t){var r,n=null!==(r=null===e||void 0===e?void 0:e.pattern)&&void 0!==r?r:null;return null==n?new Cs.E(t):"none"===n.style||"solid"===n.style?("none"===n.style&&(t.color=(0,gt.al)(0,0,0,0),t.forceTransparentMode=!0),new Cs.E(t)):(t.style=function(e){switch(e){case"horizontal":return Os.b.Horizontal;case"vertical":return Os.b.Vertical;case"cross":return Os.b.Cross;case"forward-diagonal":return Os.b.ForwardDiagonal;case"backward-diagonal":return Os.b.BackwardDiagonal;case"diagonal-cross":return Os.b.DiagonalCross;default:return}}(n.style),new Ds(t))}function Gs(e,t){if(function(e){return e.material instanceof Ds&&!e.material.parameters.draped}(e)){var r=e.attributes.get(ce.T.POSITION).data;os(e.getMutableAttribute(ce.T.UVMAPSPACE).data,e.getMutableAttribute(ce.T.BOUNDINGRECT).data,r,t)}}function Bs(e,t,r,i,a){var o,s=(0,kt.Wf)(e,t,r,i,a),l=e.stageObject.geometries,u=(0,n.Z)(l);try{for(u.s();!(o=u.n()).done;){Gs(o.value,a)}}catch(c){u.e(c)}finally{u.f()}return s}var js=["polyline","polygon","extent"],Ws=new zt.Z3({size:!1,color:!0,rotation:!1,opacity:!1}),qs=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,i,a))._needsUV=!1,o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._fastUpdates=(0,zt.vT)(this._context.renderer,Ws);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMaterials",value:function(){var e,t,r;if(!(this._materials.length>0)){var n=null===(e=this.symbolLayer)||void 0===e||null===(t=e.material)||void 0===t?void 0:t.color,i=this._getCombinedOpacityAndColor(n);this._materials[Js.Fill]=Hs(this.symbolLayer,(0,N.Z)({color:i,forceTransparentMode:this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled},null===(r=this._fastUpdates)||void 0===r?void 0:r.materialParameters)),this._needsUV=this._materials[Js.Fill]instanceof Ds;var a=this.symbolLayer.outline;if(function(e){return null!=(null===e||void 0===e?void 0:e.size)&&e.size>0&&null!=e.color&&(null==e.pattern||"style"!==e.pattern.type||"none"!==e.pattern.style)}(a)){var o=(0,cr.Dp)(a.pattern);this._materials[Js.Outline]=new hr.U({width:(0,pt.F2)(a.size),color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:o,cap:nr(a.patternCap||"butt")})}this._context.stage.addMany(this._materials)}}},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.removeMany(this._materials),this._materials.length=0}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,js,this.symbolLayer.type))return null;var r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===n.mode),this._createMaterials(),this.draped?this._createAsOverlay(t,r):this._createAs3DShape(t,r,n)}},{key:"applyRendererDiff",value:function(e,t){for(var r in e.diff){var n;if("visualVariables"!==r)return ie.W.RecreateSymbol;if(!(0,zt.Tc)(this._fastUpdates,t,Ws))return ie.W.RecreateSymbol;null===(n=this._materials[Js.Fill])||void 0===n||n.setParameters(this._fastUpdates.materialParameters)}return ie.W.FastUpdate}},{key:"layerOpacityChanged",value:function(){if(null!=this._materials[Js.Fill]){var e,t,r=this._materials[Js.Fill].parameters.color,n=null===(e=this.symbolLayer)||void 0===e||null===(t=e.material)||void 0===t?void 0:t.color,i=this._getCombinedOpacity(n);this._materials[Js.Fill].setParameters({color:[r[0],r[1],r[2],i],forceTransparentMode:this.needsDrivenTransparentPass})}if(null!=this._materials[Js.Outline]){var a=this._materials[Js.Outline].parameters.color;this._materials[Js.Outline].setParameters({color:[a[0],a[1],a[2],this._getOutlineOpacity()]})}}},{key:"layerElevationInfoChanged",value:function(e,t,n){var i=this._elevationContext.mode,a=(0,te.GC)(r.elevationModeChangeTypes,n,i);if(a!==te.lO.UPDATE)return a;var o=(0,te.Xf)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){var e;if(null!==(e=this._materials[Js.Fill])&&void 0!==e&&e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._materials[Js.Outline]){var t={hasSlicePlane:this._context.slicePlaneEnabled};this._materials[Js.Outline].setParameters(t)}return!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"_createAs3DShape",value:function(e,t,r){var n,i=pe(e.geometry);if(!i)return null;var a=Te(i,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new Xs(a,t,this._context.layer.uid,e.uid),s=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=(0,br.xx)(4*s,!0),o.boundingRect=(0,Y.bg)(9*s,!0),os(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=null===(n=this._context.stage.renderView)||void 0===n?void 0:n.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._materials[Js.Outline]&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","FillSymbol3DLayer"),0===o.outGeometries.length)return null;var l=new Me.T({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),u=new M.z(this,l,o.outGeometries,null,null,Bs,r);return u.alignedSampledElevation=o.renderData.sampledElevation,u.needsElevationUpdates=(0,te.Xf)(r.mode),u}},{key:"_createAs3DShapeFill",value:function(e,t){var r,i=t.renderData.polygons,a=(0,n.Z)(i);try{for(a.s();!(r=a.n()).done;){var o,s=r.value,l=s.position,u=s.mapPositions,c=s.holeIndices,h=s.index,d=s.count;if(null==this._context.clippingExtent||((0,C.cS)(Ys),(0,C.G1)(Ys,u),(0,C.Zp)(Ys,this._context.clippingExtent))){var f=de(u,c,this._context.elevationProvider.spatialReference);if(0!==f.length){var v=null===(o=this._fastUpdates)||void 0===o?void 0:o.visualVariables.color,p=fe({material:this._materials[Js.Fill],indices:f,mapPositions:u,attributeData:{position:l,color:v?null:t.color,colorFeature:v?(0,zt.kD)(v.field,e):null,uvMapSpace:this._needsUV?(0,br.AA)(t.uvMapSpace,4*h,4*d):null,boundingRect:this._needsUV?(0,Y.Rq)(t.boundingRect,9*h,9*d):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(p)}}}}catch(m){a.e(m)}finally{a.f()}}},{key:"_createAs3DShapeOutline",value:function(e){if(null!=this._materials[Js.Outline]){var t,r=e.renderData.outlines,i=(0,n.Z)(r);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.mapPositions,s=a.position;if(null==this._context.clippingExtent||((0,C.cS)(Ys),(0,C.G1)(Ys,o),(0,C.Zp)(Ys,this._context.clippingExtent))){var l=(0,sr.Y)(this._materials[Js.Outline],{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:o,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(l)}}}catch(u){i.e(u)}finally{i.f()}}}},{key:"_createAsOverlay",value:function(e,t){var r,n=pe(e.geometry);if(null==n)return null;this._materials[Js.Fill].renderPriority=this._renderPriority+this._renderPriorityStep/2,null!=this._materials[Js.Outline]&&(this._materials[Js.Outline].renderPriority=this._renderPriority);var i=we(n,this._context.overlaySR),a=new Ks(i,t,this._context.layer.uid,e.uid),o=a.renderData.position.length/3;return this._needsUV&&(a.uvMapSpace=(0,br.xx)(4*o,!0),function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(r.isGeographic&&n===ee.JY.Global){for(var a=(0,Y.bg)(t.length),o=t.length,s=(0,is.Iu)(r),l=0;l<o;l+=3)(0,as.gH)(t,l,a,l,s);t=a}(0,b.t8)(fs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(var u=0;u<t.length;u+=3)fs[0]=Math.min(fs[0],t[u]),fs[1]=Math.min(fs[1],t[u+1]);for(var c=fs[0]%i,h=fs[1]%i,d=fs[0]-c,f=fs[1]-h,v=0;v<t.length;v+=3){var p=v/3*4;e[p]=(t[v]-d)/i,e[p+1]=(t[v+1]-f)/i,e[p+2]=d/i,e[p+3]=f/i}}(a.uvMapSpace,a.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),a.outBoundingBox=(0,C.cS)(),a.objectAndLayerIdColor=null===(r=this._context.stage.renderView)||void 0===r?void 0:r.getObjectAndLayerIdColor(a),this._createAsOverlayFill(e,a),this._materials[Js.Outline]&&this._createAsOverlayOutline(a),this._logGeometryCreationWarnings(a.renderData,n.rings,"rings","FillSymbol3DLayer"),0===a.outGeometries.length?null:new Zt(this,a.outGeometries,a.outBoundingBox,this._context.drapeSourceRenderer)}},{key:"_createAsOverlayFill",value:function(e,t){var r,i=t.renderData.polygons,a=(0,n.Z)(i);try{for(a.s();!(r=a.n()).done;){var o,s=r.value,l=s.position,u=s.holeIndices,c=s.index,h=s.count,d=(0,C.cS)(Ys);if((0,C.G1)(d,l),(0,C.Zp)(d,this._context.clippingExtent)){var f=(0,G.e)(l,u,3);if(0!==f.length){(0,C.TC)(t.outBoundingBox,d);var v=null===(o=this._fastUpdates)||void 0===o?void 0:o.visualVariables.color,p=fe({material:this._materials[Js.Fill],indices:f,attributeData:{position:l,color:v?null:t.color,colorFeature:v?(0,zt.kD)(v.field,e):null,uvMapSpace:this._needsUV?(0,br.AA)(t.uvMapSpace,4*c,4*h):null,objectAndLayerIdColor:t.objectAndLayerIdColor}});t.outGeometries.push(new Vt.z(p,t))}}}}catch(m){a.e(m)}finally{a.f()}}},{key:"_createAsOverlayOutline",value:function(e){if(null!=this._materials[Js.Outline])for(var t=e.renderData.outlines,r=0;r<t.length;++r){var n=t[r].position;if((0,C.cS)(Ys),(0,C.G1)(Ys,n),(0,C.Zp)(Ys,this._context.clippingExtent)){(0,C.TC)(e.outBoundingBox,Ys);var i=(0,sr.Y)(this._materials[Js.Outline],{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new Vt.z(i,e))}}}},{key:"_getOutlineOpacity",value:function(){var e,t,r=null===(e=this.symbolLayer)||void 0===e||null===(t=e.outline)||void 0===t?void 0:t.color;return(this.draped?1:this._getLayerOpacity())*(null!=r?r.a:0)}},{key:"_getOutlineColor",value:function(){var e,t,r=null===(e=this.symbolLayer)||void 0===e||null===(t=e.outline)||void 0===t?void 0:t.color,n=this._getOutlineOpacity();return(0,ne.Uu)(null!=r?ft.Z.toUnitRGB(r):null,n)}},{key:"test",value:function(){var e=this;return(0,N.Z)((0,N.Z)({},(0,u.Z)((0,c.Z)(r.prototype),"test",this).call(this)),{},{createAsOverlay:function(t,r){return e._createAsOverlay(t,r)},createAs3DShape:function(t,r,n){return e._createAs3DShape(t,r,n)}})}}]),r}(re.k);qs.elevationModeChangeTypes={definedChanged:te.lO.RECREATE,staysOnTheGround:te.lO.NONE,onTheGroundChanged:te.lO.RECREATE};var Js,Ys=(0,C.Ue)(),Xs=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,a)).color=n,o}return(0,l.Z)(r)}(me),Ks=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,a)).color=n,o}return(0,l.Z)(r)}(me);!function(e){e[e.Fill=0]="Fill",e[e.Outline=1]="Outline"}(Js||(Js={}));var $s=r(29481),Qs=r(78935),el=r(3173),tl=r(3250),rl=r(22487),nl=r(43164),il=r(73230),al=r(5008),ol=r(29473),sl=function(){function e(t,r,n){(0,s.Z)(this,e),this._renderer=new al.tV(t,r,n,ol.U.maxSize)}return(0,l.Z)(e,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}},{key:"create",value:function(){var e=(0,il.G)(ll,this._renderer.renderedWidth,this._renderer.renderedHeight),t=e.getContext("2d");return t.save(),this._renderer.render(t,0,0),t.restore(),new Ht.x(e,{wrap:{s:on.e8.CLAMP_TO_EDGE,t:on.e8.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}}]),e}(),ll={canvas:null},ul=(0,T.al)(0,0,1),cl=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,n,i,a))._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},o.ensureDrapedStatus(!1),o}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._drivenProperties.size){e.next=4;break}if(!(t=(0,ne.bh)(this.symbolLayer.size))){e.next=4;break}throw new F.Z("graphics3dtextsymbollayer:invalid-size",t);case 4:return e.next=6,this._createTextRenderParameters();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createTextRenderParameters",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._context.graphicsCoreOwner.view.state.rasterPixelRatio,e.next=3,nl.V.fromSymbol(this.symbolLayer,t);case 3:this._textRenderParameters=e.sent;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this)}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic,r=(0,Dt.S_)(t.geometry);if(null==r)return this.logger.warn("unsupported geometry type for text symbol: ".concat(t.geometry.type)),null;var n=this.symbolLayer.text;if(null==n||""===n)return null;var i=(0,$s.Pd)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(null!=i&&!(0,$s.as)(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '".concat(this.symbolLayer.horizontalAlignment,"' alignment)")),null;var a=this.symbolLayer.verticalAlignment,o=new tl.a(i);(0,Mt.c4)(a,o.screenOffset);var s=new tl.U(o,this.symbolLayer.horizontalAlignment,(0,Mt.j1)(a));return this._createAs3DShape(t,r,n,s)}},{key:"createLabel",value:function(e,t,r,n,i){var a=e.graphic,o=(0,Dt.S_)(a.geometry);if(null==o)return this.logger.warn("unsupported geometry type for label: ".concat(a.geometry.type)),null;var s=t.text;return!s||/^\s+$/.test(s)?null:this._createAs3DShape(a,o,s,t,r,n,i)}},{key:"setGraphicElevationContext",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,u.Z)((0,c.Z)(r.prototype),"setGraphicElevationContext",this).call(this,e,t),t.addOffsetRenderUnits(n),t}},{key:"layerOpacityChanged",value:function(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}},{key:"layerElevationInfoChanged",value:function(e,t){var r=this;return hl(e,t,(function(e,t){r.updateGraphicElevationContext(t,e)})),te.lO.UPDATE}},{key:"slicePlaneEnabledChanged",value:function(e,t){var r=this;return hl(e,t,(function(e){var t,i=(0,n.Z)(e.stageObject.geometries);try{for(i.s();!(t=i.n()).done;){t.value.material.setParameters({hasSlicePlane:r._context.slicePlaneEnabled})}}catch(a){i.e(a)}finally{i.f()}})),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"pixelRatioChanged",get:function(){return!1}},{key:"updateGraphicElevationContext",value:function(e,t){var r=t.elevationContext;this.setGraphicElevationContext(e,r,null!=t.metadata?t.metadata.elevationOffset:0),t.needsElevationUpdates=(0,te.Xf)(r.mode)||"absolute-height"===r.mode}},{key:"updateGeometry",value:function(e,t){if(this.draped||!this._validateGeometry(t))return!1;var r=e.elevationContext,n=e.stageObject;if(r.mode!==this.getGeometryElevationMode(t))return!1;var i=(0,Dt.S_)(t);if(!i)return!1;var a=(0,Dt.Cd)(n,this._context,i,r);if(null==a)return!1;var o=(0,Dt.S9)(this._context,i);return n.geometries[0].localOrigin===o&&(e.alignedSampledElevation=a,(0,Dt.dO)(e,i,this._context.elevationProvider),!0)}},{key:"_defaultElevationInfoNoZ",value:function(){return fl}},{key:"_createAs3DShape",value:function(e,t,r,n){var i,a=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){return n.placement.elevationOffset},u=this.setGraphicElevationContext(e,new Qs.o,n.placement.elevationOffset),c="polyline"===(null===(i=e.geometry)||void 0===i?void 0:i.type),h=e.uid,d=null,f=null;if(null==s){var v=(0,Mt.mq)(n.horizontalPlacement);d=new sl(r,v,this._textRenderParameters);var y=null;if(null!=this._context.sharedResources.textures){(f=this._context.sharedResources.textures.fromData(d.key,(function(){return d.create()}))).texture.events.on("unloaded",(function(){return y=(0,vt.RY)(y)}));var g=this._context.stage.renderView.textures.acquire(f.texture.id);if(null==g||(0,m.y8)(g))return f.release(),null;y=g}}var _=dl(d,n),b={occlusionTest:!(0,p.Z)("enable-feature:non-occluded-hud"),screenOffset:n.placement.screenOffset,anchorPosition:_,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.placement.centerOffsetUnits,drawInSecondSlot:!0};if(c&&(b.shaderPolygonOffset=1e-4),s?b.textureId=s.id:f&&(b.textureId=f.texture.id),null!=n.placement.verticalOffset){var S=n.placement.verticalOffset,T=S.screenLength,w=S.minWorldLength,P=S.maxWorldLength;b.verticalOffset={screenLength:(0,pt.F2)(T),minWorldLength:w||0,maxWorldLength:null!=P?P:1/0}}var C={screenOffset:b.screenOffset,anchorPosition:_,centerOffsetUnits:b.centerOffsetUnits,verticalOffset:b.verticalOffset,shaderPolygonOffset:b.shaderPolygonOffset};if(this._context.screenSizePerspectiveEnabled){var O=this._context.sharedResources,R=O.screenSizePerspectiveSettings,E=O.screenSizePerspectiveSettingsLabels,k=(0,rl.U)(this._textRenderParameters);b.screenSizePerspective=E.overrideFontHeight(k.maxHeight),b.screenSizePerspectiveAlignment=R,C.fontHeight=k.maxHeight}b.hasSlicePlane=this._context.slicePlaneEnabled;var A=function(e,t,r){var n=e.get(r);return null==n&&(n=new Gt.A(t),e.add(r,n)),n},Z=o?A(o,b,JSON.stringify(C)):new Gt.A(b),L=n.placement.translation,I=d?(0,x.al)(d.displayWidth,d.displayHeight):x.AG,U=n.placement.centerOffset,D=ul,z=(0,x.Ue)(),N=(0,Ft.dV)(Z,D,L,null,I,U,z,null),F=(0,Dt.ZC)(this._context,t,N,u,h);if(null==F)return null;var V=function(t,r,i,o,s,u){var c=l()||n.placement.elevationOffset,h=a.setGraphicElevationContext(e,r,c);return(0,kt.j3)(t,h,i,o,s,u)},H=new M.z(this,F.object,[N],null==o?[Z]:null,f,V,u);H.alignedSampledElevation=F.sampledElevation,H.needsElevationUpdates=(0,te.Xf)(u.mode)||"absolute-height"===u.mode,H.getScreenSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,x.Ue)();return e[0]=d?d.displayWidth:n.displaySize[0],e[1]=d?d.displayHeight:n.displaySize[1],e};var G=new el.n(n.placement.elevationOffset,r);return H.metadata=G,(0,Dt.dO)(H,t,this._context.elevationProvider),H}}]),r}(re.k);function hl(e,t,r){e&&e.forEach((function(e){var n=t(e);null!=n&&r(n,e.graphic)}))}function dl(e,t){if("baseline"===t.verticalPlacement){var r=Mt.$A[t.horizontalPlacement],n=null!=e?e.baselineAnchorY:0;return(0,x.al)(r,n)}var i=(0,Mt.QW)(t.horizontalPlacement,t.verticalPlacement);return Mt.yY[i]}var fl={mode:"relative-to-ground",offset:0},vl=r(19093),pl=r(38499),ml=r(96856),yl=r(79246),gl=r(49810),_l=(yl.U,function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"initializeConfiguration",value:function(e,t){t.spherical=e.viewingMode===ee.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}},{key:"initializeProgram",value:function(e){return new rn.$(e.rctx,r.shader.get().build(this.configuration),tn.i)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,r=e===Vo.A.NONE,n=e===Vo.A.FrontFace;return(0,sn.sm)({blending:t.output!==Wr.H_.Normal&&t.output!==Wr.H_.Highlight&&t.output!==Wr.H_.ObjectAndLayerIdColor&&t.transparent?r?Fo.wu:(0,Fo.j7)(e):null,depthTest:t.draped?null:{func:(0,Fo.Bh)(e)},depthWrite:t.draped?null:r?t.writeDepth?sn.LZ:null:(0,Fo.K5)(e),drawBuffers:(0,Fo.V7)(e),colorWrite:sn.BK,polygonOffset:r||n?null:(0,Fo.je)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}}]),r}(en.A));_l.shader=new Qr.J(gl.W,(function(){return r.e(19106).then(r.bind(r,19106))}));var bl=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).output=Wr.H_.Color,e.transparencyPassType=Vo.A.NONE,e.spherical=!1,e.receiveShadows=!1,e.hasSlicePlane=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.hasScreenSpaceReflections=!1,e.doublePrecisionRequiresObfuscation=!1,e.hasCloudsReflections=!1,e.objectAndLayerIdColorInstanced=!1,e.draped=!1,e.multipassEnabled=!1,e.cullAboveGround=!1,e}return(0,l.Z)(r)}(hn.W);(0,un._)([(0,cn.o)({count:Wr.H_.COUNT})],bl.prototype,"output",void 0),(0,un._)([(0,cn.o)({count:Vo.A.COUNT})],bl.prototype,"transparencyPassType",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"spherical",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"receiveShadows",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"hasSlicePlane",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"transparent",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"enableOffset",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"writeDepth",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"hasScreenSpaceReflections",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"hasCloudsReflections",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"objectAndLayerIdColorInstanced",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"draped",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"multipassEnabled",void 0),(0,un._)([(0,cn.o)()],bl.prototype,"cullAboveGround",void 0),(0,un._)([(0,cn.o)({constValue:!1})],bl.prototype,"occlusionPass",void 0),(0,un._)([(0,cn.o)({constValue:No.f7.Water})],bl.prototype,"pbrMode",void 0),(0,un._)([(0,cn.o)({constValue:!0})],bl.prototype,"useCustomDTRExponentForWater",void 0),(0,un._)([(0,cn.o)({constValue:!0})],bl.prototype,"highStepCount",void 0),(0,un._)([(0,cn.o)({constValue:!1})],bl.prototype,"useFillLights",void 0);var xl=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,l.Z)(r,[{key:"_updateShadowState",value:function(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}},{key:"_updateSSRState",value:function(e){var t=null!=e.ssr.lastFrameColor;t!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t})}},{key:"_updateCloudsReflectionState",value:function(e){var t=null!=e.cloudsFade.data;t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}},{key:"ensureResources",value:function(e){return this._techniques.constructionContext.waterTextures.ensureResources(e)}},{key:"beginSlot",value:function(e){return this._output===Wr.H_.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniques.constructionContext.waterTextures.passParameters),this.ensureTechnique(_l,e)}}]),r}(qr.Z),Sl=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e,new Tl))._configuration=new bl,n._animation=new ml.d,n.produces=new Map([[Yr.r.OPAQUE_MATERIAL,function(e){return(0,Wr.D5)(e)&&!n.parameters.transparent||(0,Wr.ou)(e)}],[Yr.r.TRANSPARENT_MATERIAL,function(e){return(0,Wr.D5)(e)&&n.parameters.transparent||(0,Wr.ou)(e)}],[Yr.r.DRAPED_MATERIAL,function(e){return n.parameters.draped&&e===Wr.H_.Color||(0,Wr.ou)(e)}],[Yr.r.DRAPED_WATER,function(e){return e===Wr.H_.Normal}]]),n}return(0,l.Z)(r,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.writeDepth=!0,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Fo.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"update",value:function(e){var t=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<wl;var r=this._animation.advance(e);return this.setParameters({timeElapsed:(0,pl.D9)(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&r}},{key:"createGLMaterial",value:function(e){return new xl(e)}},{key:"createBufferWriter",value:function(){return new Kr.G((0,p.Z)("enable-feature:objectAndLayerId-rendering")?$r.lV:$r.W1)}},{key:"test",get:function(){}}]),r}(Rs.c),Tl=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).waveStrength=.06,e.waveTextureRepeat=32,e.waveDirection=(0,x.al)(1,0),e.waveVelocity=.05,e.flowStrength=.015,e.flowOffset=-.5,e.animationSpeed=.35,e.timeElapsed=0,e.color=(0,gt.al)(0,0,0,0),e.transparent=!0,e.hasSlicePlane=!1,e.draped=!1,e.receiveShadows=!0,e.hasScreenSpaceReflections=!1,e.hasCloudsReflections=!1,e.origin=(0,T.Ue)(),e.modelTransformation=null,e}return(0,l.Z)(r)}(Jr.Mt),wl=35e3,Pl={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Cl=["polyline","polygon","extent"],Ol=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){return(0,s.Z)(this,r),t.call(this,e,n,i,a)}return(0,l.Z)(r,[{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this),this._context.stage.remove(this._materials[0]),this._materials.length=0}},{key:"createGraphics3DGraphic",value:function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry,Cl,this.symbolLayer.type))return null;var r=this.setGraphicElevationContext(t);return this.ensureDrapedStatus("on-the-ground"===r.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(t):this._createAs3DShape(t,r,t.uid)}},{key:"ensureMaterial",value:function(){if(!this._materials[0]){var e=new Tl,t=this.symbolLayer.color;null!=t&&(e.color=ft.Z.toUnitRGBA(t));var n=this._getCombinedOpacity(t,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],n],e.transparent=n<1||this.needsDrivenTransparentPass,e.waveDirection=null!=this.symbolLayer.waveDirection?r.headingVectorFromAngle(this.symbolLayer.waveDirection):(0,x.al)(0,0);var i=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,a=Pl[i];e.waveStrength=a.waveStrength,e.waveTextureRepeat=a.textureRepeat,e.waveVelocity=a.waveVelocity,e.flowStrength=a.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.draped=this.draped,this._materials[0]=new Sl(e),this._context.stage.add(this._materials[0])}}},{key:"layerOpacityChanged",value:function(){if(null!=this._materials[0]){var e=this._materials[0].parameters.color,t=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=t<1||this.needsDrivenTransparentPass;this._materials[0].setParameters({color:[e[0],e[1],e[2],t],transparent:r})}}},{key:"layerElevationInfoChanged",value:function(e,t,n){var i=this._elevationContext.mode,a=(0,te.GC)(r.elevationModeChangeTypes,n,i);if(a!==te.lO.UPDATE)return a;var o=(0,te.Xf)(i);return this.updateGraphics3DGraphicElevationInfo(e,t,(function(){return o}))}},{key:"slicePlaneEnabledChanged",value:function(){var e;return null!==(e=this._materials[0])&&void 0!==e&&e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}},{key:"physicalBasedRenderingChanged",value:function(){return!0}},{key:"_createAs3DShape",value:function(e,t,r){var n,i=pe(e.geometry);if(null==i)return null;var a=Te(i,this._context.elevationProvider,this._context.renderCoordsHelper,t),o=a.position.length/3,s=(0,Y.bg)(2*o);Rl(s,a.mapPositions,o,this._context.elevationProvider.spatialReference);var l=new Ll(a,s,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=null===(n=this._context.stage.renderView)||void 0===n?void 0:n.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,i.rings,"rings","WaterSymbol3DLayer"),0===l.outGeometries.length)return null;var u=new Me.T({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),c=new M.z(this,u,l.outGeometries,null,null,kt.Wf,t);return c.alignedSampledElevation=l.renderData.sampledElevation,c.needsElevationUpdates=(0,te.Xf)(t.mode),c}},{key:"_create3DShapeGeometries",value:function(e){var t,r=e.renderData.polygons,i=e.uvCoords,a=(0,n.Z)(r);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.count,l=o.index,u=o.position,c=o.mapPositions,h=o.holeIndices;if(null==this._context.clippingExtent||((0,C.cS)(Zl),(0,C.G1)(Zl,c),(0,C.Zp)(Zl,this._context.clippingExtent))){var d=(0,G.e)(c,h,3);if(0!==d.length){var f=(0,Y.Rq)(i,2*l,2*s),v=ve({material:this._materials[0],indices:d,mapPositions:c,attributeData:{position:u,uv0:f}},e.objectAndLayerIdColor);e.outGeometries.push(v)}}}}catch(p){a.e(p)}finally{a.f()}}},{key:"_createAsOverlay",value:function(e){var t,r=pe(e.geometry);if(null==r)return null;this._materials[0].renderPriority=this._renderPriority;var n=we(r,this._context.overlaySR),i=n.position.length/3,a=(0,Y.bg)(2*i);Rl(a,n.position,i,this._context.overlaySR);var o=new Il(n,a,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=null===(t=this._context.stage.renderView)||void 0===t?void 0:t.getObjectAndLayerIdColor(o),o.outBoundingBox=(0,C.cS)(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),0===o.outGeometries.length?null:new Zt(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}},{key:"_createAsOverlayWater",value:function(e){var t,r=e.uvCoords,i=e.renderData.polygons,a=(0,n.Z)(i);try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.position,l=o.holeIndices,u=o.index,c=o.count;if((0,C.cS)(Zl),(0,C.G1)(Zl,s),(0,C.Zp)(Zl,this._context.clippingExtent)){(0,C.TC)(e.outBoundingBox,Zl);var h=(0,G.e)(s,l,3);if(0!==h.length){var d=(0,Y.Rq)(r,2*u,2*c),f=ve({material:this._materials[0],indices:h,attributeData:{position:s,uv0:d}},e.objectAndLayerIdColor);e.outGeometries.push(new Vt.z(f,e))}}}}catch(v){a.e(v)}finally{a.f()}}},{key:"test",value:function(){var e=this;return(0,N.Z)((0,N.Z)({},(0,u.Z)((0,c.Z)(r.prototype),"test",this).call(this)),{},{create3DShape:function(t){return e._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid)},ensureMaterial:function(){return e.ensureMaterial()}})}}],[{key:"headingVectorFromAngle",value:function(e){var t=(0,x.Ue)(),r=(0,po.c$)(e);return t[0]=Math.sin(r),t[1]=Math.cos(r),t}}]),r}(re.k);function Rl(e,t,r,n){var i=(0,H.c9)(n);(0,O.cS)(kl);for(var a=0;a<r;a++)(0,b.t8)(Al,t[3*a],t[3*a+1]),(0,O.Ho)(kl,Al);(0,vl.b)(kl,kl,i);var o=kl[0]%Ol.unitSizeOfTexture,s=kl[1]%Ol.unitSizeOfTexture;El[0]=kl[0]-o,El[1]=kl[1]-s;for(var l=0;l<r;l++)e[2*l]=(t[3*l]*i-El[0])/Ol.unitSizeOfTexture,e[2*l+1]=(t[3*l+1]*i-El[1])/Ol.unitSizeOfTexture}Ol.unitSizeOfTexture=100,Ol.elevationModeChangeTypes={definedChanged:te.lO.RECREATE,staysOnTheGround:te.lO.NONE,onTheGroundChanged:te.lO.RECREATE};var El=(0,x.Ue)(),kl=(0,O.Ue)(),Al=(0,x.Ue)(),Zl=(0,C.Ue)(),Ll=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,a)).uvCoords=n,o}return(0,l.Z)(r)}(me),Il=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i,a){var o;return(0,s.Z)(this,r),(o=t.call(this,e,i,a)).uvCoords=n,o}return(0,l.Z)(r)}(me);function Ul(e,t,r,n){var i,a=(null===(i=Dl[e.type])||void 0===i?void 0:i[t.type])||Ml[t.type];return a?new a(e,t,r,n):(z.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make","unknown symbol type ".concat(t.type)),null)}var Ml={icon:Jt,object:Sa,line:vr,path:$o,fill:qs,extrude:Ne,text:cl,water:Ol};var Dl={"mesh-3d":{fill:Un}},zl=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e,n,i){var a;return(0,s.Z)(this,r),(a=t.call(this,n.schedule))._symbol=e,a._context=n,a._backgroundLayers=i,a._destroyed=!1,a.symbolLayers=new Array,a.referenced=0,a._extentPadding=0,a}return(0,l.Z)(r,[{key:"symbol",get:function(){return this._symbol},set:function(e){var t=this;this._symbol=e,e.symbolLayers.forEach((function(r,n){var i=t.symbolLayers[n];null!=i&&(i.symbol=e,i.symbolLayer=r)}))}},{key:"doLoad",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,s,l,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=this._symbol.symbolLayers,this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r)),n=r.length;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length,i=[],s=function(e){var a=r.at(e);if(!1===a.enabled)return"continue";Nl.renderPriority=1-(1+e)/n,Nl.renderPriorityStep=1/n,Nl.ignoreDrivers=a.ignoreDrivers;var o=Ul(u.symbol,a,u._context,Nl),s=(0,m.$F)(t,(function(){u.symbolLayers[e]=null,o.destroy()}));s&&i.push(s),u.symbolLayers[e]=o},l=0;case 8:if(!(l<n)){e.next=15;break}if("continue"!==s(l)){e.next=12;break}return e.abrupt("continue",12);case 12:l++,e.next=8;break;case 15:return e.next=17,(0,v.Ed)(this.symbolLayers,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t){e.next=10;break}return e.prev=1,e.next=4,t.load();case 4:u._extentPadding+=Math.max(u._extentPadding,t.extentPadding),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),u.symbolLayers[r]=null;case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}());case 17:if(i.forEach((function(e){return e.remove()})),(0,m.k_)(t),!this.symbolLayers.length||this.symbolLayers.some((function(e){return!!e}))){e.next=21;break}throw new Error;case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSymbolLayerSize",value:function(e){var t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some((function(e){return null===e||void 0===e?void 0:e.queryForSnapping}))}},{key:"createGraphics3DGraphic",value:function(e,t){var r,n,i=e.graphic,a=this.symbolLayers.map((function(t){var r;return null!==(r=null===t||void 0===t?void 0:t.createGraphics3DGraphic(e))&&void 0!==r?r:null})),o=this._context.arcade||(null===(r=this._context.featureExpressionInfoContext)||void 0===r||null===(n=r.arcade)||void 0===n?void 0:n.modules)||null;return new U(i,t||this,a,e.layer,o)}},{key:"complexity",get:function(){return(0,y.IQ)(this.symbolLayers.map((function(e){return null!=e?e.complexity:null})))}},{key:"globalPropertyChanged",value:function(e,t){for(var r=this,n=this.symbolLayers.length,i=function(n){var i=r.symbolLayers[n];if(null!=i&&!i.globalPropertyChanged(e,t,(function(e){var t=e.layers[n];return t instanceof M.z?t:null})))return{v:!1}},a=0;a<n;a++){var o=i(a);if("object"===typeof o)return o.v}return!0}},{key:"applyRendererDiff",value:function(e,t){return this.loadStatus!==vi.P.LOADED?ie.W.RecreateSymbol:this.symbolLayers.reduce((function(r,n){return r!==ie.W.RecreateSymbol&&null!=n?Math.min(r,n.applyRendererDiff(e,t)):r}),ie.W.FastUpdate)}},{key:"prepareSymbolPatch",value:function(e){if(this.loadStatus!==vi.P.FAILED&&"partial"===e.diff.type){var t=e.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var r=t.symbolLayers.diff;this.symbolLayers.forEach((function(t,n){if(null!=t){var a=r[n];if(a){var o,s={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(s),(o=e.symbolStatePatches).push.apply(o,(0,i.Z)(s.symbolLayerStatePatches)),s.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((function(e,t){var r=e.layers[n];null!=r&&s.graphics3DGraphicPatches.forEach((function(e){return e(r,t)}))}))}}}))}}}},{key:"updateGeometry",value:function(e,t){return this._updateGeometryOrTransform(e,(function(e,r){return e.updateGeometry(r,t)}))}},{key:"updateTransform",value:function(e,t,r,n){return this._updateGeometryOrTransform(e,(function(e,i){return e.updateTransform(i,t,r,n)}))}},{key:"_updateGeometryOrTransform",value:function(e,t){for(var r=0;r<this.symbolLayers.length;r++){var n=this.symbolLayers[r];if(null!=n){var i=e.layers[r];if(!i||!t(n,i))return!1}}return!0}},{key:"onRemoveGraphic",value:function(e){for(var t=0;t<this.symbolLayers.length;t++){var r=this.symbolLayers[t];if(null!=r){var n=e.layers[t];null!=n&&r.onRemoveGraphic(n)}}}},{key:"getFastUpdateStatus",value:function(){var e=0,t=0,r=0;return this.symbolLayers.forEach((function(n){null!=n&&(n.loadStatus===vi.P.LOADING?e++:n.isFastUpdatesEnabled()?r++:t++)})),{loading:e,slow:t,fast:r}}},{key:"queryForSnapping",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){var o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.symbolLayers.filter(f.pC).filter((function(e){return null!=e.queryForSnapping})).map((function(e){return e.queryForSnapping(t,r,n,i)})),e.next=3,Promise.all(o);case 3:return s=e.sent,e.abrupt("return",((0,m.k_)(i),s.flat()));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){if(!this.destroyed){(0,u.Z)((0,c.Z)(r.prototype),"destroy",this).call(this);var e,t=(0,n.Z)(this.symbolLayers);try{for(t.s();!(e=t.n()).done;){var i=e.value;null!=i&&i.destroy()}}catch(a){t.e(a)}finally{t.f()}this.symbolLayers.length=0,this._destroyed=!0}}},{key:"destroyed",get:function(){return this._destroyed}}]),r}(vi.w),Nl=new D.W},49253:function(e,t,r){r.d(t,{U:function(){return a},W:function(){return o}});var n=r(43144),i=r(15671),a=(0,n.Z)((function e(t,r){(0,i.Z)(this,e),this.scheduler=t,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1})),o=(0,n.Z)((function e(){(0,i.Z)(this,e),this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}))},73614:function(e,t,r){r.d(t,{k:function(){return x}});var n=r(15671),i=r(43144),a=r(60136),o=r(29388),s=r(51995),l=(r(93169),r(32718)),u=r(12400),c=r(86361),h=r(69662),d=r(55244),f=r(69691),v=r(78935),p=r(8821),m=r(96387),y=r(41325),g=r(85042),_=r(66202),b=function(){return l.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer")},x=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e,i,a,o){var s;return(0,n.Z)(this,r),(s=t.call(this,a.schedule)).symbol=e,s.symbolLayer=i,s._context=a,s.ignoreDrivers=!1,s._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},s._materials=[],s.usedMemory=0,s.logger=b(),s._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},s.skipHighSymbolLodsChanged=!0,s._renderPriority=o.renderPriority,s._renderPriorityStep=o.renderPriorityStep,s._elevationContext=new v.o,s.complexity=s.computeComplexity(),s.ignoreDrivers=o.ignoreDrivers,s.ignoreDrivers||(s._drivenProperties=S(s._context.renderer)),s._updateElevationContext(),s}return(0,i.Z)(r,[{key:"getCachedSize",value:function(){return null}},{key:"extentPadding",get:function(){return 0}},{key:"materials",get:function(){return this._materials}},{key:"_drivenPropertiesChanged",value:function(e){if(this.ignoreDrivers)return!1;var t=this._drivenProperties,r=S(e);return r.color!==t.color||r.opacity!==t.opacity||r.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||r.size!==t.size}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"_logGeometryCreationWarnings",value:function(e,t,r,n){var i=e.projectionSuccess,a="polygons"in e?e.polygons:null,o="".concat(n," geometry failed to be created");i?!this._logGeometryValidationWarnings(t,r,n)&&a&&0===a.length&&"rings"===r&&t.length>0&&t[0].length>2&&b().warnOncePerTick("".concat(o," (filled rings should use clockwise winding - try reversing the order of vertices)")):b().warnOncePerTick("".concat(o," (failed to project geometry to view spatial reference)"))}},{key:"_logGeometryValidationWarnings",value:function(e,t,r){var n="".concat(r," geometry failed to be created");return!e.length||1===e.length&&!e[0].length?(b().warnOncePerTick("".concat(n," (no ").concat(t," were defined)")),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(b().warnOncePerTick("".concat(n," (").concat(t," should be defined as a 2D array)")),!0)}},{key:"_validateGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+" symbol: ".concat(e.type)),!1;switch(e.type){case"point":var n=e;if(!isFinite(n.x)||!isFinite(n.y))return b().warn("point coordinate is not a valid number, graphic skipped"),!1;break;case"polygon":(0,h.Zy)(e)&&b().warnOncePerTick("Fixed a non-closed polygon ring.")}return!0}},{key:"_defaultElevationInfoNoZ",value:function(){return T}},{key:"_defaultElevationInfoZ",value:function(){return w}},{key:"_updateElevationContext",value:function(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}},{key:"getDefaultElevationInfo",value:function(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}},{key:"getGeometryElevationMode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDefaultElevationInfo(e);return this._elevationContext.mode||t.mode}},{key:"setElevationInfoOverride",value:function(e){this._elevationInfoOverride=e,this._updateElevationContext()}},{key:"setGraphicElevationContext",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v.o,i=e.geometry,a=this.getDefaultElevationInfo(i);n.unit=null!=this._elevationContext.unit?this._elevationContext.unit:a.unit,n.mode=this.getGeometryElevationMode(i,a),n.offsetMeters=null!==(t=null!==(r=this._elevationContext.meterUnitOffset)&&void 0!==r?r:a.offset)&&void 0!==t?t:0;var o=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===n.mode;o&&(n.mode="relative-to-ground",n.offsetMeters=0);var s=o?p.O$:this._elevationContext.featureExpressionInfoContext;return n.updateFeatureExpressionInfoContext(s,e,this._context.layer),n}},{key:"prepareSymbolLayerPatch",value:function(e){}},{key:"updateGeometry",value:function(e,t){return!1}},{key:"updateTransform",value:function(e,t,r,n){return!1}},{key:"onRemoveGraphic",value:function(e){}},{key:"_getLayerOpacity",value:function(){var e;if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return null!==(e=this._context.graphicsCoreOwner.fullOpacity)&&void 0!==e?e:0;var t=this._context.layer.opacity;return null!==t&&void 0!==t?t:1}},{key:"_getCombinedOpacity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P,r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(null!=e?r*=e.a:t.hasIntrinsicColor||(r=0)),r}},{key:"_getCombinedOpacityAndColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P,r=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,m.Uu)(null,r);var n=null!=e?s.Z.toUnitRGB(e):u.hq;return(0,m.Uu)(n,r)}},{key:"_getVertexOpacityAndColor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,i=(0,m.Uu)(r,n);return t&&(i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t),i}},{key:"isFastUpdatesEnabled",value:function(){return null!=this._fastUpdates}},{key:"computeComplexity",value:function(){return(0,d.u)(this.symbol,this.symbolLayer)}},{key:"globalPropertyChanged",value:function(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged(t,r),!0;case"elevationInfo":var n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,n)!==f.lO.RECREATE;case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}},{key:"pixelRatioChanged",get:function(){return!0}},{key:"updateGraphics3DGraphicElevationInfo",value:function(e,t,r){var n=this,i=f.lO.UPDATE;return e.forEach((function(e){var a=t(e);if(null!=a){var o=e.graphic;n.setGraphicElevationContext(o,a.elevationContext),a.needsElevationUpdates=r(a.elevationContext.mode)}else i=f.lO.RECREATE})),i}},{key:"applyRendererDiff",value:function(e,t){return y.W.RecreateSymbol}},{key:"getFastUpdateAttrValues",value:function(e){if(!this._fastUpdates)return null;var t=this._fastUpdates.visualVariables,r=t.size?(0,_.kD)(t.size.field,e):0,n=t.color?(0,_.kD)(t.color.field,e):0,i=t.opacity?(0,_.kD)(t.opacity.field,e):0;return(0,c.al)(r,n,i,0)}},{key:"draped",get:function(){return this._draped}},{key:"ensureDrapedStatus",value:function(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&b().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}},{key:"test",value:function(){var e=this;return{drivenProperties:this._drivenProperties,getVisVarFields:function(){var t,r,n,i,a,o,s,l,u,c,h,d;return{size:null!==(t=null===(r=e._fastUpdates)||void 0===r||null===(n=r.visualVariables.size)||void 0===n?void 0:n.field)&&void 0!==t?t:null,color:null!==(i=null===(a=e._fastUpdates)||void 0===a||null===(o=a.visualVariables.color)||void 0===o?void 0:o.field)&&void 0!==i?i:null,opacity:null!==(s=null===(l=e._fastUpdates)||void 0===l||null===(u=l.visualVariables.opacity)||void 0===u?void 0:u.field)&&void 0!==s?s:null,rotation:null!==(c=null===(h=e._fastUpdates)||void 0===h||null===(d=h.visualVariables.rotation)||void 0===d?void 0:d.field)&&void 0!==c?c:null}}}}}]),r}(g.w);function S(e){var t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach((function(e){switch(e.type){case"color":if(t.color=!0,e.stops)for(var r=0;r<e.stops.length;r++){var n=e.stops[r].color;n&&(t.opacity=!0,n.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}})),t}var T={mode:"on-the-ground",offset:0,unit:"meters"},w={mode:"absolute-height",offset:0,unit:"meters"},P={hasIntrinsicColor:!1}},19477:function(e,t,r){r.d(t,{l:function(){return f}});var n=r(74165),i=r(15861),a=r(15671),o=r(43144),s=r(88301),l=r(61120),u=r(60136),c=r(29388),h=r(55244),d=r(41325),f=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e,n,i){var o;return(0,a.Z)(this,r),(o=t.call(this,n)).symbol=e,o._convert=i,o.symbologySnappingSupported=!1,o.graphics3DSymbol=null,o.referenced=0,o}return(0,o.Z)(r,[{key:"getSymbolLayerSize",value:function(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}},{key:"symbolLayers",get:function(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}},{key:"doLoad",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.symbol.fetchSymbol({signal:t});case 2:if((r=e.sent).id=this.symbol.id,this.graphics3DSymbol=this._convert(r),e.t0=null!=this.graphics3DSymbol,!e.t0){e.next=9;break}return e.next=9,this.graphics3DSymbol.load();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createGraphics3DGraphic",value:function(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}},{key:"complexity",get:function(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:h.WU}},{key:"globalPropertyChanged",value:function(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}},{key:"applyRendererDiff",value:function(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):d.W.RecreateSymbol}},{key:"prepareSymbolPatch",value:function(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}},{key:"updateGeometry",value:function(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)}},{key:"updateTransform",value:function(e,t,r,n){var i,a;return null!==(i=null===(a=this.graphics3DSymbol)||void 0===a?void 0:a.updateTransform(e,t,r,n))&&void 0!==i&&i}},{key:"onRemoveGraphic",value:function(){}},{key:"getFastUpdateStatus",value:function(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}},{key:"destroy",value:function(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,(0,s.Z)((0,l.Z)(r.prototype),"destroy",this).call(this)}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]),r}(r(85042).w)},3250:function(e,t,r){r.d(t,{U:function(){return u},a:function(){return l}});var n=r(43144),i=r(15671),a=r(6644),o=r(12400),s=r(86361),l=(0,n.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.Ue)(),u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,s.al)(0,0,0,-1),c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,o.Ue)(),d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;(0,i.Z)(this,e),this.verticalOffset=t,this.anchor=r,this.hasLabelVerticalOffset=n,this.screenOffset=l,this.centerOffset=u,this.centerOffsetUnits=c,this.translation=h,this.elevationOffset=d})),u=(0,n.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"center",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,a.Ue)();(0,i.Z)(this,e),this.placement=t,this.horizontalPlacement=r,this.verticalPlacement=n,this.text=o,this.displaySize=s}))},85042:function(e,t,r){r.d(t,{P:function(){return n},w:function(){return u}});var n,i,a=r(15671),o=r(43144),s=r(92026),l=r(66978),u=function(){function e(t){(0,a.Z)(this,e),this.schedule=t,this._abortController=null,this._loadStatus=n.LOADING,this._loadError=null,this._loader=null,this.logger=null}return(0,o.Z)(e,[{key:"destroy",value:function(){this.abortLoad()}},{key:"loadStatus",get:function(){return this._loadStatus}},{key:"load",value:function(e,t){var r,i,a=this;return this._loadStatus===n.LOADED?(e&&e(),null!==(r=this._loader)&&void 0!==r?r:Promise.resolve()):this._loadStatus===n.FAILED?(t&&t(this._loadError),null!==(i=this._loader)&&void 0!==i?i:Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then((function(){a._abortController=null,a._loadStatus=n.LOADED}),(function(e){throw a._loadError=e,a._abortController=null,a._loadStatus=n.FAILED,!(0,l.D_)(e)&&a.logger&&e.message&&a.logger.warn(e.message),e}))),this._loader.then(e,t).catch((function(){})),this._loader)}},{key:"abortLoad",value:function(){null!=this._abortController?this._abortController=(0,s.IM)(this._abortController):this._loadStatus===n.LOADING&&(this._loadStatus=n.FAILED),this._loader=null}}]),e}();(i=n||(n={}))[i.LOADING=0]="LOADING",i[i.LOADED=1]="LOADED",i[i.FAILED=2]="FAILED"},60314:function(e,t,r){r.d(t,{SX:function(){return h},VT:function(){return c},Y6:function(){return l},eH:function(){return s},ti:function(){return u}});var n=r(60136),i=r(29388),a=r(43144),o=r(15671),s=(0,a.Z)((function e(t){var r,n,i,a;(0,o.Z)(this,e),this.estimated=!1,this.verticesPerFeature=null!==(r=t.verticesPerFeature)&&void 0!==r?r:0,this.verticesPerCoordinate=null!==(n=t.verticesPerCoordinate)&&void 0!==n?n:0,this.drawCallsPerFeature=null!==(i=t.drawCallsPerFeature)&&void 0!==i?i:0,this.memory=null!==(a=t.memory)&&void 0!==a?a:new h})),l=function(e){(0,n.Z)(r,e);var t=(0,i.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).estimated=!0,n}return(0,a.Z)(r)}(s),u=function(e){(0,n.Z)(r,e);var t=(0,i.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,n)).numComplexities=e,i}return(0,a.Z)(r)}(s),c=function(e){(0,n.Z)(r,e);var t=(0,i.Z)(r);function r(e,n){var i;return(0,o.Z)(this,r),(i=t.call(this,n)).numComplexities=e,i}return(0,a.Z)(r)}(l),h=(0,a.Z)((function e(){(0,o.Z)(this,e),this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}))},61310:function(e,t,r){r.d(t,{Cj:function(){return a},PY:function(){return i},aT:function(){return o}});var n=r(86361),i=1.2,a=n.AG,o=4},55244:function(e,t,r){r.d(t,{BN:function(){return g},IQ:function(){return v},V9:function(){return f},WU:function(){return d},bz:function(){return p},iu:function(){return _},u:function(){return y}});var n=r(1413),i=r(37762),a=r(41644),o=r(73627),s=r(53727),l=r(22894),u=r(60314),c=r(97689),h=r(86802),d=new u.Y6({});function f(e){return"web-style"===e.type?d:v(e.symbolLayers.toArray().map((function(t){return y(e,t)})))}function v(e){var t,r=0,n=0,a=0,o=!1,s=0,l=new u.SX,c=(0,i.Z)(e);try{for(c.s();!(t=c.n()).done;){var h=t.value;null!=h&&(r+=h.verticesPerFeature,n+=h.verticesPerCoordinate,a+=h.drawCallsPerFeature,l.bytesPerFeature+=h.memory.bytesPerFeature,l.bytesPerFeatureLabel+=h.memory.bytesPerFeatureLabel,l.resourceBytes+=h.memory.resourceBytes,l.draped.bytesPerFeature+=h.memory.bytesPerFeature,l.draped.bytesPerFeatureLabel+=h.memory.bytesPerFeatureLabel,o=o||h.estimated,++s)}}catch(d){c.e(d)}finally{c.f()}return o?new u.VT(s,{verticesPerFeature:r,verticesPerCoordinate:n,drawCallsPerFeature:a,memory:l}):new u.ti(s,{verticesPerFeature:r,verticesPerCoordinate:n,drawCallsPerFeature:a,memory:l})}function p(e){var t=v(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}var m={};function y(e,t){var r,i,d,f=g(e,t),v=(0,c.eU)(t)?2:0;switch(t.type){case"extrude":return new u.eH({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:v,memory:f});case"fill":if("mesh-3d"===e.type)return new u.eH({drawCallsPerFeature:v,memory:f});if(null!=t.outline&&t.outline.size>0)return new u.eH({verticesPerFeature:-12,verticesPerCoordinate:9,memory:f});case"water":return new u.eH({verticesPerFeature:-6,verticesPerCoordinate:3,memory:f});case"line":return new u.eH({verticesPerFeature:-6,verticesPerCoordinate:6,memory:f});case"object":return null!==(r=t.resource)&&void 0!==r&&r.href?new u.Y6({verticesPerFeature:100,memory:f}):(0,n.Z)((0,n.Z)({},function(e){var t=m[e];if(t)return t;var r=_((0,l.t)(e,new h.Gp({})).levels);return m[e]=new u.eH({verticesPerFeature:r}),m[e]}(null!==(i=null===(d=t.resource)||void 0===d?void 0:d.primitive)&&void 0!==i?i:o.S)),{},{memory:f});case"path":var p=0,y=0;switch(t.profile){case"circle":p=s.JK;break;case"quad":p=4;break;default:return void(0,a.Bg)(t.profile)}switch(t.join){case"round":y=s.t7;break;case"miter":case"bevel":y=1;break;default:return}var b=2*p,x=p*y*2,S=x+b,T=-2*x-b;switch(t.cap){case"none":break;case"butt":case"square":T+=2*(p-1);break;case"round":T+=2*(p*(s.wg-1)*2+p);break;default:return}return new u.eH({verticesPerFeature:T,verticesPerCoordinate:S,memory:f});case"text":case"icon":return new u.eH({verticesPerFeature:6,memory:f});default:return}}function g(e,t){var r="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?b.EXTRUDE_EDGES:b.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?b.FILL_OUTLINE:b.FILL;case"water":return b.FILL;case"line":return"round"===t.join?b.LINE_ROUND:b.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return b.PATH_ROUND_CIRCLE;case"quad":return b.PATH_ROUND_QUAD;default:return void(0,a.Bg)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return b.PATH_MITER_CIRCLE;case"quad":return b.PATH_MITER_QUAD;default:return void(0,a.Bg)(t.profile)}default:return}case"object":return r?b.OBJECT_POINT:b.OBJECT_POLYGON;case"icon":case"text":return r?b.ICON_POINT:b.ICON_POLYGON;default:return}}function _(e){return e.reduce((function(e,t,r){return e+t.numVertices*(1/Math.pow(10,r))}),0)/e.reduce((function(e,t,r){return e+1/Math.pow(10,r)}),0)}var b={ICON_POINT:{bytesPerFeature:2379.8272296852992,bytesPerFeatureLabel:852.246235,resourceBytes:0,draped:{bytesPerFeature:1868.2382921559424,bytesPerFeatureLabel:839.205415}},ICON_POLYGON:{bytesPerFeature:2957.8429876524656,bytesPerFeatureLabel:862.5307816666666,resourceBytes:0,draped:{bytesPerFeature:2579.7767085451133,bytesPerFeatureLabel:856.9298550000001}},OBJECT_POINT:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999,resourceBytes:0,draped:{bytesPerFeature:603.543820573039,bytesPerFeatureLabel:717.4551849999999}},OBJECT_POLYGON:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998,resourceBytes:0,draped:{bytesPerFeature:1111.1693389308373,bytesPerFeatureLabel:707.4535949999998}},LINE_MITER:{bytesPerFeature:3081.208408220661,bytesPerFeatureLabel:858.6749016666668,resourceBytes:0,draped:{bytesPerFeature:2682.57863388475,bytesPerFeatureLabel:844.6118016666666}},LINE_ROUND:{bytesPerFeature:3209.3236242927915,bytesPerFeatureLabel:858.1810416666667,resourceBytes:0,draped:{bytesPerFeature:2687.6256038096126,bytesPerFeatureLabel:849.578535}},PATH_MITER_CIRCLE:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415,resourceBytes:0,draped:{bytesPerFeature:38708.74276663992,bytesPerFeatureLabel:858.70415}},PATH_ROUND_CIRCLE:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001,resourceBytes:0,draped:{bytesPerFeature:42098.00590216518,bytesPerFeatureLabel:868.3632500000001}},PATH_MITER_QUAD:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355,resourceBytes:0,draped:{bytesPerFeature:25037.823002405767,bytesPerFeatureLabel:835.93355}},PATH_ROUND_QUAD:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955,resourceBytes:0,draped:{bytesPerFeature:40320.254760224525,bytesPerFeatureLabel:851.66955}},FILL:{bytesPerFeature:3147.43349219103,bytesPerFeatureLabel:850.7598550000001,resourceBytes:0,draped:{bytesPerFeature:2673.7898488975106,bytesPerFeatureLabel:846.6459950000002}},FILL_OUTLINE:{bytesPerFeature:4565.099993465867,bytesPerFeatureLabel:855.334515,resourceBytes:0,draped:{bytesPerFeature:3904.46969705314,bytesPerFeatureLabel:844.7081016666667}},EXTRUDE:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333,resourceBytes:0,draped:{bytesPerFeature:7551.2282834569505,bytesPerFeatureLabel:849.5513283333333}},EXTRUDE_EDGES:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335,resourceBytes:0,draped:{bytesPerFeature:2959.8379634500698,bytesPerFeatureLabel:602.0969283333335}}}},70446:function(e,t,r){var n,i;r.d(t,{E:function(){return i},P:function(){return n}}),function(e){e[e.USER=1]="USER",e[e.SCALE_RANGE=2]="SCALE_RANGE",e[e.FILTER=4]="FILTER",e[e.DECONFLICTION=8]="DECONFLICTION",e[e.ALL_GRAPHIC=15]="ALL_GRAPHIC",e[e.ALL_LABEL=255]="ALL_LABEL"}(n||(n={})),function(e){e[e.GRAPHIC=1]="GRAPHIC",e[e.LABEL=16]="LABEL"}(i||(i={}))},41325:function(e,t,r){var n;r.d(t,{W:function(){return n}}),function(e){e[e.RecreateSymbol=0]="RecreateSymbol",e[e.RecreateGraphics=1]="RecreateGraphics",e[e.FastUpdate=2]="FastUpdate"}(n||(n={}))},31908:function(e,t,r){r.d(t,{$A:function(){return o},EP:function(){return c},QW:function(){return h},c4:function(){return f},j1:function(){return d},mq:function(){return l},yY:function(){return s},zi:function(){return u}});var n=r(13611),i=r(6644),a=r(5008),o=Object.freeze({left:0,center:.5,right:1}),s=Object.freeze({"bottom-left":(0,i.al)(0,0),bottom:(0,i.al)(.5,0),"bottom-right":(0,i.al)(1,0),left:(0,i.al)(0,.5),center:(0,i.al)(.5,.5),right:(0,i.al)(1,.5),"top-left":(0,i.al)(0,1),top:(0,i.al)(.5,1),"top-right":(0,i.al)(1,1)});function l(e){switch(e){case"left":return a.vU.Left;case"right":return a.vU.Right;default:return a.vU.Center}}function u(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function c(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function h(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}}function d(e){return"middle"===e?"center":e}function f(e,t){switch(e){case"top":return(0,n.t8)(t,0,a.Wg);case"bottom":return(0,n.t8)(t,0,-a.Wg);default:return(0,n.JG)(t,i.AG)}}},36759:function(e,t,r){r.d(t,{Cd:function(){return d},S9:function(){return m},S_:function(){return p},ZC:function(){return h},dO:function(){return v}});var n=r(12400),i=r(68859),a=r(41414),o=r(69662),s=r(55946),l=r(69691),u=r(96387),c=r(66327);function h(e,t,r,n,i){if(f(e,t))return null;r.localOrigin=m(e,t);var a=new c.T({geometries:[r],castShadow:!1,layerUid:e.layer.uid,graphicUid:i,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:(0,l.bD)(a,t,e.elevationProvider,e.renderCoordsHelper,n)}}function d(e,t,r,n){return f(t,r)?null:(0,l.bD)(e,r,t.elevationProvider,t.renderCoordsHelper,n)}function f(e,t){var r=e.clippingExtent;return!!r&&((0,i.K)(t,y,e.elevationProvider.spatialReference),!(0,a.BD)(r,y))}function v(e,t,r){var n=e.elevationContext,a=r.spatialReference;(0,i.K)(t,y,a),n.centerPointInElevationSR=(0,s.T)(y[0],y[1],t.hasZ?y[2]:0,null!=a?a:null)}function p(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,u.zE)(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=(0,o.n8)(t,(0,o.ok)(t)/2);return(0,s.T)(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.origin}return null}function m(e,t){return(0,i.K)(t,y,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(y)}var y=(0,n.Ue)()},22894:function(e,t,r){r.d(t,{F:function(){return a},t:function(){return o}});r(93169);var n=r(70619),i=r(72635);function a(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function o(e,t){var r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new i.hO(e.map((function(e){var a=t(e.tesselation);return r&&(0,n.Cr)(a),new i.T6([new i.QD(a)],e.minScreenSpaceRadius)})))};switch(e){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],(function(e){return(0,n.mj)(t,.5,e,!0)}));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return(0,n.IG)(t,1)}));case"cone":return r(s,(function(e){return(0,n.QL)(t,1,.5,e,!1)}),!0);case"inverted-cone":return r(s,(function(e){return(0,n.QL)(t,1,.5,e,!0)}),!0);case"cylinder":return r(s,(function(e){return(0,n.nb)(t,1,.5,e,[0,0,1],[0,0,.5])}));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return(0,n.AW)(t,1)}),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],(function(){return(0,n.B2)(t,1)}),!0);default:return}}var s=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},20488:function(e,t,r){r.d(t,{W:function(){return a},l:function(){return o}});var n=r(43144),i=r(15671),a=(0,n.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;(0,i.Z)(this,e),this.usedMemory=t,this.displayedFeatures=r,this.totalFeatures=n,this.maximumFeatures=a,this.nodes=o,this.core=s}));function o(e){return"performanceInfo"in e}},4035:function(e,t,r){r.d(t,{c:function(){return o}});var n=r(43144),i=r(15671),a=r(65156),o=(0,n.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scene";(0,i.Z)(this,e),this.context=t,this.extent=(0,a.cS)()}))},57557:function(e,t,r){r.d(t,{q:function(){return C}});var n=r(37762),i=r(15671),a=r(43144),o=r(41644),s=r(16889),l=r(29134),u=r(7025),c=r(32035),h=r(12400),d=r(83448),f=r(37998),v=r(77258),p=r(5986),m=r(41414),y=r(65156),g=r(95773),_=r(85981),b=r(55652),x=r(40885),S=r(50951),T=r(83281),w=.5*Math.PI,P=w/Math.PI*180,C=function(){function e(t){(0,i.Z)(this,e),this._renderCoordsHelper=t.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,h.Ue)(),direction:(0,h.Ue)()};for(var r=0;r<4;r++)this._extent[r]={origin:(0,h.Ue)(),direction:(0,h.Ue)(),cap:{next:null,direction:(0,h.Ue)()}},this._planes[r]=(0,b.Ue)();this._planes[g.Nu.NEAR]=(0,b.Ue)(),this._planes[g.Nu.FAR]=(0,b.Ue)(),this._planesWithoutFar=this._planes.slice(0,5)}return(0,a.Z)(e,[{key:"update",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this._extent;this._toRenderBoundingExtent(e,t,r),(0,c.g)(this._center.origin,i[0].origin,i[2].origin),(0,c.j)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||(0,c.j)(this._center.direction,this._center.direction,-1);for(var a=0;a<4;a++){var o=i[a];this._renderCoordsHelper.worldUpAtPosition(o.origin,o.direction);var s=i[3===a?0:a+1];o.cap.next=s.origin,(0,c.E)(o.cap.direction,o.origin,s.origin),(0,b.my)(o.direction,o.cap.direction,o.origin,this._planes[a]),n||(0,c.j)(o.direction,o.direction,-1)}(0,b.my)(i[0].cap.direction,i[1].cap.direction,i[0].origin,this._planes[g.Nu.NEAR]),n?(0,b.tk)(this._planes[g.Nu.NEAR],this._planes[g.Nu.FAR]):((0,b.JG)(this._planes[g.Nu.FAR],this._planes[g.Nu.NEAR]),(0,b.tk)(this._planes[g.Nu.NEAR],this._planes[g.Nu.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,d.Iu)(this._maxSpanSpatialReference).radius}},{key:"isVisibleInFrustum",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return!1;if(this._renderCoordsHelper.viewingMode===S.JY.Global){var n=this._maxSpanSpatialReference.isGeographic?P:w*t;if(this._maxSpan>n)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){var i=this._extent[0];return!(r||!e.intersectsRay((0,x.re)(i.origin,i.direction)))}for(var a=0;a<this._extent.length;a++){var o=this._extent[a];if(!r&&e.intersectsRay((0,x.re)(o.origin,o.direction)))return!0;if(e.intersectsLineSegment((0,_.zk)(o.origin,o.cap.next,L),o.cap.direction))return!0}for(var s=r?this._planes:this._planesWithoutFar,l=0;l<e.lines.length;l++){var u=e.lines[l];if((0,T.kD)(s,u.origin,u.endpoint,u.direction))return!0}return!1}},{key:"_toRenderBoundingExtentGlobal",value:function(e,t,r){(0,y.be)(e,R),R[2]=r,(0,f.B)(t,R,E,this._renderCoordsHelper.spatialReference),(0,l.U_)(k,E),(0,m.cS)(A);var i,a=(0,n.Z)(O);try{for(a.s();!(i=a.n()).done;)for(var o=i.value,u=o.x0,h=o.x1,d=o.y0,v=o.y1,g=0;g<5;g++){var _=g/4;R[0]=(0,s.t7)(e[u],e[h],_),R[1]=(0,s.t7)(e[d],e[v],_),R[2]=r,(0,p.S)(R,t,R,this._renderCoordsHelper.spatialReference),(0,c.h)(R,R,k),(0,m.pp)(A,R)}}catch(x){a.e(x)}finally{a.f()}(0,c.s)(this._extent[0].origin,A[0],A[1],A[2]),(0,c.s)(this._extent[1].origin,A[3],A[1],A[2]),(0,c.s)(this._extent[2].origin,A[3],A[4],A[2]),(0,c.s)(this._extent[3].origin,A[0],A[4],A[2]);for(var b=0;b<4;++b)(0,c.h)(this._extent[b].origin,this._extent[b].origin,E)}},{key:"_toRenderBoundingExtentLocal",value:function(e,t,r){(0,v.d)(e,t,Z,this._renderCoordsHelper.spatialReference),(0,c.s)(this._extent[0].origin,Z[0],Z[1],r),(0,c.s)(this._extent[1].origin,Z[2],Z[1],r),(0,c.s)(this._extent[2].origin,Z[2],Z[3],r),(0,c.s)(this._extent[3].origin,Z[0],Z[3],r)}},{key:"_toRenderBoundingExtent",value:function(e,t,r){switch(this._renderCoordsHelper.viewingMode){case S.JY.Global:this._toRenderBoundingExtentGlobal(e,t,r);break;case S.JY.Local:this._toRenderBoundingExtentLocal(e,t,r);break;default:(0,o.Bg)(this._renderCoordsHelper.viewingMode)}}},{key:"_isVisibleInFrustumGlobal",value:function(e){if((0,b.jH)(e.planes[g.Nu.NEAR],this._center.origin)<0&&(0,c.m)(this._center.direction,e.direction)<0)return!0;for(var t=0;t<4;t++){var r=this._extent[t];if((0,b.jH)(e.planes[g.Nu.NEAR],r.origin)<0&&(0,c.m)(r.direction,e.direction)<0)return!0}return!1}}]),e}(),O=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],R=(0,h.Ue)(),E=(0,u.Ue)(),k=(0,u.Ue)(),A=(0,m.Ue)(),Z=(0,y.Ue)(),L=(0,_.Ue)()},79685:function(e,t,r){r.d(t,{Y:function(){return m},c:function(){return O}});var n=r(13611),i=r(6644),a=r(86361),o=r(83448),s=r(96334),l=r(86372),u=r(38461),c=r(39406),h=r(50951),d=r(91526),f=r(79100),v=r(40779),p=r(4760);function m(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=[],i=t.mapPositions;y(t,n);var a=n[0][1].data,o=n[0][1].indices.length,s=(0,c.LE)(o);return g(t,n,s),x(t,n,s),_(t,n,s),b(t,n,s),S(t,n,s),T(t,n,s),w(t,n,a),new v.Z(e,n,i,f.U.Line,r)}function y(e,t){for(var r=e.attributeData.position,n=e.removeDuplicateStartEnd,i=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&n,a=r.length/3-(i?1:0),o=new Array(2*(a-1)),s=i?r.slice(0,-3):r,l=0,u=0;u<a-1;u++)o[l++]=u,o[l++]=u+1;t.push([p.T.POSITION,new d.a(s,o,3,i)])}function g(e,t,r){if(null==e.attributeData.colorFeature){var n=e.attributeData.color;t.push([p.T.COLOR,new d.a(null!==n&&void 0!==n?n:a.hq,r,4)])}}function _(e,t,r){e.attributeData.normal&&t.push([p.T.NORMAL,new d.a(e.attributeData.normal,r,3)])}function b(e,t,r){null!=e.attributeData.colorFeature&&t.push([p.T.COLORFEATUREATTRIBUTE,new d.a([e.attributeData.colorFeature],r,1,!0)])}function x(e,t,r){var n;null==e.attributeData.sizeFeature&&t.push([p.T.SIZE,new d.a([null!==(n=e.attributeData.size)&&void 0!==n?n:1],r,1,!0)])}function S(e,t,r){null!=e.attributeData.sizeFeature&&t.push([p.T.SIZEFEATUREATTRIBUTE,new d.a([e.attributeData.sizeFeature],r,1,!0)])}function T(e,t,r){null!=e.attributeData.opacityFeature&&t.push([p.T.OPACITYFEATUREATTRIBUTE,new d.a([e.attributeData.opacityFeature],r,1,!0)])}function w(e,t,r){if(null!=e.overlayInfo&&e.overlayInfo.renderCoordsHelper.viewingMode===h.JY.Global&&e.overlayInfo.spatialReference.isGeographic){for(var i=(0,l.bg)(r.length),a=(0,o.Iu)(e.overlayInfo.spatialReference),c=0;c<i.length;c+=3)(0,s.gH)(r,c,i,c,a);var f=r.length/3,v=(0,u.xx)(f+1),m=P,y=C,g=0,_=0;(0,n.t8)(m,i[_++],i[_++]),_++,v[0]=0;for(var b=1;b<f+1;++b){var x;b===f&&(_=0),(0,n.t8)(y,i[_++],i[_++]),_++,g+=(0,n.TK)(m,y),v[b]=g,m=(x=[y,m])[0],y=x[1]}t.push([p.T.DISTANCETOSTART,new d.a(v,t[0][1].indices,1,!0)])}}var P=(0,i.Ue)(),C=(0,i.Ue)();function O(e,t){if(null==e||0===e.length)return[];var r=[];return e.forEach((function(e){var n=e.length,i=(0,l.bg)(3*n);e.forEach((function(e,t){i[3*t]=e[0],i[3*t+1]=e[1],i[3*t+2]=e[2]}));var a={attributeData:{position:i,normal:t},removeDuplicateStartEnd:!1};r.push(a)})),r}},65206:function(e,t,r){r.d(t,{G:function(){return o},O:function(){return a}});var n=r(12400),i=r(50628);function a(e,t,r){if(null==e||null==r)return!1;var n=!0;return s[0]=null!=e.xmin?e.xmin:0,s[1]=null!=e.ymin?e.ymin:0,s[2]=null!=e.zmin?e.zmin:0,n=n&&(0,i.projectBuffer)(s,e.spatialReference,0,t,r,0,1),s[0]=null!=e.xmax?e.xmax:0,s[1]=null!=e.ymax?e.ymax:0,s[2]=null!=e.zmax?e.zmax:0,n=n&&(0,i.projectBuffer)(s,e.spatialReference,0,t,r,3,1),null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.zmin&&(t[2]=-1/0),null==e.xmax&&(t[3]=1/0),null==e.ymax&&(t[4]=1/0),null==e.zmax&&(t[5]=1/0),n}function o(e,t,r){if(null==e||null==r)return!1;var n=!0;return s[0]=null!=e.xmin?e.xmin:0,s[1]=null!=e.ymin?e.ymin:0,s[2]=null!=e.zmin?e.zmin:0,n=n&&(0,i.projectBuffer)(s,e.spatialReference,0,s,r,0,1),t[0]=s[0],t[1]=s[1],s[0]=null!=e.xmax?e.xmax:0,s[1]=null!=e.ymax?e.ymax:0,s[2]=null!=e.zmax?e.zmax:0,n=n&&(0,i.projectBuffer)(s,e.spatialReference,0,s,r,0,1),t[2]=s[0],t[3]=s[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),n}var s=(0,n.Ue)()},83281:function(e,t,r){r.d(t,{W8:function(){return l},kD:function(){return s}});var n=r(6644),i=r(32035),a=r(12400),o=r(55652);function s(e,t,r,n){return d(e,t,r,c(n,t,r,!0))}function l(e,t,r,n){var a=(0,i.m)(r,(0,i.f)(e,n,t));return(0,i.g)(e,t,(0,i.j)(e,r,a))}var u={dir:(0,a.Ue)(),len:0,clip:(0,n.Ue)()};function c(e,t,r,n){var a=u;return e?(r&&n&&(a.len=(0,i.p)(t,r)),(0,i.c)(a.dir,e)):n?(a.len=(0,i.p)(t,r),(0,i.f)(a.dir,r,t),(0,i.j)(a.dir,a.dir,1/a.len)):((0,i.f)(a.dir,r,t),(0,i.n)(a.dir,a.dir)),a}function h(e,t,r){var n=(0,i.m)((0,o.st)(e),r.dir),a=-(0,o.jH)(e,t);if(a<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return a>0;if((a<0||n<0)&&!(a<0&&n<0))return!0;var s=a/n;return n>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function d(e,t,r,n){n.clip[0]=0,n.clip[1]=r?n.len:Number.MAX_VALUE;for(var i=0;i<e.length;i++)if(!h(e[i],t,n))return!1;return!0}},78081:function(e,t,r){r.d(t,{V:function(){return u},r:function(){return c}});var n=r(37762),i=r(50628),a=r(86372),o=r(91320),s=r(69691),l=r(19265);function u(e,t,r,n){var i="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,l="polygon"===e.type?e.rings:e.paths,u=(0,o.Ni)(l,!!e.hasZ,i,e.spatialReference),c=u.position,d=u.outlines,f=(0,a.bg)(c.length),v=(0,s.rR)(c,e.spatialReference,0,f,0,c,0,c.length/3,t,r,n),p=null!=v;return{lines:p?h(d,c,f):[],projectionSuccess:p,sampledElevation:v}}function c(e,t){for(var r="polygon"===e.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,n="polygon"===e.type?e.rings:e.paths,a=(0,o.Ni)(n,!1,r),s=a.position,u=a.outlines,c=(0,i.projectBuffer)(s,e.spatialReference,0,s,t,0,s.length/3),d=2;d<s.length;d+=3)s[d]=l.gi;return{lines:c?h(u,s):[],projectionSuccess:c}}function h(e,t){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=new Array,s=(0,n.Z)(e);try{for(s.s();!(r=s.n()).done;){var l=r.value,u=l.index,c=l.count;if(!(c<=1)){var h=3*u,d=3*c;o.push({position:(0,a.Rq)(t,3*u,3*c),mapPositions:null!=i?(0,a.Rq)(i,h,d):void 0})}}}catch(f){s.e(f)}finally{s.f()}return o}},75027:function(e,t,r){r.d(t,{C:function(){return E},W:function(){return R}});var n,i,a,o,s,l,u,c,h,d,f,v=r(43144),p=r(15671),m=r(60136),y=r(29388),g=r(30168),_=r(6644),b=r(52276),x=r(82999),S=r(49450),T=r(59150),w=r(699),P=r(98634),C=r(4760),O=r(65964);function R(e,t){var r=C.T.FEATUREVALUE;e.attributes.add(r,"vec4");var v=e.vertex;v.code.add((0,P.H)(n||(n=(0,g.Z)(["\n  bool isCapVertex() {\n    return ",".w == 1.0;\n  }\n  "])),r)),v.uniforms.add(new x.A("size",(function(e){return e.size}))),t.vvSize?(v.uniforms.add(new S.J("vvSizeMinSize",(function(e){return e.vvSize.minSize})),new S.J("vvSizeMaxSize",(function(e){return e.vvSize.maxSize})),new S.J("vvSizeOffset",(function(e){return e.vvSize.offset})),new S.J("vvSizeFactor",(function(e){return e.vvSize.factor}))),v.code.add((0,P.H)(i||(i=(0,g.Z)(["\n    vec2 getSize() {\n      return size * clamp(vvSizeOffset + ",".x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "])),r))):v.code.add((0,P.H)(a||(a=(0,g.Z)(["vec2 getSize(){\nreturn size;\n}"])))),t.vvOpacity?(v.constants.add("vvOpacityNumber","int",8),v.uniforms.add(new w.O("vvOpacityValues",(function(e){return e.vvOpacity.values}),8),new w.O("vvOpacityOpacities",(function(e){return e.vvOpacity.opacityValues}),8)),v.code.add((0,P.H)(o||(o=(0,g.Z)(["\n    vec4 applyOpacity(vec4 color) {\n      float value = ",".z;\n      if (value <= vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i = 1; i < vvOpacityNumber; ++i) {\n        if (vvOpacityValues[i] >= value) {\n          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);\n    }\n    "])),r))):v.code.add((0,P.H)(s||(s=(0,g.Z)(["vec4 applyOpacity(vec4 color){\nreturn color;\n}"])))),t.vvColor?(v.constants.add("vvColorNumber","int",O.x),v.uniforms.add(new w.O("vvColorValues",(function(e){return e.vvColor.values}),O.x),new T.b("vvColorColors",(function(e){return e.vvColor.colors}),O.x)),v.code.add((0,P.H)(l||(l=(0,g.Z)(["\n    vec4 getColor() {\n      float value = ",".y;\n      if (value <= vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i = 1; i < vvColorNumber; ++i) {\n        if (vvColorValues[i] >= value) {\n          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[vvColorNumber - 1]);\n    }\n    "])),r))):v.code.add((0,P.H)(u||(u=(0,g.Z)(["vec4 getColor(){\nreturn applyOpacity(vec4(1, 1, 1, 1));\n}"])))),e.include(b.f),e.attributes.add(C.T.PROFILERIGHT,"vec4"),e.attributes.add(C.T.PROFILEUP,"vec4"),e.attributes.add(C.T.PROFILEVERTEXANDNORMAL,"vec4"),v.code.add((0,P.H)(c||(c=(0,g.Z)(["vec3 calculateVPos() {\nvec2 size = getSize();\nvec3 origin = position;\nvec3 right = profileRight.xyz;\nvec3 up = profileUp.xyz;\nvec3 forward = cross(up, right);\nvec2 profileVertex = profileVertexAndNormal.xy * size;\nvec2 profileNormal = profileVertexAndNormal.zw;\nfloat positionOffsetAlongProfilePlaneNormal = 0.0;\nfloat normalOffsetAlongProfilePlaneNormal = 0.0;"])))),v.code.add((0,P.H)(h||(h=(0,g.Z)(["if(!isCapVertex()) {\nvec2 rotationRight = vec2(profileRight.w, profileUp.w);\nfloat maxDistance = length(rotationRight);"])))),v.code.add((0,P.H)(d||(d=(0,g.Z)(["rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);\nfloat rx = dot(profileVertex, rotationRight);\nif (abs(rx) > maxDistance) {\nvec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);\nfloat ry = dot(profileVertex, rotationUp);\nprofileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n}\n}else{\npositionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];\nnormalOffsetAlongProfilePlaneNormal = profileUp.w;\n}\nvec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\nreturn origin + offset;\n}"])))),v.code.add((0,P.H)(f||(f=(0,g.Z)(["vec3 localNormal() {\nvec3 right = profileRight.xyz;\nvec3 up = profileUp.xyz;\nvec3 forward = cross(up, right);\nvec2 profileNormal = profileVertexAndNormal.zw;\nvec3 normal = right * profileNormal.x + up * profileNormal.y;\nif(isCapVertex()) {\nnormal += forward * profileUp.w;\n}\nreturn normal;\n}"]))))}var E=function(e){(0,m.Z)(r,e);var t=(0,y.Z)(r);function r(){var e;return(0,p.Z)(this,r),(e=t.apply(this,arguments)).size=(0,_.al)(1,1),e}return(0,v.Z)(r)}(O.n)},8555:function(e,t,r){r.d(t,{n:function(){return u}});var n,i,a,o,s=r(30168),l=r(98634);function u(e,t){t.spherical?e.vertex.code.add((0,l.H)(n||(n=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add((0,l.H)(i||(i=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),t.spherical?e.vertex.code.add((0,l.H)(a||(a=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add((0,l.H)(o||(o=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},79246:function(e,t,r){r.d(t,{M:function(){return _},U:function(){return b}});var n,i=r(43144),a=r(15671),o=r(60136),s=r(29388),l=r(30168),u=r(13611),c=r(6644),h=r(19093),d=r(86361),f=r(7683),v=r(93511),p=r(82999),m=r(95276),y=r(98634),g=r(19253);function _(e){e.fragment.uniforms.add(new g.A("texWaveNormal",(function(e){return e.waveNormal})),new g.A("texWavePerturbation",(function(e){return e.wavePerturbation})),new m.N("waveParams",(function(e){return(0,h.s)(x,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)})),new p.A("waveDirection",(function(e){return(0,u.t8)(S,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)}))),e.include(f.K),e.fragment.code.add((0,y.H)(n||(n=(0,l.Z)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}var b=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r)}(v.nj),x=(0,d.Ue)(),S=(0,c.Ue)()},22487:function(e,t,r){r.d(t,{U:function(){return o}});var n=r(15671),i=r(43144),a=r(73230);function o(e){var t=e.definition.size,r=e.fontString(t),n=s.get(r);if(!n){var i=(0,a.G)(u,0,0).getContext("2d");e.setFontProperties(i,t);var o=i.measureText(c);n=new l(o.actualBoundingBoxAscent,o.actualBoundingBoxDescent),s.set(r,n)}return n}var s=new Map,l=function(){function e(t,r){(0,n.Z)(this,e),this.maxAscent=t,this.maxDescent=r}return(0,i.Z)(e,[{key:"maxHeight",get:function(){return this.maxAscent+this.maxDescent}}]),e}(),u={canvas:null},c=function(){for(var e="",t=32;t<127;t++)e+=String.fromCharCode(t);return e}()},17579:function(e,t,r){r.d(t,{T:function(){return s}});var n=r(43144),i=r(15671),a=r(60136),o=r(29388);r(40779).Z;function s(e){return null!=e.mapPositions}},52920:function(e,t,r){r.d(t,{Pj:function(){return l},hd:function(){return o},nG:function(){return s},rc:function(){return u}});var n=r(16889),i=r(32035),a=r(12400);r(38461);function o(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=1/(Math.abs(r)+Math.abs(n)+Math.abs(i)),s=r*o,l=n*o,u=i<=0?(s>=0?1:-1)*(1-Math.abs(l)):s,h=i<=0?(l>=0?1:-1)*(1-Math.abs(s)):l,d=t*a;e[d]=c(u),e[d+1]=c(h)}function s(e){for(var t=e.length/3,r=new Int16Array(2*t),n=0,i=0;i<t;++i)o(r,i,e[n++],e[n++],e[n++]);return r}function l(e,t){for(var r=e.length/3,n=new Int16Array(2*r),s=0,l=(0,a.Ue)(),u=0;u<r;++u)l[0]=e[s++],l[1]=e[s++],l[2]=e[s++],(0,i.t)(l,l,t),o(n,u,l[0],l[1],l[2]);return n}function u(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=r*n,o=h(t[a]),s=h(t[a+1]),l=1-Math.abs(o)-Math.abs(s);e[2]=l,l<0?(e[0]=(o>=0?1:-1)*(1-Math.abs(s)),e[1]=(s>=0?1:-1)*(1-Math.abs(o))):(e[0]=o,e[1]=s),(0,i.n)(e,e)}function c(e){return(0,n.uZ)(Math.round(32767*e),-32767,32767)}function h(e){return(0,n.uZ)(e/32767,-1,1)}},73230:function(e,t,r){function n(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}r.d(t,{G:function(){return n}})},43164:function(e,t,r){r.d(t,{V:function(){return d}});var n=r(74165),i=r(15861),a=r(15671),o=r(43144),s=r(51995),l=r(82272),u=r(32718),c=r(17842),h=r(86361),d=function(){function e(t){(0,a.Z)(this,e),this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=f(t.color),this.haloStyle=function(e){return"rgb(".concat(e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString(),")")}(t.halo.color),this.backgroundStyle=0!==t.background.color[3]?f(t.background.color):null}return(0,o.Z)(e,[{key:"fontString",value:function(e){var t=this.definition.font;return"".concat(t.style," ").concat(t.weight," ").concat(e,"px ").concat(t.family,", ").concat("sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji")}},{key:"setFontProperties",value:function(e,t){e.font=this.fontString(t),e.textAlign="left",e.textBaseline="alphabetic"}}],[{key:"fromSymbol",value:function(){var t=(0,i.Z)((0,n.Z)().mark((function t(r,i){var a,o,d,f,p,m,y,g,_,b,x,S,T,w,P,C,O,R,E,k,A;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(x=null===r||void 0===r||null===(a=r.material)||void 0===a?void 0:a.color,S=null!==(o=s.Z.toUnitRGBA(x))&&void 0!==o?o:h.AG,T=null!=r.size?(0,c.F2)(r.size):12,w=r.lineHeight,P=null!=r.background?s.Z.toUnitRGBA(r.background.color):h.AG,C={family:null!==(d=null===(f=r.font)||void 0===f?void 0:f.family)&&void 0!==d?d:"sans-serif",decoration:null!==(p=null===(m=r.font)||void 0===m?void 0:m.decoration)&&void 0!==p?p:"none",weight:null!==(y=null===(g=r.font)||void 0===g?void 0:g.weight)&&void 0!==y?y:"normal",style:null!==(_=null===(b=r.font)||void 0===b?void 0:b.style)&&void 0!==_?_:"normal"},O=r.halo,R=null!=(null===O||void 0===O?void 0:O.color)&&O.size>0?{size:(0,c.F2)(O.size),color:s.Z.toUnitRGBA(O.color)}:{size:0,color:h.AG},E=new e({color:S,size:T,background:{color:P,padding:null!=r.background?[.65*T,.5*T]:[0,0],borderRadius:null!=r.background?T*(6/16):0},lineSpacingFactor:w,font:C,halo:R,pixelRatio:i}),!r.font){t.next=21;break}return k=!1,A=E.fontString(T),t.prev=4,t.next=7,document.fonts.load(A);case 7:k=t.sent.some((function(e){return!(0,l.hZ)(e)})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(4),u.Z.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce("Failed to preload font '".concat(A,"'. Some text symbology may be rendered using the default browser font."));case 13:if(k||v.has(r.font.family)){t.next=21;break}return t.prev=14,t.next=17,(0,l.mx)(r.font);case 17:t.next=21;break;case 19:t.prev=19,t.t1=t.catch(14);case 21:return t.abrupt("return",E);case 22:case"end":return t.stop()}}),t,null,[[4,10],[14,19]])})));return function(e,r){return t.apply(this,arguments)}}()}]),e}();function f(e){return"rgba(".concat(e.slice(0,3).map((function(e){return Math.floor(255*e)})).toString(),",").concat(e[3],")")}var v=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"])},5008:function(e,t,r){r.d(t,{Wg:function(){return f},tV:function(){return v},vU:function(){return n}});for(var n,i,a=r(29439),o=r(37762),s=r(15671),l=r(43144),u=r(16889),c=r(94463),h=r(22487),d=r(73230),f=1,v=function(){function e(t,r,n,i){(0,s.Z)(this,e),this.text=t,this._alignment=r,this._parameters=n,this._maxSize=i,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key="TextRenderer-".concat(this._parameters.key,"-").concat(this._alignment,"--").concat(t),this._lines=t.replaceAll(" ","\xa0").split(/\r?\n/)}return(0,l.Z)(e,[{key:"displayWidth",get:function(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}},{key:"displayHeight",get:function(){for(var e=this._metrics.firstLineAscent,t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}},{key:"renderedWidth",get:function(){return this._toRoundedRenderUnit(this.displayWidth)}},{key:"renderedHeight",get:function(){return this._toRoundedRenderUnit(this.displayHeight)}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}},{key:"_firstLineYOffset",get:function(){return this._verticalPadding+this._haloSize}},{key:"_metrics",get:function(){var e=this;if(null==this._metricsCached){var t=(0,d.G)(y,_,_).getContext("2d"),r=this._parameters.definition.pixelRatio,n=this._fontSize*r;this._parameters.setFontProperties(t,n);var i=2*this._haloSize,a=this._parameters.definition.font;"italic"!==a.style&&"oblique"!==a.style&&"bold"!==a.weight&&"bolder"!==a.weight||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;var o=0,s=0,l=0,u=0,c=0;this._lines.forEach((function(n,a){var h=t.measureText(n),d=h.width/r,f=d+i;e._textWidths.push(d),e._lineWidths.push(f),o=Math.max(o,f),u=Math.max(u,h.actualBoundingBoxAscent/r),c=Math.max(c,h.actualBoundingBoxDescent/r),0===a&&(s=h.actualBoundingBoxAscent/r),a===e._lines.length-1&&(l=h.actualBoundingBoxDescent/r)}));var f=(0,h.U)(this._parameters),v=Math.max(u,f.maxAscent),p=Math.max(c,f.maxDescent),m=s,g="underline"===this._parameters.definition.font.decoration?p:l,b=o;this._metricsCached=new x(m,g,v,p,b)}return this._metricsCached}},{key:"_lineSpacing",get:function(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"_midLineHeight",get:function(){return this._metrics.midLineHeight}},{key:"_linePadding",get:function(){return this._midLineHeight*g}},{key:"_midLineAscent",get:function(){return this._metrics.maxLineAscent}},{key:"_renderedFontSize",get:function(){return this._toRenderUnit(this._fontSize)}},{key:"_fontSize",get:function(){return this._parameters.definition.size}},{key:"_renderedHaloSize",get:function(){return this._toRenderUnit(this._haloSize)}},{key:"_haloSize",get:function(){return this._parameters.haloSize}},{key:"_horizontalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"_verticalPadding",get:function(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,f)}},{key:"_hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if(null==this._renderPixelRatio){var e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}},{key:"_getLineXOffset",value:function(e){switch(this._alignment){case n.Left:return this._horizontalPadding;case n.Center:return(this.displayWidth-this._lineWidths[e])/2;case n.Right:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}},{key:"render",value:function(e,t,r){e.save();var n=t/=this.renderPixelRatio,i=r/=this.renderPixelRatio,a=this._haloSize,o=this._firstLineYOffset+this._metrics.firstLineAscent;t+=a,r+=o;var s=this._haloSize>0;s&&this._renderHalo(e,n,i,a,o),this._parameters.setFontProperties(e,this._renderedFontSize);for(var l=0;l<this._lines.length;++l){var u=this._lines[l],h=this._getLineXOffset(l);s&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,t+h,r),this._renderLineDecoration(e,t+h,r,this._textWidths[l])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,t+this._getLineXOffset(l),r),this._renderLineDecoration(e,t+h,r,this._textWidths[l]),r+=this._lineSpacing}if(c.h.TEXT_SHOW_BASELINE){e.strokeStyle=b,e.setLineDash([2,2]),e.lineWidth=1;for(var d=i+o,f=0;f<this._lines.length;++f)this._drawLine(e,[n,d],[n+this.displayWidth,d]),d+=this._lineSpacing}if(c.h.TEXT_SHOW_BORDER&&(e.strokeStyle=b,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,i],[this.displayWidth,this.displayHeight])),this._hasBackground){var v=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,i,v),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}},{key:"_renderLineDecoration",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("none"!==this._parameters.definition.font.decoration&&0!==n){var a=1,o=Math.max(this._parameters.definition.size/16,a);switch(this._parameters.definition.font.decoration){case"underline":r+=2*o;break;case"line-through":r-=.33*this._midLineAscent}var s=i?this._haloSize:0;e.strokeStyle=i?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(o+2*s),e.beginPath(),e.moveTo(this._toRenderUnit(t-s),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+n+s),this._toRenderUnit(r)),e.stroke()}}},{key:"_roundedRect",value:function(e,t,r,n){t=this._toRenderUnit(t),r=this._toRenderUnit(r);var i=this.renderedWidth,a=this.renderedHeight;0!==n?(n=(0,u.uZ)(n,0,Math.floor(a/2)),e.beginPath(),e.moveTo(t,r+n),e.arcTo(t,r,t+n,r,n),e.lineTo(t+i-n,r),e.arcTo(t+i,r,t+i,r+n,n),e.lineTo(t+i,r+a-n),e.arcTo(t+i,r+a,t+i-n,r+a,n),e.lineTo(t+n,r+a),e.arcTo(t,r+a,t,r+a-n,n),e.closePath()):e.rect(t,r,i,a)}},{key:"_renderHalo",value:function(e,t,r,n,i){var a=this.renderedWidth,o=this.renderedHeight,s=(0,d.G)(y,Math.max(a,_),Math.max(o,_)),l=s.getContext("2d");l.clearRect(0,0,a,o),this._parameters.setFontProperties(l,this._renderedFontSize),l.fillStyle=this._parameters.haloStyle,l.strokeStyle=this._parameters.haloStyle;var u=this._renderedHaloSize<3;l.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(l,n,i):this._renderHaloNative(l,n,i);for(var c=i,h=0;h<this._lines.length;++h){var f=this._getLineXOffset(h);this._renderLineDecoration(l,n+f,c,this._textWidths[h],!0),c+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(s,0,0,a,o,this._toRenderUnit(t),this._toRenderUnit(r),a,o),e.globalAlpha=1}},{key:"_renderHaloEmulated",value:function(e,t,r){for(var n=0;n<this._lines.length;++n){var i,s=this._lines[n],l=this._getLineXOffset(n),u=(0,o.Z)(p);try{for(u.s();!(i=u.n()).done;){var c=(0,a.Z)(i.value,2),h=c[0],d=c[1];this._fillText(e,s,t+l+this._haloSize*h,r+this._haloSize*d)}}catch(f){u.e(f)}finally{u.f()}r+=this._lineSpacing}}},{key:"_renderHaloNative",value:function(e,t,r){for(var n=2*this._haloSize,i=0;i<this._lines.length;++i){for(var a=this._lines[i],o=this._getLineXOffset(i),s=0;s<5;s++){var l=.6+.1*s;e.lineWidth=this._toRenderUnit(l*n),this._strokeText(e,a,t+o,r)}r+=this._lineSpacing}}},{key:"_displayWidth",get:function(){return this._metrics.displayWidth}},{key:"_toRenderUnit",value:function(e){return e*this.renderPixelRatio}},{key:"_toRoundedRenderUnit",value:function(e){return Math.round(e*this.renderPixelRatio)}},{key:"_fillText",value:function(e,t,r,n){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(n))}},{key:"_strokeText",value:function(e,t,r,n){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(n))}},{key:"_drawLine",value:function(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}},{key:"_drawBox",value:function(e,t,r){var n=this._toRenderUnit(t[0]),i=this._toRenderUnit(t[1]),a=this._toRenderUnit(r[0]),o=this._toRenderUnit(r[1]),s=Math.floor(n)+.5,l=Math.ceil(n+a)-.5,u=Math.floor(i)+.5,c=Math.ceil(i+o)-.5;e.beginPath(),e.moveTo(s,u),e.lineTo(l,u),e.lineTo(l,c),e.lineTo(s,c),e.lineTo(s,u),e.stroke()}}]),e}(),p=[],m=0;m<360;m+=22.5)p.push([Math.cos(Math.PI*m/180),Math.sin(Math.PI*m/180)]);(i=n||(n={}))[i.Left=0]="Left",i[i.Center=1]="Center",i[i.Right=2]="Right";var y={canvas:null},g=.2,_=512,b="rgb(255, 0, 255, 0.5)",x=function(){function e(t,r,n,i,a){(0,s.Z)(this,e),this.firstLineAscent=t,this.lastLineDescent=r,this.maxLineAscent=n,this.maxLineDescent=i,this.displayWidth=a}return(0,l.Z)(e,[{key:"firstLineHeight",get:function(){return this.firstLineAscent+this.maxLineDescent}},{key:"midLineHeight",get:function(){return this.maxLineAscent+this.maxLineDescent}},{key:"lastLineHeight",get:function(){return this.maxLineAscent+this.lastLineDescent}}]),e}()},29473:function(e,t,r){r.d(t,{U:function(){return R}});var n=r(29439),i=r(37762),a=r(15671),o=r(43144),s=r(60136),l=r(29388),u=r(27366),c=r(7138),h=r(91505),d=(r(93169),r(92026)),f=r(95439),v=r(49861),p=(r(32718),r(84936),r(69912)),m=r(19093),y=r(86361),g=r(79100),_=r(17852),b=r(32251),x=r(4760),S=r(93463),T=r(73553),w=r(8548),P=r(57808),C=r(52311),O=4096,R=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).type=g.U.Texture,n.id=(0,f.D)(),n.events=new h.Z,n._glTexture=null,n._atlas=new L(256,256),n._needsRepack=!1,n._canRepack=!0,n._elementsToRender=new Map,n._elements=new Map,n._stageObjects=new Map,n.updating=!1,n}return(0,o.Z)(r,[{key:"initialize",value:function(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._updateCanvasElementSize(this._atlas),this._reset()}},{key:"unload",value:function(){this._glTexture=(0,d.M2)(this._glTexture),this.updating=!1,this.events.emit("unloaded")}},{key:"glTexture",get:function(){return this._glTexture}},{key:"load",value:function(e){if(this._glTexture)return this._glTexture;var t=new C.X;return t.wrapMode=w.e8.CLAMP_TO_EDGE,t.samplingMode=w.cw.LINEAR_MIPMAP_LINEAR,t.hasMipmap=!0,t.preMultiplyAlpha=!0,t.maxAnisotropy=e.parameters.maxMaxAnisotropy,this._glTexture=new P.x(e,t,this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(S.T8.TEXT_TEXTURE_ATLAS,this),this.setDirty(),this._glTexture}},{key:"dispose",value:function(){this._elements.clear(),this._elementsToRender.clear(),this._frameWorker=(0,d.hw)(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=(0,d.M2)(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}},{key:"_updateCanvasElementSize",value:function(e){this._canvas.setAttribute("width",e.width.toString()),this._canvas.setAttribute("height",e.height.toString())}},{key:"_resizeAtlas",value:function(e,t){var r,n,i=this,a=this._atlas,o=a.width,s=a.height;o===e&&s===t||(this._atlas.width=e,this._atlas.height=t,null!==(r=this._glTexture)&&void 0!==r&&r.resize(e,t),null!==(n=this._glTexture)&&void 0!==n&&n.updateData(0,0,0,o,s,this._canvas),this._updateCanvasElementSize(this._atlas),this._elements.forEach((function(e){var t=i._stageObjects.get(e.textRenderer.key);null===t||void 0===t||t.forEach((function(t){return E(t,e)}))})),this._reset())}},{key:"_reset",value:function(){this._elementsToRender.clear(),this._atlas.reset(),this._needsRepack=!0,this.setDirty()}},{key:"_addAtlasElement",value:function(e,t,r,n){var i=this._atlas;if(i.width<r||i.height<n)return!1;var a=i.cursors.get(n);if(!a){if(i.height<i.nextY+n)return!1;a=[new I(i.nextY)],i.cursors.set(n,a),i.nextY+=n}var o=a.find((function(e){return i.width>=e.x+r}));if(null==o){if(i.height<i.nextY+n)return!1;o=new I(i.nextY),i.nextY+=n,a.push(o)}return e.setNewPosition(o),this._elements.set(t,e),this._elementsToRender.set(t,e),o.x+=r,!0}},{key:"_ensureStageObjects",value:function(e){var t=this._stageObjects.get(e);if(t)return t;var r=new Set;return this._stageObjects.set(e,r),r}},{key:"_addStageObject",value:function(e,t){this._ensureStageObjects(e).add(t)}},{key:"_removeStageObject",value:function(e,t){var r=this._stageObjects.get(e);(null===r||void 0===r?void 0:r.delete(t))&&(t.geometries[0].setAttributeData(x.T.SIZE,[0,0]),t.geometryVertexAttributeUpdated(t.geometries[0],x.T.SIZE),this._elementsToRender.delete(e))}},{key:"_processAddition",value:function(e){var t=e.textRenderer.key;if(this._needsRepack)this._elements.set(t,e);else{var r=this._atlas,n=e.textRenderer.renderedWidth,i=e.textRenderer.renderedHeight,a=n+k,o=i+k+A;if(!this._addAtlasElement(e,t,a,o)){if(this._canRepack)this._reset();else if(r.width<a){var s=Math.min((0,b.nq)(Math.max(a,1.5*r.width)),O);this._resizeAtlas(s,r.height)}else{var l=r.nextY+o,u=Math.min((0,b.nq)(Math.max(l,1.5*r.height)),O);if(u>r.height)this._resizeAtlas(r.width,u);else if(r.width<O){var c=Math.min((0,b.nq)(1.5*r.width),O);this._resizeAtlas(c,r.height)}}this._elements.set(t,e)}}}},{key:"_renderElement",value:function(e){var t=e.commitNewPosition(),r=e.textRenderer;this._ctx.clearRect(t[0]-k,t[1]-k,r.renderedWidth+2*k,r.renderedHeight+2*k),r.render(this._ctx,t[0],t[1]);var n=this._stageObjects.get(r.key);null===n||void 0===n||n.forEach((function(t){return E(t,e)}))}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t=this;if(null==this._glTexture)return T.J;for(;this._needsRepack&&(this._canRepack||this._atlas.height<O&&this._atlas.height<O);){this._canRepack=this._needsRepack=!1;var r=this._elements;this._elements=new Map,r.forEach((function(e){return t._processAddition(e)})),e.madeProgress()}if(this._elementsToRender.size>0){var a,o=(0,i.Z)(this._elementsToRender);try{for(o.s();!(a=o.n()).done;){var s=(0,n.Z)(a.value,2),l=s[0],u=s[1];if(e.done)break;this._renderElement(u),this._elementsToRender.delete(l),e.madeProgress()}}catch(c){o.e(c)}finally{o.f()}this._glTexture.setData(this._canvas)}this.updating=this._elementsToRender.size>0}},{key:"addTextTexture",value:function(e,t){var r=e.key;this._addStageObject(r,t);var n=this._elements.get(r);null==n&&(n=new Z(this._atlas,e),this._processAddition(n),this.setDirty()),function(e,t){e.geometries[0].setAttributeData(x.T.SIZE,[t.textRenderer.displayWidth,t.textRenderer.displayHeight]),e.geometryVertexAttributeUpdated(e.geometries[0],x.T.SIZE)}(t,n),E(t,n)}},{key:"removeTextTexture",value:function(e,t){var r=e.key;if(this._elements.get(r)){this._removeStageObject(r,t);var n=this._stageObjects.get(r);n&&0!==n.size||this._elements.delete(r),0===(null===n||void 0===n?void 0:n.size)&&this._stageObjects.delete(r),this._canRepack=!0}}},{key:"setDirty",value:function(){this._glTexture&&(this.updating=!0)}},{key:"test",get:function(){}}],[{key:"maxSize",get:function(){return U=_.y.stableRendering?k:0,[O-k-U,O-k-U-A]}}]),r}(c.default);function E(e,t){e.geometries[0].setAttributeData(x.T.UV0,t.uv),e.geometryVertexAttributeUpdated(e.geometries[0],x.T.UV0,!0)}(0,u._)([(0,v.Cb)({constructOnly:!0})],R.prototype,"view",void 0),(0,u._)([(0,v.Cb)({type:Boolean})],R.prototype,"updating",void 0),R=(0,u._)([(0,p.j)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],R);var k=2,A=2,Z=function(){function e(t,r){(0,a.Z)(this,e),this._atlas=t,this.textRenderer=r,this._uv=(0,y.Ue)(),this._newPosition=[0,0]}return(0,o.Z)(e,[{key:"uv",get:function(){if(null==this._xOffset||null==this._yOffset)return y.AG;var e=this.textRenderer,t=e.renderedWidth,r=e.renderedHeight;return(0,m.s)(this._uv,this._xOffset/this._atlas.width,(this._yOffset+r)/this._atlas.height,(this._xOffset+t)/this._atlas.width,this._yOffset/this._atlas.height)}},{key:"setNewPosition",value:function(e){this._newPosition[0]=e.x,this._newPosition[1]=e.y}},{key:"commitNewPosition",value:function(){return this._xOffset=this._newPosition[0],this._yOffset=this._newPosition[1],this._newPosition}},{key:"xOffset",get:function(){return this._xOffset}},{key:"yOffset",get:function(){return this._yOffset}}]),e}(),L=function(){function e(t,r){(0,a.Z)(this,e),this.width=t,this.height=r,this.cursors=new Map,this.nextY=0}return(0,o.Z)(e,[{key:"reset",value:function(){this.cursors.clear(),this.nextY=U}}]),e}(),I=(0,o.Z)((function e(t){(0,a.Z)(this,e),this.y=t,this.x=U})),U=0},22255:function(e,t,r){r.d(t,{w:function(){return h},x:function(){return c}});var n=r(43144),i=r(15671),a=r(60136),o=r(29388),s=r(54463),l=r(55848),u=r(22178),c=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e,n,a,o,s,l){var u;return(0,i.Z)(this,r),(u=t.call(this,e,n)).layerUid=e,u.graphicUid=n,u.geometryId=a,u.triangleNr=o,u.baseBoundingSphere=s,u.numLodLevels=l,u}return(0,n.Z)(r)}(l.Dx);function h(e){return(0,u.nn)(e)&&e.intersector===s.q7.LOD&&!!e.target}},72635:function(e,t,r){r.d(t,{QD:function(){return l},T6:function(){return u},VQ:function(){return d},aH:function(){return h},ci:function(){return f},hO:function(){return c}});var n=r(93433),i=r(43144),a=r(15671),o=r(63780),s=r(4760),l=(0,i.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,a.Z)(this,e),this.geometry=t,this.textures=r})),u=function(){function e(t,r,n){(0,a.Z)(this,e),this.components=t,this.minScreenSpaceRadius=r,this.pivotOffset=n;var i=this.geometries;this.numVertices=i.reduce((function(e,t){return e+t.attributes.get(s.T.POSITION).indices.length}),0)}return(0,i.Z)(e,[{key:"geometries",get:function(){return(0,o.Tw)(this.components.map((function(e){return e.geometry})))}}]),e}(),c=(0,i.Z)((function e(t){(0,a.Z)(this,e),this.levels=t,this.levels.sort((function(e,t){return e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius}))}));function h(e){var t=[];return e.levels.forEach((function(e){return e.components.forEach((function(e){return t.push(e.geometry.material)}))})),(0,o.Tw)(t)}function d(e){var t=new Array;return e.levels.forEach((function(e){return e.components.forEach((function(e){null!=e.textures&&t.push.apply(t,(0,n.Z)(e.textures))}))})),(0,o.Tw)(t)}function f(e){var t=new Array;return e.levels.forEach((function(e){return e.components.forEach((function(e){return t.push(e.geometry)}))})),(0,o.Tw)(t)}},64642:function(e,t,r){r.d(t,{IM:function(){return s},W1:function(){return o},lV:function(){return l},wp:function(){return a}});var n=r(55158),i=r(4760),a=(0,n.U$)().vec3f(i.T.POSITION),o=(0,n.U$)().vec3f(i.T.POSITION).vec2f(i.T.UV0),s=(0,n.U$)().vec3f(i.T.POSITION).vec4u8(i.T.COLOR),l=(0,n.U$)().vec3f(i.T.POSITION).vec2f(i.T.UV0).vec4u8(i.T.OBJECTANDLAYERIDCOLOR)},21317:function(e,t,r){r.d(t,{X:function(){return A}});var n=r(88301),i=r(61120),a=r(15671),o=r(43144),s=r(60136),l=r(29388),u=r(32035),c=r(12400),h=r(55158),d=r(37081),f=r(17363),v=r(56529),p=r(93822),m=r(4760),y=r(65964),g=r(82144),_=r(31132),b=r(78041),x=r(27627),S=r(50411),T=r(25920),w=r(83609),P=r(33720),C=r(8548),O=r(36207),R=new Map([[m.T.POSITION,0],[m.T.PREVPOSITION,1],[m.T.UV0,2],[m.T.NORMAL,3],[m.T.COLOR,4],[m.T.COLORFEATUREATTRIBUTE,4],[m.T.SIZE,5],[m.T.SIZEFEATUREATTRIBUTE,5],[m.T.OPACITYFEATUREATTRIBUTE,6]]),E=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"initializeProgram",value:function(e){return new x.$(e.rctx,r.shader.get().build(this.configuration),R)}},{key:"_makePipelineState",value:function(e,t){var r=this.configuration,n=e===T.A.NONE;return(0,O.sm)({blending:r.output===d.H_.Color?n?b.wu:(0,b.j7)(e):null,depthTest:r.space===P.I9.Draped?null:{func:(0,b.Bh)(e)},depthWrite:r.space===P.I9.Draped?null:n?r.writeDepth?O.LZ:null:(0,b.K5)(e),drawBuffers:r.output===d.H_.Depth?{buffers:[C.Xg.NONE]}:(0,b.V7)(e),colorWrite:O.BK,stencilWrite:r.hasOccludees?S.s3:null,stencilTest:r.hasOccludees?t?S.eD:S.RY:null,polygonOffset:{factor:0,units:-10}})}},{key:"initializePipeline",value:function(){return this.configuration.occluder&&(this._occluderPipelineTransparent=(0,O.sm)({blending:b.wu,depthTest:S.zV,depthWrite:null,colorWrite:O.BK,stencilWrite:null,stencilTest:S.YD}),this._occluderPipelineOpaque=(0,O.sm)({blending:b.wu,depthTest:S.zV,depthWrite:null,colorWrite:O.BK,stencilWrite:S.P7,stencilTest:S.ii}),this._occluderPipelineMaskWrite=(0,O.sm)({blending:null,depthTest:S.JN,depthWrite:null,colorWrite:null,stencilWrite:S.s3,stencilTest:S.eD})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipeline",value:function(e,t,a){return e?this._occludeePipelineState:this.configuration.occluder?a?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:(0,n.Z)((0,i.Z)(r.prototype),"getPipeline",this).call(this)}}]),r}(_.A);E.shader=new g.J(w.L,(function(){return r.e(22668).then(r.bind(r,22668))}));var k=r(737),A=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e,new L)).produces=new Map([[p.r.OPAQUE_MATERIAL,function(e){return e===d.H_.Highlight||(0,d.D5)(e)&&n.parameters.renderOccluded===v.yD.OccludeAndTransparentStencil}],[p.r.OPAQUE_NO_SSAO_DEPTH,function(e){return(0,d.BX)(e)}],[p.r.OCCLUDER_MATERIAL,function(e){return(0,d.Xo)(e)&&n.parameters.renderOccluded===v.yD.OccludeAndTransparentStencil}],[p.r.TRANSPARENT_OCCLUDER_MATERIAL,function(e){return(0,d.Xo)(e)&&n.parameters.renderOccluded===v.yD.OccludeAndTransparentStencil}],[p.r.TRANSPARENT_MATERIAL,function(e){return(0,d.D5)(e)&&n.parameters.writeDepth}],[p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,function(e){return(0,d.D5)(e)&&!n.parameters.writeDepth}],[p.r.DRAPED_MATERIAL,function(e){return e===d.H_.Color||e===d.H_.Highlight}]]),n._vertexAttributeLocations=R,n._configuration=new P.PI,n._layout=n.createLayout(),n}return(0,o.Z)(r,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.space=t.slot===p.r.DRAPED_MATERIAL?P.I9.Draped:this.parameters.worldSpace?P.I9.World:P.I9.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==k.R.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===v.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}},{key:"intersect",value:function(){}},{key:"createLayout",value:function(){var e=(0,h.U$)().vec3f(m.T.POSITION).vec3f(m.T.PREVPOSITION).vec2f(m.T.UV0);return this.parameters.worldSpace&&e.vec3f(m.T.NORMAL),this.parameters.vvSize?e.f32(m.T.SIZEFEATUREATTRIBUTE):e.f32(m.T.SIZE),this.parameters.vvColor?e.f32(m.T.COLORFEATUREATTRIBUTE):e.vec4f(m.T.COLOR),this.parameters.vvOpacity&&e.f32(m.T.OPACITYFEATUREATTRIBUTE),e}},{key:"createBufferWriter",value:function(){return new I(this._layout,this.parameters)}},{key:"createGLMaterial",value:function(e){return new Z(e)}}]),r}(v.F5),Z=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._markerPrimitive=null,e}return(0,o.Z)(r,[{key:"dispose",value:function(){(0,n.Z)((0,i.Z)(r.prototype),"dispose",this).call(this),this._markerTextures.release(this._markerPrimitive),this._markerPrimitive=null}},{key:"_updateParameters",value:function(e){var t=this._material.parameters.markerPrimitive;return t!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextures.swap(t,this._markerPrimitive)}),this._markerPrimitive=t),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(E,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output===d.H_.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}]),r}(f.F),L=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).width=0,e.color=[1,1,1,1],e.markerPrimitive="arrow",e.placement="end",e.cap=k.R.BUTT,e.anchor=P.i5.Center,e.hasTip=!1,e.worldSpace=!1,e.hideOnShortSegments=!1,e.writeDepth=!0,e.hasSlicePlane=!1,e.vvFastUpdate=!1,e.hasOccludees=!1,e.markerTexture=null,e}return(0,o.Z)(r)}(y.n),I=function(){function e(t,r){(0,a.Z)(this,e),this.vertexBufferLayout=t,this._parameters=r}return(0,o.Z)(e,[{key:"elementCount",value:function(){return"begin-end"===this._parameters.placement?12:6}},{key:"write",value:function(e,t,r,n,i){var a=this,o=r.attributes.get(m.T.POSITION).data,s=o.length/3,l=[1,0,0],c=r.attributes.get(m.T.NORMAL);this._parameters.worldSpace&&null!=c&&(l=c.data);var h=1,d=0;this._parameters.vvSize?d=r.attributes.get(m.T.SIZEFEATUREATTRIBUTE).data[0]:r.attributes.has(m.T.SIZE)&&(h=r.attributes.get(m.T.SIZE).data[0]);var f=[1,1,1,1],v=0;this._parameters.vvColor?v=r.attributes.get(m.T.COLORFEATUREATTRIBUTE).data[0]:r.attributes.has(m.T.COLOR)&&(f=r.attributes.get(m.T.COLOR).data);var p=0;this._parameters.vvOpacity&&(p=r.attributes.get(m.T.OPACITYFEATUREATTRIBUTE).data[0]);var y,g,_=new Float32Array(n.buffer),b=i*(this.vertexBufferLayout.stride/4),x=function(e,t,r,n){if(_[b++]=e[0],_[b++]=e[1],_[b++]=e[2],_[b++]=t[0],_[b++]=t[1],_[b++]=t[2],_[b++]=r[0],_[b++]=r[1],a._parameters.worldSpace&&(_[b++]=l[0],_[b++]=l[1],_[b++]=l[2]),a._parameters.vvSize?_[b++]=d:_[b++]=h,a._parameters.vvColor)_[b++]=v;else{var i=Math.min(4*n,f.length-4);_[b++]=f[i],_[b++]=f[i+1],_[b++]=f[i+2],_[b++]=f[i+3]}a._parameters.vvOpacity&&(_[b++]=p)};(g=y||(y={}))[g.ASCENDING=1]="ASCENDING",g[g.DESCENDING=-1]="DESCENDING";var S=function(t,r){var n=(0,u.s)(U,o[3*t],o[3*t+1],o[3*t+2]),i=M,a=t+r;do{(0,u.s)(i,o[3*a],o[3*a+1],o[3*a+2]),a+=r}while((0,u.G)(n,i)&&a>=0&&a<s);e&&((0,u.h)(n,n,e),(0,u.h)(i,i,e)),x(n,i,[-1,-1],t),x(n,i,[1,-1],t),x(n,i,[1,1],t),x(n,i,[-1,-1],t),x(n,i,[1,1],t),x(n,i,[-1,1],t)},T=this._parameters.placement;"begin"!==T&&"begin-end"!==T||S(0,y.ASCENDING),"end"!==T&&"begin-end"!==T||S(s-1,y.DESCENDING)}}]),e}(),U=(0,c.Ue)(),M=(0,c.Ue)()},17729:function(e,t,r){var n;r.d(t,{b:function(){return n}}),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"}(n||(n={}))},86700:function(e,t,r){r.d(t,{Dp:function(){return s},z5:function(){return o}});var n=r(93433),i={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},a={dash:i.dash,"dash-dot":[].concat((0,n.Z)(i.dash),(0,n.Z)(i.dot)),dot:i.dot,"long-dash":i["long-dash"],"long-dash-dot":[].concat((0,n.Z)(i["long-dash"]),(0,n.Z)(i.dot)),"long-dash-dot-dot":[].concat((0,n.Z)(i["long-dash"]),(0,n.Z)(i.dot),(0,n.Z)(i.dot)),none:null,"short-dash":i["short-dash"],"short-dash-dot":[].concat((0,n.Z)(i["short-dash"]),(0,n.Z)(i["short-dot"])),"short-dash-dot-dot":[].concat((0,n.Z)(i["short-dash"]),(0,n.Z)(i["short-dot"]),(0,n.Z)(i["short-dot"])),"short-dot":i["short-dot"],solid:null};function o(e){return{pattern:[e,e],pixelRatio:2}}function s(e){return null!=e&&"style"===e.type?function(e){return null!=e?function(e,t){return null==e?e:{pattern:e.slice(),pixelRatio:t}}(a[e],8):null}(e.style):null}}}]);
//# sourceMappingURL=8699.e9731fa2.chunk.js.map