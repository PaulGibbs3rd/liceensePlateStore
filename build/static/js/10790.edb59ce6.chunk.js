"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[10790],{10790:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var i=n(29439),a=n(37762),r=n(93433),o=n(74165),s=n(15861),l=n(15671),u=n(43144),d=n(60136),p=n(29388),c=n(27366),h=n(80987),y=n(10064),f=n(32718),v=n(77427),g=n(97642),m=n(66978),b=n(35995),w=n(71907),_=n(49861),M=(n(93169),n(84936),n(38511)),k=n(69912),T=n(31201),Z=n(25265),D=n(30651),S=n(50568),C=n(21438),L=n(69086),x=n(11936),A=n(6693),N=n(46671),E=n(6061),I=n(29598),R=n(71684),G=n(56811),O=n(70361),j=n(97316),U=n(53283),P=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._graphTypeLookup=new Map,i._namedTypesModified=!1,i.dataManager=null,i.definitionSetMap=null,i.knowledgeGraph=null,i.layers=new(h.Z.ofType(C.Z)),i.memberEntityTypes=null,i.memberRelationshipTypes=null,i.operationalLayerType="KnowledgeGraphLayer",i.sublayerIdsCache=new Map,i.tables=new(h.Z.ofType(C.Z)),i.type="knowledge-graph",i.url=null,i}return(0,u.Z)(n,[{key:"load",value:function(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}},{key:"_doLoad",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadFromPortal({supportedTypes:["Knowledge Graph Layer"]},t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,m.r9)(e.t0);case 8:return e.next=10,this._fetchMetadata();case 10:return e.next=12,this._initializeLayerProperties();case 12:this.loadLayerAssumingLocalCache();case 13:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchMetadata",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.url){e.next=2;break}throw new y.Z("knowledge-graph:missing-url","KnowledgeGraphLayer must be created with a url");case 2:return e.next=4,(0,j.fetchKnowledgeGraph)(this.url);case 4:t=e.sent,this.knowledgeGraph=t,this._forEachGraphType((function(e){e.name&&n._graphTypeLookup.set(e.name,e)}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initializeLayerProperties",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.originIdOf("inclusionModeDefinition")!==Z.s3.USER){e.next=4;break}this._validateInclusionModeDefinition(),e.next=6;break;case 4:return e.next=6,this._initializeInclusionModeDefinition();case 6:this._setMemberTypes(),this.dataManager=new S.Qc({knowledgeGraph:this.knowledgeGraph,inclusionModeDefinition:this.inclusionModeDefinition});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initializeInclusionModeDefinition",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.definitionSetMap){e.next=6;break}return e.next=3,(0,L.Ag)(this.definitionSetMap,!0);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0={generateAllSublayers:!0,namedTypeDefinitions:new Map};case 7:t=e.t0,[].concat((0,r.Z)(this.layers.toArray()),(0,r.Z)(this.tables.toArray())).forEach((function(e){var i=n._graphTypeLookup.get(e.graphTypeName);i&&!t.namedTypeDefinitions.has(i.name)&&t.namedTypeDefinitions.set(i.name,{useAllData:!0})})),this.setAtOrigin("inclusionModeDefinition",t,(0,Z.x3)(this.originIdOf("definitionSetMap")));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_validateInclusionModeDefinition",value:function(){var e=this,t=this.inclusionModeDefinition;if(t){var n=t.namedTypeDefinitions;if((null===n||void 0===n?void 0:n.size)>0)n.forEach((function(t,i){var a=e._graphTypeLookup.get(i);if(!a)return f.Z.getLogger(e).warn("A named type, ".concat(i,", was in the inclusion list that wasn't in the data model and will be removed")),void n.delete(i);"relationship"!==a.type&&"entity"!==a.type&&(f.Z.getLogger(e).warn("A named type, ".concat(i,", was in the inclusion list that wasn't properly modeled and will be removed")),n.delete(i))}));else if(!t.generateAllSublayers)throw new y.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined")}}},{key:"_setMemberTypes",value:function(){var e,t,n,i,a=this,r=[],o=[],s=this.inclusionModeDefinition,l=null===s||void 0===s?void 0:s.namedTypeDefinitions;!s||s.generateAllSublayers?(r=null!==(e=null===(t=this.knowledgeGraph.dataModel)||void 0===t?void 0:t.entityTypes)&&void 0!==e?e:[],o=null!==(n=null===(i=this.knowledgeGraph.dataModel)||void 0===i?void 0:i.relationshipTypes)&&void 0!==n?n:[]):l&&l.size>0&&l.forEach((function(e,t){var n=a._graphTypeLookup.get(t);switch(null===n||void 0===n?void 0:n.type){case"relationship":o.push(n);break;case"entity":r.push(n)}})),this.memberEntityTypes=r,this.memberRelationshipTypes=o}},{key:"_forEachGraphType",value:function(e){var t,n,i,a;[].concat((0,r.Z)(null!==(t=null===(n=this.knowledgeGraph.dataModel)||void 0===n?void 0:n.entityTypes)&&void 0!==t?t:[]),(0,r.Z)(null!==(i=null===(a=this.knowledgeGraph.dataModel)||void 0===a?void 0:a.relationshipTypes)&&void 0!==i?i:[])).forEach((function(t){e(t)}))}},{key:"_refreshNamedTypes",value:function(){this._namedTypesModified=!0;var e,t=(0,a.Z)(this.layers);try{for(t.s();!(e=t.n()).done;){e.value.emit("refresh",{dataChanged:!0})}}catch(r){t.e(r)}finally{t.f()}var n,i=(0,a.Z)(this.tables);try{for(i.s();!(n=i.n()).done;){n.value.emit("refresh",{dataChanged:!0})}}catch(r){i.e(r)}finally{i.f()}}},{key:"_handleNewRecords",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,i,r,s,l,u,d,p;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this.dataManager.addToLayer(t),i=(0,a.Z)(t);try{for(i.s();!(r=i.n()).done;)s=r.value,this.sublayerIdsCache.has(s.typeName)||(this.sublayerIdsCache.set(s.typeName,new Set),n.push(s.typeName)),this.sublayerIdsCache.get(s.typeName).add(s.id)}catch(o){i.e(o)}finally{i.f()}l=0,u=n;case 5:if(!(l<u.length)){e.next=14;break}if(d=u[l],p=this._graphTypeLookup.get(d)){e.next=10;break}return e.abrupt("continue",11);case 10:this._addSublayer(p).title=d,"entity"===p.type?this.dataManager.entityTypeNames.add(d):this.dataManager.relationshipTypeNames.add(d),this.dataManager.sublayerCaches.set(d,new Map);case 11:l++,e.next=5;break;case 14:this._refreshNamedTypes();case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createSublayers",value:function(e,t,n){var i=this;e.forEach((function(e){var a=i._createSublayer(e);n(a)&&t.push(a),i._updateSublayerCaches(e)}))}},{key:"_addSublayer",value:function(e){var t=this._createSublayer(e);return t.geometryType?this.layers.push(t):this.tables.push(t),t}},{key:"_createSublayer",value:function(e){return new C.Z({objectType:e,parentCompositeLayer:this,graphType:e.type,title:e.name})}},{key:"_updateSublayers",value:function(e,t){var n=this;t.forEach((function(t){t.parentCompositeLayer=n;var i=e.find((function(e){return e.type===t.graphType&&e.name===t.graphTypeName}));i&&(t.objectType=i,t.read({title:i.name},{origin:"service"}),n._updateSublayerCaches(i))}))}},{key:"_updateSublayerCaches",value:function(e){var t=this.dataManager.sublayerCaches;t.has(e.name)||t.set(e.name,new Map)}},{key:"_saveUrlAsNewResource",value:function(e,t,n,i){var a=this;e[t]="<pending>",n.pendingOperations.push(function(e){return K.apply(this,arguments)}(this.inclusionModeDefinition).then((function(r){var o=function(e){var t="definitionSetMap-".concat((0,w.DO)(),".dat"),n=(0,b.v_)("knowledgeGraphLayer",t);return e.resourceFromPath(n)}(i);e[t]=o.itemRelativeUrl,n.toAdd.push({resource:o,content:{type:"blob",blob:r},compress:!1,finish:function(e){a.definitionSetMap=e.url}})})))}},{key:"_displaysAllRecords",value:function(e){var t,n=(0,a.Z)(e.namedTypeDefinitions);try{for(n.s();!(t=n.n()).done;){if(!(0,i.Z)(t.value,2)[1].useAllData)return!1}}catch(r){n.e(r)}finally{n.f()}return!0}},{key:"readDefinitionSetMap",value:function(e,t,n){return(0,U.f)(e,n)}},{key:"writeDefinitionSetMap",value:function(e,t,n,i){var a=null===i||void 0===i?void 0:i.portalItem,r=null===i||void 0===i?void 0:i.resources,o=(0,Z.M9)(null===i||void 0===i?void 0:i.origin);if(a&&r&&null!=o){var s=this.inclusionModeDefinition;if(s&&!this._displaysAllRecords(s)){var l=this.originIdOf("inclusionModeDefinition");if(l===Z.s3.USER||this._namedTypesModified||o<l)this._saveUrlAsNewResource(t,n,r,a);else if(o===l&&e){var u=(0,U.t)(e,i);(0,b.YP)(u)?this._saveUrlAsNewResource(t,n,r,a):t[n]=u}}else this.definitionSetMap=null}else e&&(t[n]=(0,U.t)(e,i))}},{key:"inclusionModeDefinition",set:function(e){"loaded"!==this.loadStatus&&"failed"!==this.loadStatus?this._set("inclusionModeDefinition",e):f.Z.getLogger(this).error("#inclusionModeDefinition","inclusionModeDefinition cannot be changed after the layer is loaded.")}},{key:"loadLayerAssumingLocalCache",value:function(){var e,t,n=this,i=[].concat((0,r.Z)(this.memberEntityTypes),(0,r.Z)(this.memberRelationshipTypes));this.originIdOf("layers")===Z.s3.DEFAULTS?this._createSublayers(i,this.layers,(function(e){return!!e.geometryType})):this._updateSublayers(i,this.layers),this.originIdOf("tables")===Z.s3.DEFAULTS?this._createSublayers(i,this.tables,(function(e){return!e.geometryType})):this._updateSublayers(i,this.tables),null===(e=this.dataManager.inclusionModeDefinition)||void 0===e||null===(t=e.namedTypeDefinitions)||void 0===t||t.forEach((function(e,t){var i,a=(0,v.s1)(n.sublayerIdsCache,t,(function(){return new Set}));null===(i=e.members)||void 0===i||i.forEach((function(e){a.add(e.id)}))}))}},{key:"addRecords",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._handleNewRecords(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeRecords",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,i,r,s,l,u,d,p,c,h,y,f,v,g,m;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],i=(0,a.Z)(t);try{for(i.s();!(r=i.n()).done;)y=r.value,!1===(null===(s=this.dataManager.inclusionModeDefinition)||void 0===s||null===(l=s.namedTypeDefinitions)||void 0===l||null===(u=l.get(y.typeName))||void 0===u?void 0:u.useAllData)&&(null===(d=this.dataManager.inclusionModeDefinition)||void 0===d||null===(p=d.namedTypeDefinitions)||void 0===p||null===(c=p.get(y.typeName))||void 0===c||null===(h=c.members)||void 0===h?void 0:h.has(y.id))&&n.push(y)}catch(o){i.e(o)}finally{i.f()}for(this.dataManager.removeFromLayer(n),f=0,v=n;f<v.length;f++)m=v[f],null===(g=this.sublayerIdsCache.get(m.typeName))||void 0===g||g.delete(m.id);return e.abrupt("return",(this._refreshNamedTypes(),n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}((0,A.h7)((0,G.M)((0,R.Q)((0,x.Y)((0,E.q)((0,I.I)((0,g.R)((0,N.N)(D.Z)))))))));(0,c._)([(0,_.Cb)()],P.prototype,"dataManager",void 0),(0,c._)([(0,_.Cb)({json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],P.prototype,"definitionSetMap",void 0),(0,c._)([(0,M.r)("definitionSetMap")],P.prototype,"readDefinitionSetMap",null),(0,c._)([(0,T.c)("definitionSetMap")],P.prototype,"writeDefinitionSetMap",null),(0,c._)([(0,_.Cb)()],P.prototype,"inclusionModeDefinition",null),(0,c._)([(0,_.Cb)()],P.prototype,"knowledgeGraph",void 0),(0,c._)([(0,_.Cb)({type:h.Z.ofType(C.Z),json:{write:{ignoreOrigin:!0}}})],P.prototype,"layers",void 0),(0,c._)([(0,_.Cb)()],P.prototype,"memberEntityTypes",void 0),(0,c._)([(0,_.Cb)()],P.prototype,"memberRelationshipTypes",void 0),(0,c._)([(0,_.Cb)({type:["KnowledgeGraphLayer"]})],P.prototype,"operationalLayerType",void 0),(0,c._)([(0,_.Cb)()],P.prototype,"sublayerIdsCache",void 0),(0,c._)([(0,_.Cb)({type:h.Z.ofType(C.Z),json:{write:{ignoreOrigin:!0}}})],P.prototype,"tables",void 0),(0,c._)([(0,_.Cb)({json:{read:!1}})],P.prototype,"type",void 0),(0,c._)([(0,_.Cb)(O.HQ)],P.prototype,"url",void 0);var z=P=(0,c._)([(0,k.j)("esri.layers.KnowledgeGraphLayer")],P);function K(){return(K=(0,s.Z)((0,o.Z)().mark((function e(t){var n;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,L.jR)(t);case 2:return n=e.sent,e.abrupt("return",new Blob([n],{type:"application/x-protobuf"}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=10790.edb59ce6.chunk.js.map