"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[70492],{24191:function(e,t,r){function n(e,t){this.v=e,this.k=t}r.d(t,{Z:function(){return n}})},16296:function(e,t,r){function n(e){var t,r,n,a=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);a--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new i(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function i(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return i=function(e){this.s=e,this.n=e.next},i.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new i(e)}r.d(t,{Z:function(){return n}})},26420:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(24191);function i(e){return new n.Z(e,0)}},50608:function(e,t,r){r.d(t,{Z:function(){return a}});var n=r(24191);function i(e){var t,r;function i(t,r){try{var s=e[t](r),u=s.value,o=u instanceof n.Z;Promise.resolve(o?u.v:u).then((function(r){if(o){var n="return"===t?"return":"next";if(!u.k||r.done)return i(n,r);r=e[n](r).value}a(s.done?"return":"normal",r)}),(function(e){i("throw",e)}))}catch(c){a("throw",c)}}function a(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?i(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise((function(a,s){var u={key:e,arg:n,resolve:a,reject:s,next:null};r?r=r.next=u:(t=r=u,i(e,n))}))},"function"!=typeof e.return&&(this.return=void 0)}function a(e){return function(){return new i(e.apply(this,arguments))}}i.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},i.prototype.next=function(e){return this._invoke("next",e)},i.prototype.throw=function(e){return this._invoke("throw",e)},i.prototype.return=function(e){return this._invoke("return",e)}},79347:function(e,t,r){r.d(t,{e:function(){return o}});var n,i,a,s=r(84397),u={exports:{}};n=u,i=function(){function e(e,r,i){i=i||2;var a,s,u,c,l,h,d,f=r&&r.length,v=f?r[0]*i:e.length,p=t(e,0,v,i,!0),y=[];if(!p||p.next===p.prev)return y;if(f&&(p=o(e,r,p,i)),e.length>80*i){a=u=e[0],s=c=e[1];for(var _=i;_<v;_+=i)(l=e[_])<a&&(a=l),(h=e[_+1])<s&&(s=h),l>u&&(u=l),h>c&&(c=h);d=0!==(d=Math.max(u-a,c-s))?1/d:0}return n(p,y,i,a,s,d),y}function t(e,t,r,n,i){var a,s;if(i===C(e,t,r,n)>0)for(a=t;a<r;a+=n)s=w(a,e[a],e[a+1],s);else for(a=r-n;a>=t;a-=n)s=w(a,e[a],e[a+1],s);if(s&&m(s,s.next)){var u=s.next;S(s),s=u}return s}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!m(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{var i=n.prev;if(S(n),(n=t=i)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,o,c,l,h,d){if(e){!d&&h&&f(e,c,l,h);for(var v,p,y=e;e.prev!==e.next;)if(v=e.prev,p=e.next,h?a(e,c,l,h):i(e))t.push(v.i/o),t.push(e.i/o),t.push(p.i/o),S(e),e=p.next,y=p.next;else if((e=p)===y){d?1===d?n(e=s(r(e),t,o),t,o,c,l,h,2):2===d&&u(e,t,o,c,l,h):n(r(e),t,o,c,l,h,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(g(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(y(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,r,n){var i=e.prev,a=e,s=e.next;if(g(i,a,s)>=0)return!1;for(var u=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,o=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,c=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,l=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=v(u,o,t,r,n),d=v(c,l,t,r,n),f=e.prevZ,p=e.nextZ;f&&f.z>=h&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&y(i.x,i.y,a.x,a.y,s.x,s.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&y(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&y(i.x,i.y,a.x,a.y,s.x,s.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&y(i.x,i.y,a.x,a.y,s.x,s.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function s(e,t,n){var i=e;do{var a=i.prev,s=i.next.next;!m(a,s)&&k(a,i,i.next,s)&&Z(a,s)&&Z(s,a)&&(t.push(a.i/n),t.push(i.i/n),t.push(s.i/n),S(i),S(i.next),i=e=s),i=i.next}while(i!==e);return r(i)}function u(e,t,i,a,s,u){var o=e;do{for(var c=o.next.next;c!==o.prev;){if(o.i!==c.i&&_(o,c)){var l=I(o,c);return o=r(o,o.next),l=r(l,l.next),n(o,t,i,a,s,u),void n(l,t,i,a,s,u)}c=c.next}o=o.next}while(o!==e)}function o(e,n,i,a){var s,u,o,l=[];for(s=0,u=n.length;s<u;s++)(o=t(e,n[s]*a,s<u-1?n[s+1]*a:e.length,a,!1))===o.next&&(o.steiner=!0),l.push(p(o));for(l.sort(c),s=0;s<l.length;s++)i=r(i=h(l[s],i),i.next);return i}function c(e,t){return e.x-t.x}function l(e){if(e.next.prev===e)return e;for(var t=e;;){var r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function h(e,t){var n=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var u=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=i&&u>s){if(s=u,u===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r;var o,c=r,l=r.x,h=r.y,f=1/0;n=r;do{i>=n.x&&n.x>=l&&i!==n.x&&y(a<h?i:s,a,l,h,a<h?s:i,a,n.x,n.y)&&(o=Math.abs(a-n.y)/(i-n.x),Z(n,e)&&(o<f||o===f&&(n.x>r.x||n.x===r.x&&d(r,n)))&&(r=n,f=o)),n=n.next}while(n!==c);return r}(e,t);if(!n)return t;var i=I(n,e),a=r(n,n.next),s=l(i);return r(s,s.next),a=l(a),l(t===n?a:t)}function d(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function f(e,t,r,n){var i=e;do{null===i.z&&(i.z=v(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,s,u,o,c=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,n=r,u=0,t=0;t<c&&(u++,n=n.nextZ);t++);for(o=c;u>0||o>0&&n;)0!==u&&(0===o||!n||r.z<=n.z)?(i=r,r=r.nextZ,u--):(i=n,n=n.nextZ,o--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,c*=2}while(s>1)}(i)}function v(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function y(e,t,r,n,i,a,s,u){return(i-s)*(t-u)-(e-s)*(a-u)>=0&&(e-s)*(n-u)-(r-s)*(t-u)>=0&&(r-s)*(a-u)-(i-s)*(n-u)>=0}function _(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&k(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Z(e,t)&&Z(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||m(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function k(e,t,r,n){var i=b(g(e,t,r)),a=b(g(e,t,n)),s=b(g(r,n,e)),u=b(g(r,n,t));return i!==a&&s!==u||!(0!==i||!x(e,r,t))||!(0!==a||!x(e,n,t))||!(0!==s||!x(r,e,n))||!(0!==u||!x(r,t,n))}function x(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function b(e){return e>0?1:e<0?-1:0}function Z(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function I(e,t){var r=new M(e.i,e.x,e.y),n=new M(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function w(e,t,r,n){var i=new M(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function M(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,r,n){for(var i=0,a=t,s=r-n;a<r;a+=n)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}return e.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,s=Math.abs(C(e,0,a,r));if(i)for(var u=0,o=t.length;u<o;u++){var c=t[u]*r,l=u<o-1?t[u+1]*r:e.length;s-=Math.abs(C(e,c,l,r))}var h=0;for(u=0;u<n.length;u+=3){var d=n[u]*r,f=n[u+1]*r,v=n[u+2]*r;h+=Math.abs((e[d]-e[v])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[v+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[i][a][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r},e},void 0!==(a=i())&&(n.exports=a);var o=(0,s.g)(u.exports)},31581:function(e,t,r){r.d(t,{r:function(){return i}});var n=r(36231);function i(e,t){if(!(this instanceof i))return new i(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function a(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function s(e,t){u(e,0,e.children.length,t,e)}function u(e,t,r,n,i){i||(i=_(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a,s=t;s<r;s++)a=e.children[s],o(i,e.leaf?n(a):a);return i}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function l(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function v(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,a-n)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function y(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,t,r,i,a){for(var s,u=[t,r];u.length;)(r=u.pop())-(t=u.pop())<=i||(s=t+Math.ceil((r-t)/i/2)*i,(0,n.q)(e,s,t,r,a),u.push(t,s,s,r))}i.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],n=this.toBBox;if(!y(e,t))return r;for(var i,a,s,u,o=[];t;){for(i=0,a=t.children.length;i<a;i++)s=t.children[i],y(e,u=t.leaf?n(s):s)&&(t.leaf?r.push(s):p(e,u)?this._all(s,r):o.push(s));t=o.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!y(e,t))return!1;for(var n,i,a,s,u=[];t;){for(n=0,i=t.children.length;n<i;n++)if(a=t.children[n],y(e,s=t.leaf?r(a):a)){if(t.leaf||p(e,s))return!0;u.push(a)}t=u.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){return null!=e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=_([]),this},remove:function(e,t){if(null==e)return this;for(var r,n,i,s,u=this.data,o=this.toBBox(e),c=[],l=[];u||c.length;){if(u||(u=c.pop(),n=c[c.length-1],r=l.pop(),s=!0),u.leaf&&-1!==(i=a(e,u.children,t)))return u.children.splice(i,1),c.push(u),this._condense(c),this;s||u.leaf||!p(u,o)?n?(r++,u=n.children[r],s=!1):u=null:(c.push(u),l.push(r),r=0,n=u,u=u.children[0])}return this},toBBox:function(e){return e},compareMinX:c,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,n){var i,a=r-t+1,u=this._maxEntries;if(a<=u)return s(i=_(e.slice(t,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(a)/Math.log(u)),u=Math.ceil(a/Math.pow(u,n-1))),(i=_([])).leaf=!1,i.height=n;var o,c,l,h,d=Math.ceil(a/u),f=d*Math.ceil(Math.sqrt(u));for(g(e,t,r,f,this.compareMinX),o=t;o<=r;o+=f)for(g(e,o,l=Math.min(o+f-1,r),d,this.compareMinY),c=o;c<=l;c+=d)h=Math.min(c+d-1,l),i.children.push(this._build(e,c,h,n-1));return s(i,this.toBBox),i},_chooseSubtree:function(e,t,r,n){for(var i,a,s,u,o,c,l,d;n.push(t),!t.leaf&&n.length-1!==r;){for(l=d=1/0,i=0,a=t.children.length;i<a;i++)o=h(s=t.children[i]),(c=f(e,s)-o)<d?(d=c,l=o<l?o:l,u=s):c===d&&o<l&&(l=o,u=s);t=u||t.children[0]}return t},_insert:function(e,t,r){var n=this.toBBox,i=r?e:n(e),a=[],s=this._chooseSubtree(i,this.data,t,a);for(s.children.push(e),o(s,i);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(i,a,t)},_split:function(e,t){var r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var a=this._chooseSplitIndex(r,i,n),u=_(r.children.splice(a,r.children.length-a));u.height=r.height,u.leaf=r.leaf,s(r,this.toBBox),s(u,this.toBBox),t?e[t-1].children.push(u):this._splitRoot(r,u)},_splitRoot:function(e,t){this.data=_([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var n,i,a,s,o,c,l,d;for(c=l=1/0,n=t;n<=r-t;n++)s=v(i=u(e,0,n,this.toBBox),a=u(e,n,r,this.toBBox)),o=h(i)+h(a),s<c?(c=s,d=n,l=o<l?o:l):s===c&&o<l&&(l=o,d=n);return d},_chooseSplitAxis:function(e,t,r){var n=e.leaf?this.compareMinX:c,i=e.leaf?this.compareMinY:l;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)},_allDistMargin:function(e,t,r,n){e.children.sort(n);var i,a,s=this.toBBox,c=u(e,0,t,s),l=u(e,r-t,r,s),h=d(c)+d(l);for(i=t;i<r-t;i++)a=e.children[i],o(c,e.leaf?s(a):a),h+=d(c);for(i=r-t-1;i>=t;i--)a=e.children[i],o(l,e.leaf?s(a):a),h+=d(l);return h},_adjustParentBBoxes:function(e,t,r){for(var n=r;n>=0;n--)o(t[n],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():s(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},30932:function(e,t,r){function n(){return new Float32Array(2)}function i(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}function a(){return n()}function s(){return i(1,1)}function u(){return i(1,0)}function o(){return i(0,1)}r.d(t,{AG:function(){return c},Ue:function(){return n},al:function(){return i},hq:function(){return l}});var c=a(),l=s(),h=u(),d=o();Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_X:h,UNIT_Y:d,ZEROS:c,clone:function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},create:n,createView:function(e,t){return new Float32Array(e,t,2)},fromValues:i,ones:s,unitX:u,unitY:o,zeros:a},Symbol.toStringTag,{value:"Module"}))},6644:function(e,t,r){function n(){return[0,0]}function i(e){return[e[0],e[1]]}function a(e,t){return[e,t]}function s(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=Math.min(2,e.length),n=0;n<r;++n)t[n]=e[n];return t}function u(){return[0,0]}function o(){return a(1,1)}function c(){return a(1,0)}function l(){return a(0,1)}r.d(t,{AG:function(){return h},E9:function(){return f},IO:function(){return v},Ue:function(){return n},al:function(){return a},d9:function(){return i},hq:function(){return d},nI:function(){return s}});var h=[0,0],d=o(),f=c(),v=l();Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:f,UNIT_Y:v,ZEROS:h,clone:i,create:n,createView:function(e,t){return new Float64Array(e,t,2)},fromArray:s,fromValues:a,ones:o,unitX:c,unitY:l,zeros:u},Symbol.toStringTag,{value:"Module"}))},13611:function(e,t,r){r.d(t,{$X:function(){return u},AK:function(){return k},EU:function(){return S},Fp:function(){return h},Fv:function(){return m},I6:function(){return M},IH:function(){return s},JG:function(){return i},LG:function(){return T},TE:function(){return v},TK:function(){return q},U1:function(){return w},VV:function(){return l},bA:function(){return d},bI:function(){return p},c:function(){return Z},fS:function(){return C},iu:function(){return I},kC:function(){return x},kE:function(){return y},lu:function(){return O},od:function(){return f},t7:function(){return b},t8:function(){return a},tk:function(){return g},we:function(){return _}});var n=r(24204);function i(e,t){return e[0]=t[0],e[1]=t[1],e}function a(e,t,r){return e[0]=t,e[1]=r,e}function s(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function u(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function l(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function h(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function d(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function f(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function v(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function p(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function y(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function _(e){var t=e[0],r=e[1];return t*t+r*r}function g(e,t){return e[0]=-t[0],e[1]=-t[1],e}function m(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}function k(e,t){return e[0]*t[0]+e[1]*t[1]}function x(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function b(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e}function Z(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}function I(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}function w(e,t,r,n){var i=t[0]-r[0],a=t[1]-r[1],s=Math.sin(n),u=Math.cos(n);return e[0]=i*u-a*s+r[0],e[1]=i*s+a*u+r[1],e}function S(e,t){var r=e[0],n=e[1],i=t[0],a=t[1],s=r*r+n*n;s>0&&(s=1/Math.sqrt(s));var u=i*i+a*a;u>0&&(u=1/Math.sqrt(u));var o=(r*i+n*a)*s*u;return o>1?0:o<-1?Math.PI:Math.acos(o)}function M(e,t){return e[0]===t[0]&&e[1]===t[1]}function C(e,t){var r=e[0],i=e[1],a=t[0],s=t[1],u=(0,n.bn)();return Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=u*Math.max(1,Math.abs(i),Math.abs(s))}function T(e,t,r,n,i){var a=t[0]-r[0],s=t[1]-r[1],u=(n[0]*a+n[1]*s)*(i-1);return a=n[0]*u,s=n[1]*u,e[0]=t[0]+a,e[1]=t[1]+s,e}var F=y,O=u,R=o,E=c,q=v,A=p,P=_;Object.freeze(Object.defineProperty({__proto__:null,add:s,angle:S,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},copy:i,cross:x,dist:q,distance:v,div:E,divide:c,dot:k,equals:C,exactEquals:M,floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},len:F,length:y,lerp:b,max:h,min:l,mul:R,multiply:o,negate:g,normalize:m,projectAndScale:T,random:function(e,t){t=t||1;var r=2*(0,n.FD)()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},rotate:w,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:d,scaleAndAdd:f,set:a,sqrDist:A,sqrLen:P,squaredDistance:p,squaredLength:_,str:function(e){return"vec2("+e[0]+", "+e[1]+")"},sub:O,subtract:u,transformMat2:Z,transformMat2d:I,transformMat3:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e},transformMat4:function(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}},Symbol.toStringTag,{value:"Module"}))},76432:function(e,t,r){r.d(t,{t:function(){return c}});var n=r(15671),i=r(43144),a=r(84652),s=r(39052),u=r(56885),o=function(){function e(t,r){(0,n.Z)(this,e),this._observable=new u.s,this._value=t,this._equalityFunction=r}return(0,i.Z)(e,[{key:"value",get:function(){return(0,s.it)(this._observable),this._value},set:function(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}},{key:"mutate",value:function(e){e(this._value),this._observable.notify()}}]),e}();function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.y7;return new o(e,t)}},34311:function(e,t,r){function n(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function i(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return{objectId:e,target:t,distance:r,type:"edge",start:n,end:i,draped:a}}r.d(t,{p:function(){return i},u:function(){return n}})},76151:function(e,t,r){r.d(t,{Qo:function(){return l}});var n=r(37762),i=r(15671),a=r(43144),s=r(43244),u=r(16889),o="__esri_stream_id__",c="__esri_timestamp__",l=function(){function e(t,r,n,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128;(0,i.Z)(this,e),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=n,this._purgeOptions=a,this.store=t,this.objectIdField=r,this.purgeInterval=s,this._useGeneratedIds=this.objectIdField===o}return(0,a.Z)(e,[{key:"removeById",value:function(e){this._removed.push(e)}},{key:"removeByTrackId",value:function(e){var t=this._trackIdToObservations.get(e);if(t){var r,i=(0,n.Z)(t.entries);try{for(i.s();!(r=i.n()).done;){var a=r.value;this._removed.push(a)}}catch(s){i.e(s)}finally{i.f()}}}},{key:"add",value:function(e){if(this._useGeneratedIds){var t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}else e.objectId=e.attributes[this.objectIdField];var r=e.objectId;if(this._addOrUpdated.set(r,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return null==this._trackIdLessObservations&&(this._trackIdLessObservations=new s.Z(1e5)),void this._trackIdLessObservations.enqueue(r);var n=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(n)){var i,a=null!=(null===(i=this._purgeOptions)||void 0===i?void 0:i.maxObservations)?this._purgeOptions.maxObservations:1e3,o=(0,u.uZ)(a,0,1e3);this._trackIdToObservations.set(n,new s.Z(o))}var c=this._trackIdToObservations.get(n),l=null===c||void 0===c?void 0:c.enqueue(r);null!=l&&(this._addOrUpdated.has(l)?this._addOrUpdated.delete(l):this._removed.push(l))}},{key:"checkForUpdates",value:function(){var e=this._getToAdd(),t=this._getToRemove(),r=performance.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(r),this._lastPurge=r);var i=[];if(null!=t){var a,s=(0,n.Z)(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,o=this.store.removeById(u);null!=o&&i.push(o)}}catch(p){s.e(p)}finally{s.f()}}var l=[];if(null!=e){var h,d=new Set(null!==t&&void 0!==t?t:[]),f=(0,n.Z)(e);try{for(f.s();!(h=f.n()).done;){var v=h.value;d.has(v.objectId)||(v.attributes[c]=r,this.store.add(v),l.push(v))}}catch(p){f.e(p)}finally{f.f()}}return!(!l.length&&(null===i||void 0===i||!i.length))&&(this.store.update(l,i),!0)}},{key:"_getToAdd",value:function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((function(r){return e[t++]=r})),this._addOrUpdated.clear(),e}},{key:"_getToRemove",value:function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null}},{key:"_nextId",value:function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}},{key:"_purge",value:function(e){var t=this._purgeOptions;null!=t&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}},{key:"_purgeSomeByDisplayCount",value:function(e){if(e.displayCount){var t=this.store.size;if(t>e.displayCount){if(this._timeInfo.trackIdField){var r,i=(0,n.Z)(this._trackIdToObservations.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;if(t>e.displayCount&&a.size){var s=a.dequeue();this._removed.push(s),t--}}}catch(c){i.e(c)}finally{i.f()}}if(null!=this._trackIdLessObservations)for(var u=t-e.displayCount;u-- >0;){var o=this._trackIdLessObservations.dequeue();null!=o&&this._removed.push(o)}}}}},{key:"_purgeByAge",value:function(e){var t,r=this,n=null===(t=this._timeInfo)||void 0===t?void 0:t.startTimeField;if(e.age&&n){var i=60*e.age*1e3,a=this._maxAge-i;this.store.forEach((function(e){e.attributes[n]<a&&r._removed.push(e.objectId)}))}}},{key:"_purgeByAgeReceived",value:function(e,t){var r=this;if(t.ageReceived){var n=e-60*t.ageReceived*1e3;this.store.forEach((function(e){e.attributes[c]<n&&r._removed.push(e.objectId)}))}}},{key:"_purgeTracks",value:function(){var e=this;this._trackIdToObservations.forEach((function(t,r){0===t.size&&e._trackIdToObservations.delete(r)}))}}]),e}()},22585:function(e,t,r){function n(e){var t={};for(var r in e)if("declaredClass"!==r){var i=e[r];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){t[r]=[];for(var a=0;a<i.length;a++)t[r][a]=n(i[a])}else"object"==typeof i?i.toJSON&&(t[r]=JSON.stringify(i)):t[r]=i}return t}r.d(t,{A:function(){return n}})},5192:function(e,t,r){r.d(t,{Ev:function(){return x},JT:function(){return y},Vn:function(){return w},Vr:function(){return Z},hH:function(){return b},n7:function(){return k},qp:function(){return g}});var n=r(1413),i=r(74165),a=r(15861),s=r(76200),u=r(35995),o=r(77981),c=r(91340),l=r(92975),h=r(22585),d=r(27607),f=r(68620),v="Layer does not support extent calculation.";function p(e,t){var r,n=e.geometry,i=e.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;var a,s,u,c=i;if(null!=n&&(s=n.spatialReference,u=(0,l.B9)(s),c.geometryType=(0,o.Ji)(n),c.geometry=function(e,t){if(t&&"extent"===e.type)return"".concat(e.xmin,",").concat(e.ymin,",").concat(e.xmax,",").concat(e.ymax);if(t&&"point"===e.type)return"".concat(e.x,",").concat(e.y);var r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}(n,e.compactGeometryEnabled),c.inSR=u),i.groupByFieldsForStatistics&&(c.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(c.objectIds=i.objectIds.join(",")),i.orderByFields&&(c.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(null!==t&&void 0!==t&&t.returnCountOnly||null!==t&&void 0!==t&&t.returnExtentOnly||null!==t&&void 0!==t&&t.returnIdsOnly)?delete c.outFields:i.outFields.includes("*")?c.outFields="*":c.outFields=i.outFields.join(","),i.outSR?(c.outSR=(0,l.B9)(i.outSR),a=e.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(c.outSR=c.inSR,a=s),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(c.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(c.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(c.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=s&&null!=(null===(r=e.quantizationParameters)||void 0===r?void 0:r.extent)&&s.equals(e.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,c.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(c.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(c.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(c.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){var h=i.timeExtent,d=h.start,f=h.end;null==d&&null==f||(c.time=d===f?d:"".concat(null!==d&&void 0!==d?d:"null",",").concat(null!==f&&void 0!==f?f:"null")),delete i.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=s&&null!=a&&s.equals(a)&&(c.defaultSR=c.inSR,delete c.inSR,delete c.outSR),c}function y(e,t,r,n){return _.apply(this,arguments)}function _(){return(_=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a){var s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r.timeExtent||!r.timeExtent.isEmpty){e.next=4;break}e.t0={data:{features:[]}},e.next=7;break;case 4:return e.next=6,w(t,r,"json",a);case 6:e.t0=e.sent;case 7:return s=e.t0,e.abrupt("return",((0,f.p)(r,n,s.data),s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,r,n){return m.apply(this,arguments)}function m(){return(m=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a){var s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r.timeExtent||!r.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:n.createFeatureResult()});case 2:return e.next=4,k(t,r,a);case 4:return s=e.sent,u=s,e.abrupt("return",(u.data=(0,d.C)(s.data,n),u));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t,r){return w(e,t,"pbf",r)}function x(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):w(e,t,"json",r,{returnIdsOnly:!0})}function b(e,t,r){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):w(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function Z(e,t,r){return I.apply(this,arguments)}function I(){return(I=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r.timeExtent||!r.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:{count:0,extent:null}});case 2:return e.next=4,w(t,r,"json",n,{returnExtentOnly:!0,returnCountOnly:!0});case 4:if(a=e.sent,!(s=a.data).hasOwnProperty("extent")){e.next=8;break}return e.abrupt("return",a);case 8:if(!s.features){e.next=10;break}throw new Error(v);case 10:if(!s.hasOwnProperty("count")){e.next=12;break}throw new Error(v);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t,r){return S.apply(this,arguments)}function S(){return S=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var o,l,d,f,v,y,_,g=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=g.length>3&&void 0!==g[3]?g[3]:{},l=g.length>4&&void 0!==g[4]?g[4]:{},d="string"==typeof t?(0,u.mN)(t):t,f=r.geometry?[r.geometry]:[],e.next=6,(0,c.aX)(f,null,{signal:o.signal});case 6:return v=e.sent,null!=(y=null===v||void 0===v?void 0:v[0])&&((r=r.clone()).geometry=y),_=(0,h.A)((0,n.Z)((0,n.Z)((0,n.Z)({},d.query),{},{f:a},l),p(r,l))),e.abrupt("return",(0,s.Z)((0,u.v_)(d.path,M(r,l)?"query3d":"query"),(0,n.Z)((0,n.Z)({},o),{},{responseType:"pbf"===a?"array-buffer":"json",query:(0,n.Z)((0,n.Z)({},_),o.query)})));case 11:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function M(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}},23037:function(e,t,r){r.d(t,{Bf:function(){return y},Bj:function(){return b},Df:function(){return p},Py:function(){return x},Qs:function(){return B},Us:function(){return S},aL:function(){return w},iG:function(){return g},ql:function(){return k},se:function(){return _},vZ:function(){return m},zb:function(){return I}});var n,i=r(29439),a=r(54557),s=r(42265),u=r(80987),o=r(32718),c=r(92026),l=r(35995),h=r(25243),d=r(32551),f=r(68954),v=function(){return o.Z.getLogger("esri.support.basemapUtils")};function p(){return{}}function y(e){for(var t in e){var r=e[t];(0,c.SC)(r),delete e[t]}}function _(e,t){var r,n;if("string"==typeof e){var u=e in f.s,o=!u&&e.includes("/");if(!u&&!o){var c=Object.entries(f.s).filter((function(e){var t=(0,i.Z)(e,2),r=(t[0],t[1]);return s.Z.apiKey&&!r.classic||!s.Z.apiKey&&(r.classic||r.is3d)})).map((function(e){var t=(0,i.Z)(e,1)[0];return'"'.concat(t,'"')})).sort().join(", ");return v().warn("Unable to find basemap definition for: ".concat(e,". Try one of these: ").concat(c)),null}t&&(n=t[e]),n||(n=u?a.default.fromId(e):new a.default({style:{id:e}}),t&&(t[e]=n))}else n=(0,h.se)(a.default,e);return null!==(r=n)&&void 0!==r&&r.destroyed&&(v().warn("The provided basemap is already destroyed",{basemap:n}),n=null),n}function g(e){var t;return"Web Scene"===(null===(t=e.portalItem)||void 0===t?void 0:t.type)||e.referenceLayers.some((function(e){return"scene"===e.type}))}function m(e){var t,r;return!(null===e||void 0===e||null===(t=e.portalItem)||void 0===t||null===(r=t.tags)||void 0===r||!r.some((function(e){return"beta"===e.toLowerCase()})))}function k(e,t){var r,n,i,a;return(null===(r=e.basemap)||void 0===r||null===(n=r.referenceLayers)||void 0===n?void 0:n.some((function(e){return e.uid===t})))||(null===(i=e.basemap)||void 0===i||null===(a=i.baseLayers)||void 0===a?void 0:a.some((function(e){return e.uid===t})))}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=_(e);if(!r)return null;var n=r.clone();return t&&(n.baseLayers=Z(n.baseLayers,t.baseLayers),n.referenceLayers=Z(n.referenceLayers,t.referenceLayers)),n}function b(e,t){var r,n;return e===t||(null!=(null===e||void 0===e||null===(r=e.portalItem)||void 0===r?void 0:r.id)&&e.portalItem.id===(null===t||void 0===t||null===(n=t.portalItem)||void 0===n?void 0:n.id)||"equal"===A(T(e),T(t),{mustMatchReferences:!0}))}function Z(e,t){var r=new u.Z;return e.forEach((function(e){var n=t.find((function(t){return"scene"!==t.type&&L(O(e),O(t))}))||e;r.includes(n)?r.push(e):r.push(n)})),r}function I(e){return!(null===e||void 0===e||!e.baseLayers.concat(e.referenceLayers).some(w))}function w(e){if(C(e.url))return!0;if("vector-tile"===e.type)for(var t in e.sourceNameToSource){var r=e.sourceNameToSource[t];if(C(null===r||void 0===r?void 0:r.sourceUrl))return!0}return!1}function S(e,t){var r,n,i;if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};var a=t.baseLayers.at(0);switch(a.loadStatus){case"not-loaded":a.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}var s=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?null===(r=a.tileInfo)||void 0===r?void 0:r.spatialReference:a.spatialReference]).filter(Boolean),u=e.spatialReference;return u?{spatialReference:null!==(n=null!==(i=s.find((function(e){return u.equals(e)})))&&void 0!==i?i:s[0])&&void 0!==n?n:null,updating:!1}:{spatialReference:s[0],updating:!1}}var M=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function C(e){if(!e)return!1;var t=new l.R9((0,l.hF)(e));return!!t.authority&&M.test(t.authority)}function T(e){return e?!e.loaded&&e.resourceInfo?E(e.resourceInfo.data):{baseLayers:F(e.baseLayers),referenceLayers:F(e.referenceLayers)}:null}function F(e){return(u.Z.isCollection(e)?e.toArray():e).map(O)}function O(e){var t,r;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:D("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers||null===(t=e.sublayers)||void 0===t?void 0:t.map((function(e){return{id:e.id,visible:e.visible}})),activeLayerId:"wmts"===e.type?null===(r=e.activeLayer)||void 0===r?void 0:r.id:void 0}}function R(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function E(e){var t,r;return e?{baseLayers:q((null!==(t=e.baseMapLayers)&&void 0!==t?t:[]).filter((function(e){return!R(e)}))),referenceLayers:q((null!==(r=e.baseMapLayers)&&void 0!==r?r:[]).filter((function(e){return R(e)})))}:null}function q(e){return e.map((function(e){return function(e){var t,r,n,i;switch(e.layerType){case"VectorTileLayer":i="vector-tile";break;case"ArcGISTiledMapServiceLayer":i="tile";break;case"ArcGISSceneServiceLayer":i="scene";break;default:i="unknown"}return{type:i,effect:e.effect,url:D(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:null!==(t=e.minScale)&&void 0!==t?t:0,maxScale:null!==(r=e.maxScale)&&void 0!==r?r:0,opacity:null!==(n=e.opacity)&&void 0!==n?n:1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e)}))}function A(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?P(e.baseLayers,t.baseLayers)?P(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function P(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!L(e[r],t[r]))return!1;return!0}function L(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!(0,d.yQ)(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(var r=0;r<e.sublayers.length;r++){var n=e.sublayers.at(r),i=t.sublayers.at(r);if((null===n||void 0===n?void 0:n.id)!==(null===i||void 0===i?void 0:i.id)||(null===n||void 0===n?void 0:n.visible)!==(null===i||void 0===i?void 0:i.visible))return!1}}return!0}function D(e){return e?(0,l.Fv)(e).replace(/^\s*https?:/i,"").toLowerCase():""}function B(e){if(!e)return null;var t=e.thumbnailUrl;if(t)return t;var r=function(e){if(n)return n(e);var t=null,r=T(e),i=!(null!==r&&void 0!==r&&r.baseLayers.length);for(var a in f.s){var s=A(r,E(f.s[a]),{mustMatchReferences:i});if("equal"===s){t=a;break}"base-layers-equal"===s&&(t=a)}return t}(e);return r?f.s[r].thumbnailUrl:(0,c.ei)(e.baseLayers,j)}function j(e){var t;return"portalItem"in e?null===(t=e.portalItem)||void 0===t?void 0:t.thumbnailUrl:void 0}},48202:function(e,t,r){var n,i,a,s,u,o,c,l,h,d,f,v,p,y,_,g,m,k,x,b,Z,I,w,S,M,C,T,F,O,R,E,q,A,P,L,D,B,j,N,U,W,z,G,Y,X,V,H,J,Q,K,$,ee,te,re,ne,ie,ae,se,ue,oe,ce;r.d(t,{$y:function(){return I},AH:function(){return i},CS:function(){return H},DD:function(){return l},Dd:function(){return O},Em:function(){return Z},JS:function(){return X},Ky:function(){return h},Lh:function(){return J},Qb:function(){return ae},RL:function(){return n},RS:function(){return ue},TF:function(){return b},Tx:function(){return u},UR:function(){return m},UX:function(){return ie},bj:function(){return V},eZ:function(){return c},id:function(){return M},kP:function(){return D},of:function(){return f},r4:function(){return U},sj:function(){return B},v2:function(){return a},zQ:function(){return F},zV:function(){return g}}),function(e){e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e[e.UNKNOWN=4]="UNKNOWN"}(n||(n={})),function(e){e[e.BEVEL=0]="BEVEL",e[e.ROUND=1]="ROUND",e[e.MITER=2]="MITER",e[e.UNKNOWN=4]="UNKNOWN"}(i||(i={})),function(e){e[e.SCREEN=0]="SCREEN",e[e.MAP=1]="MAP"}(a||(a={})),function(e){e[e.Tint=0]="Tint",e[e.Ignore=1]="Ignore",e[e.Multiply=99]="Multiply"}(s||(s={})),function(e){e.Both="Both",e.JustBegin="JustBegin",e.JustEnd="JustEnd",e.None="None"}(u||(u={})),function(e){e[e.Mosaic=0]="Mosaic",e[e.Centered=1]="Centered"}(o||(o={})),function(e){e[e.Normal=0]="Normal",e[e.Superscript=1]="Superscript",e[e.Subscript=2]="Subscript"}(c||(c={})),function(e){e[e.MSSymbol=0]="MSSymbol",e[e.Unicode=1]="Unicode"}(l||(l={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.TrueType=1]="TrueType",e[e.PSOpenType=2]="PSOpenType",e[e.TTOpenType=3]="TTOpenType",e[e.Type1=4]="Type1"}(h||(h={})),function(e){e[e.Display=0]="Display",e[e.Map=1]="Map"}(d||(d={})),function(e){e.None="None",e.Loop="Loop",e.Oscillate="Oscillate"}(f||(f={})),function(e){e[e.Z=0]="Z",e[e.X=1]="X",e[e.Y=2]="Y"}(v||(v={})),function(e){e[e.XYZ=0]="XYZ",e[e.ZXY=1]="ZXY",e[e.YXZ=2]="YXZ"}(p||(p={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.RoundedRectangle=1]="RoundedRectangle",e[e.Oval=2]="Oval"}(y||(y={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.Screen=2]="Screen",e[e.Multiply=3]="Multiply",e[e.Add=4]="Add"}(_||(_={})),function(e){e[e.TTB=0]="TTB",e[e.RTL=1]="RTL",e[e.BTT=2]="BTT"}(g||(g={})),function(e){e[e.None=0]="None",e[e.SignPost=1]="SignPost",e[e.FaceNearPlane=2]="FaceNearPlane"}(m||(m={})),function(e){e[e.Float=0]="Float",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(k||(k={})),function(e){e[e.Intersect=0]="Intersect",e[e.Subtract=1]="Subtract"}(x||(x={})),function(e){e.OpenEnded="OpenEnded",e.Block="Block",e.Crossed="Crossed"}(b||(b={})),function(e){e.FullGeometry="FullGeometry",e.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",e.ReversedFirstSegment="ReversedFirstSegment",e.PerpendicularToSecondSegment="PerpendicularToSecondSegment",e.SecondSegmentWithTicks="SecondSegmentWithTicks",e.DoublePerpendicular="DoublePerpendicular",e.OppositeToFirstSegment="OppositeToFirstSegment",e.TriplePerpendicular="TriplePerpendicular",e.HalfCircleFirstSegment="HalfCircleFirstSegment",e.HalfCircleSecondSegment="HalfCircleSecondSegment",e.HalfCircleExtended="HalfCircleExtended",e.OpenCircle="OpenCircle",e.CoverageEdgesWithTicks="CoverageEdgesWithTicks",e.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",e.GapExtentMidline="GapExtentMidline",e.Chevron="Chevron",e.PerpendicularWithArc="PerpendicularWithArc",e.ClosedHalfCircle="ClosedHalfCircle",e.TripleParallelExtended="TripleParallelExtended",e.ParallelWithTicks="ParallelWithTicks",e.Parallel="Parallel",e.PerpendicularToFirstSegment="PerpendicularToFirstSegment",e.ParallelOffset="ParallelOffset",e.OffsetOpposite="OffsetOpposite",e.OffsetSame="OffsetSame",e.CircleWithArc="CircleWithArc",e.DoubleJog="DoubleJog",e.PerpendicularOffset="PerpendicularOffset",e.LineExcludingLastSegment="LineExcludingLastSegment",e.MultivertexArrow="MultivertexArrow",e.CrossedArrow="CrossedArrow",e.ChevronArrow="ChevronArrow",e.ChevronArrowOffset="ChevronArrowOffset",e.PartialFirstSegment="PartialFirstSegment",e.Arch="Arch",e.CurvedParallelTicks="CurvedParallelTicks",e.Arc90Degrees="Arc90Degrees",e.TipWithPerpendicularAndTicks="TipWithPerpendicularAndTicks"}(Z||(Z={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square",e.TrueBuffer="TrueBuffer"}(I||(I={})),function(e){e.ClosePath="ClosePath",e.ConvexHull="ConvexHull",e.RectangularBox="RectangularBox"}(w||(w={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(S||(S={})),function(e){e.Mitered="Mitered",e.Bevelled="Bevelled",e.Rounded="Rounded",e.Square="Square"}(M||(M={})),function(e){e.Fast="Fast",e.Accurate="Accurate"}(C||(C={})),function(e){e.BeginningOfLine="BeginningOfLine",e.EndOfLine="EndOfLine"}(T||(T={})),function(e){e.Sinus="Sinus",e.Square="Square",e.Triangle="Triangle",e.Random="Random"}(F||(F={})),function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Force=2]="Force"}(O||(O={})),function(e){e[e.Buffered=0]="Buffered",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.AlongLine=3]="AlongLine"}(R||(R={})),function(e){e[e.Linear=0]="Linear",e[e.Rectangular=1]="Rectangular",e[e.Circular=2]="Circular",e[e.Buffered=3]="Buffered"}(E||(E={})),function(e){e[e.Discrete=0]="Discrete",e[e.Continuous=1]="Continuous"}(q||(q={})),function(e){e[e.AcrossLine=0]="AcrossLine",e[e.AloneLine=1]="AloneLine"}(A||(A={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justify=3]="Justify"}(P||(P={})),function(e){e[e.Base=0]="Base",e[e.MidPoint=1]="MidPoint",e[e.ThreePoint=2]="ThreePoint",e[e.FourPoint=3]="FourPoint",e[e.Underline=4]="Underline",e[e.CircularCW=5]="CircularCW",e[e.CircularCCW=6]="CircularCCW"}(L||(L={})),function(e){e.Butt="Butt",e.Round="Round",e.Square="Square"}(D||(D={})),function(e){e.NoConstraint="NoConstraint",e.HalfPattern="HalfPattern",e.HalfGap="HalfGap",e.FullPattern="FullPattern",e.FullGap="FullGap",e.Custom="Custom"}(B||(B={})),function(e){e[e.None=-1]="None",e[e.Custom=0]="Custom",e[e.Circle=1]="Circle",e[e.OpenArrow=2]="OpenArrow",e[e.ClosedArrow=3]="ClosedArrow",e[e.Diamond=4]="Diamond"}(j||(j={})),function(e){e[e.ExtraLeading=0]="ExtraLeading",e[e.Multiple=1]="Multiple",e[e.Exact=2]="Exact"}(N||(N={})),function(e){e.Bevel="Bevel",e.Round="Round",e.Miter="Miter"}(U||(U={})),function(e){e[e.Default=0]="Default",e[e.String=1]="String",e[e.Numeric=2]="Numeric"}(W||(W={})),function(e){e[e.InsidePolygon=0]="InsidePolygon",e[e.PolygonCenter=1]="PolygonCenter",e[e.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(z||(z={})),function(e){e[e.Tint=0]="Tint",e[e.Replace=1]="Replace",e[e.Multiply=2]="Multiply"}(G||(G={})),function(e){e[e.ClipAtBoundary=0]="ClipAtBoundary",e[e.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",e[e.DoNotTouchBoundary=2]="DoNotTouchBoundary",e[e.DoNotClip=3]="DoNotClip"}(Y||(Y={})),function(e){e.NoConstraint="NoConstraint",e.WithMarkers="WithMarkers",e.WithFullGap="WithFullGap",e.WithHalfGap="WithHalfGap",e.Custom="Custom"}(X||(X={})),function(e){e.Fixed="Fixed",e.Random="Random",e.RandomFixedQuantity="RandomFixedQuantity"}(V||(V={})),function(e){e.LineMiddle="LineMiddle",e.LineBeginning="LineBeginning",e.LineEnd="LineEnd",e.SegmentMidpoint="SegmentMidpoint"}(H||(H={})),function(e){e.OnPolygon="OnPolygon",e.CenterOfMass="CenterOfMass",e.BoundingBoxCenter="BoundingBoxCenter"}(J||(J={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(Q||(Q={})),function(e){e[e.MarkerCenter=0]="MarkerCenter",e[e.MarkerBounds=1]="MarkerBounds"}(K||(K={})),function(e){e[e.None=0]="None",e[e.PropUniform=1]="PropUniform",e[e.PropNonuniform=2]="PropNonuniform",e[e.DifUniform=3]="DifUniform",e[e.DifNonuniform=4]="DifNonuniform"}($||($={})),function(e){e.Tube="Tube",e.Strip="Strip",e.Wall="Wall"}(ee||(ee={})),function(e){e[e.Random=0]="Random",e[e.Increasing=1]="Increasing",e[e.Decreasing=2]="Decreasing",e[e.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(te||(te={})),function(e){e[e.Relative=0]="Relative",e[e.Absolute=1]="Absolute"}(re||(re={})),function(e){e[e.Normal=0]="Normal",e[e.LowerCase=1]="LowerCase",e[e.Allcaps=2]="Allcaps"}(ne||(ne={})),function(e){e[e.LTR=0]="LTR",e[e.RTL=1]="RTL"}(ie||(ie={})),function(e){e.Draft="Draft",e.Picture="Picture",e.Text="Text"}(ae||(ae={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Baseline=2]="Baseline",e[e.Bottom=3]="Bottom"}(se||(se={})),function(e){e[e.Right=0]="Right",e[e.Upright=1]="Upright"}(ue||(ue={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(oe||(oe={})),function(e){e[e.Calm=0]="Calm",e[e.Rippled=1]="Rippled",e[e.Slight=2]="Slight",e[e.Moderate=3]="Moderate"}(ce||(ce={}))},8841:function(e,t,r){r.d(t,{EC:function(){return a},Oo:function(){return u},ck:function(){return s}});var n=r(51995),i=r(64634),a={selection:function(e){return new i.Z({color:new n.Z([e.color.r/2,e.color.g/2,e.color.b/2,e.color.a])})},highlight:function(e){return e},popup:function(e){return new i.Z({color:new n.Z([e.color.g,e.color.b,e.color.r,e.color.a])})}};function s(e){if(!e)return 0;var t=1;for(var r in a){if(r===e)break;t<<=1}return t}var u=Object.keys(a)},28289:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(15671),i=r(43144),a=r(30932),s=function(){function e(t,r,i,s){(0,n.Z)(this,e),this.computedX=0,this.computedY=0,this.center=(0,a.al)(t,r),this.centerT=(0,a.Ue)(),this.halfWidth=i/2,this.halfHeight=s/2,this.width=i,this.height=s}return(0,i.Z)(e,[{key:"x",get:function(){return this.center[0]},set:function(e){this.center[0]=e}},{key:"y",get:function(){return this.center[1]},set:function(e){this.center[1]=e}},{key:"blX",get:function(){return this.center[0]+this.halfWidth}},{key:"blY",get:function(){return this.center[1]+this.halfHeight}},{key:"trX",get:function(){return this.center[0]-this.halfWidth}},{key:"trY",get:function(){return this.center[1]-this.halfHeight}},{key:"xmin",get:function(){return this.x-this.halfWidth}},{key:"xmax",get:function(){return this.x+this.halfWidth}},{key:"ymin",get:function(){return this.y-this.halfHeight}},{key:"ymax",get:function(){return this.y+this.halfHeight}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"serialize",value:function(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}},{key:"findCollisionDelta",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=Math.abs(e.centerT[0]-this.centerT[0]),n=Math.abs(e.centerT[1]-this.centerT[1]),i=(e.halfWidth+this.halfWidth+t)/r,a=(e.halfHeight+this.halfHeight+t)/n,s=Math.min(i,a);return Math.log2(s)}},{key:"extend",value:function(e){var t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),n=Math.max(this.xmax,e.xmax)-t,i=Math.max(this.ymax,e.ymax)-r,a=t+n/2,s=r+i/2;this.width=n,this.height=i,this.halfWidth=n/2,this.halfHeight=i/2,this.x=a,this.y=s}}],[{key:"deserialize",value:function(t){return new e(t.readF32(),t.readF32(),t.readInt32(),t.readInt32())}}]),e}()},94109:function(e,t,r){r.d(t,{$0:function(){return L},A5:function(){return H},BZ:function(){return W},FM:function(){return D},GV:function(){return X},Ib:function(){return f},J1:function(){return G},JS:function(){return B},KA:function(){return j},Kt:function(){return h},Ly:function(){return g},NG:function(){return U},NT:function(){return J},NY:function(){return v},Of:function(){return Z},Pp:function(){return u},S3:function(){return T},Sf:function(){return b},Uz:function(){return N},Vo:function(){return q},Zt:function(){return x},_8:function(){return V},_E:function(){return E},ad:function(){return s},bm:function(){return y},ce:function(){return m},cz:function(){return k},dD:function(){return R},do:function(){return M},fG:function(){return O},g3:function(){return w},gj:function(){return l},i9:function(){return a},iA:function(){return P},iD:function(){return c},j1:function(){return _},k9:function(){return i},kU:function(){return S},l3:function(){return Y},nn:function(){return z},pd:function(){return F},s4:function(){return A},uk:function(){return o},vk:function(){return I},wJ:function(){return d},wN:function(){return C},wi:function(){return n},zZ:function(){return p}});var n,i=1e-30,a=512,s=16777216,u=8,o=29,c=24,l=4,h=0,d=0,f=0,v=1,p=2,y=3,_=4,g=5,m=6,k=12,x=5,b=6,Z=5,I=6;!function(e){e[e.FilterFlags=0]="FilterFlags",e[e.Animation=1]="Animation",e[e.GPGPU=2]="GPGPU",e[e.VV=3]="VV",e[e.DD0=4]="DD0",e[e.DD1=5]="DD1",e[e.DD2=6]="DD2"}(n||(n={}));var w=8,S=w<<1,M=1.05,C=3,T=1,F=3,O=3,R=5,E=6,q=1.15,A=2,P=128,L=256-2*A,D=2,B=10,j=1024,N=128,U=4,W=1,z=1<<20,G=.75,Y=10,X=.75,V=256,H=32,J=512},24731:function(e,t,r){r.r(t),r.d(t,{default:function(){return br}});var n=r(37762),i=r(74165),a=r(15861),s=r(43144),u=r(15671),o=r(10064),c=r(42537),l=r(93169),h=r(70758),d=r(66978),f=r(84936),v=r(94172),p=r(17842),y=r(44506),_=r(22824),g=r(37995),m=r(73828),k=(r(32344),r(85269),r(94109)),x=function(){function e(t){(0,u.Z)(this,e),this._client=t,this.layerView=this._client.createInvokeProxy(""),this.container=this._client.createInvokeProxy("container"),this._eventLog=this._client.createInvokeProxy("eventLog")}return(0,s.Z)(e,[{key:"onEvent",value:function(e){(0,y.d2)(this._eventLog.onEvent(e))}}]),e}(),b=r(1413),Z=r(16296),I=r(92026),w=r(18202),S=r(48732),M=r(78952),C=r(93433),T=r(71942),F=r(35092),O=128;function R(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case O:return 1}}function E(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case O:return 1}}var q=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,u.Z)(this,e),this.tileKey=t,this._bufferingEnabled=r,this._sizeHint=i,this._meshes={self:new T._(this.id,this._sizeHint),neighbors:new Array},this._currentRecordOverlaps=0,this._currentEntityOverlaps=0,this._copyBufferedDataIntoSelf=n&&this._bufferingEnabled&&0===t.level}return(0,s.Z)(e,[{key:"id",get:function(){return this.tileKey.id}},{key:"vertexCount",value:function(){return this._meshes.self.vertexCount()}},{key:"indexCount",value:function(){return this._meshes.self.indexCount()}},{key:"indexEnsureSize",value:function(e){this._meshes.self.indexEnsureSize(e)}},{key:"entityStart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;this._currentEntityOverlaps=0,this._meshes.self.entityStart(e,t)}},{key:"entityRecordCount",value:function(){return this._meshes.self.entityRecordCount()}},{key:"entityEnd",value:function(){if(this._meshes.self.entityEnd(),this._bufferingEnabled){if(this._copyBufferedDataIntoSelf)return;for(var e=0;e<8;e++){var t=1<<e;this._currentEntityOverlaps&t&&this._meshes.neighbors[e].entityEnd()}}}},{key:"recordStart",value:function(e,t,r){this._currentRecordOverlaps=0,this._meshes.self.recordStart(e,t,r)}},{key:"recordEnd",value:function(){var e=this._meshes.self.recordEnd(this._currentRecordOverlaps);return e&&0!==this._currentRecordOverlaps?(this._copyIntoNeighbors(),this._currentEntityOverlaps|=this._currentRecordOverlaps,!0):e}},{key:"recordBounds",value:function(e,t,r,n){this._bufferingEnabled&&this._addOverlap(e,t,r,n)}},{key:"recordCount",value:function(){return this._meshes.self.recordCount()}},{key:"metricStart",value:function(e){this._meshes.self.metricStart(e)}},{key:"metricBoxWrite",value:function(e){this._meshes.self.metricBoxWrite(e)}},{key:"metricEnd",value:function(){this._meshes.self.metricEnd()}},{key:"vertexWrite",value:function(e){this._meshes.self.vertexWrite(e)}},{key:"vertexWriteF32",value:function(e){this._meshes.self.vertexWriteF32(e)}},{key:"vertexWriteRegion",value:function(e){this._meshes.self.vertexWriteRegion(e)}},{key:"indexWrite",value:function(e){this._meshes.self.indexWrite(e)}},{key:"serialize",value:function(e){var t,r=this,n={message:[],transferList:[]},i=this._meshes.self.serialize();return n.message.push((0,b.Z)({tileId:this.tileKey.id},i.message)),(t=n.transferList).push.apply(t,(0,C.Z)(i.transferList)),this._meshes.neighbors.forEach((function(t,i){var a,s=t.serialize(),u=1<<i,o=R(u),c=E(u),l=(0,F.M)(new m.Z(r.tileKey),o,c,e);n.message.push((0,b.Z)({tileId:l.id},s.message)),(a=n.transferList).push.apply(a,(0,C.Z)(s.transferList))})),n}},{key:"_addOverlap",value:function(e,t,r,n){var i=Math.min(k.i9/2,r),a=Math.min(k.i9/2,n),s=255^((e<0+i?148:e>=k.i9-i?41:189)|(t<0+a?224:t>=k.i9-a?7:231));this._currentRecordOverlaps|=s}},{key:"_copyIntoNeighbors",value:function(){for(var e=0;e<8;e++){var t=1<<e;if(this._currentRecordOverlaps&t){if(this._copyBufferedDataIntoSelf){var r=-R(t)*k.i9,n=-E(t)*k.i9;if(0!==n)continue;this._meshes.self.copyLast(r,n);continue}if(!this._meshes.neighbors[e]){var i=Math.floor(this._sizeHint/16);this._meshes.neighbors[e]=new T._(t,i)}var a=this._meshes.neighbors[e],s=-R(t)*k.i9,u=-E(t)*k.i9;a.copyLastFrom(this._meshes.self,s,u)}}}}]),e}(),A=r(60136),P=r(29388),L=(0,s.Z)((function e(){(0,u.Z)(this,e)})),D=r(29439),B=function(){function e(){(0,u.Z)(this,e),this._defaultResult=null,this._backgroundFillResult=null}return(0,s.Z)(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"getBackgroundFill",value:function(){return this._backgroundFillResult}},{key:"setBackgroundFill",value:function(e){this._backgroundFillResult=e}},{key:"match",value:function(e,t){var r=this.doMatch(e,t)||this.getDefault();if(r&&r.length>0){var n=this.getBackgroundFill();if(n)return[].concat((0,C.Z)(n),(0,C.Z)(r))}return r}},{key:"getSortKey",value:function(e,t){return 0}},{key:"doMatch",value:function(e,t){return null}},{key:"fetchResources",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"from",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,n){var a;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new e,t.t0=a,t.next=4,r.createMeshWriters(n.meshes);case 4:return t.t1=t.sent,t.t0.setDefault.call(t.t0,t.t1),t.abrupt("return",a);case 7:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}]),e}(),j=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this))._context=e,i._schema=n,i._hashToGroup=new Map,i}return(0,s.Z)(r,[{key:"fieldMap",get:function(){return this._schema.fieldMap}},{key:"fetchResources",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=r.getCursor(),a=[];n.next();)a.push(this._updateMeshWriterGroup(t,n));return e.next=4,Promise.all(a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t){var r=e.getAttributeHash();return this._hashToGroup.get(r)}},{key:"_updateMeshWriterGroup",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.readLegacyFeatureForDisplay(),a=r.getAttributeHash(),!this._hashToGroup.has(a)){e.next=3;break}return e.abrupt("return");case 3:return this._hashToGroup.set(a,null),e.next=6,t.fetchDictionaryResourceImmediate({type:"dictionary-request",feature:n});case 6:if(s=e.sent){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this._context.createMeshWriters(s.meshes);case 11:u=e.sent,this._hashToGroup.set(a,u);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"fromDictionaryRenderer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new r(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(B),N=r(88301),U=r(61120),W=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this))._intervals=[],i._isMaxInclusive=n,i._field=e,i}return(0,s.Z)(r,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return(0,N.Z)((0,U.Z)(r.prototype),"size",this).call(this)+this._intervals.length}},{key:"doMatch",value:function(e,t){var r,n=null===(r=this._field)||void 0===r?void 0:r.read(e,t);if(null==n||isNaN(n)||n===1/0||n===-1/0)return null;for(var i=0;i<this._intervals.length;i++){var a=this._intervals[i],s=a.interval,u=a.result,o=n>=s.min,c=this._isMaxInclusive?n<=s.max:n<s.max;if(o&&c)return u}return null}}],[{key:"fromIntervalSchema",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var s,u,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.storage.createComputedField(n);case 2:return s=e.sent,u=new r(s,n.isMaxInclusive),e.next=6,Promise.all(n.intervals.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createMeshWriters(r.meshes);case 2:n=e.sent,u.add(r,n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.next=8,t.createMeshWriters(n.defaultSymbol);case 8:return o=e.sent,u.setDefault(o),e.next=12,t.createMeshWriters(n.backgroundFill);case 12:return c=e.sent,e.abrupt("return",(u.setBackgroundFill(c),u));case 14:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(B),z=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this))._labels=e,n}return(0,s.Z)(r,[{key:"match",value:function(e,t){if(!this._labels.length)return null;var r,i=this._getLabels(t.$view.scale),a=[],s=(0,n.Z)(i);try{for(s.s();!(r=s.n()).done;){var u=r.value;u.where&&!u.where(e)||a.push.apply(a,(0,C.Z)(u.meshes))}}catch(o){s.e(o)}finally{s.f()}return a}},{key:"_getLabels",value:function(e){var t=this;return this._labels.filter((function(r){return t._validForTileScale(r,e)}))}},{key:"_validForTileScale",value:function(e,t){var r=t-t/4,n=t+t/2;return(!e.minScale||e.minScale>=r)&&(!e.maxScale||e.maxScale<=n)}}],[{key:"fromLabelSchema",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.classes.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createMeshWriters(r.meshes);case 2:return n=e.sent,e.t0=r.minScale,e.t1=r.maxScale,e.t2=n,e.next=8,t.storage.createWhereClause(r.where);case 8:return e.t3=e.sent,e.abrupt("return",{minScale:e.t0,maxScale:e.t1,meshes:e.t2,expression:null,where:e.t3});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(s);case 3:return u=e.sent,e.abrupt("return",new r(u));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(B),G=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this))._defaultSymbolSortKey=0,i._nullResult=null,i._resultsMap=new Map,i._fields=[],i._fields=e,i._separator=n||"",i}return(0,s.Z)(r,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"getSortKey",value:function(e,t){var r=this._getValueFromFields(e,t);if(null==r||""===r||"<Null>"===r)return 0;var n=this._resultsMap.get(r.toString());return n?n.sortKey:this._defaultSymbolSortKey}},{key:"add",value:function(e,t,r){this._resultsMap.set(e.toString(),{meshWriters:t,sortKey:r}),this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,r+1)}},{key:"size",value:function(){return(0,N.Z)((0,U.Z)(r.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"doMatch",value:function(e,t){var r,n=this._getValueFromFields(e,t);if(null!==this._nullResult&&(null==n||""===n||"<Null>"===n))return this._nullResult;if(null==n)return null;var i=n.toString();return null===(r=this._resultsMap.get(i))||void 0===r?void 0:r.meshWriters}},{key:"_getValueFromFields",value:function(e,t){var r,i=[],a=(0,n.Z)(this._fields);try{for(a.s();!(r=a.n()).done;){var s=r.value.read(e,t);null==s||""===s?i.push("<Null>"):i.push(s)}}catch(u){a.e(u)}finally{a.f()}return i.join(this._separator)}}],[{key:"fromMatcherSchema",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var s,u,o,c,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.expression?[t.storage.createComputedField({expression:n.expression})]:[n.field?t.storage.createComputedField({field:n.field}):null,n.field2?t.storage.createComputedField({field:n.field2}):null,n.field3?t.storage.createComputedField({field:n.field3}):null],e.next=3,Promise.all(s);case 3:return u=e.sent.filter((function(e){return!!e})),o=new r(u,n.fieldDelimiter),e.next=7,t.createMeshWriters(n.defaultSymbol);case 7:return c=e.sent,o.setDefault(c),e.next=11,t.createMeshWriters(n.backgroundFill);case 11:return l=e.sent,o.setBackgroundFill(l),e.next=15,Promise.all(n.map.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(r,n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createMeshWriters(r.symbol);case 2:a=e.sent,"<Null>"===r.value?o.setNullResult(a):o.add(r.value,a,n+1);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(B);function Y(e,t){return X.apply(this,arguments)}function X(){return X=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r.type,e.next="simple"===e.t0||"heatmap"===e.t0||"dot-density"===e.t0||"pie-chart"===e.t0?3:"interval"===e.t0?4:"dictionary"===e.t0?5:"label"===e.t0?6:"map"===e.t0?7:"subtype"===e.t0?8:"cluster"===e.t0?9:10;break;case 3:return e.abrupt("return",B.from(t,r));case 4:return e.abrupt("return",W.fromIntervalSchema(t,r));case 5:return e.abrupt("return",j.fromDictionaryRenderer(t,r));case 6:return e.abrupt("return",z.fromLabelSchema(t,r));case 7:return e.abrupt("return",G.fromMatcherSchema(t,r));case 8:return e.abrupt("return",V.fromSubtypes(t,r));case 9:return e.abrupt("return",H.fromClusterSchema(t,r));case 10:throw new Error("Impl");case 11:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}var V=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this))._subMatchers=e,i._subtypeField=n,i}return(0,s.Z)(r,[{key:"match",value:function(e,t){var r=e.readAttribute(this._subtypeField),n=this._subMatchers.get(r);return n?n.match(e,t):null}}],[{key:"fromSubtypes",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a,s,u,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o in a=new Map,s=[],u=function(e){var r=parseInt(e,10),i=Y(t,n.renderers[e]).then((function(e){return a.set(r,e)}));s.push(i)},n.renderers)u(o);return e.next=5,Promise.all(s);case 5:return e.abrupt("return",new r(a,n.subtypeField));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(B),H=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this))._featureMatcher=e,i._clusterMatcher=n,i}return(0,s.Z)(r,[{key:"match",value:function(e,t){return 1===e.readAttribute("cluster_count")?this._featureMatcher.match(e,t):this._clusterMatcher.match(e,t)}}],[{key:"fromClusterSchema",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a,s,u,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Y(t,n.feature),Y(t,n.cluster)]);case 2:return a=e.sent,s=(0,D.Z)(a,2),u=s[0],o=s[1],e.abrupt("return",new r(u,o));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(B),J=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this))._symbology=e,i._labels=n,i}return(0,s.Z)(r,[{key:"destroy",value:function(){}},{key:"enqueueMatcherRequests",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._symbology.fetchResources(t,r),null===(n=this._labels)||void 0===n?void 0:n.fetchResources(t,r)]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"enqueueWriterRequests",value:function(e,t,r){var i=this._symbology.match(t,r);if(i){var a,s=(0,n.Z)(i);try{for(s.s();!(a=s.n()).done;){a.value.enqueueRequest(e,t,r)}}catch(l){s.e(l)}finally{s.f()}if(this._labels){var u=this._labels.match(t,r);if(!u)return;var o,c=(0,n.Z)(u);try{for(c.s();!(o=c.n()).done;){o.value.enqueueRequest(e,t,r)}}catch(l){c.e(l)}finally{c.f()}}}}},{key:"write",value:function(e,t,r,i,a){var s=this._symbology.match(r,i);if(s){var u,o=(0,n.Z)(s);try{for(o.s();!(u=o.n()).done;){u.value.write(e,t,r,i,a)}}catch(f){o.e(f)}finally{o.f()}if(e.entityRecordCount()>=1&&this._labels){var c=this._labels.match(r,i);if(!c)return;var l,h=(0,n.Z)(c);try{for(h.s();!(l=h.n()).done;){var d=l.value;d.setReferences(s),d.write(e,t,r,i,a)}}catch(f){h.e(f)}finally{h.f()}}}}},{key:"getSortKey",value:function(e,t){return this._symbology.getSortKey(e,t)}}],[{key:"create",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y(t,n.symbology);case 2:if(a=e.sent,!n.labels){e.next=9;break}return e.next=6,Y(t,n.labels);case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=null;case 10:return s=e.t0,e.abrupt("return",new r(a,s));case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(L),Q=r(9940),K=r(86540),$=function(){function e(t,r,n,i){(0,u.Z)(this,e),this.storage=t,this.proxy=r,this.viewParams=n,this.registry=i}return(0,s.Z)(e,[{key:"createMeshWriters",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.map((function(e){return n.registry.createMeshWriter(n.storage,n.proxy,n.viewParams,e)})),e.abrupt("return",Promise.all(r));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ee=r(38164),te=function(){function e(t){(0,u.Z)(this,e),this._outstandingMessages=[],this._queue=new ee.e({concurrency:t.concurrency,process:function(e){return t.process(e)}})}return(0,s.Z)(e,[{key:"push",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.end){e.next=6;break}return e.next=3,Promise.all(this._outstandingMessages);case 3:return e.next=5,this._queue.push(t);case 5:return e.abrupt("return",void(this._outstandingMessages=[]));case 6:return r=this._queue.push(t),e.abrupt("return",(this._outstandingMessages.push(r),r));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),re=r(24191);function ne(e){var t={},r=!1;function n(t,n){return r=!0,n=new Promise((function(r){r(e[t](n))})),{done:!1,value:new re.Z(n,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}var ie=r(26420),ae=r(50608),se=(r(59486),r(83406)),ue=r(3182),oe=r(19995),ce=r(1919),le=function(){function e(t,r,n,i,a){(0,u.Z)(this,e),this.name=t,this.alias=r,this.type=n,this.statisticType=i,this.computed=a}return(0,s.Z)(e,null,[{key:"create",value:function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,n){var a,s,u;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("count"!==n.statisticType){t.next=3;break}return s=new ce.J(1),t.abrupt("return",new e(n.name,n.alias,n.type,n.statisticType,s));case 3:return t.next=5,r.createComputedField({expression:null===(a=n.onStatisticExpression)||void 0===a?void 0:a.expression,field:n.onStatisticField});case 5:return u=t.sent,t.abrupt("return",new e(n.name,n.alias,n.type,n.statisticType,u));case 7:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}]),e}(),he=r(91505),de=r(41414),fe=r(77835),ve=r(75878),pe=function(){function e(t){(0,u.Z)(this,e),this.subscription=t,this.handledChunks=new Set}return(0,s.Z)(e,[{key:"destroy",value:function(){}}]),e}(),ye=function(){function e(t,r){(0,u.Z)(this,e),this._source=t,this._attributeStore=r,this._sendStates=new Map}return(0,s.Z)(e,[{key:"destroy",value:function(){}},{key:"enablePixelBuffering",get:function(){return!0}},{key:"onSubscribe",value:function(e){var t=this.createState(e);this._sendStates.set(e.key.id,t),this.updateChunks()}},{key:"onUnsubscribe",value:function(e){var t;null!==(t=this._sendStates.get(e.key.id))&&void 0!==t&&t.destroy(),this._sendStates.delete(e.key.id)}},{key:"invalidate",value:function(){var e=Array.from(this._sendStates.values());this._sendStates.clear();for(var t=0,r=e;t<r.length;t++){var n=r[t];n.destroy(),this.onSubscribe(n.subscription)}}},{key:"invalidateAttributeData",value:function(){}},{key:"getFeatureObjectIdsForAggregate",value:function(e){throw new Error("InternalError: AggregateId lookup not supported")}},{key:"getDisplayIds",value:function(e){return this.displayMap(e,(function(e){return e}),(function(e){return e}))}},{key:"getDisplayAndObjectIds",value:function(e){return this.displayMap(e,(function(e){return e}),(function(e,t,r){return[e,r]}))}},{key:"afterUpdateChunks",value:function(){}}]),e}(),_e=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a){var s;return(0,u.Z)(this,r),(s=t.call(this,e,n)).spatialReference=i,s.aggregateFields=a,s.events=new he.Z,s.featureAdapter=fe.n,s}return(0,s.Z)(r,[{key:"aggregateQueryEngine",get:function(){return this._aggregateQueryEngine||(this._aggregateQueryEngine=new ve.q({featureStore:this,fieldsIndex:this._metadata.fieldsIndex,geometryType:this._metadata.geometryType,objectIdField:this._metadata.objectIdField,spatialReference:this.spatialReference})),this._aggregateQueryEngine}},{key:"removeChunks",value:function(e){}},{key:"forEach",value:function(e){return this.forEachAggregateWorldSpace(e)}},{key:"forEachInBounds",value:function(e,t){}},{key:"forEachBounds",value:function(e,t){var r,i=(0,de.Ue)(),a=(0,n.Z)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,u=(0,se.$)(i,s.geometry,!1,!1);u&&t(u)}}catch(o){a.e(o)}finally{a.f()}}}]),r}(ye),ge=function(){function e(t,r,n,i,a){(0,u.Z)(this,e),this.subscription=t,this.reader=r,this.clear=n,this.end=i,this.debugInfo=a,this.type="append"}return(0,s.Z)(e,[{key:"id",get:function(){return this.subscription.tile.id}},{key:"createMessage",value:function(e,t,r){return{type:"append",clear:this.clear,id:this.id,append:e,end:this.end,debugInfo:this.debugInfo,subscriptionVesrion:this.subscription.version,version:t,attributeEpoch:r}}}]),e}(),me=function(){function e(t,r,n,i,a){(0,u.Z)(this,e),this.subscription=t,this.reader=r,this.remove=n,this.end=i,this.debugInfo=a,this.type="update"}return(0,s.Z)(e,[{key:"id",get:function(){return this.subscription.tile.id}},{key:"createMessage",value:function(e,t,r){return{type:"update",id:this.id,modify:e,debugInfo:this.debugInfo,remove:this.remove,version:t,subscriptionVesrion:this.subscription.version,end:this.end,attributeEpoch:r}}}]),e}(),ke=r(92186),xe=r(72707),be=r(67654),Ze=r(52410),Ie=r(92010),we=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this,n))._exceededTransferLimit=!1,i._featureIndex=-1,i._fieldsIndex=null,i._geometryType=n.geometryType,i._features=e,i}return(0,s.Z)(r,[{key:"fields",get:function(){return this._fieldsIndex}},{key:"geometryType",get:function(){return this._geometryType}},{key:"hasFeatures",get:function(){return!!this._features.length}},{key:"hasNext",get:function(){return this._featureIndex+1<this._features.length}},{key:"exceededTransferLimit",get:function(){return this._exceededTransferLimit}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}},{key:"_current",get:function(){return this._features[this._featureIndex]}},{key:"removeIds",value:function(e){var t=new Set(e);this._features=this._features.filter((function(e){return!(null!=e.objectId&&t.has(e.objectId))}))}},{key:"getSize",value:function(){return this._features.length}},{key:"getCursor",value:function(){return this.copy()}},{key:"getInTransform",value:function(){return this._transform}},{key:"getAttributeHash",value:function(){var e="";for(var t in this._current.attributes)e+=this._current.attributes[t];return e}},{key:"getIndex",value:function(){return this._featureIndex}},{key:"setIndex",value:function(e){this._featureIndex=e}},{key:"getObjectId",value:function(){var e;return null===(e=this._current)||void 0===e?void 0:e.objectId}},{key:"getDisplayId",value:function(){return this._current.displayId}},{key:"setDisplayId",value:function(e){this._current.displayId=e}},{key:"copy",value:function(){var e=new r(this._features,this.metadata);return this.copyInto(e),e}},{key:"next",value:function(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}},{key:"readGeometryArea",value:function(){return(0,ue.S6)(this._current)?(0,se.lz)(this._current.geometry,2):0}},{key:"_readX",value:function(){return(0,ue.S6)(this._current)?this._current.geometry.coords[0]:0}},{key:"_readY",value:function(){return(0,ue.S6)(this._current)?this._current.geometry.coords[1]:0}},{key:"_readGeometry",value:function(){var e;return(0,ue.S6)(this._current)&&null!==(e=this._current.geometry)&&void 0!==e?e:null}},{key:"_readServerCentroid",value:function(){return this._current.centroid}},{key:"_readAttribute",value:function(e,t){var r;if(this._fieldsIndex){var n=this._fieldsIndex.get(e);if(n){var i=this._current.attributes[n.name];return null==i?i:("esriFieldTypeTimestampOffset"===(null===(r=this.fields.get(e))||void 0===r?void 0:r.type)&&(i=this.parseTimestampOffset(i)),t&&this.fields.isDateField(e)?new Date(i):i)}}else{var a=this._current.attributes[e];if(void 0!==a)return a;var s=e.toLowerCase();for(var u in this._current.attributes)if(u.toLowerCase()===s)return this._current.attributes[u]}}},{key:"_readAttributes",value:function(){return this._current.attributes}},{key:"copyInto",value:function(e){(0,N.Z)((0,U.Z)(r.prototype),"copyInto",this).call(this,e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._fieldsIndex=this._fieldsIndex}}],[{key:"fromFeatures",value:function(e,t){for(var n=t.objectIdField,i=t.geometryType,a=(0,se.Yn)([],e,i,!1,!1,n),s=0;s<a.length;s++)a[s].displayId=e[s].displayId;return r.fromOptimizedFeatures(a,t)}},{key:"fromFeatureSet",value:function(e,t){var n=(0,se.h_)(e,t.objectIdField);return r.fromOptimizedFeatureSet(n,t)}},{key:"fromOptimizedFeatureSet",value:function(e,t){var n=r.fromOptimizedFeatures(e.features,t);return n._exceededTransferLimit=e.exceededTransferLimit,n._transform=e.transform,n._fieldsIndex=new Ze.Z(e.fields),n}},{key:"fromOptimizedFeatures",value:function(e,t,n){var i=new r(e,t);return i._fieldsIndex=t.fieldsIndex,i._transform=n,i}},{key:"empty",value:function(e){return new r([],e)}}]),r}(Ie.s),Se=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this,e)).bins=new Map,i.featureCache=new Map,i.done=!1,i._store=n,i}return(0,s.Z)(r,[{key:"reset",value:function(){this.destroy(),this.done=!1}},{key:"destroy",value:function(){var e,t=this.subscription.tile.key.level,r=(0,n.Z)(this.featureCache.keys());try{for(r.s();!(e=r.n()).done;){var i=e.value;this._store.releaseDisplayIdForObjectId("".concat(i,".").concat(t))}}catch(a){r.e(a)}finally{r.f()}this.bins.clear(),this.featureCache.clear(),this.handledChunks.clear()}},{key:"tile",get:function(){return this.subscription.tile}},{key:"featuresWorldSpace",value:(0,i.Z)().mark((function e(){var t,r,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,n.Z)(this.featureCache.values()),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=11;break}return a=r.value,(s=a.clone()).geometry&&(0,se.$g)(s.geometry,s.geometry,!1,!1,this.subscription.tile.transform),e.next=9,s;case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),t.e(e.t0);case 16:return e.prev=16,t.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,13,16,19]])}))}]),r}(pe),Me=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a,s,o,c){var l;return(0,u.Z)(this,r),(l=t.call(this,o,c,s,a))._schema=e,l._featureFilter=n,l._timeZone=i,l._metadata=new be.A({geometryType:"esriGeometryPolygon",objectIdField:"aggregateId",fields:e.fields,globalIdField:null,spatialReference:o.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null}),l}return(0,s.Z)(r,[{key:"createState",value:function(e){return new Se(e,this._attributeStore)}},{key:"applyLocalEdit",value:function(e){var t=this;return(0,ae.Z)((0,i.Z)().mark((function e(){var r,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(0,n.Z)(t._sendStates.values()),e.prev=1,r.s();case 3:if((a=r.n()).done){e.next=11;break}return(s=a.value).reset(),u=new ge(s.subscription,we.empty(t._source.metadata),!0,!1,{}),e.next=9,u;case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[1,13,16,19]])})))()}},{key:"displayMap",value:function(e,t,r){var i,a=new Map(e.map((function(e){return[t(e),e]}))),s=[],u=(0,n.Z)(this._sendStates.values());try{for(u.s();!(i=u.n()).done;){var o,c=i.value,l=(0,n.Z)(c.featuresWorldSpace());try{for(l.s();!(o=l.n()).done;){var h=o.value,d=h.objectId,f=h.displayId,v=a.get(d);if(null!=v){var p=r(f,v,d);s.push(p),a.delete(d)}}}catch(y){l.e(y)}finally{l.f()}}}catch(y){u.e(y)}finally{u.f()}return s}},{key:"getDisplayFeatures",value:function(e){var t,r=new Set(e),i=new Set,a=[],s=(0,n.Z)(this._sendStates.values());try{for(s.s();!(t=s.n()).done;){var u,o=t.value,c=(0,n.Z)(o.featuresWorldSpace());try{for(c.s();!(u=c.n()).done;){var l=u.value;r.has(l.displayId)&&!i.has(l.objectId)&&(l.geometry&&a.push((0,b.Z)((0,b.Z)({},(0,se.EI)(l,this._metadata.geometryType,!1,!1)),{},{displayId:l.displayId})),i.add(l.objectId))}}catch(h){c.e(h)}finally{c.f()}}}catch(h){s.e(h)}finally{s.f()}return{features:[],aggregates:a}}},{key:"getFeatureObjectIdsForAggregate",value:function(e){var t,r=(0,n.Z)(this._sendStates.values());try{for(r.s();!(t=r.n()).done;){var i,a=t.value,s=(0,n.Z)(a.bins.values());try{for(s.s();!(i=s.n()).done;){var u=i.value;if(u.id===e)return Array.from(u.containedObjectIds)}}catch(o){s.e(o)}finally{s.f()}}}catch(o){r.e(o)}finally{r.f()}return[]}},{key:"updateChunks",value:function(){var e=this;return(0,ae.Z)((0,i.Z)().mark((function t(){var r,a,s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._source.chunks().length){t.next=17;break}r=(0,n.Z)(e._sendStates.values()),t.prev=2,r.s();case 4:if((a=r.n()).done){t.next=9;break}return s=a.value,t.delegateYield(ne((0,Z.Z)(e._update(s,e._source)),ie.Z),"t0",7);case 7:t.next=4;break;case 9:t.next=14;break;case 11:t.prev=11,t.t1=t.catch(2),r.e(t.t1);case 14:return t.prev=14,r.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[2,11,14,17]])})))()}},{key:"forEachAggregateWorldSpace",value:function(e){var t,r=(0,n.Z)(this._sendStates.values());try{for(r.s();!(t=r.n()).done;){var i,a=t.value,s=(0,n.Z)(a.featuresWorldSpace());try{for(s.s();!(i=s.n()).done;){e(i.value)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){r.e(u)}finally{r.f()}}},{key:"_createIndexOptions",value:function(e){switch(this._schema.index.type){case"geohash":return{type:"geohash",fields:this.aggregateFields,featureFilter:this._featureFilter,geohashLevel:this._schema.index.fixBinLevel,spatialReference:this.spatialReference,timeZone:this._timeZone,scale:e.scale};case"grid":var t=this._schema.index.fixedBinLevel,r=null!=t?e.tileInfoView.getLODInfoAt(t).scale:e.scale;return{type:"grid",fields:this.aggregateFields,cellSize:this._schema.index.size,featureFilter:this._featureFilter,spatialReference:this.spatialReference,timeZone:this._timeZone,scale:r}}}},{key:"_update",value:function(e,t){var r=this;return(0,ae.Z)((0,i.Z)().mark((function a(){var s,u,o,c,l,h,d,f,v,p,y,_,g,k,x,b,Z,I,w,S,M,C;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=e.handledChunks,u=e.subscription,o=e.bins,c=e.featureCache,l=u.tile,!e.done){i.next=3;break}return i.abrupt("return");case 3:h=(0,n.Z)(t.chunks()),i.prev=4,h.s();case 6:if((d=h.n()).done){i.next=19;break}if(f=d.value,!s.has(f.chunkId)){i.next=10;break}return i.abrupt("continue",17);case 10:if(s.add(f.chunkId),!("tileId"in(v=f.queryInfo))){i.next=16;break}if((p=new m.Z(v.tileId)).level===l.level&&p.world===l.key.world){i.next=16;break}return i.abrupt("continue",17);case 16:f.getAggregateIndex(r._createIndexOptions(e.tile)).putBounded(o,e.tile.extent,e.tile.resolution);case 17:i.next=6;break;case 19:i.next=24;break;case 21:i.prev=21,i.t0=i.catch(4),h.e(i.t0);case 24:return i.prev=24,h.f(),i.finish(24);case 27:y=[],_=u.tile.transform,g=u.tile.key.level,k=(0,n.Z)(o.values());try{for(k.s();!(x=k.n()).done;)b=x.value,(Z=c.get(b.id))?Z.attributes=b.getAttributes():(I=b.getGeometry(r.spatialReference,_),Z=new ue.u_(I,b.getAttributes(),null),I||(Z.centroid=b.getGeometricCentroid(r.spatialReference,_)),Z.objectId=b.id,Z.displayId=r._attributeStore.createDisplayIdForObjectId("".concat(Z.objectId,".").concat(g)),c.set(b.id,Z)),y.push(Z)}catch(a){k.e(a)}finally{k.f()}for(r.events.emit("changed"),e.done=!t.updateTracking.updating,w=we.fromOptimizedFeatures(y,r._metadata,_),S=w.getCursor(),M=e.subscription.tile.createArcadeEvaluationOptions(r._timeZone);S.next();)r._attributeStore.setAttributeData(S.getDisplayId(),S,M);return C=new me(e.subscription,w,[],e.done,{}),i.next=36,C;case 36:case"end":return i.stop()}}),a,null,[[4,21,24,27]])})))()}}],[{key:"create",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,s,u,o){var c,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new ke.O({spatialReference:n}),e.next=3,Promise.all(t.fields.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",le.create(c,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:if(l=e.sent,!t.featureFilter){e.next=10;break}return e.next=7,xe.Z.create({geometryType:s.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:s.metadata.timeInfo,fieldsIndex:s.metadata.fieldsIndex,spatialReference:n,filterJSON:t.featureFilter});case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=null;case 11:if(h=e.t0,e.t1="geohash"===t.index.type,!e.t1){e.next=16;break}return e.next=16,(0,oe._W)(n,M.Z.WGS84);case 16:return e.abrupt("return",new r(t,h,o,l,n,s,u));case 17:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()}]),r}(_e),Ce=r(80457),Te=function(){function e(t){(0,u.Z)(this,e),this._statistics=t}return(0,s.Z)(e,[{key:"statistics",get:function(){return this._statistics}}]),e}(),Fe=r(28192),Oe=Math.PI/180,Re=function(){function e(t){(0,u.Z)(this,e),this._statistics=t}return(0,s.Z)(e,[{key:"values",value:function(){return this._statistics.values()}},{key:"insert",value:function(e,t){var r,i=(0,n.Z)(this._statistics);try{for(i.s();!(r=i.n()).done;){r.value.insert(e,t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"merge",value:function(e){for(var t=0;t<this._statistics.length;t++){var r=this._statistics[t],n=e._statistics[t];if(r.field.name!==n.field.name)throw new Error("InternalError: Tried to merge incompatible statistics");r.merge(n)}}},{key:"clone",value:function(){return new e(this._statistics.map((function(e){return e.clone()})))}}],[{key:"create",value:function(t){return new e(t.map((function(e){return function(e){switch(e.statisticType){case"min":return new qe(e);case"max":return new Ae(e);case"avg":return new Le(e);case"avg_angle":return new De(e);case"sum":case"count":return new Pe(e);case"mode":return new Be(e)}}(e)})))}}]),e}();var Ee=function(){function e(t){(0,u.Z)(this,e),this.field=t}return(0,s.Z)(e,[{key:"insert",value:function(e,t){if(this.field.computed){var r=this.field.computed.read(e,t);(0,Fe.s_)(r)||this._insertValue(r)}}}]),e}(),qe=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments)).type="min",e.value=Number.MAX_VALUE,e}return(0,s.Z)(r,[{key:"_insertValue",value:function(e){this.value=Math.min(this.value,e)}},{key:"merge",value:function(e){this.value=Math.min(this.value,e.value)}},{key:"clone",value:function(){var e=new r(this.field);return e.value=this.value,e}}]),r}(Ee),Ae=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments)).type="max",e.value=Number.MIN_VALUE,e}return(0,s.Z)(r,[{key:"_insertValue",value:function(e){this.value=Math.max(this.value,e)}},{key:"merge",value:function(e){this.value=Math.max(this.value,e.value)}},{key:"clone",value:function(){var e=new r(this.field);return e.value=this.value,e}}]),r}(Ee),Pe=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments)).type="sum",e.value=0,e}return(0,s.Z)(r,[{key:"_insertValue",value:function(e){this.value+=e}},{key:"merge",value:function(e){this.value+=e.value}},{key:"clone",value:function(){var e=new r(this.field);return e.value=this.value,e}}]),r}(Ee),Le=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments)).type="avg",e._total=0,e._count=0,e}return(0,s.Z)(r,[{key:"value",get:function(){return this._total/this._count}},{key:"_insertValue",value:function(e){this._total+=e,this._count+=1}},{key:"merge",value:function(e){this._total+=e._total,this._count+=e._count}},{key:"clone",value:function(){var e=new r(this.field);return e._total=this._total,e._count=this._count,e}}]),r}(Ee),De=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments)).type="avg_angle",e._x=0,e._y=0,e._count=0,e}return(0,s.Z)(r,[{key:"value",get:function(){var e=this._x/this._count,t=this._y/this._count,r=180/Math.PI;return Math.atan2(t,e)*r}},{key:"_insertValue",value:function(e){this._x=this._x+Math.cos(e*Oe),this._y=this._y+Math.sin(e*Oe),this._count+=1}},{key:"merge",value:function(e){this._x+=e._x,this._y+=e._y,this._count+=e._count}},{key:"clone",value:function(){var e=new r(this.field);return e._x=this._x,e._y=this._y,e._count=this._count,e}}]),r}(Ee),Be=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments))._frequencies=new Map,e}return(0,s.Z)(r,[{key:"value",get:function(){var e,t,r=0,i=(0,n.Z)(this._frequencies.entries());try{for(i.s();!(t=i.n()).done;){var a=(0,D.Z)(t.value,2),s=a[0],u=a[1];u>r&&(r=u,e=s)}}catch(o){i.e(o)}finally{i.f()}return e}},{key:"_insertValue",value:function(e){var t=this._frequencies.get(e);null!=t?this._frequencies.set(e,t+1):this._frequencies.set(e,1)}},{key:"merge",value:function(e){var t,r=(0,n.Z)(e._frequencies.entries());try{for(r.s();!(t=r.n()).done;){var i=(0,D.Z)(t.value,2),a=i[0],s=i[1],u=this._frequencies.get(a);null!=u?this._frequencies.set(a,u+s):this._frequencies.set(a,s)}}catch(o){r.e(o)}finally{r.f()}}},{key:"clone",value:function(){var e=new r(this.field);return e._frequencies=new Map(this._frequencies),e}}]),r}(Ee),je=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a){var s;return(0,u.Z)(this,r),(s=t.call(this,i)).gridX=e,s.gridY=n,s._worldUnitsPerCell=a,s._count=0,s._xWorldTotal=0,s._yWorldTotal=0,s._objectIds=new Set,s}return(0,s.Z)(r,[{key:"id",get:function(){return r.createId(this.gridX,this.gridY)}},{key:"containedObjectIds",get:function(){return this._objectIds}},{key:"count",get:function(){return this._count}},{key:"firstObjectId",get:function(){return this._objectIds.values().next().value}},{key:"centroidXWorld",get:function(){return this._xWorldTotal/this._count}},{key:"centroidYWorld",get:function(){return this._yWorldTotal/this._count}},{key:"clone",value:function(){var e=new r(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._firstFeatureAttributes=this._firstFeatureAttributes,e._objectIds=new Set(this._objectIds),e}},{key:"insert",value:function(e,t,r,n){0===this._count?this._firstFeatureAttributes=e.readAttributes():this._firstFeatureAttributes=null,this._count+=1,this._xWorldTotal+=r,this._yWorldTotal+=n,this._statistics.insert(e,t),this._objectIds.add(e.getObjectId())}},{key:"merge",value:function(e){if(0!==e._count){this._count+=e._count,this._firstFeatureAttributes=e._firstFeatureAttributes,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);var t,r=(0,n.Z)(e._objectIds.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;this._objectIds.add(i)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"getCentroidX",value:function(e){return null==e?this.centroidXWorld:(0,se.Jd)(e,this.centroidXWorld)}},{key:"getCentroidY",value:function(e){return null==e?this.centroidYWorld:(0,se.IN)(e,this.centroidYWorld)}},{key:"getGeometry",value:function(e,t){var r=this.gridX*this._worldUnitsPerCell,n=this.gridY*this._worldUnitsPerCell,i=new Ce.Z([4],[r,n,r+this._worldUnitsPerCell,n,r+this._worldUnitsPerCell,n+this._worldUnitsPerCell,r,n+this._worldUnitsPerCell]);if(null!=t){var a=new Ce.Z;return(0,se.Nh)(a,i,!1,!1,"esriGeometryPolygon",t)}return i}},{key:"getCentroid",value:function(e){var t=new Ce.Z([],[this.centroidXWorld,this.centroidYWorld]);if(null!=e){var r=new Ce.Z;return(0,se.Nh)(r,t,!1,!1,"esriGeometryPoint",e)}return t}},{key:"getGeometricCentroid",value:function(e,t){var r=this.gridX*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,n=this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,i=new Ce.Z([],[r,n]);if(null!=t){var a=new Ce.Z;return(0,se.Nh)(a,i,!1,!1,"esriGeometryPoint",t)}return i}},{key:"getAttributes",value:function(){var e,t={aggregateId:this.id},r=(0,n.Z)(this._statistics.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;t[i.field.name]=i.value}}catch(a){r.e(a)}finally{r.f()}return null!=this._firstFeatureAttributes?(0,b.Z)((0,b.Z)({},t),this._firstFeatureAttributes):t}}],[{key:"createId",value:function(e,t){return"".concat(e,".").concat(t)}},{key:"create",value:function(e,t,n,i){return new r(e,t,Re.create(n),i)}}]),r}(Te),Ne=r(68860),Ue=function(){function e(t){(0,u.Z)(this,e),this._options=t}return(0,s.Z)(e,[{key:"insert",value:function(e,t){for(var r=e.getCursor(),n={$view:{scale:this._options.scale,timeZone:this._options.timeZone}};r.next();)this._insertFeature(r,n,t)}},{key:"_insertFeature",value:function(e,t,r){var n=this._options.featureFilter;if(null===n||n.check(e)){var i=0,a=0;if("esriGeometryPoint"===e.geometryType)i=e.readXWorldSpace(),a=e.readYWorldSpace();else{if(r){var s=e.readCentroidForDisplay();if(null==s)return;var u=(0,D.Z)(s.coords,2),o=u[0],c=u[1];if(o<0||o>k.i9||c<0||c>k.i9)return}var l=e.readCentroidWorldSpace();if(null==l)return;i=l.coords[0],a=l.coords[1]}this._insert(e,i,a,t)}}}]),e}();function We(e,t){return(0,Ne.c9)(e)*Ne.hd*96/t}var ze=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e))._cells=new Map,n._pixelsPerMapUnit=We(e.spatialReference,e.scale),n}return(0,s.Z)(r,[{key:"put",value:function(e){var t,r=(0,n.Z)(this._cells.values());try{for(r.s();!(t=r.n()).done;){var i=t.value,a=e.get(i.id);a?a.merge(i):e.set(i.id,i.clone())}}catch(s){r.e(s)}finally{r.f()}}},{key:"putBounded",value:function(e,t,r){for(var n=[t.xmin,t.ymin,t.xmax,t.ymax],i=n[0],a=n[1],s=n[2],u=n[3],o=Math.floor(i*this._pixelsPerMapUnit/this._options.cellSize),c=Math.floor(a*this._pixelsPerMapUnit/this._options.cellSize),l=Math.ceil(s*this._pixelsPerMapUnit/this._options.cellSize),h=Math.ceil(u*this._pixelsPerMapUnit/this._options.cellSize),d=c;d<=h;d++)for(var f=o;f<=l;f++){var v="".concat(f,".").concat(d),p=this._cells.get(v);if(p){var y=e.get(p.id);y?p&&!e.has(p.id)&&y.merge(p):e.set(p.id,p.clone())}}}},{key:"_insert",value:function(e,t,r,n){var i=t*this._pixelsPerMapUnit,a=r*this._pixelsPerMapUnit,s=Math.floor(i/this._options.cellSize),u=Math.floor(a/this._options.cellSize);this._getCellOrCreate(s,u).insert(e,n,t,r)}},{key:"_getCellOrCreate",value:function(e,t){var r=je.createId(e,t),n=this._cells.get(r);if(!n){var i=1*this._options.cellSize/this._pixelsPerMapUnit;n=je.create(e,t,this._options.fields,i),this._cells.set(r,n)}return n}}]),r}(Ue),Ge=(0,s.Z)((function e(t,r){(0,u.Z)(this,e),this.inner=t,this.displayId=r})),Ye=128,Xe=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e)).didSend=!1,n.done=!1,n}return(0,s.Z)(r)}(pe),Ve=function(){function e(t,r,n,i,a){(0,u.Z)(this,e),this._level=t,this._scale=r,this._indexOptions=n,this._clusterRadius=i,this._store=a,this._cells=new Map,this._handledChunks=new Set,this._statistics=new Map,this._clusters=new Map}return(0,s.Z)(e,[{key:"destroy",value:function(){this._clearClusters()}},{key:"_clearClusters",value:function(){var e,t=(0,n.Z)(this._clusters.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;this._store.releaseDisplayIdForObjectId(r.inner.id)}}catch(i){t.e(i)}finally{t.f()}this._clusters.clear()}},{key:"aggregatesWorldSpace",value:(0,i.Z)().mark((function e(){var t,r,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,n.Z)(this._clusters.values()),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=12;break}return a=r.value,s=a.inner.getCentroid(null),(u=new ue.u_(s,a.inner.getAttributes(),null)).objectId=a.inner.id,u.displayId=a.displayId,e.next=10,u;case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),t.e(e.t0);case 17:return e.prev=17,t.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[1,14,17,20]])}))},{key:"clusters",value:function(){return this._clusters.values()}},{key:"updateChunks",value:function(e,t){var r,i=!1,a=(0,n.Z)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,u=s.queryInfo;"tileId"in u&&new m.Z(u.tileId).level!==this._level||(this._handledChunks.has(s.normalizedChunkId)||(this._handledChunks.add(s.normalizedChunkId),i=!0,s.getAggregateIndex((0,b.Z)((0,b.Z)({},this._indexOptions),{},{scale:this._scale})).put(this._cells)))}}catch(g){a.e(g)}finally{a.f()}var o,c={xMin:1/0,yMin:1/0,xMax:-1/0,yMax:-1/0},l=We(this._indexOptions.spatialReference,this._scale),h=this._indexOptions.cellSize,d=(0,n.Z)(t);try{for(d.s();!(o=d.n()).done;){var f=o.value.subscription.tile.bounds,v=Math.floor(f[0]*l/h),p=Math.floor(f[1]*l/h),y=Math.ceil(f[2]*l/h),_=Math.ceil(f[3]*l/h);c.xMin=Math.min(c.xMin,v),c.yMin=Math.min(c.yMin,p),c.xMax=Math.max(c.xMax,y),c.yMax=Math.max(c.yMax,_)}}catch(g){d.e(g)}finally{d.f()}return null!=this._lastCellBounds&&c.xMin===this._lastCellBounds.xMin&&c.yMin===this._lastCellBounds.yMin&&c.yMin===this._lastCellBounds.yMin&&c.yMax===this._lastCellBounds.yMax||(i=!0,this._lastCellBounds=c),i&&this._clusterCells(c),i}},{key:"updateStatistics",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,s,u,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!1,a=(0,n.Z)(this._clusters.values());try{for(a.s();!(s=a.n()).done;)(u=s.value).inner.count>1&&(r=this._updateAggregateStatistics(this._statistics,u.inner)||r)}catch(i){a.e(i)}finally{a.f()}if(!r){e.next=7;break}return o=Array.from(this._statistics.entries()).map((function(e){var t=(0,D.Z)(e,2),r=t[0],n=t[1];return{fieldName:r,minValue:n.minValue,maxValue:n.maxValue}})),e.next=7,t.container.updateStatistics(this._level,o);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createAggregateFeatures",value:function(e,t){var r,i=e.subscription,a=[],s=i.tile.transform,u=(0,n.Z)(this._clusters.values());try{for(u.s();!(r=u.n()).done;){var o=r.value,c=o.inner.getCentroidX(s),l=o.inner.getCentroidY(s),h=i.tile.lod,d=h.wrap?h.worldSize[0]:null,f=1===o.inner.count?o.inner.firstObjectId:o.inner.id,v=o.displayId;if(null!=d)if(1===d){var p=new Ce.Z([],[c,l]),y=new ue.u_(p,o.inner.getAttributes(),null);y.geometry.coords[0]-=k.i9,y.objectId=f,y.displayId=v,a.push(y);var _=new Ce.Z([],[c,l]),g=new ue.u_(_,o.inner.getAttributes(),null);g.geometry.coords[0]+=k.i9,g.objectId=f,g.displayId=v,a.push(g)}else c>k.i9+k.i9/2?c-=d*k.i9:c<-k.i9/2&&(c+=d*k.i9);if(c<k.i9+Ye&&c>=-128&&l<k.i9+Ye&&l>=-128){var m=new Ce.Z([],[c,l]),x=new ue.u_(m,o.inner.getAttributes(),null);x.objectId=f,x.displayId=v,a.push(x)}}}catch(b){u.e(b)}finally{u.f()}return we.fromOptimizedFeatures(a,t,i.tile.transform)}},{key:"_clusterCells",value:function(e){var t=Array.from(this._cells.values());t=t.sort((function(e,t){return t.count-e.count}));var r,i=[],a=(0,n.Z)(this._clusters.values());try{for(a.s();!(r=a.n()).done;){var s=r.value;i.push(s.inner.id)}}catch(w){a.e(w)}finally{a.f()}this._clusters.clear();var u,o=this._clusterRadius*(1/We(this._indexOptions.spatialReference,this._scale)),c=1+this._clusterRadius/this._indexOptions.cellSize,l=new Set,h=(0,n.Z)(t);try{for(h.s();!(u=h.n()).done;){var d=u.value;if(!l.has(d.id)&&!(d.gridX<e.xMin||d.gridX>e.xMax||d.gridY<e.yMin||d.gridY>e.yMax)){var f=this._store.createDisplayIdForObjectId(d.id),v=new Ge(d.clone(),f);l.add(d.id),this._clusters.set(d.id,v);for(var p=d.centroidXWorld,y=d.centroidYWorld,_=d.gridY-c;_<=d.gridY+c;_++)for(var g=d.gridX-c;g<=d.gridX+c;g++)if(_!==d.gridY||g!==d.gridX){var m=this._cells.get(je.createId(g,_));if(m&&!l.has(m.id)){var k=Math.abs(m.centroidXWorld-p),x=Math.abs(m.centroidYWorld-y);k<o&&x<o&&(v.inner.merge(m),l.add(m.id))}}}}}catch(w){h.e(w)}finally{h.f()}for(var b=0,Z=i;b<Z.length;b++){var I=Z[b];this._store.releaseDisplayIdForObjectId(I)}}},{key:"_updateAggregateStatistics",value:function(e,t){var r,i=!1,a=(0,n.Z)(t.statistics.values());try{for(a.s();!(r=a.n()).done;){var s=r.value;if("esriFieldTypeString"!==s.field.type){var u=s.value,o=s.field,c=e.get(o.name);if(c){var l=c.minValue,h=c.maxValue,d=Math.min(c.minValue,u),f=Math.max(c.maxValue,u);l===d&&h===f||(c.minValue=d,c.maxValue=f,i=!0)}else e.set(o.name,{minValue:u,maxValue:u}),i=!0}}}catch(v){a.e(v)}finally{a.f()}return i}}]),e}(),He=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a,s,o){var c;return(0,u.Z)(this,r),(c=t.call(this,s,o,i.spatialReference,i.fields))._connection=e,c._clusterRadius=n,c._indexOptions=i,c._cellsPerScale=new Map,c._metadata=new be.A({geometryType:"esriGeometryPoint",objectIdField:"aggregateId",fields:[].concat((0,C.Z)(a),(0,C.Z)(c._source.metadata.fieldsIndex.fields),[{name:"aggregateId",alias:"aggregateId",type:"esriFieldTypeOID"}]),globalIdField:null,spatialReference:s.metadata.spatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null}),c}return(0,s.Z)(r,[{key:"enablePixelBuffering",get:function(){return!1}},{key:"invalidate",value:function(){(0,N.Z)((0,U.Z)(r.prototype),"invalidate",this).call(this);var e,t=(0,n.Z)(this._cellsPerScale.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(i){t.e(i)}finally{t.f()}this._cellsPerScale.clear()}},{key:"onSubscribe",value:function(e){(0,N.Z)((0,U.Z)(r.prototype),"onSubscribe",this).call(this,e),this._requiredLevel=e.tile.level,this._requiredScale=e.tile.scale}},{key:"createState",value:function(e){return new Xe(e)}},{key:"applyLocalEdit",value:function(e){var t=this;return(0,ae.Z)((0,i.Z)().mark((function e(){var r,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(0,n.Z)(t._cellsPerScale.values());try{for(r.s();!(a=r.n()).done;)a.value.destroy()}catch(i){r.e(i)}finally{r.f()}t._cellsPerScale.clear(),s=(0,n.Z)(t._sendStates.values());try{for(s.s();!(u=s.n()).done;)u.value.done=!1}catch(i){s.e(i)}finally{s.f()}case 5:case"end":return e.stop()}}),e)})))()}},{key:"displayMap",value:function(e,t,r){var i,a=new Map(e.map((function(e){return[t(e),e]}))),s=[],u=this._getClusterState(this._requiredLevel,this._requiredScale),o=(0,n.Z)(u.clusters());try{for(o.s();!(i=o.n()).done;){var c=i.value,l=a.get(c.inner.id);if(null==l){if(1===c.inner.count){var h=a.get(c.inner.firstObjectId);if(null!=h){var d=r(c.displayId,h,c.inner.firstObjectId);s.push(d),a.delete(c.inner.firstObjectId)}}}else{var f=r(c.displayId,l,c.inner.id);s.push(f),a.delete(c.inner.id)}}}catch(v){o.e(v)}finally{o.f()}return s}},{key:"getDisplayFeatures",value:function(e){var t,r=new Set(e),i=new Set,a=[],s=[],u=this._getClusterState(this._requiredLevel,this._requiredScale),o=(0,n.Z)(u.aggregatesWorldSpace());try{for(o.s();!(t=o.n()).done;){var c=t.value;if(r.has(c.displayId)&&!i.has(c.displayId)){var l=(0,se.EI)(c,this._metadata.geometryType,!1,!1);if(i.add(c.displayId),1===l.attributes.cluster_count){a.push((0,b.Z)((0,b.Z)({},l),{},{displayId:c.displayId}));continue}s.push((0,b.Z)((0,b.Z)({},l),{},{displayId:c.displayId}))}}}catch(h){o.e(h)}finally{o.f()}return{features:a,aggregates:s}}},{key:"getFeatureObjectIdsForAggregate",value:function(e){var t,r=this._getClusterState(this._requiredLevel,this._requiredScale),i=(0,n.Z)(r.clusters());try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.inner.id===e)return Array.from(a.inner.containedObjectIds)}}catch(s){i.e(s)}finally{i.f()}return[]}},{key:"updateChunks",value:function(){var e=this;return(0,ae.Z)((0,i.Z)().mark((function t(){var r,a,s,u,o,c,l,h,d,f,v;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=e._source.chunks()).length){t.next=3;break}return t.abrupt("return");case 3:if(a=e._getClusterState(e._requiredLevel,e._requiredScale),s=Array.from(e._sendStates.values()).filter((function(t){return t.subscription.tile.level===e._requiredLevel})),a.updateChunks(r,s)||!e._source.updateTracking.updating){u=(0,n.Z)(s);try{for(u.s();!(o=u.n()).done;)(c=o.value).subscription.tile.level===e._requiredLevel&&(c.didSend=!1,c.done=!1)}catch(p){u.e(p)}finally{u.f()}}l=Array.from(e._sendStates.values()).filter((function(e){return e.done})).map((function(e){return e.subscription.tile.key})),h=new Set(l),d=(0,n.Z)(e._sendStates.values()),t.prev=7,v=(0,i.Z)().mark((function t(){var r;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=f.value,!e._source.updateTracking.updating){t.next=6;break}if(!l.some((function(e){return e.containsChild(r.subscription.tile.key)}))){t.next=4;break}return t.abrupt("return","continue");case 4:if(!r.subscription.tile.key.getChildKeys().every((function(e){return h.has(e)}))){t.next=6;break}return t.abrupt("return","continue");case 6:if(t.t0=r.didSend||r.subscription.tile.level!==e._requiredLevel,t.t0){t.next=10;break}return r.didSend=!0,t.delegateYield(ne((0,Z.Z)(e._update(r,a,e._source)),ie.Z),"t1",10);case 10:case"end":return t.stop()}}),t)})),d.s();case 10:if((f=d.n()).done){t.next=17;break}return t.delegateYield(v(),"t0",12);case 12:if("continue"!==t.t0){t.next=15;break}return t.abrupt("continue",15);case 15:t.next=10;break;case 17:t.next=22;break;case 19:t.prev=19,t.t1=t.catch(7),d.e(t.t1);case 22:return t.prev=22,d.f(),t.finish(22);case 25:return t.next=27,(0,ie.Z)(a.updateStatistics(e._connection));case 27:case"end":return t.stop()}}),t,null,[[7,19,22,25]])})))()}},{key:"forEachAggregateWorldSpace",value:function(e){if(null!=this._requiredLevel&&null!=this._requiredScale){var t,r=this._getClusterState(this._requiredLevel,this._requiredScale),i=(0,n.Z)(r.aggregatesWorldSpace());try{for(i.s();!(t=i.n()).done;){e(t.value)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"_getClusterState",value:function(e,t){if(null==e||null==t)throw new Error("InternalError: Level and scale must be defined");var r=this._cellsPerScale.get(t);return r||(r=new Ve(e,t,this._indexOptions,this._clusterRadius,this._attributeStore),this._cellsPerScale.set(t,r)),r}},{key:"_update",value:function(e,t,r){var n=this;return(0,ae.Z)((0,i.Z)().mark((function a(){var s,u,o,c;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!e.done){i.next=2;break}return i.abrupt("return");case 2:for(s=t.createAggregateFeatures(e,n._metadata),n.events.emit("changed"),e.done=!r.updateTracking.updating,u=s.getCursor(),o=e.subscription.tile.createArcadeEvaluationOptions(n._indexOptions.timeZone);u.next();)n._attributeStore.setAttributeData(u.getDisplayId(),u,o);return c=new ge(e.subscription,s,!0,e.done,{}),i.next=9,c;case 9:case"end":return i.stop()}}),a)})))()}}],[{key:"create",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,s,u,o,c){var l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=new ke.O({spatialReference:s}),e.next=3,Promise.all(n.fields.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",le.create(l,t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:if(e.t0=e.sent,e.t1=s,!n.featureFilter){e.next=11;break}return e.next=8,xe.Z.create({geometryType:u.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:u.metadata.timeInfo,fieldsIndex:u.metadata.fieldsIndex,spatialReference:s,filterJSON:n.featureFilter});case 8:e.t2=e.sent,e.next=12;break;case 11:e.t2=null;case 12:return e.t3=e.t2,e.t4=n.clusterRadius/4,e.t5=c,h={type:"grid",fields:e.t0,spatialReference:e.t1,featureFilter:e.t3,cellSize:e.t4,timeZone:e.t5},e.abrupt("return",new r(t,n.clusterRadius,h,n.fields,u,o));case 17:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()}]),r}(_e),Je=r(31581),Qe=function(){function e(t){(0,u.Z)(this,e),this._index=t}return(0,s.Z)(e,[{key:"search",value:function(e){var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}],[{key:"fromReader",value:function(t){for(var r=[],n=t.copy(),i=(0,de.Ue)();n.next();)n.getBounds(i)&&r.push(n.getIndex());var a=(0,Je.r)(9,(function(e){return n.setIndex(e),{minX:n.getBoundsXMin(),minY:n.getBoundsYMin(),maxX:n.getBoundsXMax(),maxY:n.getBoundsYMax()}}));return a.load(r),new e(a)}}]),e}(),Ke=r(16889),$e=r(53866),et=r(80885),tt=r(22186);new Float64Array(2),new Float64Array(2);function rt(e,t,r,n){if(n.isWebMercator){var i=(0,Ke.BV)(e/tt.sv.radius),a=i-360*Math.floor((i+180)/360),s=[0,0];return nt(s,0,(0,Ke.BV)(Math.PI/2-2*Math.atan(Math.exp(-t/tt.sv.radius))),a,r),s}var u=(0,oe.iV)({x:e,y:t},n,M.Z.WGS84);if(!u)return null;var o=[0,0];return nt(o,0,u.y,u.x,r),o}function nt(e,t,r,n,i){i%2&&(i+=1);for(var a=0,s=0,u=-90,o=90,c=-180,l=180,h=0;h<i/2;h++){for(var d=0;d<5;d++){var f=(c+l)/2,v=n>f?1:0;a|=v<<29-(d+5*h),c=(1-v)*c+v*f,l=(1-v)*f+v*l}for(var p=0;p<5;p++){var y=(u+o)/2,_=r>y?1:0;s|=_<<29-(p+5*h),u=(1-_)*u+_*y,o=(1-_)*y+_*o}}e[2*t]=a,e[2*t+1]=s}var it=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a,s){var o;return(0,u.Z)(this,r),(o=t.call(this,e)).xNode=n,o.yNode=i,o.depth=a,o.children=s,o._objectIds=new Set,o._count=0,o._xWorldTotal=0,o._yWorldTotal=0,o._xGeohashTotal=0,o._yGeohashTotal=0,o.next=null,o}return(0,s.Z)(r,[{key:"id",get:function(){return"".concat(this.xNode,".").concat(this.yNode)}},{key:"containedObjectIds",get:function(){return this._objectIds}},{key:"count",get:function(){return this._count}},{key:"clone",value:function(){var e=new r(this._statistics.clone(),this.xNode,this.yNode,this.depth,this.children);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._xGeohashTotal=this._xGeohashTotal,e._yGeohashTotal=this._yGeohashTotal,e.next=this.next,e._objectIds=new Set(this._objectIds),e}},{key:"insert",value:function(e,t,r,n,i,a){this._count+=1,this._xWorldTotal+=t,this._yWorldTotal+=r,this._xGeohashTotal+=n,this._yGeohashTotal+=i,this._statistics.insert(e,a),this._objectIds.add(e.getObjectId())}},{key:"merge",value:function(e){if(0!==e._count){this._count+=e._count,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._xGeohashTotal+=e._xWorldTotal,this._yGeohashTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);var t,r=(0,n.Z)(e._objectIds.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;this._objectIds.add(i)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"getCentroid",value:function(e){throw new Error("getCentroid not supported for GeohashNode")}},{key:"getGeometry",value:function(e,t){var r=this._getLngLatBounds(),n=(0,D.Z)(r,4),i=n[0],a=n[1],s=n[2],u=n[3],o=(0,oe.iV)({rings:[[[i,a],[i,u],[s,u],[s,a],[i,a]]]},M.Z.WGS84,e),c=(0,se.Uy)(new Ce.Z,o,!1,!1);return null!=t?(0,se.Nh)(new Ce.Z,c,!1,!1,"esriGeometryPolygon",t,!1,!1):c}},{key:"getGeometricCentroid",value:function(e,t){var r=this._getLngLatBounds(),n=(0,D.Z)(r,4),i=n[0],a=n[1],s=n[2],u=n[3],o=(0,oe.iV)({x:(i+s)/2,y:(a+u)/2},M.Z.WGS84,e),c=(0,se.dd)(new Ce.Z,o);return null!=t?(0,se.Nh)(new Ce.Z,c,!1,!1,"esriGeometryPoint",t,!1,!1):c}},{key:"getAttributes",value:function(){var e,t={aggregateId:this.id},r=(0,n.Z)(this._statistics.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;t[i.field.name]=i.value}}catch(a){r.e(a)}finally{r.f()}return t.aggregateCount=this._count,t}},{key:"find",value:function(e,t,r,n,i,a){if(n>=r)return this;var s=1-n%2,u=3*s+2*(1-s),o=2*s+3*(1-s),c=30-i-u,l=30-a-o,h=((e&7*s+3*(1-s)<<c)>>c)+((t&3*s+7*(1-s)<<l)>>l)*(8*s+4*(1-s)),d=this.children[h];return null==d?null:d.find(e,t,r,n+1,i+u,a+o)}},{key:"_getLngLatBounds",value:function(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),n=30-(3*t+2*r),i=30-(2*t+3*r);return function(e,t){for(var r=-90,n=90,i=-180,a=180,s=0;s<t;s++){for(var u=Math.ceil((s+1)/2),o=Math.floor((s+1)/2),c=1-s%2,l=30-(3*u+2*o),h=30-(2*u+3*o),d=3*c+2*(1-c),f=2*c+3*(1-c),v=3*c+7*(1-c)<<h,p=(7*c+3*(1-c)<<l&e.geohashX)>>l,y=(v&e.geohashY)>>h,_=d-1;_>=0;_--){var g=(i+a)/2,m=p&1<<_?1:0;i=(1-m)*i+m*g,a=(1-m)*g+m*a}for(var k=f-1;k>=0;k--){var x=(r+n)/2,b=y&1<<k?1:0;r=(1-b)*r+b*x,n=(1-b)*x+b*n}}return[i,r,a,n]}({geohashX:this.xNode<<n,geohashY:this.yNode<<i},this.depth)}}],[{key:"create",value:function(e,t,n,i){for(var a=Re.create(e),s=new Array(32),u=0;u<s.length;u++)s[u]=null;return new r(a,t,n,i,s)}}]),r}(Te),at=function(){function e(t){(0,u.Z)(this,e),this._fields=t,this._size=0,this._depth=0,this._root=it.create(this._fields,0,0,0)}return(0,s.Z)(e,[{key:"destroy",value:function(){}},{key:"size",get:function(){return this._size}},{key:"depth",get:function(){return this._depth}},{key:"find",value:function(e,t,r){return this._root.find(e,t,r,0,0,0)}},{key:"insert",value:function(e,t,r,n,i,a,s){for(var u=this._root,o=0,c=0,l=0;null!==u;){if(u.insert(e,t,r,n,i,s),o>=a)return;var h=Math.ceil((o+1)/2),d=Math.floor((o+1)/2),f=1-o%2,v=30-(3*h+2*d),p=30-(2*h+3*d),y=(n&7*f+3*(1-f)<<v)>>v,_=(i&3*f+7*(1-f)<<p)>>p,g=y+_*(8*f+4*(1-f));c=c<<3*f+2*(1-f)|y,l=l<<2*f+3*(1-f)|_,null==u.children[g]&&(u.children[g]=it.create(this._fields,c,l,o+1),this._depth=Math.max(this._depth,o+1),this._size+=1),o+=1,u=u.children[g]}}},{key:"putBins",value:function(e,t){var r,i=(0,n.Z)(this.getNodes(t));try{for(i.s();!(r=i.n()).done;){var a=r.value,s=e.get(a.id);s?s.merge(a):e.set(a.id,a.clone())}}catch(u){i.e(u)}finally{i.f()}}},{key:"getNodes",value:function(e){for(var t=[],r=e.geohashBounds,n=e.level,i=this._root;null!==i;){var a=i.depth,s=i.xNode,u=i.yNode;if(a>=n)t.push(i),i=i.next;else{for(var o=Math.ceil((a+1)/2),c=Math.floor((a+1)/2),l=1-a%2,h=30-(3*o+2*c),d=30-(2*o+3*c),f=~((1<<h)-1),v=~((1<<d)-1),p=(r.xLL&f)>>h,y=(r.yLL&v)>>d,_=(r.xTR&f)>>h,g=(r.yTR&v)>>d,m=s<<3*l+2*(1-l),k=u<<2*l+3*(1-l),x=m+8*l+4*(1-l),b=k+4*l+8*(1-l),Z=Math.max(m,p),I=Math.max(k,y),w=Math.min(x,_),S=Math.min(b,g),M=null,C=null,T=I;T<=S;T++)for(var F=Z;F<=w;F++){var O=F-m+(T-k)*(8*l+4*(1-l)),R=i.children[O];R&&(M||((M=R).next=i.next),C&&(C.next=R),C=R,R.next=i.next)}i=M||i.next}}return t}}]),e}(),st=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e))._tree=new at(n._options.fields),n}return(0,s.Z)(r,[{key:"put",value:function(e){throw new Error("Geohash tree does not support put")}},{key:"putBounded",value:function(e,t,r){var n=this._options,i=function(e,t,r,n){var i=[e.xmin,e.ymin,e.xmax,e.ymax],a=et.Z.fromExtent($e.Z.fromBounds(i,n)),s=(0,oe.iV)(a,n,M.Z.WGS84,{densificationStep:64*t});if(!s)return null;var u=(0,se.Uy)(new Ce.Z,s,!1,!1),o=u.coords.filter((function(e,t){return!(t%2)})),c=u.coords.filter((function(e,t){return t%2})),l=Math.min.apply(Math,(0,C.Z)(o)),h=Math.min.apply(Math,(0,C.Z)(c)),d=Math.max.apply(Math,(0,C.Z)(o)),f=Math.max.apply(Math,(0,C.Z)(c)),v=rt(l,h,r,M.Z.WGS84),p=rt(d,f,r,M.Z.WGS84);return v&&p?{bounds:i,geohashBounds:{xLL:v[0],yLL:v[1],xTR:p[0],yTR:p[1]},level:r}:null}(t,r,n.geohashLevel,n.spatialReference);null!=i&&this._tree.putBins(e,i)}},{key:"_insert",value:function(e,t,r,n){var i=this._options,a=i.geohashLevel,s=rt(t,r,a,i.spatialReference);s&&this._tree.insert(e,t,r,s[0],s[1],a,n)}}]),r}(Ue),ut=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this,e.metadata))._currentIndex=-1,i._displayTranslationX=0,i._displayTranslationY=0,i._displayScaleX=1,i._displayScaleY=1,i._reader=e,i._indices=n,i._isPoint="esriGeometryPoint"===e.geometryType,i}return(0,s.Z)(r,[{key:"setTransformForDisplay",value:function(e){var t=this._reader.getInTransform();if(null==t){var r=(0,D.Z)(e.scale,2),n=r[0],i=r[1],a=(0,D.Z)(e.translate,2),s=a[0],u=a[1];return this._displayTranslationX=-s/n,this._displayScaleX=1/n,this._displayTranslationY=u/i,this._displayScaleY=1/-i,void(this._displayTransform=e)}var o=(0,D.Z)(t.scale,2),c=o[0],l=o[1],h=(0,D.Z)(t.translate,2),d=h[0],f=h[1],v=(0,D.Z)(e.scale,2),p=v[0],y=v[1],_=(0,D.Z)(e.translate,2),g=_[0],m=_[1];if(this._displayScaleX=c/p,this._displayTranslationX=(d-g)/p,this._displayScaleY=l/y,this._displayTranslationY=(-f+m)/y,!this._isPoint&&t)throw new Error("InternalError: Relative transformations not supported for non-point features");this._displayTransform=e}},{key:"getInTransform",value:function(){return this._reader.getInTransform()}},{key:"fields",get:function(){return this._reader.fields}},{key:"hasNext",get:function(){return this._currentIndex+1<this._indices.length}},{key:"getSize",value:function(){return this._indices.length}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var e=new r(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e._displayTransform=this._displayTransform,e._displayTranslationX=this._displayTranslationX,e._displayTranslationY=this._displayTranslationY,e._displayScaleX=this._displayScaleX,e._displayScaleY=this._displayScaleY,e}},{key:"contextTimeZone",get:function(){return this._reader.contextTimeZone},set:function(e){this._reader.contextTimeZone=e}},{key:"_nextIndex",value:function(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}},{key:"next",value:function(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}},{key:"readXForDisplay",value:function(){return this._reader.readXForDisplay()*this._displayScaleX+this._displayTranslationX}},{key:"readYForDisplay",value:function(){return this._reader.readYForDisplay()*this._displayScaleY+this._displayTranslationY}},{key:"readGeometryForDisplay",value:function(){var e=this._reader.readGeometryForDisplay();if(!this._displayTransform)return e;var t=new Ce.Z;return(0,se.Nh)(t,e,this.hasZ,this.hasM,this.geometryType,this._displayTransform),t.deltaDecode()}},{key:"readCentroidForDisplay",value:function(){var e,t=null===(e=this._reader.readCentroidForDisplay())||void 0===e?void 0:e.clone();if(t){var r=(0,D.Z)(t.coords,2),n=r[0],i=r[1];t.coords[0]=n*this._displayScaleX+this._displayTranslationX,t.coords[1]=i*this._displayScaleY+this._displayTranslationY}return t}},{key:"geometryType",get:function(){return this._reader.geometryType}},{key:"hasFeatures",get:function(){return this._reader.hasFeatures}},{key:"exceededTransferLimit",get:function(){return this._reader.exceededTransferLimit}},{key:"hasZ",get:function(){return this._reader.hasZ}},{key:"hasM",get:function(){return this._reader.hasM}},{key:"readAttribute",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._reader.readAttribute(e,t)}},{key:"readAttributes",value:function(){return this._reader.readAttributes()}},{key:"joinAttributes",value:function(e){return this._reader.joinAttributes(e)}},{key:"getBounds",value:function(e){return this._reader.getBounds(e)}},{key:"getAttributeHash",value:function(){return this._reader.getAttributeHash()}},{key:"getObjectId",value:function(){return this._reader.getObjectId()}},{key:"getDisplayId",value:function(){return this._reader.getDisplayId()}},{key:"setDisplayId",value:function(e){return this._reader.setDisplayId(e)}},{key:"setIndex",value:function(e){return this._reader.setIndex(e)}},{key:"getIndex",value:function(){return this._reader.getIndex()}},{key:"readXWorldSpace",value:function(){return this._reader.readXWorldSpace()}},{key:"readYWorldSpace",value:function(){return this._reader.readYWorldSpace()}},{key:"_readX",value:function(){return this._reader.readXForDisplay()}},{key:"_readY",value:function(){return this._reader.readYForDisplay()}},{key:"_readServerCentroid",value:function(){return this._reader._readServerCentroid()}},{key:"readLegacyFeatureForDisplay",value:function(){var e,t=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:null!==(e=t&&{x:t.coords[0],y:t.coords[1]})&&void 0!==e?e:null}}},{key:"readLegacyGeometryForDisplay",value:function(){var e=this.readGeometryForDisplay();return(0,se.di)(e,this.geometryType,!1,!1)}},{key:"readGeometryArea",value:function(){return this._reader.readGeometryArea()}},{key:"readGeometryWorldSpace",value:function(){return this._reader.readGeometryWorldSpace()}},{key:"_readGeometry",value:function(){return this._reader._readGeometry()}},{key:"_readAttribute",value:function(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}},{key:"_readAttributes",value:function(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}},{key:"readArcadeFeature",value:function(){return this._reader.readArcadeFeature()}},{key:"geometry",value:function(){return this._reader.geometry()}},{key:"field",value:function(e){return this._reader.field(e)}},{key:"hasField",value:function(e){return this._reader.hasField(e)}},{key:"setField",value:function(e,t){return this._reader.setField(e,t)}},{key:"keys",value:function(){return this._reader.keys()}},{key:"castToText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._reader.castToText(e)}}],[{key:"from",value:function(e,t){return new r(e.copy(),t)}}]),r}(Ie.s),ot=function(){function e(){(0,u.Z)(this,e)}return(0,s.Z)(e,[{key:"size",value:function(){return this.reader.getSize()}},{key:"fields",get:function(){return this.reader.fields}},{key:"invalidate",value:function(){this._aggregateIndex=null,this._aggregateIndexHash=null,this._spatialIndex=null}},{key:"queryFeaturesInBounds",value:function(e){var t=this._getSpatialIndex().search(e);return ut.from(this.reader,t)}},{key:"getAggregateIndex",value:function(e){var t=JSON.stringify(e);if(t!==this._aggregateIndexHash){switch(this._aggregateIndexHash=t,e.type){case"grid":this._aggregateIndex=new ze(e);break;case"geohash":this._aggregateIndex=new st(e)}this._aggregateIndex.insert(this.reader,this.isTiled)}return this._aggregateIndex}},{key:"_getSpatialIndex",value:function(){return this._spatialIndex||(this._spatialIndex=Qe.fromReader(this.reader)),this._spatialIndex}}]),e}(),ct=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this)).metadata=e,i.removed=new Set,i.overriddenIds=new Set,i._features=[],i.chunkId=n,i.normalizedChunkId=n,i}return(0,s.Z)(r,[{key:"reader",get:function(){return we.fromOptimizedFeatures(this._features,this.metadata)}},{key:"queryInfo",get:function(){return{}}},{key:"first",get:function(){return!1}},{key:"end",get:function(){return!1}},{key:"isTiled",get:function(){return!1}},{key:"applyOverrides",value:function(e){(0,N.Z)((0,U.Z)(r.prototype),"invalidate",this).call(this);var t=e.reader,i=e.removed,a=[],s=new Set,u=t.getCursor(),o=new Set(i);for(this.overriddenIds.clear();u.next();){var c=u.readOptimizedFeatureWorldSpace(),l=c.objectId;a.push(c),s.add(l),this.overriddenIds.add(l),this.removed.delete(l)}var h,d=(0,n.Z)(this._features);try{for(d.s();!(h=d.n()).done;){var f=h.value,v=f.objectId;o.has(v)||s.has(v)||(a.push(f),this.overriddenIds.add(v))}}catch(x){d.e(x)}finally{d.f()}this._features=a;var p,y=(0,n.Z)(s.values());try{for(y.s();!(p=y.n()).done;){var _=p.value;this.removed.delete(_)}}catch(x){y.e(x)}finally{y.f()}var g,m=(0,n.Z)(i);try{for(m.s();!(g=m.n()).done;){var k=g.value;this.removed.add(k),this.overriddenIds.add(k)}}catch(x){m.e(x)}finally{m.f()}}},{key:"removeOverrides",value:function(e){this.invalidate();for(var t=e.reader.getCursor(),r=new Set;t.next();){var n=t.getObjectId();this.overriddenIds.has(n)&&(r.add(n),this.overriddenIds.delete(n))}this._features=this._features.filter((function(e){return!r.has(e.objectId)}))}},{key:"getTileReader",value:function(e){if(!this._features.length)return null;var t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}]),r}(ot),lt=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r)}(pe),ht=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i){var a;return(0,u.Z)(this,r),(a=t.call(this,e,n))._timeZone=i,a.handledChunks=new Set,a.handledChunksForIdCreation=new Set,a.handledChunksForAttributeData=new Set,a._streamLayerDeferredObjectIdsToRemove=[],a}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,N.Z)((0,U.Z)(r.prototype),"destroy",this).call(this);var e,t=(0,n.Z)(this._source.chunks());try{for(t.s();!(e=t.n()).done;){var i=e.value;this._cleanupChunkIds(i)}}catch(a){t.e(a)}finally{t.f()}}},{key:"invalidateAttributeData",value:function(){this.handledChunksForAttributeData.clear()}},{key:"onSubscribe",value:function(e){(0,N.Z)((0,U.Z)(r.prototype),"onSubscribe",this).call(this,e),this._evalOptions=e.tile.createArcadeEvaluationOptions(this._timeZone)}},{key:"createState",value:function(e){return new lt(e)}},{key:"aggregateQueryEngine",get:function(){return null}},{key:"displayMap",value:function(e,t,r){var i,a=new Map(e.map((function(e){return[t(e),e]}))),s=[],u=(0,n.Z)(this._source.chunks());try{for(u.s();!(i=u.n()).done;)for(var o=i.value.reader.getCursor();o.next();){var c=o.getObjectId(),l=o.getDisplayId(),h=a.get(c);if(null!=h){var d=r(l,h,c);s.push(d),a.delete(c)}}}catch(f){u.e(f)}finally{u.f()}return s}},{key:"getDisplayFeatures",value:function(e){var t,r=new Set(e),i=new Set,a=[],s=(0,n.Z)(this._source.chunks());try{for(s.s();!(t=s.n()).done;)for(var u=t.value.reader.getCursor();u.next();){var o=u.getObjectId(),c=u.getDisplayId();r.has(c)&&!i.has(o)&&(a.push((0,b.Z)((0,b.Z)({},u.readLegacyFeatureWorldSpace()),{},{displayId:c})),i.add(o))}}catch(l){s.e(l)}finally{s.f()}return{features:a,aggregates:[]}}},{key:"applyLocalEdit",value:function(e){var t=this;return(0,ae.Z)((0,i.Z)().mark((function r(){var a,s,u,o,c,l,h,d,f,v,p,y,_,g,m,k,x;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(a=[],s=e.reader.getCursor();s.next();)u=s.getObjectId(),a.push(u),o=t._attributeStore.createDisplayIdForObjectId(u),s.setDisplayId(o),t._attributeStore.setAttributeData(o,s,t._evalOptions);c=t.getDisplayIds(a),l=t.getDisplayIds(e.removed),(h=new ct(t._source.metadata,"localEdit")).applyOverrides(e),t.handledChunks.add(h.chunkId),t.handledChunksForAttributeData.add(h.chunkId),t.handledChunksForIdCreation.add(h.chunkId),d=(0,n.Z)(t._sendStates.values()),r.prev=5,d.s();case 7:if((f=d.n()).done){r.next=14;break}return(v=f.value).handledChunks.add(h.chunkId),r.next=12,new me(v.subscription,null,c,!1,h.queryInfo);case 12:r.next=7;break;case 14:r.next=19;break;case 16:r.prev=16,r.t0=r.catch(5),d.e(r.t0);case 19:return r.prev=19,d.f(),r.finish(19);case 22:p=(0,n.Z)(t._sendStates.values()),r.prev=23,p.s();case 25:if((y=p.n()).done){r.next=32;break}return _=y.value,g=h.getTileReader(_.subscription.tile),r.next=30,new me(_.subscription,g,l,!1,h.queryInfo);case 30:r.next=25;break;case 32:r.next=37;break;case 34:r.prev=34,r.t1=r.catch(23),p.e(r.t1);case 37:return r.prev=37,p.f(),r.finish(37);case 40:m=(0,n.Z)(e.removed);try{for(m.s();!(k=m.n()).done;)x=k.value,t._attributeStore.releaseDisplayIdForObjectId(x)}catch(i){m.e(i)}finally{m.f()}case 42:case"end":return r.stop()}}),r,null,[[5,16,19,22],[23,34,37,40]])})))()}},{key:"updateChunks",value:function(){var e=this;return(0,ae.Z)((0,i.Z)().mark((function t(){var r,a,s;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e._source.chunks().length){t.next=19;break}return t.next=3,(0,ie.Z)(e._updateAttributeData());case 3:r=(0,n.Z)(e._sendStates.values()),t.prev=4,r.s();case 6:if((a=r.n()).done){t.next=11;break}return s=a.value,t.delegateYield(ne((0,Z.Z)(e._update(s)),ie.Z),"t0",9);case 9:t.next=6;break;case 11:t.next=16;break;case 13:t.prev=13,t.t1=t.catch(4),r.e(t.t1);case 16:return t.prev=16,r.f(),t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[4,13,16,19]])})))()}},{key:"removeChunks",value:function(e){var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this.handledChunks.delete(i.chunkId),this.handledChunksForAttributeData.delete(i.chunkId),this._cleanupChunkIds(i)}}catch(a){r.e(a)}finally{r.f()}}},{key:"afterUpdateChunks",value:function(){var e,t=(0,n.Z)(this._streamLayerDeferredObjectIdsToRemove);try{for(t.s();!(e=t.n()).done;){var r=e.value;this._attributeStore.releaseDisplayIdForObjectId(r)}}catch(i){t.e(i)}finally{t.f()}this._streamLayerDeferredObjectIdsToRemove=[]}},{key:"_cleanupChunkIds",value:function(e){if(this.handledChunksForIdCreation.has(e.chunkId)){for(var t=e.reader.getCursor();t.next();){var r=t.getObjectId();this._source.isStream?this._streamLayerDeferredObjectIdsToRemove.push(r):this._attributeStore.releaseDisplayIdForObjectId(r)}this.handledChunksForIdCreation.delete(e.chunkId)}}},{key:"_updateAttributeData",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,a,s,u,o,c,l,h,d,f,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,n.Z)(this._source.chunks());try{for(t.s();!(r=t.n()).done;)if(a=r.value,s=a.chunkId,u=a.reader,!this.handledChunksForIdCreation.has(s))for(this.handledChunksForIdCreation.add(s),o=u.getCursor();o.next();)c=this._attributeStore.createDisplayIdForObjectId(o.getObjectId()),o.setDisplayId(c)}catch(i){t.e(i)}finally{t.f()}l=(0,n.Z)(this._source.chunks());try{for(l.s();!(h=l.n()).done;)if(d=h.value,!this.handledChunksForAttributeData.has(d.chunkId))for(this.handledChunksForAttributeData.add(d.chunkId),f=d.reader.getCursor();f.next();)v=f.getDisplayId(),this._attributeStore.setAttributeData(v,f,this._evalOptions)}catch(i){l.e(i)}finally{l.f()}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_update",value:(0,i.Z)().mark((function e(t){var r,a,s,u,o,c,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.subscription,a=t.handledChunks,s=(0,n.Z)(this._source.chunks()),e.prev=2,s.s();case 4:if((u=s.n()).done){e.next=17;break}if(o=u.value,c=o.chunkId,!a.has(c)){e.next=9;break}return e.abrupt("continue",15);case 9:if(a.add(c),l=o.getTileReader(r.tile),e.t0=l,!e.t0){e.next=15;break}return e.next=15,new ge(t.subscription,l,!1,o.end,o.queryInfo);case 15:e.next=4;break;case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(2),s.e(e.t1);case 22:return e.prev=22,s.f(),e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[2,19,22,25]])}))}]),r}(ye),dt=r(96945),ft=function(){function e(t,r){var n=this;(0,u.Z)(this,e),this._connection=t,this._source=r,this._version=1,this._registry=new K.a,this._proxy=new Q.f({fetch:function(e,t){return n._connection.layerView.fetch(e,t)},fetchDictionary:function(e,t){return n._connection.layerView.fetchDictionary(e,t)}}),this._attributeStore=new dt.p({isLocal:!1,update:function(e){return(0,y.d2)(n._connection.container.updateAttributeView(e))}})}return(0,s.Z)(e,[{key:"destroy",value:function(){var e;this._proxy.destroy(),null!==(e=this._strategy)&&void 0!==e&&e.destroy(),this._attributeStore.destroy()}},{key:"aggregateQueryEngine",get:function(){var e;return null===(e=this._strategy)||void 0===e?void 0:e.aggregateQueryEngine}},{key:"getDisplayFeatures",value:function(e){return this._strategy?this._strategy.getDisplayFeatures(e):{features:[],aggregates:[]}}},{key:"getFeatureObjectIdsForAggregate",value:function(e){return this._strategy?this._strategy.getFeatureObjectIdsForAggregate(e):[]}},{key:"onSubscribe",value:function(e){var t;null===(t=this._strategy)||void 0===t||t.onSubscribe(e)}},{key:"onUnsubscribe",value:function(e){var t;null===(t=this._strategy)||void 0===t||t.onUnsubscribe(e)}},{key:"update",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a,s){var u,o,c,h,d,f,v,p,y,_,g,m,k,x;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=t.processor,v=(0,w.R)(null===(u=this._schema)||void 0===u?void 0:u.storage,f.storage),p=(0,w.R)(null===(o=this._schema)||void 0===o?void 0:o.mesh.properties,f.mesh.properties),y=(0,w.R)(null===(c=this._schema)||void 0===c?void 0:c.mesh.factory,f.mesh.factory),_=(0,w.R)(null===(h=this._schema)||void 0===h?void 0:h.mesh.strategy,f.mesh.strategy),g=p||y||_,v||g||a){e.next=3;break}return e.abrupt("return");case 3:return(0,l.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(this._version,"] SymbolProcessor.update"),{changes:(0,S.Hg)(this._schema,f),schema:f}),this._schema=f,m=M.Z.fromJSON(this._source.service.outSpatialReference),k=new ke.O({fields:this._source.metadata.fieldsIndex,spatialReference:m}),e.next=7,this._attributeStore.update(f.storage,k,this._source.metadata,m,r);case 7:if(null!==(d=this._strategy)&&void 0!==d&&d.invalidateAttributeData(),a||g){e.next=10;break}return e.abrupt("return");case 10:if(e.t0=_||p,!e.t0){e.next=14;break}return e.next=14,this._updateStrategy(f.mesh.strategy,m,s,f.mesh.properties.timeZone);case 14:if(this._updateSortKey(k,"sortKey"in f.mesh.properties?f.mesh.properties.sortKey:null),x=new $(k,this._proxy,n,this._registry),e.t1=y||"dictionary"===f.mesh.factory.symbology.type,!e.t1){e.next=21;break}return e.next=20,J.create(x,f.mesh.factory);case 20:this._factory=e.sent;case 21:return this._invalidate(),this._version=r,e.abrupt("return",this._connection.container.updateRenderState(this._version));case 24:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"applyLocalEdit",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._strategy){e.next=2;break}return e.abrupt("return");case 2:r=this._strategy.applyLocalEdit(t),n=!1,a=!1,e.prev=5,u=(0,Z.Z)(r);case 7:return e.next=9,u.next();case 9:if(!(n=!(o=e.sent).done)){e.next=21;break}return c=o.value,e.prev=11,e.next=14,this._process(c);case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(11);case 18:n=!1,e.next=7;break;case 21:e.next=27;break;case 23:e.prev=23,e.t1=e.catch(5),a=!0,s=e.t1;case 27:if(e.prev=27,e.prev=28,!n||null==u.return){e.next=32;break}return e.next=32,u.return();case 32:if(e.prev=32,!a){e.next=35;break}throw s;case 35:return e.finish(32);case 36:return e.finish(27);case 37:case"end":return e.stop()}}),e,this,[[5,23,27,37],[11,16],[28,,32,36]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateChunks",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._doUpdateChunks();case 2:null===(t=this._strategy)||void 0===t||t.afterUpdateChunks();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeChunks",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!==(r=this._strategy)&&void 0!==r&&r.removeChunks(t),this._attributeStore.incrementDisplayIdGeneration();case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateHighlight",value:function(e){var t=e.highlights;if(this._strategy){var r=this._strategy.displayMap(t,(function(e){return e.objectId}),(function(e,t,r){return{objectId:r,displayId:e,highlightFlags:t.highlightFlags}}));this._attributeStore.setHighlight(r,t)}else this._attributeStore.setHighlight(t.map((function(e){return{objectId:e.objectId,highlightFlags:e.highlightFlags,displayId:-1}})),t)}},{key:"_doUpdateChunks",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,s,u,o,c,h,f,v,p=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._strategy){e.next=2;break}return e.abrupt("return");case 2:t=this._strategy.updateChunks(),r=[],n=new Map,a=!1,s=!1,e.prev=5,o=(0,Z.Z)(t);case 7:return e.next=9,o.next();case 9:if(!(a=!(c=e.sent).done)){e.next=18;break}h=c.value,null==(f=n.get(h.id))&&(f=new te({concurrency:16,process:function(e){return p._process(e)}}),n.set(h.id,f)),v=f.push(h).catch((function(e){return(0,d.H9)(e)})),r.push(v);case 15:a=!1,e.next=7;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(5),s=!0,u=e.t0;case 24:if(e.prev=24,e.prev=25,!a||null==o.return){e.next=29;break}return e.next=29,o.return();case 29:if(e.prev=29,!s){e.next=32;break}throw u;case 32:return e.finish(29);case 33:return e.finish(24);case 34:return e.prev=34,e.next=37,Promise.all(r);case 37:e.next=41;break;case 39:e.prev=39,e.t1=e.catch(34);case 41:(0,l.Z)("esri-2d-update-debug")&&console.log("SendUpdates"),this._attributeStore.sendUpdates(),(0,l.Z)("esri-2d-update-debug")&&console.log("SendUpdates.await");case 42:case"end":return e.stop()}}),e,this,[[5,20,24,34],[25,,29,33],[34,39]])})));return function(){return e.apply(this,arguments)}}()},{key:"_updateStrategy",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a,s){var u,o,c,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=(null!==(u=this._strategy)&&void 0!==u&&u.destroy(),t.type),e.next="feature"===e.t0?3:"binning"===e.t0?5:"cluster"===e.t0?9:12;break;case 3:return this._strategy=new ht(this._source,this._attributeStore,s),e.abrupt("break",12);case 5:return e.next=7,Me.create(t,r,this._source,this._attributeStore,s);case 7:return this._strategy=e.sent,e.abrupt("break",12);case 9:return e.next=11,He.create(this._connection,t,r,this._source,this._attributeStore,s);case 11:this._strategy=e.sent;case 12:o=(0,n.Z)(a);try{for(o.s();!(c=o.n()).done;)l=c.value,this._strategy.onSubscribe(l)}catch(i){o.e(i)}finally{o.f()}case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_updateSortKey",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._sortInfo=(0,I.SC)(null===(n=this._sortInfo)||void 0===n?void 0:n.computed),null==r){e.next=10;break}if(!r.byRenderer){e.next=5;break}e.t0=null,e.next=8;break;case 5:return e.next=7,t.createComputedField(r);case 7:e.t0=e.sent;case 8:a=e.t0,this._sortInfo=(0,b.Z)((0,b.Z)({},r),{},{computed:a});case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_invalidate",value:function(){this._strategy&&this._strategy.invalidate()}},{key:"_process",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,c,h,f,v,p,y,_;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.subscription,(0,l.Z)("esri-2d-update-debug")&&(s=a.tile,console.debug("Version[".concat(this._version,"] Tile[").concat(s.key.id,", end=").concat(t.end,"] Processor._process"))),e.next=4,this._fetchResources(t);case 4:return(0,d.k_)(a.signal),e.next=7,this._write(t,a.tile.createArcadeEvaluationOptions(null===(r=this._schema)||void 0===r?void 0:r.mesh.properties.timeZone));case 7:if(u=e.sent,o=a.tile.tileInfoView.tileInfo.isWrappable,c=u.serialize(o),h=c.message,f=c.transferList,v={objectIdMap:null,inner:t.createMessage(h,this._version,this._attributeStore.epoch)},null!==(n=this._schema)&&void 0!==n&&n.mesh.properties.returnMeshObjectId&&(v.objectIdMap={},y=null===(p=t.reader)||void 0===p?void 0:p.getCursor()))for(;y.next();)v.objectIdMap[y.getDisplayId()]=y.getObjectId();return(0,d.k_)(a.signal),e.next=17,this._connection.container.onMessage(v,{signal:a.signal,transferList:f});case 17:if(this._attributeStore.sendUpdates(),!(0,l.Z)("esri-2d-update-debug")){e.next=21;break}_=a.tile,console.debug("Version[".concat(this._version,"] Tile[").concat(_.key.id,", end=").concat(t.end,"] Processor._process.await"));case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchResources",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchMatcherResources(t);case 2:return e.next=4,this._fetchWriterResources(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchMatcherResources",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.reader){e.next=2;break}return e.abrupt("return",this._factory.enqueueMatcherRequests(this._proxy,t.reader));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchWriterResources",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.reader){e.next=2;break}return e.abrupt("return");case 2:for(r=t.reader.getCursor(),n=t.subscription.tile.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);r.next();)this._factory.enqueueWriterRequests(this._proxy,r,n);return e.next=6,this._proxy.fetchEnqueuedResources();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_write",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u,o,c,l,h,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.subscription.tile,u=null===(n=t.reader)||void 0===n?void 0:n.getCursor(),o=null!==(a=null===u||void 0===u?void 0:u.getSize())&&void 0!==a?a:0,c=s.tileInfoView.tileInfo.isWrappable,l=new q(s.key,this._strategy.enablePixelBuffering,c,o),u){e.next=3;break}return e.abrupt("return",l);case 3:for(h=s.createArcadeEvaluationOptions(this._schema.mesh.properties.timeZone);u.next();)d=this._getSortKeyValue(u,r),l.entityStart(u.getDisplayId(),d),this._factory.write(l,this._proxy,u,h,s.level),l.entityEnd();return e.abrupt("return",l);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getSortKeyValue",value:function(e,t){if(!this._sortInfo)return 0;var r=this._sortInfo,n=r.computed,i=r.order,a=r.byRenderer?this._factory.getSortKey(e,t):null===n||void 0===n?void 0:n.read(e,t);return null==a||isNaN(a)?0:a*("asc"===i?-1:1)}}]),e}(),vt=r(76200),pt=r(5192),yt=function(){function e(t,r,n){(0,u.Z)(this,e),this.featureCount=t,this.vertexCount=r,this.ringCount=n}return(0,s.Z)(e,[{key:"toJSON",value:function(){return{featureCount:this.featureCount,ringCount:this.featureCount,vertexCount:this.featureCount}}}],[{key:"from",value:function(t){var r=0,n=0,i=0;return t.forEach((function(e){var t=e._readGeometry();t&&(n+=t.isPoint?1:t.lengths.reduce((function(e,t){return e+t}),0),i+=t.isPoint?1:t.lengths.length,r+=1)})),new e(r,n,i)}}]),e}(),_t=r(62044),gt=r(76672),mt=r(25899),kt=r(21149);var xt=function(){function e(t,r,n,i,a,s){(0,u.Z)(this,e),this._queryParams=t,this._queryScaleRanges=r,this._subtypeField=n,this._customParameters=i,this._geometryType=a,this._queryMetadata=s}return(0,s.Z)(e,[{key:"pageSize",get:function(){var e;if(null==this._queryMetadata)throw new Error("InternalError: Service does not support paged queries");var t=this._queryMetadata.supportsMaxRecordCountFactor?4:null,r=(null!==(e=this._queryMetadata.maxRecordCount)&&void 0!==e?e:8e3)*(null!==t&&void 0!==t?t:1);return Math.min(8e3,r)}},{key:"updateHistoricMoment",value:function(e){this._queryParams.historicMoment=e}},{key:"updateFields",value:function(e){this._queryParams.outFields=e}},{key:"createPatchFieldsQuery",value:function(e,t){if(!t.getSize())return null;var r=e.clone();if("*"===this._queryParams.outFields[0]){var i;if("*"===(null!==(i=r.outFields)&&void 0!==i?i:[])[0])return null;r.outFields=this._queryParams.outFields}else{var a,s=new Set(this._queryParams.outFields),u=[],o=(0,n.Z)(s);try{for(o.s();!(a=o.n()).done;){var c=a.value;t.hasField(c)||u.push(c)}}catch(l){o.e(l)}finally{o.f()}if(0===u.length)return null;r.outFields=u}return r.returnGeometry=!1,r.returnCentroid=!1,r.quantizationParameters=null,r.cacheHint=!0,{inner:r,customParameters:this._customParameters}}},{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._queryParams)throw new Error("InternalError: queryInfo should be defined");return{inner:new kt.Z((0,b.Z)((0,b.Z)({},this._queryParams),e)),customParameters:this._customParameters}}},{key:"createTileQuery",value:function(e,t){var r;if(null==this._queryMetadata)throw new Error("InternalError: Service does not support tile queries");var n=this.createQuery(t),i=n.inner;if(this._queryScaleRanges.length){var a=this._queryScaleRanges.filter((function(t){return(!t.minScale||t.minScale>=e.maxScale)&&(!t.maxScale||t.maxScale<=e.minScale)})).map((function(e){return e.subtypeCode}));if(a.length){var s="".concat(this._subtypeField," IN (").concat(a,")");i.where=(0,gt._)(i.where,s)}}if(i.quantizationParameters=null!==(r=t.quantizationParameters)&&void 0!==r?r:e.getQuantizationParameters(),i.resultType="tile",i.geometry=e.extent,this._queryMetadata.supportsQuantization?"esriGeometryPolyline"===this._geometryType&&(i.maxAllowableOffset=e.resolution*(0,l.Z)("feature-polyline-generalization-factor")):"esriGeometryPolyline"!==this._geometryType&&"esriGeometryPolygon"!==this._geometryType||(i.maxAllowableOffset=e.resolution,"esriGeometryPolyline"===this._geometryType&&(i.maxAllowableOffset*=(0,l.Z)("feature-polyline-generalization-factor"))),i.defaultSpatialReferenceEnabled=this._queryMetadata.supportsDefaultSpatialReference,i.compactGeometryEnabled=this._queryMetadata.supportsCompactGeometry,this._queryMetadata.supportsMaxRecordCountFactor&&(i.maxRecordCountFactor=4),(0,l.Z)("esri-tiles-debug")){var u=e.id.replaceAll("/",".");n.customParameters=n.customParameters?(0,b.Z)((0,b.Z)({},n.customParameters),{},{tileId:u}):{tileId:u}}return n}},{key:"createPagedTileQuery",value:function(e,t){var r=this.pageSize;return this.createTileQuery(e,{start:r*t,num:r,returnExceededLimitFeatures:!0})}},{key:"createPagedQuery",value:function(e){var t=this.pageSize;return this.createQuery({start:t*e,num:t,returnExceededLimitFeatures:!0,maxRecordCountFactor:4})}}],[{key:"fromSchema",value:function(t,r,n){var i="feature"===r.type?r.mutable.dataFilter.queryScaleRanges:[];return new e(function(e,t,r){var n,i,a,s=null!==(n=e.orderByFields)&&void 0!==n?n:r.objectIdField+" ASC",u=e.source,o={returnCentroid:!(null!==u&&"object"==typeof u&&"path"in u&&(0,mt.M8)(u.path))&&"esriGeometryPolygon"===r.geometryType,returnGeometry:!0,timeReferenceUnknownClient:null!==(i=r.timeReferenceUnknownClient)&&void 0!==i?i:void 0,outSpatialReference:M.Z.fromJSON(e.outSpatialReference),orderByFields:[s],where:null!==(a=t.mutable.dataFilter.definitionExpression)&&void 0!==a?a:"1=1",outFields:t.mutable.availableFields};if("feature"===t.type){var c=t.mutable.dataFilter,l=c.gdbVersion,h=c.historicMoment,d=c.timeExtent;return(0,b.Z)((0,b.Z)({},o),{},{gdbVersion:l,historicMoment:h?new Date(h):null,timeExtent:d?_t.Z.fromJSON(d):null,outFields:t.mutable.availableFields})}return o}(t,r,n),i,n.subtypeField,r.mutable.dataFilter.customParameters,n.geometryType,t.queryMetadata)}}]),e}(),bt=r(27366),Zt=r(7138),It=r(49861),wt=r(32718),St=r(69912),Mt=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this))._connection=e,n._enabledEventTypes=new Set,n._updateInfo={websocket:0,client:0},n._lastTime=performance.now(),n._queuedCommands=[],n.addHandles([(0,v.watch)((function(){var e,t;return null!==(e=null===(t=n._strategy)||void 0===t?void 0:t.connectionStatus)&&void 0!==e?e:"disconnected"}),(function(e){n._layerView.setProperty({propertyName:"pipelineConnectionStatus",value:e})}),{initial:!0}),(0,v.watch)((function(){var e;return(null===(e=n._strategy)||void 0===e?void 0:e.errorString)||null}),(function(e){return n._layerView.setProperty({propertyName:"pipelineErrorString",value:e})}),{initial:!0})]),n}return(0,s.Z)(r,[{key:"destroy",value:function(){this._strategy=null,this.removeAllHandles()}},{key:"_layerView",get:function(){return this._connection.layerView}},{key:"strategy",set:function(e){var t=this;null==this._strategy&&this._resetUpdateInfo(performance.now());var r="event-handles";this.removeHandles(r),null!=e&&(this.addHandles([e.events.on("data-received",(function(e){return t._onFeature(e)})),e.events.on("message-received",(function(e){return t._onWebSocketMessage(e)})),e.events.on("features-updated",(function(e){return t._onUpdate(e)})),e.events.on("tick",(function(){return t._onTick()}))],r),this._queuedCommands.forEach((function(t){return t(e)})),this._queuedCommands=[]),this._strategy=e}},{key:"updateCustomParameters",value:function(e){null!=e&&this._callOrEnqueue((function(t){return t.updateCustomParameters(e)}))}},{key:"sendMessageToSocket",value:function(e){this._callOrEnqueue((function(t){return t.sendMessageToSocket(e)}))}},{key:"sendMessageToClient",value:function(e){this._callOrEnqueue((function(t){return t.sendMessageToClient(e)}))}},{key:"enableEvent",value:function(e,t){t?this._enabledEventTypes.add(e):this._enabledEventTypes.delete(e)}},{key:"disconnect",value:function(){var e;null===(e=this._strategy)||void 0===e||e.disconnect()}},{key:"connect",value:function(){var e;null===(e=this._strategy)||void 0===e||e.connect()}},{key:"clear",value:function(){var e;null===(e=this._strategy)||void 0===e||e.clear()}},{key:"_onWebSocketMessage",value:function(e){this._enabledEventTypes.has("message-received")&&this._layerView.emitEvent({name:"message-received",event:e})}},{key:"_onFeature",value:function(e){this._updateInfo.websocket++,this._enabledEventTypes.has("data-received")&&this._layerView.emitEvent({name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}})}},{key:"_onUpdate",value:function(e){this._updateInfo.client+=e}},{key:"_onTick",value:function(){var e=performance.now(),t=e-this._lastTime;if(t>2500){var r=Math.round(this._updateInfo.client/(t/1e3)),n=Math.round(this._updateInfo.websocket/(t/1e3));this._resetUpdateInfo(e),this._layerView.emitEvent({name:"update-rate",event:{client:r,websocket:n}})}}},{key:"_resetUpdateInfo",value:function(e){this._lastTime=e,this._updateInfo.client=0,this._updateInfo.websocket=0}},{key:"_callOrEnqueue",value:function(e){null!=this._strategy?e(this._strategy):this._queuedCommands.push(e)}}]),r}(Zt.default);(0,bt._)([(0,It.Cb)()],Mt.prototype,"_strategy",void 0),Mt=(0,bt._)([(0,St.j)("esri.views.2d.layers.features.sources.StreamMessenger")],Mt);var Ct=function(){function e(t){(0,u.Z)(this,e),this._store=t,this._controller=new AbortController}return(0,s.Z)(e,[{key:"destroy",value:function(){this._controller.abort()}},{key:"_options",get:function(){return{signal:this._controller.signal}}},{key:"unsafeSetQueryHistoricMoment",value:function(e){throw new Error("InternalError: LoadStrategy does not support query info")}},{key:"queryOverride",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("InternalError: LoadStrategy does not support fetching");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryByObjectId",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("InternalError: LoadStrategy does not support fetching");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Tt=r(18008),Ft=r(58971),Ot=r(67213),Rt=r(78084),Et=r(31028),qt=r(91347),At=268435455,Pt=(0,s.Z)((function e(){(0,u.Z)(this,e),this.hasFeatures=!1,this.exceededTransferLimit=!1,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.vertexCount=0,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}));function Lt(e,t){for(var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1,a=3,s=9,u=12,c=13,l=15,h=e.asUnsafe(),d=h.pos(),f=new Pt,v=0,p=0,y=1,_=2,g=4,m=3,k=null,x=null,b=null,Z=!1,I=[];h.next();)switch(h.tag()){case i:k=h.getString();break;case a:x=h.getString();break;case u:b=h.processMessage(qt.G$);break;case s:if(f.exceededTransferLimit=h.getBool(),f.exceededTransferLimit){f.offsets.geometry=n?new Float64Array(8e3):new Int32Array(8e3),f.centroid=n?new Float64Array(16e3):new Int32Array(16e3);for(var w=0;w<f.centroid.length;w++)f.centroid[w]=At}break;case c:var S=h.processMessage(qt.wn);S.index=v++,I.push(S);break;case l:var M=h.getLength(),C=h.pos()+M;if(!f.exceededTransferLimit){var T=f.offsets.geometry,F=f.centroid;T.push(0),F.push(At),F.push(At)}!Z&&f.exceededTransferLimit&&(Z=!0,f.offsets.attributes=n?new Float64Array(8e3*v):new Uint32Array(8e3*v));for(var O=p*v;h.pos()<C&&h.next();)switch(h.tag()){case y:Z?f.offsets.attributes[O++]=h.pos():f.offsets.attributes.push(h.pos());var R=h.getLength();h.skipLen(R);break;case _:if(t)for(var E=h.getLength(),q=h.pos()+E;h.pos()<q&&h.next();)if(h.tag()===m){h.getUInt32();var A=h.getSInt64(),P=h.getSInt64();f.centroid[2*p]=A,f.centroid[2*p+1]=P}else h.skip();else{f.offsets.geometry[p]=h.pos();var L=h.getLength();f.vertexCount+=L,h.skipLen(L)}break;case g:for(var D=h.getLength(),B=h.pos()+D;h.pos()<B&&h.next();)if(h.tag()===m){h.getUInt32();var j=h.getSInt64(),N=h.getSInt64();f.centroid[2*p]=j,f.centroid[2*p+1]=N}else h.skip();break;default:h.skip()}p++,f.hasFeatures=!0;break;default:h.skip()}var U=k||x;if(!U)throw new o.Z("FeatureSet has no objectId or globalId field name");return f.fields=new Ze.Z(I),f.featureCount=p,f.fieldCount=v,f.objectIdFieldIndex=null===(r=f.fields.get(U))||void 0===r?void 0:r.index,f.transform=b,f.displayIds=new Uint32Array(f.featureCount),f.groupIds=new Uint16Array(f.featureCount),h.move(d),f}var Dt=268435455,Bt=128e3,jt={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(Bt),decoded:new Int32Array(Bt)}};function Nt(e){return e<=jt.small.delta.length?jt.small:(e<=jt.large.delta.length||(jt.large.delta=new Int32Array(Math.round(1.25*e)),jt.large.decoded=new Int32Array(Math.round(1.25*e))),jt.large)}function Ut(e){try{for(var t=new Rt.Z(new Uint8Array(e),new DataView(e));t.next();){if(2===t.tag())return Wt(t.getMessage());t.skip()}}catch(n){var r=new o.Z("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:n});wt.Z.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(r)}return null}function Wt(e){for(;e.next();){if(1===e.tag())return e.getMessage();e.skip()}return null}function zt(e,t,r,n,i,a){return.5*Math.abs(e*n+r*a+i*t-e*a-r*t-i*n)}function Gt(e,t,r,n){return 0===e*n-r*t&&e*r+t*n>0}var Yt=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i){var a;return(0,u.Z)(this,r),(a=t.call(this,i))._hasNext=!1,a._isPoints=!1,a._featureIndex=-1,a._featureOffset=0,a._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},a._parseCaches=new Array,a._geometryType=i.geometryType,a._reader=e,a._header=n,a._hasNext=n.hasFeatures,a._isPoints="esriGeometryPoint"===i.geometryType,a}return(0,s.Z)(r,[{key:"_size",get:function(){return this._header.featureCount}},{key:"fields",get:function(){return this._header.fields}},{key:"geometryType",get:function(){return this._geometryType}},{key:"hasZ",get:function(){return!1}},{key:"hasM",get:function(){return!1}},{key:"hasFeatures",get:function(){return this._header.hasFeatures}},{key:"hasNext",get:function(){return this._hasNext}},{key:"exceededTransferLimit",get:function(){return this._header.exceededTransferLimit}},{key:"getSize",value:function(){return this._size}},{key:"getInTransform",value:function(){return this._header.transform}},{key:"getCursor",value:function(){return this.copy()}},{key:"getIndex",value:function(){return this._featureIndex}},{key:"setIndex",value:function(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e}},{key:"getAttributeHash",value:function(){var e,t="",r=(0,n.Z)(this._header.fields.fields);try{for(r.s();!(e=r.n()).done;){var i=e.value;t+=this._readAttributeAtIndex(i.index)+"."}}catch(a){r.e(a)}finally{r.f()}return t}},{key:"getObjectId",value:function(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}},{key:"getDisplayId",value:function(){return this._header.displayIds[this._featureIndex]}},{key:"setDisplayId",value:function(e){this._header.displayIds[this._featureIndex]=e}},{key:"readGeometryArea",value:function(){return this._cache.area||this._readGeometry(!0),this._cache.area}},{key:"copy",value:function(){var e=new r(this._reader.clone(),this._header,this.metadata);return this.copyInto(e),e}},{key:"next",value:function(){for(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}},{key:"_readX",value:function(){return this._header.centroid[2*this._featureIndex]}},{key:"_readY",value:function(){return this._header.centroid[2*this._featureIndex+1]}},{key:"_readServerCentroid",value:function(){var e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];return e===Dt?null:new Ce.Z([],[e,t])}},{key:"_readGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(void 0===this._cache.geometry){var t,r=null;if(this._isPoints){if(this._header.centroid[2*this._featureIndex]===Dt)return null;var n=this._header.centroid[2*this._featureIndex],i=this._header.centroid[2*this._featureIndex+1];r=new Ce.Z([],[n,i])}else{var a=this._header.offsets.geometry[this._featureIndex],s=this._reader;if(0===a)return null;s.move(a);try{r=e?this._parseGeometryForDisplay(s):this._parseGeometry(s)}catch(x){return null}}return 0===(null===(t=r)||void 0===t?void 0:t.coords.length)&&(r=null),this._cache.geometry=r,r}return this._cache.geometry}},{key:"_readAttribute",value:function(e,t){var r,n=this._header.fields.get(e);if(null!=n){var i=this._readAttributeAtIndex(n.index);"esriFieldTypeTimestampOffset"===(null===(r=this.fields.get(e))||void 0===r?void 0:r.type)&&(i=this.parseTimestampOffset(i));var a=this._header.fields.isDateField(n.name);return t?null==i?i:a?new Date(i):i:i}}},{key:"_readAttributes",value:function(){var e,t={},r=(0,n.Z)(this._header.fields.fields);try{for(r.s();!(e=r.n()).done;){var i=e.value;t[i.name]=this._readAttributeAtIndex(i.index)}}catch(a){r.e(a)}finally{r.f()}return t}},{key:"copyInto",value:function(e){(0,N.Z)((0,U.Z)(r.prototype),"copyInto",this).call(this,e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext,e._parseCaches=this._parseCaches}},{key:"_readAttributeAtIndex",value:function(e){var t=this._parseCaches[e];if(t||(t=new Et.j(this.getSize()),this._parseCaches[e]=t),t.has(this._featureIndex))return t.get(this._featureIndex);var r=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],n=this._reader;n.move(r);var i=function(e){for(var t=e.getLength(),r=e.pos()+t;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(n);return t.set(this._featureIndex,i),i}},{key:"_readGeometryDeltaDecoded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(void 0===this._cache.unquantGeometry){var t=this._readGeometry(e);if(!t)return this._cache.unquantGeometry=void 0,null;if(!this.getInTransform())return this._cache.unquantGeometry=t,t;var r,i=Nt(t.coords.length).decoded,a=t.clone(i),s=a.coords,u=0,o=(0,n.Z)(a.lengths);try{for(o.s();!(r=o.n()).done;){for(var c=r.value,l=1;l<c;l++){var h=2*(u+l),d=2*(u+l-1);s[h]+=s[d],s[h+1]+=s[d+1]}u+=c}}catch(f){o.e(f)}finally{o.f()}return this._cache.unquantGeometry=a,a}return this._cache.unquantGeometry}},{key:"_parseGeometry",value:function(e){for(var t=e.asUnsafe(),r=t.getLength(),n=t.pos()+r,i=[],a=[];t.pos()<n&&t.next();)switch(t.tag()){case 2:for(var s=t.getUInt32(),u=t.pos()+s;t.pos()<u;)a.push(t.getUInt32());break;case 3:var o=t.getUInt32(),c=t.pos()+o;for(i.push(t.getSInt64()),i.push(t.getSInt64()),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();t.pos()<c;)i.push(t.getSInt64()),i.push(t.getSInt64()),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();break;default:t.skip()}return new Ce.Z(a,i)}},{key:"_parseGeometryForDisplay",value:function(e){for(var t=e.asUnsafe(),r=t.getLength(),i=t.pos()+r,a=[],s=[],u=0,o=0,c=null,l=0,h="esriGeometryPolygon"===this.geometryType;t.pos()<i&&t.next();)switch(t.tag()){case 2:for(var d=t.getUInt32(),f=t.pos()+d;t.pos()<f;){var v=t.getUInt32();a.push(v),u+=v}c=Nt(2*u).delta;break;case 3:t.getUInt32();var p=2+(this.hasZ?1:0)+(this.hasM?1:0);(0,I.O3)(c);var y,_=(0,n.Z)(a);try{for(_.s();!(y=_.n()).done;){var g=y.value;if(o+p*g>c.length)for(var m=0;m<g;m++)t.getSInt32(),t.getSInt32(),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();else if(h){var k=this.getAreaSimplificationThreshold(g,this._header.vertexCount),x=2,b=1,Z=t.getSInt32(),w=t.getSInt32();c[o++]=Z,c[o++]=w,this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();var S=t.getSInt32(),M=t.getSInt32();for(this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();x<g;){var C=t.getSInt32(),T=t.getSInt32();this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();var F=Z+S,O=w+M;zt(Z,w,F,O,F+C,O+T)>=k?(l+=-.5*(F-Z)*(O+w),b>1&&Gt(c[o-2],c[o-1],S,M)?(c[o-2]+=S,c[o-1]+=M):(c[o++]=S,c[o++]=M,b++),Z=F,w=O):(C+=S,T+=M),S=C,M=T,x++}b<3?o-=2*b:(l+=-.5*(Z+S-Z)*(w+M+w),Gt(c[o-2],c[o-1],S,M)?(c[o-2]+=S,c[o-1]+=M,s.push(b)):(c[o++]=S,c[o++]=M,s.push(++b)))}else{var R=0,E=t.getSInt32(),q=t.getSInt32();this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32(),c[o++]=E,c[o++]=q,R+=1;for(var A=1;A<g;A++){var P=t.getSInt32(),L=t.getSInt32(),D=E+P,B=q+L;l+=-.5*(D-E)*(B+q),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32(),A>2&&Gt(c[o-2],c[o-1],P,L)?(c[o-2]+=P,c[o-1]+=L):(c[o++]=P,c[o++]=L,R+=1),E=D,q=B}s.push(R)}}}catch(j){_.e(j)}finally{_.f()}break;default:t.skip()}return this._cache.area=l,s.length?new Ce.Z(s,c):null!=c?this._createQuantizedExtrudedGeometry(c[0],c[1]):null}}],[{key:"fromBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t.geometryType,a=Ut(e),s=Lt(a,"esriGeometryPoint"===i,n);return new r(a,s,t)}}]),r}(Ie.s),Xt=function(){function e(t,r){(0,u.Z)(this,e),this.service=t,this._metadata=r}return(0,s.Z)(e,[{key:"destroy",value:function(){}}]),e}();function Vt(){return Vt=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Tt.Z,e.next=3,r.open(t,{});case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),Vt.apply(this,arguments)}var Ht=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n){var i;return(0,u.Z)(this,r),(i=t.call(this,e,n))._portsOpen=function(e){return Vt.apply(this,arguments)}(e.source).then((function(e){return i.client=e})),i}return(0,s.Z)(r,[{key:"destroy",value:function(){this.client.close(),this.client=null}},{key:"executeQuery",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._portsOpen;case 2:return e.next=4,this.client.invoke("queryFeatures",t.toJSON(),r);case 4:return n=e.sent,e.abrupt("return",we.fromFeatureSet(n,this._metadata));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Xt),Jt=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"executeQuery",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,pt.n7)(this.service.source,t,r);case 2:return n=e.sent,a=n.data,s=!t.quantizationParameters,e.abrupt("return",Yt.fromBuffer(a,this._metadata,s));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Xt),Qt=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"executeQuery",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u,o,c,l,h,d,f,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.service,s=a.source,u=a.queryMetadata,null==t.quantizationParameters||u.supportsQuantization){e.next=10;break}return o=t.clone(),c=(0,Ft.vY)(o.quantizationParameters),o.quantizationParameters=null,e.next=6,(0,pt.JT)(s,o,this._metadata.spatialReference,r);case 6:return l=e.sent,h=l.data,d=(0,se.h_)(h,this._metadata.objectIdField),e.abrupt("return",((0,se.RZ)(c,d),we.fromOptimizedFeatureSet(d,this._metadata)));case 10:return e.next=12,(0,pt.JT)(s,t,this._metadata.spatialReference,r);case 12:return f=e.sent,v=f.data,e.abrupt("return",("esriGeometryPoint"===this._metadata.geometryType&&(v.features=null===(n=v.features)||void 0===n?void 0:n.filter((function(e){if(null!=e.geometry){var t=e.geometry;return Number.isFinite(t.x)&&Number.isFinite(t.y)}return!0}))),we.fromFeatureSet(v,this._metadata)));case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Xt),Kt=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){return(0,u.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"executeQuery",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.quantizationParameters||this.service.queryMetadata.supportsQuantization){e.next=7;break}return n=t.clone(),a=(0,Ft.vY)(n.quantizationParameters),n.quantizationParameters=null,e.next=5,(0,Ot.WW)(this.service.source,t,r);case 5:return s=e.sent,e.abrupt("return",((0,se.RZ)(a,s),we.fromOptimizedFeatureSet(s,this._metadata)));case 7:return e.next=9,(0,Ot.WW)(this.service.source,t,r);case 9:return u=e.sent,e.abrupt("return",we.fromOptimizedFeatureSet(u,this._metadata));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Xt),$t=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,s,o,c){var h;return(0,u.Z)(this,r),(h=t.call(this,s))._serviceInfo=e,h._queryInfo=n,h._metadata=o,h._connection=c,h._queue=new ee.e({concurrency:16,process:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={signal:null===(r=t.options)||void 0===r?void 0:r.signal,query:t.query.customParameters},e.abrupt("return",h._adapter.executeQuery(t.query.inner,n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),h._adapter=function(e,t){switch(e.type){case"memory":return new Ht(e,t);case"ogc":return new Kt(e,t);case"feature-service":return e.queryMetadata.supportsFormatPBF&&(0,l.Z)("featurelayer-pbf")?new Jt(e,t):new Qt(e,t)}}(e,o),h}return(0,s.Z)(r,[{key:"unsafeSetQueryHistoricMoment",value:function(e){this._queryInfo.updateHistoricMoment(e)}},{key:"updateFields",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._queryInfo.updateFields(t),r=Array.from(this._store.chunks()).map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=kt.Z.fromJSON(t.queryInfo.queryJSON))){e.next=11;break}return e.prev=2,e.next=5,s._tryUpdateFields(t.reader,r);case 5:return e.abrupt("return",null);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(r);case 4:if(n=e.sent.filter((function(e){return e})),!n.length){e.next=7;break}throw new o.Z("featurelayer-query","Encountered errors when downloading fields",{errors:n});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryByObjectId",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",we.empty(this._metadata));case 2:return r=this._queryInfo.createQuery({objectIds:t}),e.abrupt("return",this._fetch(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetch",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._enqueue(t,r);case 2:return n=e.sent,e.next=5,this._tryUpdateFields(n,t.inner);case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_tryUpdateFields",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._queryInfo.createPatchFieldsQuery(r,t)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this._enqueue(n,this._options);case 5:a=e.sent,t.joinAttributes(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_enqueue",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._connection.onEvent({type:"fetchStart"}),this._queue.push({query:t,options:r}).finally((function(){n._connection.onEvent({type:"fetchEnd",done:0===n._queue.length})}))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Ct),er=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments))._chunksById=new Map,e}return(0,s.Z)(r,[{key:"unload",value:function(e){this._removeChunks(e.tile)}},{key:"_addChunk",value:function(e){var t=e.tile.id;this._chunksById.has(t)||this._chunksById.set(t,[]);var r=e.size();(r||e.first||e.end)&&((0,l.Z)("esri-2d-update-debug")&&console.debug("Chunk[".concat(e.chunkId,"] ATileLoadStrategy.addChunk [count=").concat(r,"]")),this._chunksById.get(t).push(e),this._store.insert(e))}},{key:"_removeChunks",value:function(e){var t,r,i=null!==(t=this._chunksById.get(e.key.id))&&void 0!==t?t:[],a=(0,n.Z)(i);try{for(a.s();!(r=a.n()).done;){var s=r.value;(0,l.Z)("esri-2d-update-debug")&&console.debug("Tile[".concat(e.key.id,"] Chunk[").concat(s.chunkId,"] ATileLoadStrategy.removeChunk")),this._store.remove(s)}}catch(u){a.e(u)}finally{a.f()}this._chunksById.delete(e.key.id)}}]),r}($t),tr=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a,s,o){var c,l,h;return(0,u.Z)(this,r),(h=t.call(this))._reader=e,h._queryJSON=n,h._tile=i,h._sourceTile=a,h._sourceTileDepth=s,h._end=o,h.chunkId="".concat(h._tile.key.id,".").concat(null===(c=h._sourceTile)||void 0===c?void 0:c.key.id).concat(h._end?"e":""),h.normalizedChunkId="".concat(h._tile.key.normalizedId,".").concat(null===(l=h._sourceTile)||void 0===l?void 0:l.key.normalizedId).concat(h._end?"e":""),h}return(0,s.Z)(r,[{key:"queryInfo",get:function(){var e;return{type:"drill-down-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,sourceTileDepth:this._sourceTileDepth,sourceTileId:null===(e=this._sourceTile)||void 0===e?void 0:e.key.id,size:this.size(),end:this.end}}},{key:"first",get:function(){return 0===this._sourceTileDepth}},{key:"reader",get:function(){return this._reader}},{key:"end",get:function(){return this._end}},{key:"tile",get:function(){return this._tile}},{key:"isTiled",get:function(){return!0}},{key:"getTileReader",value:function(e){return this._tile.key.id===e.key.id?this.reader:null}}]),r}(ot),rr=function(){function e(t,r){var n=this;(0,u.Z)(this,e),this.subscription=t,this._tileIdToResult=new Map,this._controller=new AbortController,this._handles=(0,c.AL)([(0,d.fu)(t.signal,(function(){return n._controller.abort()})),(0,d.fu)(r,(function(){return n._controller.abort()}))])}return(0,s.Z)(e,[{key:"destroy",value:function(){this._controller.abort(),this._handles.remove()}},{key:"get",value:function(e){return this._tileIdToResult.get(e)}},{key:"set",value:function(e,t){this._tileIdToResult.set(e,t)}},{key:"options",get:function(){return{signal:this._controller.signal}}}]),e}(),nr=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments))._loadStates=new Map,e}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,N.Z)((0,U.Z)(r.prototype),"destroy",this).call(this);var e,t=(0,n.Z)(this._loadStates.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(i){t.e(i)}finally{t.f()}this._loadStates.clear()}},{key:"about",get:function(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}},{key:"load",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,c,l,h,f,v,p,y,_,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._loadStates.has(t.key.id)||this._loadStates.set(t.key.id,new rr(t,this._options)),r=this._loadStates.get(t.key.id),e.prev=2,a=!1,s=!1,e.prev=5,o=(0,Z.Z)(this._fetchChunkInfos(r,t.tile,0));case 7:return e.next=9,o.next();case 9:if(!(a=!(c=e.sent).done)){e.next=16;break}l=c.value,h=l.queryJSON,f=l.reader,v=l.sourceTile,p=l.sourceTileDepth,y=l.tile,_=new tr(f,h,y,v,p,!1),(0,d.k_)(r.options),this._addChunk(_);case 13:a=!1,e.next=7;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),s=!0,u=e.t0;case 22:if(e.prev=22,e.prev=23,!a||null==o.return){e.next=27;break}return e.next=27,o.return();case 27:if(e.prev=27,!s){e.next=30;break}throw u;case 30:return e.finish(27);case 31:return e.finish(22);case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(2),n=e.t1;case 37:if(g=new tr(we.empty(this._metadata),null,t.tile,null,-1,!0),this._addChunk(g),!n){e.next=40;break}throw n;case 40:case"end":return e.stop()}}),e,this,[[2,34],[5,18,22,32],[23,,27,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"unload",value:function(e){var t;(0,N.Z)((0,U.Z)(r.prototype),"unload",this).call(this,e),null!==(t=this._loadStates.get(e.key.id))&&void 0!==t&&t.destroy(),this._loadStates.delete(e.key.id)}},{key:"_fetchChunkInfos",value:function(e,t,r){var a=this;return(0,ae.Z)((0,i.Z)().mark((function s(){var u,o,c,h,d;return(0,i.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(u=e.get(t.id),o=!!u,i.t0=u,i.t0){i.next=8;break}return i.next=6,(0,ie.Z)(a._fetchChunkInfo(e,t,r));case 6:u=i.sent,e.set(t.id,u);case 8:if(!(u.reader.exceededTransferLimit&&r<(0,l.Z)("featurelayer-query-max-depth"))){i.next=27;break}c=(0,n.Z)(t.createChildTiles()),i.prev=10,c.s();case 12:if((h=c.n()).done){i.next=17;break}return d=h.value,i.delegateYield(ne((0,Z.Z)(a._fetchChunkInfos(e,d,r+1)),ie.Z),"t1",15);case 15:i.next=12;break;case 17:i.next=22;break;case 19:i.prev=19,i.t2=i.catch(10),c.e(i.t2);case 22:return i.prev=22,c.f(),i.finish(22);case 25:i.next=31;break;case 27:if(i.t3=o,i.t3){i.next=31;break}return i.next=31,u;case 31:case"end":return i.stop()}}),s,null,[[10,19,22,25]])})))()}},{key:"_fetchChunkInfo",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n){var a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.subscription.tile.getQuantizationParameters(),s=this._queryInfo.createTileQuery(r,{returnExceededLimitFeatures:!1,quantizationParameters:a}),e.next=3,this._fetch(s,t.options);case 3:return e.t0=e.sent,e.t1=s.inner.toJSON(),e.t2=t.subscription.tile,e.t3=r,e.t4=n,e.abrupt("return",{reader:e.t0,queryJSON:e.t1,tile:e.t2,sourceTile:e.t3,sourceTileDepth:e.t4});case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(er),ir=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a,s){var o;return(0,u.Z)(this,r),(o=t.call(this))._reader=e,o._queryJSON=n,o._tile=i,o._page=a,o._end=s,o.chunkId="".concat(o._tile.key.id,".").concat(o._page).concat(o.end?"e":""),o.normalizedChunkId="".concat(o._tile.key.normalizedId,".").concat(o._page).concat(o.end?"e":""),o}return(0,s.Z)(r,[{key:"queryInfo",get:function(){return{type:"paged-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}},{key:"reader",get:function(){return this._reader}},{key:"first",get:function(){return 0===this._page}},{key:"end",get:function(){return this._end}},{key:"page",get:function(){return this._page}},{key:"tile",get:function(){return this._tile}},{key:"isTiled",get:function(){return!0}},{key:"getTileReader",value:function(e){return this._tile.key.id===e.key.id?this.reader:null}}]),r}(ot),ar=function(){function e(t,r){var n=this;(0,u.Z)(this,e),this.subscription=t,this._pages=new Set,this._controller=new AbortController,this._done=!1,this._handles=(0,c.AL)([(0,d.fu)(t.signal,(function(){return n._controller.abort()})),(0,d.fu)(r,(function(){return n._controller.abort()}))])}return(0,s.Z)(e,[{key:"destroy",value:function(){this._controller.abort(),this._handles.remove()}},{key:"pageStart",get:function(){var e,t=-1,r=(0,n.Z)(this._pages.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;t=Math.max(t,i)}}catch(a){r.e(a)}finally{r.f()}return t+1}},{key:"done",get:function(){return this._done}},{key:"options",get:function(){return{signal:this._controller.signal}}},{key:"add",value:function(e,t){this._pages.add(e),this._done=this._done||t}}]),e}(),sr=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(){var e;return(0,u.Z)(this,r),(e=t.apply(this,arguments))._loadStates=new Map,e}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,N.Z)((0,U.Z)(r.prototype),"destroy",this).call(this);var e,t=(0,n.Z)(this._loadStates.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(i){t.e(i)}finally{t.f()}this._loadStates.clear()}},{key:"about",get:function(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}},{key:"load",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadStates.has(t.key.id)||this._loadStates.set(t.key.id,new ar(t,this._options)),r=this._loadStates.get(t.key.id),e.prev=2,e.next=5,this._fetchPages(r);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n=e.t0;case 10:if(a=new ir(we.empty(this._metadata),null,t.tile,-1,!0),(0,d.Hc)(r.options)||this._addChunk(a),!n){e.next=13;break}throw n;case 13:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"unload",value:function(e){var t;(0,N.Z)((0,U.Z)(r.prototype),"unload",this).call(this,e),null!==(t=this._loadStates.get(e.key.id))&&void 0!==t&&t.destroy(),this._loadStates.delete(e.key.id)}},{key:"_fetchPages",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,s,u,o,c,l,h,f,v,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=4,a=20,s=0,u=t.pageStart,o=1;case 2:if(!(s<a)||t.done){e.next=13;break}for(c=[],l=0;l<o;l++)c.push(this._fetchChunk(t,u++));return e.next=7,Promise.all(c);case 7:h=e.sent,f=(0,n.Z)(h);try{for(f.s();!(v=f.n()).done;)(0!==(p=v.value).size()||p.first)&&(t.add(p.page,!p.reader.exceededTransferLimit),(0,d.k_)(t.options),this._addChunk(p))}catch(i){f.e(i)}finally{f.f()}s++,o=Math.min(o+1,r);case 11:e.next=2;break;case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchChunk",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.subscription.tile,a=this._queryInfo.createPagedTileQuery(n,r),e.next=4,this._fetch(a,t.options);case 4:return s=e.sent,e.abrupt("return",new ir(s,a.inner.toJSON(),n,r,!1));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(er),ur=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a){var s;return(0,u.Z)(this,r),(s=t.call(this))._reader=e,s._queryJSON=n,s._page=i,s._end=a,s.chunkId="".concat(s._page).concat(s.end?"e":""),s.normalizedChunkId=s.chunkId,s}return(0,s.Z)(r,[{key:"reader",get:function(){return this._reader}},{key:"first",get:function(){return 0===this._page}},{key:"end",get:function(){return this._end}},{key:"queryInfo",get:function(){return{type:"snapshot",chunkId:this.chunkId,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}},{key:"isTiled",get:function(){return!1}},{key:"getTileReader",value:function(e){var t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}]),r}(ot),or=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a,s,o){var c;return(0,u.Z)(this,r),(c=t.call(this,e,n,i,s,o))._random=new f.Z(1e3),c._featureCount=a,c}return(0,s.Z)(r,[{key:"about",get:function(){return{willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}},{key:"load",value:function(e){return null==this._promise&&(this._promise=this._downloadPages(this._featureCount)),this._promise}},{key:"unload",value:function(e){}},{key:"_downloadPages",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,c=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Math.ceil(t/this._queryInfo.pageSize),n=Array.from({length:r},(function(e,t){return t})).sort((function(e,t){return c._random.getInt()-c._random.getInt()})),e.next=4,Promise.all(n.map((function(e){return c._downloadPage(e)})));case 4:if(a=e.sent,s=new ur(we.empty(this._metadata),null,-1,!0),this._store.insert(s),u=a.filter((function(e){return e})),!u.length){e.next=10;break}throw new o.Z("featurelayer-query","Encountered errors when downloading data",{errors:u});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_downloadPage",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=this._queryInfo.createPagedQuery(t),e.next=4,this._fetch(r,this._options);case 4:return n=e.sent,a=new ur(n,r.inner.toJSON(),t,!1),e.abrupt("return",((0,d.k_)(this._options),this._store.insert(a),null));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()}]),r}($t),cr=r(76151),lr=r(97463),hr=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e){return(0,u.Z)(this,r),t.call(this,e)}return(0,s.Z)(r,[{key:"connectionStatus",get:function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.connectionStatus}},{key:"errorString",get:function(){var e;return null===(e=this.connection)||void 0===e?void 0:e.errorString}}]),r}(Zt.default);(0,bt._)([(0,It.Cb)()],hr.prototype,"connection",void 0),(0,bt._)([(0,It.Cb)()],hr.prototype,"connectionStatus",null),(0,bt._)([(0,It.Cb)()],hr.prototype,"errorString",null),hr=(0,bt._)([(0,St.j)("esri.views.2d.layers.features.sources.StreamConnectionState")],hr);var dr=function(){function e(t,r){(0,u.Z)(this,e),this._metadata=t,this._onUpdate=r,this._objectIdToFeature=new Map}return(0,s.Z)(e,[{key:"size",get:function(){return this._objectIdToFeature.size}},{key:"reader",get:function(){return we.fromFeatures((0,C.Z)(this._objectIdToFeature.values()),this._metadata)}},{key:"add",value:function(e){this._objectIdToFeature.set(e.objectId,e)}},{key:"forEach",value:function(e){this._objectIdToFeature.forEach(e)}},{key:"removeById",value:function(e){var t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),t):null}},{key:"clear",value:function(){this._objectIdToFeature=new Map}},{key:"update",value:function(e,t){var r;this._onUpdate(null!==(r=null===e||void 0===e?void 0:e.length)&&void 0!==r?r:0)}}]),e}(),fr=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this))._reader=e,n.chunkId="stream-chunk",n.normalizedChunkId="stream-chunk",n}return(0,s.Z)(r,[{key:"reader",get:function(){return this._reader}},{key:"first",get:function(){return!0}},{key:"end",get:function(){return!0}},{key:"queryInfo",get:function(){return{type:"stream",chunkId:this.chunkId,size:this.size(),end:this.end}}},{key:"isTiled",get:function(){return!1}},{key:"getTileReader",value:function(e){var t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}]),r}(ot),vr=function(e){(0,A.Z)(r,e);var t=(0,P.Z)(r);function r(e,n,i,a,s){var o;(0,u.Z)(this,r),(o=t.call(this,i))._service=e,o._dataFilter=n,o._streamOptions=a,o._metadata=s,o._connectionState=new hr,o._forceRefresh=!1,o.events=new he.Z;var c=o._metadata,l=c.objectIdField,h=c.timeInfo,d=n.purgeOptions;return o._stagingStore=new dr(o._metadata,(function(e){return o.events.emit("features-updated",e)})),o._manager=new cr.Qo(o._stagingStore,l,h,d),o.connect(),o}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,N.Z)((0,U.Z)(r.prototype),"destroy",this).call(this),this.disconnect()}},{key:"about",get:function(){return{willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}},{key:"connectionStatus",get:function(){return this._connectionState.connectionStatus}},{key:"errorString",get:function(){var e;return null===(e=this._connectionState)||void 0===e?void 0:e.errorString}},{key:"refresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=null!=this._chunk,this._manager.checkForUpdates()||!t||this._forceRefresh?(this._chunk&&this._store.remove(this._chunk),this._forceRefresh=!1,this._chunk=new fr(this._stagingStore.reader),this._store.insert(this._chunk),this.events.emit("tick")):this.events.emit("tick");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateFields",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Updating available fields not supported for StreamLayer");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"unload",value:function(e){}},{key:"disconnect",value:function(){var e;this._connection=(0,I.SC)(this._connection),this._connectionState.connection=null,null===(e=this._handlesGroup)||void 0===e||e.remove()}},{key:"connect",value:function(){var e=this;if(null==this._connection){var t=this._metadata,r=t.geometryType,n=t.spatialReference,i=this._dataFilter,a=i.maxReconnectionAttempts,s=i.maxReconnectionInterval,u=i.geometryDefinition,o=i.definitionExpression,l=i.customParameters;this._connection=(0,lr.createConnection)(this._service.source,n,this._streamOptions.outSR,r,o,u,a,s,l),this._handlesGroup=(0,c.AL)([this._connection.on("data-received",(function(t){return e._onFeature(t)})),this._connection.on("message-received",(function(t){return e._onWebSocketMessage(t)}))]),this._connectionState.connection=this._connection}}},{key:"clear",value:function(){this._manager.checkForUpdates(),this._stagingStore.clear(),this._forceRefresh=!0}},{key:"updateCustomParameters",value:function(e){var t;null===(t=this._connection)||void 0===t||t.updateCustomParameters(e)}},{key:"sendMessageToSocket",value:function(e){var t;null===(t=this._connection)||void 0===t||t.sendMessageToSocket(e)}},{key:"sendMessageToClient",value:function(e){var t;null===(t=this._connection)||void 0===t||t.sendMessageToClient(e)}},{key:"_onWebSocketMessage",value:function(e){if("type"in e)switch(e.type){case"delete":if(e.objectIds){var t,r=(0,n.Z)(e.objectIds);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._manager.removeById(i)}}catch(o){r.e(o)}finally{r.f()}}if(e.trackIds){var a,s=(0,n.Z)(e.trackIds);try{for(s.s();!(a=s.n()).done;){var u=a.value;this._manager.removeByTrackId(u)}}catch(o){s.e(o)}finally{s.f()}}break;case"clear":this.clear()}this.events.emit("message-received",e)}},{key:"_onFeature",value:function(e){try{this._manager.add(e),this.events.emit("data-received",e)}catch(x){}}}]),r}(Ct),pr=r(4529),yr=function(){function e(t){(0,u.Z)(this,e),this._onChange=t,this._chunks=new Map,this._chunksToRemove=[],this.events=new he.Z,this.featureAdapter=new pr.t}return(0,s.Z)(e,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){var e,t=(0,n.Z)(this._chunks.values());try{for(t.s();!(e=t.n()).done;){var r=e.value;this._chunksToRemove.push(r)}}catch(i){t.e(i)}finally{t.f()}this._chunks.clear(),null!=this._localEditChunk&&this._chunksToRemove.push(this._localEditChunk),this._localEditChunk=null}},{key:"chunks",value:(0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this._localEditChunk,!e.t0){e.next=4;break}return e.next=4,this._localEditChunk;case 4:if(e.t1=this._localOverridesChunk,!e.t1){e.next=8;break}return e.next=8,this._localOverridesChunk;case 8:return e.delegateYield(this._chunks.values(),"t2",9);case 9:case"end":return e.stop()}}),e,this)}))},{key:"insert",value:function(e){var t,r;(0,l.Z)("esri-2d-update-debug")&&console.debug("Chunk[".concat(e.chunkId,"] SourceChunkStore.insert")),null!==(t=this._localOverridesChunk)&&void 0!==t&&t.overriddenIds.size&&(e.reader.removeIds(this._localOverridesChunk.overriddenIds),e.invalidate()),null!==(r=this._localEditChunk)&&void 0!==r&&r.overriddenIds.size&&this._localEditChunk.removeOverrides(e),this._chunks.set(e.chunkId,e),this.events.emit("changed"),this._onChange()}},{key:"remove",value:function(e){(0,l.Z)("esri-2d-update-debug")&&console.debug("Chunk[".concat(e.chunkId,"] SourceChunkStore.remove")),this._chunks.delete(e.chunkId),this._chunksToRemove.push(e)}},{key:"cleanupRemovedChunks",value:function(){var e=this._chunksToRemove;return this._chunksToRemove=[],e}},{key:"applyLocalOverrides",value:function(e,t){null==this._localOverridesChunk&&(this._localOverridesChunk=new ct(t,"localOverride")),this._localOverridesChunk.applyOverrides(e);var r,i=(0,n.Z)(this._chunks.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;a.reader.removeIds(this._localOverridesChunk.overriddenIds),a.invalidate()}}catch(s){i.e(s)}finally{i.f()}}},{key:"applyLocalEdit",value:function(e,t){null==this._localEditChunk&&(this._localEditChunk=new ct(t,"localEdit")),this._localEditChunk.applyOverrides(e);var r,i=(0,n.Z)(this._chunks.values());try{for(i.s();!(r=i.n()).done;){var a=r.value;a.reader.removeIds(this._localEditChunk.overriddenIds),a.invalidate()}}catch(s){i.e(s)}finally{i.f()}}},{key:"forEach",value:function(e){var t,r=new Set,i=(0,n.Z)(this.chunks());try{for(i.s();!(t=i.n()).done;)for(var a=t.value.reader.getCursor();a.next();){var s=a.getObjectId();r.has(s)||(e(a.copy()),r.add(s))}}catch(u){i.e(u)}finally{i.f()}}},{key:"forEachUnsafe",value:function(e){var t,r=new Set,i=(0,n.Z)(this.chunks());try{for(i.s();!(t=i.n()).done;)for(var a=t.value.reader.getCursor();a.next();){var s=a.getObjectId();r.has(s)||(e(a),r.add(s))}}catch(u){i.e(u)}finally{i.f()}}},{key:"forEachInBounds",value:function(e,t){var r,i=new Set,a=(0,n.Z)(this.chunks());try{for(a.s();!(r=a.n()).done;)for(var s=r.value.queryFeaturesInBounds(e);s.next();){var u=s.getObjectId();i.has(u)||(t(s.copy()),i.add(u))}}catch(o){a.e(o)}finally{a.f()}}},{key:"forEachBounds",value:function(e,t){var r,i=(0,de.Ue)(),a=(0,n.Z)(e);try{for(a.s();!(r=a.n()).done;){r.value.getBounds(i)&&t(i)}}catch(s){a.e(s)}finally{a.f()}}}]),e}(),_r=r(79004),gr=function(){function e(t,r,n,i,a){(0,u.Z)(this,e),this.service=t,this._aggregateAdapter=r,this._subscriptions=n,this._onChange=i,this._connection=a,this._updateTracking=new _r.x({debugName:"FeatureSource"}),this._didInvalidateData=!1,this._store=new yr(this._onChange),this._metadata=new be.A(t.metadata)}return(0,s.Z)(e,[{key:"destroy",value:function(){var e,t;null!==(e=this._strategy)&&void 0!==e&&e.destroy(),this._store.destroy(),null!==(t=this._streamMessenger)&&void 0!==t&&t.destroy(),"memory"===this.service.type&&this.service.source.map((function(e){return e.close()}))}},{key:"metadata",get:function(){if(!this._metadata)throw new Error("InternalError: Metadata not defined. Was update called?");return this._metadata}},{key:"store",get:function(){return this._store}},{key:"streamMessenger",get:function(){return null==this._streamMessenger&&this._initStreamMessenger(),this._streamMessenger}},{key:"statistics",get:function(){return yt.from(this._store)}},{key:"updateTracking",get:function(){return this._updateTracking}},{key:"queryEngine",get:function(){if(!this._queryEngine){if(!this._schema)return null;var e=this._schema.mutable.dataFilter,t=this._schema.mutable.availableFields,r=this._metadata;this._queryEngine=new ve.q({featureStore:this._store,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,objectIdField:r.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.service.outSpatialReference,cacheSpatialQueries:!0,aggregateAdapter:this._aggregateAdapter,timeInfo:r.timeInfo,definitionExpression:e.definitionExpression,availableFields:t})}return this._queryEngine}},{key:"isStream",get:function(){return"stream"===this._schema.type}},{key:"chunks",value:function(){return Array.from(this._store.chunks())}},{key:"cleanupRemovedChunks",value:function(){return this._store.cleanupRemovedChunks()}},{key:"onSubscribe",value:function(e){var t,r=this;this._connection.onEvent({type:"subscribe",tile:e.tile.id});var n=null===(t=this._strategy)||void 0===t?void 0:t.load(e);n&&(n.then((function(){return r._connection.onEvent({type:"loaded",tile:e.tile.id})})).catch((function(t){return r._connection.onEvent({type:"error",tile:e.tile.id,error:t})})),this._updateTracking.addPromise(n))}},{key:"onResume",value:function(e){var t;this._updateTracking.addPromise((0,d.R8)(null===(t=this._strategy)||void 0===t?void 0:t.load(e)))}},{key:"onUnsubscribe",value:function(e){var t;this._connection.onEvent({type:"unsubscribe",tile:e.tile.id}),null===(t=this._strategy)||void 0===t||t.unload(e)}},{key:"getLocalEdit",value:function(e){return this._updateTracking.addPromise(this._getGetLocalEdit(e))}},{key:"applyLocalEdit",value:function(e){this._didInvalidateData=!0,this._store.applyLocalEdit(e,this.metadata)}},{key:"update",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=t.source,o=(0,S.Hg)(null===(n=this._schema)||void 0===n?void 0:n.mutable,u.mutable)){e.next=3;break}return e.abrupt("return",!1);case 3:if((0,l.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(r,"] FeatureSource.update"),{changes:o}),this._schema=u,null!==(a=this._queryEngine)&&void 0!==a&&a.destroy(),this._queryEngine=null,"feature-service"===this.service.type&&null!=this.service.queryMetadata.lastEditDate&&(this._lastEditDate=this.service.queryMetadata.lastEditDate),null==this._streamMessenger&&"stream"===this._schema.type&&this._initStreamMessenger(),!(0,S.$c)(o,"sourceRefreshVersion")||null===(s=this._strategy)||void 0===s||!s.refresh){e.next=7;break}return e.next=6,this._strategy.refresh();case 6:return e.abrupt("return",!0);case 7:if("feature"!==u.type||!(0,S.$c)(o,"availableFields")){e.next=30;break}return e.next=10,this._queryLastEditDateChanged();case 10:if(e.t0=e.sent,e.t0){e.next=13;break}e.t0=this._didInvalidateData;case 13:if(!e.t0){e.next=19;break}return this._didInvalidateData=!1,e.next=17,this._updateStrategy(r);case 17:e.next=29;break;case 19:return this._connection.onEvent({type:"updateFieldsStart"}),e.prev=20,e.next=23,this._strategy.updateFields(u.mutable.availableFields);case 23:this._connection.onEvent({type:"updateFieldsEnd"}),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(20),this._connection.onEvent({type:"updateFieldsError",error:e.t1});case 29:return e.abrupt("return",!1);case 30:if(e.t2=!(!(0,S.jW)(o,"dataFilter")&&!(0,S.jW)(o,"sourceRefreshVersion")),!e.t2){e.next=35;break}return e.next=34,this._updateStrategy(r);case 34:e.t2=!0;case 35:return e.abrupt("return",e.t2);case 36:case"end":return e.stop()}}),e,this,[[20,26]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_initStreamMessenger",value:function(){null==this._streamMessenger&&(this._streamMessenger=new Mt(this._connection))}},{key:"_getGetLocalEdit",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.historicMoment&&"feature"===this._schema.type&&(this._schema.mutable.dataFilter.historicMoment=t.historicMoment,this._strategy.unsafeSetQueryHistoricMoment(new Date(t.historicMoment))),"edit-by-feature"!==t.type){e.next=3;break}return r=[].concat((0,C.Z)(t.added),(0,C.Z)(t.updated)).map((function(e){return ue.u_.fromJSON(e,s.metadata.objectIdField)})),e.abrupt("return",{reader:we.fromOptimizedFeatures(r,this.metadata),removed:this._resolveIdentifiers(t.removed)});case 3:if(n=this._resolveIdentifiers(t.removed),t.updated.length||t.added.length){e.next=6;break}return e.abrupt("return",{reader:we.empty(this.metadata),removed:n});case 6:return a=this._resolveIdentifiers([].concat((0,C.Z)(t.added),(0,C.Z)(t.updated))),e.next=9,this._strategy.queryByObjectId(a);case 9:return e.t0=e.sent,e.t1=n,e.abrupt("return",{reader:e.t0,removed:e.t1});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_resolveIdentifiers",value:function(e){var t,r=[],i=[],a=(0,n.Z)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;null!=s.objectId&&-1!==s.objectId?i.push(s.objectId):r.push(s.globalId)}}catch(c){a.e(c)}finally{a.f()}if(r.length){var u=new Set(r),o=this.metadata.globalIdField;if(null==o)throw new Error("InternalError: Recieved an edit with globalIds, but not supported by the service");this._store.forEachUnsafe((function(e){var t=e.readAttribute(o);u.has(t)&&i.push(e.getObjectId())}))}return i}},{key:"_queryLastEditDateChanged",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this._lastEditDate){e.next=2;break}return e.abrupt("return",!1);case 2:return t=this.service.source,r=(0,b.Z)((0,b.Z)({},t.query),{},{f:"json"}),e.next=6,(0,vt.Z)(t.path,{query:r,responseType:"json"});case 6:return n=e.sent.data.editingInfo.lastEditDate,e.abrupt("return",n!==this._lastEditDate&&(this._lastEditDate=n,!0));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createStrategy",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,n,a,s,u,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="isSourceHosted"in this.service&&this.service.isSourceHosted,r=Array.isArray(this.service.source),n=this.service.source&&"collection"in this.service.source,a=t||r||n,"stream"!==this._schema.type){e.next=4;break}return s=new vr(this.service,this._schema.mutable.dataFilter,this._store,{outSR:this.service.outSpatialReference},this.metadata),e.abrupt("return",(this._streamMessenger.strategy=s,s));case 4:return u=this.service,o=xt.fromSchema(u,this._schema,this._metadata),e.next=8,this._supportSnapshotMode(u,o);case 8:return c=e.sent,e.abrupt("return",c?new or(u,o,this._store,c.featureCount,this.metadata,this._connection):a?new sr(u,o,this._store,this.metadata,this._connection):new nr(u,o,this._store,this.metadata,this._connection));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateStrategy",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createStrategy();case 2:if(n=e.sent,this._connection.onEvent({type:"updateStrategyStart",about:n.about}),a=!!this._strategy,this._store.clear(),null!==(r=this._strategy)&&void 0!==r&&r.destroy(),this._strategy=n,(0,l.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(t,"] FeatureSource.updateStrategy"),{strategy:n}),(s=Array.from(this._subscriptions.values())).length){e.next=9;break}return e.abrupt("return",void this._connection.onEvent({type:"updateStrategyEnd"}));case 9:if(u=Promise.all(s.map((function(e){return o._strategy.load(e).then((function(){return o._connection.onEvent({type:"loaded",tile:e.tile.id})})).catch((function(t){return o._connection.onEvent({type:"error",tile:e.tile.id,error:t})}))}))),this._updateTracking.addPromise(u),e.prev=11,e.t0=a,!e.t0){e.next=16;break}return e.next=16,u;case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(11),(0,d.H9)(e.t1);case 21:this._connection.onEvent({type:"updateStrategyEnd"}),(0,l.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(t,"] FeatureSource.updateStrategyEnd"),{strategy:n});case 22:case"end":return e.stop()}}),e,this,[[11,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_supportSnapshotMode",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u,o,c,l,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.queryMetadata,(a=n.snapshotInfo)&&a.supportsSnapshotMinThreshold&&a.snapshotCountThresholds){e.next=3;break}return e.abrupt("return",null);case 3:return s=t.source,(u=r.createQuery()).inner.orderByFields=[],u.inner.returnGeometry=!1,e.next=7,(0,pt.hH)(s,u.inner,{query:u.customParameters});case 7:return o=e.sent.data.count,c=a.snapshotCountThresholds,l=c.min,h=c.max,e.abrupt("return",o<=l||a.supportsSnapshotMaxThreshold&&o<h?{featureCount:o}:null);case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),mr=function(){function e(t,r){(0,u.Z)(this,e),this.tile=t,this.version=r,this._abortController=new AbortController}return(0,s.Z)(e,[{key:"key",get:function(){return this.tile.key}},{key:"signal",get:function(){return this._abortController.signal}},{key:"abort",value:function(){this._abortController.abort()}}]),e}(),kr=r(67906),xr=(0,s.Z)((function e(t){(0,u.Z)(this,e),this.inner=t,this.resolver=(0,d.hh)()})),br=function(){function e(){var t=this;(0,u.Z)(this,e),this._aggregateAdapter={getFeatureObjectIds:function(e){return t._processor.getFeatureObjectIdsForAggregate(e)}},this._subscriptions=new Map,this._updateRequested=!1,this._updateSubscriptionRequests=[],this._updateHighlightRequests=[]}return(0,s.Z)(e,[{key:"destroy",value:function(){this._subscriptions.clear(),this._processor.destroy(),this._source.destroy(),this._handles.remove(),this._updateLocalEditsRequest=null,this._tileInfoView=null}},{key:"onAttach",value:function(e){var t=this;(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline.onAttach");var r=this._connection,n=_.Z.fromJSON(e.tileInfoJSON);this._tileInfoView=new g.Z(n),this._source=new gr(e.service,this._aggregateAdapter,this._subscriptions,(function(){return t._requestUpdate()}),r),this._processor=new ft(r,this._source),this._handles=(0,c.AL)([(0,v.watch)((function(){return t._source.updateTracking.updating}),(function(){t._requestUpdate(),(0,d.R8)(t._connection.layerView.setUpdating({data:t._source.updateTracking.updating,pipeline:!0}))}))])}},{key:"onDetach",value:function(){(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline.onDetach"),this.destroy()}},{key:"remoteClient",set:function(e){this._connection=new x(e)}},{key:"features",get:function(){var e,t=null===(e=this._source)||void 0===e?void 0:e.queryEngine;if(!t)throw new o.Z("no-queryEngine","No query engine defined");return t}},{key:"aggregates",get:function(){var e,t=null===(e=this._processor)||void 0===e?void 0:e.aggregateQueryEngine;if(!t)throw new o.Z("no-queryEngine","No aggregate query engine defined");return t}},{key:"processor",get:function(){return this._processor}},{key:"streamMessenger",get:function(){return this._source.streamMessenger}},{key:"getDisplayFeatures",value:function(e){return this._processor.getDisplayFeatures(e)}},{key:"updateSchema",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",((0,l.Z)("esri-2d-update-debug")&&this._updateSchemaRequest&&console.error("InternalError: Schema already updating"),this._updateSchemaRequest=new xr({schema:t,version:r}),this._requestUpdate(),this._updateSchemaRequest.resolver.promise));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateSubscriptions",value:function(e){var t=new xr(e);return this._updateSubscriptionRequests.push(t),this._requestUpdate(),t.resolver.promise}},{key:"updateHighlight",value:function(e){var t=new xr(e);return this._updateHighlightRequests.push(t),this._requestUpdate(),t.resolver.promise}},{key:"onEdits",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this._updateLocalEditsRequest){e.next=2;break}throw new o.Z("InternalError - Already processing an edit");case 2:return this._updateLocalEditsRequest=new xr(t),r=this._updateLocalEditsRequest.resolver.promise,e.abrupt("return",(this._requestUpdate(),r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){return this._source.statistics.toJSON()}},{key:"queryVisibleFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.features.executeQuery(t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryHeatmapStatistics",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,s,u,o,c,l,h,d,f,v,y,_,g,m,x,b,Z,I,w,S,M,C,T,F,O,R,E,q,A,P;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Math.round((0,p.F2)(t.radius)),s=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,o="string"==typeof t.fieldOffset,c=null!==(r=t.fieldOffset)&&void 0!==r?r:0,l=Array.from(this._subscriptions.values()),h=this._source.chunks(),d=Math.pow(a,2),f=3/(Math.PI*d),v=2*a,y=Math.ceil(k.i9/v),_=0,g=l;case 4:if(!(_<g.length)){e.next=43;break}m=g[_],x=m.tile,b=new Float64Array(y*y),Z=(0,n.Z)(h),e.prev=8,Z.s();case 10:if((I=Z.n()).done){e.next=31;break}if(w=I.value,S=w.getTileReader(x)){e.next=15;break}return e.abrupt("continue",29);case 15:M=S.getCursor();case 16:if(!M.next()){e.next=29;break}if(C=1,null!=t.field&&(T=M.readAttribute(t.field),C=o?-1*+T:+T+c),F=M.readXForDisplay()/v,O=M.readYForDisplay()/v,R=Math.floor(F),E=Math.floor(O),!(R<0||E<0||R>=y||E>=y)){e.next=22;break}return e.abrupt("continue",27);case 22:if(!((q=Math.pow((.5+R-F)*v,2)+Math.pow((.5+E-O)*v,2))>d)){e.next=25;break}return e.abrupt("continue",27);case 25:A=C*(f*Math.pow(1-q/d,2)),b[E+R*y]+=A;case 27:e.next=16;break;case 29:e.next=10;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(8),Z.e(e.t0);case 36:return e.prev=36,Z.f(),e.finish(36);case 39:for(P=0;P<b.length;P++)s=Math.min(s,b[P]),u=Math.max(u,b[P]);case 40:_++,e.next=4;break;case 43:return e.abrupt("return",{max:u,min:s});case 44:case"end":return e.stop()}}),e,this,[[8,33,36,39]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSampleFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,u,o,c,l,h,d,v;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=this._source.chunks()).reduce((function(e,t){return e+t.size()}),0)<=t.minFeatureCount)){e.next=6;break}if(this._source.updateTracking.updating){e.next=5;break}return n=[],e.abrupt("return",(this._source.store.forEachUnsafe((function(e){return n.push(e.readLegacyFeatureWorldSpace())})),n));case 5:return e.abrupt("return",null);case 6:a=new Set,s=[],u=r.map((function(e){return e.reader.getCursor()})),o=new f.Z,c=3*t.sampleSize,l=0;case 8:if(!(l<c&&s.length<t.sampleSize)){e.next=19;break}if(0!==(h=u[o.getIntRange(0,r.length-1)]).getSize()){e.next=12;break}return e.abrupt("continue",16);case 12:d=o.getIntRange(0,h.getSize()-1),h.setIndex(d),v=h.getObjectId(),a.has(v)||(a.add(v),s.push(h.readLegacyFeatureWorldSpace()));case 16:l++,e.next=8;break;case 19:return e.abrupt("return",s.length>=t.sampleSize?s:null);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_requestUpdate",value:function(){var e=this;this._updateRequested||(this._updateRequested=!0,(0,h.Y)((function(){return e._scheduleNextUpdate()})))}},{key:"_scheduleNextUpdate",value:function(){var e=this;this._updateRequested&&(this._ongoingUpdate||(this._ongoingUpdate=(0,y.d2)(this._doUpdate()).finally((function(){e._ongoingUpdate=null,e._scheduleNextUpdate()})),this._updateRequested=!1))}},{key:"_subscribe",value:function(e){var t=e.tileId;if(!this._subscriptions.has(t)){(0,l.Z)("esri-2d-update-debug")&&console.debug("Tile[".concat(t,"] Pipeline.subscribe"));var r=new kr.n(this._tileInfoView,t),n=new mr(r,e.version);this._subscriptions.set(t,n),this._source.onSubscribe(n),this._processor.onSubscribe(n)}}},{key:"_unsubscribe",value:function(e){var t=this._subscriptions.get(e);t&&((0,l.Z)("esri-2d-update-debug")&&console.debug("Tile[".concat(e,"] Pipeline.unsubscribe")),t.abort(),this._source.onUnsubscribe(t),this._processor.onUnsubscribe(t),this._subscriptions.delete(t.key.id))}},{key:"_doUpdate",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,a,s,u,o,c,h,f,v,p,y,_,g,m;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateStart"),e.next=3,this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0});case 3:if(!this._updateSubscriptionRequests.length){e.next=8;break}t=this._updateSubscriptionRequests,this._updateSubscriptionRequests=[],r=(0,n.Z)(t);try{for(r.s();!(a=r.n()).done;)s=a.value,this._doUpdateSubscriptions(s.inner),s.resolver.resolve()}catch(i){r.e(i)}finally{r.f()}case 8:if(u=this._updateSchemaRequest,this._updateSchemaRequest=null,null==u){e.next=13;break}return o=u.inner,c=o.schema,h=o.version,e.next=13,this._doUpdateSchema(c,h);case 13:if(f=this._updateLocalEditsRequest,this._updateLocalEditsRequest=null,null==f){e.next=23;break}return(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline.applyEditOverride",f.inner),e.next=18,this._source.getLocalEdit(f.inner);case 18:return v=e.sent,e.next=21,this._processor.applyLocalEdit(v);case 21:this._source.applyLocalEdit(v),(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline.endEditOverride",f.inner);case 23:if(this._updateHighlightRequests.length){p=this._updateHighlightRequests,this._updateHighlightRequests=[],y=(0,n.Z)(p);try{for(y.s();!(_=y.n()).done;)g=_.value,this._processor.updateHighlight(g.inner),g.resolver.resolve()}catch(i){y.e(i)}finally{y.f()}}if(m=this._source.cleanupRemovedChunks(),this._processor.removeChunks(m),e.prev=26,e.t0=this._subscriptions.size,!e.t0){e.next=33;break}return(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksStart"),e.next=32,this._processor.updateChunks();case 32:(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksEnd");case 33:e.next=38;break;case 35:e.prev=35,e.t1=e.catch(26),(0,d.H9)(e.t1);case 38:if(null!=f&&f.resolver.resolve(),null!=u&&u.resolver.resolve(),!this._updateRequested){e.next=46;break}return(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested=true]"),e.next=44,this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:!0});case 44:e.next=49;break;case 46:return(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested=false, After flush]"),e.next=49,this._connection.layerView.setUpdating({data:this._source.updateTracking.updating,pipeline:this._updateRequested});case 49:case"end":return e.stop()}}),e,this,[[26,35]])})));return function(){return e.apply(this,arguments)}}()},{key:"_doUpdateSchema",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,l.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(r,"] Pipeline.updateStart"),{schema:t}),a={tileInfo:null===(n=this._tileInfoView)||void 0===n?void 0:n.tileInfo},e.next=4,this._source.update(t,r);case 4:return s=e.sent,u=Array.from(this._subscriptions.values()),e.next=8,this._processor.update(t,r,a,s,u);case 8:(0,l.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(r,"] Pipeline.updateEnd"));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_doUpdateSubscriptions",value:function(e){(0,l.Z)("esri-2d-update-debug")&&console.debug("Pipeline.updateSubscriptions",e);var t,r=(0,n.Z)(e.subscribe);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._subscribe(i)}}catch(o){r.e(o)}finally{r.f()}var a,s=(0,n.Z)(e.unsubscribe);try{for(s.s();!(a=s.n()).done;){var u=a.value;this._unsubscribe(u)}}catch(o){s.e(o)}finally{s.f()}}}]),e}()},67906:function(e,t,r){r.d(t,{n:function(){return l}});var n=r(15671),i=r(43144),a=r(22213),s=r(53866),u=r(65156),o=r(94618),c=r(73828),l=function(){function e(t,r){(0,n.Z)(this,e),this.key=new c.Z(0,0,0,0),this.bounds=(0,u.Ue)(),this.objectIds=new Set,this.key.set(r);var i=t.getLODInfoAt(this.key);this.tileInfoView=t,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.level=i.level,this.scale=i.scale,this.minScale=t.zoomToScale(i.level-1),this.maxScale=t.zoomToScale(i.level+1)}return(0,i.Z)(e,[{key:"lod",get:function(){return this.tileInfoView.getLODInfoAt(this.key)}},{key:"id",get:function(){return this.key.id}},{key:"extent",get:function(){return s.Z.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}},{key:"transform",get:function(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}},{key:"createArcadeEvaluationOptions",value:function(e){return{$view:{scale:this.scale,timeZone:e}}}},{key:"createChildTiles",value:function(){for(var t=this.key.getChildKeys(),r=a.Z.acquire(),n=0;n<t.length;n++)r[n]=new e(this.tileInfoView,t[n]);return r}},{key:"getQuantizationParameters",value:function(){return o.Z.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}]),e}()},35092:function(e,t,r){function n(e,t,r,n){var i=e.clone(),a=1<<i.level,s=i.col+t,u=i.row+r;return n&&s<0?(i.col=s+a,i.world-=1):s>=a?(i.col=s-a,i.world+=1):i.col=s,i.row=u,i}r.d(t,{M:function(){return n}})},64634:function(e,t,r){r.d(t,{Z:function(){return f}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),u=r(27366),o=r(51995),c=r(7138),l=r(49861),h=(r(93169),r(32718),r(84936),r(69912)),d=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).color=new o.Z([0,255,255]),e.haloOpacity=1,e.fillOpacity=.25,e.multiHighlightEnabled=!1,e}return(0,i.Z)(r,[{key:"equals",value:function(e){return this.color.equals(e.color)&&(this.haloColor||this.color).equals(e.haloColor||e.color)&&this.haloOpacity===e.haloOpacity&&this.fillOpacity===e.fillOpacity&&this.multiHighlightEnabled===e.multiHighlightEnabled}}]),r}(c.default);(0,u._)([(0,l.Cb)({type:o.Z})],d.prototype,"color",void 0),(0,u._)([(0,l.Cb)({type:o.Z})],d.prototype,"haloColor",void 0),(0,u._)([(0,l.Cb)()],d.prototype,"haloOpacity",void 0),(0,u._)([(0,l.Cb)()],d.prototype,"fillOpacity",void 0),(0,u._)([(0,l.Cb)()],d.prototype,"multiHighlightEnabled",void 0);var f=d=(0,u._)([(0,h.j)("esri.views.2d.support.HighlightOptions")],d)},61109:function(e,t,r){r.d(t,{G:function(){return a}});var n=r(43144),i=r(15671),a=(0,n.Z)((function e(t,r,n,a,s){var u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(0,i.Z)(this,e),this.name=t,this.count=r,this.type=n,this.offset=a,this.stride=s,this.normalized=u,this.divisor=o}))}}]);
//# sourceMappingURL=70492.40d4b290.chunk.js.map