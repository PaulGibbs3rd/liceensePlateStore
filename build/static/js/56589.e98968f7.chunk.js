"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[56589,18277,92463,15440,2170],{84506:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(83878),i=n(59199),a=n(40181),o=n(25267);function s(e){return(0,r.Z)(e)||(0,i.Z)(e)||(0,a.Z)(e)||(0,o.Z)()}},46798:function(e,t,n){n.d(t,{q:function(){return p}});var r=n(37762),i=n(1413),a=n(15671),o=n(43144),s=n(63780),l=n(42537),u=n(32718),c=n(66978),d=n(70431),p=function(){function e(t,n,o,s){var l=this,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};(0,a.Z)(this,e),this._mainMethod=n,this._transferLists=o,this._listeners=[],this._promise=(0,d.bA)(t,(0,i.Z)((0,i.Z)({},c),{},{schedule:s})).then((function(e){if(void 0===l._thread){l._thread=e,l._promise=null,c.hasInitialize&&l.broadcast({},"initialize");var t,n=(0,r.Z)(l._listeners);try{for(n.s();!(t=n.n()).done;){var i=t.value;l._connectListener(i)}}catch(a){n.e(a)}finally{n.f()}}else e.close()})),this._promise.catch((function(e){return u.Z.getLogger("esri.core.workers.WorkerHandle").error("Failed to initialize ".concat(t," worker: ").concat(e))}))}return(0,o.Z)(e,[{key:"on",value:function(e,t){var n=this,r={removed:!1,eventName:e,callback:t,threadHandle:null};return this._listeners.push(r),this._connectListener(r),(0,l.kB)((function(){r.removed=!0,(0,s.Od)(n._listeners,r),n._thread&&null!=r.threadHandle&&r.threadHandle.remove()}))}},{key:"destroy",value:function(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}},{key:"invoke",value:function(e,t){return this.invokeMethod(this._mainMethod,e,t)}},{key:"invokeMethod",value:function(e,t,n){var r=this;if(this._thread){var i=this._transferLists[e],a=i?i(t):[];return this._thread.invoke(e,t,{transferList:a,signal:n})}return this._promise?this._promise.then((function(){return(0,c.k_)(n),r.invokeMethod(e,t,n)})):Promise.reject(null)}},{key:"broadcast",value:function(e,t){var n=this;return this._thread?Promise.all(this._thread.broadcast(t,e)).then((function(){})):this._promise?this._promise.then((function(){return n.broadcast(e,t)})):Promise.reject()}},{key:"promise",get:function(){return this._promise}},{key:"_connectListener",value:function(e){this._thread&&this._thread.on(e.eventName,e.callback).then((function(t){e.removed||(e.threadHandle=t)}))}}]),e}()},42137:function(e,t,n){n.d(t,{Z:function(){return Z}});var r,i=n(1413),a=n(15671),o=n(43144),s=n(88301),l=n(61120),u=n(60136),c=n(29388),d=n(27366),p=n(68860),h=n(49861),v=(n(93169),n(32718),n(84936),n(69912)),f=n(83448),m=n(848),y=n(80885),g=n(78952),b=n(15559),w=n(81753),_=n(89093),C=r=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;(0,a.Z)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).center=null,e.geodesic=!1,e.numberOfPoints=60,e.radius=1e3,e.radiusUnit="meters",e}return(0,o.Z)(n,[{key:"normalizeCtorArgs",value:function(e,t){var r;if(null!==e&&void 0!==e&&e.center)r=e;else{if(null!==e&&void 0!==e&&e.rings)return(0,s.Z)((0,l.Z)(n.prototype),"normalizeCtorArgs",this).call(this,e,t);r={center:e}}return(0,i.Z)((0,i.Z)((0,i.Z)({},(0,s.Z)((0,l.Z)(n.prototype),"normalizeCtorArgs",this).call(this)),r),t)}},{key:"initialize",value:function(){var e,t=this.center,n=this.numberOfPoints;if(this.hasZ=null!==(e=null===t||void 0===t?void 0:t.hasZ)&&void 0!==e&&e,0===this.rings.length&&t){var r,i=(0,p.En)(this.radius,this.radiusUnit,"meters"),a=t.spatialReference,o="geographic";if(a.isWebMercator?o="webMercator":(null!=(a.wkid&&_.Z[a.wkid])||(a.wkt2||a.wkt)&&(0,p.s_)(a.wkt2||a.wkt))&&(o="projected"),this.geodesic){var s;switch(o){case"webMercator":s=(0,w.Sx)(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":s=t}r=this._createGeodesicCircle(s,i,n),"webMercator"===o&&(r=(0,w.$)(r))}else{var l;"webMercator"===o||"projected"===o?l=i/(0,p.Z7)(t.spatialReference):"geographic"===o&&(l=(0,p.ty)(i,"meters",(0,f.Iu)(t.spatialReference).radius)),r=this._createPlanarCircle(t,l,n)}this.spatialReference=r.spatialReference,this.addRing(r.rings[0])}}},{key:"clone",value:function(){var e=this.center,t=this.numberOfPoints,n=this.radius,i=this.radiusUnit,a=this.geodesic;return new r({center:null===e||void 0===e?void 0:e.clone(),numberOfPoints:t,radius:n,radiusUnit:i,geodesic:a})}},{key:"_createGeodesicCircle",value:function(e,t,n){for(var r=0,i=[];r<360;){var a=[0,0],o=[e.x,e.y];(0,b.TB)(a,o,r,t,g.Z.WGS84),this.hasZ&&a.push(e.z),i.push(a),r+=360/n}return i.push(i[0]),new y.Z(i)}},{key:"_createPlanarCircle",value:function(e,t,n){for(var r=[],i=2*Math.PI/n,a=0;a<n;++a){var o=i*a,s=[e.x+Math.cos(-o)*t,e.y+Math.sin(-o)*t];this.hasZ&&s.push(e.z),r.push(s)}return r.push(r[0]),new y.Z({spatialReference:e.spatialReference,rings:[r]})}}]),n}(y.Z);(0,d._)([(0,h.Cb)({type:m.Z})],C.prototype,"center",void 0),(0,d._)([(0,h.Cb)()],C.prototype,"geodesic",void 0),(0,d._)([(0,h.Cb)()],C.prototype,"numberOfPoints",void 0),(0,d._)([(0,h.Cb)()],C.prototype,"radius",void 0),(0,d._)([(0,h.Cb)()],C.prototype,"radiusUnit",void 0);var Z=C=r=(0,d._)([(0,v.j)("esri.geometry.Circle")],C)},92463:function(e,t,n){n.r(t),n.d(t,{hydratedAdapter:function(){return l}});var r=n(53866),i=n(77577),a=n(848),o=n(80885),s=n(29909),l={convertToGEGeometry:function(e,t){if(null==t)return null;var n="cache"in t?t.cache._geVersion:void 0;return null==n&&(n=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=n)),n},exportPoint:function(e,t,n){var r=e.hasZ(t),i=e.hasM(t),o=new a.Z({x:e.getPointX(t),y:e.getPointY(t),spatialReference:n});return r&&(o.z=e.getPointZ(t)),i&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o},exportPolygon:function(e,t,n){var r=new o.Z({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return r.cache._geVersion=t,r},exportPolyline:function(e,t,n){var r=new s.Z({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return r.cache._geVersion=t,r},exportMultipoint:function(e,t,n){var r=new i.Z({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:n});return r.cache._geVersion=t,r},exportExtent:function(e,t,n){var i=e.hasZ(t),a=e.hasM(t),o=new r.Z({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:n});if(i){var s=e.getZExtent(t);o.zmin=s.vmin,o.zmax=s.vmax}if(a){var l=e.getMExtent(t);o.mmin=l.vmin,o.mmax=l.vmax}return o.cache._geVersion=t,o}}},2170:function(e,t,n){n.r(t),n.d(t,{buffer:function(){return z},changeDefaultSpatialReferenceTolerance:function(){return Q},clearDefaultSpatialReferenceTolerance:function(){return J},clip:function(){return p},contains:function(){return v},convexHull:function(){return k},crosses:function(){return f},cut:function(){return h},densify:function(){return G},difference:function(){return I},disjoint:function(){return _},distance:function(){return m},equals:function(){return y},extendedSpatialReferenceInfo:function(){return d},flipHorizontal:function(){return D},flipVertical:function(){return L},generalize:function(){return j},geodesicArea:function(){return q},geodesicBuffer:function(){return O},geodesicDensify:function(){return H},geodesicLength:function(){return U},intersect:function(){return P},intersectLinesToPoints:function(){return K},intersects:function(){return g},isSimple:function(){return x},nearestCoordinate:function(){return A},nearestVertex:function(){return V},nearestVertices:function(){return T},offset:function(){return R},overlaps:function(){return C},planarArea:function(){return W},planarLength:function(){return B},relate:function(){return Z},rotate:function(){return N},simplify:function(){return M},symmetricDifference:function(){return S},touches:function(){return b},union:function(){return F},within:function(){return w}});var r=n(43144),i=n(15671),a=n(60136),o=n(29388),s=n(28664),l=n(99058),u=n(92463);function c(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function d(e){return l.G.extendedSpatialReferenceInfo(e)}function p(e,t){return l.G.clip(u.hydratedAdapter,c(e),e,t)}function h(e,t){return l.G.cut(u.hydratedAdapter,c(e),e,t)}function v(e,t){return l.G.contains(u.hydratedAdapter,c(e),e,t)}function f(e,t){return l.G.crosses(u.hydratedAdapter,c(e),e,t)}function m(e,t,n){return l.G.distance(u.hydratedAdapter,c(e),e,t,n)}function y(e,t){return l.G.equals(u.hydratedAdapter,c(e),e,t)}function g(e,t){return l.G.intersects(u.hydratedAdapter,c(e),e,t)}function b(e,t){return l.G.touches(u.hydratedAdapter,c(e),e,t)}function w(e,t){return l.G.within(u.hydratedAdapter,c(e),e,t)}function _(e,t){return l.G.disjoint(u.hydratedAdapter,c(e),e,t)}function C(e,t){return l.G.overlaps(u.hydratedAdapter,c(e),e,t)}function Z(e,t,n){return l.G.relate(u.hydratedAdapter,c(e),e,t,n)}function x(e){return l.G.isSimple(u.hydratedAdapter,c(e),e)}function M(e){return l.G.simplify(u.hydratedAdapter,c(e),e)}function k(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.G.convexHull(u.hydratedAdapter,c(e),e,t)}function I(e,t){return l.G.difference(u.hydratedAdapter,c(e),e,t)}function S(e,t){return l.G.symmetricDifference(u.hydratedAdapter,c(e),e,t)}function P(e,t){return l.G.intersect(u.hydratedAdapter,c(e),e,t)}function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return l.G.union(u.hydratedAdapter,c(e),e,t)}function R(e,t,n,r,i,a){return l.G.offset(u.hydratedAdapter,c(e),e,t,n,r,i,a)}function z(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return l.G.buffer(u.hydratedAdapter,c(e),e,t,n,r)}function O(e,t,n,r,i,a){return l.G.geodesicBuffer(u.hydratedAdapter,c(e),e,t,n,r,i,a)}function A(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return l.G.nearestCoordinate(u.hydratedAdapter,c(e),e,t,n)}function V(e,t){return l.G.nearestVertex(u.hydratedAdapter,c(e),e,t)}function T(e,t,n,r){return l.G.nearestVertices(u.hydratedAdapter,c(e),e,t,n,r)}function E(e){var t,n;return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e&&null!==(t=null===(n=e.extent)||void 0===n?void 0:n.center)&&void 0!==t?t:null}function N(e,t,n){var r;if(null==e)throw new Y;var i=e.spatialReference;if(null==(n=null!==(r=n)&&void 0!==r?r:E(e)))throw new Y;var a=e.constructor.fromJSON(l.G.rotate(e,t,n));return a.spatialReference=i,a}function D(e,t){var n;if(null==e)throw new Y;var r=e.spatialReference;if(null==(t=null!==(n=t)&&void 0!==n?n:E(e)))throw new Y;var i=e.constructor.fromJSON(l.G.flipHorizontal(e,t));return i.spatialReference=r,i}function L(e,t){var n;if(null==e)throw new Y;var r=e.spatialReference;if(null==(t=null!==(n=t)&&void 0!==n?n:E(e)))throw new Y;var i=e.constructor.fromJSON(l.G.flipVertical(e,t));return i.spatialReference=r,i}function j(e,t,n,r){return l.G.generalize(u.hydratedAdapter,c(e),e,t,n,r)}function G(e,t,n){return l.G.densify(u.hydratedAdapter,c(e),e,t,n)}function H(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return l.G.geodesicDensify(u.hydratedAdapter,c(e),e,t,n,r)}function W(e,t){return l.G.planarArea(u.hydratedAdapter,c(e),e,t)}function B(e,t){return l.G.planarLength(u.hydratedAdapter,c(e),e,t)}function q(e,t,n){return l.G.geodesicArea(u.hydratedAdapter,c(e),e,t,n)}function U(e,t,n){return l.G.geodesicLength(u.hydratedAdapter,c(e),e,t,n)}function K(e,t){return l.G.intersectLinesToPoints(u.hydratedAdapter,c(e),e,t)}function Q(e,t){l.G.changeDefaultSpatialReferenceTolerance(e,t)}function J(e){l.G.clearDefaultSpatialReferenceTolerance(e)}var Y=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.call(this,"Illegal Argument Exception")}return(0,r.Z)(n)}((0,s.Z)(Error))},15559:function(e,t,n){n.d(t,{Gb:function(){return m},Jf:function(){return g},Lc:function(){return Z},TB:function(){return _},_q:function(){return w},cA:function(){return C},j2:function(){return b},p8:function(){return y}});var r=n(43144),i=n(15671),a=n(37762),o=(n(59486),n(10064)),s=n(68860),l=n(38516),u=n(92975),c=n(29909),d=n(80885),p=(n(848),n(78952));function h(e){if(!e)return null;if((0,u.sT)(e)&&e.wkid){var t=l.Dg[e.wkid];if(t)return t}var n=e.wkt2||e.wkt;if(n){var r=function(e){var t=l.FQ.exec(e);if(!t||2!==t.length)return null;var n=t[1].split(",");if(!n||n.length<3)return null;var r=parseFloat(n[1]),i=parseFloat(n[2]);return isNaN(r)||isNaN(i)?null:{a:r,f:0===i?0:1/i}}(n);if(r)return r}return null}function v(e){var t=h(e);if(function(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}(t))return t;var n=t.a*(1-t.f);return Object.assign(t,{b:n,eSq:1-Math.pow(n/t.a,2),radius:(2*t.a+n)/3,densificationRatio:1e4/((2*t.a+n)/3)})}function f(e,t,n){var r,i=v(n),a=i.a,o=i.eSq,s=Math.sqrt(o),u=Math.sin(t[1]*l.Yr),c=a*t[0]*l.Yr;return r=o>0?a*((1-o)*(u/(1-o*(u*u))-1/(2*s)*Math.log((1-s*u)/(1+s*u))))*.5:a*u,e[0]=c,e[1]=r,e}function m(e){return null!==h(e)}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"square-meters";if(e.some((function(e){return!m(e.spatialReference)})))throw new o.Z("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var n=[],r=0;r<e.length;r++){var i=e[r],a=i.spatialReference,l=v(a),u=l.radius,c=l.densificationRatio,d=u*c;n.push(b(i,d))}for(var p=[],h=[0,0],y=[0,0],g=0;g<n.length;g++){for(var w=n[g],_=w.rings,C=w.spatialReference,Z=0,x=0;x<_.length;x++){var M=_[x];f(h,M[0],C),f(y,M[M.length-1],C);for(var k=y[0]*h[1]-h[0]*y[1],I=0;I<M.length-1;I++)f(h,M[I+1],C),f(y,M[I],C),k+=y[0]*h[1]-h[0]*y[1];Z+=k}Z=(0,s.En)(Z,"square-meters",t),p.push(Z/-2)}return p}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"meters";if(!e)throw new o.Z("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some((function(e){return!m(e.spatialReference)})))throw new o.Z("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var n=[],r=0;r<e.length;r++){for(var i=e[r],a=i.spatialReference,l="polyline"===i.type?i.paths:i.rings,u=0,c=0;c<l.length;c++){for(var d=l[c],p=0,h=1;h<d.length;h++){var v=d[h-1][0],f=d[h][0],y=d[h-1][1],g=d[h][1];if(y!==g||v!==f){var b=new w;C(b,[v,y],[f,g],a),p+=b.distance}}u+=p}u=(0,s.En)(u,"meters",t),n.push(u)}return n}function b(e,t){if("polyline"!==e.type&&"polygon"!==e.type)throw new o.Z("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");var n=e.spatialReference;if(!m(n))throw new o.Z("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");var r,i="polyline"===e.type?e.paths:e.rings,s=[],l=[0,0],u=new w,p=(0,a.Z)(i);try{for(p.s();!(r=p.n()).done;){var h=r.value,v=[];s.push(v),v.push([h[0][0],h[0][1]]);for(var f=void 0,y=void 0,g=h[0][0],b=h[0][1],Z=0;Z<h.length-1;Z++)if(f=h[Z+1][0],y=h[Z+1][1],g!==f||b!==y){var x=[g,b];C(u,[g,b],[f,y],n);var M=u.azimuth,k=u.distance,I=k/t;if(I>1){for(var S=1;S<=I-1;S++)_(l,x,M,S*t,n),v.push(l.slice(0));_(l,x,M,(k+Math.floor(I-1)*t)/2,n),v.push(l.slice(0))}_(l,x,M,k,n),v.push(l.slice(0)),g=l[0],b=l[1]}}}catch(P){p.e(P)}finally{p.f()}return"polyline"===e.type?new c.Z({paths:s,spatialReference:n}):new d.Z({rings:s,spatialReference:n})}var w=(0,r.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;(0,i.Z)(this,e),this.distance=t,this.azimuth=n,this.reverseAzimuth=r}));function _(e,t,n,r,i){for(var a,o,s,u=t[0],c=t[1],d=u*l.Yr,p=c*l.Yr,h=(null!==n&&void 0!==n?n:0)*l.Yr,f=v(i),m=f.a,y=f.b,g=f.f,b=Math.sin(h),w=Math.cos(h),_=(1-g)*Math.tan(p),C=1/Math.sqrt(1+_*_),Z=_*C,x=Math.atan2(_,w),M=C*b,k=M*M,I=1-k,S=I*(m*m-y*y)/(y*y),P=1+S/16384*(4096+S*(S*(320-175*S)-768)),F=S/1024*(256+S*(S*(74-47*S)-128)),R=r/(y*P),z=2*Math.PI;Math.abs(R-z)>1e-12;)s=Math.cos(2*x+R),z=R,R=r/(y*P)+F*(a=Math.sin(R))*(s+F/4*((o=Math.cos(R))*(2*s*s-1)-F/6*s*(4*a*a-3)*(4*s*s-3)));var O=Z*a-C*o*w,A=Math.atan2(Z*o+C*a*w,(1-g)*Math.sqrt(k+O*O)),V=Math.atan2(a*b,C*o-Z*a*w),T=g/16*I*(4+g*(4-3*I)),E=A/l.Yr,N=(d+(V-(1-T)*g*M*(R+T*a*(s+T*o*(2*s*s-1)))))/l.Yr;return e[0]=N,e[1]=E,e}function C(e,t,n,r){var i,a,o,s,u,c,d,p,h,f,m=t[0]*l.Yr,y=t[1]*l.Yr,g=n[0]*l.Yr,b=n[1]*l.Yr,w=v(r),_=w.a,C=w.b,Z=w.f,x=w.radius,M=g-m,k=Math.atan((1-Z)*Math.tan(y)),I=Math.atan((1-Z)*Math.tan(b)),S=Math.sin(k),P=Math.cos(k),F=Math.sin(I),R=Math.cos(I),z=1e3,O=M;do{if(d=Math.sin(O),p=Math.cos(O),0===(o=Math.sqrt(R*d*(R*d)+(P*F-S*R*p)*(P*F-S*R*p))))return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;u=S*F+P*R*p,c=Math.atan2(o,u),s=u-2*S*F/(a=1-(h=P*R*d/o)*h),isNaN(s)&&(s=0),i=O,O=M+(1-(f=Z/16*a*(4+Z*(4-3*a))))*Z*h*(c+f*o*(s+f*u*(2*s*s-1)))}while(Math.abs(O-i)>1e-12&&--z>0);if(0===z){var A=x,V=Math.acos(Math.sin(y)*Math.sin(b)+Math.cos(y)*Math.cos(b)*Math.cos(g-m))*A,T=g-m,E=Math.sin(T)*Math.cos(b),N=Math.cos(y)*Math.sin(b)-Math.sin(y)*Math.cos(b)*Math.cos(T),D=Math.atan2(E,N);return e.azimuth=D/l.Yr,e.distance=V,e.reverseAzimuth=void 0,e}var L=a*(_*_-C*C)/(C*C),j=L/1024*(256+L*(L*(74-47*L)-128)),G=C*(1+L/16384*(4096+L*(L*(320-175*L)-768)))*(c-j*o*(s+j/4*(u*(2*s*s-1)-j/6*s*(4*o*o-3)*(4*s*s-3)))),H=Math.atan2(R*Math.sin(O),P*F-S*R*Math.cos(O)),W=Math.atan2(P*Math.sin(O),P*F*Math.cos(O)-S*R);return e.azimuth=H/l.Yr,e.distance=G,e.reverseAzimuth=W/l.Yr,e}function Z(e){return m(e)?e:(0,u.sS)(e)?p.Z.WGS84:null}},42785:function(e,t,n){n.r(t),n.d(t,{default:function(){return R}});var r=n(74165),i=n(15861),a=n(1413),o=n(15671),s=n(43144),l=n(60136),u=n(29388),c=n(27366),d=n(76200),p=n(10064),h=n(92026),v=n(97642),f=n(66978),m=n(35995),y=n(49861),g=(n(93169),n(32718),n(84936),n(38511)),b=n(69912),w=n(90724),_=n(30651),C=n(17775),Z=n(11936),x=n(6061),M=n(29598),k=n(70361),I=n(48932),S=n(41665),P=function(e){(0,l.Z)(c,e);var t=(0,u.Z)(c);function c(){var e;(0,o.Z)(this,c);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).capabilities={operations:{supportsTileMap:!1}},e.copyright=null,e.heightModelInfo=null,e.path=null,e.minScale=void 0,e.maxScale=void 0,e.opacity=1,e.operationalLayerType="ArcGISTiledElevationServiceLayer",e.sourceJSON=null,e.type="elevation",e.url=null,e.version=null,e._lercDecoder=(0,S.w)(),e}return(0,s.Z)(c,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?(0,a.Z)({url:e},t):e}},{key:"destroy",value:function(){this._lercDecoder=(0,h.RY)(this._lercDecoder)}},{key:"readCapabilities",value:function(e,t){var n=t.capabilities&&t.capabilities.split(",").map((function(e){return e.toLowerCase().trim()}));return n?{operations:{supportsTileMap:n.includes("tilemap")}}:{operations:{supportsTileMap:!1}}}},{key:"readVersion",value:function(e,t){var n=t.currentVersion;return n||(n=9.3),n}},{key:"load",value:function(e){var t=this,n=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(e){if(e.typeKeywords)for(var t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new p.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).catch(f.r9).then((function(){return t._fetchImageService(n)}))),Promise.resolve(this)}},{key:"fetchTile",value:function(e,t,n,r){var i=this,a=null!=(r=r||{signal:null}).signal?r.signal:r.signal=(new AbortController).signal,o={responseType:"array-buffer",signal:a},s={noDataValue:r.noDataValue,returnFileInfo:!0};return this.load().then((function(){return i._fetchTileAvailability(e,t,n,r)})).then((function(){return(0,d.Z)(i.getTileUrl(e,t,n),o)})).then((function(e){return i._lercDecoder.decode(e.data,s,a)})).then((function(e){return new I.v(e)}))}},{key:"getTileUrl",value:function(e,t,n){var r=!this.capabilities.operations.supportsTileMap&&this.supportsBlankTile,i=(0,m.B7)((0,a.Z)((0,a.Z)({},this.parsedUrl.query),{},{blankTile:!r&&null}));return"".concat(this.parsedUrl.path,"/tile/").concat(e,"/").concat(t,"/").concat(n).concat(i?"?"+i:"")}},{key:"queryElevation",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,i){var a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(77043).then(n.bind(n,77043));case 2:return a=e.sent,o=a.ElevationQuery,(0,f.k_)(i),e.abrupt("return",(new o).query(this,t,i));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createElevationSampler",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,i){var a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(77043).then(n.bind(n,77043));case 2:return a=e.sent,o=a.ElevationQuery,(0,f.k_)(i),e.abrupt("return",(new o).createSampler(this,t,i));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_fetchTileAvailability",value:function(e,t,n,r){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,n,r):Promise.resolve("unknown")}},{key:"_fetchImageService",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.sourceJSON){e.next=2;break}return e.abrupt("return",this.sourceJSON);case 2:return i={query:(0,a.Z)({f:"json"},this.parsedUrl.query),responseType:"json",signal:t},e.next=5,(0,d.Z)(this.parsedUrl.path,i);case 5:(o=e.sent).ssl&&(this.url=null===(n=this.url)||void 0===n?void 0:n.replace(/^http:/i,"https:")),this.sourceJSON=o.data,this.read(o.data,{origin:"service",url:this.parsedUrl});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile[F]}}]),c}((0,C.Z)((0,Z.Y)((0,x.q)((0,M.I)((0,v.R)(_.Z))))));(0,c._)([(0,y.Cb)({readOnly:!0})],P.prototype,"capabilities",void 0),(0,c._)([(0,g.r)("service","capabilities",["capabilities"])],P.prototype,"readCapabilities",null),(0,c._)([(0,y.Cb)({json:{read:{source:"copyrightText"}}})],P.prototype,"copyright",void 0),(0,c._)([(0,y.Cb)({readOnly:!0,type:w.Z})],P.prototype,"heightModelInfo",void 0),(0,c._)([(0,y.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],P.prototype,"path",void 0),(0,c._)([(0,y.Cb)({type:["show","hide"]})],P.prototype,"listMode",void 0),(0,c._)([(0,y.Cb)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],P.prototype,"minScale",void 0),(0,c._)([(0,y.Cb)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],P.prototype,"maxScale",void 0),(0,c._)([(0,y.Cb)({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],P.prototype,"opacity",void 0),(0,c._)([(0,y.Cb)({type:["ArcGISTiledElevationServiceLayer"]})],P.prototype,"operationalLayerType",void 0),(0,c._)([(0,y.Cb)()],P.prototype,"sourceJSON",void 0),(0,c._)([(0,y.Cb)({json:{read:!1},value:"elevation",readOnly:!0})],P.prototype,"type",void 0),(0,c._)([(0,y.Cb)(k.HQ)],P.prototype,"url",void 0),(0,c._)([(0,y.Cb)()],P.prototype,"version",void 0),(0,c._)([(0,g.r)("version",["currentVersion"])],P.prototype,"readVersion",null),P=(0,c._)([(0,b.j)("esri.layers.ElevationLayer")],P);var F=Symbol("default-fetch-tile");P.prototype.fetchTile[F]=!0;var R=P},93655:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var r=n(15671),i=n(43144),a=n(88301),o=n(61120),s=n(60136),l=n(29388),u=n(27366),c=n(49861),d=(n(93169),n(32718),n(84936),n(69912)),p=n(68748),h=n(30651),v=n(6693),f=n(56811),m=n(78983),y=n(64575),g=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).elevationInfo=null,i.graphics=new m.J,i.screenSizePerspectiveEnabled=!0,i.type="graphics",i.internal=!1,i}return(0,i.Z)(n,[{key:"destroy",value:function(){this.removeAll(),this.graphics.destroy()}},{key:"add",value:function(e){return this.graphics.add(e),this}},{key:"addMany",value:function(e){return this.graphics.addMany(e),this}},{key:"removeAll",value:function(){return this.graphics.removeAll(),this}},{key:"remove",value:function(e){this.graphics.remove(e)}},{key:"removeMany",value:function(e){this.graphics.removeMany(e)}},{key:"on",value:function(e,t){return(0,a.Z)((0,o.Z)(n.prototype),"on",this).call(this,e,t)}},{key:"graphicChanged",value:function(e){this.emit("graphic-update",e)}}]),n}((0,v.h7)((0,f.M)(h.Z)));(0,u._)([(0,c.Cb)({type:y.Z})],g.prototype,"elevationInfo",void 0),(0,u._)([(0,c.Cb)((0,p.z)(m.J,"graphics"))],g.prototype,"graphics",void 0),(0,u._)([(0,c.Cb)({type:["show","hide"]})],g.prototype,"listMode",void 0),(0,u._)([(0,c.Cb)()],g.prototype,"screenSizePerspectiveEnabled",void 0),(0,u._)([(0,c.Cb)({readOnly:!0})],g.prototype,"type",void 0),(0,u._)([(0,c.Cb)({constructOnly:!0})],g.prototype,"internal",void 0);var b=g=(0,u._)([(0,d.j)("esri.layers.GraphicsLayer")],g)},15440:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var r=n(1413),i=n(15671),a=n(43144),o=n(88301),s=n(61120),l=n(60136),u=n(29388),c=n(27366),d=n(10064),p=n(43404),h=n(49861),v=n(89125),f=n(69912),m=n(64326),y=n(63967);function g(e,t,n){return{name:"orientedImageryProperties.".concat(e),write:!t||{target:"orientedImageryProperties.".concat(e),writer:t},origins:{service:{name:"orientedImageryInfo.orientedImageryProperties.".concat(e),write:t,read:n}}}}var b=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).cameraHeading=null,e.cameraHeight=null,e.cameraPitch=null,e.cameraRoll=null,e.coveragePercent=null,e.demPathPrefix=null,e.demPathSuffix=null,e.depthImagePathPrefix=null,e.depthImagePathSuffix=null,e.elevationSource=null,e.farDistance=null,e.geometryType="point",e.horizontalFieldOfView=null,e.horizontalMeasurementUnit=null,e.imagePathPrefix=null,e.imagePathSuffix=null,e.imageRotation=null,e.maximumDistance=null,e.nearDistance=null,e.operationalLayerType="OrientedImageryLayer",e.orientationAccuracy=null,e.orientedImageryType=null,e.supportedSourceTypes=new Set(["Oriented Imagery Layer"]),e.type="oriented-imagery",e.timeIntervalUnit=null,e.verticalFieldOfView=null,e.verticalMeasurementUnit=null,e.videoPathPrefix=null,e.videoPathSuffix=null,e}return(0,a.Z)(n,[{key:"effectiveElevationSource",get:function(){var e=this.elevationSource,t=this.demPathPrefix,n=this.demPathSuffix;return(0,y.d6)(e,t,n)}},{key:"findFirstValidLayerId",value:function(e){var t,n,r=this;return null===(t=e.layers)||void 0===t||null===(n=t.find((function(e){return r.supportedSourceTypes.has(e.type)})))||void 0===n?void 0:n.id}},{key:"_verifySource",value:function(){if((0,o.Z)((0,s.Z)(n.prototype),"_verifySource",this).call(this),"point"!==this.geometryType)throw new d.Z("oriented-imagery-layer:invalid-geometry-type","OrientedImageryLayer only supports point geometry type")}}]),n}(m.default);(0,c._)([(0,h.Cb)({type:Number,json:g("cameraHeading")})],b.prototype,"cameraHeading",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("cameraHeight")})],b.prototype,"cameraHeight",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("cameraPitch")})],b.prototype,"cameraPitch",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("cameraRoll")})],b.prototype,"cameraRoll",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("coveragePercent")})],b.prototype,"coveragePercent",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("demPathPrefix")})],b.prototype,"demPathPrefix",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("demPathSuffix")})],b.prototype,"demPathSuffix",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("depthImagePathPrefix")})],b.prototype,"depthImagePathPrefix",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("depthImagePathSuffix")})],b.prototype,"depthImagePathSuffix",void 0),(0,c._)([(0,h.Cb)({type:Object,json:g("elevationSource")})],b.prototype,"elevationSource",void 0),(0,c._)([(0,h.Cb)()],b.prototype,"effectiveElevationSource",null),(0,c._)([(0,h.Cb)({type:Number,json:g("farDistance")})],b.prototype,"farDistance",void 0),(0,c._)([(0,h.Cb)({json:{write:!0}})],b.prototype,"geometryType",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("horizontalFieldOfView")})],b.prototype,"horizontalFieldOfView",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("horizontalMeasurementUnit")})],b.prototype,"horizontalMeasurementUnit",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("imagePathPrefix")})],b.prototype,"imagePathPrefix",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("imagePathSuffix")})],b.prototype,"imagePathSuffix",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("imageRotation")})],b.prototype,"imageRotation",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("maximumDistance")})],b.prototype,"maximumDistance",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("nearDistance")})],b.prototype,"nearDistance",void 0),(0,c._)([(0,h.Cb)({type:["OrientedImageryLayer"]})],b.prototype,"operationalLayerType",void 0),(0,c._)([(0,h.Cb)({json:g("orientationAccuracy",(function(e,t){e&&(t.orientationAccuracy=e.join(","))}))}),(0,v.p)((function(e){return e?e.trim().split(",").map(Number):null}))],b.prototype,"orientationAccuracy",void 0),(0,c._)([(0,h.Cb)({json:(0,r.Z)((0,r.Z)({},g("orientedImageryType",y.oh.write,y.oh.read)),{},{type:y.oh.apiValues})})],b.prototype,"orientedImageryType",void 0),(0,c._)([(0,h.Cb)({json:{read:!1},value:"oriented-imagery",readOnly:!0})],b.prototype,"type",void 0),(0,c._)([(0,h.Cb)({json:(0,r.Z)((0,r.Z)({},g("timeIntervalUnit",y.gs.write,y.gs.read)),{},{type:y.gs.apiValues})})],b.prototype,"timeIntervalUnit",void 0),(0,c._)([(0,h.Cb)({type:Number,json:g("verticalFieldOfView")})],b.prototype,"verticalFieldOfView",void 0),(0,c._)([(0,h.Cb)({json:(0,r.Z)((0,r.Z)({},g("verticalMeasurementUnit")),{},{type:new p.X({Feet:"feet",Meter:"meter"}).apiValues})})],b.prototype,"verticalMeasurementUnit",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("videoPathPrefix")})],b.prototype,"videoPathPrefix",void 0),(0,c._)([(0,h.Cb)({type:String,json:g("videoPathSuffix")})],b.prototype,"videoPathSuffix",void 0);var w=b=(0,c._)([(0,f.j)("esri.layers.OrientedImageryLayer")],b)},17775:function(e,t,n){n.d(t,{Z:function(){return m}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(27366),u=(n(59486),n(49861)),c=(n(93169),n(32718),n(84936),n(38511)),d=n(69912),p=n(22824),h=n(53184),v=n(34810),f=n(78952),m=function(e){var t=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).copyright=null,e.minScale=0,e.maxScale=0,e.spatialReference=null,e.tileInfo=null,e.tilemapCache=null,e}return(0,a.Z)(n,[{key:"destroy",value:function(){var e,t;null===(e=this.tilemapCache)||void 0===e||null===(t=e.destroy)||void 0===t||t.call(e)}},{key:"readMinScale",value:function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}},{key:"readMaxScale",value:function(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}},{key:"supportsBlankTile",get:function(){return this.version>=10.2}},{key:"readTilemapCache",value:function(e,t,n){var i,a=null===(i=t.capabilities)||void 0===i?void 0:i.includes("Tilemap"),o=t.minLOD,s=t.maxLOD,l=t.minScale,u=t.maxScale;if(null==o&&null==s&&0!==l&&0!==u){var c=function(e){return Math.round(1e4*e)/1e4};l=c(l||t.tileInfo.lods[0].scale),u=c(u||t.tileInfo.lods[t.tileInfo.lods.length-1].scale);var d,f=(0,r.Z)(t.tileInfo.lods);try{for(f.s();!(d=f.n()).done;){var m=d.value,y=c(m.scale);o=y>=l?m.level:o,s=y>=u?m.level:s}}catch(b){f.e(b)}finally{f.f()}}if(a)return new v.y({layer:this,minLOD:o,maxLOD:s});if(t.tileInfo){var g=new p.Z;return g.read(t.tileInfo,n),new h.Z(g,o,s)}return null}}]),n}(e);return(0,l._)([(0,u.Cb)({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),(0,l._)([(0,u.Cb)()],t.prototype,"minScale",void 0),(0,l._)([(0,c.r)("service","minScale")],t.prototype,"readMinScale",null),(0,l._)([(0,u.Cb)()],t.prototype,"maxScale",void 0),(0,l._)([(0,c.r)("service","maxScale")],t.prototype,"readMaxScale",null),(0,l._)([(0,u.Cb)({type:f.Z})],t.prototype,"spatialReference",void 0),(0,l._)([(0,u.Cb)({readOnly:!0})],t.prototype,"supportsBlankTile",null),(0,l._)([(0,u.Cb)({type:p.Z})],t.prototype,"tileInfo",void 0),(0,l._)([(0,u.Cb)()],t.prototype,"tilemapCache",void 0),(0,l._)([(0,c.r)("service","tilemapCache",["capabilities","tileInfo"])],t.prototype,"readTilemapCache",null),(0,l._)([(0,u.Cb)()],t.prototype,"version",void 0),t=(0,l._)([(0,d.j)("esri.layers.mixins.ArcGISCachedService")],t)}},76767:function(e,t,n){n.d(t,{Z:function(){return g}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(27366),l=n(7138),u=n(49861),c=(n(93169),n(32718),n(84936),n(69912)),d=[2155,2194,2204,2222,2223,2224,2225,2226,2227,2228,2229,2230,2231,2232,2233,2234,2235,2236,2237,2238,2239,2240,2241,2242,2243,2244,2245,2246,2247,2248,2249,2250,2251,2252,2253,2254,2255,2256,2257,2258,2259,2260,2261,2262,2263,2264,2265,2266,2267,2268,2269,2270,2271,2272,2273,2274,2275,2276,2277,2278,2279,2280,2281,2282,2283,2284,2285,2286,2287,2288,2289,2314,2867,2868,2869,2870,2871,2872,2873,2874,2875,2876,2877,2878,2879,2880,2881,2882,2883,2884,2885,2886,2887,2888,2889,2890,2891,2892,2893,2894,2895,2896,2897,2898,2899,2900,2901,2902,2903,2904,2905,2906,2907,2908,2909,2910,2911,2912,2913,2914,2915,2916,2917,2918,2919,2920,2921,2922,2923,2924,2925,2926,2927,2928,2929,2930,2964,2965,2966,2967,2968,2992,2994,3080,3089,3091,3102,3359,3359,3361,3363,3365,3366,3404,3407,3417,3418,3419,3420,3421,3422,3423,3424,3425,3426,3427,3428,3429,3430,3431,3432,3433,3434,3435,3436,3437,3438,3441,3442,3443,3444,3445,3446,3451,3452,3453,3454,3455,3456,3457,3458,3459,3479,3481,3483,3485,3487,3490,3492,3494,3496,3498,3500,3502,3504,3506,3508,3510,3512,3515,3517,3519,3521,3523,3525,3527,3529,3531,3533,3535,3537,3539,3541,3543,3545,3547,3549,3551,3553,3560,3561,3562,3563,3564,3565,3566,3567,3568,3569,3570,3582,3584,3586,3588,3590,3593,3598,3600,3605,3608,3610,3612,3614,3616,3618,3620,3622,3624,3626,3628,3630,3632,3634,3636,3640,3642,3644,3646,3648,3650,3652,3654,3656,3658,3660,3662,3664,3668,3670,3672,3674,3676,3677,3679,3680,3682,3683,3686,3688,3690,3692,3696,3698,3700,3728,3729,3730,3731,3732,3733,3734,3735,3736,3737,3738,3739,3753,3754,3755,3756,3757,3758,3759,3760,3991,3992,4217,4399,4400,4401,4402,4403,4404,4405,4406,4407,4408,4409,4410,4411,4412,4413,4418,4419,4420,4421,4422,4423,4424,4425,4426,4427,4428,4429,4430,4431,4432,4433,4438,4439,4455,4456,4457,5466,5588,5589,5623,5624,5625,5646,5654,5655,6128,6129,6141,6200,6201,6202,6391,6405,6407,6409,6411,6413,6416,6418,6420,6422,6424,6426,6428,6430,6432,6434,6436,6438,6441,6443,6445,6447,6449,6451,6453,6455,6457,6459,6461,6463,6465,6467,6469,6471,6473,6475,6477,6479,6484,6486,6488,6490,6492,6494,6496,6499,6501,6503,6505,6507,6510,6515,6517,6519,6521,6523,6525,6527,6529,6531,6533,6535,6537,6539,6541,6543,6545,6547,6549,6551,6553,6555,6557,6559,6561,6563,6565,6568,6570,6572,6574,6576,6578,6582,6584,6586,6588,6590,6593,6595,6597,6599,6601,6603,6605,6607,6609,6612,6614,6616,6618,6625,6626,6627,6633,6785,6787,6789,6791,6793,6795,6797,6799,6801,6803,6805,6807,6809,6811,6813,6815,6817,6819,6821,6823,6825,6827,6829,6831,6833,6835,6837,6839,6841,6843,6845,6847,6849,6851,6853,6855,6857,6859,6861,6863,6868,6880,6885,6887,6923,6925,6966,6997,7057,7058,7059,7060,7061,7062,7063,7064,7065,7066,7067,7068,7069,7070,7119,7120,7121,7122,7123,7124,7125,7126,7127,7128,7132,7258,7260,7262,7264,7266,7268,7270,7272,7274,7276,7278,7280,7282,7284,7286,7288,7290,7292,7294,7296,7298,7300,7302,7304,7306,7308,7310,7312,7314,7316,7318,7320,7322,7324,7326,7328,7330,7332,7334,7336,7338,7340,7342,7344,7346,7348,7350,7352,7354,7356,7358,7360,7362,7364,7366,7368,7370,7558,7587,7588,7589,7590,7591,7592,7593,7594,7595,7596,7597,7598,7599,7600,7601,7602,7603,7604,7605,7606,7607,7608,7609,7610,7611,7612,7613,7614,7615,7616,7617,7618,7619,7620,7621,7622,7623,7624,7625,7626,7627,7628,7629,7630,7631,7632,7633,7634,7635,7636,7637,7638,7639,7640,7641,7642,7643,7644,7645,24100,26729,26730,26731,26732,26733,26734,26735,26736,26737,26738,26739,26740,26741,26742,26743,26744,26745,26746,26747,26748,26749,26750,26751,26752,26753,26754,26755,26756,26757,26758,26759,26760,26766,26767,26768,26769,26770,26771,26772,26773,26774,26775,26776,26777,26778,26779,26780,26781,26782,26783,26784,26785,26786,26787,26791,26792,26793,26794,26795,26796,26797,26798,26799,26801,26802,26803,26811,26812,26813,26814,26815,26819,26820,26821,26822,26825,26826,26830,26831,26832,26833,26836,26837,26841,26842,26843,26844,26847,26848,26849,26850,26851,26852,26853,26854,26855,26856,26857,26858,26859,26860,26861,26862,26863,26864,26865,26866,26867,26868,26869,26870,32001,32002,32003,32005,32006,32007,32008,32009,32010,32011,32012,32013,32014,32015,32016,32017,32018,32019,32020,32021,32022,32023,32024,32025,32026,32027,32028,32029,32030,32031,32033,32034,32035,32036,32037,32038,32039,32040,32041,32042,32043,32044,32045,32046,32047,32048,32049,32050,32051,32052,32053,32054,32055,32056,32057,32058,32064,32065,32066,32067,32074,32075,32076,32077,32099,32164,32165,32166,32167,32664,32665,32666,32667,65061,102120,102121,102629,102630,102631,102632,102633,102634,102635,102636,102637,102638,102639,102640,102641,102642,102643,102644,102645,102646,102648,102649,102650,102651,102652,102653,102654,102655,102656,102657,102658,102659,102660,102661,102662,102663,102664,102665,102666,102667,102668,102669,102670,102671,102672,102673,102674,102675,102676,102677,102678,102679,102680,102681,102682,102683,102684,102685,102686,102687,102688,102689,102690,102691,102692,102693,102694,102695,102696,102697,102698,102700,102704,102707,102708,102709,102710,102711,102712,102713,102714,102715,102716,102717,102718,102719,102720,102721,102722,102723,102724,102725,102726,102727,102728,102729,102730,102733,102734,102735,102736,102737,102738,102739,102740,102741,102742,102743,102744,102745,102746,102747,102748,102749,102750,102751,102752,102753,102754,102755,102756,102757,102758,102761,102766],p=[5614,5702,6130,6131,6132,6358,6359,6360],h=[115700,4326];function v(e){return d.includes(e)?"feet":"meters"}function f(e,t){return"number"==typeof e?p.includes(e)?"feet":"meters":v(t)}function m(e,t){return e&&h.includes(e)||4326===t?"ellipsoidal":"gravity-related-height"}var y=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).verticalWKID=null,e}return(0,i.Z)(n,[{key:"isAdvanced",get:function(){var e=this.affineTransformations,t=this.focalLength,n=this.principalOffsetPoint,r=this.radialDistortionCoefficients,i=this.tangentialDistortionCoefficients;return(null===e||void 0===e?void 0:e.length)>1&&!Number.isNaN(t)&&(null===n||void 0===n?void 0:n.length)>1&&(null===r||void 0===r?void 0:r.length)>1&&(null===i||void 0===i?void 0:i.length)>1}},{key:"unitAndHeightInfo",get:function(){var e=this.horizontalWKID,t=this.verticalWKID;4===this.type&&(e=4326,t=this.properties.verticalWKID);return{heightModel:m(t,e),heightUnit:f(t,e),horizontalUnit:v(e)}}}]),n}(l.default);(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"affineTransformations",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"focalLength",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"principalOffsetPoint",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"radialDistortionCoefficients",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"tangentialDistortionCoefficients",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"horizontalWKID",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"verticalWKID",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"x",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"y",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"z",void 0),(0,s._)([(0,u.Cb)({json:{write:!0}})],y.prototype,"type",void 0),(0,s._)([(0,u.Cb)({readOnly:!0})],y.prototype,"unitAndHeightInfo",null);var g=y=(0,s._)([(0,c.j)("esri.layers.orientedImagery.core.CameraOrientation")],y)},87676:function(e,t,n){n.d(t,{nn:function(){return m},t5:function(){return f},tB:function(){return y},xr:function(){return g}});var r=n(74165),i=n(15861),a=n(43144),o=n(15671),s=n(60136),l=n(29388),u=n(27366),c=n(10064),d=n(46784),p=n(49861),h=(n(93169),n(32718),n(84936),n(69912)),v=n(41226),f=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).url=null,e}return(0,a.Z)(n)}(d.wq);(0,u._)([(0,p.Cb)({type:Number,json:{write:!0}})],f.prototype,"lod",void 0),(0,u._)([(0,p.Cb)({type:String,json:{write:!0}})],f.prototype,"rasterFunction",void 0),(0,u._)([(0,p.Cb)({type:String,json:{write:!0}})],f.prototype,"url",void 0),f=(0,u._)([(0,h.j)("esri.layers.orientedImagery.core.ElevationSourceDefinitions.ElevationSource")],f);var m=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).constantElevation=null,e}return(0,a.Z)(n)}(d.wq);(0,u._)([(0,p.Cb)({type:Number,json:{write:!0}})],m.prototype,"constantElevation",void 0),m=(0,u._)([(0,h.j)("esri.layers.orientedImagery.core.ElevationSourceDefinitions.ConstantElevation")],m);var y=function(e){return null!=e&&"constantElevation"in e&&"number"==typeof e.constantElevation};function g(e){return b.apply(this,arguments)}function b(){return(b=(0,i.Z)((0,r.Z)().mark((function e(t){var n,i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,v.T)(t);case 2:return i=e.sent,a=i.tileInfo,o=i.cacheType,e.abrupt("return",i.hasOwnProperty("bandCount")&&i.hasOwnProperty("pixelSizeX")?"LERC"!==(null===a||void 0===a||null===(n=a.format)||void 0===n?void 0:n.toUpperCase())||o&&"elevation"!==o.toLowerCase()?{isSupported:!0,isDynamic:!0}:{isSupported:!0}:{isSupported:!1,error:new c.Z("elevation-source:invalid-service-url","ElevationSource URL expects an elevation 3D image service but given ".concat(t))});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},29754:function(e,t,n){n.d(t,{Z:function(){return S}});var r=n(1413),i=n(15671),a=n(43144),o=n(88301),s=n(61120),l=n(60136),u=n(29388),c=n(27366),d=(n(59486),n(11582)),p=n(10064),h=n(46784),v=n(32718),f=n(49861),m=n(89125),y=n(27135),g=n(38511),b=n(69912),w=n(31201),_=n(76767),C=(n(93169),n(84936),n(63967)),Z=function(){function e(){(0,i.Z)(this,e)}return(0,a.Z)(e,null,[{key:"getCameraOrientation",value:function(e){return(0,C.RS)(e)}},{key:"register",value:function(e,t,n){C.sU.set(e,{desc:t,constructor:n})}}]),e}(),x=Z=(0,c._)([(0,b.j)("esri.layers.orientedImagery.core.cameraOrientationFactory")],Z),M=n(48425),k=n(848);var I=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).cameraOrientation=null,r.elevation=null,r.elevationSource=null,r.name=null,r.sourceMap=null,r}return(0,a.Z)(n,[{key:"read",value:function(e,t){var i={},a=e.attributes,l=e.layer,u=e.geometry,c={};for(var d in a)i[d.toLowerCase()]=a[d],c[d.toLowerCase()]=d;(0,o.Z)((0,s.Z)(n.prototype),"read",this).call(this,(0,r.Z)({geometry:u,layer:null!==l&&void 0!==l?l:{},sourceMap:c},i),t)}},{key:"write",value:function(e,t){var r=(0,o.Z)((0,s.Z)(n.prototype),"write",this).call(this,e,t),i=this.sourceMap;if(!i||!r)return r;var a={};for(var l in r){var u=i[l.toLowerCase()];u&&(a[u]=r[l])}return a}},{key:"readCameraHeading",value:function(e,t){var n,r=t.cameraheading,i=t.camheading,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.cameraHeading}},{key:"readCameraHeight",value:function(e,t){var n,r=t.cameraheight,i=t.avghtag,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.cameraHeight}},{key:"readCamOffset",value:function(e,t){var n,r,i=t.cameraoffset,a=t.camoffset;return null!==(n=null!==(r=null===i||void 0===i?void 0:i.split(";").map(Number))&&void 0!==r?r:null===a||void 0===a?void 0:a.split(";").map(Number))&&void 0!==n?n:null}},{key:"writeCameraOffset",value:function(e,t){e&&(t.cameraOffset=e.join(";"))}},{key:"readCameraOrientation",value:function(e,t){var n=t.cameraorientation,r=t.camori;return null!==n&&void 0!==n?n:r}},{key:"readCameraPitch",value:function(e,t){var n,r=t.camerapitch,i=t.campitch,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.cameraPitch}},{key:"readCameraRoll",value:function(e,t){var n,r=t.cameraroll,i=t.camroll,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.cameraRoll}},{key:"readDepthImage",value:function(e,t){var n,r=t.depthimage,i=t.depthimg,a=t.layer,o=null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:null,s=null!==a&&void 0!==a?a:{},l=s.depthImagePathPrefix,u=s.depthImagePathSuffix;return(0,C.MI)(o,l,u)}},{key:"readElevationSource",value:function(e,t){var n=t.elevationsource,r=t.layer,i=r.demPathSuffix,a=r.demPathPrefix;if(n){var o=this._parseIfJSON(n);return(0,C.d6)(o,a,i)}return r.effectiveElevationSource}},{key:"readFarDistance",value:function(e,t){var n,r=t.fardistance,i=t.fardist,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.farDistance}},{key:"readHFOV",value:function(e,t){var n,r=t.horizontalfieldofview,i=t.hfov,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.horizontalFieldOfView}},{key:"readImageURL",value:function(e,t){var n=t.imagepath,r=t.layer;n||function(e,t){throw new p.Z("exposure-point:missing-attribute-value","a value for ".concat(e," is missing in attribute table"),{exposurePoint:t})}("imagePath",this);var i=r.imagePathPrefix,a=r.imagePathSuffix;return(0,C.MI)(n,i,a)}},{key:"readImageRotation",value:function(e,t){var n,r=t.imagerotation,i=t.imgrot,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.imageRotation}},{key:"isHorizontal",get:function(){return"horizontal"===this.orientedImageryType}},{key:"isInspection",get:function(){return"inspection"===this.orientedImageryType}},{key:"isNadir",get:function(){return"nadir"===this.orientedImageryType}},{key:"isOblique",get:function(){return"oblique"===this.orientedImageryType}},{key:"isSpherical",get:function(){return"360"===this.orientedImageryType}},{key:"location",get:function(){var e=this.cameraOrientation,t=this.cameraHeight,n=this.elevation;if(e){var r=e.type,i=e.x,a=e.y,o=e.z,s=e.horizontalWKID;return new k.Z({x:i,y:a,z:o,spatialReference:{wkid:r===M.d.LTP?4326:s}})}if("number"!=typeof t)throw function(e){throw new p.Z("exposure-point:missing-default-value","a value for ".concat(e," is missing in default properties"))}("cameraHeight");var l=this.geometry.clone();return l.z=l.hasZ?l.z:(null!==n&&void 0!==n?n:0)+t,l}},{key:"readNearDistance",value:function(e,t){var n,r=t.neardistance,i=t.neardist,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.nearDistance}},{key:"readOrientationAccuracy",value:function(e,t){var n,r,i=t.accuracy,a=t.orientationaccuracy;return null!==(n=null!==(r=null===a||void 0===a?void 0:a.split(";").map(Number))&&void 0!==r?r:null===i||void 0===i?void 0:i.split(";").map(Number))&&void 0!==n?n:null}},{key:"writeOrientationAccuracy",value:function(e,t){e&&(t.orientationAccuracy=e.join(";"))}},{key:"readOIType",value:function(e,t){var n,r,i=t.orientedimagerytype,a=t.oitype,o=t.camerapitch,s=t.campitch,l=t.layer,u=C.oh.read(null!==(n=null!==i&&void 0!==i?i:a)&&void 0!==n?n:l.orientedImageryType),c=null!==(r=null!==o&&void 0!==o?o:s)&&void 0!==r?r:l.cameraPitch;return"oblique"===u?c<10?"nadir":"oblique":u}},{key:"readVFOV",value:function(e,t){var n,r=t.verticalfieldofview,i=t.vfov,a=t.layer;return null!==(n=null!==r&&void 0!==r?r:i)&&void 0!==n?n:a.verticalFieldOfView}},{key:"_parseIfJSON",value:function(e){var t=null;try{t=JSON.parse(e)}catch(n){v.Z.getLogger(this).error("couldn't parse the given elevation source JSON",e,n)}return t}}]),n}((0,d.J)(h.wq));(0,c._)([(0,f.Cb)({type:Date,json:{write:{enabled:!0,target:"aquisitionDate"},name:"acquisitiondate"}})],I.prototype,"acquisitionDate",void 0),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],I.prototype,"cameraHeading",void 0),(0,c._)([(0,g.r)("cameraHeading")],I.prototype,"readCameraHeading",null),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"cameraHeight",void 0),(0,c._)([(0,g.r)("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],I.prototype,"readCameraHeight",null),(0,c._)([(0,f.Cb)()],I.prototype,"cameraOffset",void 0),(0,c._)([(0,g.r)("cameraOffset",["cameraoffset","camoffset"])],I.prototype,"readCamOffset",null),(0,c._)([(0,w.c)("cameraOffset")],I.prototype,"writeCameraOffset",null),(0,c._)([(0,f.Cb)({json:{write:{writer:function(e,t,n){t[n]=e.toString()}}},type:_.Z}),(0,m.p)((function(e){return e?x.getCameraOrientation(e):null}))],I.prototype,"cameraOrientation",void 0),(0,c._)([(0,g.r)("cameraOrientation",["cameraorientation","camori"])],I.prototype,"readCameraOrientation",null),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"cameraPitch",void 0),(0,c._)([(0,g.r)("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],I.prototype,"readCameraPitch",null),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"cameraRoll",void 0),(0,c._)([(0,g.r)("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],I.prototype,"readCameraRoll",null),(0,c._)([(0,f.Cb)({json:{write:!0},type:String})],I.prototype,"depthImage",void 0),(0,c._)([(0,g.r)("depthImage",["depthimage","depthimg"])],I.prototype,"readDepthImage",null),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"elevation",void 0),(0,c._)([(0,f.Cb)({json:{write:!0},clonable:"reference"})],I.prototype,"elevationSource",void 0),(0,c._)([(0,g.r)("elevationSource",["elevationsource","layer.effectiveElevationSource"])],I.prototype,"readElevationSource",null),(0,c._)([(0,f.Cb)({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],I.prototype,"exposureStationId",void 0),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"farDistance",void 0),(0,c._)([(0,g.r)("farDistance",["fardistance","fardist","layer.farDistance"])],I.prototype,"readFarDistance",null),(0,c._)([(0,f.Cb)({type:k.Z,json:{name:"geometry"}})],I.prototype,"geometry",void 0),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"horizontalFieldOfView",void 0),(0,c._)([(0,g.r)("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],I.prototype,"readHFOV",null),(0,c._)([(0,f.Cb)({json:{write:!0},type:String})],I.prototype,"imagePath",void 0),(0,c._)([(0,g.r)("imagePath",["imagepath"])],I.prototype,"readImageURL",null),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"imageRotation",void 0),(0,c._)([(0,g.r)("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],I.prototype,"readImageRotation",null),(0,c._)([(0,f.Cb)()],I.prototype,"isHorizontal",null),(0,c._)([(0,f.Cb)()],I.prototype,"isInspection",null),(0,c._)([(0,f.Cb)()],I.prototype,"isNadir",null),(0,c._)([(0,f.Cb)()],I.prototype,"isOblique",null),(0,c._)([(0,f.Cb)()],I.prototype,"isSpherical",null),(0,c._)([(0,f.Cb)()],I.prototype,"location",null),(0,c._)([(0,f.Cb)({json:{write:!0},type:String})],I.prototype,"name",void 0),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"nearDistance",void 0),(0,c._)([(0,g.r)("nearDistance",["neardistance","neardist","layer.nearDistance"])],I.prototype,"readNearDistance",null),(0,c._)([(0,f.Cb)({json:{write:!0,name:"objectid"},type:Number})],I.prototype,"objectId",void 0),(0,c._)([(0,f.Cb)()],I.prototype,"orientationAccuracy",void 0),(0,c._)([(0,g.r)("orientationAccuracy",["accuracy","orientationaccuracy"])],I.prototype,"readOrientationAccuracy",null),(0,c._)([(0,w.c)("orientationAccuracy")],I.prototype,"writeOrientationAccuracy",null),(0,c._)([(0,y.J)(C.oh)],I.prototype,"orientedImageryType",void 0),(0,c._)([(0,g.r)("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],I.prototype,"readOIType",null),(0,c._)([(0,f.Cb)({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],I.prototype,"sortOrder",void 0),(0,c._)([(0,f.Cb)({type:Object})],I.prototype,"sourceMap",void 0),(0,c._)([(0,f.Cb)({type:Number,json:{write:!0}})],I.prototype,"verticalFieldOfView",void 0),(0,c._)([(0,g.r)("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],I.prototype,"readVFOV",null);var S=I=(0,c._)([(0,b.j)("esri.layers.orientedImagery.core.ExposurePoint")],I)},64248:function(e,t,n){n.d(t,{DC:function(){return j},Ff:function(){return z},QX:function(){return x},RS:function(){return I},Zk:function(){return R},eC:function(){return P},wM:function(){return k}});var r=n(74165),i=n(93433),a=n(15861),o=n(37762),s=(n(59486),n(66978)),l=n(12400),u=n(32035),c=n(42137),d=n(63899),p=n(79803),h=n(22186),v=n(85981),f=n(64995),m=n(27474),y=n(55652),g=n(92975),b=n(46426),w=n(80885),_=n(78952),C=n(77577),Z=Math.PI/180;function x(e){return e.isSpherical?function(e){var t=e.geometry,n=e.farDistance,r=e.objectId,i=e.nearDistance,a=e.cameraHeight,o=(0,b.lj)(t),s=new c.Z({center:t.clone(),radius:n*o});if(s.imageID=r,i){var l=new c.Z({center:t.clone(),radius:i*o});s.addRing(l.rings[0])}var u=t.clone();u.z=a-n*o;var p=d.Z.createSphere(u,{size:2*n*o});return p.imageID=r,{polygon:s,frustum:p}}(e):function(e){var t=e.horizontalFieldOfView,n=e.verticalFieldOfView,r=e.geometry,i=e.cameraHeading,a=(0,b.lj)(r),s=e.cameraPitch,l=e.cameraRoll,u=150;t>150&&(s=90,l=0,u=5);var c=Math.ceil(t/u),d=function(e,t,n){var r=[];if(e%2==0)for(var i=0;i<e/2;i++)r.push(t-n/e*(i+.5),t+n/e*(i+.5));else{r.push(t);for(var a=1;a<e/2;a++)r.push(t-n/e*a,t+n/e*a)}return r.sort(),r}(c,i,t),p=e.farDistance?e.farDistance*a:e.cameraHeight*a/Math.cos(s*Z);e.cameraPitch+n/2>=90&&(p=(e.farDistance||20)*a);var h=new w.Z({spatialReference:null===r||void 0===r?void 0:r.spatialReference});h.imageID=e.objectId;var v,f=null,m=(0,o.Z)(d);try{for(m.s();!(v=m.n()).done;){f=M(v.value,s,l,e,r,p,a,n,t,c,h)}}catch(y){m.e(y)}finally{m.f()}return f.imageID=e.objectId,{polygon:h,frustum:f}}(e)}function M(e,t,n,r,i,a,o,s,c,p,h){var v=(0,b.oE)("HPR",[e,t,n]),f=function(e,t,n){var r=e.cameraHeight,i=e.cameraPitch,a=e.farDistance,o=e.geometry,s=e.horizontalFieldOfView,c=e.nearDistance,p=e.verticalFieldOfView,h=F(o),v=c<0?0:c*h,f=r*h/Math.cos(i*Z),y=!0;i+p/2>=90&&(f=(null!==a&&void 0!==a?a:20)*h,y=!1);var g,w,_=2*Math.tan(p*Z/2)*v,C=2*Math.tan(s*Z/2)*v,x=2*Math.tan(p*Z/2)*f,M=2*Math.tan(s*Z/2)*f;w=[0,0,-1],w=(0,b.kK)(w,t),g=(0,b.s3)([o.x,o.y,r],w,f,h),y&&(g[2]=0);var k=(0,b.s3)([o.x,o.y,r],w,v,h),I=[0,1,0];I=(0,b.kK)(I,t);var S=[1,0,0];S=(0,b.kK)(S,t);var P=[],R=[];v?(R=[{faces:[4,0,3,4,7,3]},{faces:[5,1,2,5,6,2]},{faces:[4,0,1,4,5,1]},{faces:[6,2,3,6,7,3]}],P=(P=(P=(P=P.concat((0,u.g)((0,l.ll)(),k,(0,u.z)((0,l.ll)(),(0,b.SW)(I,_/2,h),(0,b.SW)(S,C/2,h))))).concat((0,u.g)((0,l.ll)(),k,(0,u.g)((0,l.ll)(),(0,b.SW)(I,_/2,h),(0,b.SW)(S,C/2,h))))).concat((0,u.z)((0,l.ll)(),k,(0,u.z)((0,l.ll)(),(0,b.SW)(I,_/2,h),(0,b.SW)(S,C/2,h))))).concat((0,u.z)((0,l.ll)(),k,(0,u.g)((0,l.ll)(),(0,b.SW)(I,_/2,h),(0,b.SW)(S,C/2,h))))):(P=[o.x,o.y,r],R=[{faces:[0,1,2,0,2,3,0,3,4,0,4,1]}]),P=(P=(P=(P=P.concat((0,u.g)((0,l.ll)(),g,(0,u.z)((0,l.ll)(),(0,b.SW)(I,x/2,h),(0,b.SW)(S,M/2,h))))).concat((0,u.g)((0,l.ll)(),g,(0,u.g)((0,l.ll)(),(0,b.SW)(I,x/2,h),(0,b.SW)(S,M/2,h))))).concat((0,u.z)((0,l.ll)(),g,(0,u.z)((0,l.ll)(),(0,b.SW)(I,x/2,h),(0,b.SW)(S,M/2,h))))).concat((0,u.z)((0,l.ll)(),g,(0,u.g)((0,l.ll)(),(0,b.SW)(I,x/2,h),(0,b.SW)(S,M/2,h))));var z=new m.Q({position:Float64Array.from(P)});return new d.Z({vertexAttributes:z,components:R,spatialReference:o.spatialReference})}(r,v),y=(0,b.kK)([0,0,-1],v),g=i.x,w=i.y,_=(0,b.s3)([g,w,r.cameraHeight],y,a,o),C=2*Math.tan(s*Z/2)*a,x=2*Math.tan(c/p*Z/2)*a,M=(0,b.kK)([0,1,0],v),I=(0,b.kK)([1,0,0],v),S=(0,b.SW)(M,C/2,o),P=(0,b.SW)(I,x/2,o),R=(0,u.z)((0,l.ll)(),S,P),z=(0,u.g)((0,l.ll)(),S,P),O=k([(0,u.g)((0,l.ll)(),_,R),(0,u.g)((0,l.ll)(),_,z),(0,u.z)((0,l.ll)(),_,R),(0,u.z)((0,l.ll)(),_,z)],r.cameraHeight,i,o);return O.push(O[0]),h.addRing(O),f}function k(e,t,n,r){return e.map((function(e){return function(e,t,n,r){var i=Math.sqrt(Math.pow(e[2]-t,2)+Math.pow(Math.sqrt(Math.pow(e[0]-n.x,2)+Math.pow(e[1]-n.y,2))/r,2))*r,a=(0,b.SW)((0,u.z)((0,l.ll)(),[e[0],e[1],e[2]],[n.x,n.y,t]),1/i,1/r),o=t/(t-e[2]),s={x:(1-o)*n.x+o*e[0],y:(1-o)*n.y+o*e[1],z:(1-o)*t+o*e[2]},c=Math.sqrt(Math.pow(s.z-t,2)+Math.pow(Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2))/r,2))*r,d=(0,b.SW)((0,u.z)((0,l.ll)(),[s.x,s.y,s.z],[n.x,n.y,t]),1/c,1/r);return S(a[0],d[0])&&S(a[1],d[1])&&S(a[2],d[2])||e[2]>=0?[e[0],e[1],0]:[s.x,s.y,s.z]}(e,t,n,r)}))}function I(e,t){return e.contains(t)}function S(e,t){return Math.sign(e)!==Math.sign(t)}function P(e){var t=e.geometry,n=t.spatialReference,r=t.x,i=t.y,a=e.cameraHeading,o=e.cameraPitch,s=e.farDistance,l=e.nearDistance,u=F(e.geometry),c=new w.Z({spatialReference:n}),d=Math.abs(1.44*s*u),p=Math.abs(1.44*l*u);(o<20||null==a)&&(p=d);var h=[];return h[0]={x:r+d*Math.sin((a-45)*Z),y:i+d*Math.cos((a-45)*Z)},h[1]={x:r+d*Math.sin((a+45)*Z),y:i+d*Math.cos((a+45)*Z)},h[2]={x:r+p*Math.sin((a+135)*Z),y:i+p*Math.cos((a+135)*Z)},h[3]={x:r+p*Math.sin((a+225)*Z),y:i+p*Math.cos((a+225)*Z)},c.addRing([[h[0].x,h[0].y,0],[h[1].x,h[1].y,0],[h[2].x,h[2].y,0],[h[3].x,h[3].y,0],[h[0].x,h[0].y,0]]),c}function F(e){return e&&(0,g.sS)(null===e||void 0===e?void 0:e.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/h.sv.radius))):1}function R(e,t){var n=1+t/100;if("esri.geometry.Circle"===e.declaredClass){var r=e.radius,i=e.center,a=new c.Z({radius:r*n,center:i});return e.rings.length>1&&a.addRing(e.rings[1]),a}if("esri.geometry.Polygon"===e.declaredClass){var o=new w.Z({spatialReference:e.spatialReference}),s=e.centroid;if(s){for(var d=[],p=0;p<e.rings[0].length;p++){var h=Math.sqrt(Math.pow(s.x-e.rings[0][p][0],2)+Math.pow(s.y-e.rings[0][p][1],2)),v=(0,b.SW)((0,u.z)((0,l.ll)(),[e.rings[0][p][0],e.rings[0][p][1],0],[s.x,s.y,0]),1/h,1),f=(0,b.s3)([s.x,s.y,0],v,h*n,1);d.push({x:f[0],y:f[1]})}o.addRing([[d[0].x,d[0].y,0],[d[1].x,d[1].y,0],[d[2].x,d[2].y,0],[d[3].x,d[3].y,0],[d[0].x,d[0].y,0]])}return o}return e}function z(e,t,n){return O.apply(this,arguments)}function O(){return(O=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a,o,s,l,u,c,d,p,h,v,f,m,y,g,w,C,Z;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.cameraHeight,o=i.cameraLocation,s=i.cameraPitch,l=i.frustumVertices,u=i.horizontalFieldOfView,c=i.imageHeight,d=i.imageWidth,p=i.inSRS,h=i.outSRS,v=i.verticalFieldOfView,f=i.cameraRoll,m=i.imageRotation,y=i.options,g=new _.Z(p),w=new _.Z(h),C=(0,b.o4)(u,v,null!==f&&void 0!==f?f:0),Z=l.length>15,!(s+C.vfov/2>=90)){e.next=7;break}return e.next=4,D(l,t,d,c,g,w,Z,m,y);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,A(l,t,n,o,a,Z,g,w,y);case 9:e.t0=e.sent;case 10:return e.abrupt("return",e.t0);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,n,r,i,a,o,s,l){return V.apply(this,arguments)}function V(){return(V=(0,a.Z)((0,r.Z)().mark((function e(t,n,a,o,s,l,u,c,p){var h,v,f,y,g;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v=T(t,n,a,o,s)){e.next=3;break}return e.abrupt("return");case 3:return f=v.farPlane,y=v.nearPlane,e.next=7,j([].concat((0,i.Z)(null!==(h=null===y||void 0===y?void 0:y.vertexPositions)&&void 0!==h?h:t.slice(0,3)),(0,i.Z)(f.vertexPositions)),u,c,p);case 7:return g=e.sent,e.abrupt("return",new d.Z({vertexAttributes:new m.Q({position:g}),components:q(B(l)),spatialReference:c}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n,r,i){var a=W(e),o=W(e,"near");if(a){for(var s=a.coefficients,l=t.length,u=0;u<l;u++){var c,d,p=H([n[u][0],n[u][1]],s),h=n[u];h[2]=null!==(c=h[2]>=0?p:h[2])&&void 0!==c?c:0;var v=[h[0]-r[0],h[1]-r[1],h[2]-(null!==(d=r[2])&&void 0!==d?d:i)];N(r,v,u,o),E(r,v,u,a,n,p)}return{farPlane:a,nearPlane:o}}}function E(e,t,n,r,a,o){var s=r.coefficients,u=r.vertexPositions;if(null!=o&&o>=0)u.splice.apply(u,[3*n,3].concat((0,i.Z)(a[n])));else{var c=(0,l.Ue)();(0,y.dZ)(s,(0,v.re)(e,t),c)&&u.splice.apply(u,[3*n,3].concat((0,i.Z)(c)))}}function N(e,t,n,r){var a;if(r){var o=(0,l.Ue)();(0,y.dZ)(r.coefficients,(0,v.re)(e,t),o)&&(a=r.vertexPositions).splice.apply(a,[3*n,3].concat((0,i.Z)(o)))}}function D(e,t,n,r,i,a,o){return L.apply(this,arguments)}function L(){return L=(0,a.Z)((0,r.Z)().mark((function e(t,n,i,a,o,s,l){var u,c,p,h,v,f,y,g,w,_,C,x,M,k,I,S=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(u=S.length>7&&void 0!==S[7]?S[7]:0,c=S.length>8?S[8]:void 0,p=Math.cos((null!==u&&void 0!==u?u:0)*Z),h=Math.sin((null!==u&&void 0!==u?u:0)*Z),v=Math.abs(i*p+a*h),f=Math.abs(i*-h+a*p),w=l?new Array:[t[0],t[1],t[2]],_=new Array,C=n.length,x=0;x<C;x++)M=[v/2,f/2],k=n[x],g=[(k[0]-M[0])*p-(k[1]-M[1])*h+M[0],(k[0]-M[0])*h+(k[1]-M[1])*p+M[1]],l?(y=(0,b.E7)({x:g[0],y:g[1],z:1},{x:0,y:0,z:1},{x:i,y:0,z:1},{x:i,y:a,z:1},{x:0,y:a,z:1},{x:t[0],y:t[1],z:t[2]},{x:t[3],y:t[4],z:t[5]},{x:t[6],y:t[7],z:t[8]},{x:t[9],y:t[10],z:t[11]}),w=w.concat([y.x,y.y,y.z]),y=(0,b.E7)({x:g[0],y:g[1],z:1},{x:0,y:0,z:1},{x:i,y:0,z:1},{x:i,y:a,z:1},{x:0,y:a,z:1},{x:t[12],y:t[13],z:t[14]},{x:t[15],y:t[16],z:t[17]},{x:t[18],y:t[19],z:t[20]},{x:t[21],y:t[22],z:t[23]}),_=_.concat([y.x,y.y,y.z])):(y=(0,b.E7)({x:g[0],y:g[1],z:1},{x:0,y:0,z:1},{x:i,y:0,z:1},{x:i,y:a,z:1},{x:0,y:a,z:1},{x:t[3],y:t[4],z:t[5]},{x:t[6],y:t[7],z:t[8]},{x:t[9],y:t[10],z:t[11]},{x:t[12],y:t[13],z:t[14]}),w=w.concat([y.x,y.y,y.z]));return w=w.concat(_),e.next=9,j(w,o,s,c);case 9:return I=e.sent,e.abrupt("return",new d.Z({vertexAttributes:new m.Q({position:I}),components:q(B(l)),spatialReference:s}));case 11:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function j(e,t,n,r){return G.apply(this,arguments)}function G(){return(G=(0,a.Z)((0,r.Z)().mark((function e(t,n,i,a){var o,l,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.equals(i)){e.next=2;break}return e.abrupt("return",t);case 2:return o=t.reduce((function(e,t,n){var r=Math.floor(n/3);return e[r]||(e[r]=new Array),e[r].push(t),e}),new Array),e.next=5,(0,p.projectWithZConversion)(new C.Z(o,n),i,a);case 5:return l=e.sent,u=l.points,e.abrupt("return",((0,s.k_)(a),u.flat()));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){if(t)return(-t[3]-t[0]*e[0]-t[1]*e[1])/t[2]}function W(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"far",r=(0,y.Ue)();switch(n){case"far":if(t=Array.from(15===e.length?e.slice(3):e.slice(12)),(0,y.nI)(r,t,!1))return{coefficients:r,vertexPositions:t};break;case"near":if(t=Array.from(e.slice(0,12)),15===e.length||!(0,y.nI)(r,t,!1))return;return{coefficients:r,vertexPositions:t}}}var B=function(e){return e?[{faces:new Uint32Array([4,0,3,4,7,3])},{faces:new Uint32Array([5,1,2,5,6,2])},{faces:new Uint32Array([4,0,1,4,5,1])},{faces:new Uint32Array([6,2,3,6,7,3])}]:[{faces:new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1])}]},q=function(e){return e.map((function(e){return new f.Z(e)}))}},63967:function(e,t,n){n.d(t,{MI:function(){return I},sU:function(){return R},RS:function(){return O},d6:function(){return S},oh:function(){return F},gs:function(){return P}});var r=n(93433),i=n(84506),a=n(29439),o=n(1413),s=n(43404),l=n(15671),u=n(43144),c=n(60136),d=n(29388),p=n(27366),h=n(11582),v=n(46784),f=n(49861),m=(n(93169),n(32718),n(84936),n(69912)),y=n(76767),g=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,l.Z)(this,n),(e=t.apply(this,arguments)).type=1,e}return(0,u.Z)(n,[{key:"toString",value:function(){var e=this.type,t=this.horizontalWKID,n=this.verticalWKID,r=this.x,i=this.y,a=this.z,o=this.heading,s=this.pitch,l=this.roll,u=this.affineTransformations,c=this.focalLength,d=this.principalOffsetPoint,p=this.radialDistortionCoefficients,h=this.tangentialDistortionCoefficients,v=[e,t,n,r,i,a,o,s,l];return this.isAdvanced&&(null!==u&&void 0!==u&&u.forEach((function(e){return v.push(e)})),v.push(c),null!==d&&void 0!==d&&d.forEach((function(e){return v.push(e)})),null!==p&&void 0!==p&&p.forEach((function(e){return v.push(e)})),null!==h&&void 0!==h&&h.forEach((function(e){return v.push(e)}))),v.map((function(e){return Number.isNaN(e)?"":e})).join("|")}}]),n}((0,h.J)((0,v.eC)(y.Z)));(0,p._)([(0,f.Cb)({json:{write:!0}})],g.prototype,"type",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],g.prototype,"affineTransformations",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"focalLength",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],g.prototype,"principalOffsetPoint",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],g.prototype,"radialDistortionCoefficients",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],g.prototype,"tangentialDistortionCoefficients",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"heading",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"pitch",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"roll",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"horizontalWKID",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"verticalWKID",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"x",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"y",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],g.prototype,"z",void 0);var b=g=(0,p._)([(0,m.j)("esri.layers.orientedImagery.core.CameraOrientationHPR")],g),w=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,l.Z)(this,n),(e=t.apply(this,arguments)).type=2,e.verticalWKID=null,e}return(0,u.Z)(n,[{key:"toString",value:function(){var e=this.type,t=this.horizontalWKID,n=this.verticalWKID,r=this.x,i=this.y,a=this.z,o=this.omega,s=this.phi,l=this.kappa,u=this.affineTransformations,c=this.focalLength,d=this.principalOffsetPoint,p=this.radialDistortionCoefficients,h=this.tangentialDistortionCoefficients,v=[e,t,n,r,i,a,o,s,l];return this.isAdvanced&&(null!==u&&void 0!==u&&u.forEach((function(e){return v.push(e)})),v.push(c),null!==d&&void 0!==d&&d.forEach((function(e){return v.push(e)})),null!==p&&void 0!==p&&p.forEach((function(e){return v.push(e)})),null!==h&&void 0!==h&&h.forEach((function(e){return v.push(e)}))),v.map((function(e){return isNaN(e)?"":e})).join("|")}}]),n}((0,h.J)((0,v.eC)(y.Z)));(0,p._)([(0,f.Cb)({json:{write:!0}})],w.prototype,"type",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],w.prototype,"affineTransformations",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"focalLength",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],w.prototype,"principalOffsetPoint",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],w.prototype,"radialDistortionCoefficients",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],w.prototype,"tangentialDistortionCoefficients",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"omega",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"phi",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"kappa",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"horizontalWKID",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"verticalWKID",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"x",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"y",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],w.prototype,"z",void 0);var _=w=(0,p._)([(0,m.j)("esri.layers.orientedImagery.core.CameraOrientationOPK")],w),C=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,l.Z)(this,n),(e=t.apply(this,arguments)).type=3,e}return(0,u.Z)(n,[{key:"isAdvanced",get:function(){var e=this.affineTransformations,t=this.focalLength,n=this.principalOffsetPoint,r=this.radialDistortionCoefficients,i=this.tangentialDistortionCoefficients;return(null===e||void 0===e?void 0:e.length)>1||!Number.isNaN(t)||(null===n||void 0===n?void 0:n.length)>1||(null===r||void 0===r?void 0:r.length)>1||(null===i||void 0===i?void 0:i.length)>1}},{key:"toString",value:function(){var e=this.type,t=this.horizontalWKID,n=this.verticalWKID,r=this.x,i=this.y,a=this.z,o=this.yaw,s=this.pitch,l=this.roll,u=this.affineTransformations,c=this.focalLength,d=this.principalOffsetPoint,p=this.radialDistortionCoefficients,h=this.tangentialDistortionCoefficients,v=[e,t,n,r,i,a,o,s,l];return this.isAdvanced&&(null!==u&&void 0!==u&&u.forEach((function(e){return v.push(e)})),v.push(c),null!==d&&void 0!==d&&d.forEach((function(e){return v.push(e)})),null!==d&&void 0!==d&&d.forEach((function(e){return v.push(e)})),null!==p&&void 0!==p&&p.forEach((function(e){return v.push(e)})),null!==h&&void 0!==h&&h.forEach((function(e){return v.push(e)}))),v.map((function(e){return Number.isNaN(e)?"":e})).join("|")}}]),n}((0,h.J)((0,v.eC)(y.Z)));(0,p._)([(0,f.Cb)({json:{write:!0}})],C.prototype,"type",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],C.prototype,"affineTransformations",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"focalLength",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],C.prototype,"principalOffsetPoint",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],C.prototype,"radialDistortionCoefficients",void 0),(0,p._)([(0,f.Cb)({type:[Number],json:{write:!0}})],C.prototype,"tangentialDistortionCoefficients",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"yaw",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"pitch",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"roll",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"horizontalWKID",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"verticalWKID",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"x",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"y",void 0),(0,p._)([(0,f.Cb)({type:Number,json:{write:!0}})],C.prototype,"z",void 0);var Z=C=(0,p._)([(0,m.j)("esri.layers.orientedImagery.core.CameraOrientationYPR")],C),x=n(87676),M=n(48425),k=n(36496);function I(e,t,n){return t&&(e="".concat(t).concat(e)),n&&(e+="".concat(n)),e}function S(e,t,n){return e?(0,x.tB)(e)?new x.nn(e):function(e,t,n){var r=e.url;return r?(r=I(r,t,n),new x.t5((0,o.Z)((0,o.Z)({},e),{},{url:r}))):null}(e,t,n):e}var P=new s.X({Minutes:"minutes",Hours:"hours",Days:"days",Weeks:"weeks",Months:"months",Years:"years"}),F=new s.X({360:"360",Horizontal:"horizontal",Inspection:"inspection",Nadir:"nadir",Oblique:"oblique","":null}),R=new Map;R.set("".concat(M.d.OPK),{desc:"Using Omega Phi Kappa",constructor:_}),R.set("".concat(M.d.HPR),{desc:"Using Heading, Pitch and Roll",constructor:b}),R.set("".concat(M.d.YPR),{desc:"Using Yaw, Pitch and Roll",constructor:Z});var z=new Map;function O(e){if(!e)return null;var t="".concat(e).split("|");if(0===t.length)return null;var n=R.get(t[0]);if(!n)return null;var r=z.get(t[0]);return r?new(0,n.constructor)(r(t)):null}z.set("".concat(M.d.HPR),(function(e){var t=e.slice(1),n=(0,a.Z)(t,22),r=n[0],i=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],d=n[7],p=n[8],h=n[9],v=n[10],f=n[11],m=n[12],y=n[13],g=n[14],b=n[15],w=n[16],_=n[17],C=n[18],Z=n[19],x=n[20],M=n[21],I=[p,h,v,f,m,y].map((function(e){return Number(e)})),S=[b,w].map((function(e){return Number(e)})),P=[_,C,Z],F=[x,M];return{horizontalWKID:r,verticalWKID:i,x:o,y:s,z:l,heading:u,pitch:c,roll:d,affineTransformations:6===I.filter(k.h).length?I:null,focalLength:g,principalOffsetPoint:2!==S.filter(k.h).length?null:S,radialDistortionCoefficients:3!==P.filter(k.h).length?null:P,tangentialDistortionCoefficients:2!==F.filter(k.h).length?null:F}})),z.set("".concat(M.d.YPR),(function(e){var t=e.slice(1),n=(0,a.Z)(t,22),r=n[0],i=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],d=n[7],p=n[8],h=n[9],v=n[10],f=n[11],m=n[12],y=n[13],g=n[14],b=n[15],w=n[16],_=n[17],C=n[18],Z=n[19],x=n[20],M=n[21],I=[p,h,v,f,m,y].map((function(e){return Number(e)})),S=[b,w].map((function(e){return Number(e)})),P=[_,C,Z],F=[x,M];return{horizontalWKID:r,verticalWKID:i,x:o,y:s,z:l,yaw:u,pitch:c,roll:d,affineTransformations:6===I.filter(k.h).length?I:null,focalLength:g,principalOffsetPoint:2!==S.filter(k.h).length?null:S,radialDistortionCoefficients:3!==P.filter(k.h).length?null:P,tangentialDistortionCoefficients:2!==F.filter(k.h).length?null:F}})),z.set("".concat(M.d.OPK),(function(e){var t=e.slice(1),n=(0,a.Z)(t,22),r=n[0],i=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],d=n[7],p=n[8],h=n[9],v=n[10],f=n[11],m=n[12],y=n[13],g=n[14],b=n[15],w=n[16],_=n[17],C=n[18],Z=n[19],x=n[20],M=n[21],I=[p,h,v,f,m,y].map((function(e){return Number(e)})),S=[b,w].map((function(e){return Number(e)})),P=[_,C,Z].map((function(e){return Number(e)})),F=[x,M].map((function(e){return Number(e)}));return{horizontalWKID:r,verticalWKID:i,x:o,y:s,z:l,omega:u,phi:c,kappa:d,affineTransformations:6===I.filter(k.h).length?I:null,focalLength:g,principalOffsetPoint:2!==S.filter(k.h).length?null:S,radialDistortionCoefficients:3!==P.filter(k.h).length?[0,0,0]:P,tangentialDistortionCoefficients:2!==F.filter(k.h).length?[0,0]:F}})),z.set("".concat(M.d.LTP),(function(e){var t=e.slice(1),n=(0,i.Z)(t),a=n[0],o=n[1],s=n[2],l=n[3],u=n[4],c=n.slice(5),d=z.get(u);return d?{latitude:a,longitude:o,ellipsoidRadius:s,squaredEccentricity:l,properties:d([u,""].concat((0,r.Z)(c)))}:null}))},48425:function(e,t,n){var r;n.d(t,{d:function(){return r}}),function(e){e[e.HPR=1]="HPR",e[e.OPK=2]="OPK",e[e.YPR=3]="YPR",e[e.LTP=4]="LTP"}(r||(r={}))},43780:function(e,t,n){n.d(t,{sg:function(){return S},y5:function(){return k}});var r=n(37762),i=n(74165),a=n(15861),o=n(10064),s=n(32718),l=n(66978),u=n(29303),c=n(848),d=n(79803),p=n(65156),h=n(41258),v=n(81753),f=n(42785),m=n(39685),y=n(87676),g=n(46426),b=n(8904),w=n(76081),_=n(48932),C=n(22824),Z=n(87960),x=n(49885),M=Math.PI/180;function k(e,t){return I.apply(this,arguments)}function I(){return I=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,o,s,l=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>2&&void 0!==l[2]&&l[2],t){e.next=3;break}return e.abrupt("return",[]);case 3:if(t=t.map((function(e){return"esri.geometry.Point"===e.declaredClass?e:c.Z.fromJSON(e)})),a=n.feature,o=a.attributes,!isNaN(parseFloat(o.elevation))){e.next=10;break}return e.next=8,S([a.geometry],n);case 8:s=e.sent,a.attributes.elevation=s[0].z;case 10:return e.abrupt("return",S(t,n,r).then((function(e){return A(e,n)})));case 11:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function S(e,t){return P.apply(this,arguments)}function P(){return P=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,o,s,l,u,c,d,p=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(p.length>2&&void 0!==p[2]&&p[2])){e.next=3;break}return e.abrupt("return",t);case 3:return a=n.feature,o=a.attributes,s=o.cameraOrientation,l=o.elevationSource,u=o.cameraHeight,c=o.location,d=a.elevationSample,e.abrupt("return",d?Promise.all(t.map(z(d,n.options))):l&&((0,y.tB)(l)||null!==(r=l.url)&&void 0!==r&&r.length)?F(t,n):O(t,s&&"number"==typeof c.z?c.z-u:0));case 5:case"end":return e.stop()}}),e)}))),P.apply(this,arguments)}function F(e,t){return R.apply(this,arguments)}function R(){return(R=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,o,u,c,h,v,g,x,M,k,I,S,P,F,R,A,V,T,E,N,D,L,j,G,H,W,B,q,U,K,Q,J;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.feature,a=n.options,o=n.footprintExtent,u=r.attributes.elevationSource){e.next=3;break}return e.abrupt("return",t);case 3:if(!(0,y.tB)(u)){e.next=6;break}return c=u.constantElevation,e.abrupt("return","number"!=typeof c?t:O(t,c));case 6:if(h=u.url){e.next=9;break}return e.abrupt("return",t);case 9:if(v=r.elevationSample){e.next=61;break}if(o){e.next=13;break}return e.abrupt("return",t);case 13:return g=o.clone(),e.next=16,(0,y.xr)(h);case 16:if(x=e.sent,M=x.error,k=x.isSupported,I=x.isDynamic,k){e.next=24;break}return s.Z.getLogger(u).warn(M),S=r.attributes,P=S.location,F=S.cameraHeight,R=S.cameraOrientation,e.abrupt("return",O(t,R&&"number"==typeof P.z?P.z-F:0));case 24:if(V=t,e.prev=25,!I){e.next=43;break}return A=new m.default({url:h,format:"lerc",rasterFunction:{functionName:null!==(T=u.rasterFunction)&&void 0!==T?T:"None"}}),e.next=30,A.load(a);case 30:return N=512,D=512,(L=o.width/o.height)>1?(D/=L,E=g.height/D):(N*=L,E=g.width/N),e.next=35,A.fetchImage(o,N,D,a);case 35:j=e.sent,G=C.Z.create({scales:[E],size:512,spatialReference:o.spatialReference}),H=new Z.f(null,0,0,0,(0,p.oJ)(o)),W=new _.v(j.pixelData.pixelBlock.pixels[0],N,D,0),B=new w.R(H,W),r.elevationSample=new b.OB(B,G,void 0),e.next=49;break;case 43:return A=new f.default(h),e.next=46,A.load();case 46:return e.next=48,A.createElevationSampler(g,a);case 48:r.elevationSample=e.sent;case 49:return e.next=51,Promise.all(t.map(z(r.elevationSample,a)));case 51:V=e.sent,e.next=57;break;case 54:e.prev=54,e.t0=e.catch(25),(0,l.D_)(e.t0)||(s.Z.getLogger("esri.layers.orientedImagery.transformations.groundToImageUtils").warn("#updateElevation() failed to update elevation using the provided elevation source URL: ".concat(h,". Please provide a valid elevation source url."),e.t0),q=r.attributes,U=q.location,K=q.cameraHeight,Q=q.cameraOrientation,t=O(t,Q&&"number"==typeof U.z?U.z-K:0));case 57:return e.prev=57,null===(J=A)||void 0===J||J.destroy(),e.finish(57);case 60:return e.abrupt("return",V);case 61:return e.next=63,(0,d.initializeProjection)(t[0].spatialReference,v.spatialReference,null,n.options);case 63:return e.abrupt("return",Promise.all(t.map(z(v,a))));case 64:case"end":return e.stop()}}),e,null,[[25,54,57,60]])})))).apply(this,arguments)}function z(e,t){return(0,l.k_)(t),function(){var n=(0,a.Z)((0,i.Z)().mark((function n(r){var a;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.z=1,a=e.queryElevation((0,d.project)(r,e.spatialReference)),n.t0=null!==a&&void 0!==a&&a.z,!n.t0){n.next=7;break}return n.next=6,(0,d.projectWithZConversion)(a,r.spatialReference,t);case 6:r.z=n.sent.z;case 7:return n.abrupt("return",r);case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}function O(e,t){return e.map((function(e){return e.z=t,e}))}function A(e,t){var n,r=t.feature.attributes;return r.isSpherical||360===r.horizontalFieldOfView?function(e,t){return V.apply(this,arguments)}(e,t):null!==(n=r.cameraOrientation)&&void 0!==n&&n.isAdvanced?function(e,t){var n,r=t.feature.attributes,s=r.cameraOrientation;if(!s)throw new o.Z("groundToImageUtils:missing-camera-orientation-parameters","CameraOrientation Parameters are required to perform advanced transformations");var l=new c.Z(r.location);l.spatialReference.isWGS84&&4!==(null===(n=r.cameraOrientation)||void 0===n?void 0:n.type)&&(l=(0,v.$)(l));var u,p=l.spatialReference.isWebMercator?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*l.y/6378137))):1;if("esri.layers.orientedImagery.core.CameraOrientationOPK"===s.declaredClass){var h=s.omega,f=s.phi,m=s.kappa;u=(0,g.oE)("OPK",[h,f,m])}else{var y=r.cameraHeading,b=r.cameraPitch,w=r.cameraRoll;u=(0,g.oE)("HPR",[y,b,w])}var _=s.principalOffsetPoint,C=s.focalLength,Z=s.radialDistortionCoefficients,x=s.affineTransformations,M=s.tangentialDistortionCoefficients;return Promise.all(e.map(function(){var n=(0,a.Z)((0,i.Z)().mark((function n(a){var o,s;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=function(e){var t,n,i,a,o,s,d,h;if(e.spatialReference.isWGS84)if(4===(null===(t=r.cameraOrientation)||void 0===t?void 0:t.type)){var f=r.cameraOrientation;e=new c.Z((0,g.SA)(e,[f.latitude,f.longitude,f.ellipsoidRadius,f.squaredEccentricity]))}else e=new c.Z((0,v.$)(e));var m=(null!==(n=e.z)&&void 0!==n?n:0)-(null!==(i=l.z)&&void 0!==i?i:0),y=(e.x-l.x)/p,b=(e.y-l.y)/p,w=(u[0]*y+u[1]*b+u[2]*m)/(u[6]*y+u[7]*b+u[8]*m),k=(u[3]*y+u[4]*b+u[5]*m)/(u[6]*y+u[7]*b+u[8]*m),I=Math.pow(w,2)+Math.pow(k,2),S=0,P=0,F=0,R=0,z=0,O=0,A=0;Z&&(S=null!==(a=Z[0])&&void 0!==a?a:0,P=null!==(o=Z[1])&&void 0!==o?o:0,F=null!==(s=Z[2])&&void 0!==s?s:0),M&&(R=M[0],z=M[1]),_&&(O=null!==(d=_[0])&&void 0!==d?d:0,A=null!==(h=_[1])&&void 0!==h?h:0);var V=1+(S||0)*I+(P||0)*I*I+(F||0)*I*I*I,T=w*V+(R||0)*(I+2*Math.pow(w,2))+2*(z||0)*w*k,E=k*V+(z||0)*(I+2*Math.pow(k,2))+2*(R||0)*w*k;return T=-(null!==C&&void 0!==C?C:0)*T+O,E=-(null!==C&&void 0!==C?C:0)*E+A,{x:Number(x[0])+Number(x[1])*T+Number(x[2])*E,y:Number(x[3])+Number(x[4])*T+Number(x[5])*E}},!a.spatialReference.equals(l.spatialReference)){n.next=5;break}n.t0=(o=new c.Z(a),s(o)),n.next=9;break;case 5:return n.next=7,(0,d.initializeProjection)(e[0].spatialReference,l.spatialReference,null,t.options);case 7:o=(0,d.project)(a,l.spatialReference),n.t0=s(o);case 9:return n.abrupt("return",n.t0);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()))}(e,t):Promise.resolve(function(e,t){var n,r,i,a=t.feature,o=t.imageProperties,s=o.width,l=o.height,d=a.attributes,p=(0,g.oE)("HPR",[d.cameraHeading,d.cameraPitch,d.cameraRoll]),h=Math.sin(null!==(n=d.imageRotation)&&void 0!==n?n:0*M),f=Math.cos(null!==(r=d.imageRotation)&&void 0!==r?r:0*M),m=null!==s&&void 0!==s?s:1,y=null!==l&&void 0!==l?l:1,b=[Math.abs(f*m+h*y),Math.abs(f*y-h*m)],w={horizontal:1/(2*Math.tan(d.horizontalFieldOfView*M/2)),vertical:1/(2*Math.tan(d.verticalFieldOfView*M/2))},_=[-w.horizontal,0,.5,0,w.vertical,.5,0,0,1],C=new c.Z(d.location);C.spatialReference.isWGS84&&4!==(null===(i=d.cameraOrientation)||void 0===i?void 0:i.type)&&(C=(0,v.$)(C));var Z=C.spatialReference.isWebMercator?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*C.y/6378137))):1,x=(0,u.dC)(new Array(9),p,_);return e.map((function(e){var t,n,r,i=new c.Z(e);if(i.spatialReference.isWGS84)if(4===(null===(t=d.cameraOrientation)||void 0===t?void 0:t.type)){var a=d.cameraOrientation;i=new c.Z((0,g.SA)(i,[a.latitude,a.longitude,a.ellipsoidRadius,a.squaredEccentricity]))}else i=new c.Z((0,v.$)(i));var o=(null!==(n=i.z)&&void 0!==n?n:0)-(null!==(r=C.z)&&void 0!==r?r:0),s=(i.x-C.x)/Z,l=(i.y-C.y)/Z,u=(x[0]*s+x[1]*l+x[2]*o)/(x[6]*s+x[7]*l+x[8]*o),p=(x[3]*s+x[4]*l+x[5]*o)/(x[6]*s+x[7]*l+x[8]*o),w={x:u*b[0],y:p*b[1]};return{x:f*(w.x-b[0]/2)+h*(w.y-b[1]/2)+m/2,y:-h*(w.x-b[0]/2)+f*(w.y-b[1]/2)+y/2}}))}(e,t))}function V(){return(V=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,o,s,l,u,c,d,p,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Array.isArray(t)?t:[t],s=new Array,l=n.feature.attributes,u=l.location,c=l.cameraOrientation,d=l.cameraHeading,p=null!==(r=n.imageProperties.height)&&void 0!==r?r:1,h=null!==(a=n.imageProperties.width)&&void 0!==a?a:1,e.next=3,T(u,o,d,h,p,s,c);case 3:return e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n,r,i,a,o){return E.apply(this,arguments)}function E(){return(E=(0,a.Z)((0,i.Z)().mark((function e(t,n,a,o,s,l,u){var p,f,m,y,b,w,_,C,Z,M,k,I,S,P,F,R,z;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p=t.spatialReference.isWGS84&&4!==(null===u||void 0===u?void 0:u.type)?(0,v.$)(t):new c.Z(t),m=(f=null!==u&&void 0!==u?u:{}).latitude,y=f.longitude,b=f.ellipsoidRadius,w=f.squaredEccentricity,_=(0,r.Z)(n),e.prev=2,_.s();case 4:if((C=_.n()).done){e.next=27;break}if(!(k=C.value).spatialReference.isWGS84||4!==(null===u||void 0===u?void 0:u.type)){e.next=10;break}e.t0=new c.Z((0,g.SA)(k,[m,y,b,w])),e.next=18;break;case 10:if(!k.spatialReference.equals(p.spatialReference)){e.next=14;break}e.t1=new c.Z(k),e.next=17;break;case 14:return e.next=16,(0,d.projectWithZConversion)(k,p.spatialReference);case 16:e.t1=e.sent;case 17:e.t0=e.t1;case 18:I=e.t0,S=(0,h.TE)(p,I),I.x-=p.x,I.y-=p.y,I.z=(null!==(Z=I.z)&&void 0!==Z?Z:0)-(null!==(M=p.z)&&void 0!==M?M:0),(P=(0,g.mV)(I,S)).heading=(P.heading-a)%360,F=(0,g.cZ)(P.heading,P.pitch,o,s),R=F.x,z=F.y,l.push(new c.Z(R,z,x.wz.spatialReference));case 25:e.next=4;break;case 27:e.next=32;break;case 29:e.prev=29,e.t2=e.catch(2),_.e(e.t2);case 32:return e.prev=32,_.f(),e.finish(32);case 35:case"end":return e.stop()}}),e,null,[[2,29,32,35]])})))).apply(this,arguments)}},8835:function(e,t,n){n.d(t,{y:function(){return x}});var r=n(1413),i=n(74165),a=n(37762),o=n(29439),s=n(15861),l=(n(59486),n(93169),n(32718),n(16889)),u=n(12400),c=n(32035),d=n(848),p=n(79803),h=n(40885),v=n(23470),f=n(81753),m=n(64248),y=n(29754),g=n(43780),b=n(46426),w=n(49885),_=n(36496),C=n(80885),Z=n(78952);function x(e,t){if(!e)return Promise.resolve([]);var n=t.feature,r=n.attributes;return r instanceof y.Z||(r=y.Z.fromJSON(n))&&(n.attributes=r),function(e,t){var n=t.feature.attributes;if(n.isSpherical||360===n.horizontalFieldOfView){var r=n.location,i=n.cameraOrientation,a=n.farDistance,o=n.cameraHeading,s=n.cameraHeight;return function(e,t,n,r,i,a,o){return M.apply(this,arguments)}(e,r,a,[t.imageProperties.width,t.imageProperties.height],o,s,i)}return function(e,t){return k.apply(this,arguments)}(e,t)}(e,t)}function M(){return(M=(0,s.Z)((0,i.Z)().mark((function e(t,n,r,s,l,c,p){var m,y,g,C,Z,x,M,k,I,S,P,F,R,z,O,A,V,T,E,N,D,L;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(m=new d.Z(n)).spatialReference.isGeographic&&m.spatialReference.isWGS84&&4!==(null===p||void 0===p?void 0:p.type)&&(m=(0,f.$)(m)),y=(0,b.lj)(m),g=new Array,C=m.toArray(),Z=(0,o.Z)(C,3),x=Z[0],M=Z[1],k=Z[2],I=(0,v.k)([x,M,null!==k&&void 0!==k?k:0],r*y),S=w.wz.toArray(),P=(0,a.Z)(t);try{for(P.s();!(F=P.n()).done;)z=F.value,O=void 0,A=void 0,(0,_.h)(z.heading)&&(0,_.h)(z.pitch)?(O=z.heading,A=z.pitch):(V=(0,b.If)({x:z.x,y:z.y},s[0],s[1]),O=V.heading,A=V.pitch),O=(O+l)%360,T=(0,h.zk)([S[0],S[1],S[2]],(0,b.n_)(O,A)),E=(0,h.al)([x,M,null!==k&&void 0!==k?k:0],T.direction),N=(0,u.Ue)(),(0,v.i)(I,E,N),D=(null!==(R=m.z)&&void 0!==R?R:0)-c,N[2]<D?(L=Math.abs((m.z-D)/-T.direction[2])*y,(0,b.s3)([m.x,m.y,m.z],T.direction,L,y,N)):N[2]=D,g.push(new d.Z(N,m.spatialReference))}catch(i){P.e(i)}finally{P.f()}return e.abrupt("return",g);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return(k=(0,s.Z)((0,i.Z)().mark((function e(t,n){var s,l,u,c,h,v,y,w,_,C,Z,x,M,k,S,P,z,O,V,T,E,N,D,L,j,G;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=n.feature,l=n.footprintExtent,u=n.options,c=s.attributes,h=c.cameraHeight,v=c.cameraOrientation,y=c.cameraPitch,w=c.cameraRoll,_=c.elevationSource,C=c.horizontalFieldOfView,Z=c.location,x=c.verticalFieldOfView,M=s.elevationSample,k=(0,b.I6)(v),S=(0,b.o4)(C,x,null!==w&&void 0!==w?w:0),P=S.vfov,z=new d.Z(Z),O=!1,k&&(z=new d.Z((0,b.c4)(z,[v.latitude,v.longitude,v.ellipsoidRadius,v.squaredEccentricity]))),z.spatialReference.isWGS84&&(O=!0,z=(0,f.$)(z)),V=(0,b.lj)(z),T=R(n,z,V),E=k?T.map((function(e){return(0,f.Sx)(new d.Z(e))})):T,e.next=8,(0,g.y5)(E,n,!0).then((function(e){return e.map((function(e){return{x:e.x,y:e.y,z:1}}))}));case 8:N=e.sent,D=new Array,L=(0,a.Z)(t),e.prev=11,G=(0,i.Z)().mark((function e(){var t,a,c,v,w,C,Z,x,S,R,T;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=j.value,a=(0,r.Z)((0,r.Z)({},t),{},{z:1}),c=(0,r.Z)((0,r.Z)({},(0,b.NT)(a,N,E)),{},{spatialReference:z.spatialReference}),e.next=5,(0,g.y5)([k?(0,f.Sx)(new d.Z(c)):new d.Z(c)],n,!0);case 5:return v=e.sent,w=(0,o.Z)(v,1),C=w[0],e.next=10,A(a,C,N,E,z,c,k,n);case 10:if((Z=s.attributes.clone()).geometry=z.clone(),x=(0,m.QX)(Z),S=x.polygon,R=S.rings[0].map((function(e){return new d.Z(e,S.spatialReference)})),e.t0=p.projectWithZConversion,!_&&!M){e.next=22;break}return e.next=19,I({cameraLocation:z,groundFootPrint:R,projectedPoint:c,webMercatorScalingFactor:V,vfov:P,shouldConvertToLatLong:O,isCameraOrientationLTP:k,imgPoint:a},n);case 19:e.t1=e.sent,e.next=23;break;case 22:e.t1=new d.Z(F(c,z,V,z.z-h,y,P,O));case 23:return e.t2=e.t1,e.t3=l.spatialReference,e.t4=u,e.next=28,(0,e.t0)(e.t2,e.t3,e.t4);case 28:T=e.sent,D.push(T);case 30:case"end":return e.stop()}}),e)})),L.s();case 14:if((j=L.n()).done){e.next=18;break}return e.delegateYield(G(),"t0",16);case 16:e.next=14;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(11),L.e(e.t1);case 23:return e.prev=23,L.f(),e.finish(23);case 26:return e.abrupt("return",D);case 27:case"end":return e.stop()}}),e,null,[[11,20,23,26]])})))).apply(this,arguments)}function I(e,t){return S.apply(this,arguments)}function S(){return(S=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,a,s,l,u,c,h,v,m,y,b,w,_,Z,x,M,k,I;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.cameraLocation,s=t.groundFootPrint,l=t.projectedPoint,u=t.webMercatorScalingFactor,c=t.vfov,h=t.shouldConvertToLatLong,v=t.isCameraOrientationLTP,m=t.imgPoint,y=n.feature.attributes,b=y.cameraHeight,w=y.cameraPitch,e.next=3,(0,p.initializeProjection)(a.spatialReference,n.footprintExtent.spatialReference,null,n.options);case 3:return e.next=5,z(s,n);case 5:_=e.sent,Z=0,x=(null!==(r=a.z)&&void 0!==r?r:0)-b,M=0,k=(0,i.Z)().mark((function e(){var t,r,s,p,y,b,k,I,S,R,z;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=T(_,a,l))&&P([a.x,a.y,a.z],[s.x,s.y,s.z],[l.x,l.y,l.z])){e.next=3;break}return e.abrupt("return",{v:new d.Z(F(l,a,u,x,w,c,h))});case 3:return p=new d.Z({x:s.x,y:s.y,z:s.z,spatialReference:a.spatialReference}),e.next=6,(0,g.y5)([v?(0,f.Sx)(p):p],n);case 6:if(y=e.sent,Z=Math.abs(m.x-y[0].x)+Math.abs(m.y-y[0].y),x=s.z,!(Z<=1)){e.next=9;break}return e.abrupt("return",{v:new d.Z(F(l,a,u,x,w,c,h))});case 9:if(M+=1,b=_.extent,k=(null!==(t=null===b||void 0===b?void 0:b.width)&&void 0!==t?t:0)/10,I=(null!==(r=null===b||void 0===b?void 0:b.height)&&void 0!==r?r:0)/10,!(k<1||I<1)){e.next=13;break}return e.abrupt("return",{v:new d.Z(F(l,a,u,x,w,c,h))});case 13:return S=s.x,R=s.y,e.next=17,(0,g.sg)(E(k,I).map((function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1];return new d.Z({x:S+n,y:R+r,spatialReference:a.spatialReference})})),n,!1);case 17:(z=e.sent).push(z[0]),_=new C.Z({rings:[z.map((function(e){return e.toArray()}))],spatialReference:a.spatialReference});case 19:case"end":return e.stop()}}),e)}));case 10:if(!(M<10)){e.next=17;break}return e.delegateYield(k(),"t0",12);case 12:if("object"!==typeof(I=e.t0)){e.next=15;break}return e.abrupt("return",I.v);case 15:e.next=10;break;case 17:return e.abrupt("return",new d.Z(F(l,a,u,x,w,c,h)));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=function(e,t,n){return(0,c.m)((0,c.z)((0,u.ll)(),t,e),(0,c.z)((0,u.ll)(),n,e))>0};function F(e,t,n,r,i,a,o){var s=Math.sqrt(Math.pow(e.z-t.z,2)+Math.pow(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))/n,2))*n,l=(0,b.SW)((0,c.z)((0,u.ll)(),[e.x,e.y,e.z],[t.x,t.y,t.z]),1/s,1/n);if(e.z<r||i+a/2<90){var p=Math.abs((t.z-r)/-l[2])*n,h=(0,b.s3)([t.x,t.y,t.z],l,p,n);e.x=h[0],e.y=h[1],e.z=h[2]}else e.z=r;return o?(0,f.Sx)(new d.Z(e)).toJSON():e}function R(e,t,n){var r,i=e.feature.attributes,a=2*Math.tan((0,l.Vl)(i.verticalFieldOfView)/2)*i.farDistance*n,s=2*Math.tan((0,l.Vl)(i.horizontalFieldOfView)/2)*i.farDistance*n,p=(0,b.oE)("HPR",[i.cameraHeading,i.cameraPitch,null!==(r=i.cameraRoll)&&void 0!==r?r:0]),h=(0,b.kK)([0,0,-1],p),v=(0,b.s3)([t.x,t.y,t.z],h,i.farDistance*n,n),f=(0,b.kK)([0,1,0],p),m=(0,b.kK)([1,0,0],p),y=(0,b.SW)(f,a/2,n),g=(0,b.SW)(m,s/2,n),w=(0,c.z)((0,u.ll)(),y,g),_=(0,c.g)((0,u.ll)(),y,g);return[(0,c.g)((0,u.ll)(),v,w),(0,c.g)((0,u.ll)(),v,_),(0,c.z)((0,u.ll)(),v,w),(0,c.z)((0,u.ll)(),v,_)].map((function(e){var n=(0,o.Z)(e,3),r=n[0],i=n[1],a=n[2];return new d.Z({x:r,y:i,z:a,spatialReference:t.spatialReference})}))}function z(e,t){return O.apply(this,arguments)}function O(){return(O=(0,s.Z)((0,i.Z)().mark((function e(t,n){var r,a,o,s,l,u,c,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[0].spatialReference.isWGS84?Z.Z.WebMercator:t[0].spatialReference,a=n.feature.attributes,o=a.cameraHeight,s=a.location,l=a.elevation,u="number"==typeof s.z&&"number"==typeof l?s.z-l:o,c=(0,m.wM)(t.map((function(e){return[e.x,e.y,e.z]})),u,s,(0,b.lj)(s)),e.next=9,(0,g.sg)(c.map((function(e){return new d.Z(e,s.spatialReference)})),n,!1);case 9:return h=e.sent.map((function(e){return(0,p.project)(e,r)})),e.abrupt("return",new C.Z({hasZ:!0,rings:[h.map((function(e){return[e.x,e.y,e.z]}))],spatialReference:r}));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,n,r,i,a,o,s){return V.apply(this,arguments)}function V(){return(V=(0,s.Z)((0,i.Z)().mark((function e(t,n,a,s,l,u,c,p){var h,v,m,y,w,_,C,Z,x,M,k,I,S,P,F,R,z,O,A,V,T;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h=0,v=8,m=0;case 3:if(!(m<=v)){e.next=35;break}if(!((h=Math.abs(t.x-n.x)+Math.abs(t.y-n.y))<=1)){e.next=6;break}return e.abrupt("return");case 6:return _=E(h,h).map((function(e){var n=(0,o.Z)(e,2),i=n[0],u=n[1];return(0,r.Z)((0,r.Z)({},(0,b.E7)({x:t.x+i,y:t.y+u,z:1},a[0],a[1],a[2],a[3],{x:s[0].x,y:s[0].y,z:s[0].z},{x:s[1].x,y:s[1].y,z:s[1].z},{x:s[2].x,y:s[2].y,z:s[2].z},{x:s[3].x,y:s[3].y,z:s[3].z})),{},{spatialReference:l.spatialReference})})),C=(0,o.Z)(_,4),Z=C[0],x=C[1],M=C[2],k=C[3],e.next=14,(0,g.y5)(c?[(0,f.Sx)(new d.Z(Z)),(0,f.Sx)(new d.Z(x)),(0,f.Sx)(new d.Z(M)),(0,f.Sx)(new d.Z(k))]:[new d.Z(Z),new d.Z(x),new d.Z(M),new d.Z(k)],p,!0).then((function(e){return e.map((function(e){return(0,r.Z)((0,r.Z)({},e),{},{z:0})}))}));case 14:return I=e.sent,S=(0,o.Z)(I,4),P=S[0],F=S[1],R=S[2],z=S[3],O=(0,b.E7)(t,P,F,R,z,Z,x,M,k),A=O.x,V=O.y,T=O.z,u.x=A,u.y=V,u.z=T,e.next=29,(0,g.y5)([c?(0,f.Sx)(new d.Z(u)):new d.Z(u)],p,!0);case 29:y=e.sent,w=(0,o.Z)(y,1),n=w[0];case 32:m+=1,e.next=3;break;case 35:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n){var r=e.rings[0][0][0],i=e.rings[0][0][1],a=e.rings[0][0][2],o=e.rings[0][1][0],s=e.rings[0][1][1],l=e.rings[0][1][2],u=e.rings[0][1][0],c=e.rings[0][1][1],d=e.rings[0][1][2],p=e.rings[0][2][0],h=e.rings[0][2][1],v=e.rings[0][2][2],f=(v-d)*(s-i)-(h-c)*(l-a),m=-((v-d)*(o-r)-(l-a)*(p-u)),y=(h-c)*(o-r)-(s-i)*(p-u),g=-(f*r+m*i+y*a);return(0,b.Gm)(t.toJSON(),n,f,m,y,g)}var E=function(e,t){return[[-e,-t],[e,-t],[e,t],[-e,t]]}},46426:function(e,t,n){n.d(t,{E7:function(){return m},Gm:function(){return Z},I6:function(){return V},If:function(){return I},NT:function(){return f},SA:function(){return x},SW:function(){return b},Xt:function(){return A},_6:function(){return z},c4:function(){return M},cZ:function(){return P},e4:function(){return S},kK:function(){return w},lj:function(){return k},mV:function(){return F},n_:function(){return R},o4:function(){return C},oE:function(){return _},s3:function(){return g}});var r=n(74165),i=n(15861),a=n(29439),o=(n(59486),n(16889)),s=n(21389),l=n(7025),u=n(12400),c=n(29134),d=n(79803),p=n(22186),h=n(92975),v=(n(81753),n(49885));n(848);function f(e,t,n){var r=(0,a.Z)(t,4),i=r[0],o=r[1],s=r[2],l=r[3],u=(0,a.Z)(n,4);return m(e,i,o,s,l,u[0],u[1],u[2],u[3])}function m(e,t,n,r,i,a,o,s,u){var d,p,h,v,f,m,g,b,w=!1;0===t.z&&0===n.z&&0===r.z&&0===i.z&&(t.z=n.z=r.z=i.z=1,e.z=1),t.z=null!==(d=t.z)&&void 0!==d?d:1,n.z=null!==(p=n.z)&&void 0!==p?p:1,r.z=null!==(h=r.z)&&void 0!==h?h:1,i.z=null!==(v=i.z)&&void 0!==v?v:1,0===a.z&&0===o.z&&0===s.z&&0===u.z&&(w=!0,a.z=o.z=s.z=u.z=1),a.z=null!==(f=a.z)&&void 0!==f?f:1,o.z=null!==(m=o.z)&&void 0!==m?m:1,s.z=null!==(g=s.z)&&void 0!==g?g:1,u.z=null!==(b=u.z)&&void 0!==b?b:1;var _=y(t,n,r,i),C=y(a,o,s,u),Z=(0,c.iS)((0,l.Ue)(),_),x=(0,l.Ue)();x[0]=C[0]*Z[0]+C[1]*Z[4]+C[2]*Z[8]+C[3]*Z[12],x[1]=C[0]*Z[1]+C[1]*Z[5]+C[2]*Z[9]+C[3]*Z[13],x[2]=C[0]*Z[2]+C[1]*Z[6]+C[2]*Z[10]+C[3]*Z[14],x[3]=C[0]*Z[3]+C[1]*Z[7]+C[2]*Z[11]+C[3]*Z[15],x[4]=C[4]*Z[0]+C[5]*Z[4]+C[6]*Z[8]+C[7]*Z[12],x[5]=C[4]*Z[1]+C[5]*Z[5]+C[6]*Z[9]+C[7]*Z[13],x[6]=C[4]*Z[2]+C[5]*Z[6]+C[6]*Z[10]+C[7]*Z[14],x[7]=C[4]*Z[3]+C[5]*Z[7]+C[6]*Z[11]+C[7]*Z[15],x[8]=C[8]*Z[0]+C[9]*Z[4]+C[10]*Z[8]+C[11]*Z[12],x[9]=C[8]*Z[1]+C[9]*Z[5]+C[10]*Z[9]+C[11]*Z[13],x[10]=C[8]*Z[2]+C[9]*Z[6]+C[10]*Z[10]+C[11]*Z[14],x[11]=C[8]*Z[3]+C[9]*Z[7]+C[10]*Z[11]+C[11]*Z[15],x[12]=C[12]*Z[0]+C[13]*Z[4]+C[14]*Z[8]+C[15]*Z[12],x[13]=C[12]*Z[1]+C[13]*Z[5]+C[14]*Z[9]+C[15]*Z[13],x[14]=C[12]*Z[2]+C[13]*Z[6]+C[14]*Z[10]+C[15]*Z[14],x[15]=C[12]*Z[3]+C[13]*Z[7]+C[14]*Z[11]+C[15]*Z[15];var M=x[0]*e.x+x[1]*e.y+x[2]*e.z+x[3],k=x[4]*e.x+x[5]*e.y+x[6]*e.z+x[7],I=x[8]*e.x+x[9]*e.y+x[10]*e.z+x[11],S=x[12]*e.x+x[13]*e.y+x[14]*e.z+x[15];return 0===S&&(S=1),{x:M/S,y:k/S,z:w?0:I/S}}function y(e,t,n,r){var i=function(e,t){var n=(0,a.Z)(e,4),r=n[0],i=n[1],o=n[2],s=n[3],l=new Array(4);return l[0]=r*t[0]+i*t[1]+o*t[2]+s*t[3],l[1]=r*t[4]+i*t[5]+o*t[6]+s*t[7],l[2]=r*t[8]+i*t[9]+o*t[10]+s*t[11],l[3]=r*t[12]+i*t[13]+o*t[14]+s*t[15],l}([r.x,r.y,r.z,1],(0,c.iS)(new Array(16),[e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,1,1,1,1])),o=i[0],s=i[1],l=i[2],u=new Array(16);return u[0]=o*e.x,u[1]=s*t.x,u[2]=l*n.x,u[3]=0,u[4]=o*e.y,u[5]=s*t.y,u[6]=l*n.y,u[7]=0,u[8]=o*e.z,u[9]=s*t.z,u[10]=l*n.z,u[11]=0,u[12]=o,u[13]=s,u[14]=l,u[15]=1,u}function g(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,u.ll)();return i[0]=e[0]+t[0]*n,i[1]=e[1]+t[1]*n,i[2]=e[2]+t[2]*(n/r),i}function b(e,t,n){var r=(0,u.ll)();return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*(t/n),r}function w(e,t){var n=(0,a.Z)(e,3),r=n[0],i=n[1],o=n[2],s=(0,u.ll)();return s[0]=r*t[0]+i*t[3]+o*t[6],s[1]=r*t[1]+i*t[4]+o*t[7],s[2]=r*t[2]+i*t[5]+o*t[8],s}function _(e,t){var n=Math.PI/180,r=(0,s.Ue)();if("OPK"===e){var i=Number(t[0])*n,a=Number(t[1])*n,o=Number(t[2])*n;r[0]=Math.cos(a)*Math.cos(o),r[1]=Math.cos(i)*Math.sin(o)+Math.sin(i)*Math.sin(a)*Math.cos(o),r[2]=Math.sin(i)*Math.sin(o)-Math.cos(i)*Math.sin(a)*Math.cos(o),r[3]=-Math.cos(a)*Math.sin(o),r[4]=Math.cos(i)*Math.cos(o)-Math.sin(i)*Math.sin(a)*Math.sin(o),r[5]=Math.sin(i)*Math.cos(o)+Math.cos(i)*Math.sin(a)*Math.sin(o),r[6]=Math.sin(a),r[7]=-Math.sin(i)*Math.cos(a),r[8]=Math.cos(i)*Math.cos(a)}else{var l=Number(t[0])*n,u=Number(t[1])*n,c=Number(t[2])*n;r[0]=Math.cos(l)*Math.cos(c)-Math.sin(l)*Math.cos(u)*Math.sin(c),r[1]=Math.sin(l)*Math.cos(c)*-1-Math.cos(l)*Math.cos(u)*Math.sin(c),r[2]=Math.sin(c)*Math.sin(u)*-1,r[3]=Math.cos(l)*Math.sin(c)+Math.sin(l)*Math.cos(u)*Math.cos(c),r[4]=Math.sin(l)*Math.sin(c)*-1+Math.cos(l)*Math.cos(u)*Math.cos(c),r[5]=Math.cos(c)*Math.sin(u),r[6]=Math.sin(l)*Math.sin(u)*-1,r[7]=Math.cos(l)*Math.sin(u)*-1,r[8]=Math.cos(u)}return r}function C(e,t,n){var r=Math.sin(n*Math.PI/180),i=Math.cos(n*Math.PI/180),a=[[e,0],[e,t],[0,t]];a.forEach((function(e,t){a[t]=[i*e[0]-r*e[1],r*e[0]+i*e[1]]}));var o=Math.min(0,a[0][0],a[1][0],a[2][0]),s=Math.max(0,a[0][0],a[1][0],a[2][0]),l=Math.min(0,a[0][1],a[1][1],a[2][1]),u=Math.max(0,a[0][1],a[1][1],a[2][1]);return{hfov:Math.abs(s-o),vfov:Math.abs(u-l)}}function Z(e,t,n,r,i,a){var o=n*(t.x-e.x)+r*(t.y-e.y)+i*(t.z-e.z);if(0===o)return null;var s=-(n*e.x+r*e.y+i*e.z+a)/o;return{x:e.x+s*(t.x-e.x),y:e.y+s*(t.y-e.y),z:e.z+s*(t.z-e.z)}}function x(e,t){var n=Math.PI/180,r=e.y*n,i=e.x*n,a=e.z||0,o=t[0]*n,s=t[1]*n,l=t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(o),2)),u=i-s,c=t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(r),2)),d=t[3]*(l*Math.sin(o)-c*Math.sin(r));return{x:(c+a)*Math.cos(r)*Math.sin(u),y:(c+a)*(Math.sin(r)*Math.cos(o)-Math.sin(o)*Math.cos(r)*Math.cos(u))+d*Math.cos(o),z:(c+a)*(Math.sin(r)*Math.sin(o)+Math.cos(o)*Math.cos(r)*Math.cos(u))-l+d*Math.sin(o)}}function M(e,t){var n=Math.PI/180,r=Number(e.x),i=Number(e.y),a=Number(e.z),o=t[0]*n,s=t[1]*n,l=t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(o),2)),u=r/l,c=i/l,d=a/l,p=Math.cos(o)-Math.sin(o)*c+Math.cos(o)*d,h=Math.sin(o)+Math.cos(o)*c+Math.sin(o)*d,v=Math.sqrt(Math.pow(p,2)+Math.pow(u,2)),f=t[3]*l*Math.sin(o),m=o,y=Math.atan(h/v-(f-t[3]*(t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(m),2)))*Math.sin(m))/(l*v)),g=Math.atan(h/v-(f-t[3]*(t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(y),2)))*Math.sin(y))/(l*v)),b=Math.atan(h/v-(f-t[3]*(t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(g),2)))*Math.sin(g))/(l*v)),w=Math.atan(h/v-(f-t[3]*(t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(b),2)))*Math.sin(b))/(l*v)),_=Math.atan(r/(l*p))+s;return{x:_/n,y:w/n,z:r/(Math.cos(w)*Math.sin(_-s))-t[2]/Math.sqrt(1-t[3]*Math.pow(Math.sin(w),2)),spatialReference:{wkid:4326}}}function k(e){return e&&(0,h.sS)(null===e||void 0===e?void 0:e.spatialReference)?1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*e.y/p.sv.radius))):1}function I(e,t,n){var r=360/t,i=180/n;return{heading:(e.x-t/2)*r,pitch:90-(e.y-n/2)*i}}function S(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v.SL/2,i=F(e,r),a=i.heading,o=i.pitch;return P(a,o,t,n)}function P(e,t,n,r){return{x:n/2+e/(360/n),y:r-t/(180/r),heading:e,pitch:t}}function F(e,t){var n=(0,o.BV)(Math.acos(-e.z/t));return{heading:(0,o.BV)(Math.atan2(e.x,e.y)),pitch:n}}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.SL/2;return[n*(Math.sin((0,o.Vl)(e))*Math.sin((0,o.Vl)(t))),n*(Math.cos((0,o.Vl)(e))*Math.sin((0,o.Vl)(t))),n*Math.cos((0,o.Vl)(180-t))]}function z(e,t,n){return O.apply(this,arguments)}function O(){return(O=(0,i.Z)((0,r.Z)().mark((function e(t,n,i){var a,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.initializeProjection)(n.spatialReference,t.spatialReference,null,i);case 2:return e.next=4,(0,d.projectWithZConversion)(n,t.spatialReference,i);case 4:return a=e.sent,s=(0,o.BV)(Math.atan2(a.y-t.y,a.x-t.x)),e.abrupt("return",s=s>=0&&s<=90?90-s:s>90&&s<=180?360-s+90:90+Math.abs(s));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,n){var r=Math.cos(n),i=Math.sin(n),a=[1,0,0,1,0,0],o=a[0]*r+a[2]*i,s=a[1]*r+a[3]*i,l=-a[0]*i+a[2]*r,u=-a[1]*i+a[3]*r;return a[0]=o,a[1]=s,a[2]=l,a[3]=u,[e*a[0]+t*a[2]+a[4],e*a[1]+t*a[3]+a[5]]}function V(e){return 4===(null===e||void 0===e?void 0:e.type)}},76081:function(e,t,n){n.d(t,{R:function(){return o}});var r=n(15671),i=n(43144),a=n(11939),o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if((0,r.Z)(this,e),this.tile=t,null!=n&&null!=t){var i=t.extent;this._samplerData=new a.K(n,i)}}return(0,i.Z)(e,[{key:"zmin",get:function(){return null!=this._samplerData?this._samplerData.data.minValue:0}},{key:"zmax",get:function(){return null!=this._samplerData?this._samplerData.data.maxValue:0}},{key:"hasNoDataValues",get:function(){var e;return!(null===(e=this._samplerData)||void 0===e||!e.data.hasNoDataValues)}},{key:"sample",value:function(e,t){if(null!=this._samplerData){var n=this._samplerData,r=n.safeWidth,i=n.data,a=n.dx,o=n.dy,l=n.y1,u=n.x0,c=i.width,d=i.values,p=i.noDataValue,h=s(o*(l-t),0,r),v=s(a*(e-u),0,r),f=Math.floor(h),m=Math.floor(v),y=f*c+m,g=y+c,b=d[y],w=d[g],_=d[y+1],C=d[g+1];if(b!==p&&w!==p&&_!==p&&C!==p){var Z=v-m,x=b+(_-b)*Z;return x+(w+(C-w)*Z-x)*(h-f)}}}}]),e}();function s(e,t,n){return e<t?t:e>n?n:e}},48932:function(e,t,n){n.d(t,{v:function(){return o}});var r=n(37762),i=n(15671),a=n(43144),o=function(){function e(t,n,r,a){(0,i.Z)(this,e),this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in t?(this.values=t.pixelData,this.width=t.width,this.height=t.height,this.noDataValue=t.noDataValue):(this.values=t,this.width=n,this.height=r,this.noDataValue=a)}return(0,a.Z)(e,[{key:"hasNoDataValues",get:function(){if(null==this._hasNoDataValues){var e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}},{key:"minValue",get:function(){return this._ensureBounds(),this._minValue}},{key:"maxValue",get:function(){return this._ensureBounds(),this._maxValue}},{key:"_ensureBounds",value:function(){if(null==this._minValue){var e,t=this.noDataValue,n=this.values,i=1/0,a=-1/0,o=!0,s=(0,r.Z)(n);try{for(s.s();!(e=s.n()).done;){var l=e.value;l===t?this._hasNoDataValues=!0:(i=l<i?l:i,a=l>a?l:a,o=!1)}}catch(u){s.e(u)}finally{s.f()}o?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=a>-3e38?a:0)}}}]),e}()},41665:function(e,t,n){n.d(t,{w:function(){return u}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,r.Z)(this,n),(e=t.call(this,"LercWorker","_decode",{_decode:function(e){return[e.buffer]}},i,{strategy:"dedicated"})).schedule=i,e.ref=0,e}return(0,i.Z)(n,[{key:"decode",value:function(e,t,n){return e&&0!==e.byteLength?this.invoke({buffer:e,options:t},n):Promise.resolve(null)}},{key:"release",value:function(){var e=this;--this.ref<=0&&(l.forEach((function(t,n){t===e&&l.delete(n)})),this.destroy())}}]),n}(n(46798).q),l=new Map;function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=l.get(e);return t||(null!=e?(t=new s((function(t){return e.immediate.schedule(t)})),l.set(e,t)):(t=new s,l.set(null,t))),++t.ref,t}},53184:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(74165),i=n(15861),a=n(15671),o=n(43144),s=n(10064),l=n(66978),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.lods[t.lods.length-1].level;(0,a.Z)(this,e),this.tileInfo=t,this.minLOD=n,this.maxLOD=r,t.lodAt(n)||(this.minLOD=t.lods[0].level),t.lodAt(r)||(this.maxLOD=t.lods[t.lods.length-1].level)}return(0,o.Z)(e,[{key:"effectiveMinLOD",get:function(){var e;return null!==(e=this.minLOD)&&void 0!==e?e:this.tileInfo.lods[0].level}},{key:"effectiveMaxLOD",get:function(){var e;return null!==(e=this.maxLOD)&&void 0!==e?e:this.tileInfo.lods[this.tileInfo.lods.length-1].level}},{key:"getAvailability",value:function(e,t,n){var r,i=null===(r=this.tileInfo)||void 0===r?void 0:r.lodAt(e);return!i||e<this.minLOD||e>this.maxLOD?"unavailable":i.cols&&i.rows?n>=i.cols[0]&&n<=i.cols[1]&&t>=i.rows[0]&&t<=i.rows[1]?"unknown":"unavailable":"unknown"}},{key:"fetchAvailability",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a){var o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Yn)(a);case 2:if("unavailable"!==(o=this.getAvailability(t,n,i))){e.next=5;break}throw new s.Z("tile-map:tile-unavailable","Tile is not available",{level:t,row:n,col:i});case 5:return e.abrupt("return",o);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"fetchAvailabilityUpsample",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a,o){var s,u=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.Yn)(o);case 2:return a.level=t,a.row=n,a.col=i,s=this.tileInfo,e.abrupt("return",(s.updateTileInfo(a),this.fetchAvailability(t,n,i,o).catch((function(e){if((0,l.D_)(e))throw e;if(s.upsampleTile(a))return u.fetchAvailabilityUpsample(a.level,a.row,a.col,a,o);throw e}))));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,a){return e.apply(this,arguments)}}()}]),e}()},18277:function(e,t,n){n.d(t,{$6:function(){return y},$z:function(){return o},F7:function(){return a},Ow:function(){return u},S0:function(){return l},d1:function(){return c},dm:function(){return d},ir:function(){return s}});var r=n(93433),i=[["binary","application/octet-stream","bin",""]];function a(e,t){var n;return null!=h(t.name,null!==(n=null===e||void 0===e?void 0:e.supportedFormats)&&void 0!==n?n:[])}function o(e,t){var n;if(!e)return!1;var r=d(t,null!==(n=e.supportedFormats)&&void 0!==n?n:[]);return null!=r&&e.editFormats.includes(r)}function s(e){var t;return p(null!==(t=null===e||void 0===e?void 0:e.supportedFormats)&&void 0!==t?t:[]).flatMap(m).map((function(e){return".".concat(e)}))}function l(e,t){return v(function(e,t){var n=e.toLowerCase();return p(t).find((function(e){return f(e)===n}))}(e,t))}function u(e,t){return v(h(e,t))}function c(e,t){return f(function(e,t){return p(t).find((function(t){return v(t)===e}))}(e,t))}function d(e,t){var n;return null!==(n=u(e.name,t))&&void 0!==n?n:l(e.type,t)}function p(e){return[].concat(i,(0,r.Z)(e))}function h(e,t){var n=e.toLowerCase();return p(t).find((function(e){return m(e).some((function(e){return n.endsWith(e)}))}))}function v(e){return null===e||void 0===e?void 0:e[0]}function f(e){return null===e||void 0===e?void 0:e[1].toLowerCase()}function m(e){var t;return null!==(t=null===e||void 0===e?void 0:e[2].split(",").map((function(e){return e.toLowerCase()})))&&void 0!==t?t:[]}function y(e){var t;return null===(t=e.tables)||void 0===t?void 0:t.find((function(e){return"assetMaps"===e.role}))}},41226:function(e,t,n){n.d(t,{T:function(){return s}});var r=n(74165),i=n(1413),a=n(15861),o=n(76200);function s(e,t){return l.apply(this,arguments)}function l(){return l=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.Z)(t,{responseType:"json",query:(0,i.Z)((0,i.Z)({f:"json"},null===n||void 0===n?void 0:n.customParameters),{},{token:null===n||void 0===n?void 0:n.apiKey})});case 2:return a=e.sent,s=a.data,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}},86856:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ot}});var r=n(4942),i=n(93433),a=n(74165),o=n(15861),s=n(29439),l=n(15671),u=n(43144),c=n(97326),d=n(60136),p=n(29388),h=n(27366),v=(n(59166),n(90193)),f=n(44927),m=n(32718),y=n(16889),g=n(94172),b=n(49861),w=(n(93169),n(84936),n(69912)),_=n(46426),C=n(70047),Z=n(33565);function x(e,t,n,r){return[[[n-e/Math.SQRT2,r-e/Math.SQRT2],[n+e/Math.SQRT2,r-e/Math.SQRT2],[n+t/Math.SQRT2,r-t/Math.SQRT2],[n-t/Math.SQRT2,r-t/Math.SQRT2]],[[n+e/Math.SQRT2,r-e/Math.SQRT2],[n+e/Math.SQRT2,r+e/Math.SQRT2],[n+t/Math.SQRT2,r+t/Math.SQRT2],[n+t/Math.SQRT2,r-t/Math.SQRT2]],[[n+e/Math.SQRT2,r+e/Math.SQRT2],[n-e/Math.SQRT2,r+e/Math.SQRT2],[n-t/Math.SQRT2,r+t/Math.SQRT2],[n+t/Math.SQRT2,r+t/Math.SQRT2]],[[n-e/Math.SQRT2,r+e/Math.SQRT2],[n-e/Math.SQRT2,r-e/Math.SQRT2],[n-t/Math.SQRT2,r-t/Math.SQRT2],[n-t/Math.SQRT2,r+t/Math.SQRT2]]]}function M(e,t,n){var r=(0,s.Z)(e,4),i=r[0],a=r[1],o=r[2],l=r[3];return"M ".concat(i.join(" ")," A ").concat(t," ").concat(t," 0 0 1 ").concat(a.join(" ")," L ").concat(o.join(" ")," A ").concat(n," ").concat(n," 0 0 0 ").concat(l.join(" ")," Z")}function k(e,t,n){var r=[].concat((0,i.Z)(e),[0]),a=r[0],o=r[1],s=r[2],l=r[3];return[].concat((0,i.Z)(x(a,o,t,n).map((function(e){return M(e,a,o)}))),(0,i.Z)(x(o,s,t,n).map((function(e){return M(e,o,s)}))),(0,i.Z)(x(s,l,t,n).map((function(e){return M(e,s,l)}))))}var I="esri-oriented-imagery-viewer",S="".concat(I,"__carousel"),P="".concat(I,"__image-enhancement"),F="".concat(I,"__navigation"),R={addCoverage:"".concat(I,"__body-additional-coverage"),addExpPoints:"".concat(I,"__body-additional-camera-locations"),body:"".concat(I,"__body"),carousel:"".concat(I,"__carousel"),carouselContainer:"".concat(S,"-container"),carouselContent:"".concat(S,"-content"),carouselItem:"".concat(S,"-item"),carouselItemWrapper:"".concat(S,"-item-wrapper"),close:"".concat(I,"__close"),currentCoverage:"".concat(I,"__body-current-coverage"),dock:"".concat(I,"--docked"),feature:"".concat(F,"-feature"),float:"".concat(I,"--floating"),footprint:"".concat(I,"__body-footprint"),imageEnhancementWrapper:"".concat(P,"-wrapper"),imageEnhancementTools:"".concat(P,"-tools"),imageEnhancementToolContainer:"".concat(P,"-tool-container"),messageBox:"".concat(I,"__message-box"),navigationPathOffset0:"".concat(F,"-feature-path-stop-offset-0"),navigationPathOffset1:"".concat(F,"-feature-path-stop-offset-1"),navigationWrapper:"".concat(F,"-wrapper"),navigationZoomed:"".concat(F,"-wrapper--zoomed"),north:"".concat(F,"-pointer-north"),outerSector:"".concat(F,"-sector-outer"),pointer:"".concat(F,"-pointer"),rotateWithAnimation:"".concat(F,"-animate"),selectedFeaturePath:"".concat(F,"-feature-path"),sector:"".concat(F,"-sector"),sectorCross:"".concat(F,"-sector-cross"),sectorDisabled:"".concat(F,"-sector-disabled"),sectorEnabled:"".concat(F,"-sector-enabled"),sectorSeparator:"".concat(F,"-sector-separator"),submenu:"".concat(I,"__submenu"),viewer:"".concat(I,"__viewer"),viewerContainer:"".concat(I,"__viewer-container")},z=[21,36,51,60],O=["FAR_WEST","FAR_NORTH","FAR_EAST","FAR_SOUTH","WEST","NORTH","EAST","SOUTH","NEAR_WEST","NEAR_NORTH","NEAR_EAST","NEAR_SOUTH"],A=23.937554159486076,V=96.06244584051393,T={EAST:[A,A,V,A,60,A],NORTH:[A,V,A,A,A,60],SOUTH:[V,A,V,V,V,60],WEST:[V,V,A,V,60,V]},E=n(37762),N=n(1413),D=(n(59486),n(52639)),L=n(63780),j=n(14921),G=n(80987),H=n(10064),W=n(91505),B=n(46784),q=n(84652),U=n(92026),K=n(66978),Q=n(77981),J=n(81753),Y=n(93655),$=n(15440),X=n(29754),ee=n(21149),te=n(53866),ne={};function re(e,t){return ie.apply(this,arguments)}function ie(){return ie=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,l,u,c,d,p,h,v,f,m,y,g,b;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=t.point,c=t.queryParams,null!=u){e.next=3;break}return e.abrupt("return",null);case 3:if(d={},p=t.layerInstanceOrURL,h=u.spatialReference.isGeographic?(0,J.$)(u.clone()):u.clone(),d.outSpatialReference=h.spatialReference,c&&(d.maxRecordCountFactor=null!==(r=c.maxRecordCountFactor)&&void 0!==r?r:5,d.outFields=null!==(i=c.outFields)&&void 0!==i?i:["*"],d.where=null!==(o=c.where)&&void 0!==o?o:"1=1",d.returnGeometry=null===(s=c.returnGeometry)||void 0===s||s,d.outSpatialReference=c.outSpatialReference),"string"==typeof p&&(ne.layer&&ne.layer.url===p?p=ne.layer:(null!==(l=ne.layer)&&void 0!==l&&l.destroy(),p=ne.layer=new $.default({url:p}))),!p){e.next=22;break}return e.prev=7,e.next=10,p.load();case 10:return m=p,y=oe(h,null!==(v=null!==(f=null===c||void 0===c?void 0:c.maximumDistance)&&void 0!==f?f:m.maximumDistance)&&void 0!==v?v:1e3),d.returnZ=m.hasZ,g=new ee.Z((0,N.Z)({geometry:y},d)),e.next=15,m.queryFeatures(g,n);case 15:return b=e.sent,e.abrupt("return",ae(m)(b));case 19:e.prev=19,e.t0=e.catch(7),(0,K.H9)(e.t0);case 22:return e.abrupt("return",null);case 23:case"end":return e.stop()}}),e,null,[[7,19]])}))),ie.apply(this,arguments)}function ae(e){return function(t){var n=t.features,r=t.spatialReference;return n.forEach((function(t){t.geometry&&(t.geometry.spatialReference=r);var n=X.Z.fromJSON((0,N.Z)((0,N.Z)({},t.toJSON()),{},{layer:e}));n&&(t.attributes=n),t.layer=e,t.spatialReference=r})),t}}function oe(e,t){var n=e.x-t,r=e.x+t,i=e.y-t,a=e.y+t;return new te.Z({xmin:n,xmax:r,ymin:i,ymax:a,spatialReference:e.spatialReference})}var se=n(22186),le=n(41258);function ue(e){var t,n=e.camera,r=e.features,i=e.selectedPoint;if(!r.length)return[];null!==(t=e.currentImage)&&void 0!==t||(e.currentImage={attributes:{cameraHeading:0,cameraPitch:0}});var a=function(e,t,n){var r,i;return null!==(r=t.z)&&void 0!==r||(t.z=0),null!==(i=t.elevation)&&void 0!==i||(t.elevation=0),function(r){var i,a,o,s,l,u,c=function(e,t){var n="isOblique"in e?e:new X.Z(e),r=n.isOblique,i=n.isSpherical,a=n.isNadir;return i?{hfovWeight:"2d"===t?0:1,vfovWeight:"2d"===t?0:.6,distanceWeight:"2d"===t?1:.5}:a?{hfovWeight:.25,vfovWeight:1,distanceWeight:1}:r?{hfovWeight:1,vfovWeight:.25,distanceWeight:1}:{hfovWeight:1,vfovWeight:1,distanceWeight:1}}(r.attributes,e?"3d":"2d"),d=c.hfovWeight,p=c.vfovWeight,h=c.distanceWeight,v=r.attributes,f=v.cameraHeight,m=v.cameraHeading,y=v.cameraPitch,g=v.farDistance,b=v.horizontalFieldOfView,w=v.verticalFieldOfView,_=v.isOblique,C=v.geometry,Z=180*Math.atan2(C.y-t.y,C.x-t.x)/Math.PI,x=(0,le.TE)(t,C),M=b,k=w,I=!1;e?(l=e.heading,u=e.tilt,M=180,k=180,I=!0):!_||y<10?(l=m,u=y,I=!1):(l=n.attributes.cameraHeading,u=y,I=!0,M=180),l>180&&(l-=360);var S=1;C.spatialReference.isWebMercator&&(S=1/Math.cos(Math.PI/2-2*Math.atan(Math.exp(-1*C.y/se.sv.radius))));var P=Math.sqrt(Math.pow(Math.sqrt(Math.pow(t.x-C.x,2)+Math.pow(t.y-C.y,2))/S,2)+Math.pow((null!==(i=t.z)&&void 0!==i?i:0)-(null!==(a=t.elevation)&&void 0!==a?a:0)-f,2)),F=90-180*Math.atan2(t.y-C.y,t.x-C.x)/Math.PI,R=(Math.abs(F-l)>180?Math.abs(360-Math.abs(F-l)):Math.abs(F-l))/M;R=4*R+1;var z=180*Math.acos((v.cameraHeight-(null!==(o=t.z)&&void 0!==o?o:0)+(null!==(s=t.elevation)&&void 0!==s?s:0))/P)/Math.PI,O=Math.abs(z-u)/k;O=4*O+1;var A,V=P/Math.sqrt(Math.pow(g,2)+Math.pow(f,2)),T=d*R+p*O+h*(V=4*V+1);if(I){var E=m>180?m-360:m;A=d*((Math.abs(F-E)>180?Math.abs(360-Math.abs(F-E)):Math.abs(F-E))/b*4+1)+p*(Math.abs(z-y)/w*4+1)+h*V}else A=T;return{suitability:T,trueSuitability:A,feature:r,angle:Z,distance:x,verticalAngle:Math.abs(180*Math.atan(x/f)/Math.PI)}}}(n,i,e.currentImage);return r.map(a)}var ce=n(64248),de=n(43780),pe=n(8835),he=n(99837),ve=n(1614),fe=n(63665),me=n(85276),ye=n(62565),ge=n(60762),be=n(76200),we=n(43404),_e=n(27135),Ce=n(29966);function Ze(e){return"3d"===(null===e||void 0===e?void 0:e.type)}function xe(e){return"esri.Graphic"===(null===e||void 0===e?void 0:e.declaredClass)}function Me(e){return/.*\.(tif|mrf)$/i.test(null!==e&&void 0!==e?e:"")}function ke(e){return"NoAttachmentError"===(null===e||void 0===e?void 0:e.name)}var Ie=function(e){return"".concat(e,":missing-property")},Se=function(e,t){return"Property ".concat(t," is missing in ").concat(e)},Pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"esri.widgets.OrientedImageryViewer",t=arguments.length>1?arguments[1]:void 0;throw m.Z.getLogger(e).error(t),t},Fe=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,be.Z)(t,(0,N.Z)((0,N.Z)({},n),{},{method:"head"}));case 3:return i=e.sent,e.abrupt("return",null===i||void 0===i||null===(r=i.getHeader)||void 0===r?void 0:r.call(i,"Content-Type"));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",(m.Z.getLogger("esri.widgets.OrientedImagery").error("failed to fetch Content-Type",e.t0),null));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}();function Re(e,t){0!==t&&(e.xmin/=t,e.xmax*=t,e.ymin/=t,e.ymax*=t)}var ze=n(49885),Oe=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e)).maxFOV=0,r.minFOV=0,r.view=null,r.zoomFactor=5,r}return(0,u.Z)(n,[{key:"canZoomIn",get:function(){return!!this.view&&(0===this.minFOV||this.view.camera.fov>this.minFOV)}},{key:"canZoomOut",get:function(){return!!this.view&&(0===this.maxFOV||this.view.camera.fov<this.maxFOV)}}]),n}((0,n(11582).J)(B.wq));(0,h._)([(0,b.Cb)({type:Boolean,readOnly:!0})],Oe.prototype,"canZoomIn",null),(0,h._)([(0,b.Cb)({type:Boolean,readOnly:!0})],Oe.prototype,"canZoomOut",null),(0,h._)([(0,b.Cb)({type:Number})],Oe.prototype,"maxFOV",void 0),(0,h._)([(0,b.Cb)({type:Number})],Oe.prototype,"minFOV",void 0),(0,h._)([(0,b.Cb)({type:me.default})],Oe.prototype,"view",void 0),(0,h._)([(0,b.Cb)({type:Number})],Oe.prototype,"zoomFactor",void 0);var Ae=Oe=(0,h._)([(0,w.j)("esri.widgets.PanoramicViewer.PanoramicZoomConditions")],Oe),Ve=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e)).panoramicZoomConditions=new Ae,r.zoomTo=function(e){r.view.camera.fov=r.constrainFOV(e),r.view.camera=r.view.camera.clone()},r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,g.watch)((function(){var t;return[null===(t=e.view)||void 0===t?void 0:t.ready,e.panoramicZoomConditions]}),(function(){var t;(null===(t=e.view)||void 0===t?void 0:t.ready)&&(e.panoramicZoomConditions.view=e.view,e.zoomTo(e.view.camera.fov))}),g.syncAndInitial),(0,g.watch)((function(){return[e.panoramicZoomConditions.maxFOV,e.panoramicZoomConditions.minFOV]}),(function(t){var n=(0,s.Z)(t,2),r=n[0],i=n[1];null!=r&&null!=i&&e.zoomTo(e.view.camera.fov)}),g.sync)])}},{key:"canZoomIn",get:function(){return this.panoramicZoomConditions.canZoomIn}},{key:"canZoomOut",get:function(){return this.panoramicZoomConditions.canZoomOut}},{key:"state",get:function(){var e;return null!==(e=this.view)&&void 0!==e&&e.ready?"ready":"disabled"}},{key:"view",set:function(e){this._set("view",e)}},{key:"constrainFOV",value:function(e){var t=this.panoramicZoomConditions,n=t.maxFOV,r=t.minFOV;return(0,y.uZ)(e,r,n)}},{key:"zoomIn",value:function(){if(this.canZoomIn){var e=this.view.camera.fov-this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}}},{key:"zoomOut",value:function(){if(this.canZoomOut){var e=this.view.camera.fov+this.panoramicZoomConditions.zoomFactor;this.zoomTo(e)}}}]),n}(n(58266).Z);(0,h._)([(0,b.Cb)()],Ve.prototype,"canZoomIn",null),(0,h._)([(0,b.Cb)()],Ve.prototype,"canZoomOut",null),(0,h._)([(0,b.Cb)({type:Ae})],Ve.prototype,"panoramicZoomConditions",void 0),(0,h._)([(0,b.Cb)()],Ve.prototype,"state",null),(0,h._)([(0,b.Cb)({type:me.default})],Ve.prototype,"view",null);var Te=Ve=(0,h._)([(0,w.j)("esri.widgets.PanoramicViewer.PanoramicZoomViewModel")],Ve),Ee=(n(51508),n(63899)),Ne=n(10891),De=n(79694),Le=n(16915),je=n(43977);function Ge(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ze.wz,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ze.SL,r=t.clone();r.z=-ze.SL/2;var i=Ee.Z.createSphere(r,{size:n,densificationFactor:2,vertexSpace:"georeferenced",material:new Ne.Z({colorTexture:new De.Z({data:e})})});if(i.components[0].trustSourceNormals=!0,i.vertexAttributes.uv)for(var a,o=null!==(a=i.vertexAttributes.uv.length)&&void 0!==a?a:0,s=0;s<o;s++)i.vertexAttributes.uv[2*s+0]=1-i.vertexAttributes.uv[2*s+0],i.vertexAttributes.uv[2*s+1]=i.vertexAttributes.uv[2*s+1];return i.centerAt(r),i}function He(e){return new D.Z({geometry:e,symbol:new Le.Z({symbolLayers:new G.Z([new je.Z])})})}function We(e,t){return 2*(0,y.BV)(Math.atan(Math.tan((0,y.Vl)(e/2))*Math.sqrt(Math.pow(t,2)+1)))}var Be=n(78952),qe="default",Ue="navigation",Ke="fov-constraint",Qe="image-click-action",Je=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e))._startPosition=null,r._targetPosition=null,r._graphics=new Y.default({elevationInfo:{mode:"relative-to-ground"}}),r._imageGraphic=null,r._loadController=null,r._map=new ge.Z({ground:new ye.Z({opacity:0,navigationConstraint:null}),layers:new G.Z([r._graphics])}),r._zoomViewModel=null,r.autoLoad=!1,r.clickAction="none",r.imageSize=null,r.imageSource=null,r.pitch=90,r.state="ready",r.yaw=0,r._addNavigationHandles=function(){r.imageRenderer.basemapTerrain.suspended=!0,r.imageRenderer.constraints.tilt.max=180,r.removeHandles(Ue),r.addHandles([r.imageRenderer.on("mouse-wheel",r._handleWheel),r.imageRenderer.on("double-click",r._handleDoubleClick),r.imageRenderer.on("drag",r._handleDrag),r.imageRenderer.on("key-down",(function(e){var t=e.key;["+","-","Shift","_","=","ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t)&&e.stopPropagation()}))],Ue)},r._addHFOVHandles=function(){r.removeHandles(Ke),r.addHandles((0,g.watch)((function(){return[r.maxHFOV,r.minHFOV]}),(function(){r._zoomViewModel&&(r._zoomViewModel.panoramicZoomConditions=new Ae({view:r.imageRenderer,maxFOV:r.maxHFOV,minFOV:r.minHFOV}))}),g.syncAndInitial),Ke)},r._addZoomHandles=function(){r._zoomViewModel=new Te({view:r.imageRenderer,panoramicZoomConditions:new Ae({maxFOV:r.maxHFOV,minFOV:r.minHFOV})});var e=new Ce.default({viewModel:r._zoomViewModel});r.imageRenderer.ui.add(e,"top-left"),r._addHFOVHandles()},r._cancelLoadWithController=function(){var e;null!==(e=r._loadController)&&void 0!==e&&e.abort(),r._loadController=null},r._handleDoubleClick=function(e){e.stopPropagation(),e.native.ctrlKey?r._zoomOut():r._zoomIn()},r._handleDrag=function(e){e.stopPropagation();var t=e.action,n=e.x,i=e.y;switch(t){case"start":r._startPosition=r._targetPosition={x:n,y:i};break;case"update":r._targetPosition={x:n,y:i},r._updateCameraHeadingAndTilt()}},r._handleImageClick=function(e){if("image-loaded"===r.state&&r.imageRenderer.ready)switch(r.clickAction){case"emit":e.stopPropagation(),r.emit("click",e);break;case"hittest":e.stopPropagation(),e.async((0,o.Z)((0,a.Z)().mark((function t(){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.imageRenderer.hitTest(e.screenPoint,{include:r._graphics});case 2:n=t.sent,r.emit("hittest-response",n);case 4:case"end":return t.stop()}}),t)}))));break;case"pixel-location":if(e.stopPropagation(),!r.imageSize||!e.mapPoint)return void r.emit("pixel-location",null);var t=(0,_.e4)(e.mapPoint,r.imageSize[0],r.imageSize[1]);r.emit("pixel-location",(0,N.Z)((0,N.Z)({},t),{},{spatialReference:Be.Z.WebMercator,meshVertex:e.mapPoint}))}},r._handleWheel=function(e){var t,n=null!==(t=e.deltaX)&&void 0!==t?t:e.native.deltaX;e.stopPropagation(),n>0||e.deltaY>0?r._zoomOut():r._zoomIn()},r._loadWithController=function(){r._cancelLoadWithController(),r._loadController=new AbortController,r.loadImage(r._loadController)},r._zoomIn=function(){var e;return null===(e=r._zoomViewModel)||void 0===e?void 0:e.zoomIn()},r._zoomOut=function(){var e;return null===(e=r._zoomViewModel)||void 0===e?void 0:e.zoomOut()},r.addGraphic=function(e,t){return"image-loaded"===r.state&&!r._graphics.graphics.includes(e)&&(r._graphics.graphics.add(e,t),!0)},r.addManyGraphics=function(e){if("image-loaded"!==r.state)return!1;var t=e.filter((function(e){return!r._graphics.graphics.includes(e)}));return r._graphics.graphics.addMany(t),!0},r.clearGraphics=function(){r._graphics.graphics.removeAll()},r.clearImage=function(){r.imageSize=null,r._removeImageSphere()},r.removeGraphic=function(e){return!("image-loaded"!==r.state||!r._graphics.graphics.includes(e))&&(r._graphics.remove(e),!0)},r.removeManyGraphics=function(e){if("image-loaded"!==r.state)return!1;var t=e.filter((function(e){return r._graphics.graphics.includes(e)}));return r._graphics.removeMany(t),!0},r._imageRenderer=new me.default({map:r._map,viewingMode:"local",camera:{position:ze.wz},environment:{atmosphereEnabled:!1,starsEnabled:!1,lighting:{type:"virtual"}},popupEnabled:!1,spatialReference:Be.Z.WebMercator,ui:{components:["attribution"]}}),r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.state="initialized",this.addHandles([(0,g.watch)((function(){return e.imageSource}),(function(){e.imageSource&&e.autoLoad&&e._loadWithController()}),g.syncAndInitial),(0,g.watch)((function(){return e.fov}),(function(){e._reloadCamera()}),g.syncAndInitial),(0,g.watch)((function(){return e.yaw}),(function(t){e.camera.heading=t,e._reloadCamera()}),g.syncAndInitial),(0,g.watch)((function(){return e.pitch}),(function(t){e.camera.tilt=t,e._reloadCamera()}),g.syncAndInitial),(0,g.when)((function(){return e.imageRenderer.ready}),(function(){e._addNavigationHandles(),e._addZoomHandles()}),g.syncAndInitial),(0,g.watch)((function(){return e.clickAction}),(function(t){e.removeHandles(Qe),"none"!==t&&e.addHandles(e.imageRenderer.on("click",e._handleImageClick))}),g.syncAndInitial)],qe)}},{key:"camera",get:function(){return this.imageRenderer.camera},set:function(e){e&&(this.imageRenderer.camera=e.clone())}},{key:"fov",get:function(){return this.camera.fov},set:function(e){var t;Number.isFinite(e)&&(null===(t=this._zoomViewModel)||void 0===t||t.zoomTo(e))}},{key:"hfov",get:function(){var e=this.camera.fov,t=(0,s.Z)(this.imageRenderer.size,2),n=t[0]/t[1],r=Math.atan(n);return 2*(0,y.BV)(Math.atan(Math.tan((0,y.Vl)(e/2))*Math.sin(r)))}},{key:"imageRenderer",get:function(){return this._imageRenderer}},{key:"maxHFOV",get:function(){var e=(0,s.Z)(this.imageRenderer.size,2),t=e[0],n=e[1];return We(ze.e1,t/n)}},{key:"minHFOV",get:function(){var e=(0,s.Z)(this.imageRenderer.size,2),t=e[0],n=e[1];return We(ze.Ex,t/n)}},{key:"vfov",get:function(){var e=this.camera.fov,t=(0,s.Z)(this.imageRenderer.size,2),n=t[0]/t[1],r=Math.atan(n);return 2*(0,y.BV)(Math.atan(Math.tan((0,y.Vl)(e/2))*Math.cos(r)))}},{key:"_loadImageInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state="image-loading",e.prev=1,e.next=4,(0,be.Z)(t,(0,N.Z)({responseType:"image"},n));case 4:r=e.sent.data,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),(0,K.D_)(e.t0)?this.state="image-load-aborted":this.state="image-load-error",e.t0;case 10:return e.abrupt("return",this._updateImageSphere(r,n));case 11:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_reloadCamera",value:function(){this.camera=this.camera.clone()}},{key:"_removeImageSphere",value:function(){this._imageGraphic&&(this._graphics.remove(this._imageGraphic),this._imageGraphic=(0,U.SC)(this._imageGraphic)),this.state="ready",this.imageSize=null}},{key:"_updateCameraHeadingAndTilt",value:function(){if(this._startPosition&&this._targetPosition){var e=this.camera.heading+(this._startPosition.x-this._targetPosition.x)/this.imageRenderer.width*this.camera.fov;this.yaw=(e+360)%360;var t=this.camera.tilt-(this._startPosition.y-this._targetPosition.y)/this.imageRenderer.height*this.imageRenderer.camera.tilt;this.pitch=Math.min(179.5,Math.max(.5,t)),this._startPosition=this._targetPosition}}},{key:"_updateImageSphere",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,K.Yn)(n);case 2:return r=(0,s.Z)(this.imageRenderer.size,2),i=r[0],o=r[1],e.abrupt("return",(this._imageGraphic=He(Ge(t)),this._graphics.add(this._imageGraphic),this.fov=We(ze.K0,i/o),this.state="image-loaded",this.imageSize=[t.width,t.height],this._imageGraphic.geometry));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadImage",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._removeImageSphere(),this.imageSource?this._loadImageInternal(this.imageSource,t):Pe(this.declaredClass,new H.Z(Ie("panoramic-viewer"),Se("PanoramicViewerViewModel","imageSource")))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(W.Z.EventedAccessor);(0,h._)([(0,b.Cb)()],Je.prototype,"_graphics",void 0),(0,h._)([(0,b.Cb)()],Je.prototype,"_imageGraphic",void 0),(0,h._)([(0,b.Cb)()],Je.prototype,"_imageRenderer",void 0),(0,h._)([(0,b.Cb)()],Je.prototype,"_loadController",void 0),(0,h._)([(0,b.Cb)()],Je.prototype,"_map",void 0),(0,h._)([(0,b.Cb)()],Je.prototype,"_zoomViewModel",void 0),(0,h._)([(0,b.Cb)({type:Boolean})],Je.prototype,"autoLoad",void 0),(0,h._)([(0,b.Cb)({type:fe.Z})],Je.prototype,"camera",null),(0,h._)([(0,_e.J)(new we.X({emit:"emit",hittest:"hittest",none:"none","pixel-location":"pixel-location"}))],Je.prototype,"clickAction",void 0),(0,h._)([(0,b.Cb)({type:Number})],Je.prototype,"fov",null),(0,h._)([(0,b.Cb)({readOnly:!0})],Je.prototype,"hfov",null),(0,h._)([(0,b.Cb)({readOnly:!0})],Je.prototype,"imageRenderer",null),(0,h._)([(0,b.Cb)()],Je.prototype,"imageSize",void 0),(0,h._)([(0,b.Cb)()],Je.prototype,"imageSource",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],Je.prototype,"maxHFOV",null),(0,h._)([(0,b.Cb)({readOnly:!0})],Je.prototype,"minHFOV",null),(0,h._)([(0,b.Cb)({type:Number})],Je.prototype,"pitch",void 0),(0,h._)([(0,b.Cb)()],Je.prototype,"state",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],Je.prototype,"vfov",null),(0,h._)([(0,b.Cb)({type:Number})],Je.prototype,"yaw",void 0);var Ye=Je=(0,h._)([(0,w.j)("esri.widgets.PanoramicViewer.PanoramicViewerViewModel")],Je),$e=n(7021),Xe=(n(80975),n(28907)),et=n(67005),tt=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e)).viewModel=new Ye,r._afterContainerCreate=function(e){r.imageRenderer.container=e},r.addGraphic=function(e,t){r.viewModel.addGraphic(e,t)},r.addManyGraphics=function(e){r.viewModel.addManyGraphics(e)},r.clearGraphics=function(){r.viewModel.clearGraphics()},r.clearImage=function(){r.viewModel.clearImage()},r.loadImage=function(e){return r.viewModel.loadImage(e)},r.removeGraphic=function(e){r.viewModel.removeGraphic(e)},r.removeManyGraphics=function(e){r.viewModel.removeManyGraphics(e)},r}return(0,u.Z)(n,[{key:"autoLoad",get:function(){return this.viewModel.autoLoad},set:function(e){this.viewModel.autoLoad=e}},{key:"camera",get:function(){return this.viewModel.camera},set:function(e){e&&(this.viewModel.camera=e)}},{key:"clickAction",get:function(){return this.viewModel.clickAction},set:function(e){this.viewModel.clickAction=e}},{key:"fov",get:function(){return this.camera.fov},set:function(e){this.viewModel.fov=e}},{key:"hfov",get:function(){return this.viewModel.hfov}},{key:"icon",get:function(){return"360-view"},set:function(e){this._overrideIfSome("icon",e)}},{key:"imageRenderer",get:function(){return this.viewModel.imageRenderer}},{key:"imageSize",get:function(){return this.viewModel.imageSize}},{key:"imageSource",get:function(){return this.viewModel.imageSource},set:function(e){this.viewModel.imageSource=e}},{key:"pitch",get:function(){return this.viewModel.pitch},set:function(e){this.viewModel.pitch=e}},{key:"state",get:function(){return this.viewModel.state}},{key:"vfov",get:function(){return this.viewModel.vfov}},{key:"yaw",get:function(){return this.viewModel.yaw},set:function(e){this.viewModel.yaw=e}},{key:"render",value:function(){return(0,et.u)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes($e.z.widget,"esri-panoramic-viewer")})}}]),n}(Z.Z);(0,h._)([(0,b.Cb)({type:Boolean})],tt.prototype,"autoLoad",null),(0,h._)([(0,b.Cb)({type:fe.Z})],tt.prototype,"camera",null),(0,h._)([(0,b.Cb)()],tt.prototype,"clickAction",null),(0,h._)([(0,b.Cb)({type:Number})],tt.prototype,"fov",null),(0,h._)([(0,b.Cb)({readOnly:!0,type:Number})],tt.prototype,"hfov",null),(0,h._)([(0,b.Cb)()],tt.prototype,"icon",null),(0,h._)([(0,b.Cb)({readOnly:!0,type:me.default})],tt.prototype,"imageRenderer",null),(0,h._)([(0,b.Cb)({readOnly:!0})],tt.prototype,"imageSize",null),(0,h._)([(0,b.Cb)()],tt.prototype,"imageSource",null),(0,h._)([(0,b.Cb)({type:Number})],tt.prototype,"pitch",null),(0,h._)([(0,b.Cb)({readOnly:!0})],tt.prototype,"state",null),(0,h._)([(0,b.Cb)({readOnly:!0,type:Number})],tt.prototype,"vfov",null),(0,h._)([(0,Xe.s)(["click","hittest-response","pixel-location"]),(0,b.Cb)({type:Ye})],tt.prototype,"viewModel",void 0),(0,h._)([(0,b.Cb)({type:Number})],tt.prototype,"yaw",null);var nt=tt=(0,h._)([(0,w.j)("esri.widgets.PanoramicViewer")],tt),rt=n(28429),it=n(86934),at=n(2170),ot=n(23842),st=n(41625),lt=n(66612),ut=n(22824),ct=n(86226),dt=n(80885),pt=n(848),ht="click-handle",vt="enhancements-handle",ft=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e))._imageChanged=!1,r._panConstraint=null,r._image=null,r._loadController=null,r._overlays=new Y.default,r._map=new ge.Z,r.autoLoad=!1,r.clickAction="none",r.error=null,r.imageSource=null,r.imageRotation=0,r.state="ready",r._cancelLoadWithController=function(){var e;null!==(e=r._loadController)&&void 0!==e&&e.abort(),r._loadController=null},r._createImageHandles=function(){r.removeHandles(vt),r.addHandles((0,g.watch)((function(){return[r.brightness,r.contrast,r.sharpness]}),(function(e){var t,n=(0,s.Z)(e,3),i=n[0],a=n[1],o=n[2];(null===(t=r.image)||void 0===t?void 0:t.loaded)&&(r.image.effect="contrast(".concat(10*(a+10),"%) brightness(").concat(10*(i+10),"%)"),r.sharpenImage(r.image,o))}),g.syncAndInitial))},r._createPanConstraint=function(){var e=(0,c.Z)(r),t=e.image,n=e.imageRenderer,i=function(e){if(!(t&&n&&e.targetGeometry&&t.serviceRasterInfo))return e;var i=t.serviceRasterInfo.extent,a=n.constraints,o=n.rotation,s=n.width,l=n.height,u=(0,at.rotate)(dt.Z.fromExtent(i),o).extent,c=u.width,d=u.height,p=e.targetGeometry.clone(),h=a.scaleToZoom(e.scale),v=1/Math.pow(2,h),f=s/l,m=v*c,y=v*d;h&&(c/s>d/l?y=m/f:m=y*f);var g=u.clone();return g.xmin+=m/2,g.xmax-=m/2,g.ymin+=y/2,g.ymax-=y/2,e.targetGeometry=(0,at.nearestCoordinate)(g,p).coordinate,r.state="image-loaded",e};return{constrain:i,applyPanConstraint:i}},r._createResizeHandles=function(e){e.removeHandles("resize"),e.addHandles((0,g.watch)((function(){if(r.imageRenderer.ready){var t=e.serviceRasterInfo.extent,n=r.imageRenderer,i=n.width,a=n.height,o=n.rotation,s=(0,at.rotate)(dt.Z.fromExtent(t),o).extent,l=s.width,u=s.height;return Math.max(l/i,u/a)}}),(function(e){if(r.imageRenderer&&null!=e){for(var t=r.imageRenderer,n=t.constraints,i=t.scale,a=t.spatialReference,o=n.minScale,s=(0,ct.VS)(a),l=.25*s,u=s*e,c=u,d=[];c>l;)d.push(c),c/=2;d.push(c);var p=ut.Z.create({scales:d}).lods;if(n.set({minScale:u,lods:p}),r._imageChanged)return r.imageRenderer.scale=u,void(r._imageChanged=!1);r.imageRenderer.scale=Math.abs(i-o)<=1e-6?u:i}}),g.syncAndInitial),"resize")},r._loadImageInternal=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.clearImage(),r.error=null,r._imageChanged=!0,r.state="image-loading";var n="string"==typeof e,i=n?void 0:e.datasetFormat,a=n?e:e.url,o=t.customParameters,s=t.options;return r._image=new ot.default({ioConfig:{skipExtensions:["aux.xml","jgw"],skipMapInfo:!0,datasetFormat:i},url:a,customParameters:o}),r._image.when((function(e){r._updatePanConstraint(),r._createResizeHandles(e),r._map.add(e),r.state="image-loaded"}),(function(t){(0,K.D_)(t)?r.state="image-load-aborted":(r.state="image-load-error",r.error=t,m.Z.getLogger((0,c.Z)(r)).error("error occurred while loading image ".concat(n?e:JSON.stringify(e)),t),r.imageSource=null)})),r._image.load(s)},r._loadWithController=function(){r._cancelLoadWithController(),r._loadController=new AbortController,r.loadImage(r._loadController)},r._updatePanConstraint=function(){r._panConstraint&&r.imageRenderer.constraints.customConstraints.remove(r._panConstraint),r._panConstraint=r._createPanConstraint(),r.imageRenderer.constraints.customConstraints.add(r._panConstraint)},r.addGraphic=function(e,t){r._overlays.graphics.add(e,t)},r.addManyGraphics=function(e){r._overlays.addMany(e)},r.clearGraphics=function(){r._overlays.graphics.removeAll()},r.clearImage=function(){r.image&&(r._map.layers.remove(r.image),r._image=(0,U.SC)(r._image))},r.loadImage=function(e){var t=(0,c.Z)(r),n=t.customParameters,i=t.imageSource;return i?r._loadImageInternal(i,{customParameters:n,options:e}):Pe(r.declaredClass,new H.Z(Ie("image-viewer"),Se("ImageViewerViewModel","imageSource")))},r.removeGraphic=function(e){r._overlays.remove(e)},r.removeManyGraphics=function(e){r._overlays.removeMany(e)},r._imageRenderer=new it.default({constraints:{snapToZoom:!0,rotationEnabled:!1},map:r._map,popupEnabled:!1,spatialReference:Be.Z.WebMercator,ui:{components:["zoom"]}}),r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.state="initialized",this.addHandles([(0,g.watch)((function(){return e.imageSource}),(function(t){t&&e.autoLoad&&e._loadWithController()}),g.syncAndInitial),(0,g.watch)((function(){var t;return null===(t=e.image)||void 0===t?void 0:t.loaded}),(function(){e._createImageHandles()})),(0,g.watch)((function(){return e.imageRotation}),(function(){e._rotateImage()})),(0,g.watch)((function(){return e.imageRenderer.map}),(function(t,n){null!==n&&void 0!==n&&n.layers.remove(e._overlays),null===t||void 0===t||t.layers.add(e._overlays)}),g.initial),(0,g.watch)((function(){return e.imageRenderer.map.allLayers.length}),(function(t){t&&e.imageRenderer.map.layers.reorder(e._overlays,t-1)}),g.syncAndInitial),(0,g.watch)((function(){return e.clickAction}),(function(t){e.removeHandles(ht),"none"!==t&&e.addHandles(e.imageRenderer.on("click",(function(n){var r;if(null!==(r=e.image)&&void 0!==r&&r.loaded&&e.imageRenderer.ready)switch(t){case"emit":n.stopPropagation(),e.emit("click",n);break;case"hittest":n.stopPropagation(),n.async((0,o.Z)((0,a.Z)().mark((function t(){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.imageRenderer.hitTest(n.screenPoint,{include:e._overlays});case 2:r=t.sent,e.emit("hittest-response",r);case 4:case"end":return t.stop()}}),t)}))));break;case"pixel-location":var i;if(n.stopPropagation(),null===(i=e.image)||void 0===i||!i.serviceRasterInfo||!n.mapPoint)return void e.emit("pixel-location",null);var s=e.image.serviceRasterInfo,l=s.extent,u=s.pixelSize,c=(n.mapPoint.x-l.xmin)*u.x,d=(l.ymax-n.mapPoint.y)*u.y,p=new pt.Z({x:c,y:d,spatialReference:l.spatialReference});e.emit("pixel-location",p)}})))}),g.syncAndInitial)])}},{key:"brightness",get:function(){var e;return null!==(e=this._get("brightness"))&&void 0!==e?e:0},set:function(e){this._set("brightness",(0,y.uZ)(e,-10,10))}},{key:"contrast",get:function(){var e;return null!==(e=this._get("contrast"))&&void 0!==e?e:0},set:function(e){this._set("contrast",(0,y.uZ)(e,-10,10))}},{key:"image",get:function(){return this._image}},{key:"imagePointsInView",get:function(){var e,t,n,r=this,i=this.imageRenderer,a=i.extent,o=i.ready,l=this.imageRotation,u=null===(e=this.image)||void 0===e?void 0:e.fullExtent,c=null===(t=this.image)||void 0===t?void 0:t.serviceRasterInfo,d=!0===(null===(n=this._imageRenderer.allLayerViews.find((function(e){return e.layer===r.image})))||void 0===n?void 0:n.attached);if(!(o&&a&&u&&c&&d))return null;var p=(0,at.rotate)(dt.Z.fromExtent(a),l),h=dt.Z.fromExtent(u);return(0,at.intersect)(p,h).rings.flat().map((function(e){var t=(0,s.Z)(e,2),n=t[0],r=t[1];return{x:(n-c.extent.xmin)*c.pixelSize.x,y:(c.extent.ymax-r)*c.pixelSize.y}}))}},{key:"imageSize",get:function(){var e=this.image;if(null===e||void 0===e||!e.raster)return null;var t=e.raster.rasterInfo;return[t.width,t.height]}},{key:"imageRenderer",get:function(){return this._imageRenderer}},{key:"imageView",get:function(){var e=this;return this.imageRenderer.allLayerViews.find((function(t){return t.layer===e.image}))}},{key:"sharpness",get:function(){var e;return null!==(e=this._get("sharpness"))&&void 0!==e?e:0},set:function(e){this._set("sharpness",(0,y.uZ)(e,0,1))}},{key:"_rotateImage",value:function(){this.imageRenderer.constraints.rotationEnabled=!0,this.imageRenderer.rotation=this.imageRotation,this.imageRenderer.constraints.rotationEnabled=!1}},{key:"sharpenImage",value:function(e,t){if(t){var n=[0,-1*t,0,-1*t,4*t+1,-1*t,0,-1*t,0],r=new st.Z({functionName:"Convolution",functionArguments:{type:lt.z8.userDefined,cols:3,rows:3,kernel:n,convolutionType:lt.z8.userDefined}});e.rasterFunction=r}else e.rasterFunction=null}}]),n}(W.Z.EventedAccessor);(0,h._)([(0,b.Cb)()],ft.prototype,"_image",void 0),(0,h._)([(0,b.Cb)()],ft.prototype,"_imageRenderer",void 0),(0,h._)([(0,b.Cb)()],ft.prototype,"_loadController",void 0),(0,h._)([(0,b.Cb)()],ft.prototype,"_overlays",void 0),(0,h._)([(0,b.Cb)()],ft.prototype,"_map",void 0),(0,h._)([(0,b.Cb)({type:Boolean})],ft.prototype,"autoLoad",void 0),(0,h._)([(0,b.Cb)({type:Number})],ft.prototype,"brightness",null),(0,h._)([(0,b.Cb)()],ft.prototype,"clickAction",void 0),(0,h._)([(0,b.Cb)({type:Number})],ft.prototype,"contrast",null),(0,h._)([(0,b.Cb)({type:Object})],ft.prototype,"customParameters",void 0),(0,h._)([(0,b.Cb)({type:H.Z})],ft.prototype,"error",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],ft.prototype,"image",null),(0,h._)([(0,b.Cb)({readOnly:!0})],ft.prototype,"imagePointsInView",null),(0,h._)([(0,b.Cb)({readOnly:!0})],ft.prototype,"imageSize",null),(0,h._)([(0,b.Cb)({cast:function(e){return"string"==typeof e&&e.length?e:function(e){return e&&e.url&&e.datasetFormat?e:null}(e)}})],ft.prototype,"imageSource",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],ft.prototype,"imageRenderer",null),(0,h._)([(0,b.Cb)({type:Number})],ft.prototype,"imageRotation",void 0),(0,h._)([(0,b.Cb)()],ft.prototype,"imageView",null),(0,h._)([(0,b.Cb)({type:Number})],ft.prototype,"sharpness",null),(0,h._)([(0,b.Cb)()],ft.prototype,"state",void 0);var mt=ft=(0,h._)([(0,w.j)("esri.widgets.OrientedImageryViewer.components.ImageViewerViewModel")],ft),yt=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,l.Z)(this,n),(e=t.apply(this,arguments)).viewModel=new mt,e._afterContainerCreate=function(t){e.imageRenderer.container=t},e.addGraphic=function(t,n){e.viewModel.addGraphic(t,n)},e.addManyGraphics=function(t){e.viewModel.addManyGraphics(t)},e.clearGraphics=function(){e.viewModel.clearGraphics()},e.clearImage=function(){e.viewModel.clearImage()},e.loadImage=function(){var t=(0,o.Z)((0,a.Z)().mark((function t(n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.viewModel.loadImage(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.removeGraphic=function(t){e.viewModel.removeGraphic(t)},e.removeManyGraphics=function(t){e.viewModel.removeManyGraphics(t)},e}return(0,u.Z)(n,[{key:"autoLoad",get:function(){return this.viewModel.autoLoad},set:function(e){this.viewModel.autoLoad=e}},{key:"brightness",get:function(){return this.viewModel.brightness},set:function(e){this.viewModel.brightness=e}},{key:"clickAction",get:function(){return this.viewModel.clickAction},set:function(e){this.viewModel.clickAction=e}},{key:"contrast",get:function(){return this.viewModel.contrast},set:function(e){this.viewModel.contrast=e}},{key:"customParameters",get:function(){return this.viewModel.customParameters},set:function(e){this.viewModel.customParameters=e}},{key:"error",get:function(){return this.viewModel.error}},{key:"imageSize",get:function(){var e,t=null===(e=this.viewModel.image)||void 0===e?void 0:e.serviceRasterInfo;return t?[t.width,t.height]:[0,0]}},{key:"imagePointsInView",get:function(){return this.viewModel.imagePointsInView}},{key:"imageRenderer",get:function(){return this.viewModel.imageRenderer}},{key:"imageRotation",get:function(){return this.viewModel.imageRotation},set:function(e){this.viewModel.imageRotation=e}},{key:"imageSource",get:function(){return this.viewModel.imageSource},set:function(e){this.viewModel.imageSource=e}},{key:"sharpness",get:function(){return this.viewModel.sharpness},set:function(e){this.viewModel.sharpness=e}},{key:"state",get:function(){return this.viewModel.state}},{key:"render",value:function(){return(0,et.u)("div",{afterCreate:this._afterContainerCreate,bind:this,class:this.classes($e.z.widget,"esri-image-viewer")})}}]),n}(Z.Z);(0,h._)([(0,b.Cb)({type:Boolean})],yt.prototype,"autoLoad",null),(0,h._)([(0,b.Cb)({type:Number}),(0,b.Cb)()],yt.prototype,"brightness",null),(0,h._)([(0,b.Cb)()],yt.prototype,"clickAction",null),(0,h._)([(0,b.Cb)({type:Number})],yt.prototype,"contrast",null),(0,h._)([(0,b.Cb)({type:Object})],yt.prototype,"customParameters",null),(0,h._)([(0,b.Cb)({readOnly:!0})],yt.prototype,"error",null),(0,h._)([(0,b.Cb)()],yt.prototype,"imageSize",null),(0,h._)([(0,b.Cb)({readOnly:!0})],yt.prototype,"imagePointsInView",null),(0,h._)([(0,b.Cb)({readOnly:!0,type:it.default})],yt.prototype,"imageRenderer",null),(0,h._)([(0,b.Cb)()],yt.prototype,"imageRotation",null),(0,h._)([(0,b.Cb)()],yt.prototype,"imageSource",null),(0,h._)([(0,Xe.s)(["click","hittest-response","pixel-location"]),(0,b.Cb)({type:mt})],yt.prototype,"viewModel",void 0),(0,h._)([(0,b.Cb)({type:Number})],yt.prototype,"sharpness",null),(0,h._)([(0,b.Cb)({readOnly:!0})],yt.prototype,"state",null);var gt=yt=(0,h._)([(0,w.j)("esri.widgets.OrientedImageryViewer.components.ImageViewer")],yt),bt="view-click",wt="image-click",_t="interaction-handles",Ct=new Set(["JPG","JPEG"]),Zt=/\.(\w+)$/,xt=function(e){return"FA"===e},Mt=function(e){(0,d.Z)(h,e);var t=(0,p.Z)(h);function h(e){var n;return(0,l.Z)(this,h),(n=t.call(this,e)).additionalFeatures=new G.Z,n.bestFeatureAngle=0,n.coverageFrustums=new G.Z,n.coveragePolygons=new G.Z,n.currentBestFeature=null,n.currentCoverageVisible=!0,n.determineWorkflowForFeature=function(){(0,U.IM)(n._featureChangedTask),n._featureChangedTask=(0,j.vr)(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,c.Z)(n),i=r.currentBestFeature,o=r.selectedPoint,null!==(s=r.view)&&void 0!==s&&s.closePopup(),!i||!o){e.next=13;break}return n._initialCurrentCoverageUpdate=!0,e.prev=3,e.next=6,n._updatePointsAndPolygons({signal:t});case 6:return e.next=8,n._loadImage({signal:t});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),(0,K.D_)(e.t0)||(n.loadImageError(e.t0),m.Z.getLogger((0,c.Z)(n)).error("#loadIImage()","error occured while loading image",e.t0));case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}())},n.disabled=!1,n.displayMessage={key:"onLoadMessage",type:"info"},n.drawFootprint=function(){n.bestFeatureFootprint&&n.updateCurrentCoveragePolygon(n.bestFeatureFootprint)},n.features=new G.Z,n.isAdditionalCoverageVisible=!1,n.isAdditionalPointSourcesVisible=!1,n.layer=null,n.localPort=null,n.mapImageConversionToolState=!1,n.navigatorCurrentBestFeature=null,n.pointSources=new G.Z,n.previousFeatureAngle=0,n.selectedPoint=null,n.shouldShowSelectedImage=!1,n.updateFootprint=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="image-loaded"===n.state,!e.t0){e.next=4;break}return e.next=4,null===(i=n._adapter)||void 0===i?void 0:i.updateFootprint(t,r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.updateFootprintPanorama=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(i=n._adapter)||void 0===i?void 0:i.updateFootprintPanorama(t,r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n._adapter=null,n.additionalFootprints=new G.Z,n.additionalCameraLocations=new G.Z,n.bestFeatureCurrentFootprint=null,n._fetchFeaturesController=null,n._highlightedFeatureHandle=null,n._imageViewer=new gt,n.bestFeatureFootprint=null,n._initialCurrentCoverageUpdate=!0,n._loading=!1,n._overlays=new Y.default({listMode:"hide",internal:!0,elevationInfo:{mode:"absolute-height"}}),n._panoramicViewer=new nt,n._referencePointOnGround=null,n._referencePointOnImage=null,n._sectorData=null,n._crossSymbol=null,n.footprintExtent=null,n._featureChangedTask=null,n._openPopupTask=null,n._suitabilities=null,n._transformController=new AbortController,n._updateFootprintTask=null,n.highlight=function(e){var t;if(n._overlaysView){n.removeHighlight();var r=n.additionalFootprints.find((function(t){return t.attributes.imageID===Number(e)}));n._highlightedFeatureHandle=r?null===(t=n._overlaysView)||void 0===t?void 0:t.highlight(r):null}},n.loadImageFromSource=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i,o,s,l,u,d,p,h,v,f,m,y,g,b,w,C,Z,x;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.mode,l=r.imageRotation,u=r.options,p=(d="string"==typeof t)?t:t.url,h=d?null!==(i=null===(o=t.match(Zt))||void 0===o?void 0:o[1])&&void 0!==i?i:"":t.datasetFormat){e.next=7;break}return e.next=5,Fe(p,(0,N.Z)({},r.options));case 5:(f=e.sent)&&(h=f.split("/")[1]),null!==(v=h)&&void 0!==v||(h="UNKNOWN FORMAT");case 7:e.t0=s,e.next="default"===e.t0?10:"panoramic"===e.t0?17:42;break;case 10:return n._imageViewer.imageSource={datasetFormat:h.toUpperCase(),url:p},m=new URL(p),n._imageViewer.customParameters=Object.fromEntries(m.searchParams),n._imageViewer.imageRotation=null!==l&&void 0!==l?l:0,e.next=16,n._imageViewer.loadImage(u);case 16:return e.abrupt("break",42);case 17:if(n._loading=!0,!Ct.has(h.toUpperCase())){e.next=40;break}if(y=(0,c.Z)(n),g=y.selectedPoint,b=r.pitch,w=r.yaw,C=r.cameraLocation,Z=r.viewAngle,n._panoramicViewer.imageSource=p,x=null!==w&&void 0!==w?w:0,"number"!=typeof Z){e.next=26;break}x=Z-x,e.next=33;break;case 26:if(e.t1=C&&g,!e.t1){e.next=33;break}return e.next=30,(0,_._6)(C,g);case 30:e.t2=e.sent,e.t3=x,x=e.t2-e.t3;case 33:return n._panoramicViewer.pitch=null!==b&&void 0!==b?b:0,n._panoramicViewer.yaw=x,n._loading=!1,e.next=38,n._panoramicViewer.loadImage(u);case 38:e.next=41;break;case 40:n.setMessage("unsupportedPanoramicImageryError","error",void 0,{datasetFormat:h});case 41:return e.abrupt("break",42);case 42:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.loadImageViewer=function(e){n._imageViewer.container=e},n.loadPanoramicViewer=function(e){n._panoramicViewer.container=e},n.removeHighlight=function(){var e;return null===(e=n._highlightedFeatureHandle)||void 0===e?void 0:e.remove()},n.toggleImageAttributes=function(){(0,U.IM)(n._openPopupTask),n._openPopupTask=(0,j.vr)(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,i,o,s,l,u,d,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,c.Z)(n),i=r.currentBestFeature,o=r.popupEnabled,s=r.layer,null!==(l=r.view)&&void 0!==l&&l.closePopup(),l&&i&&o&&s){e.next=3;break}return e.abrupt("return");case 3:return u=i.attributes,d=i.geometry,p=new D.Z({geometry:d,attributes:u.toJSON(),popupTemplate:s.popupTemplate}),(0,K.k_)(t),e.next=7,l.openPopup({features:[p],location:u.location.clone()});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},n._getImageSourceFromAttachment=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,i){var o,s,l,u,c,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=new he.Z({objectIds:[n]}),e.next=3,t.queryAttachments(l,i);case 3:if(u=e.sent,c=null===(o=u["".concat(n)])||void 0===o?void 0:o[0],d=null===c||void 0===c?void 0:c.url){e.next=8;break}throw new H.Z("NoAttachmentError","no attachments found",(s={},(0,r.Z)(s,t.objectIdField,n),(0,r.Z)(s,"layer",t),s));case 8:return e.abrupt("return",{datasetFormat:c.contentType.split("/")[1].toUpperCase(),url:d});case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),n._loadImage=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var i,o,s,l,u,d,p,h,v,f,y,g,b,w,_,C,Z;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(0,c.Z)(n),o=i.currentBestFeature,s=i.layer,l=i.mode,n.clearGraphics(),s&&o&&"none"!==l){e.next=3;break}return e.abrupt("return");case 3:if(u=o.attributes,d=u.imagePath,p=u.imageRotation,h=u.cameraHeading,v=u.cameraRoll,f=u.cameraPitch,y=u.objectId,g=u.cameraOrientation,b=u.location,w=(null!==v&&void 0!==v?v:0)+(null!==p&&void 0!==p?p:0),_=b.spatialReference.isWGS84&&4!==(null===g||void 0===g?void 0:g.type)?(0,J.$)(b):new pt.Z(b),C=d,!xt(d)){e.next=17;break}return e.prev=6,e.next=9,n._getImageSourceFromAttachment(s,y,t);case 9:C=e.sent,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!(0,K.D_)(e.t0)){e.next=16;break}return e.abrupt("return");case 16:return e.abrupt("return",ke(e.t0)?(m.Z.getLogger((0,c.Z)(n)).error(e.t0),void n.setMessage("noAttachment","error","".concat(s.objectIdField,": ").concat(y))):(m.Z.getLogger((0,c.Z)(n)).error(e.t0,(Z={},(0,r.Z)(Z,s.objectIdField,y),(0,r.Z)(Z,"layer",s),Z)),void n.setMessage("imageLoadError","error","query-attachments-failed:".concat(s.objectIdField," ").concat(y))));case 17:return e.prev=17,e.next=20,n.loadImageFromSource(C,{imageRotation:w,options:t,pitch:f,yaw:h,mode:l,cameraLocation:_});case 20:return(0,K.k_)(t),e.next=23,n.transformAndPlotSelectedLocation(t);case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(17),(0,K.D_)(e.t1)||n.loadImageError(e.t1);case 28:case"end":return e.stop()}}),e,null,[[6,12],[17,25]])})));return function(t){return e.apply(this,arguments)}}(),n._mapImageConversionToolViewClickHandler=function(e){e.stopPropagation(),e.preventDefault(),e.mapPoint&&n.plotMapPoint(e.mapPoint)},n._viewClickHandler=function(e){"mouse"===e.pointerType&&0!==e.button||(e.stopPropagation(),e.preventDefault(),e.mapPoint&&n.loadBestImage(e.mapPoint))},n.plotSelectedPointOnImage=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var i,o,l,u,c,d,p,h,v;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,K.Yn)(r);case 2:if(t){e.next=4;break}return e.abrupt("return");case 4:if(i=new pt.Z((0,N.Z)((0,N.Z)({},(0,B.AK)(t)?t.toJSON():t),{},{spatialReference:Be.Z.WebMercator})),"default"!==n.mode){e.next=9;break}i.x-=.5,i.y=.5-i.y,n._crossSymbol=new D.Z({geometry:i,symbol:rt.tA}),n._imageViewer.addGraphic(n._crossSymbol,0),e.next=15;break;case 9:if("panoramic"!==n.mode){e.next=15;break}if(o=n._panoramicViewer.imageSize){e.next=13;break}return e.abrupt("return");case 13:l=(0,s.Z)(o,2),u=l[0],c=l[1],d=(0,_.If)(t,u,c),p=d.heading,h=d.pitch,v=(0,_.n_)(p,h),n._crossSymbol=new D.Z({geometry:new pt.Z(v,Be.Z.WebMercator),symbol:rt.OH}),n._panoramicViewer.addGraphic(n._crossSymbol,0);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),n.handleSectorClick=n.handleSectorClick.bind((0,c.Z)(n)),n.searchBestImage=n.searchBestImage.bind((0,c.Z)(n)),n.transformAndPlotReferencePointOnImage=n.transformAndPlotReferencePointOnImage.bind((0,c.Z)(n)),n.updateSuitabilities=n.updateSuitabilities.bind((0,c.Z)(n)),n.determineWorkflowForFeature=n.determineWorkflowForFeature.bind((0,c.Z)(n)),n.selectBestFeature=n.selectBestFeature.bind((0,c.Z)(n)),n.drawFootprint=n.drawFootprint.bind((0,c.Z)(n)),n}return(0,u.Z)(h,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,g.watch)((function(){return e.view}),function(){var t=(0,o.Z)((0,a.Z)().mark((function t(r){var i,o,s,l;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=19;break}t.t0=(e._loading=!0,r.type),t.next="2d"===t.t0?4:"3d"===t.t0?10:16;break;case 4:return t.next=6,n.e(3044).then(n.bind(n,3044));case 6:return i=t.sent,o=i.default,e._adapter=new o(e),t.abrupt("break",16);case 10:return t.next=12,n.e(22705).then(n.bind(n,22705));case 12:return s=t.sent,l=s.default,e._adapter=new l(e),t.abrupt("break",16);case 16:e._loading=!1,t.next=20;break;case 19:e._adapter=null;case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),g.syncAndInitial),(0,g.watch)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.map}),(function(t,n){null!==n&&void 0!==n&&n.layers.remove(e._overlays),null===t||void 0===t||t.layers.add(e._overlays)}),g.initial),(0,g.watch)((function(){var t,n,r;return null===(t=e.view)||void 0===t||null===(n=t.map)||void 0===n||null===(r=n.allLayers)||void 0===r?void 0:r.length}),(function(t){var n,r;t&&(null===(n=e.view)||void 0===n||null===(r=n.map)||void 0===r||r.layers.reorder(e._overlays,t-1))}),g.initial),(0,g.watch)((function(){return[e.state,e.mapImageConversionToolState,e.view]}),(function(){if(e.removeHandles(bt),"disabled"!==e.state&&null!=e.view){var t=e.mapImageConversionToolState&&"image-loaded"===e.state?e._mapImageConversionToolViewClickHandler:e._viewClickHandler;e.addHandles(e.view.on("click",t,ve.f.WIDGET),bt),e.removeHandles(wt);var n=e.mapImageConversionToolState,r=e.mode;if(n&&"none"!==r)switch(r){case"default":e._imageViewer.clickAction="pixel-location",e.addHandles(e._imageViewer.on("pixel-location",function(){var t=(0,o.Z)((0,a.Z)().mark((function t(n){var r,i,o;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.plotReferencePointOnImage(n),!(r=e.currentBestFeature)){t.next=7;break}return t.next=5,(0,pe.y)([n.toJSON()],{feature:r,imageProperties:{width:e._imageViewer.imageSize[0],height:e._imageViewer.imageSize[1]},options:{signal:null===(i=e._transformController)||void 0===i?void 0:i.signal},footprintExtent:e.footprintExtent});case 5:(o=t.sent[0])&&e.plotReferencePointOnGround(o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),wt);break;case"panoramic":e._panoramicViewer.clickAction="pixel-location",e.addHandles(e._panoramicViewer.on("pixel-location",function(){var t=(0,o.Z)((0,a.Z)().mark((function t(n){var r,i,o,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.plotReferencePointOnImage(n),r=e.currentBestFeature,i=e._panoramicViewer.imageSize,!(r&&n&&i)){t.next=7;break}return t.next=5,(0,pe.y)([n],{feature:r,imageProperties:{width:i[0],height:i[1]},options:{signal:null===(o=e._transformController)||void 0===o?void 0:o.signal},footprintExtent:e.footprintExtent});case 5:(s=t.sent[0])&&e.plotReferencePointOnGround(s);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),wt)}}}),g.syncAndInitial),(0,g.watch)((function(){return e.bestFeatureAngle}),(function(t,n){e.previousFeatureAngle=null!==n&&void 0!==n?n:0}),g.syncAndInitial),(0,g.watch)((function(){return e.currentBestFeature}),(function(t,n){e.determineWorkflowForFeature(t,n)}),{sync:!0}),(0,g.watch)((function(){return e.mode}),(function(t){switch(e.removeHandles(_t),t){case"default":e.addHandles((0,g.watch)((function(){return e._imageViewer.imagePointsInView}),(function(t){t&&((0,U.IM)(e._updateFootprintTask),e._updateFootprintTask=(0,j.vr)(function(){var n=(0,o.Z)((0,a.Z)().mark((function n(r){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.updateFootprint(t,{signal:r});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()))}),(0,N.Z)((0,N.Z)({},g.syncAndInitial),{},{equals:function(e,t){return(0,L.fS)(e,t,q.y7)}})),_t);break;case"panoramic":e.addHandles((0,g.watch)((function(){var t=e.currentBestFeature,n=e._panoramicViewer,r=n.imageSize,i=n.vfov,a=n.hfov,o=n.pitch,s=n.yaw;return t&&r?[i,a,s,o]:null}),(function(t){if(t&&"image-loading"!==e.state){var n=(0,s.Z)(t,4),r=n[0],i=n[1],l=n[2],u=n[3];(0,U.IM)(e._updateFootprintTask),e._updateFootprintTask=(0,j.vr)(function(){var t=(0,o.Z)((0,a.Z)().mark((function t(n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateFootprintPanorama({verticalFieldOfView:r,horizontalFieldOfView:i,yaw:l,pitch:u},{signal:n});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}),(0,N.Z)((0,N.Z)({},g.syncAndInitial),{},{equals:function(e,t){return(0,L.fS)(e,t,q.y7)}})),_t)}}),g.syncAndInitial),(0,g.watch)((function(){return[e.brightness,e.contrast,e.sharpness]}),(function(){var t=e._imageViewer,n=e.brightness,r=e.contrast,i=e.mode,a=e.sharpness;"default"===i&&(t.brightness=n,t.contrast=r,t.sharpness=a)}),g.syncAndInitial)])}},{key:"destroy",value:function(){var e,t;this._updateFootprintTask=(0,U.IM)(this._updateFootprintTask),this._cancelFetchingFeatures(),this.coverageFrustums.destroy(),this.coveragePolygons.destroy(),this.pointSources.destroy(),this.additionalFootprints.destroy(),this.additionalCameraLocations.destroy(),this.bestFeatureFootprint=(0,U.SC)(this.bestFeatureFootprint),this.bestFeatureCurrentFootprint=(0,U.SC)(this.bestFeatureCurrentFootprint),this._crossSymbol=(0,U.SC)(this._crossSymbol),this._referencePointOnGround=(0,U.SC)(this._referencePointOnGround),this._referencePointOnImage=(0,U.SC)(this._referencePointOnImage),this._overlays&&null!==(e=this.view)&&void 0!==e&&null!==(t=e.map)&&void 0!==t&&t.remove(this._overlays),this._overlays.destroy()}},{key:"activeLayer",get:function(){return(0,f.Mr)(m.Z.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer},set:function(e){(0,f.Mr)(m.Z.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}},{key:"activeViewer",get:function(){var e=this._imageViewer,t=this._panoramicViewer;switch(this.mode){case"default":return e;case"panoramic":return t;default:return null}}},{key:"brightness",get:function(){var e;return null!==(e=this._get("brightness"))&&void 0!==e?e:0},set:function(e){this._set("brightness",e>10?10:e<-10?-10:e)}},{key:"contrast",get:function(){var e;return null!==(e=this._get("contrast"))&&void 0!==e?e:0},set:function(e){this._set("contrast",(0,y.uZ)(e,-10,10))}},{key:"featureCount",get:function(){var e,t;return null!==(e=null===(t=this.features)||void 0===t?void 0:t.length)&&void 0!==e?e:0}},{key:"imageGalleryEnabled",get:function(){var e;return Me(null===(e=this.currentBestFeature)||void 0===e?void 0:e.attributes.imagePath.trim())}},{key:"imageLoaded",get:function(){return(0,f.Mr)(m.Z.getLogger(this),"imageLoaded",{replacement:'Use OrientedImageryViewer.state === "image-loaded"',version:"4.29",warnOnce:!0}),"image-loaded"===this.state}},{key:"imagePointsInView",get:function(){var e=this.mode,t=this._imageViewer;return"default"===e?t.imagePointsInView:null}},{key:"mode",get:function(){var e,t=null===(e=this.currentBestFeature)||void 0===e?void 0:e.attributes;if(!t)return"none";var n=t.horizontalFieldOfView,r=t.isSpherical;return 360===n||r?"panoramic":"default"}},{key:"popupEnabled",get:function(){return null!==this.layer&&this.layer.popupEnabled}},{key:"referencePoint",get:function(){var e;return null===(e=this._referencePointOnGround)||void 0===e?void 0:e.geometry}},{key:"sectorData",get:function(){var e=this._sectorData;return e?O.map((function(t){return e[t]})):null}},{key:"sharpness",get:function(){var e;return null!==(e=this._get("sharpness"))&&void 0!==e?e:0},set:function(e){this._set("sharpness",(0,y.uZ)(e,0,1))}},{key:"state",get:function(){var e=this.mode;if(this.disabled)return"disabled";if(this._loading)return"image-loading";switch(e){case"default":return this._imageViewer.state;case"panoramic":return this._panoramicViewer.state}return"ready"}},{key:"thumbnails",get:function(){var e=this.features;return e?new G.Z(e.map((function(e){var t=e.attributes,n=t.imagePath,r=t.objectId,i=t.cameraRoll,a=t.imageRotation,o=n.trim();return Me(o)?{url:o,objectId:r,rotation:(null!==i&&void 0!==i?i:0)+(null!==a&&void 0!==a?a:0)}:null})).filter(L.pC)):null}},{key:"view",set:function(e){this._set("view",e)}},{key:"_overlaysView",get:function(){var e,t=this;return null===(e=this.view)||void 0===e?void 0:e.layerViews.find((function(e){return e.layer===t._overlays}))}},{key:"filterByFootprints",value:function(e,t){var n=this,r=[],i=[],a=[];return e.forEach((function(e){var o,s=e.layer.coveragePercent,l=e.attributes,u=(0,ce.QX)(l),c=u.polygon,d=u.frustum;if(o=c.clone(),l.isInspection&&(o=(0,ce.eC)(l)),s&&(o=(0,ce.Zk)(o,s)),(0,ce.RS)(o,t)){a.push(e);var p=l.cameraHeading,h=l.geometry,v=l.objectId,f=l.cameraHeight,m=h.clone();m.z=f,m.imageID=v,n.pointSources.push(m),-999!==p&&(r.push(c),d&&i.push(d))}})),{features:a,polygons:r,frustums:i}}},{key:"getCurrentCoveragePolygon",value:function(){return this.bestFeatureCurrentFootprint}},{key:"getCurrentBestFeaturePolygon",value:function(){return this.bestFeatureFootprint}},{key:"handleSectorClick",value:function(e){var t;if(!isNaN(e)){var n=null===(t=this._sectorData)||void 0===t?void 0:t[O[e]];(null===n||void 0===n?void 0:n.length)&&this._updateCurrentBestFeature(n.at(0))}}},{key:"handleFeatureClick",value:function(e){var t,n=e.sector,r=e.featureIndexInSector;if(!isNaN(r)){var i=null===(t=this._sectorData)||void 0===t?void 0:t[n];(null===i||void 0===i?void 0:i.length)&&this._updateCurrentBestFeature(i.at(r))}}},{key:"loadBestImage",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loading=!0,null!==(n=this.view)&&void 0!==n&&n.closePopup(),this.displayMessage=null,this.selectedPoint=t.spatialReference.isGeographic?(0,J.$)(t):t.clone(),this.features.removeAll(),this.currentBestFeature=null,this.additionalFeatures.removeAll(),this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint=(0,U.SC)(this.bestFeatureCurrentFootprint),null!==(r=this._overlays)&&void 0!==r&&r.removeAll(),e.next=13,this._fetchFeaturesWithController(t);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadImageError",value:function(e){m.Z.getLogger(this).error("oriented-imagery-viewer:load-image",e),this.setMessage("imageLoadError","error",e.message)}},{key:"plotMapPoint",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.plotReferencePoint(t),this.transformAndPlotReferencePointOnImage({feature:this.currentBestFeature,selectedLocation:t,options:{signal:null===(n=this._transformController)||void 0===n?void 0:n.signal}})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"plotReferencePointOnGround",value:function(e){var t,n,r;this._referencePointOnGround&&(null!==(t=this._overlays)&&void 0!==t&&t.remove(this._referencePointOnGround),this._referencePointOnGround.destroy()),null!=e&&(this._referencePointOnGround=new D.Z({geometry:new pt.Z((0,N.Z)({},e.toJSON())),symbol:rt.C$}),this.view?null===(n=this._overlays)||void 0===n||n.add(this._referencePointOnGround):this.emit("plot-ground-point",{data:{point:null===(r=this._referencePointOnGround)||void 0===r?void 0:r.geometry}}))}},{key:"plotReferencePointOnImage",value:function(e){if("image-loaded"===this.state)switch(this._referencePointOnImage&&(this._imageViewer.removeGraphic(this._referencePointOnImage),this._panoramicViewer.removeGraphic(this._referencePointOnImage),this._referencePointOnImage.destroy()),this.mode){case"default":var t=(0,B.AK)(e)?e.toJSON():e;t.x-=.5,t.y=.5-t.y,this._referencePointOnImage=new D.Z({geometry:new pt.Z((0,N.Z)({spatialReference:this._imageViewer.imageRenderer.spatialReference},t)),symbol:rt.C$}),this._imageViewer.addGraphic(this._referencePointOnImage,0);break;case"panoramic":var n=this._panoramicViewer.imageSize;if(!n)return;var r=(0,s.Z)(n,2),i=r[0],a=r[1],o=(0,_.If)(e,i,a),l=o.heading,u=o.pitch,c=(0,_.n_)(l,u);this._referencePointOnImage=new D.Z({geometry:new pt.Z(c,Be.Z.WebMercator),symbol:rt.mH}),this._panoramicViewer.addGraphic(this._referencePointOnImage,0)}}},{key:"resetImage",value:function(){switch(this.setMessage("onLoadMessage","info"),this.mode){case"default":this._imageViewer.clearImage(),this._imageViewer.clearGraphics();break;case"panoramic":this._panoramicViewer.clearGraphics()}this._cancelFetchingFeatures()}},{key:"searchBestImage",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,re(t,n);case 3:if(r=e.sent,e.t0=r,!e.t0){e.next=8;break}return e.next=8,this._processFeatureResponse(r,t.point,{signal:null===n||void 0===n?void 0:n.signal});case 8:e.next=13;break;case 10:e.prev=10,e.t1=e.catch(0),(0,K.D_)(e.t1)||(this.setMessage("imageLoadError","error",e.t1.message),m.Z.getLogger(this).error("error occurred while finding best image",e.t1));case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"selectBestFeature",value:function(e){var t;this.currentBestFeature=null===(t=this.features)||void 0===t?void 0:t.find((function(t){return t.attributes.objectId===Number(e)}))}},{key:"setAdditionalCameraLocationsVisibility",value:function(e){this.additionalCameraLocations.forEach((function(t){t.visible=e}))}},{key:"setAdditionalCoverageVisibility",value:function(e){this.additionalFootprints.forEach((function(t){t.visible=e}))}},{key:"setCurrentCoverageVisibility",value:function(e){this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.visible=e),this.currentBestFeatureLocation&&(this.currentBestFeatureLocation.visible=e)}},{key:"setMapImageConversionToolState",value:function(e){this.mapImageConversionToolState=e}},{key:"transformAndPlotReferencePointOnImage",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,l,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.selectedLocation,i=t.options,o=null===(n=this.bestFeatureFootprint)||void 0===n?void 0:n.geometry,s=(0,Q.oU)(o)&&o.contains(r),l="mesh"===(null===o||void 0===o?void 0:o.type)&&(null===o||void 0===o?void 0:o.extent.contains(r)),s||l){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.transformPoint(r,i);case 5:return u=e.sent,e.abrupt("return",u?(this.plotReferencePointOnImage(u),{x:u.x,y:u.y}):void 0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateSuitabilities",value:function(e){this._suitabilities=e.sort((function(e,t){return e.suitability-t.suitability}));var t=this._suitabilities.map((function(e){return e.feature}));this._updateFeatures(t),this._groupFeaturesBySectors(),this._initialCurrentCoverageUpdate=!0}},{key:"_cancelFetchingFeatures",value:function(e){var t=this._fetchFeaturesController;t&&t.abort(e),this._fetchFeaturesController=null}},{key:"_fetchFeatures",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.view){e.next=2;break}return e.abrupt("return");case 2:if(!(r=this.layer)){e.next=11;break}if(i={include:r},o=this.view.toScreen(t)){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.view.hitTest(o,i);case 9:s=e.sent,this._processHitTestResults(r,s,n);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_fetchFeaturesWithController",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r,i=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._cancelFetchingFeatures(),n=new AbortController,r=n.signal,this._fetchFeaturesController=n,e.prev=3,e.next=6,this._fetchFeatures(t,{signal:r}).finally((function(){i._fetchFeaturesController=null}));case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),this.setMessage("imageLoadError","error"),m.Z.getLogger(this).error("error occurred while fetching features",e.t0);case 11:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_groupFeaturesBySectors",value:function(){var e=this,t=this._suitabilities,n=this.additionalFeatures,r=this.currentBestFeature,a=this.features;if(t&&n&&r&&a){this._sectorData={};var o,s=(0,E.Z)(O);try{for(s.s();!(o=s.n()).done;){var l=o.value;this._sectorData[l]=new G.Z}}catch(p){s.e(p)}finally{s.f()}var u=t.map((function(e,t){return(0,N.Z)((0,N.Z)({},e),{},{featureIndex:t})}));u.sort((function(e,t){return e.trueSuitability-t.trueSuitability}));var c=u.map((function(e){return e.distance})),d=Math.max.apply(Math,(0,i.Z)(c));u.forEach((function(t){var n,r,i=t.distance,o=t.angle,s=t.featureIndex,l=i/d*z[2],u=function(e,t){var n=e/t*z[2];return n<=z[0]?"NEAR":n<=z[1]?"":"FAR"}(i,d),c=function(e){return Math.abs(e)>=135?"WEST":e<-45&&e>-135?"SOUTH":e<=45?"EAST":"NORTH"}(o);if(e._sectorData){var p,h=z[3]+l*Math.sin(o*Math.PI/180),v=z[3]+l*Math.cos(o*Math.PI/180),f=a.at(s),m=f===e.currentBestFeature,y=(null===(n=e.currentBestFeature)||void 0===n?void 0:n.attributes.cameraPitch)&&(null===(r=e.currentBestFeature)||void 0===r?void 0:r.attributes.cameraPitch)<5;if(m&&y)p=-90;else{var g=h-z[3],b=v-z[3],w=b/Math.sqrt(Math.pow(g,2)+Math.pow(b,2)),_=180*Math.acos(w)/Math.PI;(g<0&&b<0||g<0&&b>0)&&(_*=-1),p=_}var C=""===u?c:"".concat(u,"_").concat(c);m&&(p===e.bestFeatureAngle?e.previousFeatureAngle=p:e.bestFeatureAngle=p,e.navigatorCurrentBestFeature=y?null:{x:h,y:v,direction:c});var Z=e._sectorData[C];Z.add({angle:o,featureIndex:s,x:h,y:v,objectID:f.attributes.objectId,sector:C,featureIndexInSector:Z.length})}}))}else this._sectorData=null}},{key:"_processFeatureResponse",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,l,u,c,d,p,h,v,f,y,g,b,w,_,C,Z,x;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(o=t.features)&&void 0!==o&&o.length){e.next=3;break}return e.abrupt("return",(this.setMessage("noImageError","error"),void(this.currentBestFeature=null)));case 3:if(this.coveragePolygons.removeAll(),this.coverageFrustums.removeAll(),this.pointSources.removeAll(),s=this.filterByFootprints(o,n),l=s.features,u=s.polygons,c=s.frustums,l.length){e.next=7;break}return e.abrupt("return",(this.setMessage("noImageError","error"),void(this.currentBestFeature=null)));case 7:this.coveragePolygons.addMany(u),this.coverageFrustums.addMany(c),d=new dt.Z({spatialReference:u[0].spatialReference}),p=(0,E.Z)(u);try{for(p.s();!(h=p.n()).done;)v=h.value.rings,d.addRing(v[0])}catch(a){p.e(a)}finally{p.f()}f=[],y=(0,E.Z)(l);try{for(y.s();!(g=y.n()).done;)b=g.value.geometry,d.contains(b)||f.push(b)}catch(a){y.e(a)}finally{y.f()}if(d.addRing(f),Re(w=d.extent,2),this.footprintExtent=w,null===(i=this.view)||void 0===i||!i.supportsGround){e.next=26;break}return e.prev=17,e.next=20,this.view.map.ground.createElevationSampler(w,r);case 20:_=e.sent,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(17),(0,K.D_)(e.t0)||m.Z.getLogger(this).error(e.t0);case 26:if(l[0].elevationSample=_,!_&&!l[0].attributes.elevationSource||!w){e.next=31;break}return e.next=29,(0,de.sg)([n],{feature:l[0],footprintExtent:w,options:r});case 29:(C=e.sent)[0]&&(Z=C[0],n.elevation=Z.z);case 31:l[0].elevationSample&&l.forEach((function(e){e.elevationSample=l[0].elevationSample})),this._suitabilities=ue({features:l,selectedPoint:n,camera:Ze(this.view)?this.view.camera:null,currentImage:this.currentBestFeature}),this.updateSuitabilities(this._suitabilities),x=this._suitabilities.map((function(e){return e.feature})),this.currentBestFeature=x[0],this._loading=!1;case 34:case"end":return e.stop()}}),e,this,[[17,23]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_processHitTestResults",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,l,u,c,d,p,h,v;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=n.screenPoint,c=(0,s.Z)(n.results,1),d=c[0],p="graphic"===(null===d||void 0===d?void 0:d.type)&&this.shouldShowSelectedImage,h=null!==(i=null===d||void 0===d?void 0:d.mapPoint)&&void 0!==i?i:null===(o=this.view)||void 0===o?void 0:o.toMap(u)){e.next=3;break}return e.abrupt("return");case 3:return v={layerInstanceOrURL:t,point:h,queryParams:{where:null!==(l=t.definitionExpression)&&void 0!==l?l:"1=1",maximumDistance:t.maximumDistance,objectIds:p?[d.graphic.getAttribute(t.objectIdField)]:void 0}},e.next=6,this.searchBestImage(v,r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_updateFeatures",value:function(e){if(!e.length)return this.currentBestFeature=null,void this.additionalFeatures.removeAll();this.features.removeAll(),this.features.addMany(e),this.currentBestFeature=e[0],e.length>1?this.additionalFeatures.addMany(e.slice(1)):this.additionalFeatures.removeAll()}},{key:"_updatePointsAndPolygons",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.pointSources,r=this.currentBestFeature,i=this.currentCoverageVisible,o=this.isAdditionalPointSourcesVisible,!r){e.next=10;break}return this.additionalFootprints.removeAll(),this.additionalCameraLocations.removeAll(),this.bestFeatureCurrentFootprint&&(this.bestFeatureCurrentFootprint.destroy(),this.bestFeatureCurrentFootprint=null,this.bestFeatureFootprint=null),e.next=7,null===(s=this._adapter)||void 0===s?void 0:s.createFootprints(t);case 7:(0,K.k_)(t),l=(0,E.Z)(n);try{for(l.s();!(u=l.n()).done;)(c=u.value).imageID===r.attributes.objectId?this.currentBestFeatureLocation=new D.Z({attributes:{imageID:c.imageID},geometry:c,symbol:rt.Lr,visible:i}):this.additionalCameraLocations.push(new D.Z({attributes:{imageID:c.imageID},geometry:c,symbol:rt.FH,visible:o}))}catch(a){l.e(a)}finally{l.f()}case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateCurrentBestFeature",value:function(e){var t,n,r;if(e){this.currentBestFeature=null===(t=this.features)||void 0===t?void 0:t.at(e.featureIndex);var i,a=(null===(n=this.currentBestFeature)||void 0===n?void 0:n.attributes.cameraPitch)&&(null===(r=this.currentBestFeature)||void 0===r?void 0:r.attributes.cameraPitch)<5;if(a)i=-90;else{var o=e.x-z[3],s=e.y-z[3],l=s/Math.sqrt(Math.pow(o,2)+Math.pow(s,2)),u=180*Math.acos(l)/Math.PI;(o<0&&s<0||o<0&&s>0)&&(u*=-1),i=u}i===this.bestFeatureAngle?this.previousFeatureAngle=i:this.bestFeatureAngle=i,this.navigatorCurrentBestFeature=a?null:{x:e.x,y:e.y,direction:e.sector.includes("_")?e.sector.split("_")[1]:e.sector}}}},{key:"clearGraphics",value:function(){this._imageViewer.clearGraphics(),this._panoramicViewer.clearGraphics()}},{key:"plotReferencePoint",value:function(e){"mapPoint"in e?this.plotReferencePointOnGround(e.mapPoint):this.plotReferencePointOnGround(e)}},{key:"setMessage",value:function(e,t,n,r){this._loading=!1,this.displayMessage={key:e,type:t,data:n,map:r}}},{key:"transformAndPlotSelectedLocation",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.currentBestFeature,r=this.selectedPoint,i=this.state,this._crossSymbol&&(this._panoramicViewer.removeGraphic(this._crossSymbol),this._imageViewer.removeGraphic(this._crossSymbol),this._crossSymbol=(0,U.SC)(this._crossSymbol)),r&&n&&"image-loaded"===i){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,this.transformPoint(r,t);case 6:return o=e.sent,(0,K.k_)(t),e.next=10,this.plotSelectedPointOnImage(o,t);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),(0,K.D_)(e.t0)||m.Z.getLogger(this).error("failed to transform map point to pixel, cross symbol will not be plotted on image",{error:e.t0,selectedPoint:r,feature:n});case 15:case"end":return e.stop()}}),e,this,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"transformPoint",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("none"!==this.mode){e.next=2;break}return e.abrupt("return");case 2:return s=this.currentBestFeature,e.next=5,(0,de.y5)([t],{feature:s,imageProperties:"default"===this.mode?this._imageViewer.viewModel.image.serviceRasterInfo:{width:null===(r=this._panoramicViewer.imageSize)||void 0===r?void 0:r[0],height:null===(i=this._panoramicViewer.imageSize)||void 0===i?void 0:i[1]},options:n},"3d"===(null===(o=this.view)||void 0===o?void 0:o.type));case 5:if((l=e.sent).length){e.next=8;break}return e.abrupt("return");case 8:return e.abrupt("return",l[0]);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateCurrentCoveragePolygon",value:function(e){var t,n=this.additionalFootprints,r=this.additionalCameraLocations,a=this.currentBestFeature,o=this.currentBestFeatureLocation,s=this.currentCoverageVisible,l=this.selectedPoint,u=this.view,c=this._adapter,d=a.attributes.objectId,p=a.elevationSample;if(this._initialCurrentCoverageUpdate){if(null!==(t=this._overlays)&&void 0!==t&&t.removeAll(),this._initialCurrentCoverageUpdate=!1,this.bestFeatureCurrentFootprint=(0,U.SC)(this.bestFeatureCurrentFootprint),e&&(e.visible=s,this.bestFeatureCurrentFootprint=e),u){var h=[].concat((0,i.Z)(n),(0,i.Z)(r),[this.bestFeatureCurrentFootprint,o]).filter(xe);u.supportsGround&&p&&null!==c&&void 0!==c&&c.updateGroundElevation&&c.updateGroundElevation(h,p),l&&h.push(new D.Z({geometry:l.clone(),symbol:rt.tA.clone(),attributes:{imageID:d}})),this._overlays.graphics.addMany(h)}}else if(u){var v,f;this.bestFeatureCurrentFootprint&&(null!==(v=this._overlays)&&void 0!==v&&v.remove(this.bestFeatureCurrentFootprint),this.bestFeatureCurrentFootprint=(0,U.SC)(this.bestFeatureCurrentFootprint));var m=this.bestFeatureCurrentFootprint&&this._overlays?this._overlays.graphics.indexOf(this.bestFeatureCurrentFootprint):-1;e&&(this.bestFeatureCurrentFootprint=e,null!==u&&void 0!==u&&u.supportsGround&&p&&null!==c&&void 0!==c&&c.updateGroundElevation&&c.updateGroundElevation([e],p),e.visible=this.currentCoverageVisible,null===(f=this._overlays)||void 0===f||f.graphics.add(this.bestFeatureCurrentFootprint,m>=0?m:this._overlays.graphics.length-1))}}}]),h}(W.Z.EventedAccessor);(0,h._)([(0,b.Cb)()],Mt.prototype,"activeLayer",null),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"activeViewer",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"additionalFeatures",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"bestFeatureAngle",void 0),(0,h._)([(0,b.Cb)({type:Number})],Mt.prototype,"brightness",null),(0,h._)([(0,b.Cb)({type:Number})],Mt.prototype,"contrast",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"coverageFrustums",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"coveragePolygons",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"currentBestFeature",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"currentCoverageVisible",void 0),(0,h._)([(0,b.Cb)({json:{write:!1}})],Mt.prototype,"determineWorkflowForFeature",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"disabled",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"displayMessage",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"drawFootprint",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"featureCount",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"features",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"imageGalleryEnabled",null),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"imageLoaded",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"imagePointsInView",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"isAdditionalCoverageVisible",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"isAdditionalPointSourcesVisible",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"layer",void 0),(0,h._)([(0,b.Cb)({type:Number})],Mt.prototype,"localPort",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"mapImageConversionToolState",void 0),(0,h._)([(0,b.Cb)({readOnly:!0,value:"none"})],Mt.prototype,"mode",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"navigatorCurrentBestFeature",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"pointSources",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"popupEnabled",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"previousFeatureAngle",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"referencePoint",null),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"sectorData",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"selectedPoint",void 0),(0,h._)([(0,b.Cb)({type:Number})],Mt.prototype,"sharpness",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"shouldShowSelectedImage",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"state",null),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"thumbnails",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"updateFootprint",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"updateFootprintPanorama",void 0),(0,h._)([(0,b.Cb)({value:null})],Mt.prototype,"view",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"_adapter",void 0),(0,h._)([(0,b.Cb)({type:G.Z.ofType(D.Z)})],Mt.prototype,"additionalFootprints",void 0),(0,h._)([(0,b.Cb)({type:G.Z.ofType(D.Z)})],Mt.prototype,"additionalCameraLocations",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"bestFeatureCurrentFootprint",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_fetchFeaturesController",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_highlightedFeatureHandle",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_imageViewer",void 0),(0,h._)([(0,b.Cb)({type:D.Z})],Mt.prototype,"bestFeatureFootprint",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_initialCurrentCoverageUpdate",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_loading",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_overlays",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],Mt.prototype,"_overlaysView",null),(0,h._)([(0,b.Cb)()],Mt.prototype,"_panoramicViewer",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_referencePointOnGround",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_referencePointOnImage",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"currentBestFeatureLocation",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"_sectorData",void 0),(0,h._)([(0,b.Cb)()],Mt.prototype,"footprintExtent",void 0);var kt=Mt=(0,h._)([(0,w.j)("esri.widgets.OrientedImageryViewer.OrientedImageryViewerViewModel")],Mt),It=function(e){(0,d.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,l.Z)(this,n),(e=t.apply(this,arguments)).closeButton=!0,e.coverageMenu=!0,e.imageEnhancement=!0,e.imageGallery=!0,e.mapImageConversionTool=!0,e.navigationTool=!0,e.title=!0,e.viewerTools=!0,e.showPopupsAction=!0,e}return(0,u.Z)(n)}(n(7138).default);(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"closeButton",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"coverageMenu",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"imageEnhancement",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"imageGallery",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"mapImageConversionTool",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"navigationTool",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"title",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"viewerTools",void 0),(0,h._)([(0,b.Cb)({type:Boolean,nonNullable:!0})],It.prototype,"showPopupsAction",void 0);var St=It=(0,h._)([(0,w.j)("esri.widgets.OrientedImageryViewer.OrientedImageryViewerVisibleElements")],It),Pt=n(8905),Ft=n(80532),Rt=n(8704),zt=function(e){(0,d.Z)(h,e);var t=(0,p.Z)(h);function h(e,n){var r;return(0,l.Z)(this,h),(r=t.call(this,e,n)).dockEnabled=!1,r.galleryOpened=!1,r.imageEnhancementToolActive=!1,r.navigationToolActive=!1,r.viewModel=new kt,r.messagesCommon=null,r.visibleElements=new St,r._navigationToolExpanded=!1,r._navigationTool=null,r._actionItems=new Map,r._galleryController=new AbortController,r._galleryObserver=new IntersectionObserver(r._lazyLoadImage.bind((0,c.Z)(r))),r._highlight=function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.dataset.objectid;n&&r.viewModel.highlight(n)},r._removeHighlight=function(){return r.viewModel.removeHighlight()},r._scaleNavigationTool=function(){r._navigationToolExpanded=!r._navigationToolExpanded},r._toogleImageAttributes=function(){r.viewModel.toggleImageAttributes()},r._loadImageFromGallery=r._loadImageFromGallery.bind((0,c.Z)(r)),r._registerGalleryItem=r._registerGalleryItem.bind((0,c.Z)(r)),r._unregisterGalleryItem=r._unregisterGalleryItem.bind((0,c.Z)(r)),r._renderViewerContainer=r._renderViewerContainer.bind((0,c.Z)(r)),r.loadImageFromSource=r.loadImageFromSource.bind((0,c.Z)(r)),r.updateSuitabilities=r.updateSuitabilities.bind((0,c.Z)(r)),r}return(0,u.Z)(h,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,g.watch)((function(){var t;return[null===(t=e.viewModel)||void 0===t?void 0:t.bestFeatureAngle,e._navigationTool]}),(function(t){var n=(0,s.Z)(t,2),r=(n[0],n[1]);r&&e._updateNavigationTool(r)}),g.initial),(0,g.watch)((function(){return e.currentCoverageVisible}),(function(t){return e._onCurrentCoverageVisibilityChange(t)})),(0,g.watch)((function(){return e.isAdditionalCoverageVisible}),(function(t){return e._onAdditionalCoverageVisibilityChange(t)})),(0,g.watch)((function(){return e.isAdditionalPointSourcesVisible}),(function(t){return e._onAdditionalCameraLocationsVisibility(t)}))])}},{key:"loadDependencies",value:function(){return(0,Pt.h)({tooltip:function(){return Promise.all([n.e(92358),n.e(89219),n.e(94730)]).then(n.bind(n,94730))},action:function(){return Promise.all([n.e(92358),n.e(46895),n.e(65138),n.e(91741)]).then(n.bind(n,6814))},"action-group":function(){return Promise.all([n.e(92358),n.e(46895),n.e(89219),n.e(63839),n.e(65138),n.e(2654),n.e(23635),n.e(70405)]).then(n.bind(n,70405))},"action-bar":function(){return Promise.all([n.e(92358),n.e(46895),n.e(89219),n.e(63839),n.e(65138),n.e(2654),n.e(23635),n.e(68698)]).then(n.bind(n,68698))},label:function(){return Promise.all([n.e(92358),n.e(35738)]).then(n.bind(n,35738))},panel:function(){return Promise.all([n.e(92358),n.e(46895),n.e(89219),n.e(63839),n.e(65138),n.e(2654),n.e(23635),n.e(89524),n.e(85026)]).then(n.bind(n,85026))},slider:function(){return Promise.all([n.e(92358),n.e(46895),n.e(54438),n.e(69008)]).then(n.bind(n,69008))}})}},{key:"destroy",value:function(){this._galleryController.abort(),this._galleryObserver.disconnect()}},{key:"activeLayer",get:function(){return(0,f.Mr)(m.Z.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer},set:function(e){(0,f.Mr)(m.Z.getLogger(this),"activeLayer",{replacement:"layer"}),this.layer=e}},{key:"currentBestFeature",get:function(){return this.viewModel.currentBestFeature},set:function(e){this.viewModel.currentBestFeature=e}},{key:"currentCoverageVisible",get:function(){return this.viewModel.currentCoverageVisible},set:function(e){this.viewModel.currentCoverageVisible=e}},{key:"disabled",get:function(){return this.viewModel.disabled},set:function(e){this.viewModel.disabled=e}},{key:"displayMessage",get:function(){return this.viewModel.displayMessage}},{key:"drawFootprint",get:function(){return this.viewModel.drawFootprint},set:function(e){this.viewModel.drawFootprint=e}},{key:"features",get:function(){return this.viewModel.features}},{key:"imagePointsInView",get:function(){return this.viewModel.imagePointsInView}},{key:"isDocked",get:function(){return(0,f.Mr)(m.Z.getLogger(this),"isDocked",{replacement:"dockEnabled"}),this.dockEnabled},set:function(e){(0,f.Mr)(m.Z.getLogger(this),"isDocked",{replacement:"dockEnabled"}),this.dockEnabled=e}},{key:"icon",get:function(){return"oriented-imagery-widget"},set:function(e){this._overrideIfSome("icon",e)}},{key:"imageGalleryEnabled",get:function(){return this.viewModel.imageGalleryEnabled}},{key:"isAdditionalCoverageVisible",get:function(){return this.viewModel.isAdditionalCoverageVisible},set:function(e){this.viewModel.isAdditionalCoverageVisible=e}},{key:"isAdditionalPointSourcesVisible",get:function(){return this.viewModel.isAdditionalPointSourcesVisible},set:function(e){this.viewModel.isAdditionalPointSourcesVisible=e}},{key:"mapImageConversionToolState",get:function(){return this.viewModel.mapImageConversionToolState},set:function(e){this.viewModel.mapImageConversionToolState=e}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"popupEnabled",get:function(){var e=this.viewModel,t=e.popupEnabled;return"image-loaded"===e.state&&t}},{key:"referencePoint",get:function(){var e;return null!==(e=this.viewModel.referencePoint)&&void 0!==e?e:null}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"determineWorkflowForFeature",get:function(){return this.viewModel.determineWorkflowForFeature},set:function(e){this.viewModel.determineWorkflowForFeature=e}},{key:"updateFootprint",get:function(){return this.viewModel.updateFootprint},set:function(e){this.viewModel.updateFootprint=e}},{key:"_getThumbnailPixelBlockInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,l,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._getMaxLevelRasterParameters(t),i=r.level,o=r.offset,s=r.size,e.prev=1,e.next=4,t.fetchRawPixels(i,o,s,n);case 4:return l=e.sent,u=l.pixelBlock,e.abrupt("return",u);case 9:e.prev=9,e.t0=e.catch(1),m.Z.getLogger(this).warn("failed to create canvas with pixel data",e.t0);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getMaxLevelRasterParameters",value:function(e){var t=e.rasterInfo,n=t.storageInfo,r=t.width,i=t.height,a=n.maximumPyramidLevel,o=n.pyramidScalingFactor,s=null!==o&&void 0!==o?o:2;return{level:a,offset:{x:0,y:0},size:{width:Math.ceil(r/Math.pow(s,a)),height:Math.ceil(i/Math.pow(s,a))}}}},{key:"_getThumbnailPixelBlock",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._galleryController.signal,e.prev=1,e.next=4,C.Z.open({url:t,signal:n});case 4:if(!(r=e.sent)){e.next=11;break}return e.next=8,this._getThumbnailPixelBlockInternal(r,{signal:n});case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=null;case 12:return e.abrupt("return",e.t0);case 15:e.prev=15,e.t1=e.catch(1),m.Z.getLogger(this).error("failed to create thumbnail",e.t1);case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleBrightnessChange",value:function(e){var t;this.viewModel.brightness=null!==(t=e.target.value)&&void 0!==t?t:0}},{key:"_handleContrastChange",value:function(e){var t;this.viewModel.contrast=null!==(t=e.target.value)&&void 0!==t?t:0}},{key:"_handleSharpnessChange",value:function(e){var t;this.viewModel.sharpness=null!==(t=e.target.value)&&void 0!==t?t:0}},{key:"_lazyLoadImage",value:function(e,t){var n=this;e.forEach(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(r){var i,o,s,l,u,c,d,p,h,v,f,g,b,w,C,Z,x;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isIntersecting){e.next=22;break}if(i=r.target,o=i.getAttribute("data-src"),s=i.getAttribute("data-rotation"),l=s?parseFloat(s)%360:null,o){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,n._getThumbnailPixelBlock(o);case 6:if(u=e.sent){e.next=9;break}return e.abrupt("return");case 9:if(i.width=u.width,i.height=u.height,c=i.getContext("2d")){e.next=13;break}return e.abrupt("return");case 13:if((d=c.createImageData(i.width,i.height)).data.set(u.getAsRGBA()),"number"!=typeof l||0===l){e.next=21;break}if(p=(0,y.Vl)(l),h=document.createElement("canvas"),!(v=h.getContext("2d"))){e.next=20;break}return h.width=d.width,h.height=d.height,v.putImageData(d,0,0),f=(0,_.Xt)(0,0,p),g=(0,_.Xt)(d.width,0,p),b=(0,_.Xt)(d.width,d.height,p),w=(0,_.Xt)(0,d.height,p),C=Math.max(f[0],g[0],b[0],w[0])-Math.min(f[0],g[0],b[0],w[0]),Z=Math.max(f[1],g[1],b[1],w[1])-Math.min(f[1],g[1],b[1],w[1]),x=Math.min(i.width/C,i.height/Z),e.abrupt("return",(c.save(),c.clearRect(0,0,i.width,i.height),c.translate(i.width/2,i.height/2),c.rotate(p),c.scale(x,x),c.drawImage(h,-d.width/2,-d.height/2,d.width,d.height),c.restore(),t.unobserve(i)));case 20:m.Z.getLogger(n).warn("oriented-imagery-viewer:image-gallery","failed to apply rotation on thumbnail");case 21:c.putImageData(d,0,0),t.unobserve(i);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"_loadImageFromGallery",value:function(e){var t,n=e.target;if(n){var r=n.getAttribute("data-objectid");r&&(null===(t=this.viewModel.currentBestFeature)||void 0===t?void 0:t.attributes.objectId)!==Number(r)&&this.viewModel.selectBestFeature(r)}}},{key:"_onAdditionalCoverageVisibilityChange",value:function(e){this.viewModel.setAdditionalCoverageVisibility(e)}},{key:"_onAdditionalCameraLocationsVisibility",value:function(e){this.viewModel.setAdditionalCameraLocationsVisibility(e)}},{key:"_onCurrentCoverageVisibilityChange",value:function(e){this.viewModel.setCurrentCoverageVisibility(e)}},{key:"_registerGalleryItem",value:function(e){this._galleryObserver.observe(e)}},{key:"_renderActionTooltips",value:function(){return(0,i.Z)(this._actionItems).map((function(e){var t=(0,s.Z)(e,2),n=t[0],r=t[1];return(0,et.u)("calcite-tooltip",{key:n,referenceElement:r},(0,et.u)("span",null,n))}))}},{key:"_renderBody",value:function(){return(0,et.u)("div",{class:R.body},this._renderViewerContainer(),this._renderImageGallery(),this._renderImageEnhancementTools(),this._renderNavigation())}},{key:"_renderImageEnhancementTools",value:function(){var e=this.imageEnhancementToolActive,t=this.viewModel,n=t.brightness,r=t.contrast,i=t.sharpness;return e&&(0,et.u)("calcite-panel",{bind:this,class:R.imageEnhancementWrapper,closable:!0,closed:!e,heading:this.messages.imageEnhancement,key:this.messages.imageEnhancement,onCalcitePanelClose:this._toggleImageEnhancementToolState},(0,et.u)("div",{class:R.imageEnhancementTools},(0,et.u)("div",{class:R.imageEnhancementToolContainer},(0,et.u)("calcite-label",null,this.messages.brightness,(0,et.u)("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:n,onCalciteSliderInput:this._handleBrightnessChange}))),(0,et.u)("div",{class:R.imageEnhancementToolContainer},(0,et.u)("calcite-label",null,this.messages.contrast,(0,et.u)("calcite-slider",{bind:this,labelTicks:!0,max:10,min:-10,ticks:5,value:r,onCalciteSliderInput:this._handleContrastChange}))),(0,et.u)("div",{class:R.imageEnhancementToolContainer},(0,et.u)("calcite-label",null,this.messages.sharpness,(0,et.u)("calcite-slider",{bind:this,labelTicks:!0,max:1,min:0,step:.1,ticks:.5,value:i,onCalciteSliderInput:this._handleSharpnessChange})))),(0,et.u)("calcite-action",{bind:this,icon:"reset",onclick:this._resetImageTools,slot:"header-actions-end",text:this.messagesCommon.reset}))}},{key:"_renderImageGallery",value:function(){var e=this.container,t=this.galleryOpened,n=this.imageGalleryEnabled,r=this.viewModel.thumbnails;return n&&t&&e&&r?(0,et.u)("calcite-panel",{bind:this,class:R.carousel,closable:!0,closed:!t,heading:this.messages.imageGallery,key:this.messages.imageGallery,onCalcitePanelClose:this._toggleImageGallery},(0,et.u)("div",{class:R.carouselContainer},this._renderThumbnails(r))):null}},{key:"_renderMapImageConversionTool",value:function(){var e=this.mapImageConversionToolState,t=this.viewModel.state;return(0,et.u)("calcite-action",{active:e,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==t,icon:"image-pin",onclick:this._toggleMapImageConversionToolState,text:this.messages.mapImageConversionTool})}},{key:"_renderNavigation",value:function(){var e,t,n,i,a,o,l=this,u=this.viewModel,c=u.sectorData,d=u.navigatorCurrentBestFeature,p=u.currentBestFeature,h=u.state;if(!this.container||!p)return null;if(d){var f=d.x,m=d.y,y=d.direction,g=(0,s.Z)(T[y],4),b=g[0],w=g[1],_=g[2],C=g[3];t="M ".concat(f," ").concat(m," L ").concat(b," ").concat(w," A ").concat(z[2]," ").concat(z[2]," 0 0 1 ").concat(_," ").concat(C," Z"),n=f,a=m,i=T[y][4],o=T[y][5]}var Z=function(e){var t,n=null===(t=e.target.dataset)||void 0===t?void 0:t.sector;n&&l.viewModel.handleSectorClick(+n)},x=function(e){var t=e.target.dataset;if(t){var n=t.featureIndexInSector,r=t.sector;n&&r&&l.viewModel.handleFeatureClick({sector:r,featureIndexInSector:+n})}},M=function(e){e.removeEventListener("click",x)},I=p.attributes.objectId,S=null===c||void 0===c?void 0:c.map((function(e){return null===e||void 0===e?void 0:e.items})).filter(Boolean).flatMap((function(e){return null===e||void 0===e?void 0:e.map((function(e){var t=e.x,n=e.y,r=e.objectID,i=e.featureIndexInSector,a=e.sector;return(0,et.u)("circle",{afterRemoved:M,class:l.classes(R.feature,{selected:I===r}),cx:t,cy:n,"data-feature-index-in-sector":i,"data-sector":a,key:"".concat(R.feature,"-").concat(r),onclick:x,r:3.5})}))})),P=function(e){e.removeEventListener("click",Z)},O=this.classes((e={},(0,r.Z)(e,R.navigationWrapper,!0),(0,r.Z)(e,R.navigationZoomed,this._navigationToolExpanded),e));return this.navigationToolActive&&"image-loaded"===h?(0,et.u)("div",{bind:this,class:O,key:this.messages.navigationTool},(0,et.u)("svg",{afterCreate:function(e){return l._storeNavigationToolReference(e)},class:(0,v.n)()?F:R.rotateWithAnimation,focusable:"false",height:120,role:"img",width:120,xmlns:"http://www.w3.org/2000/svg"},(0,et.u)("defs",null,(0,et.u)("linearGradient",{gradientUnits:"userSpaceOnUse",id:"".concat(this.id,"-coverage-fill"),x1:n,x2:i,y1:a,y2:o},(0,et.u)("stop",{class:R.navigationPathOffset0,offset:0}),(0,et.u)("stop",{class:R.navigationPathOffset1,offset:1}))),(0,et.u)("g",null,(0,et.u)("circle",{class:this.classes(R.sector,R.outerSector),cx:z[3],cy:z[3],onclick:this._scaleNavigationTool,r:z[3]}),(0,et.u)("circle",{class:R.sector,cx:z[3],cy:z[3],r:z[2]}),(0,et.u)("circle",{class:R.sector,cx:z[3],cy:z[3],r:z[1]}),(0,et.u)("circle",{class:R.sector,cx:z[3],cy:z[3],r:z[0]}),(0,et.u)("path",{class:R.pointer,d:"M 56.5 6.06217782649107 L 60 0 L 63.5 6.06217782649107 Z",key:"".concat(R.pointer,"-west")}),(0,et.u)("path",{class:this.classes(R.pointer,R.north),d:"M 113.93782217350893 56.5 L 120 60 L 113.93782217350893 63.5 Z",key:"".concat(R.pointer,"-north")}),(0,et.u)("path",{class:R.pointer,d:"M 56.5 113.93782217350893 L 60 120 L 63.5 113.93782217350893 Z",key:"".concat(R.pointer,"-east")}),(0,et.u)("path",{class:R.pointer,d:"M 6.06217782649107 56.5 L 0 60 L 6.06217782649107 63.5 Z",key:"".concat(R.pointer,"-south")}),(0,et.u)("path",{class:this.classes(R.sector,R.sectorSeparator),d:"M 23.937554159486076 23.937554159486076 L 96.06244584051393 96.06244584051393 M 23.937554159486076 96.06244584051393 L 96.06244584051393 23.937554159486076",key:R.sectorSeparator}),k([z[2],z[1],z[0]],z[3],z[3]).map((function(e,t){var n;return(0,et.u)("path",{afterRemoved:P,class:l.classes(R.sector,null!==c&&void 0!==c&&null!==(n=c[t])&&void 0!==n&&n.length?R.sectorEnabled:R.sectorDisabled),d:e,"data-sector":"".concat(t),key:"".concat(R.sector,"-").concat(t),onclick:Z})})),(0,et.u)("path",{class:this.classes(R.sector,R.sectorCross),d:"M 56.4 56.4 L 63.53 63.53 M 63.53 56.4 L 56.4 63.53",key:R.sectorCross}),S,p.attributes.cameraPitch>=5&&t?(0,et.u)("path",{class:R.selectedFeaturePath,d:t,fill:"url(#".concat(this.id,"-coverage-fill)"),key:R.selectedFeaturePath}):null))):null}},{key:"_renderNavigationTool",value:function(){var e=this.viewModel.state;return(0,et.u)("calcite-action",{active:this.navigationToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"image-loaded"!==e,icon:"explore",onclick:this._toggleNavigationTool,text:this.messages.navigationTool})}},{key:"_renderImageEnhancementTool",value:function(){var e=this.viewModel,t=e.state,n=e.mode;return(0,et.u)("calcite-action",{active:this.imageEnhancementToolActive,afterCreate:this._storeActionElement,bind:this,disabled:"default"!==n||"image-loaded"!==t,icon:"sliders-horizontal",onclick:this._toggleImageEnhancementToolState,text:this.messages.imageEnhancement})}},{key:"_renderMenuBarContainer",value:function(){var e=this.currentCoverageVisible,t=this.isAdditionalCoverageVisible,n=this.isAdditionalPointSourcesVisible,r=this.imageGalleryEnabled;return(0,et.u)("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",slot:"action-bar"},(0,et.u)("calcite-action-group",{expanded:!0},(0,et.u)("calcite-action",{active:e,afterCreate:this._storeActionElement,bind:this,class:R.currentCoverage,icon:"trapezoid-area",onclick:this._toggleCurrentCoverage,text:this.messages.currentFootprint}),(0,et.u)("calcite-action",{active:t,afterCreate:this._storeActionElement,bind:this,class:R.addCoverage,icon:"trapezoid-area",onclick:this._toggleAdditionalCoverage,text:this.messages.additionalFootprints}),(0,et.u)("calcite-action",{active:n,afterCreate:this._storeActionElement,bind:this,class:R.addExpPoints,icon:"circle-area",onclick:this._toggleAdditionalCameraLocations,text:this.messages.additionalCameraLocations})),(0,et.u)("calcite-action-group",{layout:"horizontal"},this.visibleElements.mapImageConversionTool?this._renderMapImageConversionTool():null,this.visibleElements.navigationTool?this._renderNavigationTool():null,this.visibleElements.imageEnhancement?this._renderImageEnhancementTool():null),(0,et.u)("calcite-action-group",null,(0,et.u)("calcite-action",{active:this.galleryOpened,afterCreate:this._storeActionElement,bind:this,disabled:!r,icon:"images",onclick:this._toggleImageGallery,text:this.messages.imageGallery,textEnabled:!0}),this.visibleElements.showPopupsAction?this._renderPopupAction():null),this._renderActionTooltips())}},{key:"_renderMessageBox",value:function(){var e=this.messages,t=this.viewModel.displayMessage;if(!t)return null;var n=t.data,r=t.key,i=t.map,a="".concat(i?(0,Rt.n)(e[r],i):e[r]);return(0,et.u)("span",{class:R.messageBox},n?"".concat(a," ").concat(n):a)}},{key:"_renderPopupAction",value:function(){return(0,et.u)("calcite-action",{afterCreate:this._storeActionElement,bind:this,disabled:!this.popupEnabled,icon:"popup",onclick:this._toogleImageAttributes,text:this.messages.showPopups,textEnabled:!0})}},{key:"_renderThumbnails",value:function(e){var t=this,n=this.viewModel.currentBestFeature;return n?(0,et.u)("div",{class:R.carouselContent},e.items.map((function(e,r){var i=e.url,a=e.objectId,o=e.rotation;return(0,et.u)("div",{class:"".concat(R.carouselItemWrapper).concat(n.attributes.objectId===a?"--selected":""),key:"".concat(R.carouselItemWrapper,"-").concat(r)},(0,et.u)("canvas",{afterCreate:t._registerGalleryItem,afterRemoved:t._unregisterGalleryItem,alt:"thumbnail-".concat(a),class:R.carouselItem,"data-objectid":"".concat(a),"data-rotation":"".concat(o),"data-src":i,onclick:t._loadImageFromGallery,onmouseenter:t._highlight,onmouseleave:t._removeHighlight}))}))):null}},{key:"_renderViewerContainer",value:function(){return(0,et.u)("div",{class:R.viewerContainer},this._renderImageViewer(),this._renderPanoramicViewer(),this._renderMessageBox())}},{key:"_renderImageViewer",value:function(){var e=this.viewModel,t=e.displayMessage,n=e.loadImageViewer,r=e.mode,i="".concat(R.viewer).concat(t||"default"!==r?"--hide":"");return(0,et.u)("calcite-panel",{afterCreate:n,bind:this,class:i})}},{key:"_renderPanoramicViewer",value:function(){var e=this.viewModel,t=e.displayMessage,n=e.loadPanoramicViewer,r=e.mode,i="".concat(R.viewer).concat(t||"panoramic"!==r?"--hide":"");return(0,et.u)("calcite-panel",{afterCreate:n,bind:this,class:i})}},{key:"_resetImageTools",value:function(){this.viewModel.sharpness=this.viewModel.brightness=this.viewModel.contrast=0}},{key:"_storeActionElement",value:function(e){this._actionItems.set(e.text,e)}},{key:"_storeNavigationToolReference",value:function(e){this._navigationTool=e}},{key:"_toggleAdditionalCameraLocations",value:function(){this.isAdditionalPointSourcesVisible=!this.isAdditionalPointSourcesVisible}},{key:"_toggleAdditionalCoverage",value:function(){this.isAdditionalCoverageVisible=!this.isAdditionalCoverageVisible}},{key:"_toggleCurrentCoverage",value:function(){this.currentCoverageVisible=!this.currentCoverageVisible}},{key:"_toggleImageEnhancementToolState",value:function(e){e.stopPropagation(),this.imageEnhancementToolActive=!this.imageEnhancementToolActive,this.imageEnhancementToolActive&&(this.galleryOpened&&(this.galleryOpened=!1),this.navigationToolActive&&(this.navigationToolActive=!1))}},{key:"_toggleImageGallery",value:function(e){e.stopPropagation(),this.galleryOpened=!!this.imageGalleryEnabled&&!this.galleryOpened,this.galleryOpened&&(this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1),this.navigationToolActive&&(this.navigationToolActive=!1))}},{key:"_toggleNavigationTool",value:function(){this.navigationToolActive=!this.navigationToolActive,this.navigationToolActive&&(this.galleryOpened&&(this.galleryOpened=!1),this.imageEnhancementToolActive&&(this.imageEnhancementToolActive=!1))}},{key:"_toggleMapImageConversionToolState",value:function(){this.mapImageConversionToolState=!this.mapImageConversionToolState}},{key:"_unregisterGalleryItem",value:function(e){this._galleryObserver.unobserve(e)}},{key:"_updateNavigationTool",value:function(e){var t=this.viewModel,n=t.previousFeatureAngle,r=(t.bestFeatureAngle-n+540)%360-180;e.style.setProperty("--oi-navigation-tool-rotation-from","".concat(n,"deg")),e.style.setProperty("--oi-navigation-tool-rotation-to","".concat(n+r,"deg"))}},{key:"loadBestImage",value:function(e){this.viewModel.loadBestImage(e)}},{key:"loadImageFromSource",value:function(e,t){return this.viewModel.loadImageFromSource(e,t)}},{key:"plotMapPoint",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.viewModel.plotMapPoint(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"plotReferencePointOnGround",value:function(e){this.viewModel.plotReferencePointOnGround(e)}},{key:"plotReferencePointOnImage",value:function(e){this.viewModel.plotReferencePointOnImage(e)}},{key:"resetImage",value:function(){this.viewModel.resetImage()}},{key:"render",value:function(){var e=this.dockEnabled,t=this.viewModel.state;return(0,et.u)("div",{class:this.classes($e.z.widget,I)},(0,et.u)("calcite-panel",{bind:this,class:e?R.dock:R.float,heading:this.visibleElements.title?this.messages.title:void 0,loading:"image-loading"===t},this.visibleElements.coverageMenu?this._renderMenuBarContainer():null,this._renderBody()))}},{key:"updateSuitabilities",value:function(e){this.viewModel.updateSuitabilities(e)}}]),h}(Z.Z);(0,h._)([(0,b.Cb)()],zt.prototype,"activeLayer",null),(0,h._)([(0,b.Cb)()],zt.prototype,"currentBestFeature",null),(0,h._)([(0,b.Cb)()],zt.prototype,"currentCoverageVisible",null),(0,h._)([(0,b.Cb)()],zt.prototype,"disabled",null),(0,h._)([(0,b.Cb)()],zt.prototype,"dockEnabled",void 0),(0,h._)([(0,b.Cb)()],zt.prototype,"drawFootprint",null),(0,h._)([(0,b.Cb)()],zt.prototype,"features",null),(0,h._)([(0,b.Cb)()],zt.prototype,"imagePointsInView",null),(0,h._)([(0,b.Cb)()],zt.prototype,"isDocked",null),(0,h._)([(0,b.Cb)()],zt.prototype,"galleryOpened",void 0),(0,h._)([(0,b.Cb)()],zt.prototype,"icon",null),(0,h._)([(0,b.Cb)()],zt.prototype,"imageEnhancementToolActive",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],zt.prototype,"imageGalleryEnabled",null),(0,h._)([(0,b.Cb)()],zt.prototype,"isAdditionalCoverageVisible",null),(0,h._)([(0,b.Cb)()],zt.prototype,"isAdditionalPointSourcesVisible",null),(0,h._)([(0,b.Cb)()],zt.prototype,"mapImageConversionToolState",null),(0,h._)([(0,b.Cb)()],zt.prototype,"layer",null),(0,h._)([(0,b.Cb)()],zt.prototype,"navigationToolActive",void 0),(0,h._)([(0,b.Cb)({type:kt})],zt.prototype,"viewModel",void 0),(0,h._)([(0,b.Cb)(),(0,Ft.H)("esri/widgets/OrientedImageryViewer/t9n/OrientedImageryViewer")],zt.prototype,"messages",void 0),(0,h._)([(0,b.Cb)(),(0,Ft.H)("esri/t9n/common")],zt.prototype,"messagesCommon",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],zt.prototype,"popupEnabled",null),(0,h._)([(0,b.Cb)()],zt.prototype,"referencePoint",null),(0,h._)([(0,b.Cb)()],zt.prototype,"view",null),(0,h._)([(0,b.Cb)({type:St,nonNullable:!0})],zt.prototype,"visibleElements",void 0),(0,h._)([(0,b.Cb)()],zt.prototype,"determineWorkflowForFeature",null),(0,h._)([(0,b.Cb)()],zt.prototype,"updateFootprint",null),(0,h._)([(0,b.Cb)()],zt.prototype,"_navigationToolExpanded",void 0),(0,h._)([(0,b.Cb)()],zt.prototype,"_navigationTool",void 0);var Ot=zt=(0,h._)([(0,w.j)("esri.widgets.OrientedImageryViewer")],zt)},28429:function(e,t,n){n.d(t,{C$:function(){return m},FH:function(){return h},Gu:function(){return v},Lr:function(){return p},OH:function(){return y},RS:function(){return w},TU:function(){return _},ao:function(){return f},mH:function(){return g},tA:function(){return b}});n(51508);var r=n(80987),i=n(75021),a=n(16072),o=n(61459),s=n(62554),l=n(36365),u=n(40345),c=n(16915),d=n(43977),p=new a.default({size:15,style:"circle",color:[255,102,102,.5],outline:null}),h=new a.default({size:10,style:"circle",color:[0,128,192,.5],outline:null}),v=new o.default({style:"solid",color:[0,128,192,.5],outline:null}),f=new o.default({style:"solid",color:[255,102,102,.5],outline:null}),m=new a.default({size:10,style:"diamond",color:[255,102,102],outline:null}),y=new s.Z({symbolLayers:new r.Z([new l.Z({size:10,material:{color:"red"},resource:{primitive:"x"},outline:{color:"black",size:1}})])}),g=new s.Z({symbolLayers:new r.Z([new u.Z({width:9,height:9,depth:9,material:{color:[255,102,102]},resource:{primitive:"diamond"},castShadows:!1})])}),b=new i.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:10,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[0,1.4142135623730951],[3.585786437626905,5],[5,3.585786437626905],[1.4142135623730951,0],[5,-3.585786437626905],[3.585786437626905,-5],[0,-1.4142135623730951],[-3.585786437626905,-5],[-5,-3.585786437626905],[-1.4142135623730951,0],[-5,3.585786437626905],[-3.585786437626905,5],[0,1.4142135623730951]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,width:1,color:[0,0,0,100]},{type:"CIMSolidFill",enable:!0,color:[255,0,0,255]}]}}]}]}}}),w=new c.Z({symbolLayers:new r.Z([new d.Z({material:{color:[255,102,102,.5]},edges:null})])}),_=new c.Z({symbolLayers:new r.Z([new d.Z({material:{color:[0,128,192,.25]},edges:null})])})},49885:function(e,t,n){n.d(t,{Ex:function(){return u},K0:function(){return s},SL:function(){return o},e1:function(){return l},wz:function(){return a}});n(59486);var r=n(848),i=n(78952),a=new r.Z({x:0,y:0,z:0,spatialReference:i.Z.WebMercator}),o=1e3,s=114,l=120,u=50},28907:function(e,t,n){n.d(t,{s:function(){return i}});var r=n(93433);function i(e){return function(t){t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);var n=t._delegatedEventNames,i=Array.isArray(e)?e:function(e){return e.split(",").map((function(e){return e.trim()}))}(e);n.push.apply(n,(0,r.Z)(i))}}}}]);
//# sourceMappingURL=56589.e98968f7.chunk.js.map