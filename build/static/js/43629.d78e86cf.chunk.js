"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[43629],{96866:function(e,t,n){n.d(t,{B:function(){return p}});var r=n(1413),i=n(37762),a=n(10064),o=n(9997),s=n(80292),l=n(35995),u=n(71907),d=n(33397),c=n(25265),h=n(49861),f=n(22892),v=n(53283);function p(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.origins)&&void 0!==t?t:[void 0];return function(t,a){var o,u=function(e,t,n){var i;if("resource"===(null===e||void 0===e?void 0:e.type))return function(e,t,n){var i=(0,d.Oe)(t,n);return{type:String,read:function(e,t,n){var r=(0,v.r)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer:function(t,a,o,u){if(null===u||void 0===u||!u.resources)return"string"==typeof t?void(a[o]=(0,v.t)(t,u)):void(a[o]=t.write({},u));var d=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),h=(0,v.t)(d,(0,r.Z)((0,r.Z)({},u),{},{verifyItemRelativeUrls:null!==u&&void 0!==u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0}),v.M.NO),p=i.type!==String&&(!(0,s.l)(this)||(null===u||void 0===u?void 0:u.origin)&&this.originIdOf(n)>(0,c.M9)(u.origin)),m={object:this,propertyName:n,value:t,targetUrl:h,dest:a,targetPropertyName:o,context:u,params:e};null!==u&&void 0!==u&&u.portalItem&&h&&!(0,l.YP)(h)?p&&null!==e&&void 0!==e&&e.contentAddressed?_(m):p?function(e){var t,n=e.context,i=e.targetUrl,a=e.params,o=e.value,s=e.dest,u=e.targetPropertyName;if(!n.portalItem)return;var d=n.portalItem.resourceFromPath(i),c=g(o,i,n),h=(0,f.B)(c),v=(0,l.Ml)(d.path),p=null!==(t=null===a||void 0===a?void 0:a.compress)&&void 0!==t&&t;h===v?(n.resources&&y((0,r.Z)((0,r.Z)({},e),{},{resource:d,content:c,compress:p,updates:n.resources.toUpdate})),s[u]=i):_(e)}(m):function(e){var t=e.context,n=e.targetUrl,r=e.dest,i=e.targetPropertyName;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(n),compress:!1}),r[i]=n)}(m):null!==u&&void 0!==u&&u.portalItem&&(null==h||null!=(0,v.i)(h)||(0,l.jc)(h)||p)?_(m):a[o]=h}}}}(e,t,n);switch(null!==(i=null===e||void 0===e?void 0:e.type)&&void 0!==i?i:"other"){case"other":return{read:!0,write:!0};case"url":return{read:v.b.read,write:v.b.write}}}(e,t,a),p=(0,i.Z)(n);try{for(p.s();!(o=p.n()).done;){var m=o.value,b=(0,h.CJ)(t,m,a);for(var I in u)b[I]=u[I]}}catch(C){p.e(C)}finally{p.f()}}}function _(e){var t,n,i,s,d=e.targetUrl,c=e.params,h=e.value,p=e.context,_=e.dest,m=e.targetPropertyName;if(p.portalItem){var b=(0,v.p)(d),I=g(h,d,p);if(null!==c&&void 0!==c&&c.contentAddressed&&"json"!==I.type)null===(t=p.messages)||void 0===t||t.push(new a.Z("persistable:contentAddressingUnsupported",'Property "'.concat(m,'" is trying to serializing a resource with content of type ').concat(I.type," with content addressing. Content addressing is only supported for json resources."),{content:I}));else{var C=null!==c&&void 0!==c&&c.contentAddressed&&"json"===I.type?(0,o.F)(I.jsonString):null!==(n=null===b||void 0===b?void 0:b.filename)&&void 0!==n?n:(0,u.DO)(),k=(0,l.v_)(null!==(i=null===c||void 0===c?void 0:c.prefix)&&void 0!==i?i:null===b||void 0===b?void 0:b.prefix,C),E="".concat(k,".").concat((0,f.B)(I));if(null!==c&&void 0!==c&&c.contentAddressed&&p.resources&&"json"===I.type){var x,M=null!==(x=p.resources.toKeep.find((function(e){return e.resource.path===E})))&&void 0!==x?x:p.resources.toAdd.find((function(e){return e.resource.path===E}));if(M)return void(_[m]=M.resource.itemRelativeUrl)}var w=p.portalItem.resourceFromPath(E);(0,l.jc)(d)&&p.resources&&p.resources.pendingOperations.push((0,l.gi)(d).then((function(e){w.path="".concat(k,".").concat((0,f.B)({type:"blob",blob:e})),_[m]=w.itemRelativeUrl})).catch((function(){})));var O=null!==(s=null===c||void 0===c?void 0:c.compress)&&void 0!==s&&s;p.resources&&y((0,r.Z)((0,r.Z)({},e),{},{resource:w,content:I,compress:O,updates:p.resources.toAdd})),_[m]=w.itemRelativeUrl}}}function y(e){var t=e.object,n=e.propertyName,r=e.updates,i=e.resource,a=e.content,o=e.compress;r.push({resource:i,content:a,compress:o,finish:function(e){!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(t,n,e)}})}function g(e,t,n){return"string"==typeof e?{type:"url",url:t}:{type:"json",jsonString:JSON.stringify(e.toJSON(n))}}},80292:function(e,t,n){function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{l:function(){return r}})},42307:function(e,t,n){n.d(t,{X:function(){return s}});var r=n(32035),i=n(96334),a=n(22186),o=n(92975);function s(e,t,n,s){if(null==t||null==s)return!1;var l=(0,i.eT)(t,i.Jz),u=(0,i.eT)(s,i.sp);if(l===u&&l!==i.Ej.UNKNOWN||(0,o.fS)(t,s))return n[0]=1,n[1]=1,n[2]=1,!0;if(l===i.Ej.SPHERICAL_ECEF){var d=(0,r.l)(e),c=d/Math.sqrt(e[0]*e[0]+e[1]*e[1]),h=d/a.sv.radius;if(u===i.Ej.WEB_MERCATOR)return n[0]=c*h,n[1]=c*h,n[2]=1,!0;if(u===i.Ej.WGS84||u===i.Ej.CGCS2000){var f=i.Ms;return n[0]=f*c*h,n[1]=f*h,n[2]=1,!0}}else if(l===i.Ej.PLATE_CARREE){if(u===i.Ej.WGS84||u===i.Ej.CGCS2000)return n[0]=i.Ms,n[1]=i.Ms,n[2]=1,!0;if(u===i.Ej.WEB_MERCATOR){var v=e[1]/a.sv.radius;return n[0]=1,n[1]=1/Math.cos(v),n[2]=1,!0}}return!1}},50149:function(e,t,n){n.d(t,{Z:function(){return m}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(27366),u=(n(59486),n(46784)),d=n(84652),c=n(51370),h=n(49861),f=(n(93169),n(32718),n(69912)),v=n(31201),p=n(96866),_=n(79803),y=n(80885),g=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).geometry=null,r.type="clip",r}return(0,a.Z)(n,[{key:"writeGeometry",value:function(e,t,n,r){var i;if(null!==(i=r.layer)&&void 0!==i&&i.spatialReference&&!r.layer.spatialReference.equals(this.geometry.spatialReference)){if(!(0,_.canProjectWithoutEngine)(e.spatialReference,r.layer.spatialReference))return void((null===r||void 0===r?void 0:r.messages)&&r.messages.push(new c.Z("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:r.layer.spatialReference,context:r})));var a=new y.Z;(0,_.projectPolygon)(e,a,r.layer.spatialReference),t[n]=a.toJSON(r)}else t[n]=e.toJSON(r);delete t[n].spatialReference}},{key:"clone",value:function(){return new r({geometry:(0,d.d9)(this.geometry),type:this.type})}}]),n}(u.wq);(0,l._)([(0,h.Cb)({type:y.Z}),(0,p.B)()],g.prototype,"geometry",void 0),(0,l._)([(0,v.c)(["web-scene","portal-item"],"geometry")],g.prototype,"writeGeometry",null),(0,l._)([(0,h.Cb)({type:["clip","mask","replace"],nonNullable:!0}),(0,p.B)()],g.prototype,"type",void 0);var m=g=r=(0,l._)([(0,f.j)("esri.layers.support.SceneModification")],g)},55107:function(e,t,n){var r,i;n.d(t,{B:function(){return i},P:function(){return r}}),function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"}(r||(r={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(i||(i={}))},22892:function(e,t,n){n.d(t,{B:function(){return i}});var r=n(35995);function i(e){return a[function(e){return"json"===e.type?"application/json":"blob"===e.type?e.blob.type:function(e){var t=(0,r.Ml)(e);return l[t]||o}(e.url)}(e)]||s}var a={},o="text/plain",s=a[o],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(var u in l)a[l[u]]=u},43629:function(e,t,n){n.d(t,{N:function(){return Ht}});var r=n(93433),i=n(74165),a=n(15861),o=n(1413),s=n(29439),l=n(37762),u=n(97326),d=n(43144),c=n(15671),h=n(60136),f=n(29388),v=n(27366),p=n(51995),_=n(52639),y=(n(51508),n(63780)),g=n(70116),m=n(80987),b=n(42537),I=n(93169),C=n(32718),k=n(77427),E=n(92026),x=n(27546),M=n(66978),w=n(94172),O=n(99346),S=n(18722),R=n(49861),N=n(69912),A=n(29303),T=n(21389),P=n(29134),F=n(7025),D=n(50894),j=n(32035),Z=n(12400),V=n(19093),U=n(86361),H=n(46634),L=n(42307),G=n(51066),B=n(50628),z=n(96334),q=n(5986),K=n(41414),W=n(65156),Y=n(86372),J=n(38461),Q=n(39406),X=n(23470);var $=n(28970),ee=n(50631),te=n(37270),ne=n(50149),re=n(56011),ie=n(819),ae=n(23037),oe=n(74509),se=n(67140),le=n(7138),ue=n(84652),de=n(16889),ce=n(95439),he=n(48732),fe=n(55946),ve=n(8186),pe=n(59453),_e=n(31730),ye=n(91505),ge=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,c.Z)(this,n),(e=t.apply(this,arguments))._map=new Map,e}return(0,d.Z)(n,[{key:"clear",value:function(){if(this._map.size>0){var e=this.toArray();this._map.clear(),this.emit("change",{added:[],removed:e})}}},{key:"length",get:function(){return this._map.size}},{key:"get",value:function(e){return this._map.get(e)}},{key:"addMany",value:function(e){if(0!==e.length){for(var t=new Set,n=0;n<e.length;n++){var r=e[n],i=r.objectId,a=this._map.get(i);a?(t.add(i),r!==a&&(e[n]=a),a.refCount||(a.refCount=0),++a.refCount):(r.refCount=1,this._map.set(i,r))}var o=t.size>0?e.filter((function(e){return!t.has(e.objectId)})):e;o.length>0&&this.emit("change",{added:o,removed:[]})}}},{key:"removeMany",value:function(e){var t,n=[],r=(0,l.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.objectId,o=this._map.get(a);null!=o&&(!o.refCount||--o.refCount<=0)&&(this._map.delete(a),n.push(i))}}catch(s){r.e(s)}finally{r.f()}n.length>0&&this.emit("change",{added:[],removed:n})}},{key:"removeManyByObjectId",value:function(e){var t,n=[],r=(0,l.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=this._map.get(i);null!=a&&(!a.refCount||--a.refCount<=0)&&(this._map.delete(i),n.push(a))}}catch(o){r.e(o)}finally{r.f()}n.length>0&&this.emit("change",{added:[],removed:n})}},{key:"toArray",value:function(){return(0,r.Z)(this._map.values())}},{key:"find",value:function(e){var t;return(0,k.oE)(this._map,(function(n){return!!e(n)&&(t=n,!0)})),t}},{key:"forEach",value:function(e){this._map.forEach((function(t){return e(t)}))}}]),n}(ye.Z),me=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,c.Z)(this,n),(r=t.call(this))._limit=e,r._all=new ge,r._active=new Ce((0,u.Z)(r)),r._pending=new Map,r._handle=r._all.on("change",(function(e){return r._handleChanges(e)})),r}return(0,d.Z)(n,[{key:"destroy",value:function(){this._handle.remove()}},{key:"length",get:function(){return this._active.length}},{key:"toArray",value:function(){return this._active.toArray()}},{key:"find",value:function(e){return this._active.find(e)}},{key:"forEach",value:function(e){this._active.forEach(e)}},{key:"addMany",value:function(e){this._all.addMany(e)}},{key:"removeManyByObjectId",value:function(e){this._all.removeManyByObjectId(e)}},{key:"_handleChanges",value:function(e){var t=this,n=e.removed;if(this._pending.size>0){n=new Array;var r,i=(0,l.Z)(e.removed);try{for(i.s();!(r=i.n()).done;){var a=r.value;this._pending.delete(a.objectId)||n.push(a)}}catch(f){i.e(f)}finally{i.f()}}var o=this._limit-this._active.length+n.length;o<e.added.length&&(this._active.removeMany(n),n=[],Ie.reset(1-this._limit/(this._active.length+e.added.length)),this._active.forEach((function(e){Ie.sample()&&(n.push(e),t._pending.set(e.objectId,e))})),o=this._limit-this._active.length+n.length);var s=e.added;if(o<e.added.length){s=new Array,Ie.reset(o/e.added.length);var u,d=(0,l.Z)(e.added);try{for(d.s();!(u=d.n()).done;){var c=u.value;Ie.sample()?s.push(c):this._pending.set(c.objectId,c)}}catch(f){d.e(f)}finally{d.f()}}var h=o-s.length;h>0&&this._pending.size>0&&(Ie.reset(h/this._pending.size),this._pending.forEach((function(e){Ie.sample()&&(s.push(e),t._pending.delete(e.objectId))}))),this._active.addAndRemove(s,n)}}]),n}(ye.Z),be=function(){function e(){(0,c.Z)(this,e),this._percentage=1,this._last=-1,this._index=0}return(0,d.Z)(e,[{key:"reset",value:function(e){this._percentage=e,this._last=-1}},{key:"sample",value:function(){var e=Math.floor(this._index*this._percentage);return++this._index,e!==this._last&&(this._last=e,!0)}}]),e}(),Ie=new be,Ce=function(){function e(t){(0,c.Z)(this,e),this._parent=t,this._map=new Map}return(0,d.Z)(e,[{key:"length",get:function(){return this._map.size}},{key:"forEach",value:function(e){this._map.forEach((function(t){return e(t)}))}},{key:"find",value:function(e){var t;return(0,k.oE)(this._map,(function(n){return!!e(n)&&(t=n,!0)})),t}},{key:"toArray",value:function(){return(0,r.Z)(this._map.values())}},{key:"addAndRemove",value:function(e,t){var n,r=(0,l.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this._map.set(i.objectId,i)}}catch(u){r.e(u)}finally{r.f()}var a,o=(0,l.Z)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;this._map.delete(s.objectId)}}catch(u){o.e(u)}finally{o.f()}(e.length>0||t.length>0)&&this._parent.emit("change",{added:e,removed:t})}},{key:"removeMany",value:function(e){var t,n=(0,l.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._map.delete(r.objectId)}}catch(i){n.e(i)}finally{n.f()}e.length>0&&this._parent.emit("change",{added:[],removed:e})}}]),e}(),ke=n(78485),Ee=n(62554),xe=(0,d.Z)((function e(t,n){(0,c.Z)(this,e),this.meta=t,this.index=n})),Me=(0,d.Z)((function e(t,n){(0,c.Z)(this,e),this.graphic=t,this.geometry=n,this.components=[],this.overridesDirty=!1})),we=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,c.Z)(this,n),(r=t.call(this,e)).loadedGraphics=new me(5e4),r.slicePlaneEnabled=!1,r._renderingInfo={symbol:new Ee.Z},r._featuresMap=new Map,r}return(0,d.Z)(n,[{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this._graphicsCore)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"initialize",value:function(){var e=this,t=this.view.basemapTerrain;this._graphicsCore=new ve.w({owner:this,layer:this.layer,preferredUpdatePolicy:ke.j.ASYNC,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:function(t){return e.view.deconflictor.addGraphicsOwner(t)},labeler:function(t,n){return e.view.labeler.addGraphicsOwner(t,n,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}})},scaleVisibility:function(n,r){return new pe.c({graphicsCoreOwner:e,layer:e.layer,queryGraphicUIDsInExtent:r,graphicsCore:n,basemapTerrain:t,layerScaleEnabled:!1})}}}),this._graphicsCore.initializePromise.then((function(){return e._graphicsCore.startCreateGraphics()})).catch((function(){})),this.addHandles((0,w.watch)((function(){return e.layer.labelingInfo}),(function(t,n){(0,he.Hg)(t,n)&&e._graphicsCore.updateLabelingInfo()})))}},{key:"destroy",value:function(){this._graphicsCore=(0,E.SC)(this._graphicsCore),this.loadedGraphics=(0,E.SC)(this.loadedGraphics),this.view=null}},{key:"addNodeMeta",value:function(e,t){for(var n=0,r=e.filteredIds,i=this.view.spatialReference,a=[],o=0;o<e.featureIds.length;o++){var s=e.featureIds[o],l=null==r;if(r&&n<r.length&&s===r[n]&&(l=!0,n++),this._enabledForFeatureInNode(e,o)){var u=this._featuresMap.get(s);if(u)u.components.push(new xe(e,o)),this._updateLabelPosition(s);else{var d=t(o,e),c=(0,fe.T)(0,0,0,i),h={objectId:s,uid:(0,ce.D)(),attributes:d,visible:l,geometry:c},f=new Me(h,c);f.components.push(new xe(e,o)),this._featuresMap.set(s,f),this._updateLabelGeometry(s),a.push(h)}}}this.loadedGraphics.addMany(a)}},{key:"updateLabelPositions",value:function(e){var t=this,n=this.view.renderCoordsHelper;this._forEachGraphic(e,(function(r,i,a){var o,s=t._graphicsCore.getGraphics3DGraphicById(i.uid);null!=s&&t._updateLabelGeometry(e.featureIds[r])&&s.alignWithAbsoluteElevation(null!==(o=a.z)&&void 0!==o?o:0,n,!1)}))}},{key:"setNodeMetaAttributes",value:function(e,t){var n=new Array;this._forEachGraphic(e,(function(r,i){var a=t(r,e);(0,ue.y7)(i.attributes,a)||(i.attributes=a,n.push(i.uid))})),this._graphicsCore.updateLabelingInfo(n)}},{key:"applyFilterChange",value:function(e){var t=this;this._forEachFeature(e,(function(n,r,i){if(t._enabledForFeatureInNode(e,n)){var a=r.graphic,o=a.visible;o!==i&&(a.visible=i,Se.graphic=a,Se.property="visible",Se.oldValue=o,Se.newValue=i,t._graphicsCore.graphicUpdateHandler(Se))}else{var s=e.featureIds[n];switch(t._removeFeature(r,e,n)){case Oe.REMOVED:t.loadedGraphics.removeManyByObjectId([s]);break;case Oe.MODIFIED:t._updateLabelPosition(s)}}}))}},{key:"removeNodeMeta",value:function(e){var t=this,n=[];this._forEachGraphic(e,(function(r){var i=e.featureIds[r],a=t._featuresMap.get(i);if(a)switch(t._removeFeature(a,e,r)){case Oe.MODIFIED:t._updateLabelPosition(i);break;case Oe.REMOVED:n.push(i)}})),this.loadedGraphics.removeManyByObjectId(n)}},{key:"_removeFeature",value:function(e,t,n){var r=e.components.length;return(0,y.hv)(e.components,(function(e){return!(e.meta===t&&e.index===n)})),0===e.components.length?(this._featuresMap.delete(t.featureIds[n]),Oe.REMOVED):r!==e.components.length?Oe.MODIFIED:Oe.UNMODIFIED}},{key:"getRenderingInfo",value:function(){return this._renderingInfo}},{key:"notifyGraphicGeometryChanged",value:function(){}},{key:"notifyGraphicVisibilityChanged",value:function(){}},{key:"_updateLabelPosition",value:function(e){var t=this._featuresMap.get(e);t&&this._updateLabelGeometry(e)&&(this.loadedGraphics.removeManyByObjectId([e]),this.loadedGraphics.addMany([t.graphic]))}},{key:"_updateLabelGeometry",value:function(e){var t,n=this._featuresMap.get(e);if(!n)return!1;var r,i=n.geometry,a=this.view.spatialReference,o=this.view.renderCoordsHelper,s=i.x,u=i.y,d=null!==(t=i.z)&&void 0!==t?t:0,c=n.components.length,h=(0,Y.bg)(c*_e.Wx),f=0,v=(0,l.Z)(n.components);try{for(v.s();!(r=v.n()).done;){var p=r.value,_=p.meta,y=p.index;(0,_e.z6)(y,this.collection,_.objectHandle,h,f),f+=_e.Wx}}catch(g){v.e(g)}finally{v.f()}return(0,B.projectBuffer)(h,o.spatialReference,0,h,a,0,h.length/3),(0,K.t8)(Re,K.G_),(0,K.G1)(Re,h),i.x=(Re[0]+Re[3])/2,i.y=(Re[1]+Re[4])/2,i.z=Re[5],!(0,de.Po)(i.x,s)||!(0,de.Po)(i.y,u)||!(0,de.Po)(i.z,d)}},{key:"_forEachGraphic",value:function(e,t){var n=this;this._forEachFeature(e,(function(r,i,a){var o=i.graphic,s=i.geometry;n._enabledForFeatureInNode(e,r)&&t(r,o,s,a)}))}},{key:"_forEachFeature",value:function(e,t){for(var n=0,r=0;r<e.featureIds.length;r++){var i=this._featuresMap.get(e.featureIds[r]),a=null==e.filteredIds;e.filteredIds&&e.filteredIds[n]===e.featureIds[r]&&(a=!0,n++),i&&t(r,i,a)}}},{key:"_enabledForFeatureInNode",value:function(e,t){var n;return e.node.index<0||!(null!==(n=this.overrides)&&void 0!==n&&n.featureHasGeometryChanges(e.featureIds[t]))}},{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){}}]),n}(le.default);(0,v._)([(0,R.Cb)()],we.prototype,"view",void 0),(0,v._)([(0,R.Cb)()],we.prototype,"layer",void 0),(0,v._)([(0,R.Cb)()],we.prototype,"collection",void 0),(0,v._)([(0,R.Cb)()],we.prototype,"loadedGraphics",void 0),(0,v._)([(0,R.Cb)()],we.prototype,"overrides",void 0),(0,v._)([(0,R.Cb)()],we.prototype,"updating",null),(0,v._)([(0,R.Cb)()],we.prototype,"slicePlaneEnabled",void 0),(0,v._)([(0,R.Cb)()],we.prototype,"_graphicsCore",void 0),we=(0,v._)([(0,N.j)("esri.views.3d.layers.I3SMeshViewLabeler")],we);var Oe,Se={graphic:null,property:null,oldValue:null,newValue:null};!function(e){e[e.UNMODIFIED=0]="UNMODIFIED",e[e.MODIFIED=1]="MODIFIED",e[e.REMOVED=2]="REMOVED"}(Oe||(Oe={}));var Re=(0,K.Ue)(),Ne=we,Ae=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,a,o,s,l){var u;return(0,c.Z)(this,n),(u=t.call(this,e,0,0,0,r)).gpuMB=i,u.geometryMB=a,u.textureMB=o,u.unloadedMB=s,u.idbHitRate=l,u}return(0,d.Z)(n)}(n(20488).W),Te=n(46798),Pe=n(79803),Fe=n(55107),De=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,c.Z)(this,n),t.call(this,"SceneLayerWorker","process",{process:function(e){return[e.geometryBuffer]},project:function(e){return[e.positions.buffer]},transformNormals:function(e){return[e.normals.buffer]}},e,{hasInitialize:!0})}return(0,d.Z)(n,[{key:"setModifications",value:function(e,t,n,r){var i={context:e,modifications:Ve(t,n,r),isGeodetic:r.isGeographic};this.broadcast(i,"setModifications")}},{key:"setLegacySchema",value:function(e,t){var n=JSON.stringify(t);return this.broadcast({context:e,jsonSchema:n},"setLegacySchema")}},{key:"destroyContext",value:function(e){return this.broadcast(e,"destroyContext")}},{key:"project",value:function(e,t){return this.invokeMethod("project",e,t)}},{key:"transformNormals",value:function(e,t){return this.invokeMethod("transformNormals",e,t)}}]),n}(Te.q),je=new x.Z({deallocator:null}),Ze=(0,Z.Ue)();function Ve(e,t,n){je.clear();var r,i=1/0,a=1/0,o=-1/0,s=-1/0,u=!1,d=(0,l.Z)(t);try{var c=function(){var e=r.value,t="clip"===e.type?Fe.B.Inside:"mask"===e.type?Fe.B.Outside:Fe.B.Replace,d=e.geometry,c=function(e){return e};if(d.spatialReference){if(!(0,Pe.canProjectWithoutEngine)(d.spatialReference,n))return C.Z.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification"),"continue";c=function(e){return(0,q.S)(e,d.spatialReference,Ze,n),Ze}}else d.hasZ||(Ze[2]=0,c=function(e){return Ze[0]=e[0],Ze[1]=e[1],Ze});u=u||t===Fe.B.Outside,je.push(t),je.push(d.rings.length);var h,f=(0,l.Z)(d.rings);try{for(f.s();!(h=f.n()).done;){var v=h.value;je.push(v.length);var p,_=(0,l.Z)(v);try{for(_.s();!(p=_.n()).done;){var y=c(p.value);je.push(y[0]),je.push(y[1]),je.push(y[2]),i=Math.min(i,y[0]),a=Math.min(a,y[1]),o=Math.max(o,y[0]),s=Math.max(s,y[1])}}catch(g){_.e(g)}finally{_.f()}}}catch(g){f.e(g)}finally{f.f()}};for(d.s();!(r=d.n()).done;)c()}catch(p){d.e(p)}finally{d.f()}if(null!=e)if(u){var h=1e-4;je.push(Fe.B.Inside),je.push(2),je.push(4),je.push(i-h),je.push(a-h),je.push(0),je.push(o+h),je.push(a-h),je.push(0),je.push(o+h),je.push(s+h),je.push(0),je.push(i-h),je.push(s+h),je.push(0),je.push(4),je.push(e[0]),je.push(e[1]),je.push(0),je.push(e[2]),je.push(e[1]),je.push(0),je.push(e[2]),je.push(e[3]),je.push(0),je.push(e[0]),je.push(e[3]),je.push(0)}else je.push(Fe.B.Outside),je.push(1),je.push(4),je.push(e[0]),je.push(e[1]),je.push(0),je.push(e[2]),je.push(e[1]),je.push(0),je.push(e[2]),je.push(e[3]),je.push(0),je.push(e[0]),je.push(e[3]),je.push(0);je.push(Fe.B.Finished);for(var f=new Float64Array(je.length),v=0;v<je.length;++v)f[v]=je.at(v);return f}var Ue=n(42757),He=n(71323),Le=n(96387),Ge=n(31901),Be=n(99048),ze=(0,d.Z)((function e(){(0,c.Z)(this,e),this.ids=new Set})),qe=function(){function e(t){var n=t.collection,r=t.forAllFeatures,i=t.forAllFeaturesOfNode;(0,c.Z)(this,e),this._highlights=[],this._collection=n,this._forAllFeatures=r,this._forAllFeaturesOfNode=i}return(0,d.Z)(e,[{key:"destroy",value:function(){var e=this;this._highlights.forEach((function(t){return e._releaseSet(t)})),this._highlights=null}},{key:"acquireSet",value:function(){var e=this,t=new ze;this._highlights.push(t);var n=(0,b.kB)((function(){e._highlights&&(e._releaseSet(t),(0,y.e$)(e._highlights,t))}));return{set:t,handle:n}}},{key:"setFeatureIds",value:function(e,t){t.forEach((function(t){return e.ids.add(t)})),this._initializeSet(e)}},{key:"_initializeSet",value:function(e){var t=this;this._forAllFeatures((function(n,r,i){return e.ids.has(n)&&t._collection.addComponentHighlight(i.objectHandle,r),Ue.Ku.CONTINUE}))}},{key:"_releaseSet",value:function(e){var t=this;this._forAllFeatures((function(n,r,i){return e.ids.has(n)&&t._collection.removeComponentHighlight(i.objectHandle,r),Ue.Ku.CONTINUE}))}},{key:"objectCreated",value:function(e){var t=this;this._highlights.forEach((function(n){t._forAllFeaturesOfNode(e,(function(r,i){return n.ids.has(r)&&t._collection.addComponentHighlight(e.objectHandle,i),Ue.Ku.CONTINUE}))}))}},{key:"objectDeleted",value:function(e){this._collection.clearHighlights(e.objectHandle)}}]),e}(),Ke=(n(84936),n(52404)),We=n(93463),Ye=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,a){var o;(0,c.Z)(this,n),(o=t.call(this,{}))._updateExtent=r,o._updateNode=i,o._getElevationMode=a,o.running=!1,o._extentSet=new Ke.D,o._nodeSet=new Set;var s=o._taskPriority,l=e.registerTask(o._taskPriority,(0,u.Z)(o));return o.addHandles(l),o._task=l,o._lastTaskPriority=s,o}return(0,d.Z)(n,[{key:"_taskPriority",get:function(){var e=this._getElevationMode();return e&&e===Ue.vV.RelativeToGround?We.T8.ELEVATION_ALIGNMENT_SCENE:We.T8.ELEVATION_ALIGNMENT}},{key:"_updateTaskPriority",value:function(){var e=this._taskPriority;e!==this._lastTaskPriority&&(this._task.priority=e,this._lastTaskPriority=e)}},{key:"normalizeCtorArgs",value:function(){return{}}},{key:"addExtent",value:function(e){this._extentSet.add(e),this._updateTaskPriority(),this.running=!0}},{key:"schedule",value:function(e){this._nodeSet.add(e),this._updateTaskPriority(),this.running=!0}},{key:"remove",value:function(e){this._nodeSet.delete(e),this._updateRunning()}},{key:"runTask",value:function(e){var t=this,n=this._extentSet;for(e.run((function(){return n.merge(e)}));!n.empty&&!e.done;){var r=this._updateExtent(n.pop());null!=r&&r.forAll((function(e){return t.schedule(e)})),e.madeProgress()}if(!e.done){var i,a=this._nodeSet,o=(0,l.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(a.delete(s),this._updateNode(s),e.madeProgress(),e.done)break}}catch(u){o.e(u)}finally{o.f()}this._updateRunning()}}},{key:"_updateRunning",value:function(){this.running=this._nodeSet.size>0||this._extentSet.size>0}}]),n}(le.default);(0,v._)([(0,R.Cb)()],Ye.prototype,"running",void 0),Ye=(0,v._)([(0,N.j)("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater")],Ye);var Je=n(21765),Qe=(0,d.Z)((function e(){(0,c.Z)(this,e),this.lodCrossfadeSignedDuration=0})),Xe=function(){function e(t){(0,c.Z)(this,e),this._view=t,this._preRenderFrameTaskHandle=null,this._currentFrameStartTime=null,this._numFadingNodes=0}return(0,d.Z)(e,[{key:"destroy",value:function(){var e;null!==(e=this._preRenderFrameTaskHandle)&&void 0!==e&&e.remove(),this._preRenderFrameTaskHandle=null,this._view=null}},{key:"updating",get:function(){return this._numFadingNodes>0}},{key:"stopNodeFading",value:function(e){null!=e.lodCrossfadeProgress&&(this._numFadingNodes--,e.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=(0,E.hw)(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))}},{key:"_startNodeFading",value:function(e,t,n){var r=this;0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=(0,O.A)({preRender:function(e){return r._updateAllNodeFading(e)}}),this._view.notifyLODUpdate()),null==e.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate()),e.lodCrossfadeSignedDuration=n,e.lodCrossfadeProgress=t}},{key:"_updateAllNodeFading",value:function(e){var t=this,n=this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((function(r,i){if(null!=(null===r||void 0===r?void 0:r.lodCrossfadeProgress)){var a=r.lodCrossfadeSignedDuration,o=a>0?t._view.fullOpacity:0,s=e.deltaTime/a,l=r.lodCrossfadeProgress+Math.abs(s),u=!n||l>=1||0===a,d=o-(u?0:a>0?1:-1)*(1-l);u?(t.stopNodeFading(r),a<0&&t._view.markNodeToRemove(i)):r.lodCrossfadeProgress=l,t._view.setNodeOpacityByIndex(i,d)}})),this._view.removeMarkedNodes()}},{key:"stopAllNodeFading",value:function(){var e=this;this._view.foreachCrossfadeNode((function(t,n){if(null!=(null===t||void 0===t?void 0:t.lodCrossfadeProgress)){e.stopNodeFading(t);var r=t.lodCrossfadeSignedDuration;r<0&&e._view.markNodeToRemove(n);var i=r>0?e._view.fullOpacity:0;e._view.setNodeOpacityByIndex(n,i)}})),this._view.removeMarkedNodes()}},{key:"fadeNode",value:function(e,t,n,r){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var i=this._view,a=i.nodeCrossfadingEnabled,o=n===Je.B.FadeIn?i.fullOpacity:0,s=a?r?n===Je.B.FadeIn?i.lodCrossfadeinDuration:i.lodCrossfadeoutDuration:i.lodCrossfadeUncoveredDuration:0,l=this._view.getNodeOpacityByIndex(e);if(a&&l!==o&&s>0){var u=1-Math.abs(o-l);this._startNodeFading(t,u,function(e){return e===Je.B.FadeIn?1:-1}(n)*s)}else this.stopNodeFading(t),this._view.setNodeOpacityByIndex(e,o),n===Je.B.FadeOut&&this._view.removeNode(e)}},{key:"isNodeFullyFadedIn",value:function(e){var t=this._view.getNodeCrossfadeMetaData(e);return null==t||null==t.lodCrossfadeProgress&&this._view.getNodeOpacityByIndex(e)===this._view.fullOpacity}}]),e}();var $e=n(50951),et=n(44011),tt=n(85312),nt=n(88153),rt=n(54463),it=n(42235),at=n(76783),ot=function(){function e(t){(0,c.Z)(this,e),this.type=rt.q7.I3S,this._needVerticalOffset=!1,this.layerUid=t.layerUid,this.sublayerUid=t.sublayerUid,this._collection=t.collection,this._traverseNodeHierarchy=t.traverseNodeHierarchy,this.slicePlaneEnabled=t.slicePlaneEnabled,this.isGround=t.isGround}return(0,d.Z)(e,[{key:"updateElevationAlignState",value:function(e,t){this._needVerticalOffset=e&&t===$e.JY.Global}},{key:"intersect",value:function(e,t,n,r,i,a){var o,s=this,l=null!==a&&void 0!==a&&a,u=e.results,d=e.options.store===rt.eC.ALL,c=e.ray.direction,h=e.tolerance,f=function(e){return e},v=function(e){return e},p=(0,at.iO)(null!==(o=e.verticalOffset)&&void 0!==o?o:this._needVerticalOffset?0:null);null!=e.verticalOffset&&null!=p&&(f=function(e){return p.applyToMbs(e)},v=function(e){return p.applyToObb(e)});var _=new it.sT(l,e.options.normalRequired);this._traverseNodeHierarchy((function(i,a){var o;if(0===i.childrenLoaded)return!1;var l=null!==(o=i.serviceObbInRenderSR)&&void 0!==o&&o.isValid?i.serviceObbInRenderSR:null;return!(l&&!v(l).intersectRay(n,c,h))&&(!a||!l&&(0,et.c$)(i.serviceMbsInRenderSR)&&!function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e[3]+r,a=t[0]-e[0],o=t[1]-e[1],s=t[2]-e[2],l=n[0],u=n[1],d=n[2],c=l*a+u*o+d*s;return c*c-(l*l+u*u+d*d)*(a*a+o*o+s*s-i*i)>=0}(f(i.serviceMbsInRenderSR),n,c,h)||null!=i.geometryObbInRenderSR&&!v(i.geometryObbInRenderSR).intersectRay(n,c,h)||s._collection.intersect(a,n,r,h,p,_,(function(a,o,l,c){if(!(o<0||null!=t&&!t(n,r,o))){var h=function(e){var t=new tt.f9(s.layerUid,s.sublayerUid,i.index,a,c);e.set(s.type,t,o,l)};if(s.isGround&&(null==u.ground.dist||o<u.ground.dist)&&h(u.ground),!e.options.isFiltered&&((null==u.min.dist||o<u.min.dist)&&h(u.min),(null==u.max.dist||o>u.max.dist)&&h(u.max),d)){var f=(0,nt.LP)(e.ray);h(f),e.results.all.push(f)}}})),!0)}))}}]),e}();var st=n(4046),lt=n(95964),ut=n(75162),dt=n(47570),ct=n(10064),ht=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14;(0,c.Z)(this,e),this._version=r,this._db=null,this._quotaReductionPromise=null,this._gcCounter=0,this._hit=0,this._miss=0,this._destroyed=!1,this.gcFrequency=50,this.maxByteSize=g.Y.GIGABYTES,this.quotaReductionFactor=.2,this._dbName=t,this._storeName=n}return(0,d.Z)(e,[{key:"init",value:function(){var e=this;return Promise.resolve().then((function(){var t=indexedDB.open(e._dbName,e._version);return t.onupgradeneeded=function(n){var r=t.result,i=t.transaction,a=r.objectStoreNames.contains(e._storeName)?i.objectStore(e._storeName):r.createObjectStore(e._storeName),o=r.objectStoreNames.contains("last_access")?i.objectStore("last_access"):r.createObjectStore("last_access");o.indexNames.contains("date")||o.createIndex("date","date",{unique:!1}),o.indexNames.contains("byteSize")||o.createIndex("byteSize","byteSize",{unique:!1}),n.oldVersion<e._version&&(a.clear(),o.clear())},vt(t)})).then((function(t){e._destroyed?t.close():e._db=t}))}},{key:"destroy",value:function(){this._db&&(this._db.close(),this._db=null),this._destroyed=!0}},{key:"initialized",get:function(){return null!=this._db}},{key:"getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"put",value:function(e,t){var n=this;return null==this._db?Promise.reject(new ct.Z("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then((function(){return n._put(e,t)})).catch((function(r){if(r&&"QuotaExceededError"===r.name)return null==n._quotaReductionPromise&&(n._quotaReductionPromise=n._getCacheSize().then((function(e){return n._removeLeastRecentlyAccessed(t.byteSize+Math.ceil(e*n.quotaReductionFactor))})),n._quotaReductionPromise.then((function(){return n._quotaReductionPromise=null}),(function(){return n._quotaReductionPromise=null}))),n._quotaReductionPromise.then((function(){return n._put(e,t)}));throw r})).then((function(){n._gcCounter--,n._gcCounter<0&&null!=n._db&&(n._gcCounter=n.gcFrequency,n._getCacheSize().then((function(e){return n._removeLeastRecentlyAccessed(e-n.maxByteSize)})))}))}},{key:"get",value:function(e,t){var n=this,r=this._db;if(null==r)return Promise.resolve(void 0);var i=null;return Promise.resolve().then((function(){var a=r.transaction(n._storeName,"readonly");return i=(0,M.fu)(t,(function(){a.abort()})),vt(a.objectStore(n._storeName).get(e))})).then((function(t){return null==t?++n._miss:n._db&&(++n._hit,n._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:t.byteSize},e)),null!=i&&i.remove(),t})).catch((function(){++n._miss,(0,M.k_)(t),null!=i&&i.remove()}))}},{key:"remove",value:function(e){var t=this,n=this._db;return null==n?Promise.resolve():Promise.resolve().then((0,a.Z)((0,i.Z)().mark((function r(){var a,o,s,l,u;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=n.transaction([t._storeName,"last_access"],"readwrite"),o=a.objectStore(t._storeName),s=a.objectStore("last_access"),l=o.delete(e),u=s.delete(e),r.next=3,Promise.all([vt(l),vt(u),ft(a)]);case 3:case"end":return r.stop()}}),r)}))))}},{key:"_put",value:function(e,t){var n=this._db;if(null==n)return Promise.resolve();var r=n.transaction([this._storeName,"last_access"],"readwrite"),i=r.objectStore(this._storeName),a=r.objectStore("last_access"),o=i.put(t,e),s=a.put({date:Date.now(),byteSize:t.byteSize},e);return Promise.all([vt(o),vt(s),ft(r)])}},{key:"_removeLeastRecentlyAccessed",value:function(e){if(e<=0||!this._db)return Promise.resolve();var t=this._db.transaction([this._storeName,"last_access"],"readwrite"),n=t.objectStore(this._storeName),r=t.objectStore("last_access"),i=0,a=r.index("date").openCursor(null,"next");return a.onsuccess=function(){var t=a.result;null!=t&&(null!=t.value.byteSize&&(i+=t.value.byteSize),n.delete(t.primaryKey),r.delete(t.primaryKey),i<e&&t.continue())},ft(t)}},{key:"_getCacheSize",value:function(){var e=this._db;if(null==e)return Promise.resolve(0);var t=e.transaction("last_access"),n=t.objectStore("last_access"),r=0,i=n.index("byteSize").openKeyCursor();return i.onsuccess=function(){var e=i.result;if(e){var t=e.key;null!=t&&(r+=t),e.continue()}},ft(t).then((function(){return r}))}}]),e}();function ft(e){return new Promise((function(t,n){e.oncomplete=function(){return t()},e.onerror=function(){return n(e.error)},e.onabort=function(){return n(e.error)}}))}function vt(e){return new Promise((function(t,n){"done"===e.readyState?null!=e.error?n(e.error):t(e.result):(e.onsuccess=function(){return t(e.result)},e.onerror=function(){return n(e.error)})}))}var pt,_t=new WeakMap,yt=function(){function e(t,n){switch((0,c.Z)(this,e),this._miss=0,this._hit=0,this.initialized=!0,n){case"layer":this._data=new Map;break;case"view":var r=_t.get(t);if(r){this._data=r;break}var i=new Map;this._data=i,_t.set(t,i)}}return(0,d.Z)(e,[{key:"init",value:function(){return Promise.resolve()}},{key:"get",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._data.has(t)){e.next=2;break}return e.abrupt("return",(this._hit++,null!==(r=this._data.get(t))&&void 0!==r?r:void 0));case 2:this._miss++;case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){}},{key:"put",value:function(e,t){return this._data.set(e,t),Promise.resolve()}},{key:"remove",value:function(e){return this._data.delete(e),Promise.resolve()}},{key:"getHitRate",value:function(){return this._hit/(this._hit+this._miss)}}]),e}(),gt=n(55763),mt=n(99879),bt=n(23523),It=n(49420),Ct=n(94463),kt=n(2985),Et=n(65206),xt=n(89414),Mt=n(58890),wt=n(50256),Ot=n(35160),St=n(92911),Rt=n(51594),Nt=n(60113),At=n(74713),Tt=n(77958),Pt=n(61459),Ft="esri.views.3d.layers.I3SMeshView3D",Dt=function(){return C.Z.getLogger(Ft)},jt=[1,1,1,1],Zt=function(e){(0,h.Z)(n,e);var t=(0,f.Z)(n);function n(e,r,i,a,o,s,l,u,d){var h;return(0,c.Z)(this,n),(h=t.call(this)).node=e,h.featureIds=r,h.objectHandle=i,h.cachedRendererVersion=a,h.attributeInfo=o,h.material=s,h.textures=l,h.anchorIds=u,h.anchors=d,h.cachedElevationAnchors=null,h.cachedEdgeMaterials=new Array,h.edgeMemoryUsage=0,h}return(0,d.Z)(n)}(Qe);!function(e){e[e.CastShadows=4]="CastShadows",e[e.Pickable=5]="Pickable"}(pt||(pt={}));var Vt,Ut=100*g.Y.MEGABYTES,Ht=function(e){var t=function(e){(0,h.Z)(v,e);var t=(0,f.Z)(v);function v(){var e;return(0,c.Z)(this,v),(e=t.apply(this,arguments))._needsNormals=!0,e._updatingHandles=new H.R,e._nodeId2Meta=new Map,e._nodeId2MetaReloading=new Map,e._i3sWasmLoaded=!1,e._snappingSourcesTrackers=[],e._hasLoadedPBRTextures=!1,e._asyncModuleLoading=0,e._addTasks=new Map,e._currentRenderer=null,e._rendererVersion=0,e._colorVariable=null,e._opacityVariable=null,e._rendererFields=null,e._symbologyFields=null,e._symbologyOverride=null,e._symbologyOverrideFields=null,e._symbolInfos=new Map,e._visibleGeometryChangedSchedulerHandle=null,e._hasComponentData=!1,e._hasVertexColors=!1,e._nodeColorOverride=null,e.updating=!0,e.holeFilling="auto",e._hasColors=!1,e._hasTextures=!1,e._hasData=!1,e.slicePlaneEnabled=!1,e._modifications=new Array,e.ignoresMemoryFactor=!1,e._layerUrl="",e._cacheKeySuffix=null,e._planetRadiusInGlobalMode=0,e._elevationTask=null,e._filters=[],e._arcade=null,e._tmpAttributeOnlyGraphic=new _.Z,e._crossfadeHelper=new Xe((0,u.Z)(e)),e}return(0,d.Z)(v,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"layerId",get:function(){return this.i3slayer&&this.i3slayer.id}},{key:"sublayerId",get:function(){return null}},{key:"contentVisible",get:function(){var e;return!this.suspended&&(null===(e=this._controller)||void 0===e?void 0:e.rootNodeVisible)}},{key:"legendEnabled",get:function(){var e;return this.contentVisible&&!0===(null===(e=this.i3slayer)||void 0===e?void 0:e.legendEnabled)}},{key:"updatingProgressValue",get:function(){var e,t;return null!==(e=null===(t=this._controller)||void 0===t?void 0:t.updatingProgress)&&void 0!==e?e:0}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return(0,et.a7)(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?Be.v.AllTexturesPBR:Be.v.AllTextures:this._usePBR||this._hasLoadedPBRTextures?Be.v.GeometryTexturesPBR:Be.v.GeometryTextures}},{key:"elevationOffset",get:function(){var e=null!=this.i3slayer?this.i3slayer.elevationInfo:null;return null!=e&&"absolute-height"===e.mode?(0,oe.ap)(e,this.i3slayer.spatialReference):0}},{key:"elevationInfo",get:function(){var e=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==e)return new tn(Ue.vV.Absolute,0);var t=(0,oe.ap)(e,this.i3slayer.spatialReference);switch(e.mode){case"absolute-height":return new tn(Ue.vV.Absolute,t);case"relative-to-ground":return new tn(Ue.vV.RelativeToGround,t);case"on-the-ground":return new tn(Ue.vV.OnTheGround,0);default:return new tn(Ue.vV.Absolute,0)}}},{key:"supportedTextureEncodings",get:function(){return(0,st.K0)(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",get:function(){var e,t=null===(e=this.view)||void 0===e?void 0:e.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled,n=!(this.supportedTextureEncodings&Be.j.DDS_S3TC);return t&&n}},{key:"clientGeometry",get:function(){return this.i3sOverrides.geometryOverrides}},{key:"elevationRange",get:function(){var e,t=this._nodeId2Meta,n=new kt.r,r=(0,l.Z)(t.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;if(null!=i){var a=i.node.serviceMbsInIndexSR,o=(0,s.Z)(a,4),u=(o[0],o[1],o[2]),d=o[3];n.expandElevationRangeValues(u-d,u+d)}}}catch(c){r.e(c)}finally{r.f()}return n.elevationRangeValid?n:null}},{key:"fullExtent",get:function(){return this.i3slayer.fullExtent}},{key:"initialize",value:function(){var e,t,r=this,i=(0,I.Z)("enable-feature:idb-mock-cache");this._idbCache=i?new yt(this.view,i):new ht("esri-scenelayer-cache","geometries"),this._preLoadBasis(),this.addResolvingPromise(this.i3slayer.indexInfo);var a=this.view.resourceController,o=a.memoryController;this.i3sOverrides=new ut.v({view:this.view,layer:this.i3slayer,memoryController:o}),this._worker=new De((0,bt.H)(a)),this.addResolvingPromise(this._worker.promise);var s=this.i3slayer.store;this._worker.setLegacySchema(this.uid,s.defaultGeometrySchema),(0,et.p8)(this.i3slayer),(0,et.gn)(this.i3slayer,this.view),this._layerUrl=this.i3slayer.parsedUrl.path,this._controller=new ee.Z({layerView:this,worker:this._worker}),this._gpuMemoryEstimate=0,this._texMemoryEstimate=0,this._geoMemoryEstimate=0,this._stage=this.view._stage,this._collection=this._stage.renderView.componentObjectCollection,this.resetHighlights();var l=s.defaultGeometrySchema;if(this._isIntegratedMesh||!l)this._hasComponentData=!1;else{var u=l.featureAttributes;this._hasComponentData=!!(u&&u.faceRange&&u.id)}this._hasVertexColors=null!=(null!==(e=null===l||void 0===l?void 0:l.vertexAttributes.color)&&void 0!==e?e:null)&&!(null!==(t=this.i3slayer.cachedDrawingInfo)&&void 0!==t&&t.color);var d=this.view.resourceController.memoryController.newCache("sl-".concat(this.uid),(function(e){return r._deleteComponentObject(e)}));this._memCache=d;var c=this._controller,h=this._nodeId2Meta,f=this._nodeId2MetaReloading;this._intersectionHandler=new ot({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:function(e){var t=c.index;if(t){var n=t.rootNode;if(n){t.traverse(n,(function(t){var n,r=t.index,i=h.get(r)||f.get(r);return e(t,null!==(n=null===i||void 0===i?void 0:i.objectHandle)&&void 0!==n?n:null)}))}}}}),this._updatingHandles.add((function(){return r.layerUid}),(function(e){return r._intersectionHandler.layerUid=e})),this._updatingHandles.add((function(){return r.sublayerUid}),(function(e){return r._intersectionHandler.sublayerUid=e})),this._elevationProvider=new gt.u({view:this.view,layerElevationSource:this,intersectionHandler:this._intersectionHandler}),this._hasLoadedPBRTextures=this._usePBR,this._updatingHandles.add((function(){return r.view.clippingArea}),(function(){return r._clippingAreaChanged()}),w.initial),this._updatingHandles.add((function(){return r.fullOpacity}),(function(e){return r._opacityChange(e)})),this._updatingHandles.add((function(){return r.slicePlaneEnabled}),(function(e){return r._slicePlaneEnabledChange(e)})),this._updatingHandles.add((function(){return r.elevationOffset}),(function(e,t){r._reloadAll(t),r._controller.invalidateVisibilityObbs()})),this._updatingHandles.add((function(){return r.elevationInfo}),(function(e,t){return r._elevationInfoChanged(e,t)}),w.initial),this._updatingHandles.add((function(){return!r.suspended&&r.elevationInfo.mode!==Ue.vV.Absolute}),(function(e,t){e?r.addHandles(r.view.basemapTerrain.on("elevation-change",(function(e){var t=e.extent;return r._ensureElevationTask().addExtent(t)})),an):t&&r.removeHandles(an)}),w.initial),this._updatingHandles.add((function(){return r._usePBR}),(function(e){return r._updatePBR(e)}));var v=function(){r._reloadAll(),r.clearMemCache()};this._updatingHandles.add((function(){return r.rendererTextureUsage}),v),this._updatingHandles.add((function(){return r.uncompressedTextureDownsamplingEnabled}),v),this._updatingHandles.add((function(){return r.contentVisible}),(function(e){return r._contentVisibleChanged(e)}),w.initial),this._updatingHandles.add((function(){return r.i3slayer.labelsVisible}),(function(){return r._labelingChanged()}),w.initial),this._updatingHandles.add((function(){return r.i3slayer.labelingInfo}),(function(){return r._labelingChanged()}),w.initial),this._updatingHandles.add((function(){return r._modifications}),(function(){return r._modificationsChanged()}),w.initial),this.addHandles([(0,w.watch)((function(){return Ct.h.I3S_TREE_SHOW_TILES}),(function(e){if(e&&!r._treeDebugger){var t=r._controller.crsIndex;n.e(80322).then(n.bind(n,80322)).then((function(e){var n=e.I3STreeDebugger;!r._treeDebugger&&Ct.h.I3S_TREE_SHOW_TILES&&(r._treeDebugger=new n({lv:r,view:r.view,nodeSR:t}))}))}else e||Ct.h.I3S_TREE_SHOW_TILES||(r._treeDebugger=(0,E.SC)(r._treeDebugger))}),w.initial),(0,w.watch)((function(){return Ct.h.I3S_SHOW_MODIFICATIONS}),(function(){return r._showModifications()}),w.initial)]),this._cacheKeySuffix=(0,et.ei)(this.i3slayer.spatialReference,this.view.renderSpatialReference),this._idbCache.init().catch((function(e){return Dt().warn("Failed to initialize IndexedDB cache: ".concat(e))}));var p=this.view,_=p.viewingMode,y=p.renderCoordsHelper;this._planetRadiusInGlobalMode="local"===_?0:y.referenceEllipsoid.radius}},{key:"destroy",value:function(){this._clearAddTasks(),this._elevationTask=(0,E.SC)(this._elevationTask),this.i3sOverrides=(0,E.SC)(this.i3sOverrides),this._elevationProvider&&(this._elevationProvider.objectsChanged(this.getVisibleObbs()),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null),this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);var e=this._worker;e&&(e.destroyContext(this.uid).then((function(){return e.destroy()})),this._worker=null),this._removeAllNodeDataFromStage(),this._memCache=(0,E.SC)(this._memCache),this._collection=null,this._stage=null,this._edgeView=null,this._labeler=(0,E.SC)(this._labeler),this._treeDebugger=(0,E.SC)(this._treeDebugger),this._controller=(0,E.SC)(this._controller),this._highlights.destroy(),this._nodeId2Meta.clear(),this._nodeId2MetaReloading.clear(),this._crossfadeHelper=(0,E.SC)(this._crossfadeHelper),this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null),this._updatingHandles=(0,E.SC)(this._updatingHandles)}},{key:"_memEstimateTextureAdded",value:function(e){var t=e.memoryEstimate;return this._gpuMemoryEstimate+=t,this._texMemoryEstimate+=t,t}},{key:"_memEstimateTextureRemoved",value:function(e){if(null!=e){var t=e.memoryEstimate;this._gpuMemoryEstimate-=t,this._texMemoryEstimate-=t}}},{key:"_memEstimateGeometryAdded",value:function(e){var t=this._collection.getObjectGPUMemoryUsage(e);return this._gpuMemoryEstimate+=t,this._geoMemoryEstimate+=t,t}},{key:"_memEstimateGeometryRemoved",value:function(e){var t=this._collection.getObjectGPUMemoryUsage(e);this._gpuMemoryEstimate-=t,this._geoMemoryEstimate-=t}},{key:"isNodeLoaded",value:function(e){return this._nodeId2Meta.has(e)}},{key:"isNodeReloading",value:function(e){return this._nodeId2MetaReloading.has(e)}},{key:"usedMemory",get:function(){var e=null!=this._labeler?this._labeler.usedMemory:0;return this._nodeId2Meta.forEach((function(t){return e+=null!=t?t.node.memory:0})),this._nodeId2MetaReloading.forEach((function(t){return e+=null!=t?t.node.memory:0})),e}},{key:"unloadedMemory",get:function(){return(null!=this._controller?this._controller.unloadedMemoryEstimate:0)+(null!=this._labeler?this._labeler.unloadedMemoryEstimate:0)}},{key:"_labelingChanged",value:function(){var e=this;if((0,Ge.C)(this.i3slayer)&&this._supportsLabeling){if(null==this._labeler){var t=new Ne({view:this.view,layer:this.i3slayer,collection:this._collection,overrides:this.i3sOverrides});this._nodeId2Meta.forEach((function(n){return null!=n&&e._addMetaToLabeler(t,n)})),this._labeler=t}}else null!=this._labeler&&(this._labeler.destroy(),this._labeler=null)}},{key:"_loadAsyncModule",value:function(e){var t=this;return++this._asyncModuleLoading,e.then((function(e){return--t._asyncModuleLoading,e}),(function(e){throw--t._asyncModuleLoading,e}))}},{key:"_modificationsChanged",value:function(){var e=this;if(!this._i3sWasmLoaded&&this.hasModifications)return this._i3sWasmLoaded=(0,He.initialize)().then((function(){e._i3sWasmLoaded=!0,e._modificationsChanged(),e.notifyUpdate()})),void this.notifyUpdate();if(!0===this._i3sWasmLoaded){var t=this.uid,n=this.i3slayer.spatialReference;this._worker.setModifications(t,this._layerClippingArea,this._modifications,n);var r=Ve(this._layerClippingArea,this._modifications,n);(0,He.setModificationsSync)({context:t,modifications:r,isGeodetic:n.isGeographic}),this._controller.modificationsChanged();var i=this.hasModifications?new x.Z:null;this._nodeId2Meta.forEach((function(t,n){null==t?(e._nodeId2Meta.delete(n),e._controller.updateLoadStatus(n,!1)):t.node.hasModifications?(e._nodeId2Meta.delete(n),e._nodeId2MetaReloading.set(n,t)):null!=i&&i.push(t.node)})),this.notifyChange("elevationRange"),null!=i&&this._nodeId2MetaReloading.forEach((function(e){return i.push(e.node)})),null!=i&&i.length>0&&(this.updateNodeModificationStatus(i),i.forAll((function(t){if(t.imModificationImpact!==lt.O4.Culled){var n=e._nodeId2Meta.get(t.index);e._controller.invalidateGeometryVisibility(t.index),null!=n?(e._nodeId2Meta.delete(t.index),e._nodeId2MetaReloading.set(t.index,n),e.notifyChange("elevationRange")):e._nodeId2Meta.has(t.index)&&(e._nodeId2Meta.delete(t.index),e._controller.updateLoadStatus(t.index,!1))}}))),this.clearMemCache(),this._controller.restartNodeLoading(),this._showModifications()}}},{key:"_showModifications",value:function(){if(null!=this._modificationGraphics&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null),Ct.h.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var e={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},t={outline:{color:[255,255,255],width:1}};this._modificationGraphics=new Array;var n,r=(0,l.Z)(this._modifications);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=i.geometry;a.spatialReference=this.i3slayer.spatialReference;var s=new Pt.default((0,o.Z)((0,o.Z)({},t),{},{color:e[i.type]}));this._modificationGraphics.push(new _.Z({geometry:a,symbol:s}))}}catch(u){r.e(u)}finally{r.f()}this.view.graphics.addMany(this._modificationGraphics)}}},{key:"_addMetaToLabeler",value:function(e,t){var n=this;e.addNodeMeta(t,(function(e,t){return n._createAttributes(e,t)}))}},{key:"_contentVisibleChanged",value:function(e){e?(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler)):(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler))}},{key:"getLoadedAttributes",value:function(e){var t=this._nodeId2Meta.get(e);if(null!=(null===t||void 0===t?void 0:t.attributeInfo))return t.attributeInfo.loadedAttributes}},{key:"getAttributeData",value:function(e){var t=this._nodeId2Meta.get(e);if(null!=(null===t||void 0===t?void 0:t.attributeInfo))return t.attributeInfo.attributeData}},{key:"setAttributeData",value:function(e,t){var n=this._nodeId2Meta.get(e);null!=(null===n||void 0===n?void 0:n.attributeInfo)&&(n.attributeInfo.attributeData=t,this._attributeValuesChanged(n))}},{key:"updateAttributes",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,r){var a,o=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._nodeId2Meta.get(t),e.t0=null!=a,!e.t0){e.next=7;break}return e.next=5,this.i3sOverrides.applyAttributeOverrides(a.featureIds,n,r,this._controller.requiredAttributes);case 5:a.attributeInfo=n,this._controller.reschedule((function(){return o._attributeValuesChanged(a)}),r).catch((function(e){(0,M.D_)(e)||Dt().warn("Error while updating attribute values. Layer might not display correctly.",e)}));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_attributeValuesChanged",value:function(e){var t=this;e.cachedRendererVersion=this._getInvalidRendererVersion(),e.filteredIds=null,null!=this._labeler&&this._labeler.setNodeMetaAttributes(e,(function(e,n){return t._createAttributes(e,n)})),this._updateEngineObject(e)}},{key:"clearMemCache",value:function(){null!=this._memCache&&this._memCache.clear()}},{key:"getVisibleNodes",value:function(){var e=new Array;return this._nodeId2Meta.forEach((function(t){return null!=t&&e.push(t.node)})),e}},{key:"getVisibleObbs",value:function(){var e=this,t=new Array;return this._nodeId2Meta.forEach((function(n){if(null!=n){var r=e.getNodeComponentObb(n.node);null!=r&&t.push(r)}})),t}},{key:"getNodeComponentObb",value:function(e){var t,n=null!==(t=this._nodeId2Meta.get(e.index))&&void 0!==t?t:this._nodeId2MetaReloading.get(e.index);return null!=n?this._collection.getComponentObb(n.objectHandle):null}},{key:"getLoadedNodeIndices",value:function(e){this._nodeId2Meta.forEach((function(t,n){return e.push(n)})),this._nodeId2MetaReloading.forEach((function(t,n){return e.push(n)}))}},{key:"_preLoadBasis",value:function(){var e;!(0,I.Z)("disable-feature:i3s-basis")&&this.supportedTextureEncodings&Be.j.Basis&&(null===(e=this.i3slayer.textureSetDefinitions)||void 0===e?void 0:e.some((function(e){return e.formats.some((function(e){return"basis"===e.format||"ktx2"===e.format}))})))&&(0,At.$8)()}},{key:"_getVertexBufferLayout",value:function(e,t){var n={hasTexture:Jt(e.params.material),hasNormals:t.normal,hasRegions:t.uvRegion};return(0,wt.K)((0,St.N)(this._getGeometryParameters(n)))}},{key:"_getObjectIdField",value:function(){return this.i3slayer.objectIdField||$.d}},{key:"_getGlobalIdField",value:function(){var e;return null===(e=this.i3slayer.associatedLayer)||void 0===e?void 0:e.globalIdField}},{key:"_findGraphicNodeAndIndex",value:function(e){var t=(0,mt.g)(this.i3slayer.fieldsIndex,e.attributes,this._getObjectIdField()),n=null;return(0,k.oE)(this._nodeId2Meta,(function(e){if(null==e)return!1;var r=e.featureIds.indexOf(t);return-1!==r&&(n={node:e.node,index:r},!0)})),n}},{key:"_getGraphicIndices",value:function(e,t){var n=this._nodeId2Meta.get(e.index);if(null==n)return[];var r,i=[],a=this._getObjectIdField(),o=this.i3slayer.fieldsIndex,s=(0,l.Z)(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,d=(0,mt.g)(o,u.attributes,a),c=n.featureIds.indexOf(d);-1!==c&&i.push(c)}}catch(h){s.e(h)}finally{s.f()}return i}},{key:"whenGraphicBounds",value:function(e){var t=this._findGraphicNodeAndIndex(e);if(!t)return Promise.reject();var n=this._getAABB(t.node.index,t.index);return null==n?Promise.reject():Promise.resolve({boundingBox:n,screenSpaceObjects:[]})}},{key:"getAABBFromIntersectorTarget",value:function(e){return null==e.nodeIndex||null==e.componentIndex?null:this._getAABB(e.nodeIndex,e.componentIndex)}},{key:"_getAABB",value:function(e,t){var n=this._nodeId2Meta.get(e);if(null==(null===n||void 0===n?void 0:n.featureIds)||t>=n.featureIds.length)return null;var r=n.objectHandle,i=(0,_e.z6)(t,this._collection,r,(0,Y.bg)(24),0),a=this.view.renderSpatialReference,o=this.view.spatialReference;if(!(0,B.projectBuffer)(i,a,0,i,o,0,8))return null;var s=(0,K.cS)();return(0,K.G1)(s,i,0,8),s}},{key:"whenGraphicAttributes",value:function(e,t){var n=this;return(0,et.bf)(this.i3slayer,e,this._getObjectIdField(),t,(function(){return(0,r.Z)(n._nodeId2Meta.values()).filter(y.pC)}))}},{key:"getGraphicFromIntersectorTarget",value:function(e){if(null==e.nodeIndex||null==e.componentIndex)return null;var t=this._nodeId2Meta.get(e.nodeIndex);return null==(null===t||void 0===t?void 0:t.featureIds)||e.componentIndex>=t.featureIds.length?null:this._createGraphic(e.componentIndex,t)}},{key:"_getCacheKey",value:function(e){return"".concat(this._layerUrl,"/v").concat(24,"/").concat(e).concat(this._cacheKeySuffix)}},{key:"_getMemCacheKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.elevationOffset;return e+"#"+t}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"loadCachedGPUData",value:function(e){return null!=this._memCache?this._memCache.pop(this._getMemCacheKey(e)):null}},{key:"deleteCachedGPUData",value:function(e){null!=e&&this._deleteComponentObject(e)}},{key:"_cacheGPUData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.elevationOffset;if(null!=this._memCache){var n=this._controller.indexDepth-e.node.level;this._memCache.put(this._getMemCacheKey(e.node.index,t),e,e.node.memory,n)}else this._deleteComponentObject(e)}},{key:"loadMissingTextures",value:function(e,t,n,r){var i,a=this,o=null!==(i=null===e||void 0===e?void 0:e.filter((function(e,n){if(!(e.usage&a.rendererTextureUsage))return!1;if(null==t)return!0;var r=(0,st.nn)(e.encodings,a.supportedTextureEncodings),i=t[n];return!!(null==(null===i||void 0===i?void 0:i.data)||r&&i.encoding!==r.encoding)})))&&void 0!==i?i:[];return 0===o.length?Promise.resolve(!1):n(o,r).then((function(n){for(var r=0,i=0;i<e.length;i++)r<n.length&&n[r].id===e[i].id&&(t[i]=n[r],r++);return!0}))}},{key:"loadCachedNodeData",value:function(e,t,n){var r=this;return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(e.id),t).then((function(i){return null==i?null:i.nodeVersion!==e.version?(r._idbCache.remove(r._getCacheKey(e.id)),null):(r.elevationInfo.mode===Ue.vV.Absolute&&(e.geometryObbInRenderSR=xt.Oo.fromData(i.geometryObbData)),r.loadMissingTextures(i.requiredTextures,i.textureData,n,t).then((function(n){return n&&r._idbCache.initialized&&null!=i.textureData&&(i.byteSize=Xt(i.transformedGeometry,i.textureData),i.textureData.every(Qt)&&$t(e,i)&&r._idbCache.put(r._getCacheKey(e.id),i).catch((function(t){return Dt().warn("Failed to update node with textures in IndexedDB cache: ".concat(e.id,": ").concat(t))}))),(0,M.k_)(t),i})))})):Promise.resolve(null)}},{key:"addNode",value:function(e,t,n){var r=this;return function(e){return"geometryData"in e}(t)?null==t.geometryBuffer?(this._addNodeMeta(e.index,null),Promise.resolve()):this._addData(e,t.attributeDataInfo,(function(){return r._transformNode(e,t,n).then((function(i){return r._safeReschedule((function(){if(null==i)return e.hasModifications=!1,r._addCachedNodeData(e,null,n);e.hasModifications=i.transformedGeometry.hasModifications;var a=i.obb,s=i.componentOffsets,l=i.featureIds,u=i.anchorIds,d=i.anchors,c=i.transformedGeometry,h=i.globalTrafo,f=(0,j.s)(nn,a.center.x,a.center.y,a.center.z);(0,j.h)(f,f,h);var v=new xt.Oo(f,[a.extents.x,a.extents.y,a.extents.z],(0,D.al)(a.orientation.x,a.orientation.y,a.orientation.z,a.orientation.w));r.elevationInfo.mode===Ue.vV.Absolute&&(e.geometryObbInRenderSR=v),t.geometryData.componentOffsets=s,l&&(t.geometryData.featureIds=Array.from(l)),t.geometryData.anchorIds=u,t.geometryData.anchors=d;var p={nodeVersion:e.version,geometryData:t.geometryData,requiredTextures:t.requiredTextures,textureData:t.textureData,transformedGeometry:c,globalTrafo:h,geometryObbData:v.data,byteSize:Xt(c,t.textureData)};if(r._idbCacheEnabled&&r._idbCache.initialized&&$t(e,p)){var _=null!=p.textureData?p.textureData.map((function(e){return Qt(e)?e:null})):null;r._idbCache.put(r._getCacheKey(e.id),(0,o.Z)((0,o.Z)({},p),{},{textureData:_})).catch((function(t){return Dt().warn("Failed to store node in IndexedDB cache: ".concat(e.id,": ").concat(t))}))}return r._addCachedNodeData(e,p,n)}),n)}))})):Promise.reject()}},{key:"getElevationRange",value:function(e){var t=new kt.r,n=this._controller,r=n.index;if(!r)return t;var i=r.rootNode;if(!i)return t;var a=this._nodeId2Meta,o=e[3],s=n.viewportQueries,l=this._planetRadiusInGlobalMode,u=this.view.renderCoordsHelper,d=u.referenceEllipsoid.radius,c=this._collection;return r.traverse(i,(function(n){var r=n.childrenLoaded;if(0===r)return!1;var i=s.getAndUpdateVisibilityObbInRenderSR(n),h=null,f=-1;if(i){if(f=i.radius,!i.intersectSphereWithMBS(e,f))return!1}else(h=s.getServiceMbsInRenderSR(n))&&(f=h[3]);if(f>=0&&o>=1*f)return null!=i?ln(t,i,l):null!=h&&h[3]>=0&&un(t,h,l),!1;var v=sn;if(v.elevationRangeMin=1/0,v.elevationRangeMax=-1/0,(null!=i||null!=h)&&(null!=i?ln(v,i,l):null!=h&&un(v,h,l),v.elevationRangeMin>=t.elevationRangeMin&&v.elevationRangeMax<=t.elevationRangeMax))return!1;var p=a.get(n.index);if(p){var _=n.geometryObbInRenderSR;if(!_||_.intersectSphereWithMBS(e)){if(_&&o>0*_.radius)return ln(t,_,l),!1;var y=p.objectHandle,g=c.getObjectTransform(y),m=u.getAltitude(g.position);c.expandRangeWithComponentObjectElevationRange(y,m,d,t)}}return r-(p?1:0)>0})),t}},{key:"computeVisibilityObb",value:function(e){return(0,et.Cx)(e,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications,this.view.renderCoordsHelper.sphericalPCPF)}},{key:"_transformNode",value:function(e,t,n){for(var r,i,a,o,s=null!==(r=t.geometryData.geometries)&&void 0!==r?r:[],l=new Array(s.length),u=0;u<s.length;++u)l[u]=this._getVertexBufferLayout(s[u],t.geometryDescriptor);var d=this.i3slayer.normalReferenceFrame,c=null!==(i=null!==(a=t.normalReferenceFrame)&&void 0!==a?a:d)&&void 0!==i?i:"none",h=e.serviceMbsInIndexSR,f=this.elevationOffset,v=this._controller.crsIndex,p=this._controller.crsVertex,_=this.view.renderSpatialReference,y=(0,dt.c)(h,f,c,v,_),g=(0,z.YD)(v,p),m=(0,z.YD)(p,_);if(null==g||null==m)return Promise.resolve(null);var b={context:this.uid,geometryBuffer:t.geometryBuffer,geometryData:t.geometryData,geometryDescriptor:t.geometryDescriptor,layouts:l,globalTrafo:y,mbs:h,obbData:null===(o=e.serviceObbInIndexSR)||void 0===o?void 0:o.data,elevationOffset:f,needNormals:this._needsNormals&&this._controller.isMeshPyramid,normalReferenceFrame:c,indexToVertexProjector:g,vertexToRenderProjector:m};return this._worker.invoke(b,n)}},{key:"_supportsNodeCrossFading",get:function(){var e,t;return!(null!==(e=this.view)&&void 0!==e&&null!==(t=e._stage)&&void 0!==t&&t.renderer.shadowsEnabled)}},{key:"nodeCrossfadingEnabled",get:function(){return this._supportsNodeCrossFading&&(this.lodCrossfadeinDuration>0||this.lodCrossfadeoutDuration>0||this.lodCrossfadeUncoveredDuration>0)}},{key:"nodeFadeoutEnabled",get:function(){return this._supportsNodeCrossFading&&this.lodCrossfadeoutDuration>0}},{key:"_setNewNodeOpacity",value:function(e){var t=this.nodeCrossfadingEnabled?0:this.fullOpacity;this._setNodeOpacity(e,t)}},{key:"addCachedGPUData",value:function(e,t,n){if(this.elevationInfo.mode===Ue.vV.Absolute&&(e.geometryObbInRenderSR=this._collection.getComponentObb(t.objectHandle).clone()),this._controller.isGeometryVisible(e)){null!=this._labeler&&this._addMetaToLabeler(this._labeler,t);var r=e.index;this._addNodeMeta(r,t),this.updateNodeState(r,n),this._collection.setObjectVisibility(t.objectHandle,!0),this._updateMaterial(t),this._setNewNodeOpacity(t),this.elevationInfo.mode!==Ue.vV.Absolute&&this._ensureElevationTask().schedule(r),this._updateEngineObject(t),this._highlights.objectCreated(t),null!=this._treeDebugger&&this._treeDebugger.update()}else this._cacheGPUData(t)}},{key:"addCachedNodeData",value:function(e,t,n,r){var i=this;return this._addData(e,n,(function(){return i._addCachedNodeData(e,t,r)}))}},{key:"deleteCachedNodeData",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._idbCacheEnabled){e.next=2;break}return e.abrupt("return",this._idbCache.remove(this._getCacheKey(t)));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addCachedNodeData",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n,r){var a,o,l,u,d,c,h,f,v,p,_,y,g,m,b,C,k,E,x,M,w,O,S,R,N,D,V,H,G,B,z,K,W,Y,X,$,ee,te,ne,re,ie,ae,oe,se,le=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.contentVisible&&this._controller.isGeometryVisible(t)){e.next=2;break}return e.abrupt("return",void this._removeNodeStageData(t.index,this.elevationOffset,this._nodeId2MetaReloading));case 2:if(null!=n){e.next=4;break}return e.abrupt("return",void this._addNodeMeta(t.index,null));case 4:return o=this._addTasks.get(t.index),l=n.geometryData,u=n.transformedGeometry,d=n.globalTrafo,e.next=7,this.i3sOverrides.applyAttributeOverrides(l.featureIds,o.attributeInfo,r,this._controller.requiredAttributes);case 7:if(c=null!=n.textureData?n.textureData.filter((function(e){return null!=e&&!!(e.usage&le.rendererTextureUsage)})):[],e.t0=!(0,I.Z)("disable-feature:i3s-basis")&&c.some((function(e){return null!=e&&(e.encoding===Be.j.Basis||e.encoding===Be.j.KTX2)})),!e.t0){e.next=12;break}return e.next=12,(0,At.$8)();case 12:return t.memory=0,h=l.componentOffsets,f=l.geometries,v=l.featureIds,p=l.anchorIds,_=l.anchors,y=this._collection,g=f[0],m=u.layout,b=u.indices,C=u.interleavedVertexData,k=u.positionData,E=u.hasColors,x=this._materialParameters(g,m),M=x.material,w=x.geometryParameters,O=h||new Uint32Array([0,b?b.length:C.byteLength/m[0].stride]),S={vertices:{data:C,count:C.byteLength/m[0].stride,layoutParameters:w},positionData:{positions:(0,J.YI)(k.data),indices:(0,Q.mi)(k.indices)},indices:b,componentOffsets:O},R=g.transformation?(0,F.d9)(g.transformation):(0,F.Ue)(),(0,P.Jp)(R,d,R),N=(0,P.i0)((0,Z.Ue)(),R),D=(0,A.xO)((0,T.Ue)(),R),V=this.view.renderSpatialReference,H=this.view.basemapTerrain.spatialReference,G=xt.Oo.fromData(n.geometryObbData).center,B=[1,1,1],(0,L.X)(G,V,B,H)||Dt().errorOnce("Unsupported coordinate system for IM overlay"),z=(0,Z.Ue)(),(0,q.S)(G,V,z,H),K=(0,T.Ue)(),(0,A.U_)(K,D),W=(0,Z.Ue)(),(0,j.t)(W,(0,j.z)(W,G,N),K),Y=z[0]-W[0]*B[0],X=z[1]-W[1]*B[1],$=y.createObject(new Ot.G((0,U.al)(Y,X,B[0],B[1]),new Rt.w(N,D),xt.Oo.fromData(n.geometryObbData),S)),ee=w.textureCoordinates===Nt.N.Atlas,te=this._initMaterialAndTextures($,M,c,ee),ne=te.textures,re=te.texturePromise,t.memory+=this._memEstimateGeometryAdded($),t.memory+=ne.reduce((function(e,t){return e+(null!=t?le._memEstimateTextureAdded(t):0)}),0),ie=!!M.hasParametersFromSource,ae="blend"!==M.alphaMode&&M.metallicRoughness.baseColorFactor[3]>=1,oe=new Zt(t,v,$,this._getInvalidRendererVersion(),o.attributeInfo,{hasParametersFromSource:ie,isOpaque:ae},ne,p,_),o.meta=oe,!this._hasTextures&&null!==(a=n.requiredTextures)&&void 0!==a&&a.some((function(e){return!!(e.usage&Be.v.ColorTextures)}))&&(this._hasTextures=!0),this._hasData=!0,this._hasColors=this._hasColors||E,this._hasTextures=this._hasTextures||!!t.resources.texture,this.notifyChange("hasTexturesOrVertexColors"),se=this.slicePlaneEnabled,e.abrupt("return",Promise.all([this._addOrUpdateEdgeRendering(oe),re]).then((function(e){var n=(0,s.Z)(e,2),i=n[0];n[1];return le._addTasks.has(t.index)&&null!==i&&void 0!==i&&i.updateObjectVisibility(oe.objectHandle,!1).catch((function(e){return Lt(e,le.i3slayer.title)})),le._safeReschedule((function(){var e=le._addTasks.get(t.index);if(e)if(le._addNodeMeta(t.index,oe),e.meta=null,le.contentVisible){y.setObjectVisibility($,!0),null!==i&&void 0!==i&&i.updateObjectVisibility(oe.objectHandle,!0).catch((function(e){return Lt(e,le.i3slayer.title)})),oe.attributeInfo=e.attributeInfo;var n=oe.cachedRendererVersion!==le._rendererVersion,r=se!==le.slicePlaneEnabled;le._updateElevationOffsets(oe);var a=oe.elevationOffsets;le._updateComponentData(oe);var o=le._applyFiltersToNode(oe);(n||null!=i&&(r||o||a))&&le._addOrUpdateEdgeRendering(oe),null!=le._labeler&&le._addMetaToLabeler(le._labeler,oe),le._visibleGeometryChanged(oe,Vt.ADD),le._highlights.objectCreated(oe),le._updateMaterial(oe),le._setNewNodeOpacity(oe),null!=le._treeDebugger&&le._treeDebugger.update()}else le._removeNodeStageData(t.index,le.elevationOffset)}),r)})).catch((function(e){throw null!=o.meta&&(le._cacheGPUData(o.meta),o.meta=null),e})));case 29:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_addNodeMeta",value:function(e,t){if(this._removeNodeStageData(e,this.elevationOffset,this._nodeId2MetaReloading),this._nodeId2Meta.has(e)){Dt().error("Removing duplicated node");var n=this._nodeId2Meta.get(e);null!=n&&this._deleteComponentObject(n)}else this._controller.updateLoadStatus(e,!0);null!=t&&(t.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&en(t.cachedEdgeMaterials,0)),this._nodeId2Meta.set(e,t),this.notifyChange("elevationRange")}},{key:"_updateElevationOffsets",value:function(e){var t,n=this,r=this.view.renderSpatialReference,i=this._controller.crsIndex,a=this.elevationInfo,o=this.view.basemapTerrain,s=o.spatialReference,l=a.mode;if(null!=r&&null!=s&&l!==Ue.vV.Absolute){var u=this._collection.getObjectTransform(e.objectHandle);e.elevationOffsets=null!==(t=e.elevationOffsets)&&void 0!==t?t:[];var d=nn,c=rn,h=l===Ue.vV.OnTheGround,f=this.view.renderCoordsHelper,v=e.featureIds.length,p=function(){if(e.cachedElevationAnchors)return e.cachedElevationAnchors;var t=(0,Y.bg)(3*v);e.cachedElevationAnchors=t;for(var a=0;a<v;a++){var o,l,h=3*a,p=null!==(o=null===(l=e.anchorIds)||void 0===l?void 0:l.indexOf(a))&&void 0!==o?o:-1;e.anchors&&p>=0?((0,j.s)(d,e.anchors[3*p],e.anchors[3*p+1],e.anchors[3*p+2]),(0,j.g)(d,d,(0,X.g)(e.node.serviceMbsInIndexSR)),(0,q.S)(d,i,d,s),t[h]=d[0],t[h+1]=d[1],t[h+2]=f.getAltitude(d)):(n._collection.getComponentAabb(e.objectHandle,a,c,!0),(0,j.s)(d,(c[0]+c[3])/2,(c[1]+c[4])/2,c[2]),(0,j.t)(d,d,u.rotationScale),(0,j.g)(d,d,u.position),t[h+2]=f.getAltitude(d),(0,q.S)(d,r,d,s),t[h]=d[0],t[h+1]=d[1])}return t}(),_=a.offset,y=e.elevationOffsets;o.getElevations(p,v,(function(e,t){var n=h?p[3*e+2]:0;y[e]=_+(null!=t?t-n:0)}))}else e.elevationOffsets=null}},{key:"_ensureElevationTask",value:function(){var e=this;return null!=this._elevationTask||(this._elevationTask=new Ye(this.view.resourceController.scheduler,(function(t){var n=e._controller.updateElevationChanged(t,e.view.basemapTerrain.spatialReference);return null!=n?n.filterInPlace((function(t){return null!=e._nodeId2Meta.get(t)})):null}),(function(t){var n=e._nodeId2Meta.get(t);e._nodeElevationAlignmentChanged(n)}),(function(){var t;return null===(t=e.elevationInfo)||void 0===t?void 0:t.mode}))),this._elevationTask}},{key:"_elevationInfoChanged",value:function(e,t){var n=this,r=e.mode!==Ue.vV.Absolute,i=!!t&&t!==e&&t.mode!==Ue.vV.Absolute;this._intersectionHandler.updateElevationAlignState(r,this.view.state.viewingMode),r&&!i&&this._controller.removeAllGeometryObbs(),this._nodeId2Meta.forEach((function(e){return n._nodeElevationAlignmentChanged(e)}))}},{key:"_nodeElevationAlignmentChanged",value:function(e){null!=e&&(this._updateElevationOffsets(e),this._updateComponentData(e),this._updateEdgeRendering(e),null!=this._labeler&&this._labeler.updateLabelPositions(e),this._updateSnappingSources(e,Vt.UPDATE))}},{key:"_safeReschedule",value:function(e,t){return(0,M.k_)(t),this._controller.reschedule(e,t)}},{key:"_materialParameters",value:function(e,t){var n=null!=e.params.material?e.params.material:(0,st.dY)(),r=t.some((function(e){return"uvRegion"===e.name})),i=t.some((function(e){return"normalCompressed"===e.name})),a=Jt(n);return{geometryParameters:this._getGeometryParameters({hasTexture:a,hasNormals:i,hasRegions:r}),material:n}}},{key:"_initMaterialAndTextures",value:function(e,t,n,r){var i=this,a=this._stage.renderView,o=n.map((function(e){return(0,st.cU)(e,t,r,a)}));this._stage.addMany(o);var s=null;return this._collection.updateMaterial(e,(function(e){s=(0,st.RE)(e,t,o,n,i.view._stage.renderView.textures,{rendererTextureUsage:i.rendererTextureUsage,usePBR:i._usePBR,isIntegratedMesh:i._isIntegratedMesh,slicePlaneEnabled:i.slicePlaneEnabled,viewSpatialReference:i.view.spatialReference}),i._updateMaterialOverlay(e)})),{textures:o,texturePromise:s}}},{key:"_getGeometryParameters",value:function(e){return{textureCoordinates:e.hasTexture?e.hasRegions?Nt.N.Atlas:Nt.N.Default:Nt.N.None,colors:this._hasVertexColors,hasNormals:e.hasNormals&&this._needsNormals,needsNormals:this._needsNormals}}},{key:"_addData",value:function(e,t,n){var r=this,i=this._addTasks.get(e.index);return i?i.attributeInfo=t:(i=(0,o.Z)((0,o.Z)({},(0,M.hh)()),{},{attributeInfo:t,meta:null}),this._addTasks.set(e.index,i),n().then(i.resolve,i.reject).then((function(){return r._addTasks.delete(e.index)})).catch((function(t){throw r._addTasks.delete(e.index),t}))),i.promise}},{key:"_clearAddTasks",value:function(){var e=this;this._addTasks.forEach((function(t){null!=t.meta&&(e._cacheGPUData(t.meta),t.meta=null)})),this._addTasks.clear()}},{key:"_clippingAreaChanged",value:function(){var e=this.view.renderSpatialReference,t=this.i3slayer.spatialReference,n=(0,W.Ue)();this._renderClippingArea=(0,Et.G)(this.view.clippingArea,n,e)?n:null;var r=(0,W.Ue)();this._layerClippingArea=(0,Et.G)(this.view.clippingArea,r,t)?r:null,this._filterChange(),this._controller&&this._controller.updateClippingArea(this.view.clippingArea),this._isIntegratedMesh&&this._modificationsChanged()}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"_geometryFilterChange",value:function(){var e=this.hasGeometryFilter;this._controller.geometryFilterChanged(e),this._applyFilters(e)}},{key:"_filterChange",value:function(){this._applyFilters(this.hasGeometryFilter)}},{key:"_applyFilters",value:function(e){var t=this;this._filters=this.getFilters(),e?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach((function(e){null!=e&&t._applyFiltersToNode(e)&&(t._addOrUpdateEdgeRendering(e),t._visibleGeometryChanged(e,Vt.UPDATE))}))}},{key:"getFilters",value:function(){var e=this,t=[],n=this._renderClippingArea;return null!=n&&t.push((function(t,r){return e._boundingRectFilter(t,r,n)})),t}},{key:"addSqlFilter",value:function(e,t,n){var r=this;if(null!=t){var i=t.fieldNames;e.push((function(e,a){return r._sqlFilter(e,a,t,i,n)}))}}},{key:"_sqlFilter",value:function(e,t,n,r,i){var a,o={},s=this._createLayerGraphic(o),u=this.i3slayer.objectIdField,d=t.featureIds,c=null===(a=t.attributeInfo)||void 0===a?void 0:a.attributeData;r.every((function(e){return e===u||null!=(null===c||void 0===c?void 0:c[e])}))&&(0,et.hv)(e,d,(function(e){o[u]=d[e];var a,h=(0,l.Z)(r);try{for(h.s();!(a=h.n()).done;){var f=a.value;f!==u&&(o[f]=c?(0,et.Jx)(c[f],e):null)}}catch(v){h.e(v)}finally{h.f()}try{return n.testFeature(s)}catch(t){return i(t),!1}}))}},{key:"_boundingRectNodeTest",value:function(e,t){return(0,G.s)(e.node.serviceMbsInIndexSR,this._controller.crsIndex,Yt,this.view.renderSpatialReference),(0,et.cr)(t,Yt)}},{key:"_boundingRectFeatureTest",value:function(e,t,n){return this._collection.getComponentAabb(e.objectHandle,t,Gt),(0,K.y8)(Gt,Bt),(0,W.kK)(n,Bt)}},{key:"_boundingRectFilter",value:function(e,t,n){var r=this,i=this._collection,a=this._boundingRectNodeTest(t,n);if(a!==et.pD.INSIDE)if(a!==et.pD.OUTSIDE){var o=i.getComponentCount(t.objectHandle);if(o.invisible+o.visible===t.featureIds.length){var s=this._transformClippingArea(zt,n,t.objectHandle);(0,et.hv)(e,t.featureIds,(function(e){return r._boundingRectFeatureTest(t,e,s)}))}}else e.length=0}},{key:"_transformClippingArea",value:function(e,t,n){var r=this._collection.getObjectTransform(n),i=r.position,a=r.rotationScale;return e[0]=(t[0]-i[0])/a[0],e[1]=(t[1]-i[1])/a[4],e[2]=(t[2]-i[0])/a[0],e[3]=(t[3]-i[1])/a[4],e}},{key:"_addOrUpdateEdgeRendering",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,o,s,l,u,d,c,h=this,f=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(f.length>1&&void 0!==f[1])||f[1],r=t.objectHandle,a=this._getFilteredEdgeMaterials(t),o=a.hasEdges,s=a.perFeatureEdgeMaterials,l={hasSlicePlane:this.slicePlaneEnabled},e.t0=o&&!this._edgeView,!e.t0){e.next=7;break}return e.next=6,this._stage.renderer.loadEdgeView();case 6:this._edgeView=e.sent;case 7:if(u=this._edgeView){e.next=10;break}return e.abrupt("return",null);case 10:if(d=u.hasObject(r),!o){e.next=19;break}if(!d){e.next=15;break}return this.nodeCrossfadingEnabled&&en(s,this.getNodeOpacity(t)),e.abrupt("return",(u.updateAllComponentMaterials(r,s,l,n).catch((function(e){return Lt(e,h.i3slayer.title)})),u.updateObjectVisibility(r,!0).catch((function(e){return Lt(e,h.i3slayer.title)})),u.updateAllVerticalOffsets(r,t.elevationOffsets).catch((function(e){return Lt(e,h.i3slayer.title)})),u));case 15:return e.next=17,this._collection.addEdges(r,u,s,l,t.elevationOffsets);case 17:return c=e.sent,e.abrupt("return",(t.edgeMemoryUsage=c,t.node.memory+=c,u));case 19:return e.abrupt("return",(d&&(t.node.memory-=t.edgeMemoryUsage,t.edgeMemoryUsage=0,u.removeObject(r)),null));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applyFiltersToNode",value:function(e){return!!this._applyFiltersToNodeComponents(e)&&(null!=this._labeler&&this._labeler.applyFilterChange(e),!0)}},{key:"_applyFiltersToNodeComponents",value:function(e){var t=this._collection,n=t.getComponentCount(e.objectHandle),r=null!=e.filteredIds,i=0===n.invisible;if(t.setAllComponentVisibilities(e.objectHandle,"all"),0===this._filters.length)return e.filteredIds=null,!i;if(this._updateCachedFilteredIds(e),r&&e.filteredIds===e.featureIds)return!i;var a=this._computeFilteredComponentIndices(e);return t.setAllComponentVisibilities(e.objectHandle,a),!0}},{key:"_updateCachedFilteredIds",value:function(e){null!=e.filteredIds&&e.appliedFilters===this._filters||(e.filteredIds=this._computeFilteredIds(e),e.appliedFilters=this._filters)}},{key:"_computeFilteredIds",value:function(e){var t,n=e.featureIds.slice(),r=(0,l.Z)(this._filters);try{for(r.s();!(t=r.n()).done;){if((0,t.value)(n,e),0===n.length)break}}catch(i){r.e(i)}finally{r.f()}return n.length===e.featureIds.length?e.featureIds:n}},{key:"_computeFilteredComponentIndices",value:function(e){var t=new Array,n=e.filteredIds;return null!=n&&e.featureIds.forEach((function(e,r){n[t.length]===e&&t.push(r)})),t}},{key:"_removeAllNodeDataFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.elevationOffset;this._nodeId2Meta.forEach((function(n,r){return e._removeNodeStageData(r,t)})),this._nodeId2MetaReloading.forEach((function(n,r){return e._removeNodeStageData(r,t,e._nodeId2MetaReloading)})),this._elevationTask=(0,E.SC)(this._elevationTask)}},{key:"removeNode",value:function(e){var t=this.elevationOffset;this._removeNodeStageData(e,t),this._removeNodeStageData(e,t,this._nodeId2MetaReloading),null!=this._elevationTask&&this._elevationTask.remove(e)}},{key:"_removeNodeStageData",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._nodeId2Meta;r.has(e)&&this._controller.updateLoadStatus(e,!1);var i=r.get(e);null!=i?(this._collection.setObjectVisibility(i.objectHandle,!1),null!=this._edgeView&&this._edgeView.hasObject(i.objectHandle)&&this._edgeView.updateObjectVisibility(i.objectHandle,!1).catch((function(e){return Lt(e,n.i3slayer.title)})),this._visibleGeometryChanged(i,Vt.REMOVE),null!=this._labeler&&this._labeler.removeNodeMeta(i),r.delete(e),this._highlights.objectDeleted(i),r===this._nodeId2Meta?(this._cacheGPUData(i,t),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(i)):this._deleteComponentObject(i),null!=this._treeDebugger&&this._treeDebugger.update()):r.delete(e)}},{key:"_deleteComponentObject",value:function(e){if(null!=this._edgeView&&this._edgeView.removeObject(e.objectHandle),this._memEstimateGeometryRemoved(e.objectHandle),this._collection.destroyObject(e.objectHandle),e.textures){var t,n=(0,l.Z)(e.textures);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._memEstimateTextureRemoved(r),this._stage.remove(r)}}catch(i){n.e(i)}finally{n.f()}}}},{key:"updateNodeState",value:function(e,t){var n=this._nodeId2Meta.get(e);null!=n&&this._collection.updateMaterial(n.objectHandle,(function(e){return e.polygonOffsetEnabled=t===lt.FE.Hole}))}},{key:"updateNodeIndex",value:function(e,t){if(this._nodeId2Meta.has(e)){var n=this._nodeId2Meta.get(e);this._nodeId2Meta.delete(e),this._nodeId2Meta.set(t,n),this.notifyChange("elevationRange")}var r=this._nodeId2MetaReloading.get(e);r&&(this._nodeId2MetaReloading.delete(e),this._nodeId2MetaReloading.set(t,r))}},{key:"_invalidateAllSymbols",value:function(){this._rendererVersion=(0,et.HV)(this._rendererVersion,1),this._controller&&this._controller.requestUpdate()}},{key:"_getInvalidRendererVersion",value:function(){return(0,et.HV)(this._rendererVersion,-1)}},{key:"_rendererChange",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,o,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._currentRenderer=t,this.notifyChange("rendererTextureUsage"),this._rendererVersion=(0,et.HV)(this._rendererVersion,1),this._rendererFields=null,this._colorVariable=null,this._opacityVariable=null,this._invalidateAllSymbols(),e.t0=t,!e.t0){e.next=12;break}return e.next=11,t.getRequiredFields(this.i3slayer.fieldsIndex);case 11:this._rendererFields=e.sent;case 12:if(this._updateSymbologyFields(),e.t1=!this._arcade&&t&&"arcadeRequired"in t&&t.arcadeRequired,!e.t1){e.next=18;break}return e.next=17,(0,ie.LC)();case 17:this._arcade=e.sent;case 18:if(!(t&&"visualVariables"in t&&t.visualVariables)){e.next=21;break}n=(0,l.Z)(t.visualVariables);try{for(n.s();!(r=n.n()).done;)"color"===(a=r.value).type?this._colorVariable=a:"opacity"===a.type?this._opacityVariable=a:Dt().warn("Unsupported visual variable type for 3D Object Scene Services: ".concat(a.type))}catch(i){n.e(i)}finally{n.f()}case 21:if(t){o=(0,l.Z)(t.getSymbols());try{for(o.s();!(s=o.n()).done;)"mesh-3d"!==(u=s.value).type&&Dt().error("Symbols of type '".concat(u.type,"' are not supported for 3D Object Scene Services."))}catch(i){o.e(i)}finally{o.f()}}this._controller&&this._controller.requestUpdate();case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getCachedEdgeMaterials",value:function(e){return this._hasComponentData&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedEdgeMaterials}},{key:"_getComponentParameters",value:function(e){var t=this;this._hasComponentData&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e);var n=e.cachedSymbology;return function(r,i){var a,o,s=5*r;if((0,V.s)(i.externalColor,n[s]/255,n[s+1]/255,n[s+2]/255,n[s+3]/255),null!=t._stage.renderView.objectAndLayerIdRenderHelper){var l=e.featureIds[r],u=(0,ae.ql)(t.view.map,t.layerUid);t._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(l,l,t.layerId,t.layerUid+"_"+t.sublayerId,t.layerPopupEnabledAndHasTemplate&&!u,e.node.resources.attributes,r,t.sublayerId),i.objectAndLayerIdColor=t._stage.renderView.getObjectAndLayerIdColor({graphicUid:l,layerUid:t.layerUid+"_"+t.sublayerId})}i.externalColorMixMode=n[s+4]&(1<<pt.CastShadows)-1,i.castShadows=!!(n[s+4]&1<<pt.CastShadows),i.pickable=!!(n[s+4]&1<<pt.Pickable),i.elevationOffset=null!==(a=null===(o=e.elevationOffsets)||void 0===o?void 0:o[r])&&void 0!==a?a:0}}},{key:"_getSymbolInfo",value:function(e,t){var n=null===e||void 0===e?void 0:e.getSymbol(t,{arcade:this._arcade});if(!(n instanceof se.Z))return null;var r=n.id;if(this._symbolInfos.has(r))return this._symbolInfos.get(r);var i=(0,et.ix)(n);return this._symbolInfos.set(r,i),i}},{key:"_setSymbologyOverride",value:function(e,t){this._symbologyOverride!==e&&(this._symbologyOverride=e,this._symbologyOverrideFields=t,this._invalidateAllSymbols(),this._updateSymbologyFields())}},{key:"_updateSymbologyFields",value:function(){this._symbologyFields=null!=this._symbologyOverrideFields&&this._symbologyOverrideFields.length>0?null!=this._rendererFields&&this._rendererFields.length>0?(0,te.Q0)(this.i3slayer.fieldsIndex,[].concat((0,r.Z)(this._rendererFields),(0,r.Z)(this._symbologyOverrideFields))):this._symbologyOverrideFields:this._rendererFields}},{key:"_updateCachedRendererData",value:function(e){var t;if(e.cachedRendererVersion=this._rendererVersion,this._hasComponentData){var n=this._tmpAttributeOnlyGraphic,r={};n.attributes=r;var i=this._currentRenderer,a=null===(t=e.attributeInfo)||void 0===t?void 0:t.attributeData,s=null!=e.featureIds?this.i3slayer.objectIdField:null,u=null!=a&&null!=this._symbologyFields&&this._symbologyFields.length>0,d=null,c=null;if(u&&null!=this._symbologyFields){d=[],c=[];var h,f=(0,l.Z)(this._symbologyFields);try{for(f.s();!(h=f.n()).done;){var v=h.value,p=a[v];p&&(d.push(v),c.push(p))}}catch(A){f.e(A)}finally{f.f()}}e.cachedSymbology||(e.cachedSymbology=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=S.c8?t?new Array(e).fill(0):new Array(e):new Uint8Array(e)}(5*e.featureIds.length));for(var _={color:Kt,castShadows:!0,pickable:!0,colorMixMode:It.a9.Multiply,edgeMaterial:null},y=this.fullOpacity,g=this.nodeCrossfadingEnabled?this.getNodeOpacity(e):y,m=null,b=Tt.i.OPAQUE,I=et.uC,C=0,k=0;k<e.featureIds.length;k++){if(null!=s&&(r[s]=e.featureIds[k]),u&&d)for(var E=0;E<d.length;E++)r[d[E]]=(0,et.Jx)(c[E],k);var x=i?this._getSymbolInfo(i,n):null,M=null,w=null;if(i&&"visualVariables"in i){if(this._colorVariable){var O=(0,re.getColor)(this._colorVariable,n,{color:Wt,arcade:this._arcade});O&&((M=Kt)[0]=O.r/255,M[1]=O.g/255,M[2]=O.b/255,this._opacityVariable||null===O.a||(w=O.a))}this._opacityVariable&&(w=(0,re.getOpacity)(this._opacityVariable,n,{arcade:this._arcade}))}if(null!==x&&void 0!==x&&x.material){var R=x.material;M=null==M||null==w?(0,Le.$o)(M,w,R.color,R.alpha,jt,Kt):(0,Le.$o)(M,w,null,null,jt,Kt)}if(null==M&&((M=Kt)[0]=1,M[1]=1,M[2]=1,M[3]=1),_.pickable=!0,_.castShadows=!x||x.castShadows,_.colorMixMode=null!==x&&void 0!==x&&x.material?x.material.colorMixMode:It.a9.Multiply,_.edgeMaterial=x?x.edgeMaterial:null,null!=this._symbologyOverride&&(_.color=M,this._symbologyOverride(n,_),M=_.color),null!=this._nodeColorOverride&&(this._nodeColorOverride(e.node,M),_.colorMixMode=It.a9.Replace),null!=_.edgeMaterial){var N=M[3]<=0?Tt.i.INVISIBLE:M[3]>=1&&(e.material.isOpaque||_.colorMixMode===It.a9.Replace)?Tt.i.OPAQUE:Tt.i.TRANSPARENT;_.edgeMaterial===m&&N===b||(I=(0,o.Z)((0,o.Z)({},_.edgeMaterial),{},{opacity:g,objectTransparency:N}),m=_.edgeMaterial,b=N),e.cachedEdgeMaterials[k]=I}else e.cachedEdgeMaterials[k]=et.uC;e.cachedSymbology[C++]=Math.round(255*M[0]),e.cachedSymbology[C++]=Math.round(255*M[1]),e.cachedSymbology[C++]=Math.round(255*M[2]),e.cachedSymbology[C++]=Math.round(255*M[3]),e.cachedSymbology[C++]=_.colorMixMode|+_.castShadows<<pt.CastShadows|+_.pickable<<pt.Pickable}}}},{key:"_getFilteredEdgeMaterials",value:function(e){var t=this._getCachedEdgeMaterials(e);this.nodeCrossfadingEnabled||en(t,this.fullOpacity);var n=e.filteredIds;if(null==n)return{hasEdges:t.some((function(e){return e!==et.uC})),perFeatureEdgeMaterials:t};var r=0,i=!1,a=t.map((function(t,a){return e.featureIds[a]!==n[r]?et.uC:(i=i||t!==et.uC,r++,t)}));return{hasEdges:i,perFeatureEdgeMaterials:a}}},{key:"_updateComponentData",value:function(e){if(this._hasComponentData){var t=e.objectHandle,n=this._getComponentParameters(e);this._collection.setComponentData(t,n),this._stage.renderView.requestRender()}}},{key:"_reloadAll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.elevationOffset;this._removeAllNodeDataFromStage(e),null!=this._controller&&this._controller.restartNodeLoading()}},{key:"_opacityChange",value:function(e){var t=this;this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading(),this._nodeId2Meta.forEach((function(n){null!=n&&(t._collection.updateMaterial(n.objectHandle,(function(t){return t.objectOpacity=e})),en(n.cachedEdgeMaterials,e),t._updateEdgeRendering(n))}))}},{key:"_updateMaterial",value:function(e){var t=this;this._collection.updateMaterial(e.objectHandle,(function(e){e.commonMaterialParameters.hasSlicePlane=t.slicePlaneEnabled,e.usePBR=t._usePBR,t._updateMaterialOverlay(e)}))}},{key:"_updateMaterialOverlay",value:function(e){}},{key:"_updateEngineObject",value:function(e){this._updateComponentData(e),this._applyFiltersToNode(e),this._addOrUpdateEdgeRendering(e),this._visibleGeometryChanged(e,Vt.UPDATE)}},{key:"_slicePlaneEnabledChange",value:function(e){var t=this;this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=e),null!=this._labeler&&(this._labeler.slicePlaneEnabled=e),this._nodeId2Meta.forEach((function(n){null!=n&&(t._collection.updateMaterial(n.objectHandle,(function(t){return t.commonMaterialParameters.hasSlicePlane=e})),t._updateEdgeRendering(n,!1))}))}},{key:"_updatePBR",value:function(e){var t=this;this._nodeId2Meta.forEach((function(n){null!=n&&t._collection.updateMaterial(n.objectHandle,(function(t){return t.usePBR=e}))})),this._hasLoadedPBRTextures=!0}},{key:"_usePBR",get:function(){return this._needsNormals&&this.view.qualitySettings.physicallyBasedRenderingEnabled}},{key:"_updateEdgeRendering",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!=this._edgeView&&this._edgeView.hasObject(e.objectHandle)&&this._addOrUpdateEdgeRendering(e,t)}},{key:"_forAllNodes",value:function(e){this._nodeId2Meta.forEach(e)}},{key:"_ignoreClientNodeOverriddenFeatures",value:function(e){var t=this;return this.i3sOverrides.hasGeometryChanges?function(n,r,i){return i.node.index>=0&&t.i3sOverrides.featureHasGeometryChanges(n)?Ue.Ku.CONTINUE:e(n,r,i)}:e}},{key:"_forAllFeatures",value:function(e,t,n){var r=this;(0,k.oE)(this._nodeId2Meta,(function(i){if(null==i)return!1;if(null!=t)switch(t(i)){case Ue.Ku.EXIT:return!0;case Ue.Ku.SKIP:return!1}var a=Ue.Ku.CONTINUE;switch(n){case Ue.p1.ALL:a=r._forAllFeaturesOfNode(i,e);break;case Ue.p1.VISIBLE_ONLY:a=r._forAllVisibleFeaturesOfNode(i,e);break;case Ue.p1.QUERYABLE:a=r._forAllQueryableFeaturesOfNode(i,e)}return a===Ue.Ku.EXIT}))}},{key:"_forAllFeaturesOfNode",value:function(e,t){for(var n=Ue.Ku.CONTINUE,r=e.featureIds,i=0;i<r.length;i++)if((n=t(r[i],i,e))===Ue.Ku.EXIT)return n;return n}},{key:"_forAllVisibleFeaturesOfNode",value:function(e,t){var n=Ue.Ku.CONTINUE,r=e.featureIds;return this._collection.forEachVisibleComponent(e.objectHandle,(function(i){return(n=t(r[i],i,e))===Ue.Ku.CONTINUE})),n}},{key:"_forAllQueryableFeaturesOfNode",value:function(e,t){var n=this._ignoreClientNodeOverriddenFeatures(t);if(null==this._renderClippingArea)return this._forAllFeaturesOfNode(e,n);var r=this._boundingRectNodeTest(e,this._renderClippingArea);if(r===et.pD.OUTSIDE)return Ue.Ku.CONTINUE;if(r===et.pD.INSIDE)return this._forAllFeaturesOfNode(e,n);for(var i=Ue.Ku.CONTINUE,a=e.featureIds,o=e.objectHandle,s=(0,et.ns)(this._renderClippingArea,this._collection.getObjectTransform(o)),l=0;l<a.length;l++)if(this._boundingRectFeatureTest(e,l,s)){var u=n(a[l],l,e);if(u===Ue.Ku.EXIT)return u}return i}},{key:"_createAttributes",value:function(e,t){var n,r={};null!=t.featureIds&&(r[this._getObjectIdField()]=t.featureIds[e]);var i=null===(n=t.attributeInfo)||void 0===n?void 0:n.attributeData;if(null!=i)for(var a=0,o=Object.keys(i);a<o.length;a++){var s=o[a];r[s]=(0,et.Jx)(i[s],e)}return r}},{key:"_createGraphic",value:function(e,t){return this._createLayerGraphic(this._createAttributes(e,t))}},{key:"highlight",value:function(e){if("number"==typeof e||e instanceof _.Z?e=[e]:e instanceof m.Z&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof _.Z){var t=e,n=this.i3slayer.fieldsIndex,r=this._getObjectIdField(),i=t.map((function(e){return(0,mt.g)(n,e.attributes,r)})),a=this._highlights.acquireSet(),o=a.set,s=a.handle;return this._highlights.setFeatureIds(o,i),s}if("number"==typeof e[0]){var l=e,u=this._highlights.acquireSet(),d=u.set,c=u.handle;return this._highlights.setFeatureIds(d,l),c}}return(0,b.kB)()}},{key:"resetHighlights",value:function(){var e=this;(0,E.SC)(this._highlights),this._highlights=new qe({collection:this._collection,forAllFeatures:function(t){return e._forAllFeatures(t,null,Ue.p1.ALL)},forAllFeaturesOfNode:function(t,n){return e._forAllFeaturesOfNode(t,n)}})}},{key:"_visibleGeometryChanged",value:function(e,t){var n=this;if(this._elevationProvider){var r=this.getNodeComponentObb(e.node);r&&this._elevationProvider.objectChanged(r),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=(0,O.Os)((function(){n.emit("visible-geometry-changed"),n._visibleGeometryChangedSchedulerHandle=null}))),this._updateSnappingSources(e,t)}}},{key:"performanceInfo",get:function(){return new Ae(this.usedMemory,this._nodeId2Meta.size,Math.round(this._gpuMemoryEstimate/1048576),Math.round(this._geoMemoryEstimate/1048576),Math.round(this._texMemoryEstimate/1048576),Math.round(this.unloadedMemory/1048576),this._idbCacheEnabled?Math.round(100*this._idbCache.getHitRate()):0)}},{key:"test",get:function(){}},{key:"getNodeOpacityByIndex",value:function(e){var t=this._nodeId2Meta.get(e);return this.getNodeOpacity(t)}},{key:"getNodeOpacity",value:function(e){return null!=e?this._collection.getMaterial(e.objectHandle).objectOpacity:0}},{key:"isNodeFullyFadedIn",value:function(e){return this._crossfadeHelper.isNodeFullyFadedIn(e)}},{key:"getNodeCrossfadeMetaData",value:function(e){return this._nodeId2Meta.get(e)}},{key:"markNodeToRemove",value:function(e){this._controller&&this._controller.markNodeToRemove(e)}},{key:"removeMarkedNodes",value:function(){this._controller&&this._controller.removeMarkedNodes()}},{key:"foreachCrossfadeNode",value:function(e){this._nodeId2Meta.forEach(e)}},{key:"fadeNode",value:function(e,t,n){if(this.nodeCrossfadingEnabled){var r=this._nodeId2Meta.get(e);null!=r&&this._crossfadeHelper.fadeNode(e,r,t,n)}}},{key:"setNodeOpacityByIndex",value:function(e,t){var n=this._nodeId2Meta.get(e);null!=n&&this._setNodeOpacity(n,t)}},{key:"_setNodeOpacity",value:function(e,t){this._collection.updateMaterial(e.objectHandle,(function(e){return e.objectOpacity=t})),this._setNodeEdgeOpacity(e,t)}},{key:"_setNodeEdgeOpacity",value:function(e,t){var n=this;if(null!=this._edgeView&&e.cachedEdgeMaterials){en(e.cachedEdgeMaterials,t);var r=e.objectHandle;this._edgeView.hasObject(r)&&this._edgeView.updateAllComponentOpacities(r,t).catch((function(e){return Lt(e,n.i3slayer.title)}))}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&null!=this._layerClippingArea||this._modifications&&this._modifications.length>0}},{key:"updateNodeModificationStatus",value:function(e){var t=this,n=e.length;if(this.hasModifications&&!(n<=0)&&!0===this._i3sWasmLoaded){var r=this.uid,i=function(e){if(0===e.length)return;var t=10*e.length,n=new Float64Array(t),r=0;return e.forAll((function(e){var t=e.serviceObbInIndexSR;null==t&&((t=qt).center=(0,X.g)(e.serviceMbsInIndexSR),t.halfSize=[e.serviceMbsInIndexSR[3],e.serviceMbsInIndexSR[3],e.serviceMbsInIndexSR[3]]);var i=t.data;n[r++]=i[0],n[r++]=i[1],n[r++]=i[2],n[r++]=i[3],n[r++]=i[4],n[r++]=i[5],n[r++]=i[6],n[r++]=i[7],n[r++]=i[8],n[r++]=i[9]})),n}(e);if(i){var a={context:r,buffer:i.buffer};(0,He.filterObbsForModificationsSync)(a);var o=new Float64Array(i.buffer);e.forAll((function(e,n){var r=o[n],i=(0,He.interpretObbModificationResults)(r);e.imModificationImpact=i,i!==lt.O4.Unmodified&&t._controller.invalidateGeometryVisibility(e.index)}))}}}},{key:"notifyUpdate",value:function(){this.notifyChange("updating")}},{key:"notifyLODUpdate",value:function(){this._controller.notifyLODUpdate()}},{key:"isUpdating",value:function(){var e;return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||null!=this._labeler&&this._labeler.updating||(null===(e=this._crossfadeHelper)||void 0===e?void 0:e.updating)||this._i3sWasmLoaded instanceof Promise||this._asyncModuleLoading>0||null!=this._elevationTask&&this._elevationTask.running}},{key:"trackSnappingSources",value:function(e){var t=this,n={events:e,fetchEdgeLocations:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(n,r,a){var o,s,l,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(o=t._nodeId2Meta.get(n))){e.next=3;break}throw new Error("invalid-node");case 3:return e.next=5,t._collection.extractEdgeInformation(o.objectHandle,r,a);case 5:return s=e.sent,l=s.origin,u=s.buffer,e.abrupt("return",(t._snappingLocationsApplyElevation(o,u,l),{type:"components",objectIds:o.featureIds,locations:u,origin:l}));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),remove:function(){return(0,y.e$)(t._snappingSourcesTrackers,n)}};return this._snappingSourcesTrackers.push(n),this._nodeId2Meta.forEach((function(n,r){if(null!=n){var i=t._controller.getRenderMbs(n.node);i&&e.add(r,i)}})),n}},{key:"_snappingLocationsApplyElevation",value:function(e,t,n){var r=this;if(e.elevationOffsets&&this.elevationInfo.mode!==Ue.vV.Absolute)for(var i=t.position0,a=t.position1,o=t.componentIndex,s=(0,Z.Ue)(),l=(0,Z.Ue)(),u=function(e,t){(0,j.g)(e,e,n),r.view.renderCoordsHelper.worldUpAtPosition(e,l),(0,j.g)(e,e,(0,j.j)(l,l,t)),(0,j.f)(e,e,n)},d=0;d<i.count;d++){var c=e.elevationOffsets[o.get(d)];i.getVec(d,s),u(s,c),i.setVec(d,s),a.getVec(d,s),u(s,c),a.setVec(d,s)}}},{key:"_updateSnappingSources",value:function(e,t){var n=e.node.index,r=this._controller.getRenderMbs(e.node);if(null!=r){var i,a=(0,l.Z)(this._snappingSourcesTrackers);try{for(a.s();!(i=a.n()).done;){var o=i.value;t!==Vt.REMOVE&&t!==Vt.UPDATE||o.events.remove(n),t!==Vt.ADD&&t!==Vt.UPDATE||o.events.add(n,r)}}catch(s){a.e(s)}finally{a.f()}}}}]),v}(e);return(0,v._)([(0,R.Cb)()],t.prototype,"_hasLoadedPBRTextures",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"_asyncModuleLoading",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"_visibleGeometryChangedSchedulerHandle",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"view",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"i3slayer",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"_controller",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"_labeler",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"updating",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"suspended",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"contentVisible",null),(0,v._)([(0,R.Cb)({readOnly:!0})],t.prototype,"legendEnabled",null),(0,v._)([(0,R.Cb)()],t.prototype,"holeFilling",void 0),(0,v._)([(0,R.Cb)(Mt.q)],t.prototype,"updatingProgress",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"updatingProgressValue",null),(0,v._)([(0,R.Cb)()],t.prototype,"hasTexturesOrVertexColors",null),(0,v._)([(0,R.Cb)()],t.prototype,"rendererTextureUsage",null),(0,v._)([(0,R.Cb)()],t.prototype,"elevationOffset",null),(0,v._)([(0,R.Cb)()],t.prototype,"elevationInfo",null),(0,v._)([(0,R.Cb)({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),(0,v._)([(0,R.Cb)()],t.prototype,"supportedTextureEncodings",null),(0,v._)([(0,R.Cb)()],t.prototype,"uncompressedTextureDownsamplingEnabled",null),(0,v._)([(0,R.Cb)({type:[ne.Z]})],t.prototype,"_modifications",void 0),(0,v._)([(0,R.Cb)({readOnly:!0})],t.prototype,"clientGeometry",null),(0,v._)([(0,R.Cb)()],t.prototype,"elevationRange",null),(0,v._)([(0,R.Cb)()],t.prototype,"fullExtent",null),(0,v._)([(0,R.Cb)()],t.prototype,"_elevationTask",void 0),(0,v._)([(0,R.Cb)({readOnly:!0})],t.prototype,"_usePBR",null),t=(0,v._)([(0,N.j)(Ft)],t)};function Lt(e,t){(0,M.D_)(e)||Dt().warn("Error while processing edges. Edges on this layer might not display correctly",t,e)}!function(e){e[e.ADD=0]="ADD",e[e.REMOVE=1]="REMOVE",e[e.UPDATE=2]="UPDATE"}(Vt||(Vt={}));var Gt=(0,K.Ue)(),Bt=(0,W.Ue)(),zt=(0,W.Ue)(),qt=new xt.Oo,Kt=[0,0,0,0],Wt=new p.Z([0,0,0,0]),Yt=(0,X.f)(0,0,0,0);function Jt(e){if(null==e)return!1;var t=e.metallicRoughness;return t&&t.baseColorTextureId>=0||t&&t.metallicRoughnessTextureId>=0||e.normalTextureId>=0||e.emissiveTextureId>=0||e.occlusionTextureId>=0}function Qt(e){return null!=e&&(0,S.eP)(e.data)}function Xt(e,t){var n=1024+e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0)+e.positionData.data.byteLength+e.positionData.indices.byteLength;if(null!=t){var r,i=(0,l.Z)(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;null!=a&&(0,S.eP)(a.data)&&(n+=a.data.byteLength)}}catch(o){i.e(o)}finally{i.f()}}return n}function $t(e,t){return t.byteSize>Ut?(Dt().warn("Node is too big to store in IndexedDB cache: ".concat(e.id," (").concat(t.byteSize," bytes)")),!1):t.byteSize>0}function en(e,t){e.forEach((function(e){return e.opacity=t}))}var tn=(0,d.Z)((function e(t,n){(0,c.Z)(this,e),this.mode=t,this.offset=n})),nn=(0,Z.Ue)(),rn=(0,K.Ue)(),an="elevation-change",on=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],sn=new kt.r;function ln(e,t,n){var r=e.elevationRangeMin,i=e.elevationRangeMax,a=n;if(a>0){t.getCorners(on);var o,s=(0,l.Z)(on);try{for(s.s();!(o=s.n()).done;){var u=o.value,d=(0,j.H)(u)-a;r=Math.min(r,d),i=Math.max(i,d)}}catch(v){s.e(v)}finally{s.f()}}else{t.getCorners(on);var c,h=(0,l.Z)(on);try{for(h.s();!(c=h.n()).done;){var f=c.value[2];r=Math.min(r,f),i=Math.max(i,f)}}catch(v){h.e(v)}finally{h.f()}}e.expandElevationRangeValues(r,i)}function un(e,t,n){var r=(0,X.g)(t),i=n>0?(0,j.H)(r)-n:r[2],a=(0,X.b)(t);e.expandElevationRangeValues(i-a,i+a)}},42757:function(e,t,n){var r,i,a;n.d(t,{Ku:function(){return i},p1:function(){return r},vV:function(){return a}}),function(e){e[e.VISIBLE_ONLY=0]="VISIBLE_ONLY",e[e.ALL=1]="ALL",e[e.QUERYABLE=2]="QUERYABLE"}(r||(r={})),function(e){e[e.EXIT=0]="EXIT",e[e.CONTINUE=1]="CONTINUE",e[e.SKIP=2]="SKIP"}(i||(i={})),function(e){e[e.Absolute=0]="Absolute",e[e.RelativeToGround=1]="RelativeToGround",e[e.OnTheGround=2]="OnTheGround"}(a||(a={}))},71323:function(e,t,n){n.r(t),n.d(t,{destroyContext:function(){return T},dracoDecompressPointCloudData:function(){return I},filterObbsForModifications:function(){return k},filterObbsForModificationsSync:function(){return j},initialize:function(){return U},interpretObbModificationResults:function(){return D},process:function(){return m},project:function(){return S},setLegacySchema:function(){return w},setModifications:function(){return x},setModificationsSync:function(){return P},test:function(){return G},transformNormals:function(){return N}});var r,i=n(29439),a=n(74165),o=n(15861),s=n(16889),l=n(78952),u=n(86372),d=n(8623),c=n(50250),h=n(11186),f=n(55107),v=n(65905);function p(e){return(0,v.V)("esri/libs/i3s/".concat(e))}var _,y,g=n(95964);function m(e){return b.apply(this,arguments)}function b(){return b=(0,o.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:return y=e.sent,n=[t.geometryBuffer],e.abrupt("return",{result:F(y,t,n),transferList:n});case 5:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}function I(e){return C.apply(this,arguments)}function C(){return C=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,l,u,d,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:if(y=e.sent,r=[t.geometryBuffer],i=t.geometryBuffer,o=i.byteLength,s=y._malloc(o),(l=new Uint8Array(y.HEAPU8.buffer,s,o)).set(new Uint8Array(i)),u=y.dracoDecompressPointCloudData(s,l.byteLength),y._free(s),!(u.error.length>0)){e.next=8;break}throw new Error("i3s.wasm: ".concat(u.error));case 8:return d=(null===(n=u.featureIds)||void 0===n?void 0:n.length)>0?u.featureIds.slice():null,c=u.positions.slice(),e.abrupt("return",(d&&r.push(d.buffer),r.push(c.buffer),{result:{positions:c,featureIds:d},transferList:r}));case 10:case"end":return e.stop()}}),e)}))),C.apply(this,arguments)}function k(e){return E.apply(this,arguments)}function E(){return E=(0,o.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:return j(t),n={buffer:t.buffer},e.abrupt("return",{result:n,transferList:[n.buffer]});case 5:case"end":return e.stop()}}),e)}))),E.apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return M=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:P(t);case 3:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}function w(e){return O.apply(this,arguments)}function O(){return O=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L();case 2:(y=e.sent).setLegacySchema(t.context,t.jsonSchema);case 4:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}function S(e){return R.apply(this,arguments)}function R(){return R=(0,o.Z)((0,a.Z)().mark((function e(t){var r,o,s,h,f,v,p,_,y,g,m,b,I,C,k,E,x,M,w,O,S,R;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.localMatrix,o=t.origin,s=t.positions,h=t.vertexSpace,f=t.localMode,v=l.Z.fromJSON(t.inSpatialReference),p=l.Z.fromJSON(t.outSpatialReference),e.next=3,Promise.all([Promise.resolve().then(n.bind(n,50628)),Promise.resolve().then(n.bind(n,79803))]);case 3:return y=e.sent,g=(0,i.Z)(y,2),m=g[0].projectBuffer,b=g[1].initializeProjection,e.next=9,b(v,p);case 9:if(m(o,v,0,I=[0,0,0],p,0,1)){e.next=12;break}throw new Error("Failed to project");case 12:if("georeferenced"!==h.type||null!=h.origin){e.next=17;break}if(_=new Float64Array(s.length),m(s,v,0,_,p,0,_.length/3)){e.next=15;break}throw new Error("Failed to project");case 15:e.next=26;break;case 17:return C="georeferenced"===h.type?d.Z.fromJSON(h):c.Z.fromJSON(h),e.next=20,Promise.all([n.e(25158),n.e(53668)]).then(n.bind(n,11700));case 20:if(k=e.sent,E=k.project,x=E({positions:s,transform:r?{localMatrix:r}:void 0,vertexSpace:C,inSpatialReference:v,outSpatialReference:p,localMode:f})){e.next=25;break}throw new Error("Failed to project");case 25:_=(0,u.mB)(x);case 26:for(M=_.length,w=I[0],O=I[1],S=I[2],R=0;R<M;R+=3)_[R]-=w,_[R+1]-=O,_[R+2]-=S;return e.abrupt("return",{result:{projected:_,original:s,projectedOrigin:I},transferList:[_.buffer,s.buffer]});case 29:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}function N(e){return A.apply(this,arguments)}function A(){return(A=(0,o.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.normalMatrix,r=t.normals,i=new Float32Array(r.length),e.abrupt("return",((0,h.t)(i,r,n),(0,s.oc)(n)&&(0,h.n)(i,i),{result:{transformed:i,original:r},transferList:[i.buffer,r.buffer]}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){Z(e)}function P(e){if(y){for(var t=e.modifications,n=y._malloc(8*t.length),r=new Float64Array(y.HEAPU8.buffer,n,t.length),i=0;i<t.length;++i)r[i]=t[i];y.setModifications(e.context,n,t.length,e.isGeodetic),y._free(n)}}function F(e,t,n){var r=t.context,i=t.globalTrafo,a=t.mbs,o=t.obbData,s=t.elevationOffset,l=t.geometryBuffer,u=t.geometryDescriptor,d=t.indexToVertexProjector,c=t.vertexToRenderProjector,h=e._malloc(l.byteLength),v=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),p=new Uint8Array(e.HEAPU8.buffer,h,l.byteLength);p.set(new Uint8Array(l));var _=new Float64Array(e.HEAPU8.buffer,v,33);V(_,[NaN,NaN,NaN]);var y=_.byteOffset+3*_.BYTES_PER_ELEMENT,g=new Float64Array(_.buffer,y);V(g,i),y+=16*_.BYTES_PER_ELEMENT,V(g=new Float64Array(_.buffer,y),a),y+=4*_.BYTES_PER_ELEMENT,o&&V(g=new Float64Array(_.buffer,y),o);var m=u,b={isDraco:!1,isLegacy:!1,color:t.layouts.some((function(e){return e.some((function(e){return"color"===e.name}))})),normal:t.needNormals&&t.layouts.some((function(e){return e.some((function(e){return"normalCompressed"===e.name}))})),uv0:t.layouts.some((function(e){return e.some((function(e){return"uv0"===e.name}))})),uvRegion:t.layouts.some((function(e){return e.some((function(e){return"uvRegion"===e.name}))})),featureIndex:m.featureIndex},I=e.process(r,!!t.obbData,h,p.byteLength,m,b,v,s,d,c,t.normalReferenceFrame);if(e._free(v),e._free(h),I.error.length>0)throw new Error("i3s.wasm: ".concat(I.error));if(I.discarded)return null;var C=I.componentOffsets.length>0?I.componentOffsets.slice():null,k=I.featureIds.length>0?I.featureIds.slice():null,E=I.anchorIds.length>0?Array.from(I.anchorIds):null,x=I.anchors.length>0?Array.from(I.anchors):null,M=I.interleavedVertedData.slice().buffer,w=I.indicesType===f.P.Int16?new Uint16Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/2).slice():new Uint32Array(I.indices.buffer,I.indices.byteOffset,I.indices.byteLength/4).slice(),O=I.positions.slice(),S=I.positionIndicesType===f.P.Int16?new Uint16Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/2).slice():new Uint32Array(I.positionIndices.buffer,I.positionIndices.byteOffset,I.positionIndices.byteLength/4).slice(),R={layout:t.layouts[0],interleavedVertexData:M,indices:w,hasColors:I.hasColors,hasModifications:I.hasModifications,positionData:{data:O,indices:S}};return k&&n.push(k.buffer),C&&n.push(C.buffer),n.push(M),n.push(w.buffer),n.push(O.buffer),n.push(S.buffer),{componentOffsets:C,featureIds:k,anchorIds:E,anchors:x,transformedGeometry:R,obb:I.obb,globalTrafo:i}}function D(e){return 0===e?g.O4.Unmodified:1===e?g.O4.PotentiallyModified:2===e?g.O4.Culled:g.O4.Unknown}function j(e){if(y){var t=e.context,n=e.buffer,r=y._malloc(n.byteLength),i=n.byteLength/Float64Array.BYTES_PER_ELEMENT,a=new Float64Array(y.HEAPU8.buffer,r,i),o=new Float64Array(n);a.set(o),y.filterOBBs(t,r,i),o.set(a),y._free(r)}}function Z(e){y&&0===y.destroy(e)&&(y=null)}function V(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function U(){return H.apply(this,arguments)}function H(){return(H=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=y,e.t0){e.next=4;break}return e.next=4,L();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return y?Promise.resolve(y):(_||(_=(r||(r=new Promise((function(e){return n.e(57552).then(n.bind(n,57552)).then((function(e){return e.i})).then((function(t){var n=(0,t.default)({locateFile:p,onRuntimeInitialized:function(){return e(n)}});delete n.then}))})).catch((function(e){throw e}))),r).then((function(e){return _=null,y=e}))),_)}var G={transform:function(e,t){return y&&F(y,e,t)},destroy:Z}},31730:function(e,t,n){n.d(t,{Wx:function(){return d},gz:function(){return l},z6:function(){return u}});var r=n(32035),i=n(12400),a=n(50628),o=n(41414),s=n(86372);function l(e,t,n){var r=(0,s.bg)(24);return function(i){var s=i.meta.featureExtents;if(null==s){s=new Float64Array(6*i.meta.featureIds.length),i.meta.featureExtents=s;for(var l=0;l<s.length;l+=6)s[l]=Number.POSITIVE_INFINITY}var d=new Float64Array(s.buffer,6*i.index*Float64Array.BYTES_PER_ELEMENT,6);return d[0]===Number.POSITIVE_INFINITY&&(u(i.index,n,i.meta.objectHandle,r,0),(0,a.projectBuffer)(r,t,0,r,e,0,8)?((0,o.t8)(d,o.G_),(0,o.G1)(d,r,0,8)):(0,o.t8)(d,o.bM)),d}}function u(e,t,n,i,a){for(var o=t.getComponentAabb(n,e,c),s=t.getObjectTransform(n),l=0;l<8;++l)h[0]=1&l?o[0]:o[3],h[1]=2&l?o[1]:o[4],h[2]=4&l?o[2]:o[5],(0,r.t)(h,h,s.rotationScale),(0,r.g)(h,h,s.position),i[a++]=h[0],i[a++]=h[1],i[a++]=h[2];return i}var d=24,c=(0,o.Ue)(),h=(0,i.Ue)()},55763:function(e,t,n){n.d(t,{u:function(){return x}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(27366),u=n(7138),d=n(91505),c=n(32718),h=n(49861),f=(n(93169),n(84936),n(69912)),v=n(29134),p=n(7025),_=n(32035),y=n(12400),g=n(51066),m=n(65156),b=n(23470),I=n(2985),C=n(4035),k=n(88153),E=n(54463),x=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._tmpEvent=new C.c,r._renderCoordsHelper=e.view.renderCoordsHelper,r._renderSR=r._renderCoordsHelper.spatialReference,r._layerElevationSource=e.layerElevationSource,r}return(0,a.Z)(n,[{key:"initialize",value:function(){this._intersector=(0,k.Z8)(this.view.state.viewingMode),this._intersector.options.store=E.eC.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}},{key:"spatialReference",get:function(){var e,t;return null===(e=this.view)||void 0===e||null===(t=e.elevationProvider)||void 0===t?void 0:t.spatialReference}},{key:"getElevation",value:function(e,t,n,r){var i=this._renderCoordsHelper,a=(0,_.s)(O,e,t,n);if(!i.toRenderCoords(a,r,a))return c.Z.getLogger(this).error("could not project point to compute elevation"),null;var o=this.layerElevationSource,s=this._intersector,l=this.intersectionHandler,u=o.fullExtent,d=null!=u&&Number.isFinite(u.xmin)&&Number.isFinite(u.xmax)&&Number.isFinite(u.ymin)&&Number.isFinite(u.ymax)&&Number.isFinite(u.zmin)&&Number.isFinite(u.zmax)?new I.r(u.zmin,u.zmax):o.elevationRange;if(null==d)return null;var h=o.elevationOffset,f=d.elevationRangeMin+h,v=d.elevationRangeMax+h,p=i.setAltitude(S,v,a),y=i.setAltitude(R,f,a);return s.reset(p,y,null),l.intersect(s,null,p,y,null,!0),s.results.min.getIntersectionPoint(a)?i.getAltitude(a):null}},{key:"getSphereElevationBounds",value:function(e,t){return(0,g.s)(e,t,w,this._renderSR),this._layerElevationSource.getElevationRange(w)}},{key:"getRootElevationBounds",value:function(){var e=this.layerElevationSource.fullExtent;return null!==e&&void 0!==e&&e.hasZ?new I.r(e.zmin,e.zmax):null}},{key:"objectsChanged",value:function(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}},{key:"objectChanged",value:function(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}},{key:"_computeObjectExtent",value:function(e,t){(0,m.cS)(t),this._expandExtent(e,t)}},{key:"_computeLayerExtent",value:function(e,t){(0,m.cS)(t);var n,i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;this._expandExtent(a,t)}}catch(o){i.e(o)}finally{i.f()}}},{key:"_expandExtent",value:function(e,t){var n=this.spatialReference;if(null!=n&&null!=e){(0,v.en)(M,e.quaternion),M[12]=e.center[0],M[13]=e.center[1],M[14]=e.center[2];for(var r=e.halfSize,i=0;i<8;++i)O[0]=1&i?r[0]:-r[0],O[1]=2&i?r[1]:-r[1],O[2]=4&i?r[2]:-r[2],(0,_.h)(O,O,M),this._renderCoordsHelper.fromRenderCoords(O,O,n),(0,m.jn)(t,O,t)}}}]),n}(d.Z.EventedMixin(u.default));(0,l._)([(0,h.Cb)({constructOnly:!0})],x.prototype,"layerElevationSource",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],x.prototype,"intersectionHandler",void 0),(0,l._)([(0,h.Cb)({constructOnly:!0})],x.prototype,"view",void 0),(0,l._)([(0,h.Cb)()],x.prototype,"spatialReference",null),x=(0,l._)([(0,f.j)("esri.views.3d.layers.i3s.LayerElevationProvider")],x);var M=(0,p.Ue)(),w=(0,b.f)(0,0,0,0),O=(0,y.Ue)(),S=(0,y.Ue)(),R=(0,y.Ue)()},23523:function(e,t,n){function r(e){return function(t){if(e.immediate)return e.immediate.schedule(t);var n="No immediate scheduler";throw console.error(n),new Error(n)}}n.d(t,{H:function(){return r}})},35160:function(e,t,n){n.d(t,{G:function(){return a}});var r=n(43144),i=n(15671),a=(0,r.Z)((function e(t,n,r,a){(0,i.Z)(this,e),this.toMapSpace=t,this.transform=n,this.obb=r,this.geometry=a}))},51594:function(e,t,n){n.d(t,{w:function(){return a}});var r=n(43144),i=n(15671),a=(0,r.Z)((function e(t,n){(0,i.Z)(this,e),this.position=t,this.rotationScale=n,this.origin=void 0}))}}]);
//# sourceMappingURL=43629.d78e86cf.chunk.js.map