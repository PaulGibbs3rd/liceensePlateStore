"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[11219],{38365:function(e,t,n){n.d(t,{O:function(){return y},a:function(){return m},b:function(){return g}});var r,i=n(30168),a=n(43144),o=n(15671),s=n(60136),u=n(29388),l=n(54134),c=n(24967),d=n(58406),h=n(99339),f=n(98634),v=n(64201),p=n(19253),y=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).overlayIndex=l.fu.INNER,e.opacity=1,e}return(0,a.Z)(n)}(f.K);function g(){var e=new v.kG;return e.include(c.k),e.fragment.uniforms.add(new p.A("tex",(function(e){return e.texture}))),e.fragment.uniforms.add(new h._("overlayIdx",(function(e){return e.overlayIndex}))),e.fragment.uniforms.add(new d.p("opacity",(function(e){return e.opacity}))),e.fragment.code.add((0,f.H)(r||(r=(0,i.Z)(["void main() {\nvec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\nfragColor = texture(tex, overlayUV) * opacity;\n}"])))),e}var m=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:y,build:g},Symbol.toStringTag,{value:"Module"}))},98186:function(e,t,n){n.d(t,{R:function(){return pe},b:function(){return ve},r:function(){return fe}});var r,i,a,o,s,u,l,c,d,h,f,v,p,y,g,m,_,w,C,T,x,b,S,R,O,A,D,E,M,k,I,Z,P,L,N,U,F,H,j,z,V,G,W=n(30168),B=n(37081),q=n(33280),J=n(14801),Y=n(48353),K=n(60300),Q=n(40526),X=n(15226),$=n(85586),ee=n(26461),te=n(116),ne=n(41012),re=n(82999),ie=n(95276),ae=n(58406),oe=n(98634),se=n(8654),ue=n(64201),le=n(25920),ce=n(4760),de=n(33720),he=n(737),fe=1;function ve(e){var t=new ue.kG,n=t.attributes,ve=t.varyings,pe=t.constants,ye=t.vertex,ge=t.fragment;t.include($.e),t.include(Y.U,e),t.include(K.q,e);var me=e.applyMarkerOffset&&!e.draped;me&&(ye.uniforms.add(new ae.p("markerScale",(function(e){return e.markerScale}))),t.include(Q.Q,{space:de.I9.World,draped:!1})),t.include(J.R,e),(0,ne.Sv)(ye,e),ye.uniforms.add(new se.g("inverseProjectionMatrix",(function(e,t){return t.camera.inverseProjectionMatrix})),new re.A("nearFar",(function(e,t){return t.camera.nearFar})),new ae.p("miterLimit",(function(e){return"miter"!==e.join?0:e.miterLimit})),new ie.N("viewport",(function(e,t){return t.camera.fullViewport}))),ye.constants.add("LARGE_HALF_FLOAT","float",65500),n.add(ce.T.POSITION,"vec3"),n.add(ce.T.PREVPOSITION,"vec3"),n.add(ce.T.NEXTPOSITION,"vec3"),n.add(ce.T.SUBDIVISIONFACTOR,"float"),n.add(ce.T.UV0,"vec2"),ve.add("vColor","vec4"),ve.add("vpos","vec3"),ve.add("vLineDistance","float"),ve.add("vLineWidth","float");var _e=e.multipassEnabled&&e.output===B.H_.Color;_e&&ve.add("depth","float");var we=e.stippleEnabled;we&&ve.add("vLineSizeInv","float"),pe.add("aaWidth","float",e.stippleEnabled?0:1);var Ce=e.capType===he.R.ROUND,Te=e.stippleEnabled&&Ce,xe=e.falloffEnabled||Te;xe&&ve.add("vLineDistanceNorm","float"),Ce&&(ve.add("vSegmentSDF","float"),ve.add("vReverseSegmentSDF","float")),ye.code.add((0,oe.H)(r||(r=(0,W.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),ye.code.add((0,oe.H)(i||(i=(0,W.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),ye.code.add((0,oe.H)(a||(a=(0,W.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),_e?"depth = pos.z;":"")),(0,ne.ZI)(ye),ye.code.add((0,oe.H)(o||(o=(0,W.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n      float lineSize = getSize();\n\n      if (lineSize < 1.0) {\n        coverage = lineSize; // convert sub-pixel coverage to alpha\n        lineSize = 1.0;\n      }\n      lineSize += aaWidth;\n\n      float lineWidth = lineSize * pixelRatio;\n      vLineWidth = lineWidth;\n      ","\n\n      vec4 pos  = view * vec4(position, 1.0);\n      vec4 prev = view * vec4(prevPosition, 1.0);\n      vec4 next = view * vec4(nextPosition, 1.0);\n  "])),we?(0,oe.H)(s||(s=(0,W.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),me&&ye.code.add((0,oe.H)(u||(u=(0,W.Z)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),ye.code.add((0,oe.H)(l||(l=(0,W.Z)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||Ce)&&ye.code.add((0,oe.H)(c||(c=(0,W.Z)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),Ce?(0,oe.H)(d||(d=(0,W.Z)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),ye.code.add((0,oe.H)(h||(h=(0,W.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?ye.code.add((0,oe.H)(f||(f=(0,W.Z)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,oe.H)(v||(v=(0,W.Z)(["min(1.0, subdivisionFactor * ",")"])),oe.H.float((fe+2)/(fe+1))):(0,oe.H)(p||(p=(0,W.Z)(["subdivisionFactor"]))))):ye.code.add((0,oe.H)(y||(y=(0,W.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));var be=e.capType!==he.R.BUTT;return ye.code.add((0,oe.H)(g||(g=(0,W.Z)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),be?(0,oe.H)(m||(m=(0,W.Z)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),ye.code.add((0,oe.H)(_||(_=(0,W.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n    float lineDistNorm = sign(uv0.y) * pos.w;\n\n    vLineDistance =  lineWidth * lineDistNorm;\n    ","\n\n    pos.xy += dpos;\n  "])),xe?(0,oe.H)(w||(w=(0,W.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"")),Ce&&ye.code.add((0,oe.H)(C||(C=(0,W.Z)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?ye.uniforms.add(new ae.p("worldToScreenRatio",(function(e,t){return 1/t.screenToPCSRatio}))):ye.code.add((0,oe.H)(T||(T=(0,W.Z)(["vec3 segmentCenter = mix((nextPosition + position) * 0.5, (position + prevPosition) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),ye.code.add((0,oe.H)(x||(x=(0,W.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(nextPosition - position, position - prevPosition, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?ye.code.add((0,oe.H)(b||(b=(0,W.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):ye.code.add((0,oe.H)(S||(S=(0,W.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),ye.uniforms.add(new ae.p("stipplePatternPixelSize",(function(e){return(0,K.C)(e)}))),ye.code.add((0,oe.H)(R||(R=(0,W.Z)(["float patternLength = lineSize * stipplePatternPixelSize;\nvStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\nvStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\nif (segmentLengthScreenDouble >= 0.001) {\nvec2 stippleDisplacement = pos.xy - segmentOrigin;\nfloat stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\nvStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n}\nvStippleDistanceLimits *= pos.w;\nvStippleDistance *= pos.w;\nvStippleDistanceLimits = isJoin ?\nvStippleDistanceLimits :\nisStartVertex ?\nvec2(-1e34, vStippleDistanceLimits.y) :\nvec2(vStippleDistanceLimits.x, 1e34);"]))))),ye.code.add((0,oe.H)(O||(O=(0,W.Z)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),_e&&t.include(X.l,e),t.include(q.f5,e),ge.include(te.Y),ge.code.add((0,oe.H)(A||(A=(0,W.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),_e?"terrainDepthTest(depth);":"")),e.wireframe?ge.code.add((0,oe.H)(D||(D=(0,W.Z)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(Ce&&ge.code.add((0,oe.H)(E||(E=(0,W.Z)(["\n        float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n        vec2 fragmentPosition = vec2(\n          min(sdf, 0.0),\n          vLineDistance\n        ) * gl_FragCoord.w;\n\n        float fragmentRadius = length(fragmentPosition);\n        float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n        float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n        if (capCoverage < ",") {\n          discard;\n        }\n      "])),oe.H.float(ee.b))),Te?ge.code.add((0,oe.H)(M||(M=(0,W.Z)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),oe.H.float(ee.b))):ge.code.add((0,oe.H)(k||(k=(0,W.Z)(["float stippleAlpha = getStippleAlpha();"])))),e.output!==B.H_.ObjectAndLayerIdColor&&ge.code.add((0,oe.H)(I||(I=(0,W.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),ge.uniforms.add(new ie.N("intrinsicColor",(function(e){return e.color}))),ge.code.add((0,oe.H)(Z||(Z=(0,W.Z)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(ge.uniforms.add(new ie.N("innerColor",(function(e){var t;return null!==(t=e.innerColor)&&void 0!==t?t:e.color})),new ae.p("innerWidth",(function(e,t){return e.innerWidth*t.camera.pixelRatio}))),ge.code.add((0,oe.H)(P||(P=(0,W.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),ge.code.add((0,oe.H)(L||(L=(0,W.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(ge.uniforms.add(new ae.p("falloff",(function(e){return e.falloff}))),ge.code.add((0,oe.H)(N||(N=(0,W.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"]))))),e.stippleEnabled||ge.code.add((0,oe.H)(U||(U=(0,W.Z)(["float featherStartDistance = max(vLineWidth - 2.0, 0.0);\nfloat value = abs(vLineDistance) * gl_FragCoord.w;\nfloat feather = (value - featherStartDistance) / (vLineWidth - featherStartDistance);\nfinalColor.a *= 1.0 - clamp(feather, 0.0, 1.0);"]))))),e.transparencyPassType===le.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),ge.code.add((0,oe.H)(F||(F=(0,W.Z)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===B.H_.ObjectAndLayerIdColor?(0,oe.H)(H||(H=(0,W.Z)(["finalColor.a = 1.0;"]))):"",oe.H.float(ee.b),e.output===B.H_.Color?(0,oe.H)(j||(j=(0,W.Z)(["fragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===B.H_.Color&&e.transparencyPassType===le.A.ColorAlpha?(0,oe.H)(z||(z=(0,W.Z)(["\n            fragColor = premultiplyAlpha(fragColor);\n            fragAlpha = fragColor.a;"]))):"",e.output===B.H_.Highlight?(0,oe.H)(V||(V=(0,W.Z)(["fragColor = vec4(1.0);"]))):"",e.output===B.H_.ObjectAndLayerIdColor?(0,oe.H)(G||(G=(0,W.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}var pe=Object.freeze(Object.defineProperty({__proto__:null,build:ve,ribbonlineNumRoundJoinSubdivisions:fe},Symbol.toStringTag,{value:"Module"}))},61863:function(e,t,n){n.d(t,{T:function(){return p},a:function(){return g},b:function(){return y}});var r,i=n(30168),a=n(43144),o=n(15671),s=n(60136),u=n(29388),l=n(12400),c=n(24967),d=n(49450),h=n(98634),f=n(64201),v=n(19253),p=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).color=(0,l.al)(1,1,1),e}return(0,a.Z)(n)}(h.K);function y(){var e=new f.kG;return e.include(c.k),e.fragment.uniforms.add(new v.A("tex",(function(e){return e.texture})),new d.J("uColor",(function(e){return e.color}))),e.fragment.code.add((0,h.H)(r||(r=(0,i.Z)(["void main() {\nvec4 texColor = texture(tex, uv);\nfragColor = texColor * vec4(uColor, 1.0);\n}"])))),e}var g=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:p,build:y},Symbol.toStringTag,{value:"Module"}))},76861:function(e,t,n){n.d(t,{N:function(){return o}});var r=n(15671),i=n(43144),a=n(18759),o=function(){function e(t,n){(0,r.Z)(this,e),this._cache=t(n,(function(e,t,n){switch(t){case a.lN.ALL:return e.forEach((function(e){return e.dispose()})),0;case a.lN.SOME:var r=e.shift();return r&&(n-=Math.round(r.usedMemory),r.dispose()),n}}))}return(0,i.Z)(e,[{key:"hitrate",value:function(){return this._cache.hitRate}},{key:"destroy",value:function(){this._cache.destroy()}},{key:"clear",value:function(){this._cache.clear()}},{key:"getSize",value:function(e){return this._cache.getSize(e)}},{key:"pop",value:function(e){var t=this._cache.peek(e);if(t){var n=t.pop();if(t.length>0){if(n){var r=this._cache.getSize(e)-Math.round(n.usedMemory);this._cache.updateSize(e,t,r)}}else this._cache.pop(e);return n}}},{key:"put",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.Jv,r=this._cache.peek(e);if(r){r.push(t);var i=this._cache.getSize(e)+Math.round(t.usedMemory);this._cache.updateSize(e,r,i)}else this._cache.put(e,[t],t.usedMemory,n)}}]),e}()},46228:function(e,t,n){n.d(t,{I:function(){return i},v:function(){return a}});var r=n(16889);function i(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(0,r.uZ)(e,0,u),a=0;a<4;a++)t[n+a]=Math.floor(256*l(i*o[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=0;r<4;r++)n+=e[t+r]*s[r];return n}var o=[1,256,65536,16777216],s=[1/256,1/65536,1/16777216,1/4294967296],u=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},86372:function(e,t,n){n.d(t,{JK:function(){return s},QZ:function(){return a},Rq:function(){return o},bg:function(){return i},mB:function(){return u}});var r=n(18722);function i(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=r.c8?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function a(e){return((0,r.kJ)(e)?e.length:e.byteLength/8)<=r.c8?Array.from(e):new Float64Array(e)}function o(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}function s(e,t){for(var n=0;n<t.length;++n)e[n]=t[n];return e}function u(e){return Array.isArray(e)?new Float64Array(e):e}},45238:function(e,t,n){n.d(t,{EU:function(){return g},Ue:function(){return c},WH:function(){return m},ZZ:function(){return y},q_:function(){return f},qw:function(){return p},uT:function(){return d},up:function(){return w},zk:function(){return h}});var r=n(16889),i=n(29134),a=n(68700),o=n(50894),s=n(32035),u=n(12400),l=n(86361);function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w;return[e[0],e[1],e[2],e[3]]}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,s.c)(n,e),n[3]=t,n}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,l.Ue)();return(0,s.b)(n,e,t),(0,s.n)(n,n),n[3]=-(0,s.d)(e,t),n}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c(),n=(0,i.j6)(C,e);return _(t,(0,r.BV)((0,a.Bh)(t,n))),t}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c();return(0,a.yY)(C,e,m(e)),(0,a.yY)(T,t,m(t)),(0,a.Jp)(C,T,C),_(n,(0,r.BV)((0,a.Bh)(n,C)))}function p(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c();return d(u.E9,e,x),d(u.IO,t,b),d(u.eG,n,S),v(x,b,x),v(x,S,r),r}function y(e){return e}function g(e){return e[3]}function m(e){return(0,r.Vl)(e[3])}function _(e,t){return e[3]=t,e}var w=[0,0,1,0],C=(0,o.Ue)(),T=(0,o.Ue)(),x=(c(),c()),b=c(),S=c()},37818:function(e,t,n){n.d(t,{D:function(){return m},Ou:function(){return c},WG:function(){return g},kB:function(){return f},mW:function(){return h}});var r=n(37762),i=(n(59486),n(52639)),a=(n(93169),n(84652)),o=n(18722),s=n(77981),u=n(55946),l=n(78952);function c(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function h(e,t){return e?"declaredClass"in e?e:new i.Z({layer:t,sourceLayer:t,visible:e.visible,symbol:(0,a.d9)(e.symbol),attributes:(0,a.d9)(e.attributes),geometry:f(e.geometry)}):null}function f(e){return null==e?null:c(e)?e:(0,s.im)(function(e){var t=e.spatialReference,n=t.wkid,r=t.wkt,i=t.wkt2,a=t.latestWkid,o={wkid:n,wkt:r,wkt2:i,latestWkid:a};switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:o};case"polygon":var s=e.rings,u=e.hasZ,l=e.hasM;return{rings:v(s),hasZ:u,hasM:l,spatialReference:o};case"polyline":var c=e.paths,d=e.hasZ,h=e.hasM;return{paths:v(c),hasZ:d,hasM:h,spatialReference:o};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:o};case"multipoint":var f=e.points,g=e.hasZ,m=e.hasM;return{points:y(f)?p(f):f,hasZ:g,hasM:m,spatialReference:o};default:return}}(e))}function v(e){return function(e){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(0!==i.length)return y(i)}}catch(a){n.e(a)}finally{n.f()}return!1}(e)?e.map((function(e){return p(e)})):e}function p(e){return e.map((function(e){return Array.from(e)}))}function y(e){return e.length>0&&((0,o.xZ)(e[0])||(0,o.fS)(e[0]))}function g(e,t){if(!e)return null;var n;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?((n=t).x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=void 0,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,u.T)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}function m(e){var t={wkid:e.wkid,wkt:e.wkt,wkt2:e.wkt2,latestWkid:e.latestWkid};return l.Z.fromJSON(t)}},46208:function(e,t,n){var r,i;function a(e){return null!=(null===e||void 0===e?void 0:e.cubeMap)}function o(e){return null!=e&&!e.running}n.d(t,{Ck:function(){return a},WU:function(){return o},jL:function(){return r},uz:function(){return i}}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(r||(r={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(i||(i={}))},5573:function(e,t,n){n.d(t,{Kf:function(){return g},lL:function(){return r}});var r,i,a=n(15671),o=n(43144),s=n(16889),u=n(29134),l=n(7025),c=n(32035),d=n(12400),h=n(45238),f=n(22186),v=n(46208),p=n(50902),y=n(75248),g=function(){function e(){(0,a.Z)(this,e),this.readChannels=v.uz.RG,this.renderingStage=v.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,d.Ue)(),this.parallax=new m,this.parallaxNew=new m,this.pointOnGround=(0,d.Ue)(),this.fadeMode=r.HIDE,this.fadeFactor=0,this.opacity=0}return(0,o.Z)(e,[{key:"updateParallax",value:function(e){var t=this.parallax,n=(0,c.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-f.sv.radius*f.sv.radius,0))/n,(0,h.zk)(_,t.anchorPointClouds,w),(0,u.U1)(t.transform,l.Wd,w[3],(0,h.ZZ)(w)),this.fadeMode===r.CROSS_FADE){var i=this.parallaxNew;(0,h.zk)(_,i.anchorPointClouds,w),(0,u.U1)(i.transform,l.Wd,w[3],(0,h.ZZ)(w))}}},{key:"updateFading",value:function(e,t,n,r){this.isFading&&this._advanceFading(n,r),this._evaluateFading(e,t,n)}},{key:"_evaluateFading",value:function(e,t,n){var i=e.relativeElevation,a=this._calculateDistanceToAnchorPoint(e);if((i>1.7*p.nq||i<-p.nq||a>S)&&this.opacity>0)this._setFade(r.HIDE,n);else if(!this.isFading)if((i>p.nq||i<-.35*p.nq||a>b)&&this.opacity>0)this._setFade(r.FADE_OUT,n);else if(i<=p.nq&&i>=-.35*p.nq&&t===y.n.IDLE&&(0,v.WU)(this.data)){if(0===this.opacity)return void this._setFade(r.FADE_IN,n);(a>x||this.renderingStage===v.jL.FADING)&&this._setFade(r.CROSS_FADE,n)}}},{key:"_advanceFading",value:function(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}},{key:"_advanceFadingFactorAndOpacity",value:function(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,s.uZ)((e-this.startTime)/(T*t),0,1):1,this.fadeMode===r.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===r.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===r.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===r.FADE_OUT&&(this.opacity=0),this.fadeMode===r.FADE_IN&&(this.opacity=1),this.fadeMode===r.CROSS_FADE&&(this.opacity=1),this.fadeMode=r.NONE}},{key:"_switchReadChannels",value:function(){var e=this.fadeMode===r.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===r.FADE_IN&&0===this.fadeFactor;this.renderingStage===v.jL.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=v.jL.FINISHED)}},{key:"_calculateDistanceToAnchorPoint",value:function(e){return(0,c.n)(this.pointOnGround,e.eye),(0,c.j)(this.pointOnGround,this.pointOnGround,f.sv.radius),(0,c.l)((0,c.f)(C,this.parallax.anchorPointClouds,this.pointOnGround))}},{key:"_updateAnchorPoint",value:function(){this.fadeMode===r.CROSS_FADE&&(0===this.fadeFactor&&(0,c.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,c.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===r.FADE_IN&&0===this.fadeFactor&&(0,c.c)(this.parallax.anchorPointClouds,this.pointOnGround)}},{key:"_setFade",value:function(e,t){switch(e){case r.HIDE:this.opacity=0;break;case r.FADE_OUT:this.opacity=1;break;case r.FADE_IN:this.opacity=0;break;case r.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}},{key:"isFading",get:function(){return this.fadeMode===r.FADE_OUT||this.fadeMode===r.FADE_IN||this.fadeMode===r.CROSS_FADE}}]),e}();(i=r||(r={}))[i.NONE=0]="NONE",i[i.HIDE=1]="HIDE",i[i.FADE_OUT=2]="FADE_OUT",i[i.FADE_IN=3]="FADE_IN",i[i.CROSS_FADE=4]="CROSS_FADE";var m=(0,o.Z)((function e(){(0,a.Z)(this,e),this.anchorPointClouds=(0,d.Ue)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,l.Ue)()})),_=(0,d.al)(0,0,1),w=(0,h.Ue)(),C=(0,d.Ue)(),T=1.25,x=34e3,b=64e3,S=2e5},90868:function(e,t,n){n.d(t,{Z:function(){return v}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(46784),c=n(49861),d=(n(93169),n(32718),n(84936),n(27135)),h=n(69912),f=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="cloudy",r.cloudCover=.5,r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({cloudCover:this.cloudCover})}}]),n}(l.wq);(0,u._)([(0,d.J)({cloudy:"cloudy"})],f.prototype,"type",void 0),(0,u._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"cloudCover",void 0);var v=f=r=(0,u._)([(0,h.j)("esri.views.3d.environment.CloudyWeather")],f)},89110:function(e,t,n){n.d(t,{Z:function(){return v}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(46784),c=n(49861),d=(n(93169),n(32718),n(84936),n(27135)),h=n(69912),f=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="foggy",r.fogStrength=.5,r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({fogStrength:this.fogStrength})}}]),n}(l.wq);(0,u._)([(0,d.J)({foggy:"foggy"})],f.prototype,"type",void 0),(0,u._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"fogStrength",void 0);var v=f=r=(0,u._)([(0,h.j)("esri.views.3d.environment.FoggyWeather")],f)},61052:function(e,t,n){n.d(t,{Z:function(){return v}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(46784),c=n(49861),d=(n(93169),n(32718),n(84936),n(27135)),h=n(69912),f=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="rainy",r.cloudCover=.5,r.precipitation=.5,r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({cloudCover:this.cloudCover,precipitation:this.precipitation})}}]),n}(l.wq);(0,u._)([(0,d.J)({rainy:"rainy"})],f.prototype,"type",void 0),(0,u._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"cloudCover",void 0),(0,u._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"precipitation",void 0);var v=f=r=(0,u._)([(0,h.j)("esri.views.3d.environment.RainyWeather")],f)},37063:function(e,t,n){n.d(t,{Z:function(){return v}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(46784),c=n(49861),d=(n(93169),n(32718),n(84936),n(27135)),h=n(69912),f=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="snowy",r.cloudCover=.5,r.precipitation=.5,r.snowCover="disabled",r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}}]),n}(l.wq);(0,u._)([(0,d.J)({snowy:"snowy"})],f.prototype,"type",void 0),(0,u._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"cloudCover",void 0),(0,u._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"precipitation",void 0),(0,u._)([(0,c.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],f.prototype,"snowCover",void 0);var v=f=r=(0,u._)([(0,h.j)("esri.views.3d.environment.SnowyWeather")],f)},3389:function(e,t,n){n.d(t,{Z:function(){return v}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(46784),c=n(49861),d=(n(93169),n(32718),n(84936),n(27135)),h=n(69912),f=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="sunny",r.cloudCover=.5,r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({cloudCover:this.cloudCover})}}]),n}(l.wq);(0,u._)([(0,d.J)({sunny:"sunny"})],f.prototype,"type",void 0),(0,u._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],f.prototype,"cloudCover",void 0);var v=f=r=(0,u._)([(0,h.j)("esri.views.3d.environment.SunnyWeather")],f)},50902:function(e,t,n){n.d(t,{$T:function(){return h},Hr:function(){return u},T$:function(){return l},b8:function(){return c},nq:function(){return d}});var r=n(90868),i=n(89110),a=n(61052),o=n(37063),s=n(3389),u={key:"type",base:s.Z,typeMap:{sunny:s.Z,cloudy:r.Z,rainy:a.Z,snowy:o.Z,foggy:i.Z}},l=Object.keys(u.typeMap);function c(e,t){return!!l.includes(e)||(t.error('"'.concat(e,'" is not a valid weather type')),!1)}var d=1e4,h=1e5},78935:function(e,t,n){n.d(t,{o:function(){return s}});var r=n(15671),i=n(43144),a=n(88152),o=n(8821),s=function(){function e(){(0,r.Z)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return(0,i.Z)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=(0,a.Z7)(e)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,o.ht)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){var t;this.mode=e.mode,this.unit=(0,a.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=null!==(t=e.offset)&&void 0!==t?t:0}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,n){if(null!=e){var r=null===e||void 0===e?void 0:e.arcade;r&&null!=t&&null!=n?(this._featureExpressionInfoContext=(0,o.d9)(e),(0,o.aO)(this._featureExpressionInfoContext,(0,o.Tz)(r.modules,t,n))):this._featureExpressionInfoContext=e}else this._featureExpressionInfoContext=null}}],[{key:"fromElevationInfo",value:function(t){var n=new e;return null!=t&&n.setFromElevationInfo(t),n}}]),e}()},69691:function(e,t,n){n.d(t,{B5:function(){return m},GC:function(){return y},Lm:function(){return x},Xf:function(){return g},bD:function(){return _},lO:function(){return C},qZ:function(){return v},rR:function(){return f},ub:function(){return w},w7:function(){return p}});var r=n(43144),i=n(15671),a=n(29134),o=n(7025),s=n(12400),u=n(37998),l=n(50628),c=n(81020),d=n(77648),h=n(4760);function f(e,t,n,r,i,a,o,s,u,c,d){var h,f,v=b[d.mode],p=0;if((0,l.projectBuffer)(e,t,n,r,u.spatialReference,i,s))return v.requiresAlignment(d)?(p=v.applyElevationAlignmentBuffer(r,i,a,o,s,u,c,d),h=a,f=o):(h=r,f=i),(0,l.projectBuffer)(h,u.spatialReference,f,a,c.spatialReference,o,s)?p:void 0}function v(e,t,n,r,i){var a=((0,c.f)(e)?e.z:(0,d.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":var o,s=null!==(o=(0,d.KO)(t,e,"ground"))&&void 0!==o?o:0;return i.verticalDistanceToGround=0,i.sampledElevation=s,void(i.z=s);case"relative-to-ground":var u,l=null!==(u=(0,d.KO)(t,e,"ground"))&&void 0!==u?u:0,h=n.geometryZWithOffset(a,r);return i.verticalDistanceToGround=h,i.sampledElevation=l,void(i.z=h+l);case"relative-to-scene":var f,v=null!==(f=(0,d.KO)(t,e,"scene"))&&void 0!==f?f:0,p=n.geometryZWithOffset(a,r);return i.verticalDistanceToGround=p,i.sampledElevation=v,void(i.z=p+v);case"absolute-height":var y,g=n.geometryZWithOffset(a,r),m=null!==(y=(0,d.KO)(t,e,"ground"))&&void 0!==y?y:0;return i.verticalDistanceToGround=g-m,i.sampledElevation=m,void(i.z=g);default:return void(i.z=0)}}function p(e,t,n,r){return v(e,t,n,r,R),R.z}function y(e,t,n){return"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?null==t||null==n?e.definedChanged:C.UPDATE:e.onTheGroundChanged}function g(e){return"relative-to-ground"===e||"relative-to-scene"===e}function m(e){return"absolute-height"!==e}function _(e,t,n,r,i){v(t,n,i,r,R),w(e,R.verticalDistanceToGround);var o=R.sampledElevation,s=(0,a.JG)(S,e.transformation);return O[0]=t.x,O[1]=t.y,O[2]=R.z,(0,u.B)(t.spatialReference,O,s,r.spatialReference)?e.transformation=s:console.warn("Could not locate symbol object properly, it might be misplaced"),o}function w(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].getMutableAttribute(h.T.CENTEROFFSETANDDISTANCE);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttributeUpdated(e.geometries[n],h.T.CENTEROFFSETANDDISTANCE))}}var C,T,x=(0,r.Z)((function e(){(0,i.Z)(this,e),this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}));(T=C||(C={}))[T.NONE=0]="NONE",T[T.UPDATE=1]="UPDATE",T[T.RECREATE=2]="RECREATE";var b={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var u=s.calculateOffsetRenderUnits(o),l=s.featureExpressionInfoContext;t*=3,r*=3;for(var c=0;c<i;++c){var d=e[t],h=e[t+1],f=e[t+2];n[r]=d,n[r+1]=h,n[r+2]=null==l?f+u:u,t+=3,r+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a){var o=0,s=a.spatialReference;t*=3,r*=3;for(var u=0;u<i;++u){var l,c=e[t],d=e[t+1],h=e[t+2],f=null!==(l=a.getElevation(c,d,h,s,"ground"))&&void 0!==l?l:0;o+=f,n[r]=c,n[r+1]=d,n[r+2]=f,t+=3,r+=3}return o/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var u=0,l=s.calculateOffsetRenderUnits(o),c=s.featureExpressionInfoContext,d=a.spatialReference;t*=3,r*=3;for(var h=0;h<i;++h){var f,v=e[t],p=e[t+1],y=e[t+2],g=null!==(f=a.getElevation(v,p,y,d,"ground"))&&void 0!==f?f:0;u+=g,n[r]=v,n[r+1]=p,n[r+2]=null==c?y+g+l:g+l,t+=3,r+=3}return u/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var u=0,l=s.calculateOffsetRenderUnits(o),c=s.featureExpressionInfoContext,d=a.spatialReference;t*=3,r*=3;for(var h=0;h<i;++h){var f,v=e[t],p=e[t+1],y=e[t+2],g=null!==(f=a.getElevation(v,p,y,d,"scene"))&&void 0!==f?f:0;u+=g,n[r]=v,n[r+1]=p,n[r+2]=null==c?y+g+l:g+l,t+=3,r+=3}return u/i},requiresAlignment:function(){return!0}}},S=(0,o.Ue)(),R=new x,O=(0,s.Ue)()},8821:function(e,t,n){n.d(t,{O$:function(){return g},Tz:function(){return f},WI:function(){return y},aO:function(){return v},bw:function(){return c},d9:function(){return l},ht:function(){return p},kr:function(){return d}});var r=n(74165),i=n(15861),a=n(32718),o=n(66978),s=n(37818),u=n(819);function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e){var t=null===e||void 0===e?void 0:e.expression;if("string"==typeof t){var n=_(t);if(null!=n)return{cachedResult:n}}return null}function d(e,t,n,r){return h.apply(this,arguments)}function h(){return h=(0,i.Z)((0,r.Z)().mark((function e(t,n,i,a){var s,l,c,d,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(s=null===t||void 0===t?void 0:t.expression)){e.next=3;break}return e.abrupt("return",null);case 3:if(null==(l=_(s))){e.next=6;break}return e.abrupt("return",{cachedResult:l});case 6:return e.next=8,(0,u.LC)();case 8:return c=e.sent,(0,o.k_)(i),d=c.arcadeUtils,h=d.createSyntaxTree(s),e.abrupt("return",d.dependsOnView(h)?(null!=a&&a.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:d.createFunction(h),context:d.createExecContext(null,{sr:n}),modules:c}});case 12:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function f(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function v(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void a.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils").errorOncePerTick("Arcade support required but not provided");var n=t;n._geometry&&(n._geometry=(0,s.kB)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(m(e))return e.cachedResult;var t=e.arcade,n=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function y(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null===e||void 0===e?void 0:e.featureExpressionInfo,a=null===(t=i)||void 0===t?void 0:t.expression;return r||"0"===a||(i=null),null!==(n=i)&&void 0!==n?n:null}var g={cachedResult:0};function m(e){return null!=e.cachedResult}function _(e){return"0"===e?0:null}},26279:function(e,t,n){var r,i,a;n.d(t,{Lw:function(){return r},al:function(){return a},eZ:function(){return i}}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(i||(i={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(a||(a={}))},2522:function(e,t,n){n.d(t,{LM:function(){return h},M_:function(){return c},OJ:function(){return s},qO:function(){return u},zA:function(){return d}});var r=n(67794),i=n(8548),a=n(57808),o=n(52311),s=64,u=s/2,l=u/5,c=s/l,d=.25;function h(e,t){var n=(0,r.aJ)(e,s,u,l),c=new o.X;return c.internalFormat=i.VI.RGBA,c.width=s,c.height=s,c.wrapMode=i.e8.CLAMP_TO_EDGE,new a.x(t,c,n)}},67794:function(e,t,n){n.d(t,{Rg:function(){return u},aJ:function(){return c},cU:function(){return l},hy:function(){return s},wm:function(){return o}});n(93169);var r=n(46228),i=n(1487),a=n(8548),o=128,s=.5;function u(e){return"cross"===e||"x"===e}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=c(e,t,n,r);return new i.x(u,{mipmap:!1,wrap:{s:a.e8.CLAMP_TO_EDGE,t:a.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return d(t,n);case"square":return h(t,n);case"cross":return v(t,n,r);case"x":return p(t,n,r);case"kite":return f(t,n);case"triangle":return y(t,n);case"arrow":return g(t,n)}}function d(e,t){var n=e/2-.5;return T(e,w(n,n,t/2))}function h(e,t){return m(e,t,!1)}function f(e,t){return m(e,t,!0)}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _(e,t,!1,n)}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _(e,t,!0,n)}function y(e,t){return T(e,C(e/2,t,t/2))}function g(e,t){var n=t,r=t/2,i=e/2,a=.8*n,o=w(i,(e-t)/2-a,Math.sqrt(a*a+r*r)),s=C(i,n,r);return T(e,(function(e,t){return Math.max(s(e,t),-o(e,t))}))}function m(e,t,n){return n&&(t/=Math.SQRT2),T(e,(function(r,i){var a=r-.5*e+.25,o=.5*e-i-.75;if(n){var s=(a+o)/Math.SQRT2;o=(o-a)/Math.SQRT2,a=s}return Math.max(Math.abs(a),Math.abs(o))-.5*t}))}function _(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=r,n&&(t*=Math.SQRT2);var i=.5*t;return T(e,(function(t,a){var o,s=t-.5*e,u=.5*e-a-1;if(n){var l=(s+u)/Math.SQRT2;u=(u-s)/Math.SQRT2,s=l}return o=(s=Math.abs(s))>(u=Math.abs(u))?s>i?Math.sqrt((s-i)*(s-i)+u*u):u:u>i?Math.sqrt(s*s+(u-i)*(u-i)):s,o-=r/2}))}function w(e,t,n){return function(r,i){var a=r-e,o=i-t;return Math.sqrt(a*a+o*o)-n}}function C(e,t,n){var r=Math.sqrt(t*t+n*n);return function(i,a){var o=Math.abs(i-e)-n,s=a-e+t/2+.75,u=(t*o+n*s)/r,l=-s;return Math.max(u,l)}}function T(e,t){for(var n=new Uint8Array(4*e*e),i=0;i<e;i++)for(var a=0;a<e;a++){var o=a+e*i,s=t(a,i);s=s/e+.5,(0,r.I)(s,n,4*o)}return n}},92015:function(e,t,n){var r;n.d(t,{D:function(){return r}}),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(r||(r={}))},19265:function(e,t,n){n.d(t,{CB:function(){return fe},gi:function(){return ye},Qi:function(){return ge}});var r=n(74165),i=n(15861),a=n(29439),o=n(1413),s=n(37762),u=n(15671),l=n(43144),c=n(60136),d=n(29388),h=n(27366),f=n(91505),v=n(93169),p=n(77427),y=n(92026),g=n(27546),m=n(94172),_=n(92377),w=n(49861),C=(n(32718),n(84936),n(69912)),T=n(29134),x=n(32035),b=n(12400),S=n(50951),R=n(26279),O=n(94463),A=n(54134),D=n(65156),E=n(61403),M=function(){function e(){(0,u.Z)(this,e),this._extent=(0,D.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,E.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new k}return(0,l.Z)(e,[{key:"extent",get:function(){return this._extent}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this._extent[0]-t<=e.min){var n=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,D.cv)(this._extent,e.range,0,n)}if(this._extent[2]+t>=e.max){var r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,D.cv)(this._extent,-e.range,0,r)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,(0,D.JG)(this.canvasGeometries.extents[0],this._extent)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}]),e}(),k=(0,l.Z)((function e(){(0,u.Z)(this,e),this.extents=[(0,D.Ue)(),(0,D.Ue)(),(0,D.Ue)()],this.numViews=0})),I=n(92015),Z=function(){function e(t,n,r){(0,u.Z)(this,e),this._fbos=t,this._format=n,this._name=r}return(0,l.Z)(e,[{key:"valid",get:function(){var e;return null!=(null===(e=this._handle)||void 0===e?void 0:e.getTexture())}},{key:"dispose",value:function(){this._handle=(0,y.RY)(this._handle)}},{key:"texture",get:function(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}},{key:"bind",value:function(e,t,n){var r,i,a,o,s,u;this._handle&&(null===(r=this._handle.fbo)||void 0===r?void 0:r.width)===t&&(null===(i=this._handle.fbo)||void 0===i?void 0:i.height)===n||(null!==(a=this._handle)&&void 0!==a&&a.release(),this._handle=this._fbos.acquire(t,n,this._name,this._format)),e.unbindTexture(null===(o=this._handle)||void 0===o||null===(s=o.fbo)||void 0===s?void 0:s.colorTexture),e.bindFramebuffer(null===(u=this._handle)||void 0===u?void 0:u.fbo)}},{key:"generateMipMap",value:function(){var e,t,n,r,i;(null===(e=this._handle)||void 0===e||null===(t=e.getTexture())||void 0===t||null===(n=t.descriptor)||void 0===n?void 0:n.hasMipmap)&&(null===(r=this._handle)||void 0===r||null===(i=r.getTexture())||void 0===i||i.generateMipmap())}}]),e}(),P=n(18020),L=n(37081),N=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:P.q.RGBA_MIPMAP;(0,u.Z)(this,e),this.output=r,this.content=i,this.fbo=new Z(t,a,n)}return(0,l.Z)(e,[{key:"valid",get:function(){return this.fbo.valid}}]),e}(),U=function(){function e(t){(0,u.Z)(this,e),this.targets=[new N(t,"overlay color",L.H_.Color,I.D.Color),new N(t,"overlay IM color",L.H_.Color,I.D.ColorNoRasterImage),new N(t,"overlay highlight",L.H_.Highlight,I.D.Highlight,P.q.RGBA4),new N(t,"overlay water",L.H_.Normal,I.D.WaterNormal),new N(t,"overlay occluded",L.H_.Color,I.D.Occluded)],(0,v.Z)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new N(t,"overlay oid",L.H_.ObjectAndLayerIdColor,I.D.ObjectAndLayerIdColor))}return(0,l.Z)(e,[{key:"getTexture",value:function(e){var t;return null===(t=this.targets[e])||void 0===t?void 0:t.fbo.texture}},{key:"dispose",value:function(){var e,t=(0,s.Z)(this.targets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(n){t.e(n)}finally{t.f()}}},{key:"computeValidity",value:function(){return this.targets.reduce((function(e,t,n){return t.valid?e|=1<<n:e}),0)}}]),e}(),F=n(81296),H=n(22702),j=n(61863),z=n(51992),V=n(70374),G=n(53252),W=n(19962),B=n(56529),q=n(46293),J=n(93822),Y=n(471),K=n(81341),Q=n(5195),X=n(25049),$=n(25920),ee=n(78485),te=n(11954),ne=n(38365),re=n(82144),ie=n(31132),ae=n(7566),oe=n(27627),se=n(8548),ue=n(36207),le=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"initializeProgram",value:function(e){return new oe.$(e.rctx,n.shader.get().build(),ae.i)}},{key:"initializePipeline",value:function(){return(0,ue.sm)({blending:(0,ue.if)(se.zi.ONE,se.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ue.BK})}}]),n}(ie.A);le.shader=new re.J(ne.a,(function(){return n.e(46487).then(n.bind(n,46487))}));var ce=n(93463),de=n(57808),he=n(52311),fe=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e))._overlays=null,r._renderTargets=null,r._overlayParameters=new ne.O,r.hasHighlights=!1,r._hasWater=!1,r._renderers=new Map,r._sortedDrapeSourceRenderersDirty=!1,r._sortedRenderers=new g.Z,r._passParameters=new j.T,r._materials=null,r._screenToWorldRatio=1,r._localOriginFactory=null,r.unloadedMemory=0,r.ignoresMemoryFactor=!1,r._camera=new F.Z,r.worldToPCSRatio=1,r.events=new f.Z,r.longitudeCyclical=null,r.produces=new Map([[J.r.DRAPED_MATERIAL,function(e){return e!==L.H_.Highlight||r.hasHighlights}],[J.r.DRAPED_WATER,function(){return r._hasWater}]]),r._hasTargetWithoutRasterImage=!1,r._hasDrapedFeatureSource=!1,r._hasDrapedRasterSource=!1,r}return(0,l.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view._stage.renderer.fboCache,n=this.view._stage.renderView,r=n.waterTextures,i=n.stippleTextures,a=n.markerTextures;this._techniques=new z.M({rctx:this._rctx,viewingMode:S.JY.Local,stippleTextures:i,markerTextures:a,waterTextures:r}),this._renderContext=new q.Yh(this._rctx,new Y.l(t,this.view.state.viewingMode),null),this.addHandles([(0,m.watch)((function(){return r.updating}),(function(){return e.events.emit("content-changed")}),m.syncAndInitial),(0,m.watch)((function(){return e.spatialReference}),(function(t){return e._localOriginFactory=new W.C(t)}),m.syncAndInitial),(0,m.on)((function(){return e.view.allLayerViews}),"after-changes",(function(){return e._sortedDrapeSourceRenderersDirty=!0}))]),this._materials=new G.h(n.textures,this._techniques,(function(){e.notifyChange("rendersOccludedDraped"),e.events.emit("content-changed"),e.notifyChange("updating"),e.notifyChange("isEmpty")}),(function(){return e.events.emit("content-changed")})),this._bindParameters.slot=J.r.DRAPED_MATERIAL,this._bindParameters.mainDepth=null,this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=$.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new te.Mi((0,b.al)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(ce.T8.STAGE,this))}},{key:"destroy",value:function(){this._renderers.forEach((function(e){return e.destroy()})),this._renderers.clear(),this._debugTextureTechnique=(0,y.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,y.M2)(this._passParameters.texture),this._techniques=(0,y.SC)(this._techniques),this.disposeOverlays()}},{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"_rctx",get:function(){return this.view._stage.renderView.renderingContext}},{key:"rctx",get:function(){return this._rctx}},{key:"materials",get:function(){return this._materials}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"initializeRenderContext",value:function(e){this.pluginContext=e}},{key:"uninitializeRenderContext",value:function(){}},{key:"renderNode",value:function(){}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||(0,p.oE)(this._renderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return null!=this._overlays&&null!=this._renderTargets}},{key:"getMaterialRenderer",value:function(e){var t,n=(0,s.Z)(this._renderers.values());try{for(n.s();!(t=n.n()).done;){var r=t.value.getMaterialRenderer(e);if(r)return r}}catch(i){n.e(i)}finally{n.f()}return null}},{key:"layers",get:function(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map((function(e){return e.drapeSource.layer})).filter((function(e){return!!e}))}},{key:"createGeometryDrapeSourceRenderer",value:function(e){return this.createDrapeSourceRenderer(e,K.S)}},{key:"createDrapeSourceRenderer",value:function(e,t,n){var r=this,i=this._renderers.get(e);null!=i&&i.destroy();var a=new t((0,o.Z)((0,o.Z)({},n),{},{rendererContext:this,drapeSource:e}));return this._renderers.set(e,a),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,m.watch)((function(){return e.fullOpacity}),(function(){return r.events.emit("content-changed")})),e),a}},{key:"removeDrapeSourceRenderer",value:function(e){if(null!=e){var t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}}},{key:"computeValidity",value:function(){var e,t;return null!==(e=null===(t=this._renderTargets)||void 0===t?void 0:t.computeValidity())&&void 0!==e?e:0}},{key:"releaseRenderTargets",value:function(){var e;null===(e=this._renderTargets)||void 0===e||e.dispose()}},{key:"overlays",get:function(){var e;return null!==(e=this._overlays)&&void 0!==e?e:[]}},{key:"ensureDrapeTargets",value:function(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,_.fn)(e,(function(e){return e.drapeTargetType===R.al.WithoutRasterImage}))}},{key:"ensureDrapeSources",value:function(e){this._overlays?(this._hasDrapedFeatureSource=(0,_.fn)(e,(function(e){return e.drapeSourceType===R.Lw.Features})),this._hasDrapedRasterSource=(0,_.fn)(e,(function(e){return e.drapeSourceType===R.Lw.RasterImage}))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}},{key:"_needsColorWithoutRasterImage",get:function(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}},{key:"ensureOverlays",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new U(this.view._stage.renderer.fboCache),this._overlays=[new M,new M]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=n}},{key:"disposeOverlays",value:function(){this._overlays=null,this._renderTargets=(0,y.M2)(this._renderTargets),this.events.emit("textures-disposed")}},{key:"getTexture",value:function(e){var t,n;if(null!=e)return e===I.D.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null===(t=this._renderTargets)||void 0===t?void 0:t.getTexture(I.D.Color):null===(n=this._renderTargets)||void 0===n?void 0:n.getTexture(e)}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){this._processDrapeSources(e,(function(){return!0}))}},{key:"_processDrapeSources",value:function(e,t){var n,r=!1,i=(0,s.Z)(this._renderers);try{for(i.s();!(n=i.n()).done;){var o=(0,a.Z)(n.value,2),u=o[0],l=o[1];if(e.done)break;(u.destroyed||t(u))&&l.commitChanges()&&(r=!0,e.madeProgress())}}catch(c){i.e(c)}finally{i.f()}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,p.oE)(this._renderers,(function(e){return e.hasHighlights})),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}},{key:"processSyncDrapeSources",value:function(){this._processDrapeSources(ce.G5,(function(e){return e.updatePolicy===ee.j.SYNC}))}},{key:"isEmpty",get:function(){return!O.h.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,p.oE)(this._renderers,(function(e){return!e.isEmpty}))}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccludedDraped",get:function(){var e=this,t=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=ge;var n=this._sortedRenderers.some((function(t){return t.renderer.shouldRender(e._renderContext)}));return this._renderContext.renderOccludedMask=t,n}},{key:"renders",value:function(e){var t=this;return O.h.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==I.D.Occluded||this._sortedRenderers.some((function(e){return e.renderer.shouldRender(t._renderContext)}))}},{key:"mode",get:function(){var e,t;return this.isEmpty?H.gT.Disabled:null!==(e=this._renderTargets)&&void 0!==e&&e.getTexture(I.D.WaterNormal)?H.gT.EnabledWithWater:null!==(t=this._renderTargets)&&void 0!==t&&t.getTexture(I.D.Color)?H.gT.Enabled:H.gT.Disabled}},{key:"updateAnimation",value:function(e){var t=!1;return this._renderers.forEach((function(n){return t=n.updateAnimation(e)||t})),t}},{key:"updateDrapeSourceOrder",value:function(){this._sortedDrapeSourceRenderersDirty=!0}},{key:"drawOverlays",value:function(e){if(this._overlays&&this._renderTargets){var t,n=(0,s.Z)(this._overlays);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.longitudeCyclical?r.setupGeometryViewsCyclical(this.longitudeCyclical):r.setupGeometryViewsDirect()}}catch(c){n.e(c)}finally{n.f()}var i,a=(0,s.Z)(this._renderTargets.targets);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.content!==I.D.ColorNoRasterImage||this._needsColorWithoutRasterImage){var u=this._drawTarget(A.fu.INNER,o,e),l=this._drawTarget(A.fu.OUTER,o,e);(u||l)&&o.fbo.generateMipMap()}}}catch(c){a.e(c)}finally{a.f()}}}},{key:"_drawTarget",value:function(e,t,n){var r=this,i=this._overlays[e],a=i.canvasGeometries;if(0===a.numViews)return!1;var o=n.alignPixelEnabled,s=n.contentPixelRatio;this._screenToWorldRatio=s*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;var u=t.output;if(this.isEmpty||u===L.H_.Highlight&&!this.hasHighlights||u===L.H_.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;var l=this._rctx;if(this._camera.pixelRatio=i.pixelRatio*s,this._renderContext.output=u,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=u===L.H_.Normal?J.r.DRAPED_WATER:J.r.DRAPED_MATERIAL,t.content===I.D.Occluded&&(this._renderContext.renderOccludedMask=ge),!this.renders(t.content))return this._renderContext.renderOccludedMask=q.C9,!1;var c=i.resolution;this._rctx.setViewport(e===A.fu.INNER?0:c,0,c,c);var d=2*i.resolution,h=i.resolution,f=t.fbo;if(f.bind(l,d,h),e===A.fu.INNER&&(l.setClearColor(0,0,0,0),l.clear(se.lk.COLOR_BUFFER_BIT)),O.h.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==I.D.Occluded)for(var v=0;v<a.numViews;v++)this._setViewParameters(a.extents[v],i),this._ensureDebugPatternResources(i.resolution,pe[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._renderContext.bindParameters,this._passParameters),this._rctx.screen.draw();return this._sortedRenderers.forAll((function(n){var o=n.drapeSource,s=n.renderer;if(t.content!==I.D.ColorNoRasterImage||o.drapeSourceType!==R.Lw.RasterImage){for(var c=o.fullOpacity,v=null!=c&&c<1&&u===L.H_.Color?r.bindTemporaryFramebuffer(d,h):null,p=0;p<a.numViews;p++)r._setViewParameters(a.extents[p],i),s.render(r._renderContext);if(v){f.bind(l,d,h),r._overlayParameters.texture=v.getTexture(),r._overlayParameters.opacity=c,r._overlayParameters.overlayIndex=e;var y=r.pluginContext.techniques.acquire(le);r._rctx.bindTechnique(y,r._renderContext.bindParameters,r._overlayParameters),r._rctx.screen.draw(),y.release(),v.release()}}})),l.bindFramebuffer(null),this._renderContext.renderOccludedMask=q.C9,!0}},{key:"bindTemporaryFramebuffer",value:function(e,t){var n,r=this.view._stage.renderer.fboCache,i=r.acquire(e,t,"overlay tmp");return r.rctx.unbindTexture(null===(n=i.fbo)||void 0===n?void 0:n.colorTexture),r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(se.lk.COLOR_BUFFER_BIT),i}},{key:"reloadShaders",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._techniques.reloadAll();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifyContentChanged",value:function(){this.events.emit("content-changed")}},{key:"intersect",value:function(e,t,n,r){this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();var i,a=0,o=(0,s.Z)(this._sortedRenderers);try{for(o.s();!(i=o.n()).done;){var u,l,c=i.value.renderer;a=null!==(u=null===(l=c.intersect)||void 0===l?void 0:l.call(c,e,t,n,r,a))&&void 0!==u?u:a}}catch(d){o.e(d)}finally{o.f()}}},{key:"_updateSortedDrapeSourceRenderers",value:function(){var e=this;if(this._sortedRenderers.clear(),0!==this._renderers.size){var t=this.view.map.allLayers,n=t.length;this._renderers.forEach((function(r,i){var a,o=t.indexOf(i.layer),s=o>=0,u=null!==(a=i.renderGroup)&&void 0!==a?a:s?R.eZ.MapLayer:R.eZ.ViewLayer,l=n*u+(s?o:0);e._sortedRenderers.push(new ve(i,r,l))})),this._sortedRenderers.sort((function(e,t){return e.index-t.index}))}}},{key:"_setViewParameters",value:function(e,t){var n=this._camera;n.viewport=[0,0,t.resolution,t.resolution],(0,T.M5)(n.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],n.near,n.far),(0,T.vc)(n.viewMatrix,[-e[0],-e[1],0])}},{key:"_updateHasWater",value:function(){var e=(0,p.oE)(this._renderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}},{key:"_ensureDebugPatternResources",value:function(e,t){if((0,x.s)(this._passParameters.color,t[0],t[1],t[2]),!this._passParameters.texture){for(var n=new Uint8Array(e*e*4),r=0,i=0;i<e;i++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(i/10);o<2||s<2||10*o>e-20||10*s>e-20?(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=255):(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=1&o&&1&s?1&a^1&i?0:255:1&o^1&s?0:128)}var u=new he.X(e);u.samplingMode=se.cw.NEAREST,this._passParameters.texture=new de.x(this._rctx,u,n);var l=new X.V;l.hasAlpha=!0,this._debugTextureTechnique=this._techniques.acquire(Q.K,l)}}},{key:"test",get:function(){}}]),n}(V.tY);(0,h._)([(0,w.Cb)()],fe.prototype,"hasHighlights",void 0),(0,h._)([(0,w.Cb)()],fe.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,h._)([(0,w.Cb)()],fe.prototype,"_techniques",void 0),(0,h._)([(0,w.Cb)({constructOnly:!0})],fe.prototype,"view",void 0),(0,h._)([(0,w.Cb)()],fe.prototype,"worldToPCSRatio",void 0),(0,h._)([(0,w.Cb)()],fe.prototype,"spatialReference",void 0),(0,h._)([(0,w.Cb)({type:Boolean,readOnly:!0})],fe.prototype,"updating",null),(0,h._)([(0,w.Cb)()],fe.prototype,"isEmpty",null),(0,h._)([(0,w.Cb)({readOnly:!0})],fe.prototype,"rendersOccludedDraped",null),fe=(0,h._)([(0,C.j)("esri.views.3d.terrain.OverlayRenderer")],fe);var ve=(0,l.Z)((function e(t,n,r){(0,u.Z)(this,e),this.drapeSource=t,this.renderer=n,this.index=r})),pe=[[1,.5,.5],[.5,.5,1]],ye=-2,ge=B.yD.OccludeAndTransparent},54134:function(e,t,n){var r,i,a,o;n.d(t,{Ns:function(){return o},VB:function(){return a},fu:function(){return r},tk:function(){return i}}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(i||(i={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(a||(a={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},74779:function(e,t,n){n.d(t,{SP:function(){return f},T5:function(){return p},kF:function(){return v},o9:function(){return r},vF:function(){return y}});var r,i,a=n(43144),o=n(15671),s=n(60136),u=n(29388),l=n(12400),c=n(37081),d=n(85380),h=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).slicePlaneLocalOrigin=(0,l.Ue)(),e.origin=e.slicePlaneLocalOrigin,e.modelTransformation=null,e}return(0,a.Z)(n)}(d.d4);d.Pf;(i=r||(r={}))[i.Material=0]="Material",i[i.ShadowMap=1]="ShadowMap",i[i.Highlight=2]="Highlight",i[i.ViewshedShadowMap=3]="ViewshedShadowMap";var f=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).identifier=r.Material,e.output=c.H_.Color,e.transparent=!1,e}return(0,a.Z)(n)}(h),v=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).identifier=r.ShadowMap,e}return(0,a.Z)(n)}(h),p=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).identifier=r.Highlight,e}return(0,a.Z)(n)}(h),y=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).identifier=r.ViewshedShadowMap,e}return(0,a.Z)(n)}(h)},48353:function(e,t,n){n.d(t,{U:function(){return y}});var r,i,a,o,s,u,l=n(30168),c=n(18607),d=n(49450),h=n(58406),f=n(699),v=n(98634),p=n(4760);function y(e,t){var n=e.vertex;n.uniforms.add(new h.p("intrinsicWidth",(function(e){return e.width}))),t.vvSize?(e.attributes.add(p.T.SIZEFEATUREATTRIBUTE,"float"),n.uniforms.add(new d.J("vvSizeMinSize",(function(e){return e.vvSize.minSize})),new d.J("vvSizeMaxSize",(function(e){return e.vvSize.maxSize})),new d.J("vvSizeOffset",(function(e){return e.vvSize.offset})),new d.J("vvSizeFactor",(function(e){return e.vvSize.factor}))),n.code.add((0,v.H)(r||(r=(0,l.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(p.T.SIZE,"float"),n.code.add((0,v.H)(i||(i=(0,l.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(p.T.OPACITYFEATUREATTRIBUTE,"float"),n.constants.add("vvOpacityNumber","int",8),n.uniforms.add(new f.O("vvOpacityValues",(function(e){return e.vvOpacity.values}),8),new f.O("vvOpacityOpacities",(function(e){return e.vvOpacity.opacityValues}),8)),n.code.add((0,v.H)(a||(a=(0,l.Z)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):n.code.add((0,v.H)(o||(o=(0,l.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.include(c.k,t),e.attributes.add(p.T.COLORFEATUREATTRIBUTE,"float"),n.code.add((0,v.H)(s||(s=(0,l.Z)(["vec4 getColor(){\nreturn applyOpacity(interpolateVVColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(p.T.COLOR,"vec4"),n.code.add((0,v.H)(u||(u=(0,l.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},83866:function(e,t,n){var r;n.d(t,{U:function(){return r}}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},7683:function(e,t,n){n.d(t,{E:function(){return u},K:function(){return s}});var r,i,a=n(30168),o=n(98634);function s(e){e.fragment.code.add((0,o.H)(r||(r=(0,a.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function u(e){e.fragment.code.add((0,o.H)(i||(i=(0,a.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},29202:function(e,t,n){n.d(t,{D:function(){return o}});var r,i=n(30168),a=n(98634);function o(e){e.fragment.code.add((0,a.H)(r||(r=(0,i.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}},60300:function(e,t,n){n.d(t,{q:function(){return b},C:function(){return S}});var r=n(30168),i=n(78980),a=n(41012),o=n(95276),s=n(58406),u=n(98634),l=n(19253),c=n(5921),d=n(19093),h=n(86361);function f(e){return null==e?h.AG:4===e.length?e:(0,d.s)(x,e[0],e[1],e[2],1)}var v,p,y,g,m,_,w,C,T,x=(0,h.Ue)();function b(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){var n=!(t.draped&&t.stipplePreferContinuous),d=e.vertex,h=e.fragment;h.include(i.n),t.draped||((0,a.hY)(d,t),d.uniforms.add(new s.p("worldToScreenPerDistanceRatio",(function(e,t){return 1/t.camera.perScreenPixelRatio}))),d.code.add((0,u.H)(v||(v=(0,r.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),d.code.add((0,u.H)(p||(p=(0,r.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),R)),d.code.add((0,u.H)(y||(y=(0,r.Z)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),d.code.add((0,u.H)(g||(g=(0,r.Z)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),n?"patternLength":"1e4")),(0,a.ZI)(d),d.code.add((0,u.H)(m||(m=(0,r.Z)(["float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\nfloat flooredRepetitions = max(1.0, floor(repetitions + 0.5));\nfloat segmentLengthScreenRounded = flooredRepetitions * patternLength;\nfloat stretch = repetitions / flooredRepetitions;\nvStipplePatternStretch = max(0.75, stretch);\nreturn vec2(0.0, segmentLengthScreenRounded);\n}\nreturn vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n}"])))),h.uniforms.add(new l.A("stipplePatternTexture",(function(e){return e.stippleTexture})),new s.p("stipplePatternSDFNormalizer",(function(e){return function(e){return e?(Math.floor(.5*((0,c.kj)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern)})),new s.p("stipplePatternPixelSizeInv",(function(e){return 1/S(e)}))),h.code.add((0,u.H)(_||(_=(0,r.Z)(["float getStippleSDF(out bool isClamped) {\nfloat stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\nvec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\nisClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;\nfloat u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;\nu = fract(u);\nfloat encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));\nfloat sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\nreturn (sdf - 0.5) * vStipplePatternStretch + 0.5;\n}\nfloat getStippleSDF() {\nbool ignored;\nreturn getStippleSDF(ignored);\n}\nfloat getStippleAlpha() {\nbool isClamped;\nfloat stippleSDF = getStippleSDF(isClamped);\nfloat antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);\nreturn isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n}"])))),t.stippleOffColorEnabled?(h.uniforms.add(new o.N("stippleOffColor",(function(e){return f(e.stippleOffColor)}))),h.code.add((0,u.H)(w||(w=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):h.code.add((0,u.H)(C||(C=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,u.H)(T||(T=(0,r.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function S(e){var t=e.stipplePattern;return t?(0,c.$A)(e.stipplePattern)/t.pixelRatio:1}var R=u.H.float(.4)},40526:function(e,t,n){n.d(t,{Q:function(){return d}});var r,i,a=n(30168),o=n(2522),s=n(41012),u=n(58406),l=n(98634),c=n(33720);function d(e,t){var n=e.vertex;e.constants.add("markerSizePerLineWidth","float",o.M_),(0,s.ZI)(n),null==n.uniforms.get("markerScale")&&n.constants.add("markerScale","float",1),n.code.add((0,l.H)(r||(r=(0,a.Z)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===c.I9.World&&(n.constants.add("maxSegmentLengthFraction","float",.45),n.uniforms.add(new u.p("perRenderPixelRatio",(function(e,t){return t.camera.perRenderPixelRatio}))),n.code.add((0,l.H)(i||(i=(0,a.Z)(["bool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}\nfloat getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}"])))))}},43565:function(e,t,n){n.d(t,{S:function(){return c},_:function(){return d}});var r,i=n(43144),a=n(15671),o=n(30168),s=n(54943),u=n(98634),l=n(19253);function c(e){e.include(s.K),e.uniforms.add(new l.A("geometryDepthTexture",(function(e,t){var n;return null===(n=t.multipassGeometry.depth)||void 0===n?void 0:n.attachment}))),e.code.add((0,u.H)(r||(r=(0,o.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}var d=(0,i.Z)((function e(){(0,a.Z)(this,e)}))},15107:function(e,t,n){n.d(t,{B:function(){return S}});var r,i=n(30168),a=n(7683),o=n(29202),s=n(2116),u=n(41287),l=n(54943),c=n(82999),d=n(58406),h=n(98634),f=n(8654),v=n(19253);function p(e,t){var n=e.fragment;n.include(l.K),n.uniforms.add(new c.A("nearFar",(function(e,t){return t.camera.nearFar}))),n.uniforms.add(new v.A("depthMap",(function(e,t){var n;return null===(n=t.depth)||void 0===n?void 0:n.attachment}))),n.uniforms.add(new f.g("proj",(function(e,t){return t.camera.projectionMatrix}))),n.uniforms.add(new d.p("invResolutionHeight",(function(e,t){return 1/t.camera.height}))),n.uniforms.add(new f.g("reprojectionMatrix",(function(e,t){return t.ssr.reprojectionMatrix}))),n.code.add((0,h.H)(r||(r=(0,i.Z)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P = clamp(P + dP, vec2(0.0), vec2(0.999));\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var y,g,m,_,w,C,T,x,b=n(73619);function S(e,t){e.include(s.g,t),e.include(o.D),e.include(a.E),t.hasCloudsReflections&&e.include(b.j,t),t.hasScreenSpaceReflections&&e.include(p,t);var n=e.fragment;n.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",u.s).add("ssrHeightFadeEnd","float",u.o).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),n.code.add((0,h.H)(y||(y=(0,i.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),n.uniforms.add(new d.p("lightingSpecularStrength",(function(e,t){return t.lighting.mainLight.specularStrength})),new d.p("lightingEnvironmentStrength",(function(e,t){return t.lighting.mainLight.environmentStrength}))),n.code.add((0,h.H)(g||(g=(0,i.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&n.code.add((0,h.H)(m||(m=(0,i.Z)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(n.uniforms.add(new f.g("view",(function(e,t){return t.camera.viewMatrix})),new v.A("lastFrameColorTexture",(function(e,t){var n;return null===(n=t.ssr.lastFrameColor)||void 0===n?void 0:n.getTexture()})),new d.p("fadeFactorSSR",(function(e,t){return t.ssr.fadeFactor}))),n.code.add((0,h.H)(_||(_=(0,i.Z)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):n.code.add((0,h.H)(w||(w=(0,i.Z)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?n.code.add((0,h.H)(C||(C=(0,i.Z)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):n.code.add((0,h.H)(T||(T=(0,i.Z)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):n.code.add((0,h.H)(x||(x=(0,i.Z)(["return waterRenderedColor;\n}"]))))}},22702:function(e,t,n){n.d(t,{WB:function(){return D},WE:function(){return I},gT:function(){return u},yl:function(){return E}});var r,i,a,o,s,u,l,c=n(30168),d=n(43144),h=n(15671),f=n(60136),v=n(29388),p=n(86361),y=n(65156),g=n(54134),m=n(92015),_=n(74779),w=n(37081),C=n(92395),T=n(41481),x=n(15107),b=n(20395),S=n(58406),R=n(98634),O=n(19253),A=n(61809);function D(e,t){var n=e.vertex,r=e.fragment;n.uniforms.add(new b.$("overlayTexOffset",(function(e,t){return function(e,t){var n,r,i,a,o=null===(n=t.overlay)||void 0===n||null===(r=n.overlays[g.fu.INNER])||void 0===r?void 0:r.extent;(0,y.py)(o)&&(Z[0]=e.toMapSpace[0]/(0,y.d_)(o)-o[0]/(0,y.d_)(o),Z[1]=e.toMapSpace[1]/(0,y.Cb)(o)-o[1]/(0,y.Cb)(o));var s=null===(i=t.overlay)||void 0===i||null===(a=i.overlays[g.fu.OUTER])||void 0===a?void 0:a.extent;return(0,y.py)(s)&&(Z[2]=e.toMapSpace[0]/(0,y.d_)(s)-s[0]/(0,y.d_)(s),Z[3]=e.toMapSpace[1]/(0,y.Cb)(s)-s[1]/(0,y.Cb)(s)),Z}(e,t)})),new b.$("overlayTexScale",(function(e,t){return function(e,t){var n,r,i,a,o=null===(n=t.overlay)||void 0===n||null===(r=n.overlays[g.fu.INNER])||void 0===r?void 0:r.extent;(0,y.py)(o)&&(Z[0]=e.toMapSpace[2]/(0,y.d_)(o),Z[1]=e.toMapSpace[3]/(0,y.Cb)(o));var s=null===(i=t.overlay)||void 0===i||null===(a=i.overlays[g.fu.OUTER])||void 0===a?void 0:a.extent;return(0,y.py)(s)&&(Z[2]=e.toMapSpace[2]/(0,y.d_)(s),Z[3]=e.toMapSpace[3]/(0,y.Cb)(s)),Z}(e,t)}))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new O.A("ovColorTex",(function(e,t){return I(e,t)}))),k(e,t)}function E(e,t){var n=e.vertex,r=e.fragment;n.uniforms.add(new M("overlayTexOffset"),new M("overlayTexScale")),r.uniforms.add(new S.p("overlayOpacity",(function(e){return e.overlayOpacity})),new O.A("ovColorTex",(function(e,t){var n;return null===(n=t.overlay)||void 0===n?void 0:n.getTexture(e.overlayContent)}))),k(e,t)}(l=u||(u={}))[l.Disabled=0]="Disabled",l[l.Enabled=1]="Enabled",l[l.EnabledWithWater=2]="EnabledWithWater",l[l.COUNT=3]="COUNT";var M=function(e){(0,f.Z)(n,e);var t=(0,v.Z)(n);function n(e){return(0,h.Z)(this,n),t.call(this,e,"vec4")}return(0,d.Z)(n)}(A.x);function k(e,t){t.pbrMode!==T.f7.Water&&t.pbrMode!==T.f7.WaterOnIntegratedMesh&&t.pbrMode!==T.f7.TerrainWithWater||e.include(x.B,t);var n=e.vertex,u=e.fragment;e.varyings.add("vtcOverlay","vec4"),n.code.add((0,R.H)(r||(r=(0,c.Z)(["void setOverlayVTC(in vec2 uv) {\nvtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n}"])))),u.code.add((0,R.H)(i||(i=(0,c.Z)(["bool isValid(vec2 uv, vec2 dxdy) {\nreturn (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);\n}\nvec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {\nvec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));\nvec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}"])))),u.code.add((0,R.H)(a||(a=(0,c.Z)(["vec4 getCombinedOverlayColor() {\nreturn overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);\n}"])))),u.code.add((0,R.H)(o||(o=(0,c.Z)(["vec4 getOverlayColorTexel(vec4 texCoords) {\nvec2 texDim =  vec2(textureSize(ovColorTex, 0));\nvec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y) * texDim), 0);\nvec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w) * texDim), 0);\nbool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));\nbool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));\nreturn mix(color1 * float(isValid1), color0, float(isValid0));\n}"])))),t.pbrMode!==T.f7.Water&&t.pbrMode!==T.f7.WaterOnIntegratedMesh&&t.pbrMode!==T.f7.TerrainWithWater||((0,C.Pe)(u),(0,C.F1)(u),u.code.add((0,R.H)(s||(s=(0,c.Z)(["vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\nfloat shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {\nvec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\nvec3 v = vposEyeDir;\nvec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);\nreturn vec4(final, colorInput.w);\n}"])))))}function I(e,t){var n,r,i;return e.identifier===_.o9.Material&&e.output===w.H_.Color?null===(n=t.overlay)||void 0===n?void 0:n.getTexture(m.D.ColorNoRasterImage):e.identifier===_.o9.Material&&e.output===w.H_.ObjectAndLayerIdColor?null===(r=t.overlay)||void 0===r?void 0:r.getTexture(m.D.ObjectAndLayerIdColor):e.identifier===_.o9.Highlight?null===(i=t.overlay)||void 0===i?void 0:i.getTexture(m.D.Highlight):null}var Z=(0,p.Ue)()},73619:function(e,t,n){n.d(t,{j:function(){return E}});var r,i,a,o,s,u,l,c,d=n(30168),h=n(16889),f=n(22186),v=n(46208),p=n(5573),y=n(50902),g=n(92395),m=n(13773),_=n(49450),w=n(58406),C=n(98634),T=n(8654),x=n(43144),b=n(15671),S=n(60136),R=n(29388),O=n(61809),A=n(99340),D=function(e){(0,S.Z)(n,e);var t=(0,R.Z)(n);function n(e,r){return(0,b.Z)(this,n),t.call(this,e,"samplerCube",A.P.Pass,(function(t,n,i){return t.bindTexture(e,r(n,i))}))}return(0,x.Z)(n)}(O.x);function E(e){var t=e.fragment;t.uniforms.add(new T.g("rotationMatrixClouds",(function(e,t){return t.cloudsFade.parallax.transform})),new T.g("rotationMatrixCloudsCrossFade",(function(e,t){return t.cloudsFade.parallaxNew.transform})),new _.J("anchorPosition",(function(e,t){return t.cloudsFade.parallax.anchorPointClouds})),new _.J("anchorPositionCrossFade",(function(e,t){return t.cloudsFade.parallaxNew.anchorPointClouds})),new w.p("cloudsHeight",(function(){return y.$T})),new w.p("radiusCurvatureCorrectionFactor",(function(e,t){return t.cloudsFade.parallax.radiusCurvatureCorrectionFactor})),new w.p("totalFadeInOut",(function(e,t){return 1-t.cloudsFade.opacity})),new w.p("crossFadeAnchorFactor",(function(e,t){return(0,h.uZ)(t.cloudsFade.fadeFactor,0,1)})),new D("cubeMap",(function(e,t){var n,r,i;return null!==(n=null===(r=t.cloudsFade.data)||void 0===r||null===(i=r.cubeMap)||void 0===i?void 0:i.colorTexture)&&void 0!==n?n:null})),new m.U("crossFade",(function(e,t){return t.cloudsFade.fadeMode===p.lL.CROSS_FADE})),new m.U("readChannelsRG",(function(e,t){return t.cloudsFade.readChannels===v.uz.RG})),new m.U("fadeTextureChannels",(function(e,t){return t.cloudsFade.renderingStage===v.jL.FADING}))),t.constants.add("planetRadius","float",f.sv.radius),t.code.add((0,C.H)(r||(r=(0,d.Z)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,C.H)(i||(i=(0,d.Z)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,C.H)(a||(a=(0,d.Z)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,g.Pe)(t),(0,g.F1)(t),t.code.add((0,C.H)(o||(o=(0,d.Z)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,C.H)(s||(s=(0,d.Z)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = texture(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,C.H)(u||(u=(0,d.Z)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,C.H)(l||(l=(0,d.Z)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,C.H)(c||(c=(0,d.Z)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}},20395:function(e,t,n){n.d(t,{$:function(){return l}});var r=n(43144),i=n(15671),a=n(60136),o=n(29388),s=n(61809),u=n(99340),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r){return(0,i.Z)(this,n),t.call(this,e,"vec4",u.P.Draw,(function(t,n,i){return t.setUniform4fv(e,r(n,i))}))}return(0,r.Z)(n)}(s.x)},51992:function(e,t,n){n.d(t,{M:function(){return l}});var r=n(74165),i=n(15861),a=n(15671),o=n(43144),s=n(59447),u=n(33559),l=function(){function e(t){(0,a.Z)(this,e),this._context=t,this._perConstructorInstances=new s.r,this._frameCounter=0,this._keepAliveFrameCount=d}return(0,o.Z)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"destroy",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.destroy()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h,r=n.key,i=this._perConstructorInstances.get(e,r);if(null==i){var a=new e(this._context,n,(function(){return t.release(a)}));i=new c(a),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}},{key:"releaseAndAcquire",value:function(e,t,n){if(null!=n){if(t.key===n.key)return n;this.release(n)}return this.acquire(e,t)}},{key:"release",value:function(e){if(null!=e&&!this._perConstructorInstances.empty){var t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._keepAliveFrameCount!==d&&this._perConstructorInstances.forEach((function(t,n){t.forEach((function(t,r){0===t.refCount&&t.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(t.technique.destroy(),e._perConstructorInstances.delete(n,r))}))}))}},{key:"reloadAll",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,a){var o=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(t,i){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.shader,e.t0=a,!e.t0){e.next=6;break}return e.next=5,a.reload();case 5:t.forEach((function(e){return e.technique.reload(n._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.push(o(e,a))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),c=(0,o.Z)((function e(t){(0,a.Z)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0})),d=-1,h=new u.m},70374:function(e,t,n){n.d(t,{He:function(){return f},P6:function(){return v},QA:function(){return y},bV:function(){return g},jt:function(){return l},of:function(){return c},tY:function(){return h},vO:function(){return p}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(7138),u=n(37081),l={required:[]},c={required:[u.H_.Depth]},d=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"consumes",value:function(){return l}},{key:"usedMemory",get:function(){return 0}},{key:"isDecoration",get:function(){return!1}},{key:"running",get:function(){return!1}},{key:"materialReference",get:function(){return null}},{key:"modify",value:function(e){}},{key:"numGeometries",get:function(){return 0}},{key:"hasOccludees",get:function(){return!1}},{key:"queryRenderOccludedState",value:function(e){return!1}}]),n}(s.default),h=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(d),f=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).drapedPriority=0,e}return(0,i.Z)(n)}(d),v=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(d),p=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(d);function y(e){return"prepareTechnique"in e}function g(e){return"prepareTechniques"in e}},83377:function(e,t,n){n.d(t,{p:function(){return y}});var r=n(15671),i=n(43144),a=n(7025),o=n(6644),s=n(5573),u=n(81296),l=n(83866),c=n(43565),d=n(15226),h=n(68401),f=n(93822),v=n(25920),p=n(48919),y=function(){function e(t,n){(0,r.Z)(this,e),this.shadowMap=t,this.slicePlane=n,this.slot=f.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=v.A.NONE,this.alignPixelEnabled=!1,this.decorations=h.Iq.ON,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new u.Z,this._inverseViewport=(0,o.Ue)(),this.oldLighting=new p.cI,this.newLighting=new p.cI,this._fadedLighting=new p.cI,this._lighting=this.newLighting,this.ssr=new g,this.multipassEnabled=!1,this.multipassTerrain=new d.a,this.multipassGeometry=new c._,this.hudRenderStyle=l.U.Occluded,this.cloudsFade=new s.Kf,this.shadowHighlightsVisible=!1}return(0,i.Z)(e,[{key:"camera",get:function(){return this._camera},set:function(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}},{key:"lighting",get:function(){return this._lighting}},{key:"weatherFading",get:function(){return this._lighting===this._fadedLighting}},{key:"fadeLighting",value:function(e){var t=this.oldLighting,n=this.newLighting;e>=1?this._lighting=n:(this._fadedLighting.lerpLighting(t,n,e),this._lighting=this._fadedLighting)}}]),e}(),g=(0,i.Z)((function e(){(0,r.Z)(this,e),this.fadeFactor=1,this.reprojectionMatrix=(0,a.Ue)()}))},78976:function(e,t,n){n.d(t,{as:function(){return o},t9:function(){return u}});var r=n(15671),i=n(43144),a=n(27546),o=function(){function e(){(0,r.Z)(this,e),this.adds=new a.Z,this.removes=new a.Z,this.updates=new a.Z({allocator:function(e){return e||new s},deallocator:function(e){return e.renderGeometry=null,e}})}return(0,i.Z)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}},{key:"empty",get:function(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}]),e}(),s=(0,i.Z)((function e(){(0,r.Z)(this,e)})),u=(0,i.Z)((function e(){(0,r.Z)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array}))},53252:function(e,t,n){n.d(t,{h:function(){return l}});var r=n(15671),i=n(43144),a=n(32718),o=n(92026),s=n(59447),u=n(97731),l=function(){function e(t,n,i,a){(0,r.Z)(this,e),this._textures=t,this._techniques=n,this.materialChanged=i,this.requestRender=a,this._id2glMaterialRef=new s.r}return(0,i.Z)(e,[{key:"dispose",value:function(){this._textures.destroy()}},{key:"acquire",value:function(e,t,n){this._ownMaterial(e);var r=e.produces.get(t);if(null===r||void 0===r||!r(n))return null;var i=this._id2glMaterialRef.get(n,e.id);if(null==i){var a=e.createGLMaterial({material:e,techniques:this._techniques,textures:this._textures,output:n});i=new c(a),this._id2glMaterialRef.set(n,e.id,i)}return i.ref(),i.glMaterial}},{key:"release",value:function(e,t){var n=this._id2glMaterialRef.get(t,e.id);null!=n&&(n.unref(),n.referenced||((0,o.M2)(n.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}},{key:"_ownMaterial",value:function(e){e.repository&&e.repository!==this&&a.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}]),e}(),c=function(){function e(t){(0,r.Z)(this,e),this.glMaterial=t,this._refCnt=0}return(0,i.Z)(e,[{key:"ref",value:function(){++this._refCnt}},{key:"unref",value:function(){--this._refCnt,(0,u.hu)(this._refCnt>=0)}},{key:"referenced",get:function(){return this._refCnt>0}}]),e}()},94425:function(e,t,n){n.d(t,{p:function(){return o}});var r=n(15671),i=n(43144),a=n(68401),o=function(){function e(t,n){(0,r.Z)(this,e),this._material=t,this._repository=n,this._map=new Map}return(0,i.Z)(e,[{key:"dispose",value:function(){var e=this;this._map.forEach((function(t,n){null!=t&&e._repository.release(e._material,n)}))}},{key:"load",value:function(e,t,n){var r=this._material.produces.get(t);if(null===r||void 0===r||!r(n))return null;this._map.has(n)||this._map.set(n,this._repository.acquire(this._material,t,n));var i=this._map.get(n);if(null!=i){if(i.ensureResources(e)===a.Rw.LOADED)return i;this._repository.requestRender()}return null}}]),e}()},70619:function(e,t,n){n.d(t,{Cr:function(){return se},IG:function(){return A},QL:function(){return ee},nb:function(){return te},B2:function(){return I},DA:function(){return ae},x2:function(){return re},dV:function(){return Q},xu:function(){return K},mj:function(){return Y},rh:function(){return ie},PI:function(){return J},g7:function(){return $},AW:function(){return q},PD:function(){return ne},Ay:function(){return le},mx:function(){return oe}});var r,i=n(6644),a=n(32035),o=n(93311),s=n(12400),u=n(86372),l=n(38461),c=n(39406),d=n(55652),h=n(40885),f=n(91526);!function(e){e.length=function(e,t){var n=e[t],r=e[t+1],i=e[t+2];return Math.sqrt(n*n+r*r+i*i)},e.normalize=function(e,t){var n=e[t],r=e[t+1],i=e[t+2],a=1/Math.sqrt(n*n+r*r+i*i);e[t]*=a,e[t+1]*=a,e[t+2]*=a},e.scale=function(e,t,n){e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.add=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]+n[r],i[a+1]=e[t+1]+n[r+1],i[a+2]=e[t+2]+n[r+2]},e.subtract=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]-n[r],i[a+1]=e[t+1]-n[r+1],i[a+2]=e[t+2]-n[r+2]}}(r||(r={}));for(var v=n(79100),p=n(40779),y=n(97731),g=n(4760),m=r,_=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],w=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],C=[0,0,1,0,1,1,0,1],T=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],x=new Array(36),b=0;b<6;b++)for(var S=0;S<6;S++)x[6*b+S]=b;for(var R=new Array(36),O=0;O<6;O++)R[6*O]=0,R[6*O+1]=1,R[6*O+2]=2,R[6*O+3]=2,R[6*O+4]=3,R[6*O+5]=0;function A(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(24),r=0;r<8;r++)n[3*r]=_[r][0]*t[0],n[3*r+1]=_[r][1]*t[1],n[3*r+2]=_[r][2]*t[2];return new p.Z(e,[[g.T.POSITION,new f.a(n,T,3,!0)],[g.T.NORMAL,new f.a(w,x,3)],[g.T.UV0,new f.a(C,R,2)]])}var D=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],E=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],M=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],k=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function I(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(18),r=0;r<6;r++)n[3*r]=D[r][0]*t[0],n[3*r+1]=D[r][1]*t[1],n[3*r+2]=D[r][2]*t[2];return new p.Z(e,[[g.T.POSITION,new f.a(n,M,3,!0)],[g.T.NORMAL,new f.a(E,k,3)]])}var Z=(0,o.al)(-.5,0,-.5),P=(0,o.al)(.5,0,-.5),L=(0,o.al)(0,0,.5),N=(0,o.al)(0,.5,0),U=(0,o.Ue)(),F=(0,o.Ue)(),H=(0,o.Ue)(),j=(0,o.Ue)(),z=(0,o.Ue)();(0,a.f)(U,Z,N),(0,a.f)(F,Z,P),(0,a.b)(H,U,F),(0,a.n)(H,H),(0,a.f)(U,P,N),(0,a.f)(F,P,L),(0,a.b)(j,U,F),(0,a.n)(j,j),(0,a.f)(U,L,N),(0,a.f)(F,L,Z),(0,a.b)(z,U,F),(0,a.n)(z,z);var V=[Z,P,L,N],G=[0,-1,0,H[0],H[1],H[2],j[0],j[1],j[2],z[0],z[1],z[2]],W=[0,1,2,3,1,0,3,2,1,3,0,2],B=[0,0,0,1,1,1,2,2,2,3,3,3];function q(e,t){Array.isArray(t)||(t=[t,t,t]);for(var n=new Array(12),r=0;r<4;r++)n[3*r]=V[r][0]*t[0],n[3*r+1]=V[r][1]*t[1],n[3*r+2]=V[r][2]*t[2];return new p.Z(e,[[g.T.POSITION,new f.a(n,W,3,!0)],[g.T.NORMAL,new f.a(G,B,3)]])}function J(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0},a=-Math.PI,o=2*Math.PI,s=-Math.PI/2,u=Math.PI,d=Math.max(3,Math.floor(n)),h=Math.max(2,Math.floor(r)),v=(d+1)*(h+1),y=(0,l.xx)(3*v),m=(0,l.xx)(3*v),_=(0,l.xx)(2*v),w=[],C=0,T=0;T<=h;T++){for(var x=[],b=T/h,S=s+b*u,R=Math.cos(S),O=0;O<=d;O++){var A=O/d,D=a+A*o,E=Math.cos(D)*R,M=Math.sin(S),k=-Math.sin(D)*R;y[3*C]=E*t,y[3*C+1]=M*t,y[3*C+2]=k*t,m[3*C]=E,m[3*C+1]=M,m[3*C+2]=k,_[2*C]=A,_[2*C+1]=b,x.push(C),++C}w.push(x)}for(var I=new Array,Z=0;Z<h;Z++)for(var P=0;P<d;P++){var L=w[Z][P],N=w[Z][P+1],U=w[Z+1][P+1],F=w[Z+1][P];0===Z?(I.push(L),I.push(U),I.push(F)):Z===h-1?(I.push(L),I.push(N),I.push(U)):(I.push(L),I.push(N),I.push(U),I.push(U),I.push(F),I.push(L))}var H=[[g.T.POSITION,new f.a(y,I,3,!0)],[g.T.NORMAL,new f.a(m,I,3,!0)]];return i.uv&&H.push([g.T.UV0,new f.a(_,I,2,!0)]),i.offset&&(H[0][0]=g.T.OFFSET,H.push([g.T.POSITION,new f.a(Float64Array.from(i.offset),(0,c.LE)(I.length),3,!0)])),new p.Z(e,H)}function Y(e,t,n,r){var i=K(t,n,r);return new p.Z(e,i)}function K(e,t,n){var r,i,a=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{var o=a*(1+Math.sqrt(5))/2;r=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(var s=0;s<r.length;s+=3)m.scale(r,s,e/m.length(r,s));var u={};function c(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var a=t.toString()+"."+n.toString();if(u[a])return u[a];var o=r.length;return r.length+=3,m.add(r,3*t,r,3*n,r,o),m.scale(r,o,e/m.length(r,o)),o/=3,u[a]=o,o}for(var d=0;d<t;d++){for(var h=i.length,v=new Array(4*h),p=0;p<h;p+=3){var y=i[p],_=i[p+1],w=i[p+2],C=c(y,_),T=c(_,w),x=c(w,y),b=4*p;v[b]=y,v[b+1]=C,v[b+2]=x,v[b+3]=_,v[b+4]=T,v[b+5]=C,v[b+6]=w,v[b+7]=x,v[b+8]=T,v[b+9]=C,v[b+10]=T,v[b+11]=x}i=v,u={}}for(var S=(0,l.XO)(r),R=0;R<S.length;R+=3)m.normalize(S,R);return[[g.T.POSITION,new f.a((0,l.XO)(r),i,3,!0)],[g.T.NORMAL,new f.a(S,i,3,!0)]]}function Q(e,t,n,r,a,o,u,l){var d,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=n?(0,s.d9)(n):(0,s.Ue)(),m=t?(0,s.d9)(t):(0,s.al)(0,0,1);null!==(d=u)&&void 0!==d||(u=(0,i.Ue)());var _=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],w=null!=a&&2===a.length?a:[1,1],C=(0,c.LE)(1),T=[[g.T.POSITION,new f.a(y,C,3,!0)],[g.T.NORMAL,new f.a(m,C,3,!0)],[g.T.UV0,new f.a(u,C,u.length)],[g.T.COLOR,new f.a(_,C,4,!0)],[g.T.SIZE,new f.a(w,C,2)]];if(null!=o&&(o=[o[0],o[1],o[2],o[3]],T.push([g.T.CENTEROFFSETANDDISTANCE,new f.a(o,C,4)])),l){var x=[l[0],l[1],l[2],l[3]];T.push([g.T.FEATUREATTRIBUTE,new f.a(x,C,4)])}return new p.Z(e,T,null,v.U.Point,h)}var X=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function $(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X,n=new Array(12),r=0;r<4;r++)for(var i=0;i<3;i++)n[3*r+i]=t[r][i];var a=[0,1,2,2,3,0],o=[0,0,1],s=[0,0,0,0,0,0],u=[0,0,1,0,1,1,0,1],l=[255,255,255,255],c=[[g.T.POSITION,new f.a(n,a,3,!0)],[g.T.NORMAL,new f.a(o,s,3,!0)],[g.T.UV0,new f.a(u,a,2,!0)],[g.T.COLOR,new f.a(l,s,4,!0)]];return new p.Z(e,c)}function ee(e,t,n,r,i){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=0,c=n,d=t,h=(0,o.al)(0,u,0),v=(0,o.al)(0,u+d,0),y=(0,o.al)(0,-1,0),m=(0,o.al)(0,1,0);i&&(u=d,v=(0,o.al)(0,0,0),h=(0,o.al)(0,u,0),y=(0,o.al)(0,1,0),m=(0,o.al)(0,-1,0));var _=[v,h],w=[y,m],C=r+2,T=Math.sqrt(d*d+c*c);if(i)for(var x=r-1;x>=0;x--){var b=x*(2*Math.PI/r),S=(0,o.al)(Math.cos(b)*c,u,Math.sin(b)*c);_.push(S);var R=(0,o.al)(d*Math.cos(b)/T,-c/T,d*Math.sin(b)/T);w.push(R)}else for(var O=0;O<r;O++){var A=O*(2*Math.PI/r),D=(0,o.al)(Math.cos(A)*c,u,Math.sin(A)*c);_.push(D);var E=(0,o.al)(d*Math.cos(A)/T,c/T,d*Math.sin(A)/T);w.push(E)}var M=new Array,k=new Array;if(a){for(var I=3;I<_.length;I++)M.push(1),M.push(I-1),M.push(I),k.push(0),k.push(0),k.push(0);M.push(_.length-1),M.push(2),M.push(1),k.push(0),k.push(0),k.push(0)}if(s){for(var Z=3;Z<_.length;Z++)M.push(Z),M.push(Z-1),M.push(0),k.push(Z),k.push(Z-1),k.push(1);M.push(0),M.push(2),M.push(_.length-1),k.push(1),k.push(2),k.push(w.length-1)}for(var P=(0,l.xx)(3*C),L=0;L<C;L++)P[3*L]=_[L][0],P[3*L+1]=_[L][1],P[3*L+2]=_[L][2];for(var N=(0,l.xx)(3*C),U=0;U<C;U++)N[3*U]=w[U][0],N[3*U+1]=w[U][1],N[3*U+2]=w[U][2];var F=[[g.T.POSITION,new f.a(P,M,3,!0)],[g.T.NORMAL,new f.a(N,k,3,!0)]];return new p.Z(e,F)}function te(e,t,n,r,i,s,u){var c,d=i?(0,o.d9)(i):(0,o.al)(1,0,0),h=s?(0,o.d9)(s):(0,o.al)(0,0,0);null!==(c=u)&&void 0!==c||(u=!0);var v=(0,o.Ue)();(0,a.n)(v,d);var y=(0,o.Ue)();(0,a.j)(y,v,Math.abs(t));var m=(0,o.Ue)();(0,a.j)(m,y,-.5),(0,a.g)(m,m,h);var _=(0,o.al)(0,1,0);Math.abs(1-(0,a.m)(v,_))<.2&&(0,a.s)(_,0,0,1);var w=(0,o.Ue)();(0,a.b)(w,v,_),(0,a.n)(w,w),(0,a.b)(_,w,v);var C=2*r+(u?2:0),T=r+(u?2:0),x=(0,l.xx)(3*C),b=(0,l.xx)(3*T),S=(0,l.xx)(2*C),R=new Array(3*r*(u?4:2)),O=new Array(3*r*(u?4:2));u&&(x[3*(C-2)]=m[0],x[3*(C-2)+1]=m[1],x[3*(C-2)+2]=m[2],S[2*(C-2)]=0,S[2*(C-2)+1]=0,x[3*(C-1)]=x[3*(C-2)]+y[0],x[3*(C-1)+1]=x[3*(C-2)+1]+y[1],x[3*(C-1)+2]=x[3*(C-2)+2]+y[2],S[2*(C-1)]=1,S[2*(C-1)+1]=1,b[3*(T-2)]=-v[0],b[3*(T-2)+1]=-v[1],b[3*(T-2)+2]=-v[2],b[3*(T-1)]=v[0],b[3*(T-1)+1]=v[1],b[3*(T-1)+2]=v[2]);for(var A=function(e,t,n){R[e]=t,O[e]=n},D=0,E=(0,o.Ue)(),M=(0,o.Ue)(),k=0;k<r;k++){var I=k*(2*Math.PI/r);(0,a.j)(E,_,Math.sin(I)),(0,a.j)(M,w,Math.cos(I)),(0,a.g)(E,E,M),b[3*k]=E[0],b[3*k+1]=E[1],b[3*k+2]=E[2],(0,a.j)(E,E,n),(0,a.g)(E,E,m),x[3*k]=E[0],x[3*k+1]=E[1],x[3*k+2]=E[2],S[2*k]=k/r,S[2*k+1]=0,x[3*(k+r)]=x[3*k]+y[0],x[3*(k+r)+1]=x[3*k+1]+y[1],x[3*(k+r)+2]=x[3*k+2]+y[2],S[2*(k+r)]=k/r,S[2*k+1]=1;var Z=(k+1)%r;A(D++,k,k),A(D++,k+r,k),A(D++,Z,Z),A(D++,Z,Z),A(D++,k+r,k),A(D++,Z+r,Z)}if(u){for(var P=0;P<r;P++){var L=(P+1)%r;A(D++,C-2,T-2),A(D++,P,T-2),A(D++,L,T-2)}for(var N=0;N<r;N++){var U=(N+1)%r;A(D++,N+r,T-1),A(D++,C-1,T-1),A(D++,U+r,T-1)}}var F=[[g.T.POSITION,new f.a(x,R,3,!0)],[g.T.NORMAL,new f.a(b,O,3,!0)],[g.T.UV0,new f.a(S,R,2,!0)]];return new p.Z(e,F)}function ne(e,t,n,r,i,a){r=r||10,i=null==i||i,(0,y.hu)(t.length>1);for(var o=[],s=[],u=0;u<r;u++){o.push([0,-u-1,-(u+1)%r-1]);var l=u/r*2*Math.PI;s.push([Math.cos(l)*n,Math.sin(l)*n])}return re(e,s,t,[[0,0,0]],o,i,a)}function re(e,t,n,r,i,u){var c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,o.al)(0,0,0),v=t.length,y=(0,l.xx)(n.length*v*3+(6*r.length||0)),m=(0,l.xx)(n.length*v*3+(r?6:0)),_=new Array,w=new Array,C=0,T=0,x=(0,s.Ue)(),b=(0,s.Ue)(),S=(0,s.Ue)(),R=(0,s.Ue)(),O=(0,s.Ue)(),A=(0,s.Ue)(),D=(0,s.Ue)(),E=(0,s.Ue)(),M=(0,s.Ue)(),k=(0,s.Ue)(),I=(0,s.Ue)(),Z=(0,s.Ue)(),P=(0,s.Ue)(),L=(0,d.Ue)();(0,a.s)(M,0,1,0),(0,a.f)(b,n[1],n[0]),(0,a.n)(b,b),u?((0,a.g)(E,n[0],c),(0,a.n)(S,E)):(0,a.s)(S,0,0,1),le(b,S,M,M,O,S,ce),(0,a.c)(R,S),(0,a.c)(Z,O);for(var N=0;N<r.length;N++)(0,a.j)(A,O,r[N][0]),(0,a.j)(E,S,r[N][2]),(0,a.g)(A,A,E),(0,a.g)(A,A,n[0]),y[C++]=A[0],y[C++]=A[1],y[C++]=A[2];m[T++]=-b[0],m[T++]=-b[1],m[T++]=-b[2];for(var U=0;U<i.length;U++)_.push(i[U][0]>0?i[U][0]:-i[U][0]-1+r.length),_.push(i[U][1]>0?i[U][1]:-i[U][1]-1+r.length),_.push(i[U][2]>0?i[U][2]:-i[U][2]-1+r.length),w.push(0),w.push(0),w.push(0);for(var F=r.length,H=r.length-1,j=0;j<n.length;j++){var z=!1;j>0&&((0,a.c)(x,b),j<n.length-1?((0,a.f)(b,n[j+1],n[j]),(0,a.n)(b,b)):z=!0,(0,a.g)(k,x,b),(0,a.n)(k,k),(0,a.g)(I,n[j-1],R),(0,d.Yq)(n[j],k,L),(0,d.BR)(L,(0,h.re)(I,x),E)?((0,a.f)(E,E,n[j]),(0,a.n)(S,E),(0,a.b)(O,k,S),(0,a.n)(O,O)):le(k,R,Z,M,O,S,ce),(0,a.c)(R,S),(0,a.c)(Z,O)),u&&((0,a.g)(E,n[j],c),(0,a.n)(P,E));for(var V=0;V<v;V++)if((0,a.j)(A,O,t[V][0]),(0,a.j)(E,S,t[V][1]),(0,a.g)(A,A,E),(0,a.n)(D,A),m[T++]=D[0],m[T++]=D[1],m[T++]=D[2],(0,a.g)(A,A,n[j]),y[C++]=A[0],y[C++]=A[1],y[C++]=A[2],!z){var G=(V+1)%v;_.push(F+V),_.push(F+v+V),_.push(F+G),_.push(F+G),_.push(F+v+V),_.push(F+v+G);for(var W=0;W<6;W++){var B=_.length-6;w.push(_[B+W]-H)}}F+=v}for(var q=n[n.length-1],J=0;J<r.length;J++)(0,a.j)(A,O,r[J][0]),(0,a.j)(E,S,r[J][1]),(0,a.g)(A,A,E),(0,a.g)(A,A,q),y[C++]=A[0],y[C++]=A[1],y[C++]=A[2];var Y=T/3;m[T++]=b[0],m[T++]=b[1],m[T++]=b[2];for(var K=F-v,Q=0;Q<i.length;Q++)_.push(i[Q][0]>=0?F+i[Q][0]:-i[Q][0]-1+K),_.push(i[Q][2]>=0?F+i[Q][2]:-i[Q][2]-1+K),_.push(i[Q][1]>=0?F+i[Q][1]:-i[Q][1]-1+K),w.push(Y),w.push(Y),w.push(Y);var X=[[g.T.POSITION,new f.a(y,_,3,!0)],[g.T.NORMAL,new f.a(m,w,3,!0)]];return new p.Z(e,X)}function ie(e,t,n,r){(0,y.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,y.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,y.hu)(null==n||n.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,y.hu)(null==n||3===n[0].length,"createPolylineGeometry(): malformed normal");for(var i=(0,u.bg)(3*t.length),a=new Array(2*(t.length-1)),o=0,s=0,d=0;d<t.length;d++){for(var h=0;h<3;h++)i[o++]=t[d][h];d>0&&(a[s++]=d-1,a[s++]=d)}var m=[[g.T.POSITION,new f.a(i,a,3,!0)]];if(n){for(var _=(0,l.xx)(3*n.length),w=0,C=0;C<t.length;C++)for(var T=0;T<3;T++)_[w++]=n[C][T];m.push([g.T.NORMAL,new f.a(_,a,3,!0)])}return r&&m.push([g.T.COLOR,new f.a(r,(0,c.KF)(r.length/4),4)]),new p.Z(e,m,null,v.U.Line)}function ae(e,t,n,r,i){for(var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=new Array(18),s=[[-n,a,i/2],[r,a,i/2],[0,t+a,i/2],[-n,a,-i/2],[r,a,-i/2],[0,t+a,-i/2]],u=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],l=0;l<6;l++)o[3*l]=s[l][0],o[3*l+1]=s[l][1],o[3*l+2]=s[l][2];return new p.Z(e,[[g.T.POSITION,new f.a(o,u,3,!0)]])}function oe(e,t){for(var n=e.getMutableAttribute(g.T.POSITION).data,r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],s=n[r+2];(0,a.s)(de,i,o,s),(0,a.h)(de,de,t),n[r]=de[0],n[r+1]=de[1],n[r+2]=de[2]}}function se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=e.attributes,r=n.get(g.T.POSITION).data,i=n.get(g.T.NORMAL).data;if(i)for(var a=t.getMutableAttribute(g.T.NORMAL).data,o=0;o<i.length;o+=3){var s=i[o+1];a[o+1]=-i[o+2],a[o+2]=s}if(r)for(var u=t.getMutableAttribute(g.T.POSITION).data,l=0;l<r.length;l+=3){var c=r[l+1];u[l+1]=-r[l+2],u[l+2]=c}}function ue(e,t,n,r,i){return!(Math.abs((0,a.m)(t,e))>i)&&((0,a.b)(n,e,t),(0,a.n)(n,n),(0,a.b)(r,n,e),(0,a.n)(r,r),!0)}function le(e,t,n,r,i,a,o){return ue(e,t,i,a,o)||ue(e,n,i,a,o)||ue(e,r,i,a,o)}var ce=.99619469809,de=(0,s.Ue)()},19962:function(e,t,n){n.d(t,{C:function(){return w}});var r=n(93433),i=n(15671),a=n(43144),o=(n(93169),n(95439)),s=n(32035),u=n(12400),l=n(86361),c=n(50628),d=n(91526),h=n(79100),f=n(40779),v=n(61403),p=n(66327),y=n(17852),g=n(4760),m=n(97882),_=n(58901),w=function(){function e(t){(0,i.Z)(this,e),this._originSR=t,this._rootOriginId="root/"+(0,o.D)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}return(0,a.Z)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this._rootOriginId);if(null==t){var n=y.p.rootOrigin;if(null!=n)return this._origins.set(this._rootOriginId,(0,v.a)(n[0],n[1],n[2],this._rootOriginId)),this.getOrigin(e);var i=(0,v.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}var a=this._gridSize,o=Math.round(e[0]/a),u=Math.round(e[1]/a),l=Math.round(e[2]/a),c="".concat(o,"/").concat(u,"/").concat(l),d=this._origins.get(c),h=.5*a;if((0,s.f)(C,e,t.vec3),C[0]=Math.abs(C[0]),C[1]=Math.abs(C[1]),C[2]=Math.abs(C[2]),C[0]<h&&C[1]<h&&C[2]<h){if(d){var f=Math.max.apply(Math,(0,r.Z)(C));if((0,s.f)(C,e,d.vec3),C[0]=Math.abs(C[0]),C[1]=Math.abs(C[1]),C[2]=Math.abs(C[2]),Math.max.apply(Math,(0,r.Z)(C))<f)return d}return t}return d||(d=(0,v.a)(o*a,u*a,l*a,c),this._origins.set(c,d)),d}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,l.al)(1,1,0,1),n=window.view,r=n._stage,i=t.toString();if(!this._objects.has(i)){this._material=new _.U({width:2,color:t}),r.add(this._material);var a=new m.F(r,{pickable:!1}),o=new p.T({castShadow:!1});r.add(o),a.add(o),this._objects.set(i,o)}for(var s=this._objects.get(i),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],v=u.length,y=new Array(3*v),w=new Array,C=.5*this._gridSize,T=0;T<v;T++)y[3*T]=e[0]+(1&u[T]?C:-C),y[3*T+1]=e[1]+(2&u[T]?C:-C),y[3*T+2]=e[2]+(4&u[T]?C:-C),T>0&&w.push(T-1,T);(0,c.projectBuffer)(y,this._originSR,0,y,n.renderSpatialReference,0,v);var x=new f.Z(this._material,[[g.T.POSITION,new d.a(y,w,3,!0)]],null,h.U.Line);r.add(x),s.addGeometry(x)}},{key:"test",get:function(){}}]),e}(),C=(0,u.Ue)()},61403:function(e,t,n){n.d(t,{a:function(){return s}});var r=n(43144),i=n(15671),a=n(12400),o=(0,r.Z)((function e(t,n){(0,i.Z)(this,e),this.vec3=t,this.id=n}));function s(e,t,n,r){return new o((0,a.al)(e,t,n),r)}},78289:function(e,t,n){var r,i;n.d(t,{$:function(){return i},T:function(){return r}}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(i||(i={}))},66327:function(e,t,n){n.d(t,{T:function(){return C}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=(n(93169),n(29134)),l=n(7025),c=n(32035),d=n(12400),h=n(23470),f=n(80064),v=n(68401),p=n(1395),y=n(79100),g=n(47669),m=n(97731),_=n(4760),w=n(32683),C=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r,a,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)(this,n),(a=t.call(this)).type=y.U.Object,a._shaderTransformation=null,a._parentLayer=null,a._visible=!0,a.castShadow=null===(e=o.castShadow)||void 0===e||e,a.usesVerticalDistanceToGround=null!==(r=o.usesVerticalDistanceToGround)&&void 0!==r&&r,a.graphicUid=o.graphicUid,a.layerUid=o.layerUid,o.isElevationSource&&(a.lastValidElevationBB=new T),a._geometries=o.geometries?Array.from(o.geometries):new Array,a}return(0,a.Z)(n,[{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){var e;return null!==(e=this._transformation)&&void 0!==e?e:l.Wd},set:function(e){var t;this._transformation=(0,u.JG)(null!==(t=this._transformation)&&void 0!==t?t:(0,l.Ue)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}},{key:"shaderTransformation",get:function(){return this._shaderTransformation},set:function(e){var t;this._shaderTransformation=e?(0,u.JG)(null!==(t=this._shaderTransformation)&&void 0!==t?t:(0,l.Ue)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}},{key:"effectiveTransformation",get:function(){var e;return null!==(e=this.shaderTransformation)&&void 0!==e?e:this.transformation}},{key:"dispose",value:function(){this._geometries.length=0}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(e){(0,m.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}},{key:"addGeometry",value:function(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}},{key:"removeGeometry",value:function(e){var t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}},{key:"removeAllGeometries",value:function(){for(;this._geometries.length>0;)this.removeGeometry(0)}},{key:"geometryVertexAttributeUpdated",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:n}),(0,_.j)(t)&&this._invalidateBoundingVolume()}},{key:"visible",get:function(){return this._visible},set:function(e){if(this._visible!==e){this._visible=e;var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){t.value.visible=this._visible}}catch(i){n.e(i)}finally{n.f()}this._emit("visibilityChanged",this)}}},{key:"maskOccludee",value:function(){var e,t=new g.O(v.V_.MaskOccludee),n=(0,r.Z)(this._geometries);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.occludees=(0,w.lr)(i.occludees,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("occlusionChanged",this),t}},{key:"removeOcclude",value:function(e){var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.occludees=(0,w.U_)(i.occludees,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("occlusionChanged",this)}},{key:"highlight",value:function(){var e,t=new g.O(v.V_.Highlight),n=(0,r.Z)(this._geometries);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.highlights=(0,w.lr)(i.highlights,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("highlightChanged",this),t}},{key:"removeHighlight",value:function(e){var t,n=(0,r.Z)(this._geometries);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.highlights=(0,w.U_)(i.highlights,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("highlightChanged",this)}},{key:"getCombinedStaticTransformation",value:function(e,t){return(0,u.Jp)(t,this.transformation,e.transformation)}},{key:"getCombinedShaderTransformation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,l.Ue)();return(0,u.Jp)(t,this.effectiveTransformation,e.transformation)}},{key:"boundingVolumeWorldSpace",get:function(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new x,this._validateBoundingVolume(this._bvWorldSpace,S.WorldSpace)),this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new x,this._validateBoundingVolume(this._bvObjectSpace,S.ObjectSpace)),this._bvObjectSpace}},{key:"_validateBoundingVolume",value:function(e,t){var n,i=t===S.ObjectSpace,a=(0,r.Z)(this._geometries);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.boundingInfo;s&&b(s,e,i?o.transformation:this.getCombinedShaderTransformation(o))}}catch(_){a.e(_)}finally{a.f()}(0,c.o)((0,h.g)(e.bounds),e.min,e.max,.5);var u,l=(0,r.Z)(this._geometries);try{for(l.s();!(u=l.n()).done;){var d=u.value,v=d.boundingInfo;if(null!=v){var p=i?d.transformation:this.getCombinedShaderTransformation(d),y=(0,f.u1)(p);(0,c.h)(E,v.center,p);var g=(0,c.p)(E,(0,h.g)(e.bounds)),m=v.radius*y;e.bounds[3]=Math.max(e.bounds[3],g+m)}}}catch(_){l.e(_)}finally{l.f()}}},{key:"_invalidateBoundingVolume",value:function(){var e,t=null===(e=this._bvWorldSpace)||void 0===e?void 0:e.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&t&&this._parentLayer.notifyObjectBBChanged(this,t)}},{key:"_emit",value:function(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}},{key:"test",get:function(){}}]),n}(p.c),T=function(){function e(){(0,i.Z)(this,e),this.min=(0,d.al)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,d.al)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return(0,a.Z)(e,[{key:"isEmpty",value:function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}]),e}(),x=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).bounds=(0,h.c)(),e}return(0,a.Z)(n)}(T);function b(e,t,n){var r=e.bbMin,i=e.bbMax;if((0,u.lv)(n)){var a=(0,c.s)(O,n[12],n[13],n[14]);(0,c.g)(A,r,a),(0,c.g)(D,i,a);for(var o=0;o<3;++o)t.min[o]=Math.min(t.min[o],A[o]),t.max[o]=Math.max(t.max[o],D[o])}else if((0,c.h)(A,r,n),(0,c.e)(r,i))for(var s=0;s<3;++s)t.min[s]=Math.min(t.min[s],A[s]),t.max[s]=Math.max(t.max[s],A[s]);else{(0,c.h)(D,i,n);for(var l=0;l<3;++l)t.min[l]=Math.min(t.min[l],A[l],D[l]),t.max[l]=Math.max(t.max[l],A[l],D[l]);for(var d=0;d<3;++d){(0,c.c)(A,r),(0,c.c)(D,i),A[d]=i[d],D[d]=r[d],(0,c.h)(A,A,n),(0,c.h)(D,D,n);for(var h=0;h<3;++h)t.min[h]=Math.min(t.min[h],A[h],D[h]),t.max[h]=Math.max(t.max[h],A[h],D[h])}}}var S,R,O=(0,d.Ue)(),A=(0,d.Ue)(),D=(0,d.Ue)(),E=(0,d.Ue)();(R=S||(S={}))[R.WorldSpace=0]="WorldSpace",R[R.ObjectSpace=1]="ObjectSpace"},46293:function(e,t,n){n.d(t,{C9:function(){return v},V1:function(){return f},Yh:function(){return h}});var r=n(60136),i=n(29388),a=n(43144),o=n(15671),s=n(38499),u=n(81296),l=n(37081),c=n(83377),d=n(56529),h=(0,a.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,o.Z)(this,e),this.rctx=t,this.sliceHelper=r,this.lastFrameCamera=new u.Z,this.output=l.H_.Color,this.renderOccludedMask=v,this.bindParameters=new c.p(n,null!=r?r.plane:null),this.bindParameters.alignPixelEnabled=!0})),f=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,i,a){var u;return(0,o.Z)(this,n),(u=t.call(this,e,i,a)).offscreenRenderingHelper=r,u.sliceHelper=a,u.time=(0,s.HA)(0),u}return(0,a.Z)(n)}(h),v=d.yD.Occlude|d.yD.OccludeAndTransparent|d.yD.OccludeAndTransparentStencil},39077:function(e,t,n){n.d(t,{z:function(){return d}});var r=n(15671),i=n(43144),a=n(95439),o=n(29134),s=n(7025),u=n(32035),l=n(23470),c=n(80064),d=function(){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,r.Z)(this,e),this.geometry=t,this.screenToWorldRatio=1,this._transformation=(0,s.Ue)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,a.D)(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=null!==(n=i.castShadow)&&void 0!==n&&n,null!=i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}return(0,i.Z)(e,[{key:"transformation",get:function(){return this._transformation},set:function(e){(0,o.JG)(this._transformation,e),this._boundingSphere=null}},{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"objectShaderTransformationChanged",value:function(e){var t;null==e?this._shaderTransformation=null:(null!==(t=this._shaderTransformation)&&void 0!==t||(this._shaderTransformation=(0,s.Ue)()),(0,o.Jp)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}},{key:"boundingSphere",get:function(){var e;return this.boundingInfo?(null==this._boundingSphere&&(null!==(e=this._boundingSphere)&&void 0!==e||(this._boundingSphere=(0,l.c)()),(0,u.h)((0,l.g)(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,c.u1)(this.shaderTransformation)),this._boundingSphere):l.N}},{key:"material",get:function(){return this.geometry.material}},{key:"type",get:function(){return this.geometry.type}},{key:"shaderTransformation",get:function(){var e;return null!==(e=this._shaderTransformation)&&void 0!==e?e:this.transformation}},{key:"attributes",get:function(){return this.geometry.attributes}},{key:"highlights",get:function(){return this.geometry.highlights}},{key:"occludees",get:function(){return this.geometry.occludees}},{key:"visible",get:function(){return this.geometry.visible},set:function(e){this.geometry.visible=e}}]),e}()},471:function(e,t,n){n.d(t,{l:function(){return I},i:function(){return S}});var r=n(43144),i=n(15671),a=n(93169),o=n(16889),s=n(92026),u=n(21389),l=n(29134),c=n(7025),d=n(13611),h=n(6644),f=n(32035),v=n(12400),p=n(19093),y=n(86361),g=n(50951),m=n(18020),_=n(60136),w=n(29388),C=n(27366),T=n(49861),x=(n(32718),n(84936),n(69912)),b=function(e){(0,_.Z)(n,e);var t=(0,w.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments))._projectionMatrix=(0,c.Ue)(),e}return(0,r.Z)(n,[{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]),n}(n(81296).Z);(0,C._)([(0,T.Cb)()],b.prototype,"_projectionMatrix",void 0),(0,C._)([(0,T.Cb)({readOnly:!0})],b.prototype,"projectionMatrix",null),b=(0,C._)([(0,x.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],b);var S,R,O=n(32251),A=n(97731),D=n(8548),E=n(57808);(R=S||(S={}))[R.Highlight=0]="Highlight",R[R.ExcludeHighlight=1]="ExcludeHighlight";for(var M=(0,r.Z)((function e(){(0,i.Z)(this,e),this.camera=new b,this.lightMat=(0,c.Ue)()})),k=(0,r.Z)((function e(){(0,i.Z)(this,e),this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0})),I=function(){function e(t,n){(0,i.Z)(this,e),this._fbos=t,this._viewingMode=n,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new k,this._projectionView=(0,c.Ue)(),this._projectionViewInverse=(0,c.Ue)(),this._modelViewLight=(0,c.Ue)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,y.Ue)(),this._cascades=[new M,new M,new M,new M],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,a.Z)("esri-mobile")?4096:16384,t.rctx.parameters.maxTextureSize)}return(0,r.Z)(e,[{key:"dispose",value:function(){this.enabled=!1,this.disposeOffscreenBuffers()}},{key:"depthTexture",get:function(){var e;return null===(e=this._handle)||void 0===e?void 0:e.getTexture()}},{key:"_textureWidth",get:function(){return this._textureHeight*this._numCascades}},{key:"numCascades",get:function(){return this._numCascades}},{key:"cascadeDistances",get:function(){return(0,p.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}},{key:"disposeOffscreenBuffers",value:function(){this._handle=(0,s.RY)(this._handle),this._discardSnapshots()}},{key:"maxCascades",get:function(){return this.settings.maxNumCascadesHighQuality},set:function(e){this.settings.maxNumCascadesHighQuality=(0,o.uZ)(Math.floor(e),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,e||this.disposeOffscreenBuffers()}},{key:"ready",get:function(){return this._enabled&&null!=this.depthTexture}},{key:"cascades",get:function(){for(var e=0;e<this._numCascades;++e)G[e]=this._cascades[e];return G.length=this._numCascades,G}},{key:"start",value:function(e,t,n,r,i){(0,A.hu)(this.enabled);var a=function(e){var t=e.near,n=e.far;return t<2&&(t=2),n<2&&(n=2),t>=n&&(t=2,n=4),{near:t,far:n}}(n),o=a.near,s=a.far;this._computeCascadeDistances(o,s,r),this._textureHeight=this._computeTextureHeight(e,i,r),this._setupMatrices(e,t);for(var u=e.viewMatrix,l=e.projectionMatrix,c=0;c<this._numCascades;++c)this._constructCascade(c,l,u,t);this._lastOrigin=null,this.clear()}},{key:"finish",value:function(){var e;(0,A.hu)(this.enabled),null===(e=this._handle)||void 0===e||e.detachDepth()}},{key:"getShadowMapMatrices",value:function(e){if(!this._lastOrigin||!(0,f.e)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,v.Ue)(),(0,f.c)(this._lastOrigin,e);for(var t=0;t<this._numCascades;++t){(0,l.Iu)(W,this._cascades[t].lightMat,e);for(var n=0;n<16;++n)B[16*t+n]=W[n]}}return B}},{key:"moveSnapshot",value:function(e){var t,n;(0,A.hu)(this.enabled),null!==(t=this._handle)&&void 0!==t&&t.detachDepth(),null!==(n=this._snapshots[e])&&void 0!==n&&n.release(),this._snapshots[e]=this._handle,this._handle=null,this.clear()}},{key:"copySnapshot",value:function(e){var t,n,r,i,a=null===(t=this._handle)||void 0===t||null===(n=t.getTexture())||void 0===n?void 0:n.descriptor;if(this.enabled&&a){null===(r=this._snapshots[e])||void 0===r||r.release();var o=a.width,s=a.height,u=e===S.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[e]=this._fbos.acquire(o,s,u,m.q.RGBA4);var l=this._fbos.rctx;this._bindFbo();var c=l.bindTexture(null===(i=this._snapshots[e])||void 0===i?void 0:i.getTexture(),E.x.TEXTURE_UNIT_FOR_UPDATES);l.gl.copyTexSubImage2D(D.No.TEXTURE_2D,0,0,0,0,0,o,s),l.bindTexture(c,E.x.TEXTURE_UNIT_FOR_UPDATES)}}},{key:"getSnapshot",value:function(e){var t;return this.enabled?null===(t=this._snapshots[e])||void 0===t?void 0:t.getTexture():null}},{key:"clear",value:function(){var e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clear(D.lk.COLOR_BUFFER_BIT|D.lk.DEPTH_BUFFER_BIT)}},{key:"_computeTextureHeight",value:function(e,t,n){var r=Math.min(window.devicePixelRatio,t)/e.pixelRatio,i=n?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,a=(0,O.nq)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*r*i)),o=Math.min(this._maxTextureWidth,this._numCascades*a);return(0,O.pf)(o/this._numCascades)}},{key:"_ensureFbo",value:function(){var e,t,n,r,i;(null===(e=this._handle)||void 0===e||null===(t=e.fbo)||void 0===t?void 0:t.width)===this._textureWidth&&(null===(n=this._handle)||void 0===n?void 0:n.fbo.height)===this._textureHeight||(null!==(r=this._handle)&&void 0!==r&&r.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",m.q.RGBA4)),null===(i=this._handle)||void 0===i||i.acquireDepth(m.m.DEPTH16_BUFFER)}},{key:"_discardSnapshot",value:function(e){this._snapshots[e]=(0,s.RY)(this._snapshots[e])}},{key:"_discardSnapshots",value:function(){for(var e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}},{key:"_bindFbo",value:function(){var e,t=this._fbos.rctx;t.unbindTexture(this.depthTexture),t.bindFramebuffer(null===(e=this._handle)||void 0===e?void 0:e.fbo)}},{key:"_constructCascade",value:function(e,t,n,r){var i=this._cascades[e],a=-this._cascadeDistances[e],s=-this._cascadeDistances[e+1],u=(t[10]*a+t[14])/Math.abs(t[11]*a+t[15]),c=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]);(0,A.hu)(u<c);for(var h=0;h<8;++h){(0,p.s)(P,h%4==0||h%4==3?-1:1,h%4==0||h%4==1?-1:1,h<4?u:c,1);var v=L[h];(0,p.t)(v,P,this._projectionViewInverse),v[0]/=v[3],v[1]/=v[3],v[2]/=v[3]}(0,f.k)(V,L[0]),i.camera.viewMatrix=(0,l.Iu)(Z,this._modelViewLight,V);for(var y=0;y<8;++y)(0,f.h)(L[y],L[y],i.camera.viewMatrix);for(var g=L[0][2],m=L[0][2],_=1;_<8;++_)g=Math.min(g,L[_][2]),m=Math.max(m,L[_][2]);g-=200,m+=200,i.camera.near=-m,i.camera.far=-g,function(e,t,n,r,i){var a=1/L[0][3],s=1/L[4][3];(0,A.hu)(a<s);var u=a+Math.sqrt(a*s),l=Math.sin((0,o.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));(function(e,t,n,r,i,a,o,s){(0,d.t8)(q,0,0);for(var u=0;u<4;++u)(0,d.IH)(q,q,e[u]);(0,d.bA)(q,q,.25),(0,d.t8)(J,0,0);for(var l=4;l<8;++l)(0,d.IH)(J,J,e[l]);(0,d.bA)(J,J,.25),(0,d.t7)(Y[0],e[4],e[5],.5),(0,d.t7)(Y[1],e[5],e[6],.5),(0,d.t7)(Y[2],e[6],e[7],.5),(0,d.t7)(Y[3],e[7],e[4],.5);for(var c=0,h=(0,d.bI)(Y[0],q),f=1;f<4;++f){var v=(0,d.bI)(Y[f],q);v<h&&(h=v,c=f)}(0,d.$X)(K,Y[c],e[c+4]);var p,y,g=K[0];K[0]=-K[1],K[1]=g,(0,d.$X)(Q,J,q),(0,d.AK)(Q,K)<0&&(0,d.tk)(K,K),(0,d.t7)(K,K,Q,n),(0,d.Fv)(K,K),p=y=(0,d.AK)((0,d.$X)(X,e[0],q),K);for(var m=1;m<8;++m){var _=(0,d.AK)((0,d.$X)(X,e[m],q),K);_<p?p=_:_>y&&(y=_)}(0,d.JG)(r,q),(0,d.bA)(X,K,p-t),(0,d.IH)(r,r,X);for(var w=-1,C=1,T=0,x=0,b=0;b<8;++b){(0,d.$X)($,e[b],r),(0,d.Fv)($,$);var S=K[0]*$[1]-K[1]*$[0];S>0?S>w&&(w=S,T=b):S<C&&(C=S,x=b)}(0,A.T)(w>0,"leftArea"),(0,A.T)(C<0,"rightArea"),(0,d.bA)(ee,K,p),(0,d.IH)(ee,ee,q),(0,d.bA)(te,K,y),(0,d.IH)(te,te,q),ne[0]=-K[1],ne[1]=K[0];var R=(0,A.ep)(r,e[x],te,(0,d.IH)(X,te,ne),1,i),O=(0,A.ep)(r,e[T],te,X,1,a),D=(0,A.ep)(r,e[T],ee,(0,d.IH)(X,ee,ne),1,o),E=(0,A.ep)(r,e[x],ee,X,1,s);(0,A.T)(R,"rayRay"),(0,A.T)(O,"rayRay"),(0,A.T)(D,"rayRay"),(0,A.T)(E,"rayRay")})(L,u/=l,l,U,F,H,j,z),function(e,t,n,r,i){(0,d.$X)(oe,n,r),(0,d.bA)(oe,oe,.5),se[0]=oe[0],se[1]=oe[1],se[2]=0,se[3]=oe[1],se[4]=-oe[0],se[5]=0,se[6]=oe[0]*oe[0]+oe[1]*oe[1],se[7]=oe[0]*oe[1]-oe[1]*oe[0],se[8]=1,se[re(0,2)]=-(0,d.AK)(ae(se,0),e),se[re(1,2)]=-(0,d.AK)(ae(se,1),e);var a=(0,d.AK)(ae(se,0),n)+se[re(0,2)],o=(0,d.AK)(ae(se,1),n)+se[re(1,2)],s=(0,d.AK)(ae(se,0),r)+se[re(0,2)],u=(0,d.AK)(ae(se,1),r)+se[re(1,2)];a=-(a+s)/(o+u),se[re(0,0)]+=se[re(1,0)]*a,se[re(0,1)]+=se[re(1,1)]*a,se[re(0,2)]+=se[re(1,2)]*a,a=1/((0,d.AK)(ae(se,0),n)+se[re(0,2)]),o=1/((0,d.AK)(ae(se,1),n)+se[re(1,2)]),se[re(0,0)]*=a,se[re(0,1)]*=a,se[re(0,2)]*=a,se[re(1,0)]*=o,se[re(1,1)]*=o,se[re(1,2)]*=o,se[re(2,0)]=se[re(1,0)],se[re(2,1)]=se[re(1,1)],se[re(2,2)]=se[re(1,2)],se[re(1,2)]+=1,a=(0,d.AK)(ae(se,1),t)+se[re(1,2)],o=(0,d.AK)(ae(se,2),t)+se[re(2,2)],s=(0,d.AK)(ae(se,1),n)+se[re(1,2)],u=(0,d.AK)(ae(se,2),n)+se[re(2,2)],a=-.5*(a/o+s/u),se[re(1,0)]+=se[re(2,0)]*a,se[re(1,1)]+=se[re(2,1)]*a,se[re(1,2)]+=se[re(2,2)]*a,a=(0,d.AK)(ae(se,1),t)+se[re(1,2)],o=(0,d.AK)(ae(se,2),t)+se[re(2,2)],s=-o/a,se[re(1,0)]*=s,se[re(1,1)]*=s,se[re(1,2)]*=s,i[0]=se[0],i[1]=se[1],i[2]=0,i[3]=se[2],i[4]=se[3],i[5]=se[4],i[6]=0,i[7]=se[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=se[6],i[13]=se[7],i[14]=0,i[15]=se[8]}(U,F,j,z,i.projectionMatrix),i.projectionMatrix[10]=2/(n-r),i.projectionMatrix[14]=-(n+r)/(n-r)}(n,r,g,m,i.camera),(0,l.Jp)(i.lightMat,i.camera.projectionMatrix,i.camera.viewMatrix);var w=this._textureHeight;i.camera.viewport=[e*w,0,w,w]}},{key:"_setupMatrices",value:function(e,t){(0,l.Jp)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,l.U_)(this._projectionViewInverse,this._projectionView);var n=this._viewingMode===g.JY.Global?e.eye:(0,f.s)(V,0,0,1);(0,l.zB)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],n)}},{key:"_computeCascadeDistances",value:function(e,t,n){var r=n?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,A.E6)(t/e,4)),r);for(var i=(t-e)/this._numCascades,a=Math.pow(t/e,1/this._numCascades),s=e,u=e,l=0;l<this._numCascades+1;++l)this._cascadeDistances[l]=(0,o.t7)(s,u,this.settings.splitSchemeLambda),s*=a,u+=i}},{key:"test",get:function(){}}]),e}(),Z=(0,c.Ue)(),P=(0,y.Ue)(),L=[],N=0;N<8;++N)L.push((0,y.Ue)());var U=(0,h.Ue)(),F=(0,h.Ue)(),H=(0,h.Ue)(),j=(0,h.Ue)(),z=(0,h.Ue)(),V=(0,v.Ue)(),G=[],W=(0,c.Ue)(),B=c.Wd.concat(c.Wd,c.Wd,c.Wd,c.Wd),q=(0,h.Ue)(),J=(0,h.Ue)(),Y=[(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)(),(0,h.Ue)()],K=(0,h.Ue)(),Q=(0,h.Ue)(),X=(0,h.Ue)(),$=(0,h.Ue)(),ee=(0,h.Ue)(),te=(0,h.Ue)(),ne=(0,h.Ue)();function re(e,t){return 3*t+e}var ie=(0,h.Ue)();function ae(e,t){return(0,d.t8)(ie,e[t],e[t+3]),ie}var oe=(0,h.Ue)(),se=(0,u.Ue)()},81341:function(e,t,n){n.d(t,{S:function(){return R}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(7138),c=(n(93169),n(77427)),d=n(27546),h=n(49861),f=(n(32718),n(84936),n(69912)),v=n(6644),p=n(23470),y=n(43449),g=n(37081),m=n(78976),_=n(88153),w=n(54463),C=n(56529),T=n(78289),x=n(41947),b=n(93822),S=n(41139),R=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._pending=new O,r._changes=new m.as,r._materialRenderers=new Map,r._sortedMaterialRenderers=new d.Z,r._geometries=new Map,r._hasHighlights=!1,r._hasWater=!1,r}return(0,a.Z)(n,[{key:"destroy",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.destroy()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materials",get:function(){return this.rendererContext.materials}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccludedDraped",get:function(){return(0,c.oE)(this._materialRenderers,(function(e){return 0!==e.numGeometries&&!e.queryRenderOccludedState(C.yD.Occlude)}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"getMaterialRenderer",value:function(e){return this._materialRenderers.get(e)}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=(0,x.q9)(this._changes),n=!1;return t.forEach((function(t,r){var i=e.getMaterialRenderer(r);if(!i&&t.adds.length>0){var a=new S.A({material:r});a.initializeRenderContext(e.rendererContext.pluginContext,e._materials),i=a,e._materialRenderers.set(r,i),n=!0}i&&(i.modify(t),0===i.numGeometries&&(e._materialRenderers.delete(r),i.destroy(),n=!0))})),this._changes.clear(),n&&this._updateSortedMaterialRenderers(),this._hasHighlights=(0,c.oE)(this._materialRenderers,(function(e){var t=e.produces.get(b.r.DRAPED_MATERIAL);return!!t&&t(g.H_.Highlight)})),this._hasWater=(0,c.oE)(this._materialRenderers,(function(e){var t=e.produces.get(b.r.DRAPED_WATER);return!!t&&t(g.H_.Normal)})),this.notifyChange("updating"),!0}},{key:"addGeometries",value:function(e,t){if(0!==e.length){var n,i=this._validateRenderGeometries(e),a=(0,r.Z)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;this._geometries.set(o.id,o)}}catch(d){a.e(d)}finally{a.f()}var s,u=this._pending.empty,l=(0,r.Z)(i);try{for(l.s();!(s=l.n()).done;){var c=s.value;this._pending.adds.add(c)}}catch(d){l.e(d)}finally{l.f()}u&&this.notifyChange("updating"),t===T.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}}},{key:"removeGeometries",value:function(e,t){var n,i=this._pending.empty,a=this._pending.adds,o=(0,r.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;a.has(s)?(this._pending.removed.add(s),a.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id)}}catch(u){o.e(u)}finally{o.f()}i&&!this._pending.empty&&this.notifyChange("updating"),t===T.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}},{key:"modifyGeometries",value:function(e,t){var n,i=0===this._changes.updates.length,a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(o),s.updateType=t}}catch(u){a.e(u)}finally{a.f()}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case T.$.TRANSFORMATION:case T.$.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case T.$.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}},{key:"updateAnimation",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(n){return t=!!n.updateAnimation&&n.updateAnimation(e)||t})),t}},{key:"shouldRender",value:function(e){return this._sortedMaterialRenderers.some((function(t){return t.prepareTechnique(e)}))}},{key:"render",value:function(e){this._sortedMaterialRenderers.forAll((function(t){var n=t.prepareTechnique(e);null!=n&&t.renderNode(e,n)}))}},{key:"intersect",value:function(e,t,n,r,i){var a=this;return this._geometries.forEach((function(o){if(!r||r(o)){a._intersectRenderGeometry(o,n,t,0,e,i);var s=a.rendererContext.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&a._intersectRenderGeometry(o,n,t,s.range,e,i),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&a._intersectRenderGeometry(o,n,t,-s.range,e,i)),i++}})),i}},{key:"_updateSortedMaterialRenderers",value:function(){this._sortedMaterialRenderers.clear();var e,t=0,n=(0,r.Z)(this._materialRenderers.values());try{for(n.s();!(e=n.n()).done;){var i=e.value;i.drapedPriority=t++,this._sortedMaterialRenderers.push(i)}}catch(a){n.e(a)}finally{n.f()}this._sortedMaterialRenderers.sort((function(e,t){var n,r,i,a;return(null===(n=t.materialReference)||void 0===n?void 0:n.renderPriority)===(null===(r=e.materialReference)||void 0===r?void 0:r.renderPriority)?e.drapedPriority-t.drapedPriority:((null===(i=t.materialReference)||void 0===i?void 0:i.renderPriority)||0)-((null===(a=e.materialReference)||void 0===a?void 0:a.renderPriority)||0)}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"_intersectRenderGeometry",value:function(e,t,n,r,i,a){if(e.visible){var o;r+=e.transformation[12],o=e.transformation[13],A[0]=n[0]-r,A[1]=n[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,i,A,(function(n,r,o){!function(e,t,n,r,i,a,o){var s=new y.T6(a,o,t),u=function(t){t.set(w.q7.OVERLAY,s,e.dist,e.normal,e.transformation,n,r)};if((null==i.results.min.drapedLayerOrder||n>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&u(i.results.min),i.options.store!==w.eC.MIN&&(null==i.results.max.drapedLayerOrder||n<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&u(i.results.max),i.options.store===w.eC.ALL){var l=(0,_.LP)(i.ray);u(l),i.results.all.push(l)}}(t,o,a,e.material.renderPriority,i,e.layerUid,e.graphicUid)}),t)}}},{key:"_notifyGraphicGeometryChanged",value:function(e){if(null!=this.drapeSource.notifyGraphicGeometryChanged){var t,n,i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value.graphicUid;null!=a&&a!==t&&(this.drapeSource.notifyGraphicGeometryChanged(a),t=a)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_notifyGraphicVisibilityChanged",value:function(e){if(null!=this.drapeSource.notifyGraphicVisibilityChanged){var t,n,i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value.graphicUid;null!=a&&a!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(a),t=a)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_validateRenderGeometries",value:function(e){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._validateRenderGeometry(i)}}catch(a){n.e(a)}finally{n.f()}return e}},{key:"_validateRenderGeometry",value:function(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin((0,p.g)(e.boundingSphere))),e}},{key:"test",get:function(){}}]),n}(l.default);(0,u._)([(0,h.Cb)()],R.prototype,"drapeSource",void 0),(0,u._)([(0,h.Cb)()],R.prototype,"updating",null),(0,u._)([(0,h.Cb)()],R.prototype,"rctx",null),(0,u._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"rendererContext",void 0),(0,u._)([(0,h.Cb)()],R.prototype,"_materials",null),(0,u._)([(0,h.Cb)()],R.prototype,"_localOriginFactory",null),(0,u._)([(0,h.Cb)({readOnly:!0})],R.prototype,"isEmpty",null),(0,u._)([(0,h.Cb)()],R.prototype,"_materialRenderers",void 0),(0,u._)([(0,h.Cb)()],R.prototype,"_geometries",void 0),R=(0,u._)([(0,f.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],R);var O=function(){function e(){(0,i.Z)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return(0,a.Z)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}();var A=(0,v.Ue)()},5195:function(e,t,n){n.d(t,{K:function(){return v}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(61863),u=n(82144),l=n(31132),c=n(7566),d=n(27627),h=n(8548),f=n(36207),v=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"initializeProgram",value:function(e){return new d.$(e.rctx,n.shader.get().build(),c.i)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?(0,f.sm)({blending:(0,f.wK)(h.zi.SRC_ALPHA,h.zi.ONE,h.zi.ONE_MINUS_SRC_ALPHA,h.zi.ONE_MINUS_SRC_ALPHA),colorWrite:f.BK}):(0,f.sm)({colorWrite:f.BK})}}]),n}(l.A);v.shader=new u.J(s.a,(function(){return n.e(77026).then(n.bind(n,77026))}))},25049:function(e,t,n){n.d(t,{V:function(){return l}});var r=n(43144),i=n(15671),a=n(60136),o=n(29388),s=n(27366),u=n(33559),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).hasAlpha=!1,e}return(0,r.Z)(n)}(u.m);(0,s._)([(0,u.o)()],l.prototype,"hasAlpha",void 0)},78485:function(e,t,n){var r;n.d(t,{j:function(){return r}}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(r||(r={}))},80658:function(e,t,n){n.d(t,{U:function(){return s}});var r=n(43144),i=n(15671),a=n(60136),o=n(29388),s=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n)}(n(45412).U)},97882:function(e,t,n){n.d(t,{F:function(){return m},e:function(){return _}});var r=n(37762),i=n(15671),a=n(43144),o=n(97326),s=n(60136),u=n(29388),l=n(91505),c=n(100),d=n(92026),h=n(27546),f=n(1395),v=n(79100),p=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"],y=n(78329),g=n(78485),m=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,a){var s,u,d,f,y,m=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";(0,i.Z)(this,n),(y=t.call(this)).stage=e,y.apiLayerUid=m,y.type=v.U.Layer,y.events=new l.Z,y.visible=!0,y.pickable=!0,y.sliceable=!1,y._objects=new h.Z,y._objectsAdded=new h.Z,y._handles=new c.Z,y.apiLayerUid=m,y.visible=null===(s=null===a||void 0===a?void 0:a.visible)||void 0===s||s,y.pickable=null===(u=null===a||void 0===a?void 0:a.pickable)||void 0===u||u,y.updatePolicy=null!==(d=null===a||void 0===a?void 0:a.updatePolicy)&&void 0!==d?d:g.j.ASYNC,y._disableOctree=null!==(f=null===a||void 0===a?void 0:a.disableOctree)&&void 0!==f&&f,e.add((0,o.Z)(y));var _,w=(0,r.Z)(p);try{var C=function(){var t=_.value;y._handles.add(y.events.on(t,(function(n){return e.handleEvent(t,n)})))};for(w.s();!(_=w.n()).done;)C()}catch(T){w.e(T)}finally{w.f()}return y}return(0,a.Z)(n,[{key:"objects",get:function(){return this._objects}},{key:"destroy",value:function(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}},{key:"add",value:function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}},{key:"remove",value:function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}},{key:"addMany",value:function(e){this._objects.pushArray(e);var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){t.value.parentLayer=this}}catch(i){n.e(i)}finally{n.f()}this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}},{key:"removeMany",value:function(e){var t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){n.value.parentLayer=null}}catch(o){i.e(o)}finally{i.f()}if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(var a=0;a<t.length;)this._objectsAdded.removeUnordered(t[a])?(t[a]=t[t.length-1],t.length-=1):++a;this._octree.remove(t)}}}},{key:"sync",value:function(){this.updatePolicy!==g.j.SYNC&&this.stage.syncLayer(this.id)}},{key:"notifyObjectBBChanged",value:function(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}},{key:"getSpatialQueryAccelerator",value:function(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new y.Z((function(e){return e.boundingVolumeWorldSpace.bounds})),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}},{key:"invalidateSpatialQueryAccelerator",value:function(){this._octree=(0,d.SC)(this._octree),this._objectsAdded.clear()}}]),n}(f.c);function _(e){return null!=e&&e.type===v.U.Layer}},41947:function(e,t,n){n.d(t,{Np:function(){return i},YE:function(){return r},q9:function(){return s}});var r,i,a,o=n(78976);function s(e){var t=new Map,n=function(e){var n=t.get(e);return n||(n=new o.t9,t.set(e,n)),n};return e.removes.forAll((function(e){u(e)&&n(e.material).removes.push(e)})),e.adds.forAll((function(e){u(e)&&n(e.material).adds.push(e)})),e.updates.forAll((function(e){u(e.renderGeometry)&&n(e.renderGeometry.material).updates.push(e)})),t}function u(e){return e.geometry.indexCount>=1}(a=r||(r={}))[a.Default=0]="Default",a[a.Screenshot=1]="Screenshot",a[a.ObjectAndLayerID=2]="ObjectAndLayerID",function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(i||(i={}))},17852:function(e,t,n){n.d(t,{p:function(){return i},y:function(){return r}});var r={stableRendering:!1},i={rootOrigin:null}},73059:function(e,t,n){n.d(t,{w:function(){return u}});var r=n(43144),i=n(15671),a=n(60136),o=n(29388),s=n(12400),u=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.Ue)();return(0,i.Z)(this,n),(e=t.call(this)).origin=r,e.slicePlaneLocalOrigin=e.origin,e}return(0,r.Z)(n)}(n(85380).Pf)},91398:function(e,t,n){n.d(t,{t:function(){return u}});var r=n(29439),i=n(37762),a=n(15671),o=n(43144),s=n(95439),u=function(){function e(t,n,r){(0,a.Z)(this,e),this._createTexture=t,this._parametersKey=n,this._repository=new Map,this._orphanCache=r.newCache("procedural-texture-repository:".concat((0,s.D)()),(function(e){return e.dispose()}))}return(0,o.Z)(e,[{key:"destroy",value:function(){var e,t=(0,i.Z)(this._repository);try{for(t.s();!(e=t.n()).done;){var n=(0,r.Z)(e.value,2);n[0];n[1].texture.dispose()}}catch(a){t.e(a)}finally{t.f()}this._repository.clear(),this._orphanCache.destroy()}},{key:"swap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._acquire(e);return this.release(t),n}},{key:"release",value:function(e){if(null!=e){var t=this._parametersKey(e),n=this._repository.get(t);if(n&&(n.refCount--,0===n.refCount)){this._repository.delete(t);var r=n.texture,i=r.usedMemory;this._orphanCache.put(t,r,i)}}}},{key:"_acquire",value:function(e){var t;if(null==e)return null;var n=this._parametersKey(e),r=this._repository.get(n);if(r)return r.refCount++,r.texture;var i=null!==(t=this._orphanCache.pop(n))&&void 0!==t?t:this._createTexture(e),a=new l(i);return this._repository.set(n,a),i}}]),e}(),l=(0,o.Z)((function e(t){(0,a.Z)(this,e),this.texture=t,this.refCount=1}))},58901:function(e,t,n){n.d(t,{U:function(){return G}});var r=n(88301),i=n(61120),a=n(15671),o=n(43144),s=n(60136),u=n(29388),l=n(93169),c=n(32718),d=n(16889),h=n(17842),f=n(13611),v=n(32035),p=n(12400),y=n(86361),g=n(95773),m=n(85981),_=n(55652),w=n(55158),C=n(37081),T=n(23620),x=n(56529),b=n(93822),S=n(97731),R=n(4760),O=n(65964),A=n(33720),D=n(98186),E=n(82144),M=n(31132),k=n(78041),I=n(27627),Z=n(50411),P=n(25920),L=n(8548),N=n(36207),U=new Map([[R.T.POSITION,0],[R.T.PREVPOSITION,1],[R.T.NEXTPOSITION,2],[R.T.SUBDIVISIONFACTOR,3],[R.T.UV0,4],[R.T.COLOR,5],[R.T.COLORFEATUREATTRIBUTE,5],[R.T.SIZE,6],[R.T.SIZEFEATUREATTRIBUTE,6],[R.T.OPACITYFEATUREATTRIBUTE,7],[R.T.OBJECTANDLAYERIDCOLOR,8]]),F=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"initializeProgram",value:function(e){return new I.$(e.rctx,n.shader.get().build(this.configuration),U)}},{key:"_makePipelineState",value:function(e,t){var n=this.configuration,r=e===P.A.NONE,i=e===P.A.FrontFace,a=(0,C._D)(n.output);return(0,N.sm)({blending:n.output===C.H_.Color?r?k.wu:(0,k.j7)(e):null,depthTest:{func:(0,k.Bh)(e)},depthWrite:r?n.writeDepth||a?N.LZ:null:(0,k.K5)(e),drawBuffers:n.output===C.H_.Depth?{buffers:[L.Xg.NONE]}:(0,k.V7)(e),colorWrite:N.BK,stencilWrite:n.hasOccludees?Z.s3:null,stencilTest:n.hasOccludees?t?Z.eD:Z.RY:null,polygonOffset:r||i?n.hasPolygonOffset?z:null:k.E0})}},{key:"initializePipeline",value:function(){var e=this.configuration;if(e.occluder){var t=e.hasPolygonOffset?z:null;this._occluderPipelineTransparent=(0,N.sm)({blending:k.wu,polygonOffset:t,depthTest:Z.zV,depthWrite:null,colorWrite:N.BK,stencilWrite:null,stencilTest:Z.YD,drawBuffers:e.output===C.H_.Depth?{buffers:[L.Xg.NONE]}:null}),this._occluderPipelineOpaque=(0,N.sm)({blending:k.wu,polygonOffset:t,depthTest:Z.zV,depthWrite:null,colorWrite:N.BK,stencilWrite:Z.P7,stencilTest:Z.ii,drawBuffers:e.output===C.H_.Depth?{buffers:[L.Xg.NONE]}:null}),this._occluderPipelineMaskWrite=(0,N.sm)({blending:null,polygonOffset:t,depthTest:Z.JN,depthWrite:null,colorWrite:null,stencilWrite:Z.s3,stencilTest:Z.eD,drawBuffers:e.output===C.H_.Depth?{buffers:[L.Xg.NONE]}:null})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}},{key:"primitiveType",get:function(){return this.configuration.wireframe?L.MX.LINES:L.MX.TRIANGLE_STRIP}},{key:"getPipeline",value:function(e,t,a){return e?this._occludeePipelineState:this.configuration.occluder?a?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:(0,r.Z)((0,i.Z)(n.prototype),"getPipeline",this).call(this)}}]),n}(M.A);F.shader=new E.J(D.R,(function(){return n.e(56279).then(n.bind(n,56279))}));var H,j,z={factor:0,units:-4},V=n(737);(j=H||(H={}))[j.LEFT_JOIN_START=-2]="LEFT_JOIN_START",j[j.LEFT_JOIN_END=-1]="LEFT_JOIN_END",j[j.LEFT_CAP_START=-4]="LEFT_CAP_START",j[j.LEFT_CAP_END=-5]="LEFT_CAP_END",j[j.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",j[j.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",j[j.RIGHT_CAP_START=4]="RIGHT_CAP_START",j[j.RIGHT_CAP_END=5]="RIGHT_CAP_END";var G=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e,new B))._configuration=new V.G,r.produces=new Map([[b.r.OPAQUE_MATERIAL,function(e){return e===C.H_.Highlight||e===C.H_.ObjectAndLayerIdColor||e===C.H_.Color&&r.parameters.renderOccluded===x.yD.OccludeAndTransparentStencil}],[b.r.OPAQUE_NO_SSAO_DEPTH,function(e){return(0,C.BX)(e)}],[b.r.OCCLUDER_MATERIAL,function(e){return(0,C._4)(e)&&r.parameters.renderOccluded===x.yD.OccludeAndTransparentStencil}],[b.r.TRANSPARENT_OCCLUDER_MATERIAL,function(e){return(0,C._4)(e)&&r.parameters.renderOccluded===x.yD.OccludeAndTransparentStencil}],[b.r.TRANSPARENT_MATERIAL,function(e){return e===C.H_.Color&&r.parameters.writeDepth&&r.parameters.renderOccluded!==x.yD.OccludeAndTransparentStencil}],[b.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,function(e){return e===C.H_.Color&&!r.parameters.writeDepth&&r.parameters.renderOccluded!==x.yD.OccludeAndTransparentStencil}],[b.r.DRAPED_MATERIAL,function(e){return(0,C.xs)(e)}]]),r._vertexAttributeLocations=U,r}return(0,o.Z)(n,[{key:"getConfiguration",value:function(e,t){this._configuration.output=e,this._configuration.draped=t.slot===b.r.DRAPED_MATERIAL;var n=null!=this.parameters.stipplePattern&&e!==C.H_.Highlight;return this._configuration.stippleEnabled=n,this._configuration.stippleOffColorEnabled=n&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=n&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===A.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===x.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}},{key:"intersectDraped",value:function(e,t,n,r,i,a){if(n.options.selectionMode){var o=e.attributes.get(R.T.POSITION).data,s=e.attributes.get(R.T.SIZE),u=this.parameters.width;if(this.parameters.vvSize){var l=e.attributes.get(R.T.SIZEFEATUREATTRIBUTE).data[0];u*=(0,d.uZ)(this.parameters.vvSize.offset[0]+l*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else s&&(u*=s.data[0]);for(var c=r[0],h=r[1],f=(u/2+4)*e.screenToWorldRatio,v=Number.MAX_VALUE,p=0,y=0;y<o.length-5;y+=3){var g=o[y],m=o[y+1],_=c-g,w=h-m,C=o[y+3]-g,T=o[y+4]-m,x=(0,d.uZ)((C*_+T*w)/(C*C+T*T),0,1),b=C*x-_,S=T*x-w,O=b*b+S*S;O<v&&(v=O,p=y/3)}v<f*f&&i(a.dist,a.normal,p,!1)}}},{key:"intersect",value:function(e,t,n,r,i,a){if(n.options.selectionMode&&e.visible)if((0,S.kG)(t)){var o=e.attributes,s=o.get(R.T.POSITION).data,u=this.parameters.width;if(this.parameters.vvSize){var l=o.get(R.T.SIZEFEATUREATTRIBUTE).data[0];u*=(0,d.uZ)(this.parameters.vvSize.offset[0]+l*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else o.has(R.T.SIZE)&&(u*=o.get(R.T.SIZE).data[0]);var h=n.camera,p=ee;(0,f.JG)(p,n.point);var y=u*h.pixelRatio/2+4*h.pixelRatio;(0,v.s)(ce[0],p[0]-y,p[1]+y,0),(0,v.s)(ce[1],p[0]+y,p[1]+y,0),(0,v.s)(ce[2],p[0]+y,p[1]-y,0),(0,v.s)(ce[3],p[0]-y,p[1]-y,0);for(var w=0;w<4;w++)if(!h.unprojectFromRenderScreen(ce[w],de[w]))return;(0,_.zk)(h.eye,de[0],de[1],he),(0,_.zk)(h.eye,de[1],de[2],fe),(0,_.zk)(h.eye,de[2],de[3],ve),(0,_.zk)(h.eye,de[3],de[0],pe);for(var C=Number.MAX_VALUE,T=0,x=Y(this.parameters,o)?s.length-2:s.length-5,b=0;b<x;b+=3){K[0]=s[b]+t[12],K[1]=s[b+1]+t[13],K[2]=s[b+2]+t[14];var O=(b+3)%s.length;if(Q[0]=s[O]+t[12],Q[1]=s[O+1]+t[13],Q[2]=s[O+2]+t[14],!((0,_.jH)(he,K)<0&&(0,_.jH)(he,Q)<0||(0,_.jH)(fe,K)<0&&(0,_.jH)(fe,Q)<0||(0,_.jH)(ve,K)<0&&(0,_.jH)(ve,Q)<0||(0,_.jH)(pe,K)<0&&(0,_.jH)(pe,Q)<0)){if(h.projectToRenderScreen(K,te),h.projectToRenderScreen(Q,ne),te[2]<0&&ne[2]>0){(0,v.f)(X,K,Q);var A=h.frustum,D=-(0,_.jH)(A[g.Nu.NEAR],K)/(0,v.m)(X,(0,_.st)(A[g.Nu.NEAR]));(0,v.j)(X,X,D),(0,v.g)(K,K,X),h.projectToRenderScreen(K,te)}else if(te[2]>0&&ne[2]<0){(0,v.f)(X,Q,K);var E=h.frustum,M=-(0,_.jH)(E[g.Nu.NEAR],Q)/(0,v.m)(X,(0,_.st)(E[g.Nu.NEAR]));(0,v.j)(X,X,M),(0,v.g)(Q,Q,X),h.projectToRenderScreen(Q,ne)}else if(te[2]<0&&ne[2]<0)continue;te[2]=0,ne[2]=0;var k=(0,m.Jk)((0,m.zk)(te,ne,ae),p);k<C&&(C=k,(0,v.c)(re,K),(0,v.c)(ie,Q),T=b/3)}}var I=n.rayBegin,Z=n.rayEnd;if(C<y*y){var P=Number.MAX_VALUE;if((0,m.AR)((0,m.zk)(re,ie,ae),(0,m.zk)(I,Z,oe),$)){(0,v.f)($,$,I);var L=(0,v.l)($);(0,v.j)($,$,1/L),P=L/(0,v.p)(I,Z)}a(P,$,T,!1)}}else c.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")}},{key:"_layout",get:function(){var e=(0,w.U$)().vec3f(R.T.POSITION).vec3f(R.T.PREVPOSITION).vec3f(R.T.NEXTPOSITION).f32(R.T.SUBDIVISIONFACTOR).vec2f(R.T.UV0);return this.parameters.vvSize?e.f32(R.T.SIZEFEATUREATTRIBUTE):e.f32(R.T.SIZE),this.parameters.vvColor?e.f32(R.T.COLORFEATUREATTRIBUTE):e.vec4f(R.T.COLOR),this.parameters.vvOpacity&&e.f32(R.T.OPACITYFEATUREATTRIBUTE),(0,l.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(R.T.OBJECTANDLAYERIDCOLOR),e}},{key:"createBufferWriter",value:function(){return new q(this._layout,this.parameters)}},{key:"createGLMaterial",value:function(e){return new W(e)}},{key:"validateParameters",value:function(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}]),n}(x.F5),W=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments))._stipplePattern=null,e}return(0,o.Z)(n,[{key:"dispose",value:function(){(0,r.Z)((0,i.Z)(n.prototype),"dispose",this).call(this),this._stippleTextures.release(this._stipplePattern),this._stipplePattern=null}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){this._output===C.H_.Color&&this._updateOccludeeState(e);var t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextures.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(F,e)}}]),n}(T.Z),B=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).width=0,e.color=y.hq,e.join="miter",e.cap=V.R.BUTT,e.miterLimit=5,e.writeDepth=!0,e.hasPolygonOffset=!1,e.stippleTexture=null,e.stipplePreferContinuous=!0,e.markerParameters=null,e.markerScale=1,e.hasSlicePlane=!1,e.vvFastUpdate=!1,e.isClosed=!1,e.falloff=0,e.innerWidth=0,e.hasOccludees=!1,e.wireframe=!1,e}return(0,o.Z)(n)}(O.n),q=function(){function e(t,n){(0,a.Z)(this,e),this.vertexBufferLayout=t,this._parameters=n,this.numJoinSubdivisions=0;var r=n.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=D.r+r}}return(0,o.Z)(e,[{key:"_isClosed",value:function(e){return Y(this._parameters,e.attributes)}},{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){var t=e.attributes.get(R.T.POSITION).indices.length/2+1,n=this._isClosed(e),r=n?2:4;return r+=((n?t:t-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this._parameters.wireframe&&(r=2+4*(r-2)),r}},{key:"write",value:function(e,t,n,r,i){var a,o,s,u,c,d=se,h=ue,f=le,p=n.attributes.get(R.T.POSITION),y=p.indices,g=p.data.length/3,m=null===(a=n.attributes.get(R.T.DISTANCETOSTART))||void 0===a?void 0:a.data;y&&y.length!==2*(g-1)&&console.warn("RibbonLineMaterial does not support indices");var _=null!==(o=null!==(s=null===(u=n.attributes.get(R.T.SIZEFEATUREATTRIBUTE))||void 0===u?void 0:u.data[0])&&void 0!==s?s:null===(c=n.attributes.get(R.T.SIZE))||void 0===c?void 0:c.data[0])&&void 0!==o?o:1,w=[1,1,1,1],C=0,T=this.vertexBufferLayout.fields.has(R.T.COLORFEATUREATTRIBUTE);T?C=n.attributes.get(R.T.COLORFEATUREATTRIBUTE).data[0]:n.attributes.has(R.T.COLOR)&&(w=n.attributes.get(R.T.COLOR).data);var x=(0,l.Z)("enable-feature:objectAndLayerId-rendering")?n.objectAndLayerIdColor:null,b=this.vertexBufferLayout.fields.has(R.T.OPACITYFEATUREATTRIBUTE),S=b?n.attributes.get(R.T.OPACITYFEATUREATTRIBUTE).data[0]:0,O=new Float32Array(r.buffer),A=(0,l.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(r.buffer):null,D=this.vertexBufferLayout.stride/4,E=i*D,M=E,k=0,I=m?function(e,t,n){return k=m[n]}:function(e,t,n){return k+=(0,v.p)(e,t)},Z=(0,l.Z)("enable-feature:objectAndLayerId-rendering"),P=function(e,t,n,r,i,a,o){if(O[E++]=t[0],O[E++]=t[1],O[E++]=t[2],O[E++]=e[0],O[E++]=e[1],O[E++]=e[2],O[E++]=n[0],O[E++]=n[1],O[E++]=n[2],O[E++]=r,O[E++]=o,O[E++]=i,O[E++]=_,T)O[E++]=C;else{var s=Math.min(4*a,w.length-4);O[E++]=w[s],O[E++]=w[s+1],O[E++]=w[s+2],O[E++]=w[s+3]}b&&(O[E++]=S),Z&&(null!=x&&(A[4*E]=x[0],A[4*E+1]=x[1],A[4*E+2]=x[2],A[4*E+3]=x[3]),E++)};E+=D,(0,v.s)(h,p.data[0],p.data[1],p.data[2]),e&&(0,v.h)(h,h,e);var L=this._isClosed(n);if(L){var N=p.data.length-3;(0,v.s)(d,p.data[N],p.data[N+1],p.data[N+2]),e&&(0,v.h)(d,d,e)}else(0,v.s)(f,p.data[3],p.data[4],p.data[5]),e&&(0,v.h)(f,f,e),P(h,h,f,1,H.LEFT_CAP_START,0,0),P(h,h,f,1,H.RIGHT_CAP_START,0,0),(0,v.c)(d,h),(0,v.c)(h,f);for(var U=L?0:1,F=L?g:g-1,j=U;j<F;j++){var z=(j+1)%g*3;(0,v.s)(f,p.data[z],p.data[z+1],p.data[z+2]),e&&(0,v.h)(f,f,e),I(d,h,j),P(d,h,f,0,H.LEFT_JOIN_END,j,k),P(d,h,f,0,H.RIGHT_JOIN_END,j,k);for(var V=this.numJoinSubdivisions,G=0;G<V;++G){var W=(G+1)/(V+1);P(d,h,f,W,H.LEFT_JOIN_END,j,k),P(d,h,f,W,H.RIGHT_JOIN_END,j,k)}P(d,h,f,1,H.LEFT_JOIN_START,j,k),P(d,h,f,1,H.RIGHT_JOIN_START,j,k),(0,v.c)(d,h),(0,v.c)(h,f)}L?((0,v.s)(f,p.data[3],p.data[4],p.data[5]),e&&(0,v.h)(f,f,e),k=I(d,h,F),P(d,h,f,0,H.LEFT_JOIN_END,U,k),P(d,h,f,0,H.RIGHT_JOIN_END,U,k)):(k=I(d,h,F),P(d,h,h,0,H.LEFT_CAP_END,F,k),P(d,h,h,0,H.RIGHT_CAP_END,F,k)),J(O,M+D,O,M,D),E=J(O,E-D,O,E,D),this._parameters.wireframe&&this._addWireframeVertices(r,M,E,D)}},{key:"_addWireframeVertices",value:function(e,t,n,r){for(var i=new Float32Array(e.buffer,n*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,n-t),o=0,s=function(e){return o=J(a,e,i,o,r)},u=0;u<a.length-1;u+=2*r)s(u),s(u+2*r),s(u+1*r),s(u+2*r),s(u+1*r),s(u+3*r)}}]),e}();function J(e,t,n,r,i){for(var a=0;a<i;a++)n[r++]=e[t++];return r}function Y(e,t){return!!e.isClosed&&t.get(R.T.POSITION).indices.length>2}var K=(0,p.Ue)(),Q=(0,p.Ue)(),X=(0,p.Ue)(),$=(0,p.Ue)(),ee=(0,p.Ue)(),te=(0,h.J$)(),ne=(0,h.J$)(),re=(0,p.Ue)(),ie=(0,p.Ue)(),ae=(0,m.Ue)(),oe=(0,m.Ue)(),se=(0,p.Ue)(),ue=(0,p.Ue)(),le=(0,p.Ue)(),ce=[(0,h.J$)(),(0,h.J$)(),(0,h.J$)(),(0,h.J$)()],de=[(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)(),(0,p.Ue)()],he=(0,_.Ue)(),fe=(0,_.Ue)(),ve=(0,_.Ue)(),pe=(0,_.Ue)()},41139:function(e,t,n){n.d(t,{A:function(){return H}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(27366),l=n(63780),c=(n(93169),n(77427)),d=n(16889),h=n(92026),f=n(59447),v=n(27546),p=n(49861),y=(n(32718),n(69912)),g=n(29134),m=n(7025),_=n(50256),w=n(37081),C=n(70374),T=n(94425),x=n(78289),b=n(93822),S=n(97731),R=n(73059),O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,i.Z)(this,e),this.from=t,this.to=n}return(0,a.Z)(e,[{key:"numElements",get:function(){return this.to-this.from}}]),e}();function A(e){var t=new Map;e.forAll((function(e){return t.set(e.from,e)}));for(var n=!0;n;){n=!1;for(var r=0;r<e.length;++r){var i=e.data[r],a=t.get(i.to);if(!a)return;i.to=a.to,t.delete(a.from),e.removeUnordered(a),n=!0}}}var D=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this,r,a)).geometry=e,o}return(0,a.Z)(n,[{key:"isVisible",get:function(){return this.geometry.visible}},{key:"hasHighlights",get:function(){return null!=this.geometry.highlights&&this.isVisible}},{key:"hasOccludees",get:function(){return null!=this.geometry.occludees}}]),n}(O),E=(0,a.Z)((function e(){(0,i.Z)(this,e),this.first=0,this.count=0})),M=function(){function e(){(0,i.Z)(this,e),this._numElements=0,this._instances=new Map,this.holes=new v.Z({allocator:function(e){return e||new O},deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=k(),this.drawCommandsHighlight=k(),this.drawCommandsOccludees=k(),this.drawCommandsShadowHighlightRest=k()}return(0,a.Z)(e,[{key:"numElements",get:function(){return this._numElements}},{key:"instances",get:function(){return this._instances}},{key:"addInstance",value:function(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}},{key:"deleteInstance",value:function(e){var t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}},{key:"updateInstance",value:function(e,t,n){var r=this._instances.get(e);r&&(this._numElements-=r.numElements,r.from=t,r.to=n,this._numElements+=r.numElements)}},{key:"updateDrawState",value:function(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}},{key:"updateDrawCommands",value:function(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0!==this._instances.size){if(!this.needsMultipleCommands()){var t=this.drawCommandsDefault.pushNew(),n=this.holes.front();return null!=this.vao&&1===this.holes.length&&n.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=n.from)):(t.first=1/0,t.count=0,this._instances.forEach((function(e){t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}var i,a=Array.from(this._instances.values()).sort((function(e,t){return e.from===t.from?e.to-t.to:e.from-t.from})),o=(0,r.Z)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.isVisible&&(I(s.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,s),I(s.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,s))}}catch(u){o.e(u)}finally{o.f()}}}},{key:"needsMultipleCommands",value:function(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}]),e}();function k(){return new v.Z({allocator:function(e){return e||new E},deallocator:function(e){return e}})}function I(e,t){var n=e.back();if(null==n){var r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(n,t)){var i=t.from-n.first+t.numElements;n.count=i}else{var a=e.pushNew();a.first=t.from,a.count=t.numElements}}var Z=function(){function e(t){(0,i.Z)(this,e),this.origin=t,this.buffers=new Array}return(0,a.Z)(e,[{key:"dispose",value:function(){this.buffers.forEach((function(e){return e.vao.dispose()})),this.buffers.length=0}},{key:"findBuffer",value:function(e){return this.buffers.find((function(t){return t.instances.has(e)}))}}]),e}(),P=n(76861),L=n(80658),N=n(44070),U=n(8548),F=function(){function e(t,n,r){(0,i.Z)(this,e),this._rctx=t,this._locations=n,this._layout=r,this._cache=new P.N(t.newCache,"VAOCache")}return(0,a.Z)(e,[{key:"dispose",value:function(){this._cache.destroy()}},{key:"newVao",value:function(e){var t=e.toString(),n=this._cache.pop(t);return n||((n=new L.U(this._rctx,this._locations,{geometry:this._layout},{geometry:N.f.createVertex(this._rctx,U.l1.STATIC_DRAW)})).vertexBuffers.geometry.setSize(e),n)}},{key:"deleteVao",value:function(e){if(null!=e){var t=e.byteSize.toString();this._cache.put(t,e)}}}]),e}(),H=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._vaoCache=null,r._glMaterials=null,r._bufferWriter=null,r._dataByOrigin=new Map,r._hasHighlights=!1,r._hasOccludees=!1,r._produces=new Map,r.drapedPriority=0,r}return(0,a.Z)(n,[{key:"destroy",value:function(){this._glMaterials=(0,h.M2)(this._glMaterials),this._dataByOrigin.forEach((function(e){return e.dispose()})),this._dataByOrigin.clear(),this._vaoCache=(0,h.M2)(this._vaoCache)}},{key:"initialize",value:function(){var e=this;this.material.produces.forEach((function(t,n){e._produces.set(n,(function(n){return!(0===e._dataByOrigin.size||!(n!==w.H_.Highlight&&n!==w.H_.ShadowHighlight||e._hasHighlights))&&t(n)}))}))}},{key:"produces",get:function(){return this._produces}},{key:"initializeRenderContext",value:function(e,t){var n=e.renderContext.rctx;this._glMaterials=new T.p(this.material,null!==t&&void 0!==t?t:e.materials),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new F(n,this.material.vertexAttributeLocations,(0,_.K)(this._bufferWriter.vertexBufferLayout))}},{key:"uninitializeRenderContext",value:function(){}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"isDecoration",get:function(){return this.material.parameters.isDecoration}},{key:"queryRenderOccludedState",value:function(e){return this.material.queryRenderOccludedState(e)}},{key:"materialReference",get:function(){return this.material}},{key:"numGeometries",get:function(){var e=0;return this._dataByOrigin.forEach((function(t){return e+=t.buffers.reduce((function(e,t){return e+t.instances.size}),0)})),e}},{key:"usedMemory",get:function(){var e=0;return this._dataByOrigin.forEach((function(t){return e+=t.buffers.reduce((function(e,t){return e+t.vao.usedMemory}),0)})),e}},{key:"forEachGeometry",value:function(e){this._dataByOrigin.forEach((function(t){return t.buffers.forEach((function(t){return t.instances.forEach((function(t){return e(t.geometry)}))}))}))}},{key:"modify",value:function(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}},{key:"_updateGeometries",value:function(e){var t=this._bufferWriter;if(null!==t){var n,i=t.vertexBufferLayout.stride/4,a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.renderGeometry,u=this._dataByOrigin.get(s.localOrigin.id),l=null===u||void 0===u?void 0:u.findBuffer(s.id);if(null==l)return;var c=l.instances.get(s.id);if(o.updateType&(x.$.GEOMETRY|x.$.TRANSFORMATION)){var d=X(t.elementCount(c.geometry.geometry)*i),h=t.vertexBufferLayout.createView(d.buffer);this._writeGeometry(s,h,0),l.vao.vertexBuffers.geometry.setSubData(d,c.from*i,0,c.numElements*i)}o.updateType&(x.$.HIGHLIGHT|x.$.OCCLUDEE|x.$.VISIBILITY)&&(l.drawCommandsDirty=!0)}}catch(f){a.e(f)}finally{a.f()}}}},{key:"_computeDeltas",value:function(e,t){var n,i=new f.r,a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.localOrigin;if(null!=s){var u=i.get(s.id,null);null==u&&(u=new j(s.vec3),i.set(s.id,null,u)),u.changes.push(o)}}}catch(g){a.e(g)}finally{a.f()}var l,c=(0,r.Z)(t);try{for(c.s();!(l=c.n()).done;){var d=l.value,h=d.localOrigin;if(null!=h){var v=this._dataByOrigin.get(h.id),p=null===v||void 0===v?void 0:v.findBuffer(d.id);if(null!=p){var y=i.get(h.id,p);null==y&&(y=new j(h.vec3),i.set(h.id,p,y)),y.changes.push(d)}}}}catch(g){c.e(g)}finally{c.f()}return i}},{key:"_addAndRemoveGeometries",value:function(e,t){var n=this;if(null!==this._bufferWriter&&null!==this._vaoCache){var r=this._bufferWriter,i=this._dataByOrigin,a=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach((function(e,t){var s=e.get(null),u=null!=s?s.changes:[];o.delete(t,null);var c=i.get(t);if(e.forEach((function(e,s){if(o.delete(t,s),null!=s){if(s.instances.size===e.changes.length)return n._vaoCache.deleteVao(s.vao),(0,l.e$)(c.buffers,s),void(0===c.buffers.length&&0===u.length&&i.delete(t));var d=s.numElements,h=s.vao.byteSize/4,f=u.reduce((function(e,t){return e+r.elementCount(t.geometry)}),0),v=e.changes.reduce((function(e,t){return e+r.elementCount(t.geometry)}),0),p=Math.min((d+f-v)*a,K),y=p>h;p>q&&p<h/2?(e.changes.forEach((function(e){var t=e.id;return s.deleteInstance(t)})),s.instances.forEach((function(e){var t=e.geometry;return u.push(t)})),n._vaoCache.deleteVao(s.vao),(0,l.e$)(c.buffers,s)):y?n._applyAndRebuild(s,u,e):n._applyRemoves(s,e)}else(0,S.hu)(!1,"No VAO for removed geometries")})),u.length>0)for(null==c&&(c=new Z(s.origin),i.set(t,c)),c.buffers.forEach((function(e){return n._applyAdds(e,u)}));u.length>0;)c.buffers.push(n._applyAndRebuild(new M,u,null))}))}}},{key:"_updateDrawCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.buffers.forEach((function(t){t.drawCommandsDirty&&(t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,(0,c.oE)(t.instances,(function(e){return t.updateDrawState(e),t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees})),t.updateDrawCommands(e._bufferWriter.vertexBufferLayout.stride)),e._hasHighlights=e._hasHighlights||t.hasHighlights,e._hasOccludees=e._hasOccludees||t.hasOccludees}))}))}},{key:"_applyAndRebuild",value:function(e,t,n){var i=this;if(null!=n){var a,o=(0,r.Z)(n.changes);try{for(o.s();!(a=o.n()).done;){var s=a.value;e.deleteInstance(s.id)}}catch(C){o.e(C)}finally{o.f()}}for(var u=this._bufferWriter,l=u.vertexBufferLayout.stride,c=l/4,d=Math.floor(K/c),h=e.numElements;t.length>0;){var f=t.pop(),v=u.elementCount(f.geometry);if(h+v>d&&h>0){t.push(f);break}h+=v;var p=new D(f,0,0);(0,S.hu)(null==e.instances.get(f.id)),e.addInstance(f.id,p)}var y=h*c,g=X(y),m=u.vertexBufferLayout.createView(g.buffer),_=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((function(t,n){i._writeGeometry(t.geometry,m,_);var r=_;_+=u.elementCount(t.geometry.geometry),e.updateInstance(n,r,_),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao($(y)),e.vao.vertexBuffers.geometry.setSubData(g,0,0,_*c),e.holes.clear();var w=e.holes.pushNew();return w.from=_,w.to=Math.floor(e.vao.byteSize/l),e.updateDrawCommands(l),e}},{key:"_applyRemoves",value:function(e,t){if(0!==t.changes.length&&null!==this._bufferWriter){var n,i=(0,r.Z)(t.changes);try{for(i.s();!(n=i.n()).done;){var a=n.value.id,o=e.instances.get(a);if(o){e.deleteInstance(a);var s=B.back();if(s){if(s.to===o.from){s.to=o.to;continue}if(s.from===o.to){s.from=o.from;continue}}var u=B.pushNew();u.from=o.from,u.to=o.to}}}catch(f){i.e(f)}finally{i.f()}A(B);var l=this._bufferWriter.vertexBufferLayout.stride/4,c=B.reduce((function(e,t){return Math.max(e,t.numElements)}),0)*l,d=X(c);d.fill(0,0,c);var h=e.vao.vertexBuffers.geometry;B.forAll((function(e){return h.setSubData(d,e.from*l,0,e.numElements*l)})),e.holes.pushArray(B.data,B.length),B.forAll((function(e,t){return B.data[t]=null})),B.clear(),e.drawCommandsDirty=!0}}},{key:"_applyAdds",value:function(e,t){var n=this;if(0!==t.length&&null!==this._bufferWriter)if(function(e){return null!=e.vao}(e)){var i=this._bufferWriter,a=i.vertexBufferLayout.stride/4,o=e.numElements,s=t.reduce((function(e,t){return e+i.elementCount(t.geometry)}),0),u=Math.min((o+s)*a,K),c=4*u;if(e.vao.byteSize<$(K-q)&&c>e.vao.byteSize)this._applyAndRebuild(e,t,null);else{A(e.holes);var d,h=new Array,f=(0,r.Z)(t);try{for(f.s();!(d=f.n()).done;){var v=d.value,p=i.elementCount(v.geometry),y=z(e.holes,p);h.push(y)}}catch(b){f.e(b)}finally{f.f()}var g=e.vao.vertexBuffers.geometry,m=0,_=0,w=0,C=X(u),T=i.vertexBufferLayout.createView(C.buffer);t.forEach((function(t,r){var o=h[r];if(null!=o){if(w!==o){var s=w-_;s>0&&g.setSubData(C,_*a,0,s*a),_=o,m=0}var u=i.elementCount(t.geometry);n._writeGeometry(t,T,m),m+=u,w=o+u;var l=new D(t,o,o+u);(0,S.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,l),e.drawCommandsDirty=!0}}));var x=w-_;x>0&&g.setSubData(C,_*a,0,x*a),(0,l.hv)(t,(function(e,t){return null==h[t]}))}}else this._applyAndRebuild(e,t,null)}},{key:"_writeGeometry",value:function(e,t,n){if(null!==this._bufferWriter){var r=e.localOrigin.vec3;(0,S.u_)(V,-r[0],-r[1],-r[2]);var i=(0,g.Jp)(G,V,e.transformation);(0,g.U_)(W,i),(0,g.p4)(W,W),this._bufferWriter.write(i,W,e.geometry,t,n)}}},{key:"updateAnimation",value:function(e){return this.material.update(e)}},{key:"prepareTechnique",value:function(e){if(!this.material.shouldRender(e))return null;var t=e.output,n=e.bindParameters,i=this.material.produces.get(n.slot);if(null===i||void 0===i||!i(t))return null;var a=t===w.H_.Highlight||t===w.H_.ShadowHighlight;if(a&&!this._hasHighlights)return null;var o,s=t===w.H_.ShadowExcludeHighlight,u=!(a||s),l=(0,r.Z)(this._dataByOrigin.values());try{for(l.s();!(o=l.n()).done;){var c,d=o.value,h=(0,r.Z)(d.buffers);try{for(h.s();!(c=h.n()).done;){var f=c.value;if(!a||f.hasHighlights){var v=(a?f.drawCommandsHighlight:s&&f.needsMultipleCommands()?f.drawCommandsShadowHighlightRest:f.drawCommandsDefault)||null,p=u&&f.drawCommandsOccludees||null;if(null!==v&&void 0!==v&&v.length||null!==p&&void 0!==p&&p.length){var y=this._glMaterials.load(e.rctx,n.slot,t),g=null!=y?y.beginSlot(n):null;if(null!=g)return g}}}}catch(m){h.e(m)}finally{h.f()}}}catch(m){l.e(m)}finally{l.f()}return null}},{key:"renderNode",value:function(e,t){var n=e.output,i=e.bindParameters,a=n===w.H_.Highlight||n===w.H_.ShadowHighlight,o=n===w.H_.ShadowExcludeHighlight,s=!(a||o),u=i.slot===b.r.OCCLUDER_MATERIAL,l=i.slot===b.r.TRANSPARENT_OCCLUDER_MATERIAL,c=e.rctx;c.runAppleAmdDriverHelper(),c.bindTechnique(t,i,this.material.parameters);var d,h=(0,r.Z)(this._dataByOrigin.values());try{for(h.s();!(d=h.n()).done;){var f,v=d.value,p=(0,r.Z)(v.buffers);try{for(p.s();!(f=p.n()).done;){var y=f.value;if(!a||y.hasHighlights){var g=(a?y.drawCommandsHighlight:o&&y.needsMultipleCommands()?y.drawCommandsShadowHighlightRest:y.drawCommandsDefault)||null,m=s&&y.drawCommandsOccludees||null;(null!==g&&void 0!==g&&g.length||null!==m&&void 0!==m&&m.length)&&(t.program.bindDraw(new R.w(v.origin),i,this.material.parameters),t.ensureAttributeLocations(y.vao),c.bindVAO(y.vao),null!==g&&void 0!==g&&g.length&&(c.setPipelineState(t.getPipeline(!1,u,l)),g.forAll((function(e){return c.drawArrays(t.primitiveType,e.first,e.count)}))),(null===m||void 0===m?void 0:m.length)&&(c.setPipelineState(t.getPipeline(!0,u,l)),m.forAll((function(e){return c.drawArrays(t.primitiveType,e.first,e.count)}))))}}}catch(_){p.e(_)}finally{p.f()}}}catch(_){h.e(_)}finally{h.f()}}},{key:"test",get:function(){}}]),n}(C.He);(0,u._)([(0,p.Cb)({constructOnly:!0})],H.prototype,"material",void 0),H=(0,u._)([(0,y.j)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],H);var j=(0,a.Z)((function e(t){(0,i.Z)(this,e),this.origin=t,this.changes=new Array}));function z(e,t){var n;if(!e.some((function(e){return!(e.numElements<t)&&(n=e,!0)})))return null;var r=n.from;return n.from+=t,n.from>=n.to&&e.removeUnordered(n),r}var V=(0,m.Ue)(),G=(0,m.Ue)(),W=(0,m.Ue)(),B=new v.Z({allocator:function(e){return e||new O},deallocator:null}),q=65536,J=4*q,Y=16777216,K=Y/4,Q=new Float32Array(q);function X(e){return Q.length<e&&(Q=new Float32Array(e)),Q}function $(e){var t=4*e;return t<=1024?1024:t<J?(0,d.Sf)(t):Math.max(Math.min(Math.ceil(1.5*t/J)*J,Y),t)}},5921:function(e,t,n){n.d(t,{$A:function(){return f},kW:function(){return c},kj:function(){return v}});var r=n(93433),i=n(37762),a=n(46228),o=n(91398),s=n(8548),u=n(57808),l=n(52311);function c(e,t){return new o.t((function(t){var n=d(t),r=n.encodedData,i=n.textureSize,a=new l.X;return a.internalFormat=s.VI.RGBA,a.width=i,a.height=1,a.wrapMode=s.e8.REPEAT,new u.x(e,a,r)}),(function(e){return"".concat(e.pattern.join(","),"-r").concat(e.pixelRatio)}),t)}function d(e){var t,n=h(e),o=1/e.pixelRatio,s=f(e),u=v(e),l=(Math.floor(.5*(u-1))+.5)*o,c=[],d=1,p=(0,i.Z)(n);try{for(p.s();!(t=p.n()).done;){for(var y=t.value,g=0;g<y;g++){var m=d*(Math.min(g,y-1-g)+.5)*o/l*.5+.5;c.push(m)}d=-d}}catch(R){p.e(R)}finally{p.f()}var _,w=Math.round(n[0]/2),C=[].concat((0,r.Z)(c.slice(w)),(0,r.Z)(c.slice(0,w))),T=new Uint8Array(4*s),x=0,b=(0,i.Z)(C);try{for(b.s();!(_=b.n()).done;){var S=_.value;(0,a.I)(S,T,x),x+=4}}catch(R){b.e(R)}finally{b.f()}return{encodedData:T,textureSize:s}}function h(e){return e.pattern.map((function(t){return Math.round(t*e.pixelRatio)}))}function f(e){if(null==e)return 1;var t=h(e);return Math.floor(t.reduce((function(e,t){return e+t})))}function v(e){return h(e).reduce((function(e,t){return Math.max(e,t)}))}},33720:function(e,t,n){n.d(t,{I9:function(){return r},PI:function(){return p},i5:function(){return i}});var r,i,a,o=n(15671),s=n(43144),u=n(60136),l=n(29388),c=n(27366),d=n(37081),h=n(33559),f=n(25920),v=n(8883);(a=r||(r={}))[a.Draped=0]="Draped",a[a.Screen=1]="Screen",a[a.World=2]="World",a[a.COUNT=3]="COUNT",function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(i||(i={}));var p=function(e){(0,u.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).output=d.H_.Color,e.transparencyPassType=f.A.NONE,e.occluder=!1,e.hasSlicePlane=!1,e.writeDepth=!1,e.space=r.Screen,e.hideOnShortSegments=!1,e.hasCap=!1,e.anchor=i.Center,e.hasTip=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.hasOccludees=!1,e.multipassEnabled=!1,e.cullAboveGround=!1,e}return(0,s.Z)(n,[{key:"draped",get:function(){return this.space===r.Draped}}]),n}(v.W);(0,c._)([(0,h.o)({count:d.H_.COUNT})],p.prototype,"output",void 0),(0,c._)([(0,h.o)({count:f.A.COUNT})],p.prototype,"transparencyPassType",void 0),(0,c._)([(0,h.o)()],p.prototype,"occluder",void 0),(0,c._)([(0,h.o)()],p.prototype,"hasSlicePlane",void 0),(0,c._)([(0,h.o)()],p.prototype,"writeDepth",void 0),(0,c._)([(0,h.o)({count:r.COUNT})],p.prototype,"space",void 0),(0,c._)([(0,h.o)()],p.prototype,"hideOnShortSegments",void 0),(0,c._)([(0,h.o)()],p.prototype,"hasCap",void 0),(0,c._)([(0,h.o)({count:i.COUNT})],p.prototype,"anchor",void 0),(0,c._)([(0,h.o)()],p.prototype,"hasTip",void 0),(0,c._)([(0,h.o)()],p.prototype,"vvSize",void 0),(0,c._)([(0,h.o)()],p.prototype,"vvColor",void 0),(0,c._)([(0,h.o)()],p.prototype,"vvOpacity",void 0),(0,c._)([(0,h.o)()],p.prototype,"hasOccludees",void 0),(0,c._)([(0,h.o)()],p.prototype,"multipassEnabled",void 0),(0,c._)([(0,h.o)()],p.prototype,"cullAboveGround",void 0),(0,c._)([(0,h.o)({constValue:!1})],p.prototype,"occlusionPass",void 0),(0,c._)([(0,h.o)({constValue:!0})],p.prototype,"hasVvInstancing",void 0),(0,c._)([(0,h.o)({constValue:!0})],p.prototype,"hasSliceTranslatedView",void 0)},737:function(e,t,n){n.d(t,{G:function(){return v},R:function(){return r}});var r,i,a=n(43144),o=n(15671),s=n(60136),u=n(29388),l=n(27366),c=n(37081),d=n(33559),h=n(25920),f=n(8883);(i=r||(r={}))[i.BUTT=0]="BUTT",i[i.SQUARE=1]="SQUARE",i[i.ROUND=2]="ROUND",i[i.COUNT=3]="COUNT";var v=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).output=c.H_.Color,e.capType=r.BUTT,e.transparencyPassType=h.A.NONE,e.occluder=!1,e.hasSlicePlane=!1,e.hasPolygonOffset=!1,e.writeDepth=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stipplePreferContinuous=!0,e.roundJoins=!1,e.applyMarkerOffset=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.falloffEnabled=!1,e.innerColorEnabled=!1,e.hasOccludees=!1,e.multipassEnabled=!1,e.cullAboveGround=!1,e.wireframe=!1,e.objectAndLayerIdColorInstanced=!1,e}return(0,a.Z)(n)}(f.W);(0,l._)([(0,d.o)({count:c.H_.COUNT})],v.prototype,"output",void 0),(0,l._)([(0,d.o)({count:r.COUNT})],v.prototype,"capType",void 0),(0,l._)([(0,d.o)({count:h.A.COUNT})],v.prototype,"transparencyPassType",void 0),(0,l._)([(0,d.o)()],v.prototype,"occluder",void 0),(0,l._)([(0,d.o)()],v.prototype,"hasSlicePlane",void 0),(0,l._)([(0,d.o)()],v.prototype,"hasPolygonOffset",void 0),(0,l._)([(0,d.o)()],v.prototype,"writeDepth",void 0),(0,l._)([(0,d.o)()],v.prototype,"draped",void 0),(0,l._)([(0,d.o)()],v.prototype,"stippleEnabled",void 0),(0,l._)([(0,d.o)()],v.prototype,"stippleOffColorEnabled",void 0),(0,l._)([(0,d.o)()],v.prototype,"stipplePreferContinuous",void 0),(0,l._)([(0,d.o)()],v.prototype,"roundJoins",void 0),(0,l._)([(0,d.o)()],v.prototype,"applyMarkerOffset",void 0),(0,l._)([(0,d.o)()],v.prototype,"vvSize",void 0),(0,l._)([(0,d.o)()],v.prototype,"vvColor",void 0),(0,l._)([(0,d.o)()],v.prototype,"vvOpacity",void 0),(0,l._)([(0,d.o)()],v.prototype,"falloffEnabled",void 0),(0,l._)([(0,d.o)()],v.prototype,"innerColorEnabled",void 0),(0,l._)([(0,d.o)()],v.prototype,"hasOccludees",void 0),(0,l._)([(0,d.o)()],v.prototype,"multipassEnabled",void 0),(0,l._)([(0,d.o)()],v.prototype,"cullAboveGround",void 0),(0,l._)([(0,d.o)()],v.prototype,"wireframe",void 0),(0,l._)([(0,d.o)()],v.prototype,"objectAndLayerIdColorInstanced",void 0),(0,l._)([(0,d.o)({constValue:!1})],v.prototype,"occlusionPass",void 0),(0,l._)([(0,d.o)({constValue:!0})],v.prototype,"hasVvInstancing",void 0),(0,l._)([(0,d.o)({constValue:!0})],v.prototype,"hasSliceTranslatedView",void 0)},81296:function(e,t,n){n.d(t,{Z:function(){return D}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(27366),u=n(7138),l=n(32718),c=n(16889),d=n(17842),h=n(49861),f=(n(93169),n(84936),n(69912)),v=n(29134),p=n(7025),y=n(13611),g=n(6644),m=n(32035),_=n(12400),w=n(19093),C=n(86361),T=n(95773),x=n(40885),b=n(40927),S=n(50951);var R,O=n(41947),A=R=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._ray=(0,x.Ue)(),i._viewport=(0,C.al)(0,0,1,1),i._padding=(0,C.al)(0,0,0,0),i._fov=55/180*Math.PI,i._nearFar=(0,g.al)(1,1e3),i._viewDirty=!0,i._viewMatrix=(0,p.Ue)(),i._viewProjectionDirty=!0,i._viewProjectionMatrix=(0,p.Ue)(),i._viewInverseTransposeMatrixDirty=!0,i._viewInverseTransposeMatrix=(0,p.Ue)(),i._frustumDirty=!0,i._frustum=(0,T.Ue)(),i._fullViewport=(0,C.Ue)(),i._pixelRatio=1,i.row=0,i.column=0,i._rows=1,i._columns=1,i._center=(0,_.Ue)(),i._up=(0,_.Ue)(),i.relativeElevation=0,i}return(0,i.Z)(n,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(e){this._pixelRatio=e>0?e:1}},{key:"rows",get:function(){return this._rows},set:function(e){this._rows=Math.max(1,e)}},{key:"columns",get:function(){return this._columns},set:function(e){this._columns=Math.max(1,e)}},{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center,"_center")}},{key:"ray",get:function(){return(0,m.f)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up,"_up")}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){(0,v.JG)(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),(0,m.s)((0,_.Ue)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}},{key:"viewUp",get:function(){return this._ensureViewClean(),(0,m.s)((0,_.Ue)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}},{key:"viewRight",get:function(){return this._ensureViewClean(),(0,m.s)((0,_.Ue)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"screenViewport",get:function(){if(1===this.pixelRatio)return this._viewport;var e=(0,w.b)((0,C.Ue)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,w.e)(e,t)?t:e}},{key:"screenPadding",get:function(){if(1===this.pixelRatio)return this._padding;var e=(0,w.b)((0,C.Ue)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,w.e)(e,t)?t:e}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[O.Np.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[O.Np.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[O.Np.RIGHT]+this._padding[O.Np.LEFT]},set:function(e){this.width=e-(this._padding[O.Np.RIGHT]+this._padding[O.Np.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[O.Np.TOP]+this._padding[O.Np.BOTTOM]},set:function(e){this.height=e-(this._padding[O.Np.TOP]+this._padding[O.Np.BOTTOM])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[O.Np.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[O.Np.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"_aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){(0,w.a)(this._padding,e)||(this._viewport[0]+=e[O.Np.LEFT]-this._padding[O.Np.LEFT],this._viewport[1]+=e[O.Np.BOTTOM]-this._padding[O.Np.BOTTOM],this._viewport[2]-=e[O.Np.RIGHT]+e[O.Np.LEFT]-(this._padding[O.Np.RIGHT]+this._padding[O.Np.LEFT]),this._viewport[3]-=e[O.Np.TOP]+e[O.Np.BOTTOM]-(this._padding[O.Np.TOP]+this._padding[O.Np.BOTTOM]),(0,w.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&((0,v.Jp)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){return this._projectionMatrixInternal}},{key:"inverseProjectionMatrix",get:function(){return(0,v.U_)((0,p.Ue)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,p.Ue)()}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return function(e,t,n){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+n*n))}(this._fov,this.width,this.height)},set:function(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return function(e,t,n){return 2*Math.atan(n*Math.tan(.5*e)/Math.sqrt(t*t+n*n))}(this._fov,this.width,this.height)},set:function(e){this._fov=function(e,t,n){return 2*Math.atan(Math.sqrt(t*t+n*n)*Math.tan(.5*e)/n)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return(0,m.p)(this.center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,v.U_)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,v.p4)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&this.relativeElevation>=0}},{key:"_projectionMatrixInternal",get:function(){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2)*2,r=n*this._aspect,i=n/this.rows,a=r/this.columns,o=-r/2+this.column*a,s=o+a,u=-n/2+this.row*i,l=u+i,c=(0,v.oy)((0,p.Ue)(),o*(1+2*this._padding[O.Np.LEFT]/e),s*(1+2*this._padding[O.Np.RIGHT]/e),u*(1+2*this._padding[O.Np.BOTTOM]/t),l*(1+2*this._padding[O.Np.TOP]/t),this.near,this.far),d=this._get("projectionMatrix");return d&&(0,v.fS)(d,c)?d:c}},{key:"copyFrom",value:function(e){(0,m.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,w.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,w.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,y.JG)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,v.JG)(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,T.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,v.JG)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,w.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new R).copyFrom(this)}},{key:"equals",value:function(e){return(0,m.e)(this.eye,e.eye)&&(0,m.e)(this.center,e.center)&&(0,m.e)(this.up,e.up)&&(0,w.a)(this._viewport,e.viewport)&&(0,w.a)(this._padding,e.padding)&&(0,y.I6)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}},{key:"almostEquals",value:function(e){var t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,w.d)(e.screenPadding,this.screenPadding)>=t||(0,w.d)(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;(0,m.z)(k,e.eye,e.center),(0,m.z)(I,this.eye,this.center);var n=(0,m.m)(k,I),r=(0,m.x)(k),i=(0,m.x)(I),a=5e-4;return n*n>=(1-1e-10)*r*i&&(0,m.w)(e.eye,this.eye)<Math.max(r,i)*a*a}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"_viewDirectionDistance",value:function(e){return Math.abs((0,b.SR)(this.viewForward,(0,m.f)(k,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,d.s1)();return e[0]=(this.padding[O.Np.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[O.Np.TOP]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[O.Np.LEFT]+this.width*t,e[1]=this.padding[O.Np.BOTTOM]+this.height*n,e[2]=.5,e}},{key:"setGLViewport",value:function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])}},{key:"applyProjection",value:function(e,t){e!==E&&(0,m.c)(E,e),E[3]=1,(0,w.t)(E,E,this.projectionMatrix);var n=Math.abs(E[3]);(0,m.j)(E,E,1/n);var r=this.fullViewport;t[0]=(0,c.t7)(0,r[0]+r[2],.5+.5*E[0]),t[1]=(0,c.t7)(0,r[1]+r[3],.5+.5*E[1]),t[2]=.5*(E[2]+1),t[3]=n}},{key:"unapplyProjection",value:function(e,t){var n=this.fullViewport;E[0]=(e[0]/(n[0]+n[2])*2-1)*e[3],E[1]=(e[1]/(n[1]+n[3])*2-1)*e[3],E[2]=(2*e[2]-1)*e[3],E[3]=e[3],null!=this.inverseProjectionMatrix&&((0,w.t)(E,E,this.inverseProjectionMatrix),t[0]=E[0],t[1]=E[1],t[2]=E[2])}},{key:"projectToScreen",value:function(e,t){return this.projectToRenderScreen(e,Z),this.renderToScreen(Z,t),t}},{key:"projectToRenderScreen",value:function(e,t){if(E[0]=e[0],E[1]=e[1],E[2]=e[2],E[3]=1,(0,w.t)(E,E,this.viewProjectionMatrix),0===E[3])return null;var n=E;(0,m.j)(n,n,1/Math.abs(E[3]));var r=this.fullViewport,i=(0,c.t7)(0,r[0]+r[2],.5+.5*n[0]),a=(0,c.t7)(0,r[1]+r[3],.5+.5*n[1]);return"x"in t?(t.x=i,t.y=a):(t[0]=i,t[1]=a,t.length>2&&(t[2]=.5*(n[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,Z),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if((0,v.Jp)(M,this.projectionMatrix,this.viewMatrix),!(0,v.U_)(M,M))return null;var n=this.fullViewport;return E[0]=2*(e[0]-n[0])/n[2]-1,E[1]=2*(e[1]-n[1])/n[3]-1,E[2]=2*e[2]-1,E[3]=1,(0,w.t)(E,E,M),0===E[3]?null:(t[0]=E[0]/E[3],t[1]=E[1]/E[3],t[2]=E[2]/E[3],t)}},{key:"constrainWindowSize",value:function(e,t,n,r){var i=e*this.pixelRatio,a=t*this.pixelRatio,o=Math.max(i-n/2,0),s=Math.max(this.fullHeight-a-r/2,0),u=-Math.min(i-n/2,0),l=-Math.min(this.fullHeight-a-r/2,0),c=n-u- -Math.min(this.fullWidth-i-n/2,0),d=r-l- -Math.min(a-r/2,0);return[Math.round(o),Math.round(s),Math.round(c),Math.round(d)]}},{key:"computeUp",value:function(e){e===S.JY.Global?this._computeUpGlobal():this._computeUpLocal()}},{key:"screenToRender",value:function(e,t){var n=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=r,t}},{key:"renderToScreen",value:function(e,t){var n=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=n,t[1]=r}},{key:"_computeUpGlobal",value:function(){(0,m.f)(k,this.center,this.eye);var e=(0,m.l)(this.center);e<1?((0,m.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,m.m)(k,this.center))>.9999*(0,m.l)(k)*e||((0,m.b)(this._up,k,this.center),(0,m.b)(this._up,this._up,k),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}},{key:"_computeUpLocal",value:function(){(0,m.E)(k,this.eye,this.center),Math.abs(k[2])<=.9999&&((0,m.j)(k,k,k[2]),(0,m.s)(this._up,-k[0],-k[1],1-k[2]),(0,m.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,m.e)(e,t)||((0,m.c)(t,e),this._markViewDirty(),n.length&&this.notifyChange(n)):l.Z.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&((0,T.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&((0,v.zB)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),n}(u.default);(0,s._)([(0,h.Cb)()],A.prototype,"_viewport",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"_padding",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"_fov",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"_nearFar",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"_viewDirty",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"_viewMatrix",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"_pixelRatio",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"pixelRatio",null),(0,s._)([(0,h.Cb)()],A.prototype,"row",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"column",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"_rows",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"rows",null),(0,s._)([(0,h.Cb)()],A.prototype,"_columns",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"columns",null),(0,s._)([(0,h.Cb)()],A.prototype,"eye",null),(0,s._)([(0,h.Cb)()],A.prototype,"center",null),(0,s._)([(0,h.Cb)()],A.prototype,"_center",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"up",null),(0,s._)([(0,h.Cb)()],A.prototype,"_up",void 0),(0,s._)([(0,h.Cb)()],A.prototype,"viewMatrix",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"viewForward",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"viewUp",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"viewRight",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"nearFar",null),(0,s._)([(0,h.Cb)()],A.prototype,"near",null),(0,s._)([(0,h.Cb)()],A.prototype,"far",null),(0,s._)([(0,h.Cb)()],A.prototype,"viewport",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"screenViewport",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"screenPadding",null),(0,s._)([(0,h.Cb)()],A.prototype,"x",null),(0,s._)([(0,h.Cb)()],A.prototype,"y",null),(0,s._)([(0,h.Cb)()],A.prototype,"width",null),(0,s._)([(0,h.Cb)()],A.prototype,"height",null),(0,s._)([(0,h.Cb)()],A.prototype,"fullWidth",null),(0,s._)([(0,h.Cb)()],A.prototype,"fullHeight",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"_aspect",null),(0,s._)([(0,h.Cb)()],A.prototype,"padding",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"projectionMatrix",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"inverseProjectionMatrix",null),(0,s._)([(0,h.Cb)()],A.prototype,"fov",null),(0,s._)([(0,h.Cb)()],A.prototype,"fovX",null),(0,s._)([(0,h.Cb)()],A.prototype,"fovY",null),(0,s._)([(0,h.Cb)()],A.prototype,"viewInverseTransposeMatrix",null),(0,s._)([(0,h.Cb)({readOnly:!0})],A.prototype,"_projectionMatrixInternal",null),(0,s._)([(0,h.Cb)()],A.prototype,"relativeElevation",void 0);var D=A=R=(0,s._)([(0,f.j)("esri.views.3d.webgl.RenderCamera")],A),E=(0,C.Ue)(),M=(0,p.Ue)(),k=(0,_.Ue)(),I=(0,_.Ue)(),Z=(0,d.J$)()}}]);
//# sourceMappingURL=11219.56127e62.chunk.js.map