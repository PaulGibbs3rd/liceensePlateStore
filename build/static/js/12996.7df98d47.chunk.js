"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[12996],{42307:function(e,t,n){n.d(t,{X:function(){return l}});var r=n(32035),i=n(96334),a=n(22186),o=n(92975);function l(e,t,n,l){if(null==t||null==l)return!1;var s=(0,i.eT)(t,i.Jz),u=(0,i.eT)(l,i.sp);if(s===u&&s!==i.Ej.UNKNOWN||(0,o.fS)(t,l))return n[0]=1,n[1]=1,n[2]=1,!0;if(s===i.Ej.SPHERICAL_ECEF){var c=(0,r.l)(e),d=c/Math.sqrt(e[0]*e[0]+e[1]*e[1]),f=c/a.sv.radius;if(u===i.Ej.WEB_MERCATOR)return n[0]=d*f,n[1]=d*f,n[2]=1,!0;if(u===i.Ej.WGS84||u===i.Ej.CGCS2000){var v=i.Ms;return n[0]=v*d*f,n[1]=v*f,n[2]=1,!0}}else if(s===i.Ej.PLATE_CARREE){if(u===i.Ej.WGS84||u===i.Ej.CGCS2000)return n[0]=i.Ms,n[1]=i.Ms,n[2]=1,!0;if(u===i.Ej.WEB_MERCATOR){var h=e[1]/a.sv.radius;return n[0]=1,n[1]=1/Math.cos(h),n[2]=1,!0}}return!1}},51066:function(e,t,n){n.d(t,{s:function(){return l}});var r=n(16889),i=n(12400),a=n(96334),o=n(22186);function l(e,t,n,r){if(null==t||null==r)return!1;var i=(0,a.Bg)(t,r,c);if(i.projector===a.iq)return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],!0;if(null==i.projector)return!1;var l=i.source,d=i.dest;if(d.spatialReferenceId===a.Ej.WEB_MERCATOR){var f=a.rf[l.spatialReferenceId][a.Ej.WGS84];return null!=f&&(f(e,0,u,0),(0,a.uT)(u,0,n,0),n[3]=s(u[1],e[2],e[3],o.sv.radius),!0)}if(l.spatialReferenceId!==a.Ej.WGS84&&l.spatialReferenceId!==a.Ej.CGCS2000||d.spatialReferenceId!==a.Ej.PLATE_CARREE){var v,h;i.projector(e,0,n,0);var p=null!==(v=l.metersPerUnit)&&void 0!==v?v:1,y=null!==(h=d.metersPerUnit)&&void 0!==h?h:1;n[3]=e[3]*p/y}else{var m=a.rf[l.spatialReferenceId][a.Ej.SPHERICAL_ECEF],g=a.rf[a.Ej.SPHERICAL_ECEF][a.Ej.PLATE_CARREE],b=e[3];null!=m&&null!=g&&(b=s(e[1],e[2],e[3],o.sv.radius)),i.projector(e,0,n,0),n[3]=b}return!0}function s(e,t,n,r){var i=r+t;if(i<r/2||n>i)return Number.MAX_VALUE;var a=Math.abs(d*e)+Math.asin(n/i);return a>=Math.PI/2?Number.MAX_VALUE:n/Math.cos(a)}var u=(0,i.Ue)(),c=(0,a.sw)(),d=(0,r.Vl)(1)},54907:function(e,t,n){var r,i,a,o,l,s,u,c,d,f,v,h,p,y,m;n.d(t,{$1:function(){return c},AQ:function(){return u},Em:function(){return b},Lz:function(){return o},MB:function(){return r},Nl:function(){return m},Q3:function(){return g},Qd:function(){return p},aw:function(){return a},jE:function(){return y},l7:function(){return i},xL:function(){return l}}),function(e){e.U8="U8",e.I8="I8",e.U16="U16",e.I16="I16",e.U32="U32",e.I32="I32",e.F32="F32",e.F64="F64",e.Utf8String="Utf8String",e.NotSet="NotSet"}(r||(r={})),function(e){e.Png="Png",e.Jpeg="Jpeg",e.Dds="Dds",e.Raw="Raw",e.Dxt1="Dxt1",e.Dxt5="Dxt5",e.Etc2="Etc2",e.Astc="Astc",e.Pvrtc="Pvrtc",e.NotSet="NotSet"}(i||(i={})),function(e){e.Rgb8="Rgb8",e.Rgba8="Rgba8",e.R8="R8",e.Bgr8="Bgr8",e.Bgra8="Bgra8",e.Rg8="Rg8",e.NotSet="NotSet"}(a||(a={})),function(e){e.Position="Position",e.Normal="Normal",e.TexCoord="TexCoord",e.Color="Color",e.Tangent="Tangent",e.FeatureIndex="FeatureIndex",e.UvRegion="UvRegion",e.NotSet="NotSet"}(o||(o={})),function(e){e.Opaque="Opaque",e.Mask="Mask",e.Blend="Blend"}(l||(l={})),function(e){e.None="None",e.Mask="Mask",e.Alpha="Alpha",e.PreMultAlpha="PreMultAlpha",e.NotSet="NotSet"}(s||(s={})),function(e){e.Points="Points",e.Lines="Lines",e.LineStrip="LineStrip",e.Triangles="Triangles",e.TriangleStrip="TriangleStrip",e.NotSet="NotSet"}(u||(u={})),function(e){e.None="None",e.WrapXBit="WrapXBit",e.WrapYBit="WrapYBit",e.WrapXy="WrapXy",e.NotSet="NotSet"}(c||(c={})),function(e){e.Linear="Linear",e.Nearest="Nearest",e.NotSet="NotSet"}(d||(d={})),function(e){e.Linear="Linear",e.Nearest="Nearest",e.NearestMipmapNearest="NearestMipmapNearest",e.LinearMipmapNearest="LinearMipmapNearest",e.NearestMipmapLinear="NearestMipmapLinear",e.LinearMipmapLinear="LinearMipmapLinear",e.NotSet="NotSet"}(f||(f={})),function(e){e.FeatureId="FeatureId",e.GlobalUid="GlobalUid",e.UnspecifiedDateTime="UnspecifiedDateTime",e.EcmaIso8601DateTime="EcmaIso8601DateTime",e.EcmaIso8601DateOnly="EcmaIso8601DateOnly",e.TimeOnly="TimeOnly",e.TimeStamp="TimeStamp",e.ColorRgb="ColorRgb",e.ColorRgba="ColorRgba",e.Unrecognized="Unrecognized",e.NotSet="NotSet"}(v||(v={})),function(e){e.Texture="Texture",e.VertexAtrb="VertexAtrb",e.Implicit="Implicit",e.NotSet="NotSet"}(h||(h={})),function(e){e.Front="Front",e.Back="Back",e.None="None",e.NotSet="NotSet"}(p||(p={})),function(e){e.Pbr="Pbr",e.Unlit="Unlit"}(y||(y={})),function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed",e[e.MissingInputs=2]="MissingInputs"}(m||(m={}));var g=-1,b=-2},12996:function(e,t,n){n.r(t),n.d(t,{default:function(){return Te}});var r,i,a,o,l,s,u,c=n(93433),d=n(74165),f=n(15861),v=n(60136),h=n(29388),p=n(15671),y=n(43144),m=n(27366),g=n(10064),b=n(93169),_=n(32718),w=n(92026),E=n(94172),C=n(99346),x=n(49861),M=(n(84936),n(69912)),T=n(29303),R=n(21389),S=n(29134),k=n(7025),P=n(50894),U=n(32035),O=n(12400),A=n(86361),I=n(83448),N=n(37998),Z=n(42307),L=n(5986),B=n(25158),j=n(54907),F=n(74509),H=n(50951),V=function(e){(0,v.Z)(n,e);var t=(0,h.Z)(n);function n(e,r,i,a,o,l,s){var u;return(0,p.Z)(this,n),(u=t.call(this,e,0,0,0,r)).nodesCached=i,u.vboMB=a,u.textureMB=o,u.vboMBCached=l,u.textureMBCached=s,u}return(0,y.Z)(n)}(n(20488).W),D=n(26279),G=n(42069),W=n(76241),z=n(55763),J=n(4942),Q=n(68401),q=n(8548),X=(r={},(0,J.Z)(r,j.AQ.Points,null),(0,J.Z)(r,j.AQ.Lines,null),(0,J.Z)(r,j.AQ.LineStrip,null),(0,J.Z)(r,j.AQ.Triangles,q.MX.TRIANGLES),(0,J.Z)(r,j.AQ.TriangleStrip,q.MX.TRIANGLE_STRIP),(0,J.Z)(r,j.AQ.NotSet,null),r),$=(i={},(0,J.Z)(i,j.xL.Opaque,Q.JJ.Opaque),(0,J.Z)(i,j.xL.Mask,Q.JJ.Mask),(0,J.Z)(i,j.xL.Blend,Q.JJ.Blend),i),Y=(a={},(0,J.Z)(a,j.Qd.Back,Q.Vr.Back),(0,J.Z)(a,j.Qd.Front,Q.Vr.Front),(0,J.Z)(a,j.Qd.None,Q.Vr.None),(0,J.Z)(a,j.Qd.NotSet,Q.Vr.Back),a),K=(o={},(0,J.Z)(o,j.$1.WrapYBit,{s:q.e8.CLAMP_TO_EDGE,t:q.e8.REPEAT}),(0,J.Z)(o,j.$1.WrapXBit,{s:q.e8.REPEAT,t:q.e8.CLAMP_TO_EDGE}),(0,J.Z)(o,j.$1.WrapXy,{s:q.e8.REPEAT,t:q.e8.REPEAT}),(0,J.Z)(o,j.$1.None,{s:q.e8.CLAMP_TO_EDGE,t:q.e8.CLAMP_TO_EDGE}),(0,J.Z)(o,j.$1.NotSet,{s:q.e8.CLAMP_TO_EDGE,t:q.e8.CLAMP_TO_EDGE}),o),ee=(l={},(0,J.Z)(l,j.MB.U8,1),(0,J.Z)(l,j.MB.I8,1),(0,J.Z)(l,j.MB.U16,2),(0,J.Z)(l,j.MB.I16,2),(0,J.Z)(l,j.MB.U32,4),(0,J.Z)(l,j.MB.I32,4),(0,J.Z)(l,j.MB.F32,4),(0,J.Z)(l,j.MB.F64,8),(0,J.Z)(l,j.MB.Utf8String,1),(0,J.Z)(l,j.MB.NotSet,1),l),te=n(52639),ne=n(85312),re=n(88153),ie=n(54463),ae=n(42235),oe=function(){function e(t){(0,p.Z)(this,e),this.layerUid=[],this.type=ie.q7.TILES3D,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerView=t,this.layerUid.push(t.layer.uid)}return(0,y.Z)(e,[{key:"intersect",value:function(e,t,n,r,i,a){var o=this,l=e.results,s=e.options.store===ie.eC.ALL;if(!e.options.filteredLayerUids.includes(this.layerView.layer.uid)){var u=this.layerView.view._stage.renderView.componentObjectCollection,c=new ae.sT(null!==a&&void 0!==a&&a,e.options.normalRequired);this.layerView.objects.forEach((function(i){i.visible&&i.intersectionGeometry&&u.intersect(i,n,r,e.tolerance,null,c,(function(i,a,u,c){if(a>=0){if(null!=t&&!t(n,r,a))return;var d=function(e){var t=new ne.lt(o.layerView.layer.uid,(function(){return o._createTiles3DGraphic(o.layerView.layer,{})}));e.set(o.type,t,a,u)};if(o.isGround&&(null==l.ground.dist||a<l.ground.dist)&&d(l.ground),e.options.isFiltered)return;if((null==l.min.dist||a<l.min.dist)&&d(l.min),(null==l.max.dist||a>l.max.dist)&&d(l.max),s){var f=(0,re.LP)(e.ray);d(f),e.results.all.push(f)}}}))}))}}},{key:"_createTiles3DGraphic",value:function(e,t){return new te.Z({layer:e,sourceLayer:e,attributes:t})}}]),e}(),le=n(2985),se=n(89414),ue=n(35160),ce=n(92911),de=n(51594),fe=n(46987),ve=n(89261),he=n(60113),pe=n(86097),ye=n(91526),me=n(52920),ge=n(1487),be=n(4760),_e=n(33236),we=n(67581),Ee=n(69787);(u=s||(s={}))[u.API=1]="API",u[u.VerboseAPI=2]="VerboseAPI",u[u.Error=3]="Error";var Ce=function(){function e(){(0,p.Z)(this,e),this.handle=0,this.isVisible=!1,this.components=[],this.texMemoryUsage=0,this.vboMemoryUsage=0,this.cpuMemoryUsage=0,this.textures=[]}return(0,y.Z)(e,[{key:"totalMemory",value:function(){return this.texMemoryUsage+this.vboMemoryUsage+this.cpuMemoryUsage}}]),e}();function xe(e){return Math.round(e/1048.576)/1e3}var Me=function(e){(0,v.Z)(n,e);var t=(0,h.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).type="integrated-mesh-3dtiles",e._visibleGeometryChangedSchedulerHandle=null,e._wasmLayerId=-1,e.ignoresMemoryFactor=!1,e.drapeTargetType=D.al.WithoutRasterImage,e._lyrHandleToObjects=new Map,e._initialCullFace=new Map,e._suspendedHandle=null,e._dbgFlags=new Set,e}return(0,y.Z)(n,[{key:"initialize",value:function(){var e=this;if(this._dbgFlags.add(s.Error),this._dbg(s.VerboseAPI,"Tiles3DLayerView3D initialize() called"),!this._canProjectWithoutEngine())throw new g.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});var t=(0,W.JF)(this).then((function(t){e._intersectionHandler=new oe(e),e.view.sceneIntersectionHelper.addIntersectionHandler(e._intersectionHandler),e._updatingHandles.add((function(){return e.slicePlaneEnabled}),(function(t){return e._slicePlaneEnabledChange(t)})),e._elevationProvider=new z.u({view:e.view,layerElevationSource:e,intersectionHandler:e._intersectionHandler}),e.view.elevationProvider.register("im",e._elevationProvider),e.view.basemapTerrain.overlayManager.registerDrapeTarget(e),e._wasmLayerId=t;var n=e.view.resourceController.memoryController.newCache("t3d-".concat(e.uid),(function(t){return e._onRemoveFromCache(t)}));e._memCache=n,e.addHandles([(0,E.watch)((function(){return e.layer.elevationInfo}),(function(t){return e._elevationInfoChanged(t)}))]),e._suspendedHandle=(0,E.watch)((function(){return e.suspended}),(function(t){var n=(0,W.WM)(e.view);n&&n.setEnabled(e,!t)}),E.initial)})).catch((function(t){if((0,W.mq)(e),e._wasmLayerId=-1,t===j.Q3)throw new g.Z("tiles3d:addLayer-failure","The 3d tiles layer description was invalid.",{});if(t===j.Em)throw new g.Z("tiles3d:addLayer-failure","The 3d tiles layer web assembly module failed to download.",{})}));this.addResolvingPromise(t)}},{key:"destroy",value:function(){var e=this;this._dbg(s.VerboseAPI,"Tiles3DLayerView3D destroy() called"),(0,W.mq)(this),this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null),this._intersectionHandler&&(this.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null),this._elevationProvider&&(this._elevationProvider.objectsChanged(this._obbs),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null),this.view.basemapTerrain.overlayManager.unregisterDrapeTarget(this),this._lyrHandleToObjects.forEach((function(t){return e.freeObject(t)})),this._lyrHandleToObjects.clear(),this._initialCullFace.clear(),this._memCache=(0,w.SC)(this._memCache),this._updatingHandles=(0,w.SC)(this._updatingHandles),this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)}},{key:"_visibleGeometryChanged",value:function(){var e=this;null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=(0,C.Os)((function(){e.emit("visible-geometry-changed"),e._visibleGeometryChangedSchedulerHandle=null})))}},{key:"_slicePlaneEnabledChange",value:function(e){var t=this;this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=e),this.objects.forEach((function(n){var r=t._collection.getMaterial(n);r.commonMaterialParameters.hasSlicePlane=e,r.commonMaterialParameters.cullFace=e?Q.Vr.None:t._initialCullFace.get(n)}))}},{key:"_elevationInfoChanged",value:function(e){var t=(0,W.WM)(this.view);t&&t.setLayerOffset(this,(0,F.fm)(e))}},{key:"_obbs",get:function(){var e=this;return this.objects.map((function(t){return e._collection.getComponentObb(t)}))}},{key:"wasmLayerId",get:function(){return this._wasmLayerId}},{key:"usedMemory",get:function(){var e=0;return this._lyrHandleToObjects.forEach((function(t){t.isVisible&&(e+=t.totalMemory())})),e}},{key:"unloadedMemory",get:function(){var e=0;return this._lyrHandleToObjects.forEach((function(t){t.isVisible||(e+=t.totalMemory())})),e}},{key:"visibleAtCurrentScale",get:function(){return(0,Ee.GB)(this.layer.effectiveScaleRange,this.view.terrainScale)}},{key:"performanceInfo",get:function(){var e=0,t=0,n=0,r=0,i=0,a=0;return this._lyrHandleToObjects.forEach((function(o){o.isVisible?(e+=o.texMemoryUsage,t+=o.vboMemoryUsage,i++):(n+=o.texMemoryUsage,r+=o.vboMemoryUsage,a++)})),new V(this.usedMemory,i,a,xe(t),xe(e),xe(r),xe(n))}},{key:"_canProjectWithoutEngine",value:function(){if(this.view.state.viewingMode===H.JY.Local){var e,t,n,r=null!==(e=this.view.renderSpatialReference)&&void 0!==e&&e.isWebMercator?3857:null!==(t=null===(n=this.view.renderSpatialReference)||void 0===n?void 0:n.wkid)&&void 0!==t?t:-1;if(3857!==r&&32662!==r)return!1}return!0}},{key:"_stage",get:function(){return this.view._stage}},{key:"_collection",get:function(){return this._stage.renderView.componentObjectCollection}},{key:"elevationOffset",get:function(){return(0,F.fm)(this.layer.elevationInfo)}},{key:"elevationRange",get:function(){var e=this.fullExtent;return null!==e&&void 0!==e&&e.zmin&&null!==e&&void 0!==e&&e.zmax?new le.r(e.zmin,e.zmax):null}},{key:"getElevationRange",value:function(e){return null}},{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"objects",get:function(){return Array.from(this._lyrHandleToObjects.values()).reduce((function(e,t){return e.concat(t.components)}),new Array)}},{key:"isUpdating",value:function(){var e=(0,W.WM)(this.view);return!(this._wasmLayerId<0||null==e)&&e.isUpdating(this._wasmLayerId)}},{key:"updatingFlagChanged",value:function(){this.notifyChange("updating")}},{key:"createRenderable",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,i,a,o,l,u,c,f,v,h,p,y,m,g,_,w=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.meshData).data){e.next=3;break}throw new Error("meshData.data undefined");case 3:if(n.desc=JSON.parse(n.desc),null!=n.desc){e.next=5;break}throw new Error("meshData.desc undefined");case 5:r=(0,O.nI)(n.desc.origin),i=new Array,a=new Map,(o=new Ce).handle=t.handle,this._lyrHandleToObjects.set(t.handle,o),l=this.view.basemapTerrain.spatialReference,"global"===this.view.viewingMode?(f=(0,k.Ue)(),(0,N.B)(I.kU,r,f,l),u=(0,T.xO)((0,R.Ue)(),f),c=(0,T.U_)((0,R.Ue)(),u)):(u=R.Wd,c=R.Wd),v=(0,k.Ue)(),(0,S.Iu)(v,v,r),h=(0,S.i0)((0,O.Ue)(),v),p=null,y=(0,O.Ue)(),n.desc.obb&&(m=n.desc.obb.quaternion,p=new se.Oo(n.desc.obb.center,n.desc.obb.halfSize,(0,P.al)(m[0],m[1],m[2],m[3]))),g=function(e){var t,d=n.desc.prims[e];if(w._dbg(s.VerboseAPI,JSON.stringify(d)),d.ptype===j.AQ.Lines)return"continue";if(null==X[d.ptype]||null==n.data)return w._dbg(s.VerboseAPI,"[Unsupported Feature] Unsupported primitive mode ("+d.ptype+"). Skipping primitive."),"continue";var f=null!==(t=n.desc)&&void 0!==t&&t.materials&&null!=d.materialId?n.desc.materials[d.materialId]:null,v=null!=f?f.lightingModel:j.jE.Unlit,m=!(0,b.Z)("disable-feature:im-shading"),g=w.getBufferViews(d,n.data.buffer,u,m),_=g.positionView,E=g.positionAttr,C=g.normalsView,x=g.normalsAttr,M=g.colorAttr,T=g.texCoord0Attr,S=g.indicesView;if(null==E||null==_||null==S)return"continue";var k={colors:null!=M,textureCoordinates:null!=T?he.N.Default:he.N.None,hasNormals:null!=C,needsNormals:m},P=E.data.length/E.size,I=function(e,t){return!e||e.data.length/e.size===P||(w._dbg(s.Error,"".concat(t," !== numPos. Skipping primitive.")),!1)};if(!I(T,"numTexcoord")||!I(M,"numColors")||!I(x,"normals"))return"continue";var N=(0,ce.N)(k);if(null!=p?p=p.clone():(p=(0,se.Qb)(E),(0,U.g)(y,p.center,r),p.center=y),u!==R.Wd)for(var B=0;B<_.count;B++)_.getVec(B,y),(0,U.t)(y,y,u),_.setVec(B,y);var F=N.createBuffer(E.data.length),H=new Map([[be.T.POSITION,E]]);null!=T&&H.set(be.T.UV0,T),null!=M&&H.set(be.T.COLOR,M),null!=x&&H.set(be.T.NORMALCOMPRESSED,x),H.forEach((function(e,t){null!=e&&(0,_e.i9)(t,e,null,null,F,0)}));var V=new Uint32Array([0,S.typedBuffer.length]),D={vertices:{data:F.buffer,count:F.byteLength/N.stride,layoutParameters:k},positionData:{positions:_.typedBuffer,indices:S.typedBuffer},indices:S.typedBuffer,componentOffsets:V};o.cpuMemoryUsage+=_.count,o.cpuMemoryUsage+=S.count;var G=w.view.renderSpatialReference,W=(0,O.Ue)(),z=[1,1,1];(0,Z.X)(h,G,z,l)||w._dbg(s.Error,"Unsupported coordinate system for IM overlay"),(0,L.S)(h,G,W,l);var J=w._collection.createObject(new ue.G((0,A.al)(W[0],W[1],z[0],z[1]),new de.w(h,c),p,D));f&&w._collection.updateMaterial(J,(function(e){var t,r;e.baseColor=f.baseColorFactor,e.usePBR=v===j.jE.Pbr,e.hasParametersFromSource=!1,e.baseColorTexture=w._getTexture(f.baseColorTex,n,a),e.usePBR&&(e.mrrFactors=[f.metallicFactor,f.roughnessFactor,0],e.emissiveFactor=null!==(t=f.emissiveFactor)&&void 0!==t?t:[0,0,0],e.metallicRoughnessTexture=w._getTexture(f.metalTex,n,a),e.emissionTexture=w._getTexture(f.emissiveTex,n,a),e.occlusionTexture=w._getTexture(f.occlusionTex,n,a),e.normalTexture=w._getTexture(f.normalTex,n,a)),e.objectOpacity=0,e.alphaDiscardMode=Q.JJ.Mask;var l=[];e.baseColorTexture&&l.push(e.baseColorTexture.loadPromise),e.usePBR&&e.metallicRoughnessTexture&&l.push(e.metallicRoughnessTexture.loadPromise),e.usePBR&&e.emissionTexture&&l.push(e.emissionTexture.loadPromise),e.usePBR&&e.occlusionTexture&&l.push(e.occlusionTexture.loadPromise),e.usePBR&&e.normalTexture&&l.push(e.normalTexture.loadPromise);var s=Promise.all(l);i.push(s),s.then((function(){var t,n,r,i,a,l,s,u,c,d;e.alphaDiscardMode=$[f.alphaMode],e.objectOpacity=1,o.texMemoryUsage+=(null===(t=e.baseColorTexture)||void 0===t||null===(n=t.glTexture)||void 0===n?void 0:n.usedMemory)||0,e.usePBR&&(o.texMemoryUsage+=(null===(r=e.metallicRoughnessTexture)||void 0===r||null===(i=r.glTexture)||void 0===i?void 0:i.usedMemory)||0,o.texMemoryUsage+=(null===(a=e.emissionTexture)||void 0===a||null===(l=a.glTexture)||void 0===l?void 0:l.usedMemory)||0,o.texMemoryUsage+=(null===(s=e.occlusionTexture)||void 0===s||null===(u=s.glTexture)||void 0===u?void 0:u.usedMemory)||0,o.texMemoryUsage+=(null===(c=e.normalTexture)||void 0===c||null===(d=c.glTexture)||void 0===d?void 0:d.usedMemory)||0)})),e.commonMaterialParameters.doubleSided=f.isDoubleSided,e.commonMaterialParameters.cullFace=f.faceCulling?Y[f.faceCulling]:Q.Vr.Back,w._initialCullFace.set(J,e.commonMaterialParameters.cullFace),e.commonMaterialParameters.hasSlicePlane=w.slicePlaneEnabled,e.componentParameters.castShadows=fe.ws.All,e.textureAlphaCutoff=null!==(r=f.alphaCutoff)&&void 0!==r?r:.1,e.alphaDiscardMode=$[f.alphaMode],e.isIntegratedMesh=!0,e.polygonOffsetEnabled=!1,e.hasOccludees=!1,e.ellipsoidMode=(0,pe.j)(w.view.spatialReference)})),o.components.push(J),o.vboMemoryUsage+=w._collection.getObjectGPUMemoryUsage(J)},_=0;case 17:if(!(_<n.desc.prims.length)){e.next=24;break}if("continue"!==g(_)){e.next=21;break}return e.abrupt("continue",21);case 21:_++,e.next=17;break;case 24:return e.next=26,Promise.all(i);case 26:if(a.forEach((function(e){o.textures.push(e)})),this._memCache){e.next=29;break}throw new Error("no memCache");case 29:return e.abrupt("return",(this._memCache.put("".concat(o.handle),o,o.totalMemory()),{memUsageBytes:o.totalMemory()}));case 30:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"freeRenderable",value:function(e){var t=this._lyrHandleToObjects.get(e);t&&(this.freeObject(t),this._lyrHandleToObjects.delete(e))}},{key:"freeObject",value:function(e){var t=this;this._memCache&&this._memCache.pop("".concat(e.handle)),e.components.forEach((function(n){e.textures.forEach((function(e){t._stage.remove(e)})),t._collection.destroyObject(n),t._initialCullFace.delete(n)}))}},{key:"setRenderableVisibility",value:function(e,t,n){var r=this;if(this._memCache){for(var i=function(n){var i=e[n],a=t[n];if(!a)return"continue";var o=r._lyrHandleToObjects.get(i);o&&(r._visibleGeometryChanged(),o.isVisible=a,o.components.forEach((function(e){r._collection.setObjectVisibility(e,a),r._elevationProvider.objectChanged(r._collection.getComponentObb(e))})),r._memCache.pop("".concat(i)))},a=0;a<n;++a)i(a);for(var o=function(n){var i=e[n],a=t[n];if(a)return"continue";var o=r._lyrHandleToObjects.get(i);o&&(r._visibleGeometryChanged(),o.isVisible=a,o.components.forEach((function(e){r._collection.setObjectVisibility(e,a),r._elevationProvider.objectChanged(r._collection.getComponentObb(e))})),r._memCache.put("".concat(i),o,o.totalMemory()))},l=0;l<n;++l)o(l)}}},{key:"_getTexture",value:function(e,t,n){var r,i,a=null;if(e&&null!==(r=t.desc)&&void 0!==r&&r.images&&null!==(i=t.data)&&void 0!==i&&i.buffer){var o=t.desc.images[null===e||void 0===e?void 0:e.imageId];if(!(a=n.get(o))&&o){var l,u=this._stage.renderView.renderingContext.parameters.maxMaxAnisotropy,c=u>1,d=K[null!==(l=e.wrapMode)&&void 0!==l?l:j.$1.None],f=o.alpha?4:3,v=new Uint8Array(t.data.buffer,o.data.byteOffset,o.data.byteCount),h=null,p=null,y=null;switch(o.format){case j.l7.Raw:o.pixelFormat===j.aw.R8?(h=v.buffer,f=1,p=""):o.pixelFormat===j.aw.Rgb8?(h=v.buffer,f=3,p=""):o.pixelFormat===j.aw.Rgba8&&(h=v.buffer,f=4,p="");break;case j.l7.Dxt1:h=v.buffer,f=3,p=Q.Ti.DDS_ENCODING;break;case j.l7.Dxt5:h=v.buffer,f=4,p=Q.Ti.DDS_ENCODING;break;case j.l7.Png:p="image/png",y=document.createElement("img");break;case j.l7.Jpeg:p="image/jpeg",y=document.createElement("img");break;case j.l7.Etc2:p="image/ktx",y=document.createElement("img");break;case j.l7.Astc:this._dbg(s.Error,"Astc texture not supported");break;case j.l7.Pvrtc:this._dbg(s.Error,"Pvrtc texture not supported")}if(y&&p){var m=new Blob([v],{type:p});y.src=URL.createObjectURL(m),h=y}h&&null!=p&&(a=new ge.x(h,{mipmap:c,maxAnisotropy:u,encoding:p,wrap:d,components:f,noUnpackFlip:!0,width:o.mip0Width,height:o.mip0Height}),this._stage.add(a),n.set(o,a))}}return a?new ve.T(this.view._stage.renderView.textures,a.id):null}},{key:"getBufferViews",value:function(e,t,n,r){for(var i,a,o,l,u,d,f,v=null,h=0;h<e.atrbs.length;h++){var p=e.atrbs[h],y=p.view,m=void 0,g=y.byteOffset+y.byteCount,b=y.byteCount/ee[y.type],_=(0,c.Z)(Array(b).keys()).map((function(e){return e}));try{switch(p.sem){case j.Lz.Position:3!==y.ncomp||y.type!==j.MB.F32?this._dbg(s.Error,"[Unsupported Feature] Unsupported view for Position ("+y+")"):(i=new B.ct(t,y.byteOffset,m,g),a=new ye.a(i.typedBuffer,_,3));break;case j.Lz.Normal:if(3!==y.ncomp||y.type!==j.MB.F32)this._dbg(s.Error,"[Unsupported Feature] Unsupported view for Normal ("+y+")");else if(r){var w=new B.ct(t,y.byteOffset,m,g),E=(0,me.Pj)(w.typedBuffer,n);u=new B.o7(E),d=new ye.a(u.typedBuffer,_,2)}break;case j.Lz.TexCoord:2!==y.ncomp||y.type!==j.MB.F32?this._dbg(s.Error,"[Unsupported Feature] Unsupported view for Texcoord ("+y+")"):void 0===l&&(l=new ye.a(new B.Eu(t,y.byteOffset,m,g).typedBuffer,_,2));break;case j.Lz.Color:4===y.ncomp?(y.type===j.MB.F32&&(v=new B.ek(t,y.byteOffset,m,g)),y.type===j.MB.U8&&(v=new B.mc(t,y.byteOffset,m,g)),y.type===j.MB.U16&&(v=new B.v6(t,y.byteOffset,m,g))):3===y.ncomp&&(y.type===j.MB.F32&&(v=new B.ct(t,y.byteOffset,m,g)),y.type===j.MB.U8&&(v=new B.ne(t,y.byteOffset,m,g)),y.type===j.MB.U16&&(v=new B.mw(t,y.byteOffset,m,g))),null==v?this._dbg(s.VerboseAPI,"[Unsupported Feature] Unsupported view for Color ("+y+")"):o=new ye.a(v.typedBuffer,_,y.ncomp);break;case j.Lz.FeatureIndex:break;default:this._dbg(s.VerboseAPI,"[Unsupported Feature] Unsupported semantic ("+p.sem+"). Skipping vertex attribute.")}}catch(P){this._dbg(s.VerboseAPI,"Error Creating buffer ("+P+"). Skipping vertex attribute.")}}if(e.index){var C=e.index.view,x=void 0,M=C.byteOffset+C.byteCount;switch(e.index.view.type){case j.MB.U16:f=new B.av(t,C.byteOffset,x,M);break;case j.MB.U32:f=new B.Nu(t,C.byteOffset,x,M);break;case j.MB.U8:default:this._dbg(s.Error,"[Unsupported Feature] index type not supported ("+C.type+").")}}if(null==f&&null!=i){var T=i.count;if(T<65535){var R=new Uint16Array(T);f=new B.av(R)}else{var S=new Uint32Array(T);f=new B.Nu(S)}for(var k=0;k<T;k++)f.set(k,k)}return{positionView:i,positionAttr:a,colorAttr:o,texCoord0Attr:l,indicesView:f,normalsView:u,normalsAttr:d}}},{key:"_onRemoveFromCache",value:function(e){var t=(0,W.WM)(this.view);t&&t.onRenderableEvicted(this,e.handle,e.totalMemory()),this.freeRenderable(e.handle)}},{key:"_dbg",value:function(e,t){this._dbgFlags.has(e)&&(e===s.Error?_.Z.getLogger(this).error(t):_.Z.getLogger(this).warn(t))}}]),n}((0,G.A)(we.Z));(0,m._)([(0,x.Cb)()],Me.prototype,"_visibleGeometryChangedSchedulerHandle",void 0),(0,m._)([(0,x.Cb)()],Me.prototype,"layer",void 0),(0,m._)([(0,x.Cb)({readOnly:!0})],Me.prototype,"visibleAtCurrentScale",null),(0,m._)([(0,x.Cb)()],Me.prototype,"elevationOffset",null);var Te=Me=(0,m._)([(0,M.j)("esri.views.3d.layers.IntegratedMesh3DTilesLayerView3D")],Me)},42069:function(e,t,n){n.d(t,{A:function(){return g}});var r=n(74165),i=n(15861),a=n(15671),o=n(43144),l=n(88301),s=n(61120),u=n(60136),c=n(29388),d=n(27366),f=n(42537),v=n(66978),h=n(94172),p=n(49861),y=(n(93169),n(32718),n(84936),n(69912)),m=n(5354),g=function(e){var t=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).slicePlaneEnabled=!1,e.supportsHeightUnitConversion=!1,e}return(0,o.Z)(n,[{key:"postscript",value:function(){(0,l.Z)((0,s.Z)(n.prototype),"postscript",this).call(this),(0,m.qC)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}},{key:"_validateHeightModelInfo",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n,i,a=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new AbortController,n=t.signal,this.addHandles((0,f.kB)((function(){return t.abort()}))),e.next=4,(0,h.whenOnce)((function(){var e;return null===(e=a.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),n);case 4:if((0,v.k_)(n),!(i=(0,m.Wt)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))){e.next=8;break}throw i;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(e);return(0,d._)([(0,p.Cb)()],t.prototype,"view",void 0),(0,d._)([(0,p.Cb)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,d._)([(0,y.j)("esri.views.3d.layers.LayerView3D")],t)}},55763:function(e,t,n){n.d(t,{u:function(){return M}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),l=n(29388),s=n(27366),u=n(7138),c=n(91505),d=n(32718),f=n(49861),v=(n(93169),n(84936),n(69912)),h=n(29134),p=n(7025),y=n(32035),m=n(12400),g=n(51066),b=n(65156),_=n(23470),w=n(2985),E=n(4035),C=n(88153),x=n(54463),M=function(e){(0,o.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._tmpEvent=new E.c,r._renderCoordsHelper=e.view.renderCoordsHelper,r._renderSR=r._renderCoordsHelper.spatialReference,r._layerElevationSource=e.layerElevationSource,r}return(0,a.Z)(n,[{key:"initialize",value:function(){this._intersector=(0,C.Z8)(this.view.state.viewingMode),this._intersector.options.store=x.eC.MIN,this._intersector.options.normalRequired=!1,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}},{key:"spatialReference",get:function(){var e,t;return null===(e=this.view)||void 0===e||null===(t=e.elevationProvider)||void 0===t?void 0:t.spatialReference}},{key:"getElevation",value:function(e,t,n,r){var i=this._renderCoordsHelper,a=(0,y.s)(S,e,t,n);if(!i.toRenderCoords(a,r,a))return d.Z.getLogger(this).error("could not project point to compute elevation"),null;var o=this.layerElevationSource,l=this._intersector,s=this.intersectionHandler,u=o.fullExtent,c=null!=u&&Number.isFinite(u.xmin)&&Number.isFinite(u.xmax)&&Number.isFinite(u.ymin)&&Number.isFinite(u.ymax)&&Number.isFinite(u.zmin)&&Number.isFinite(u.zmax)?new w.r(u.zmin,u.zmax):o.elevationRange;if(null==c)return null;var f=o.elevationOffset,v=c.elevationRangeMin+f,h=c.elevationRangeMax+f,p=i.setAltitude(k,h,a),m=i.setAltitude(P,v,a);return l.reset(p,m,null),s.intersect(l,null,p,m,null,!0),l.results.min.getIntersectionPoint(a)?i.getAltitude(a):null}},{key:"getSphereElevationBounds",value:function(e,t){return(0,g.s)(e,t,R,this._renderSR),this._layerElevationSource.getElevationRange(R)}},{key:"getRootElevationBounds",value:function(){var e=this.layerElevationSource.fullExtent;return null!==e&&void 0!==e&&e.hasZ?new w.r(e.zmin,e.zmax):null}},{key:"objectsChanged",value:function(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}},{key:"objectChanged",value:function(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}},{key:"_computeObjectExtent",value:function(e,t){(0,b.cS)(t),this._expandExtent(e,t)}},{key:"_computeLayerExtent",value:function(e,t){(0,b.cS)(t);var n,i=(0,r.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;this._expandExtent(a,t)}}catch(o){i.e(o)}finally{i.f()}}},{key:"_expandExtent",value:function(e,t){var n=this.spatialReference;if(null!=n&&null!=e){(0,h.en)(T,e.quaternion),T[12]=e.center[0],T[13]=e.center[1],T[14]=e.center[2];for(var r=e.halfSize,i=0;i<8;++i)S[0]=1&i?r[0]:-r[0],S[1]=2&i?r[1]:-r[1],S[2]=4&i?r[2]:-r[2],(0,y.h)(S,S,T),this._renderCoordsHelper.fromRenderCoords(S,S,n),(0,b.jn)(t,S,t)}}}]),n}(c.Z.EventedMixin(u.default));(0,s._)([(0,f.Cb)({constructOnly:!0})],M.prototype,"layerElevationSource",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],M.prototype,"intersectionHandler",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],M.prototype,"view",void 0),(0,s._)([(0,f.Cb)()],M.prototype,"spatialReference",null),M=(0,s._)([(0,v.j)("esri.views.3d.layers.i3s.LayerElevationProvider")],M);var T=(0,p.Ue)(),R=(0,_.f)(0,0,0,0),S=(0,m.Ue)(),k=(0,m.Ue)(),P=(0,m.Ue)()},35160:function(e,t,n){n.d(t,{G:function(){return a}});var r=n(43144),i=n(15671),a=(0,r.Z)((function e(t,n,r,a){(0,i.Z)(this,e),this.toMapSpace=t,this.transform=n,this.obb=r,this.geometry=a}))},51594:function(e,t,n){n.d(t,{w:function(){return a}});var r=n(43144),i=n(15671),a=(0,r.Z)((function e(t,n){(0,i.Z)(this,e),this.position=t,this.rotationScale=n,this.origin=void 0}))},89261:function(e,t,n){n.d(t,{T:function(){return l}});var r=n(15671),i=n(43144),a=n(92026),o=n(66978),l=function(){function e(t,n){var i=this;(0,r.Z)(this,e),this._textures=t,this.loadPromise=null,this._disposed=!1;var l=this._textures.acquire(n);(0,o.y8)(l)?(l.then((function(e){i._disposed?(0,a.RY)(e):i._textureRef=e})),this.loadPromise=l):this._textureRef=l}return(0,i.Z)(e,[{key:"dispose",value:function(){this._textureRef=(0,a.RY)(this._textureRef),this._disposed=!0}},{key:"glTexture",get:function(){return null!=this._textureRef?this._textureRef.glTexture:null}}]),e}()},67581:function(e,t,n){n.d(t,{Z:function(){return b}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),l=n(27366),s=n(7138),u=n(91505),c=n(79056),d=n(32718),f=n(92026),v=n(67426),h=n(49861),p=(n(93169),n(84936),n(69912)),y=n(46634),m=n(69787),g=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._updatingHandles=new y.R,i.layer=null,i.parent=null,i}return(0,i.Z)(n,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var n,r=e.layer&&e.layer.id||"no id",i=(null===(n=e.layer)||void 0===n?void 0:n.title)||"no title";d.Z.getLogger(e).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(r,"')"),t)}}))}},{key:"destroy",value:function(){this._updatingHandles=(0,f.SC)(this._updatingHandles)}},{key:"fullOpacity",get:function(){var e,t,n,r;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(n=null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)&&void 0!==n?n:1)}},{key:"suspended",get:function(){return this.destroyed||!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}},{key:"updating",get:function(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"updateSuspended",get:function(){return this.suspended}},{key:"visible",get:function(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)},set:function(e){this._overrideIfSome("visible",e)}},{key:"visibleAtCurrentScale",get:function(){return!0}},{key:"visibleAtCurrentTimeExtent",get:function(){var e,t=this.view.timeExtent,n=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!n||!t.intersection(n).isEmpty}},{key:"canResume",value:function(){var e,t,n,r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(n=this.view)||void 0===n?void 0:n.ready)&&(0,m.Cy)(r)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}},{key:"getSuspendInfo",value:function(){var e,t,n=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(n.viewNotReady=!0),this.layer&&this.layer.loaded||(n.layerNotLoaded=!0);var r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,m.Cy)(r)&&this.visibleAtCurrentScale||(n.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(n.outsideVisibilityTimeExtent=!0),this.visible||(n.layerInvisible=!0),n}},{key:"isUpdating",value:function(){return!1}}]),n}((0,c.IG)((0,v.v)(u.Z.EventedMixin(s.default))));(0,l._)([(0,h.Cb)()],g.prototype,"view",void 0),(0,l._)([(0,h.Cb)()],g.prototype,"fullOpacity",null),(0,l._)([(0,h.Cb)()],g.prototype,"layer",void 0),(0,l._)([(0,h.Cb)()],g.prototype,"parent",void 0),(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"suspended",null),(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"suspendInfo",null),(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"legendEnabled",null),(0,l._)([(0,h.Cb)({type:Boolean,readOnly:!0})],g.prototype,"updating",null),(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"updatingProgress",null),(0,l._)([(0,h.Cb)()],g.prototype,"updateSuspended",null),(0,l._)([(0,h.Cb)()],g.prototype,"visible",null),(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentScale",null),(0,l._)([(0,h.Cb)({readOnly:!0})],g.prototype,"visibleAtCurrentTimeExtent",null);var b=g=(0,l._)([(0,p.j)("esri.views.layers.LayerView")],g)}}]);
//# sourceMappingURL=12996.7df98d47.chunk.js.map