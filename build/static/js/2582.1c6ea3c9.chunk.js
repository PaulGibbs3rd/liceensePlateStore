"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[2582],{2582:function(e,t,n){n.r(t),n.d(t,{ManipulatedObject3DMediaElement:function(){return D}});var o=n(1413),r=n(15671),i=n(43144),a=n(60136),l=n(29388),s=n(27366),u=n(91505),d=n(42537),c=n(94172),p=n(49861),v=(n(93169),n(32718),n(84936),n(69912)),f=n(74165),h=n(15861),y=n(29439),_=(n(59486),n(7138)),m=n(63780),g=n(46634),C=n(79803),b=n(17877),w=n(80885),k=n(848),Z=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;return(0,r.Z)(this,n),(o=t.call(this,e))._updatingHandles=new g.R,o}return(0,i.Z)(n,[{key:"operations",get:function(){return this._operations}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,d.ed)(this._updatingHandles),this._updatingHandles.add((function(){var t=e.element.georeference;return"control-points"===(null===t||void 0===t?void 0:t.type)?t.controlPoints:null}),(function(t){return e._elementControlPointsChanged(t)}),c.initial)])}},{key:"_elementControlPointsChanged",value:function(e){var t=this;if(this._updatedElementControlPoints!==e){var n=null===e||void 0===e?void 0:e.map((function(e){return e.mapPoint})).filter(m.pC),o=this.view.spatialReference;this._updatingHandles.addPromise(this._whenProjected(n,o,(function(e){if(e){var n=t._operations,r=new w.Z({rings:[e.map((function(e){return[e.x,e.y]}))],spatialReference:o});null!==n&&void 0!==n&&n.trySetGeometry(r)?t.onModifiedExternally():t._replaceOperations(b.c.fromGeometry(r,t.view.state.viewingMode))}else t._replaceOperations(null)})))}}},{key:"_operationsGeometryChanged",value:function(){var e,t=this,n=this.element.georeference,o=this._operations;if(o&&n&&"control-points"===n.type&&n.controlPoints){var r=o.data.geometry,i=n.controlPoints.map((function(e){return e.mapPoint})).filter(m.pC);if((null===(e=r.rings[0])||void 0===e?void 0:e.length)===i.length){var a=r.rings[0].map((function(e){var t=(0,y.Z)(e,2),n=t[0],o=t[1];return new k.Z({x:n,y:o,spatialReference:r.spatialReference})})),l=i.map((function(e){return e.spatialReference}));this._updatingHandles.addPromise(this._whenProjected(a,l,(function(e){return t._updateElementControlPoints(e)})))}else this._updateElementControlPoints(null)}}},{key:"_updateElementControlPoints",value:function(e){var t,n=this.element.georeference;if(n&&e&&"control-points"===n.type&&(null===(t=n.controlPoints)||void 0===t?void 0:t.length)===(null===e||void 0===e?void 0:e.length)){e||(n.controlPoints=null);var o=n.controlPoints;if((null===o||void 0===o?void 0:o.length)===e.length)for(var r=0;r<o.length;r++)o[r].mapPoint=e[r]}}},{key:"_whenProjected",value:function(){var e=(0,h.Z)((0,f.Z)().mark((function e(t,n,o){var r,i,a,l,s;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void o(t));case 2:return r=this._operations,i=this.element.georeference,a=t.map((function(e){return e.spatialReference})),l=Array.isArray(n)?n:new Array(a.length).fill(n),e.next=5,(0,C.initializeProjection)(Array.from(a).map((function(e,t){return{source:e,dest:l[t]}})));case 5:s=t.map((function(e,t){return(0,C.project)(e,l[t])})),r===this._operations&&i===this.element.georeference&&o(s);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,o){return e.apply(this,arguments)}}()},{key:"_replaceOperations",value:function(e){var t=this;this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",(function(){return t._operationsGeometryChanged()})),e)}}]),n}(_.default);(0,s._)([(0,p.Cb)({constructOnly:!0})],Z.prototype,"view",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],Z.prototype,"layer",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],Z.prototype,"element",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],Z.prototype,"onModifiedExternally",void 0),(0,s._)([(0,p.Cb)()],Z.prototype,"_operations",void 0),(0,s._)([(0,p.Cb)()],Z.prototype,"operations",null),(0,s._)([(0,p.Cb)()],Z.prototype,"updating",null),Z=(0,s._)([(0,v.j)("esri.views.3d.interactive.editingTools.media.MediaElementControllerControlPoints")],Z);var E=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;return(0,r.Z)(this,n),(o=t.call(this,e))._updatingHandles=new g.R,o}return(0,i.Z)(n,[{key:"operations",get:function(){return this._operations}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,d.ed)(this._updatingHandles),this._updatingHandles.add((function(){var t;return null===(t=e.element.georeference)||void 0===t?void 0:t.coords}),(function(t){return e._elementCoordinatesChanged(t)}),c.initial)])}},{key:"_elementCoordinatesChanged",value:function(e){var t=this;this._updatedElementCoordinates!==e&&this._updatingHandles.addPromise(this._whenProjected(e,this.view.spatialReference,(function(e){if(e){var n=t._operations;null!==n&&void 0!==n&&n.trySetGeometry(e)?t.onModifiedExternally():t._replaceOperations(b.c.fromGeometry(e,t.view.state.viewingMode))}else t._replaceOperations(null)})))}},{key:"_operationsGeometryChanged",value:function(){var e=this,t=this.element.georeference,n=this._operations;if(n&&t){var o=n.data.geometry;if(t.coords){var r=t.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(o,r,(function(t){return e._updateElementCoordinates(t)})))}else this._updateElementCoordinates(o)}}},{key:"_updateElementCoordinates",value:function(e){var t=this.element.georeference;t&&(t.coords=e,this._updatedElementCoordinates=t.coords)}},{key:"_whenProjected",value:function(){var e=(0,h.Z)((0,f.Z)().mark((function e(t,n,o){var r,i,a;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",void o(t));case 2:return r=this._operations,i=this.element.georeference,e.next=6,(0,C.projectWithZConversion)(t,n);case 6:a=e.sent,r===this._operations&&i===this.element.georeference&&o(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,o){return e.apply(this,arguments)}}()},{key:"_replaceOperations",value:function(e){var t=this;this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",(function(){return t._operationsGeometryChanged()})),e),this.onModifiedExternally()}}]),n}(_.default);(0,s._)([(0,p.Cb)({constructOnly:!0})],E.prototype,"view",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],E.prototype,"layer",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],E.prototype,"element",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],E.prototype,"onModifiedExternally",void 0),(0,s._)([(0,p.Cb)()],E.prototype,"_operations",void 0),(0,s._)([(0,p.Cb)()],E.prototype,"operations",null),(0,s._)([(0,p.Cb)()],E.prototype,"updating",null),E=(0,s._)([(0,v.j)("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],E);var P=n(32035),H=n(12400),O=n(68859),M=n(17672),j=n(22136);function x(e,t,n){return R(e.allLayerViews.find((function(e){return e.layer===t})),n)}function R(e,t){if(!e||"media-3d"!==e.type||e.suspended)return!1;var n=e.layer.source;return!!n&&(n instanceof M.Z||n instanceof j.Z?n===t:"hasElement"in n&&n.hasElement(t))}var G=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;return(0,r.Z)(this,n),(o=t.call(this,e)).interactive=!0,o.selectable=!1,o.grabbable=!0,o.grabbing=!1,o.dragging=!1,o.hovering=!0,o.selected=!1,o.cursor=null,o.consumesClicks=!0,o.events=new u.Z.EventEmitter,o.addHandles((0,c.watch)((function(){return o.selected}),(function(e){return o.events.emit("select-changed",{action:e?"select":"deselect"})}),c.sync)),o}return(0,i.Z)(n,[{key:"grabbableForEvent",value:function(){return!0}},{key:"destroy",value:function(){this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.view,n=this.layer,o=this.element;if(!x(t,n,o))return null;var r=t.toMap(e,{include:{layer:n,element:o}});return r&&(0,O.K)(r,V,t.renderSpatialReference)?(0,P.p)(V,t.state.camera.eye):null}},{key:"onElevationChange",value:function(){}},{key:"onViewChange",value:function(){}}]),n}(_.default);(0,s._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],G.prototype,"element",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],G.prototype,"layer",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],G.prototype,"view",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"interactive",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"selectable",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"grabbable",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"grabbing",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"dragging",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"hovering",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"selected",void 0),(0,s._)([(0,p.Cb)()],G.prototype,"cursor",void 0),G=(0,s._)([(0,v.j)("esri.views.3d.interactive.editingTools.media.MediaElementManipulator3D")],G);var V=(0,H.Ue)(),A=Symbol(),D=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(e){var o;return(0,r.Z)(this,n),(o=t.call(this,e)).tool="transform",o}return(0,i.Z)(n,[{key:"operations",get:function(){var e;return null===(e=this._controller)||void 0===e?void 0:e.operations}},{key:"elevationInfo",get:function(){return{mode:"on-the-ground",offset:0}}},{key:"_layerView",get:function(){var e=this,t=this.view.allLayerViews.find((function(t){return t.layer===e.layer}));return"media-3d"===(null===t||void 0===t?void 0:t.type)?t:null}},{key:"visible",get:function(){return R(this._layerView,this.element)}},{key:"isDraped",get:function(){return!0}},{key:"origin",get:function(){return null}},{key:"updating",get:function(){var e;return!(null===(e=this._controller)||void 0===e||!e.updating)}},{key:"_controllerClass",get:function(){var e;return"transform"===this.tool||"control-points"!==(null===(e=this.element.georeference)||void 0===e?void 0:e.type)?E:Z}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,c.watch)((function(){return e._controllerClass}),(function(t){return e._updateController(t)}),c.syncAndInitial),(0,c.on)((function(){return e._layerView}),"element-render-changed",(function(t){var n=t.element;e.element===n&&e.emit("committed")}))])}},{key:"toMap",value:function(e){var t=this.layer,n=this.element;return this.view.toMap(e,{include:{layer:t,element:n}})}},{key:"createManipulator",value:function(e){var t=this.view,n=this.layer,r=this.element;return new G((0,o.Z)({view:t,layer:n,element:r},e))}},{key:"_updateController",value:function(e){var t=this;if(!(this._controller&&this._controller instanceof e)){this.removeHandles(A);var n=this.view,o=this.layer,r=this.element,i=function(){t.emit("modified-externally")};this._controller=new e({view:n,layer:o,element:r,onModifiedExternally:i}),i(),this.addHandles((0,d.ed)(this._controller),A)}}}]),n}(u.Z.EventedAccessor);(0,s._)([(0,p.Cb)({constructOnly:!0})],D.prototype,"view",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],D.prototype,"layer",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],D.prototype,"element",void 0),(0,s._)([(0,p.Cb)()],D.prototype,"tool",void 0),(0,s._)([(0,p.Cb)()],D.prototype,"_controller",void 0),(0,s._)([(0,p.Cb)()],D.prototype,"elevationInfo",null),(0,s._)([(0,p.Cb)()],D.prototype,"_layerView",null),(0,s._)([(0,p.Cb)()],D.prototype,"visible",null),(0,s._)([(0,p.Cb)()],D.prototype,"updating",null),(0,s._)([(0,p.Cb)()],D.prototype,"_controllerClass",null),D=(0,s._)([(0,v.j)("esri.views.3d.interactive.editingTools.ManipulatedObject3DMediaElement")],D)}}]);
//# sourceMappingURL=2582.1c6ea3c9.chunk.js.map