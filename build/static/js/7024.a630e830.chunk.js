"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[7024],{7024:function(e,t,a){a.r(t),a.d(t,{default:function(){return X}});var n,i=a(1413),r=a(37762),o=a(74165),s=a(15861),l=a(15671),u=a(43144),d=a(82963),c=a(60136),h=a(29388),p=a(27366),y=(a(59486),a(80987)),f=a(10064),g=a(32718),v=a(77427),m=a(66978),C=a(49861),k=(a(93169),a(84936),a(69912)),L=a(30651),b=a(83406),M=a(80457);!function(e){e.MULTIPLIER="multiplier",e.ABSOLUTE="absoluteValue"}(n||(n={}));var w,E,x,T,D=a(50568),Z=a(21438),N=a(69086),_=a(6693),R=a(56811),A=a(29439),I=a(65905),G=null;function P(){return w||(w=a.e(39672).then(a.bind(a,39672)).then((function(e){return e.l})).then((function(e){return(0,e.default)({locateFile:function(e){return(0,I.V)("esri/libs/linkchartlayout/".concat(e))}})})).then((function(e){!function(e){G=e}(e)})))}function S(e,t,a,n,i,r){var o=a.length,s=i.length,l=Float64Array.BYTES_PER_ELEMENT,u=Uint32Array.BYTES_PER_ELEMENT,d=Uint8Array.BYTES_PER_ELEMENT,c=16+o*(d+2*l)+s*(2*u),h=G._malloc(c);try{var p=h+16-h%16,y=p+o*l,f=y+o*l,g=f+s*u,v=g+s*u,m=function(){return[G.HEAPF64.subarray(p>>3,(p>>3)+o),G.HEAPF64.subarray(y>>3,(y>>3)+o),G.HEAPU32.subarray(f>>2,(f>>2)+s),G.HEAPU32.subarray(g>>2,(g>>2)+s),G.HEAPU8.subarray(v,v+o)]},C=m(),k=(0,A.Z)(C,5),L=k[0],b=k[1],M=k[2],w=k[3],E=k[4];L.set(a),b.set(n),M.set(i),w.set(r),E.set(t);var x=e(o,v,p,y,s,f,g),T=null,D=null;if(x){var Z=G.getLayoutLinksTypes(),N=G.getLayoutLinksVerticesEndIndices(),_=G.getLayoutLinksVertices(),R=G.countLayoutLinksVertices();!s||Z&&N?R&&!_?x=!1:(T={types:new Uint8Array(G.HEAPU8.subarray(Z,Z+s)),vertexEndIndex:new Uint32Array(G.HEAPU32.subarray(N>>2,(N>>2)+s)),vertices:new Float64Array(G.HEAPF64.subarray(_>>3,(_>>3)+2*R))},D=G.getAuxiliaryGraphicElements()):x=!1}var I=m(),P=(0,A.Z)(I,5),S=P[0],z=P[1],H=P[2],O=P[3],B=P[4];return a.set(S),n.set(z),i.set(H),r.set(O),t.set(B),{success:x,links:T,graphics:D}}finally{G._free(h),G.cleanupLayout()}}(T=E||(E={}))[T.None=0]="None",T[T.IsMovable=1]="IsMovable",T[T.IsGeographic=2]="IsGeographic",T[T.IsRoot=4]="IsRoot",function(e){e[e.Regular=0]="Regular",e[e.Orthogonal=1]="Orthogonal",e[e.Curved=2]="Curved",e[e.Recursive=3]="Recursive"}(x||(x={}));var z,H,O,B,F,U,Q,j,Y;!function(e){e.getMinIdealEdgeLength=function(){return G.getMinIdealEdgeLength()},e.apply=function(e,t,a,n,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return S((function(e,t,a,n,i,l,u){return G.applyForceDirectedLayout(e,t,a,n,i,l,u,r,o,s)}),e,t,a,n,i)}}(z||(z={})),function(e){e.apply=function(e,t,a,n,i){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return S((function(e,t,a,n,i,l,u){return G.applyCommunityLayout(e,t,a,n,i,l,u,r,o,s)}),e,t,a,n,i)}}(H||(H={})),function(e){e.apply=function(e,t,a,n,i){return S(G.applySimpleLayout,e,t,a,n,i)}}(O||(O={})),function(e){e.apply=function(e,t,a,n,i){return S(G.applyHierarchicalLayout,e,t,a,n,i)}}(B||(B={})),function(e){e.apply=function(e,t,a,n,i){return S(G.applyRadialTreeLayout,e,t,a,n,i)}}(F||(F={})),function(e){e.apply=function(e,t,a,n,i){return S(G.applySmartTreeLayout,e,t,a,n,i)}}(U||(U={})),function(e){e.apply=function(e,t,a,n,i,r,o,s,l){return S((function(e,t,a,r,o,u,d){if(n.length!==e)return!1;if(i.length!==e)return!1;if(s.length!==o)return!1;if(l.length!==o)return!1;var c=Float64Array.BYTES_PER_ELEMENT,h=16,p=G._malloc(h+e*c),y=G._malloc(h+e*c),f=G._malloc(h+o*c),g=G._malloc(h+o*c),v=p+h-p%h,m=y+h-y%h,C=f+h-f%h,k=g+h-g%h;try{return G.HEAPF64.subarray(v>>3,(v>>3)+e).set(n),G.HEAPF64.subarray(m>>3,(m>>3)+e).set(i),G.HEAPF64.subarray(C>>3,(C>>3)+o).set(s),G.HEAPF64.subarray(k>>3,(k>>3)+o).set(l),G.applyChronologicalLayout(e,t,a,r,v,m,o,u,d,C,k)}finally{G._free(p),G._free(y),G._free(f),G._free(g)}}),e,t,a,r,o)}}(Q||(Q={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(j||(j={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(Y||(Y={}));var V=a(97316),W=a(53866),K=a(848),q=a(29909),J=function(e){(0,c.Z)(a,e);var t=(0,h.Z)(a);function a(e){var n;if((0,l.Z)(this,a),(n=t.call(this,e)).dataPreloadedInLocalCache=!1,n.defaultLinkChartConfig=null,n._currentLinkChartConfig={layoutMode:"RADIAL_TREE"},n._graphTypeLookup=new Map,n.dataManager=null,n.knowledgeGraph=null,n.layers=new y.Z,n.entityLinkChartDiagramLookup=new Map,n.relationshipLinkChartDiagramLookup=new Map,n.linkChartExtent=new W.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),n.memberEntityTypes=null,n.memberRelationshipTypes=null,n.sublayerIdsCache=new Map,n.tables=new y.Z,n.type="link-chart",n._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new f.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it");return(0,d.Z)(n)}return(0,u.Z)(a,[{key:"normalizeCtorArgs",value:function(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}},{key:"_initializeLayerProperties",value:function(e){var t,a,n,i,r,o,s,l,u,d,c=this;if(!this.title&&this.url){var h=this.url.split("/");this.title=h[h.length-2]}var p=new Set,y=[],v=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new f.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((function(e){e.name&&c._graphTypeLookup.set(e.name,e)})),null!==(a=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==a&&a.forEach((function(e){e.name&&c._graphTypeLookup.set(e.name,e)})),null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers?(y=null!==(i=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==i?i:[],v=null!==(r=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==r?r:[]):null!==(o=e.inclusionModeDefinition)&&void 0!==o&&o.namedTypeDefinitions&&(null===(s=e.inclusionModeDefinition)||void 0===s?void 0:s.namedTypeDefinitions.size)>0?null===(l=e.inclusionModeDefinition)||void 0===l||l.namedTypeDefinitions.forEach((function(t,a){var n,i,r=c._graphTypeLookup.get(a);if(!r)return g.Z.getLogger(c).warn("A named type, ".concat(a,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(n=e.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.delete(a));"relationship"===r.type?p.has(a)||(p.add(a),v.push(r)):"entity"===r.type?p.has(a)||(p.add(a),y.push(r)):(g.Z.getLogger(c).warn("A named type, ".concat(a,", was in the inclusion list that wasn't properly modeled and will be removed")),null===(i=e.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.delete(a))})):(y=null!==(u=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==u?u:[],v=null!==(d=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==d?d:[]);var m=new D.Qc({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=y,this.memberRelationshipTypes=v,this.dataManager=m}},{key:"load",value:function(e){var t=this;return this.addResolvingPromise(new Promise((function(a){(0,V.fetchKnowledgeGraph)(t.url).then((function(n){var i,r,l,u,d;if(t._initializeLayerProperties({knowledgeGraph:n,inclusionModeDefinition:t._originalInclusionList}),null!==(i=t.dataManager.inclusionModeDefinition)&&void 0!==i&&null!==(r=i.namedTypeDefinitions)&&void 0!==r&&r.size||(t.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(l=t.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==l&&l.forEach((function(e){var a;e.name&&(null===(a=t.dataManager.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.set(e.name,{useAllData:!0}))})),null!==(u=t.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==u&&u.forEach((function(e){var a;e.name&&(null===(a=t.dataManager.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.set(e.name,{useAllData:!0}))}))),t.dataPreloadedInLocalCache)t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(d=t.dataManager.inclusionModeDefinition)||void 0===d||d.namedTypeDefinitions.forEach((function(e){var a;e.useAllData=!1,null!==(a=e.members)&&void 0!==a&&a.forEach((function(e){var a;(a=e.linkChartLocation instanceof M.Z?e.linkChartLocation:e.linkChartLocation?(0,b.GH)(e.linkChartLocation):null)&&2===a.coords.length&&0===a.lengths.length?t.entityLinkChartDiagramLookup.set(e.id,a):t.relationshipLinkChartDiagramLookup.set(e.id,a)})),t.addResolvingPromise(t._initializeDiagram().then((0,s.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.layers.forEach(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.tables.forEach(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))))}));else{var c,h="GEOGRAPHIC"===(null===(c=t.defaultLinkChartConfig)||void 0===c?void 0:c.layoutMode);t.addResolvingPromise(t.dataManager.refreshCacheContent(void 0,!1,h,!0).then((0,s.Z)((0,o.Z)().mark((function a(){var n,i;return(0,o.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return(0,m.k_)(e),n=[],i=[],t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1,t.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((function(e){e.useAllData=!1}))),a.next=6,t._initializeDiagram();case 6:return t.layers.forEach((function(e){i.push(e.refreshCachedQueryEngine()),n.push(new Promise((function(t){e.on("layerview-create",(function(){t(null)}))})))})),t.tables.forEach((function(e){i.push(e.refreshCachedQueryEngine())})),a.next=10,Promise.all(i);case 10:case"end":return a.stop()}}),a)})))))}a(null)}))}))),Promise.resolve(this)}},{key:"addRecords",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,a){var n,i,r=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],e.t0=(null===a||void 0===a?void 0:a.cascadeAddRelationshipEndNodes)&&this.dataManager.knowledgeGraph.dataModel,!e.t0){e.next=6;break}return e.next=5,(0,N.bv)(t,this.dataManager.knowledgeGraph);case 5:n=e.sent;case 6:return i=t.concat(n).filter((function(e){var t;return!(null!==(t=r.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))})),e.next=9,this._handleNewRecords(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"removeRecords",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var a,n,i,s,l,u,d,c,h,p,y,f,g,v,m,C,k,L,b,M,w,E,x,T,D,Z,N,_,R,A,I,G,P,S,z,H=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=H.length>1&&void 0!==H[1]?H[1]:{cascadeRemoveRelationships:!0,recalculateLayout:!1},n=a.cascadeRemoveRelationships,i=void 0===n||n,s=a.recalculateLayout,l=void 0!==s&&s,u=[],d=(0,r.Z)(t);try{for(d.s();!(c=d.n()).done;)C=c.value,!1===(null===(h=this.dataManager.inclusionModeDefinition)||void 0===h||null===(p=h.namedTypeDefinitions)||void 0===p||null===(y=p.get(C.typeName))||void 0===y?void 0:y.useAllData)&&(null===(f=this.dataManager.inclusionModeDefinition)||void 0===f||null===(g=f.namedTypeDefinitions)||void 0===g||null===(v=g.get(C.typeName))||void 0===v||null===(m=v.members)||void 0===m?void 0:m.has(C.id))&&u.push(C)}catch(o){d.e(o)}finally{d.f()}if(i){k=new Set,L=[],b=(0,r.Z)(u);try{for(b.s();!(M=b.n()).done;)if(w=M.value,this.dataManager.nodeConnectionsLookup.has(w.id)){E=(0,r.Z)(this.dataManager.nodeConnectionsLookup.get(w.id));try{for(E.s();!(x=E.n()).done;)T=x.value,k.add(T)}catch(o){E.e(o)}finally{E.f()}}}catch(o){b.e(o)}finally{b.f()}D=(0,r.Z)(k);try{for(D.s();!(Z=D.n()).done;)if(N=Z.value,this.dataManager.memberIdTypeLookup.has(N)){_=(0,r.Z)(this.dataManager.memberIdTypeLookup.get(N));try{for(_.s();!(R=_.n()).done;)A=R.value,this.dataManager.relationshipTypeNames.has(A)&&L.push({id:N,typeName:A})}catch(o){_.e(o)}finally{_.f()}}}catch(o){D.e(o)}finally{D.f()}u=u.concat(L)}this.dataManager.removeFromLayer(u),I=(0,r.Z)(u);try{for(I.s();!(G=I.n()).done;)S=G.value,null!==(P=this.sublayerIdsCache.get(S.typeName))&&void 0!==P&&P.delete(S.id),this.dataManager.relationshipTypeNames.has(S.typeName)?this.relationshipLinkChartDiagramLookup.delete(S.id):this.entityLinkChartDiagramLookup.delete(S.id)}catch(o){I.e(o)}finally{I.f()}if(e.t0=l,!e.t0){e.next=12;break}return e.next=12,this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,this._currentLinkChartConfig.layoutOptions);case 12:return z=[],this.layers.forEach((function(e){z.push(e.refreshCachedQueryEngine())})),e.next=16,Promise.all(z);case 16:return this._refreshNamedTypes(),e.abrupt("return",u);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"expand",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,a){var n,i,r=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.getConnectedRecordIds(t,a);case 2:return n=e.sent,i=n.filter((function(e){var t;return!(null!==(t=r.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))})),e.next=6,this._handleNewRecords(n);case 6:return e.abrupt("return",{records:i});case 7:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"loadLayerAssumingLocalCache",value:function(){var e,t,a=this;this.memberRelationshipTypes.forEach((function(e){var t=new Z.Z({objectType:e,parentCompositeLayer:a,graphType:"relationship",title:e.name});t.geometryType?a.layers.push(t):a.tables.push(t),a.dataManager.sublayerCaches.has(e.name)||a.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((function(e){var t=new Z.Z({objectType:e,parentCompositeLayer:a,graphType:"entity",title:e.name});t.geometryType?a.layers.push(t):a.tables.push(t),a.dataManager.sublayerCaches.has(e.name)||a.dataManager.sublayerCaches.set(e.name,new Map)})),(null===(e=this.dataManager.inclusionModeDefinition)||void 0===e?void 0:e.namedTypeDefinitions)&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.forEach((function(e,t){var n,i=(0,v.s1)(a.sublayerIdsCache,t,(function(){return new Set}));null===(n=e.members)||void 0===n||n.forEach((function(e){if(i.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof M.Z)a.dataManager.relationshipTypeNames.has(t)?a.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation):a.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation);else{var n=(0,b.GH)(e.linkChartLocation);a.dataManager.relationshipTypeNames.has(t)?a.relationshipLinkChartDiagramLookup.set(e.id,e.linkChartLocation?n:null):a.entityLinkChartDiagramLookup.set(e.id,e.linkChartLocation?n:null)}}))})))}},{key:"calculateLinkChartLayout",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,a,n,i,r,s,l,u,d,c,h,p,y,v,m,C,k,L,M,w,T,Z,N,_,R,A,I,G,S,Q,j,Y,V,J,X,$,ee,te,ae,ne,ie,re,oe,se,le,ue,de,ce,he,pe,ye,fe,ge,ve,me,Ce,ke,Le,be,Me,we,Ee,xe,Te,De,Ze,Ne,_e,Re=this,Ae=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Ae.length>0&&void 0!==Ae[0]?Ae[0]:"RADIAL_TREE",a=Ae.length>1?Ae[1]:void 0,n=[],i=[],r=[],this.dataManager.sublayerCaches.forEach((function(e,t){Re.dataManager.entityTypeNames.has(t)?e.forEach((function(e){n.push({typeName:t,feature:e})})):Re.dataManager.relationshipTypeNames.has(t)&&e.forEach((function(e){i.push({typeName:t,feature:e})}))})),this.entityLinkChartDiagramLookup=new Map,this.relationshipLinkChartDiagramLookup=new Map,s=new Map,l=new Map,u=new Map,d=new Map,c=new Uint8Array(n.length),h=new Float64Array(n.length),p=new Float64Array(n.length),y=new Uint32Array(i.length),v=new Uint32Array(i.length),m=[],C="FORCE_DIRECTED",k=new W.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),"FORCE_DIRECTED",M=0,w=0,e.t0="GEOGRAPHIC"===t?C:t,e.next="FORCE_DIRECTED"===e.t0?9:"COMMUNITY"===e.t0?11:"HIERARCHICAL"===e.t0?13:"RADIAL_TREE"===e.t0?15:"SMART_TREE"===e.t0?17:19;break;case 9:return L=z.apply,e.abrupt("break",20);case 11:return L=H.apply,e.abrupt("break",20);case 13:return L=B.apply,e.abrupt("break",20);case 15:return L=F.apply,e.abrupt("break",20);case 17:return L=U.apply,e.abrupt("break",20);case 19:L=O.apply;case 20:return n.forEach((function(e){var n,i,r,o,s,l,u=e.typeName,y=e.feature;if(null!==a&&void 0!==a&&null!==(n=a.lockedNodeLocations)&&void 0!==n&&n.has(y.attributes[D.zS])){"GEOGRAPHIC"===t&&Re.dataManager.geographicLookup.has(u)?c[M]=E.IsGeographic:c[M]=E.None;var f=a.lockedNodeLocations.get(y.attributes[D.zS]);h[M]=f.x,p[M]=f.y}else if("GEOGRAPHIC"===t&&Re.dataManager.geographicLookup.has(u)){var g;c[M]=E.IsGeographic;var v=null,C=y.attributes[Re.dataManager.geographicLookup.get(u).name];switch(null===(g=Re.dataManager.geographicLookup.get(u))||void 0===g?void 0:g.geometryType){case"esriGeometryPoint":h[M]=null===C||void 0===C?void 0:C.x,p[M]=null===C||void 0===C?void 0:C.y;break;case"esriGeometryPolygon":null!=(null===(i=v=null===C||void 0===C?void 0:C.centroid)||void 0===i?void 0:i.x)&&null!=(null===(r=v)||void 0===r?void 0:r.y)?(h[M]=v.x,p[M]=v.y):c[M]=E.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":null!=(null===(s=v=null===C||void 0===C||null===(o=C.extent)||void 0===o?void 0:o.center)||void 0===s?void 0:s.x)&&null!=(null===(l=v)||void 0===l?void 0:l.y)?(h[M]=v.x,p[M]=v.y):c[M]=E.IsMovable;break;default:c[M]=E.IsMovable}(null==h[M]||null==p[M]||Number.isNaN(h[M])||Number.isNaN(p[M]))&&(c[M]=E.IsMovable,h[M]=0,p[M]=0)}else c[M]=E.IsMovable,h[M]=0,p[M]=0;d.set(y.attributes[D.zS],M),m[M]={feature:y,typeName:u},M++})),T=!1,Z=new Map,i.forEach((function(e){var t=e.feature.attributes[D.WZ],a=e.feature.attributes[D.TD],n=d.get(t),i=d.get(a);if(void 0!==n&&void 0!==i){var o=t+"-"+a,s=Z.get(o);(null===s||void 0===s?void 0:s.has(e.typeName))||(y[w]=n,v[w]=i,void 0===s?Z.set(o,new Map([[e.typeName,w]])):s.set(e.typeName,w),w++),r.push(e)}else T=!0,Re.relationshipLinkChartDiagramLookup.set(t,null)})),T&&g.Z.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),N=this._validateLayoutSettings(t,a),_=this._convertLayoutSettingsToCalculationSettings(N),e.next=27,P();case 27:if(R=L(c,h,p,y.subarray(0,w),v.subarray(0,w),_.computationBudgetTime,_.idealEdgeLengthMultiplier,_.repulsionRadiusMultiplier),A=R.success,I=R.links,A){e.next=30;break}throw new f.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");case 30:for(G=0;G<m.length;G++)p[G]>84.9999?p[G]=84.9999:p[G]<-84.9999&&(p[G]=-84.9999),h[G]>179.9999?h[G]=179.9999:h[G]<-179.9999&&(h[G]=-179.9999),m[G].feature.attributes[D.Cn]=new K.Z(h[G],p[G]),s.has(m[G].typeName)?null===(S=s.get(m[G].typeName))||void 0===S||S.set(m[G].feature.attributes[D.zS],m[G].feature):((Q=new Map).set(m[G].feature.attributes[D.zS],m[G].feature),s.set(m[G].typeName,Q)),u.set(m[G].feature.attributes[D.zS],m[G].feature),j=(0,b.GH)(m[G].feature.attributes[D.Cn]),this.entityLinkChartDiagramLookup.set(m[G].feature.attributes[D.zS],m[G].feature.attributes[D.Cn]?j:null),m[G].feature.attributes[D.Cn].x<k.xmin&&(k.xmin=m[G].feature.attributes[D.Cn].x),m[G].feature.attributes[D.Cn].x>k.xmax&&(k.xmax=m[G].feature.attributes[D.Cn].x),m[G].feature.attributes[D.Cn].y<k.ymin&&(k.ymin=m[G].feature.attributes[D.Cn].y),m[G].feature.attributes[D.Cn].y>k.ymax&&(k.ymax=m[G].feature.attributes[D.Cn].y);if(this.linkChartExtent.xmin=k.xmin,this.linkChartExtent.xmax=k.xmax,this.linkChartExtent.ymin=k.ymin,this.linkChartExtent.ymax=k.ymax,I){e.next=33;break}throw new f.Z("knowledge-graph:layout-failed","Attempting to retrieve link geometry from diagram engine failed");case 33:Y=new Map,V=new Map,J=new Map,X=new Set,$=0;case 35:if(!($<r.length)){e.next=65;break}if(ee=[],te=r[$],ae=te.feature.attributes[D.WZ],ne=te.feature.attributes[D.TD],ie=ae+"-"+ne,re=Z.get(ie).get(te.typeName),oe=0===re?0:null===I||void 0===I?void 0:I.vertexEndIndex[re-1],X.has(re)){e.next=51;break}if(X.add(re),I.types[re]!==x.Recursive){e.next=43;break}ue=[I.vertices[2*oe],I.vertices[2*oe+1]],de=[I.vertices[2*(oe+1)],I.vertices[2*(oe+1)+1]],ce=[.5*(ue[0]+de[0]),.5*(ue[1]+de[1])],he=[ce[0]-ue[0],ce[1]-ue[1]],pe=[ce[0]+he[1],ce[1]-he[0]],ye=[ce[0]-he[1],ce[1]+he[0]],ee.push(ue),ee.push(pe),ee.push(de),ee.push(ye),ee.push(ue),e.next=47;break;case 43:if(I.types[re]===x.Regular){e.next=46;break}return g.Z.getLogger(this).warn("A relationship generated an unsupported link geometry type.  It will not be rendered"),e.abrupt("continue",62);case 46:for(fe=oe;fe<I.vertexEndIndex[re];fe++)ee.push([I.vertices[2*fe],I.vertices[2*fe+1]]);case 47:for(ge=null===(se=m[d.get(ae)])||void 0===se?void 0:se.feature.attributes[D.Cn],ve=null===(le=m[d.get(ne)])||void 0===le?void 0:le.feature.attributes[D.Cn],ee[0][0]===ge.x&&ee[0][1]===ge.y||(ee[0]=[ge.x,ge.y]),ee[ee.length-1][0]===ve.x&&ee[ee.length-1][1]===ve.y||(ee[ee.length-1]=[ve.x,ve.y]),me=1;me<ee.length-1;me++)ee[me][1]>85.5?ee[me][1]=85.5:ee[me][1]<-85.5&&(ee[me][1]=-85.5),ee[me][0]>179.9999?ee[me][0]=179.9999:ee[me][0]<-179.9999&&(ee[me][0]=-179.9999);Y.has(ie)?Y.get(ie).push(ee):Y.set(ie,[ee]);case 51:Ce=Y.get(ie),V.has(ie)||(V.set(ie,new Map),J.set(ie,new Map)),ke=V.get(ie),Le=J.get(ie),ke.has(te.typeName)||(ke.set(te.typeName,Ce.shift()),Le.set(te.typeName,0)),be=ke.get(te.typeName),Le.set(te.typeName,Le.get(te.typeName)+1),Me=new q.Z({paths:be}),te.feature.attributes[D.Cn]=Me,l.has(te.typeName)?null===(we=l.get(te.typeName))||void 0===we||we.set(te.feature.attributes[D.zS],te.feature):((Ee=new Map).set(te.feature.attributes[D.zS],te.feature),l.set(te.typeName,Ee)),u.set(te.feature.attributes[D.zS],te.feature),xe=(0,b.GH)(te.feature.attributes[D.Cn]),this.relationshipLinkChartDiagramLookup.set(te.feature.attributes[D.zS],te.feature.attributes[D.Cn]?xe:null);case 62:$++,e.next=35;break;case 65:for(Te=0,De=r;Te<De.length;Te++)(_e=De[Te]).feature.attributes[D.Fd]=null!==(Ze=null===(Ne=J.get(_e.feature.attributes[D.WZ]+"-"+_e.feature.attributes[D.TD]))||void 0===Ne?void 0:Ne.get(_e.typeName))&&void 0!==Ze?Ze:null;return e.abrupt("return",(this._currentLinkChartConfig={layoutMode:t,layoutOptions:N},{nodes:s,links:l,idMap:u}));case 67:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"applyNewLinkChartLayout",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,a,n,i=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"RADIAL_TREE",a=i.length>1?i[1]:void 0,n=[],e.next=5,this.calculateLinkChartLayout(t,a);case 5:return this.layers.forEach((function(e){n.push(e.refreshCachedQueryEngine())})),e.next=8,Promise.all(n);case 8:this._refreshNamedTypes();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentNodeLocations",value:function(){var e,t,a=new Map;return null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(t=e.namedTypeDefinitions)&&void 0!==t&&t.forEach((function(e){var t;null===e||void 0===e||null===(t=e.members)||void 0===t||t.forEach((function(e){var t,n=e.linkChartLocation,i=e.id;n&&(t="x"in n?{x:n.x,y:n.y}:{x:n.coords[0],y:n.coords[1]},a.set(i,new K.Z({x:t.x,y:t.y})))}))})),a}},{key:"synchronizeInclusionListWithCache",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var a;null!==(a=t.dataManager.inclusionModeDefinition)&&void 0!==a&&a.namedTypeDefinitions.forEach((function(e,a){if(e.useAllData=!1,e.members&&e.members.size>0){if(!t.dataManager.sublayerCaches.get(a))return;var n=new Set(Array.from(t.dataManager.sublayerCaches.get(a).keys()));Array.from(e.members.keys()).filter((function(e){return!n.has(e)})).forEach((function(t){var a;null===(a=e.members)||void 0===a||a.delete(t)}))}})),e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshLinkChartCache",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.refreshCacheContent(t);case 2:return a=[],this.layers.forEach((function(e){a.push(e.refreshCachedQueryEngine())})),e.next=6,Promise.all(a);case 6:this._refreshNamedTypes();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connectEntities",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var a,n,i,s,l,u;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],n=(0,r.Z)(this.dataManager.relationshipTypeNames);try{for(n.s();!(i=n.n()).done;)s=i.value,(l=this.sublayerIdsCache.get(s))&&(a=a.concat(Array.from(l.keys())))}catch(o){n.e(o)}finally{n.f()}return e.next=5,this.dataManager.getAttachedRelationships(t,a);case 5:return u=e.sent,e.next=8,this._handleNewRecords(u);case 8:return e.abrupt("return",{records:u});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleNewRecords",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var a,n,i,s,l,u,d,c,h,p;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],this.dataManager.addToLayer(t),n=(0,r.Z)(t);try{for(n.s();!(i=n.n()).done;)s=i.value,this.sublayerIdsCache.has(s.typeName)||(this.sublayerIdsCache.set(s.typeName,new Set),a.push(s.typeName)),this.sublayerIdsCache.get(s.typeName).add(s.id)}catch(o){n.e(o)}finally{n.f()}for(l=0,u=a;l<u.length;l++)d=u[l],(c=this._graphTypeLookup.get(d))&&(h=new Z.Z({objectType:c,parentCompositeLayer:this,graphType:c.type,title:d}),"entity"===c.type?this.dataManager.entityTypeNames.add(d):this.dataManager.relationshipTypeNames.add(d),h.geometryType?this.layers.push(h):this.tables.push(h),this.dataManager.sublayerCaches.set(d,new Map));return e.next=7,this.dataManager.refreshCacheContent(t.map((function(e){return e.id})));case 7:return(p=Object.assign({},this._currentLinkChartConfig.layoutOptions)).lockedNodeLocations=this.getCurrentNodeLocations(),e.next=11,this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,p);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_initializeDiagram",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,a,n=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defaultLinkChartConfig){e.next=9;break}if(!this.defaultLinkChartConfig.doNotRecalculateLayout){e.next=5;break}null!==(t=this.dataManager.inclusionModeDefinition)&&void 0!==t&&null!==(a=t.namedTypeDefinitions)&&void 0!==a&&a.forEach((function(e,t){var a;null===e||void 0===e||null===(a=e.members)||void 0===a||a.forEach((function(e){var a,i=e.linkChartLocation,r=e.id;if(i){a="x"in i?{x:i.x,y:i.y}:{x:i.coords[0],y:i.coords[1]};var o=(0,b.GH)(a);n.dataManager.relationshipTypeNames.has(t)?n.relationshipLinkChartDiagramLookup.set(r,o):n.entityLinkChartDiagramLookup.set(r,o),n.linkChartExtent.xmin>a.x&&(n.linkChartExtent.xmin=a.x),n.linkChartExtent.xmax<a.x&&(n.linkChartExtent.xmax=a.x),n.linkChartExtent.ymin>a.y&&(n.linkChartExtent.ymin=a.y),n.linkChartExtent.ymax<a.y&&(n.linkChartExtent.ymax=a.y)}}))})),this.memberRelationshipTypes.forEach((function(e){var t;e.name&&(null===(t=n.dataManager.sublayerCaches.get(e.name))||void 0===t||t.forEach((function(e){var t=n.relationshipLinkChartDiagramLookup.get(e.attributes[D.WZ]),a=n.relationshipLinkChartDiagramLookup.get(e.attributes[D.TD]);if(t&&a){var i=(0,b.GH)(new q.Z({paths:[[t.coords[0],t.coords[1]],[a.coords[0],a.coords[1]]]}));n.relationshipLinkChartDiagramLookup.set(e.attributes[D.zS],i)}else n.relationshipLinkChartDiagramLookup.set(e.attributes[D.zS],null)})))})),e.next=7;break;case 5:return e.next=7,this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,(0,i.Z)({lockedNodeLocations:this.getCurrentNodeLocations()},this.defaultLinkChartConfig.layoutOptions||{}));case 7:e.next=11;break;case 9:return e.next=11,this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_refreshNamedTypes",value:function(){var e,t=(0,r.Z)(this.layers);try{for(t.s();!(e=t.n()).done;){e.value.emit("refresh",{dataChanged:!0})}}catch(i){t.e(i)}finally{t.f()}var a,n=(0,r.Z)(this.tables);try{for(n.s();!(a=n.n()).done;){a.value.emit("refresh",{dataChanged:!0})}}catch(i){n.e(i)}finally{n.f()}}},{key:"_validateLayoutSettings",value:function(e,t){var a=function(e){return"number"==typeof e&&!isNaN(e)},i=new Set(["FORCE_DIRECTED","COMMUNITY","GEOGRAPHIC"]),r={};if(!i.has(e)||!t)return!i.has(e)&&t&&g.Z.getLogger(this).warn("Layout mode options were given for a layout mode that does not utilize them, settings will be ignored"),r;var o=t.computationBudgetTime,s=t.repulsionRadiusMultiplier,l=t.idealEdgeLength,u=t.idealEdgeLengthType;!function(e){return a(e)&&e>=1}(o)?void 0!==o&&g.Z.getLogger(this).warn("Invalid layout computationBudgetTime setting, will revert to default setting"):r.computationBudgetTime=o,function(e){return a(e)&&e>=1}(s)?r.repulsionRadiusMultiplier=s:void 0!==s&&g.Z.getLogger(this).warn("Invalid layout repulsionRadiusMultiplier setting, will revert to default setting");var d=void 0!==l||void 0!==u;return"GEOGRAPHIC"!==e&&d?g.Z.getLogger(this).warn("Ideal edge length settings were specified for an incompatible layout mode, and will be ignored"):"GEOGRAPHIC"===e&&d&&(function(e){return Object.values(n).includes(e)}(u)?r.idealEdgeLengthType=u:void 0!==u&&g.Z.getLogger(this).warn('Invalid layout idealEdgeLengthType setting, will revert to "multiplier" setting'),function(e){return a(e)&&e>=0}(l)?r.idealEdgeLength=l:void 0!==l&&g.Z.getLogger(this).warn("Invalid layout idealEdgeLength setting, will revert to default setting")),r}},{key:"_convertLayoutSettingsToCalculationSettings",value:function(e){var t=e.idealEdgeLength;return e.idealEdgeLengthType===n.ABSOLUTE&&(void 0===t?t=-1:t*=-1),{computationBudgetTime:e.computationBudgetTime,repulsionRadiusMultiplier:e.repulsionRadiusMultiplier,idealEdgeLengthMultiplier:t}}}]),a}((0,_.h7)((0,R.M)(L.Z)));(0,p._)([(0,C.Cb)()],J.prototype,"dataPreloadedInLocalCache",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"defaultLinkChartConfig",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"dataManager",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"knowledgeGraph",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"layers",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"entityLinkChartDiagramLookup",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"relationshipLinkChartDiagramLookup",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"linkChartExtent",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"memberEntityTypes",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"memberRelationshipTypes",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"sublayerIdsCache",void 0),(0,p._)([(0,C.Cb)()],J.prototype,"tables",void 0),(0,p._)([(0,C.Cb)({json:{read:!1}})],J.prototype,"type",void 0);var X=J=(0,p._)([(0,k.j)("esri.layers.LinkChartLayer")],J)}}]);
//# sourceMappingURL=7024.a630e830.chunk.js.map