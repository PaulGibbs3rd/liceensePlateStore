"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[38848],{43244:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(37762),i=r(15671),a=r(43144),s=function(){function e(t){(0,i.Z)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return(0,a.Z)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"peekLast",value:function(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}},{key:"find",value:function(e){if(0===this.size)return null;var t,r=(0,n.Z)(this._buffer);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(null!=i&&e(i))return i}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();null!=t;)e&&e(t),t=this.dequeue()}}]),e}()},46228:function(e,t,r){r.d(t,{I:function(){return i},v:function(){return a}});var n=r(16889);function i(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(0,n.uZ)(e,0,o),a=0;a<4;a++)t[r+a]=Math.floor(256*l(i*s[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,n=0;n<4;n++)r+=e[t+n]*u[n];return r}var s=[1,256,65536,16777216],u=[1/256,1/65536,1/16777216,1/4294967296],o=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},6388:function(e,t,r){r.d(t,{Fp:function(){return l},RL:function(){return p},UV:function(){return f},bk:function(){return d}});var n=r(29439),i=r(37762),a=r(46228),s=r(77981),u=r(691),o=r(94109);function l(e){switch(e.type){case"CIMPointSymbol":var t=e.symbolLayers;if(!t||1!==t.length)return null;var r=t[0];return"CIMVectorMarker"!==r.type?null:l(r);case"CIMVectorMarker":var n,i=e.markerGraphics;if(!i||1!==i.length)return null;var a=i[0];if(!a)return null;var s=a.geometry;if(!s)return null;var u=a.symbol;return!u||"CIMPolygonSymbol"!==u.type&&"CIMLineSymbol"!==u.type||null!==(n=u.symbolLayers)&&void 0!==n&&n.some((function(e){return!!e.effects}))?null:{type:"sdf",geom:s,asFill:"CIMPolygonSymbol"===u.type}}}function c(e){var t,r=1/0,n=-1/0,a=1/0,s=-1/0,u=(0,i.Z)(e);try{for(u.s();!(t=u.n()).done;){var o,l=t.value,c=(0,i.Z)(l);try{for(c.s();!(o=c.n()).done;){var d=o.value;d[0]<r&&(r=d[0]),d[0]>n&&(n=d[0]),d[1]<a&&(a=d[1]),d[1]>s&&(s=d[1])}}catch(f){c.e(f)}finally{c.f()}}}catch(f){u.e(f)}finally{u.f()}return[r,a,n,s]}function d(e){return e?e.rings?c(e.rings):e.paths?c(e.paths):(0,s.YX)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function f(e,t,r,i,a){var s=(0,n.Z)(e,4),u=s[0],l=s[1],c=s[2],d=s[3];if(c<u||d<l)return[0,0,0,1];var f=c-u,p=d-l,h=o.iA,y=o.s4,v=Math.floor(.5*(.5*h-y)),m=(h-2*(v+y))/Math.max(f,p),b=Math.round(f*m)+2*v,g=Math.round(p*m)+2*v,S=1;t&&(S=g/m/(t.ymax-t.ymin));var x=0,_=0,k=1;i&&(a?t&&r&&t.ymax-t.ymin>0&&(k=(t.xmax-t.xmin)/(t.ymax-t.ymin),x=i.x/(r*k),_=i.y/r):(x=i.x,_=i.y)),t&&(x=.5*(t.xmax+t.xmin)+x*(t.xmax-t.xmin),_=.5*(t.ymax+t.ymin)+_*(t.ymax-t.ymin)),x-=u,_-=l,x*=m,_*=m;var w=(x+=v)/b-.5,Z=(_+=v)/g-.5;return a&&r&&(w*=r*k,Z*=r),[S,w,Z,k]}function p(e){var t,r=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),a=function(e){var t,r=1/0,n=-1/0,a=1/0,s=-1/0,o=(0,i.Z)(e);try{for(o.s();!(t=o.n()).done;){var l,c=t.value,d=(0,i.Z)(c);try{for(d.s();!(l=d.n()).done;){var f=l.value;f[0]<r&&(r=f[0]),f[0]>n&&(n=f[0]),f[1]<a&&(a=f[1]),f[1]>s&&(s=f[1])}}catch(p){d.e(p)}finally{d.f()}}}catch(p){o.e(p)}finally{o.f()}return new u.Z(r,a,n-r,s-a)}(r),s=o.iA,l=o.s4,c=Math.floor(.5*(.5*s-l)),d=(s-2*(c+l))/Math.max(a.width,a.height),f=Math.round(a.width*d)+2*c,p=Math.round(a.height*d)+2*c,y=[],v=(0,i.Z)(r);try{for(v.s();!(t=v.n()).done;){var m=t.value;if(m&&m.length>1){var b,g=[],S=(0,i.Z)(m);try{for(S.s();!(b=S.n()).done;){var x=b.value,_=(0,n.Z)(x,2),k=_[0],w=_[1];k-=a.x,w-=a.y,k*=d,w*=d,k+=c-.5,w+=c-.5,e.asFill?g.push([k,w]):g.push([Math.round(k),Math.round(w)])}}catch(I){S.e(I)}finally{S.f()}if(e.asFill){var Z=g.length-1;g[0][0]===g[Z][0]&&g[0][1]===g[Z][1]||g.push(g[0])}y.push(g)}}}catch(I){v.e(I)}finally{v.f()}var V=function(e,t,r,n){for(var a=t*r,s=new Array(a),u=n*n+1,o=0;o<a;++o)s[o]=u;var l,c=(0,i.Z)(e);try{for(c.s();!(l=c.n()).done;)for(var d=l.value,f=d.length,p=1;p<f;++p){var h=d[p-1],y=d[p],v=void 0,m=void 0,b=void 0,g=void 0;h[0]<y[0]?(v=h[0],m=y[0]):(v=y[0],m=h[0]),h[1]<y[1]?(b=h[1],g=y[1]):(b=y[1],g=h[1]);var S=Math.floor(v)-n,x=Math.floor(m)+n,_=Math.floor(b)-n,k=Math.floor(g)+n;S<0&&(S=0),x>t&&(x=t),_<0&&(_=0),k>r&&(k=r);for(var w=y[0]-h[0],Z=y[1]-h[1],V=w*w+Z*Z,F=S;F<x;F++)for(var E=_;E<k;E++){var R=F+.5,C=E+.5,z=void 0,T=void 0,O=(R-h[0])*w+(C-h[1])*Z;O<0?(z=h[0],T=h[1]):O>V?(z=y[0],T=y[1]):(O/=V,z=h[0]+O*w,T=h[1]+O*Z);var M=(R-z)*(R-z)+(C-T)*(C-T),A=(r-E-1)*t+F;M<s[A]&&(s[A]=M)}}}catch(I){c.e(I)}finally{c.f()}for(var q=0;q<a;++q)s[q]=Math.sqrt(s[q]);return s}(y,f,p,c);return e.asFill&&function(e,t,r,n,a){var s,u=(0,i.Z)(e);try{for(u.s();!(s=u.n()).done;)for(var o=s.value,l=o.length,c=1;c<l;++c){var d=o[c-1],f=o[c],p=void 0,h=void 0,y=void 0,v=void 0;d[0]<f[0]?(p=d[0],h=f[0]):(p=f[0],h=d[0]),d[1]<f[1]?(y=d[1],v=f[1]):(y=f[1],v=d[1]);var m=Math.floor(p),b=Math.floor(h)+1,g=Math.floor(y),S=Math.floor(v)+1;m<n&&(m=n),b>t-n&&(b=t-n),g<n&&(g=n),S>r-n&&(S=r-n);for(var x=g;x<S;++x)if(d[1]>x!=f[1]>x){for(var _=x+.5,k=(r-x-1)*t,w=m;w<b;++w)w+.5<(f[0]-d[0])*(_-d[1])/(f[1]-d[1])+d[0]&&(a[k+w]=-a[k+w]);for(var Z=n;Z<m;++Z)a[k+Z]=-a[k+Z]}}}catch(I){u.e(I)}finally{u.f()}}(y,f,p,c,V),[h(V,c),f,p]}function h(e,t){for(var r=2*t,n=e.length,i=new Uint8Array(4*n),s=0;s<n;++s){var u=.5-e[s]/r;(0,a.I)(u,i,4*s)}return i}},57898:function(e,t,r){r.r(t),r.d(t,{default:function(){return Er}});var n=r(37762),i=r(1413),a=r(93433),s=r(74165),u=r(15861),o=r(15671),l=r(43144),c=r(60136),d=r(29388),f=r(27366),p=r(52639),h=r(49861),y=r(93169),v=r(32718),m=(r(84936),r(69912)),b=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).isAggregate=!0,e}return(0,l.Z)(r,[{key:"getEffectivePopupTemplate",value:function(){var e;if(this.popupTemplate)return this.popupTemplate;var t=null===(e=this.sourceLayer)||void 0===e?void 0:e.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null}},{key:"getObjectId",value:function(){return this.attributes.aggregateId}}]),r}(p.Z);(0,f._)([(0,h.Cb)({type:Boolean})],b.prototype,"isAggregate",void 0);var g=b=(0,f._)([(0,m.j)("esri.AggregateGraphic")],b),S=(r(59486),r(63780)),x=r(80987),_=r(41644),k=r(10064),w=r(42537),Z=r(92026),V=r(18202),I=r(66978),F=r(94172),E=r(7138),R=r(41978),C=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e))._filter=null,n.duration=(0,y.Z)("mapview-transitions-duration"),n._excludedEffectView=new R.AM(e),n._includedEffectView=new R.AM(e),n}return(0,l.Z)(r,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(e){this._get("featureEffect")!==e&&this._transitionTo(e)}},{key:"filter",get:function(){var e;return this._filter||(null===(e=this.featureEffect)||void 0===e?void 0:e.filter)||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",set:function(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}},{key:"transitionStep",value:function(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}},{key:"endTransitions",value:function(){this._includedEffectView.endTransitions(),this._excludedEffectView.endTransitions(),this._filter=null}},{key:"_transitionTo",value:function(e){var t=this._get("featureEffect"),r=e,n=null===r||void 0===r?void 0:r.includedEffect,i=null===r||void 0===r?void 0:r.excludedEffect,a=this._includedEffectView.canTransitionTo(n)&&this._excludedEffectView.canTransitionTo(i);this._includedEffectView.effect=n,this._excludedEffectView.effect=i,this._set("featureEffect",r),this._filter=(null===r||void 0===r?void 0:r.filter)||(null===t||void 0===t?void 0:t.filter)||null,a||this.endTransitions()}}]),r}(E.default);(0,f._)([(0,h.Cb)()],C.prototype,"_filter",void 0),(0,f._)([(0,h.Cb)()],C.prototype,"_excludedEffectView",void 0),(0,f._)([(0,h.Cb)()],C.prototype,"_includedEffectView",void 0),(0,f._)([(0,h.Cb)()],C.prototype,"duration",void 0),(0,f._)([(0,h.Cb)()],C.prototype,"excludedEffects",null),(0,f._)([(0,h.Cb)()],C.prototype,"featureEffect",null),(0,f._)([(0,h.Cb)()],C.prototype,"filter",null),(0,f._)([(0,h.Cb)()],C.prototype,"hasEffects",null),(0,f._)([(0,h.Cb)()],C.prototype,"includedEffects",null),(0,f._)([(0,h.Cb)({value:0})],C.prototype,"scale",null),(0,f._)([(0,h.Cb)()],C.prototype,"transitioning",null);var z=C=(0,f._)([(0,m.j)("esri.layers.effects.FeatureEffectView")],C),T=r(83406),O=r(18661),M=r(37270),A=r(37933),q=r(50863),P=r(38511),U=r(49818),B=r(78952),N=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).features=[],e}return(0,l.Z)(r,[{key:"readFeatures",value:function(e,t){for(var r=B.Z.fromJSON(t.spatialReference),n=[],i=0;i<e.length;i++){var a,s=e[i],u=g.fromJSON(s),o=null===(a=s.geometry)||void 0===a?void 0:a.spatialReference;null==u.geometry||o||(u.geometry.spatialReference=r);var l=s.aggregateGeometries,c=u.aggregateGeometries;if(l&&null!=c)for(var d in c){var f=c[d],p=l[d],h=null===p||void 0===p?void 0:p.spatialReference;null==f||h||(f.spatialReference=r)}n.push(u)}return n}}]),r}(U.Z);(0,f._)([(0,h.Cb)({type:[g],json:{write:!0}})],N.prototype,"features",void 0),(0,f._)([(0,P.r)("features")],N.prototype,"readFeatures",null);var L=N=(0,f._)([(0,m.j)("esri.rest.support.AggregateFeatureSet")],N),D=r(21149),J=r(8841),j=r(65457),Q=r(88301),H=r(61120),G=r(46634),W=r(58880),Y=r(80613),K=r(29439),X=r(643),$=r(97890),ee=r(66759),te=function(){function e(){(0,o.Z)(this,e),this._instanceById=new Map}return(0,l.Z)(e,[{key:"destroy",value:function(){this._instanceById.clear()}},{key:"size",get:function(){return this._instanceById.size}},{key:"entries",value:function(){return this._instanceById.entries()}},{key:"updateStart",value:function(){this._instanceByIdNext=new Map}},{key:"updateEnd",value:function(){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");var e,t=(0,n.Z)(this._instanceById.keys());try{for(t.s();!(e=t.n()).done;){var r=e.value;this._instanceByIdNext.has(r)||this._instanceById.delete(r)}}catch(c){t.e(c)}finally{t.f()}var i,a=(0,n.Z)(this._instanceByIdNext.entries());try{for(a.s();!(i=a.n()).done;){var s=(0,K.Z)(i.value,2),u=s[0],o=s[1],l=this._instanceById.get(u);l?l.setInput(o.getInput()):this._instanceById.set(u,o)}}catch(c){a.e(c)}finally{a.f()}this._instanceByIdNext=null}},{key:"values",value:function(){return this._instanceById.values()}},{key:"ensureInstance",value:function(e,t){var r;if("object"==typeof t&&"optionalAttributes"in t&&"uniforms"in t){r="".concat(e.type).concat(JSON.stringify(t.optionalAttributes));var n=t.uniforms;if("object"==typeof n)for(var i in n)r+="".concat(i,".").concat(null!=n[i])}else r="".concat(e.type,".").concat(JSON.stringify(t));var a=(0,X.hP)(r);if(this._instanceByIdNext){var s=new $.G((0,ee.W)(a),e,t);return this._instanceByIdNext.set(a,s),s}if(!this._instanceById.has(a)){var u=new $.G((0,ee.W)(a),e,t);this._instanceById.set(a,u)}return this._instanceById.get(a)}},{key:"getInstance",value:function(e){return this._instanceById.get(e)}}]),e}(),re=r(84506),ne=r(43244),ie=r(65156),ae=(r(37995),r(73828)),se=(r(32344),r(85269),r(77537)),ue=r(35092),oe=function(){function e(t,r,n){(0,o.Z)(this,e),this.getStage=t,this.version=r,this._tileInfoView=n,this._pendingUpdates=new ne.Z(1e3),this._locked=!1,this._tiles=new Map}return(0,l.Z)(e,[{key:"destroy",value:function(){var e,t=(0,n.Z)(this.tiles());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(r){t.e(r)}finally{t.f()}this._pendingUpdates.clear(),this._tiles.clear()}},{key:"tiles",value:function(){return this._tiles.values()}},{key:"size",value:function(){return this._tiles.size}},{key:"setTiles",value:function(e){this._tiles.clear();var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._tiles.set(i.key.id,i)}}catch(a){r.e(a)}finally{r.f()}}},{key:"lockUploads",value:function(){this._locked=!0}},{key:"unlockUploads",value:function(){this._locked=!1,this.flush()}},{key:"enqueueUpdate",value:function(e){this._pendingUpdates.enqueue(e)}},{key:"update",value:function(e){if(!this._locked)for(;this._pendingUpdates.size;){var t=this._pendingUpdates.peek();if(null==t||t.attributeEpoch>e)break;this._updateTile(t),this._pendingUpdates.dequeue()}}},{key:"removeTile",value:function(e){var t=this._tiles.get(e);(0,y.Z)("esri-2d-update-debug")&&console.debug("Tile[".concat(e,"] RenderState.removeTile")),null!==t&&void 0!==t&&t.destroy(),this._tiles.delete(e)}},{key:"isTileDone",value:function(e){var t=this._tiles.get(e.id);return!!t&&t.isReady}},{key:"flush",value:function(){for(;this._pendingUpdates.size;){var e=this._pendingUpdates.dequeue();null!=e&&this._updateTile(e)}var t,r=(0,n.Z)(this._tiles.values());try{for(r.s();!(t=r.n()).done;){t.value.upload()}}catch(i){r.e(i)}finally{r.f()}}},{key:"_updateTile",value:function(e){if((0,y.Z)("esri-2d-update-debug")){var t,r,i=null!==(t=null===(r=e.debugInfo)||void 0===r?void 0:r.chunkId)&&void 0!==t?t:"<EnsureEnd>";console.debug("Version[".concat(e.version,"] Tile[").concat(e.id,"] Chunk[").concat(i,"] RenderState.updateTile [").concat(e.type,"]"),e)}var a=this._ensureTile(e.id);if("update"!==e.type)if(null!=e.append){var s=(0,re.Z)(e.append),u=s[0],o=s.slice(1);a.onMessage({type:"append",clear:e.clear,append:u,debugInfo:e.debugInfo,end:e.end,attributeEpoch:e.attributeEpoch});var l,c=(0,n.Z)(o);try{for(c.s();!(l=c.n()).done;){var d=l.value,f=this._tiles.get(d.tileId);f&&f.onMessage({type:"update",modify:d,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}catch(x){c.e(x)}finally{c.f()}}else a.onMessage({type:"append",clear:e.clear,debugInfo:e.debugInfo,end:e.end,attributeEpoch:e.attributeEpoch});else{var p=(0,re.Z)(e.modify),h=p[0],v=p.slice(1);a.onMessage({type:"update",modify:h,remove:e.remove,end:e.end,attributeEpoch:e.attributeEpoch});var m,b=(0,n.Z)(v);try{for(b.s();!(m=b.n()).done;){var g=m.value,S=this._tiles.get(g.tileId);S&&S.onMessage({type:"update",modify:g,remove:e.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null})}}catch(x){b.e(x)}finally{b.f()}}}},{key:"_ensureTile",value:function(e){if(!this._tiles.has(e)){var t=this._createTile(e);this._copyPixelBufferedEntitiesInto(t),this._tiles.set(e,t)}return this._tiles.get(e)}},{key:"_createTile",value:function(e){(0,y.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(this.version,"] Tile[").concat(e,"] RenderState.createTile"));var t=new ae.Z(e),r=this._tileInfoView.getTileBounds((0,ie.Ue)(),t),n=this._tileInfoView.getTileResolution(t.level),i=new se.$(t,n,r[0],r[3],!0);if(i.stage=this.getStage(),!i.stage){var a=new k.Z("featurelayerview:webgl","Cannot create tile with empty stage");v.Z.getLogger("esri.views.2d.layers.features.RenderState").error(a)}return i}},{key:"_copyPixelBufferedEntitiesInto",value:function(e){for(var t=7,r=-1;r<=1;r++)for(var n=-1;n<=1;n++)if(0!==r||0!==n){var i=this._tileInfoView.tileInfo.isWrappable,a=(0,ue.M)(e.key,n,r,i).id,s=this._tiles.get(a);if(null!=s){var u=1<<t;e.copyPixelBufferedEntitesFrom(s,u,n,r)}t--}}}]),e}(),le=r(39594),ce=function(){function e(t,r){(0,o.Z)(this,e),this.id=t,this.version=r,this._resolver=(0,I.hh)(),this._done=!1}return(0,l.Z)(e,[{key:"done",get:function(){return this._done}},{key:"promise",get:function(){return this._resolver.promise}},{key:"end",value:function(){this._resolver.resolve(),this._done=!0}},{key:"destroy",value:function(){this._resolver.reject()}}]),e}(),de=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e.view.featuresTilingScheme)).updatingHandles=new G.R,n._hitTestsRequests=[],n._store=new te,n._visibleTiles=new Set,n._subscriptions=new Map,n._updateStatisticsRequests=[],n._lockStatisticUpdates=!1,n._layerView=e,n}return(0,l.Z)(r,[{key:"renderChildren",value:function(e){var t;if(this.attributeView.update(),null!==(t=this._renderState)&&void 0!==t&&t.update(this.attributeView.currentEpoch),this._renderState){var i=Array.from(this._renderState.tiles()).filter((function(e){return e.needsUpload}));i.length&&(i[Math.floor(Math.random()*i.length)].upload(),i.length>=2&&this.requestRender());var a,s=(0,n.Z)(this._renderState.tiles());try{for(s.s();!(a=s.n()).done;){var u,o=a.value;o.tryReady(this.attributeView.currentEpoch)&&(null!==(u=this._subscriptions.get(o.key.id))&&void 0!==u&&u.end(),this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this.requestRender())}}catch(d){s.e(d)}finally{s.f()}}var l,c=(0,n.Z)(this.children);try{for(c.s();!(l=c.n()).done;){l.value.setTransform(e.state)}}catch(d){c.e(d)}finally{c.f()}switch(this.hasAnimation&&e.painter.effects.integrate.draw(e,e.attributeView),(0,Q.Z)((0,H.Z)(r.prototype),"renderChildren",this).call(this,e),e.drawPhase){case Y.jx.MAP:return this._renderMapPhase(e);case Y.jx.HIGHLIGHT:return this._renderHighlightPhase(e);case Y.jx.LABEL:return this._renderLabelPhase(e)}}},{key:"subscriptions",value:function(){return this._subscriptions.values()}},{key:"_instanceStore",get:function(){return this._store}},{key:"instanceStore",get:function(){return this._store}},{key:"layerView",get:function(){return this._layerView}},{key:"hasLabels",get:function(){return this._layerView.labelingCollisionInfos.length>0}},{key:"hasHighlight",get:function(){return this._layerView.hasHighlight()}},{key:"_layer",get:function(){return this._layerView.layer}},{key:"_getExclusivePostprocessingInstance",value:function(e){var t=e.drawPhase;if(null==this._instanceStore)return null;var r,i=0,a=null,s=(0,n.Z)(this._instanceStore.values());try{for(s.s();!(r=s.n()).done;){var u=r.value;u.techniqueRef.drawPhase&t&&(i++,u.techniqueRef.postProcessingEnabled&&(a=u))}}catch(o){s.e(o)}finally{s.f()}return i>1?null:a}},{key:"_getOverrideStencilRef",value:function(e){var t=e.drawPhase;if(null==this._instanceStore)return null;var r,i=null,a=(0,n.Z)(this._instanceStore.values());try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.techniqueRef.drawPhase&t){var u=s.techniqueRef.overrideStencilRef;if(null==i)i=u;else if(i!==u){i=null;break}}}}catch(o){a.e(o)}finally{a.f()}return i}},{key:"children",get:function(){var e=this;return this._renderState?Array.from(this._renderState.tiles()).filter((function(t){return e._visibleTiles.has(t.key.id)})):[]}},{key:"updateAttributeView",value:function(e){this.requestRender(),this.attributeView.requestUpdate(e),this.hasLabels&&this._layerView.view.labelManager.requestUpdate()}},{key:"updateSubscriptions",value:function(e){var t,r=(0,n.Z)(e.subscribe);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.tileId,s=i.version;if(this._subscriptions.has(a))this._subscriptions.get(a).version=s;else{var u=new ce(a,s);this._subscriptions.set(a,u),this.updatingHandles.addPromise(u.promise)}}}catch(f){r.e(f)}finally{r.f()}var o,l=(0,n.Z)(e.unsubscribe);try{for(l.s();!(o=l.n()).done;){var c=o.value,d=this._subscriptions.get(c);null!==d&&void 0!==d&&d.destroy(),this._subscriptions.delete(c),this.removeTile(c)}}catch(f){l.e(f)}finally{l.f()}}},{key:"isDone",value:function(e){return!!this._renderState&&this._renderState.isTileDone(e)}},{key:"updateRenderState",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,y.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(t,"] FeatureContainer.updateRenderState")),this._renderStateNext=new oe((function(){return r._stage}),t,this._tileInfoView);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDisplayStatistics",value:function(e,t){var r=this._statisticsByLevel.get(e);return r?r.get(t):null}},{key:"updateStatistics",value:function(e,t){if(this._lockStatisticUpdates)this._updateStatisticsRequests.push({level:e,statistics:t});else{var r=this._statisticsByLevel.get(e);r||(r=new Map,this._statisticsByLevel.set(e,r));var i,a=(0,n.Z)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;r.set(s.fieldName,{minValue:s.minValue,maxValue:s.maxValue})}}catch(u){a.e(u)}finally{a.f()}}}},{key:"editStart",value:function(){var e;null!==(e=this._renderState)&&void 0!==e&&e.lockUploads(),this.attributeView.lockTextureUploads(),this._lockStatisticUpdates=!0}},{key:"editEnd",value:function(){var e;null!==(e=this._renderState)&&void 0!==e&&e.unlockUploads(),this.attributeView.unlockTextureUploads(),this._lockStatisticUpdates=!1;var t,r=(0,n.Z)(this._updateStatisticsRequests);try{for(r.s();!(t=r.n()).done;){var i=t.value;this.updateStatistics(i.level,i.statistics)}}catch(a){r.e(a)}finally{r.f()}this._updateStatisticsRequests=[],this.requestRender()}},{key:"swapRenderState",value:function(){var e;this._renderStateNext&&((0,y.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(this._renderStateNext.version,"] FeatureContainer.update.swapRenderState")),null!==(e=this._renderState)&&void 0!==e&&e.destroy(),this._renderState=this._renderStateNext,this._renderStateNext=null),this._renderState&&this._renderState.flush(),this.requestRender()}},{key:"setVisibleTiles",value:function(e){this._visibleTiles=e}},{key:"onMessage",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,I.k_)(r),i=t.inner,this._subscriptions.has(i.id)){e.next=4;break}return e.abrupt("return");case 4:if((a=this._subscriptions.get(i.id)).version===i.subscriptionVesrion){e.next=8;break}return(0,y.Z)("esri-2d-update-debug")&&(u="".concat(i.subscriptionVesrion," != ").concat(a.version),console.debug("Version[".concat(u,"] Tile[").concat(i.id,"] FeatureContainer - Dropping message, outdated version]"),i)),e.abrupt("return");case 8:if(o=null!==(n=this._renderStateNext)&&void 0!==n?n:this._renderState){e.next=11;break}throw new Error("InternalError: No renderState defined");case 11:o.version!==i.version&&console.error("InternalError: Version mismatch. [renderState: ".concat(o.version,", message: ").concat(i.version,"]")),o.enqueueUpdate(i),this.requestRender(),this._layerView.view.labelManager.requestUpdate(),this._layerView.requestUpdate();case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeTile",value:function(e){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(e),this._renderStateNext&&this._renderStateNext.removeTile(e))}},{key:"hitTest",value:function(e){var t=this._hitTestsRequests.find((function(t){var r=t.x,n=t.y;return r===e.x&&n===e.y})),r=(0,I.hh)();return t?t.resolvers.push(r):(t={x:e.x,y:e.y,resolvers:[r]},this._hitTestsRequests.push(t)),this.requestRender(),r.promise}},{key:"getSortKeys",value:function(e){var t,r=new Set(e),i=new Map,a=(0,n.Z)(this.children);try{for(a.s();!(t=a.n()).done;){if(t.value.getSortKeys(r).forEach((function(e,t){return i.set(t,e)})),i.size===r.size)break}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"hasAnimation",get:function(){return this.hasLabels}},{key:"updateTransitionProperties",value:function(e,t){(0,Q.Z)((0,H.Z)(r.prototype),"updateTransitionProperties",this).call(this,e,t),this._layerView.featureEffectView.transitionStep(e,t),this._layerView.featureEffectView.transitioning&&this.requestRender()}},{key:"doRender",value:function(e){var t=this._layer.effectiveScaleRange,n=t.minScale,i=t.maxScale,a=e.state.scale;a<=(n||1/0)&&a>=i&&(0,Q.Z)((0,H.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"afterRender",value:function(e){(0,Q.Z)((0,H.Z)(r.prototype),"afterRender",this).call(this,e),this._hitTestsRequests.length&&this.requestRender()}},{key:"setStencilReference",value:function(e){var t=this._getOverrideStencilRef(e);if(null==t)(0,Q.Z)((0,H.Z)(r.prototype),"setStencilReference",this).call(this,e);else{var i,a=(0,n.Z)(this.children);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.stencilRef=t(s)}}catch(u){a.e(u)}finally{a.f()}}}},{key:"_renderMapPhase",value:function(e){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(e),this._renderInsideEffect(e)):this._renderFeatures(e,Y.Xq.All),this._hitTestsRequests.length>0&&this._renderHittest(e)}},{key:"_renderHighlightPhase",value:function(e){var t=this;this.hasHighlight&&(0,le.P9)(e,!1,(function(e){t._renderFeatures(e,Y.Xq.Highlight)}))}},{key:"_renderLabelPhase",value:function(e){this._renderFeatures(e,Y.Xq.All)}},{key:"_renderInsideEffect",value:function(e){var t=e.painter.effects.insideEffect;t.bind(e),this._renderFeatures(e,Y.Xq.InsideEffect),t.draw(e,this._layerView.featureEffectView.includedEffects),t.unbind()}},{key:"_renderOutsideEffect",value:function(e){var t=e.painter.effects.outsideEffect;t.bind(e),this._renderFeatures(e,Y.Xq.OutsideEffect),t.draw(e,this._layerView.featureEffectView.excludedEffects),t.unbind()}},{key:"_renderHittest",value:function(e){var t=e.context,r=e.painter.effects.hittest,i=t.getBoundFramebufferObject(),a=t.getViewport(),s=e.passOptions,u=e.drawPhase;r.bind(e),e.passOptions=r.createOptions(e,this._hitTestsRequests),e.drawPhase=Y.jx.HITTEST;var o,l=e.passOptions,c=l.distance,d=l.smallSymbolDistance,f=Math.max(c,d),p=(0,n.Z)(this.children);try{for(p.s();!(o=p.n()).done;){var h=o.value;h.visible&&h.containsScreenPoint(e.state,e.passOptions.position,2*f)&&this._renderTile(h,e,Y.Xq.All)}}catch(y){p.e(y)}finally{p.f()}r.draw(e),r.unbind(),t.bindFramebuffer(i),t.restoreViewport(a),e.passOptions=s,e.drawPhase=u}},{key:"_renderFeatures",value:function(e,t){var r,i=(0,n.Z)(this.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.visible&&this._renderTile(a,e,t)}}catch(u){i.e(u)}finally{i.f()}var s=this._getExclusivePostprocessingInstance(e);null!=s&&s.techniqueRef.postProcess(e,s)}},{key:"_renderTile",value:function(e,t,r){var n=(0,y.Z)("featurelayer-force-marker-text-draw-order")?Y.gl.STRICT_MARKERS_AND_TEXT:Y.gl.BATCHING,i=e.getDisplayList(this._instanceStore,n);t.selection=r,null===i||void 0===i||i.render(t)}}]),r}(W.b),fe=r(70431);function pe(e){return he.apply(this,arguments)}function he(){return he=(0,u.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,fe.bA)("FeaturePipelineWorker",{client:t,strategy:"dedicated"});case 2:return r=e.sent,e.abrupt("return",new ye(r));case 4:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}var ye=function(){function e(t){(0,o.Z)(this,e),this._connection=t,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}return(0,l.Z)(e,[{key:"destroy",value:function(){this._connection.destroy()}},{key:"closed",get:function(){return this._connection.closed}}]),e}(),ve=r(91505),me=r(18442),be=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).events=new ve.Z,e._updatingStrategy=!0,e._tileToEvent=new me.Z,e._fetchStatus={outstanding:0,done:0},e}return(0,l.Z)(r,[{key:"hasAllFeatures",get:function(){var e,t;return this._hasAllData()&&null!==(e=null===(t=this._strategyInfo)||void 0===t?void 0:t.willQueryAllFeatures)&&void 0!==e&&e}},{key:"hasAllFeaturesInView",get:function(){return this._hasAllData()}},{key:"hasFullGeometries",get:function(){var e,t;return this._hasAllData()&&null!==(e=null===(t=this._strategyInfo)||void 0===t?void 0:t.willQueryFullResolutionGeometry)&&void 0!==e&&e}},{key:"onEvent",value:function(e){switch(e.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(e);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=e.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",e);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),e.done&&(this._fetchStatus={done:0,outstanding:0})}}},{key:"_hasAllData",value:function(){return!this._updatingStrategy&&this._hasAllTileData()}},{key:"_hasAllTileData",value:function(){var e,t=(0,n.Z)(this._tileToEvent.values());try{for(t.s();!(e=t.n()).done;){var r=e.value.peekLast();if("loaded"!==(null===r||void 0===r?void 0:r.type))return!1}}catch(i){t.e(i)}finally{t.f()}return!0}},{key:"_handleTileEvent",value:function(e){switch(e.type){case"subscribe":var t=new ne.Z(10);t.enqueue(e),this._tileToEvent.set(e.tile,t);break;case"unsubscribe":this._tileToEvent.delete(e.tile);break;case"loaded":var r=this._tileToEvent.get(e.tile);if(!r)return;r.enqueue(e),this._tileToEvent.set(e.tile,r);break;case"error":var n=this._tileToEvent.get(e.tile);if(!n)return;n.enqueue(e),this._tileToEvent.set(e.tile,n),this.events.emit("error",e)}}}]),r}(E.default);(0,f._)([(0,h.Cb)({readOnly:!0})],be.prototype,"hasAllFeatures",null),(0,f._)([(0,h.Cb)({readOnly:!0})],be.prototype,"hasAllFeaturesInView",null),(0,f._)([(0,h.Cb)({readOnly:!0})],be.prototype,"hasFullGeometries",null),(0,f._)([(0,h.Cb)()],be.prototype,"_updatingStrategy",void 0),(0,f._)([(0,h.Cb)()],be.prototype,"_strategyInfo",void 0),(0,f._)([(0,h.Cb)()],be.prototype,"_tileToEvent",void 0),be=(0,f._)([(0,m.j)("esri.views.2d.layers.features.FeatureSourceEventLog")],be);var ge=r(84652),Se=r(25899);function xe(e){switch(e.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"polygon":case"multipatch":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";default:return null}}var _e=r(17842),ke=r(74184),we=r(16889),Ze=r(49229),Ve=r(80724),Ie=Math.PI;function Fe(e,t){switch(t.transformationType){case Ve.hL.Additive:return function(e,t){return e+(Ee(t.minSize,e)||t.minDataValue)}(e,t);case Ve.hL.Constant:return function(e,t){var r=e.stops,n=(null===r||void 0===r?void 0:r.length)&&r[0].size;return null==n&&(n=e.minSize),Ee(n,t)}(t,e);case Ve.hL.ClampedLinear:return function(e,t){var r=t.minDataValue,n=t.maxDataValue,i=(e-r)/(n-r),a=Ee(t.minSize,e),s=Ee(t.maxSize,e);return e<=r?a:e>=n?s:a+i*(s-a)}(e,t);case Ve.hL.Proportional:return function(e,t){var r=e/t.minDataValue,n=Ee(t.minSize,e),i=Ee(t.maxSize,e),a=null;return a=r*n,(0,we.uZ)(a,n,i)}(e,t);case Ve.hL.Stops:return function(e,t){var r=function(e,t){if(!t)return;var r=0,n=t.length-1;return t.some((function(t,i){return e<t?(n=i,!0):(r=i,!1)})),[r,n,(e-t[r])/(t[n]-t[r])]}(e,t.cache.ipData),n=(0,K.Z)(r,3),i=n[0],a=n[1],s=n[2];if(i===a)return Ee(t.stops[i].size,e);var u=Ee(t.stops[i].size,e);return u+(Ee(t.stops[a].size,e)-u)*s}(e,t);case Ve.hL.RealWorldSize:return function(e,t){var r=Ze.a[t.valueUnit],n=Ee(t.minSize,e),i=Ee(t.maxSize,e),a=t.valueRepresentation,s=null;return s="area"===a?2*Math.sqrt(e/Ie)/r:"radius"===a||"distance"===a?2*e/r:e/r,(0,we.uZ)(s,n,i)}(e,t);case Ve.hL.Identity:return e;case Ve.hL.Unknown:return null}}function Ee(e,t){return"number"==typeof e?e:Fe(t,e)}function Re(e){var t,r;return null!==(t=e.labelsVisible&&(null===(r=e.labelingInfo)||void 0===r?void 0:r.every((function(e){return"none"!==e.deconflictionStrategy}))))&&void 0!==t&&t}function Ce(e,t){var r,n=(0,ke.g)(e,t);if(null!==n&&void 0!==n&&n.labelsVisible&&null!==(r=n.labelingInfo)&&void 0!==r&&r.length)return n.labelingInfo.every((function(e){return"none"!==e.deconflictionStrategy}))}function ze(e){return function(t){return(0,_e.F2)(Fe(t,e))}}function Te(e){var t=null!=e&&"visualVariables"in e&&e.visualVariables;if(!t)return null;var r,i=(0,n.Z)(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;if("size"===a.type)return ze(a)}}catch(s){i.e(s)}finally{i.f()}return null}var Oe=r(76672);function Me(e,t,r,n){var i,a,s,u,o=null!=e.subtypeCode?"".concat(e.subtypeField," = ").concat(e.subtypeCode):null,l=(0,Oe._)(e.definitionExpression,o),c=null!==(i=e.customParameters)&&void 0!==i?i:{};return n&&(c.token=n),{type:"feature",mutable:{sourceRefreshVersion:r,availableFields:t.availableFields,dataFilter:{queryScaleRanges:null!==(a=e.queryScaleRanges)&&void 0!==a?a:[],definitionExpression:l,gdbVersion:e.gdbVersion,historicMoment:null===(s=e.historicMoment)||void 0===s?void 0:s.getTime(),timeExtent:null===(u=e.timeExtent)||void 0===u?void 0:u.toJSON(),customParameters:c}}}}var Ae=r(38186),qe=r(85116),Pe=(r(51508),r(27811)),Ue=r(78915),Be=r(48202),Ne=r(6388),Le=r(38999);r(73271);function De(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==t)return e[r]=0,e[r+1]=0,e[r+2]=0,void(e[r+3]=0);var n=t.r,i=t.g,a=t.b,s=t.a;e[r]=n*s/255,e[r+1]=i*s/255,e[r+2]=a*s/255,e[r+3]=s}var Je=r(94109),je=r(93560),Qe=r(71861),He=r(7326),Ge=r(88562),We=r(33425),Ye=r(61459),Ke=r(16072),Xe=r(14404);function $e(e,t){return et.apply(this,arguments)}function et(){return et=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:e.t0=t.type,e.next="simple-fill"===e.t0?5:"picture-fill"===e.t0?6:"simple-marker"===e.t0?7:"picture-marker"===e.t0?8:"simple-line"===e.t0?9:"text"===e.t0?10:"label"===e.t0?11:"cim"===e.t0?12:"web-style"===e.t0?13:"line-3d"===e.t0?17:"point-3d"===e.t0?18:"polygon-3d"===e.t0?19:"mesh-3d"===e.t0||"label-3d"===e.t0?20:"CIMSymbolReference"===e.t0?21:22;break;case 5:return e.abrupt("return",pt(t,r));case 6:return e.abrupt("return",ht(t,r));case 7:return e.abrupt("return",ut(t,r));case 8:return e.abrupt("return",lt(t,r));case 9:return e.abrupt("return",yt(t,r,!1));case 10:return e.abrupt("return",ct(t,r));case 11:return e.abrupt("return",dt(t,r));case 12:return e.abrupt("return",(0,Ge.$L)(t.data,r));case 13:return e.next=15,t.fetchCIMSymbol();case 15:return n=e.sent,e.abrupt("return",(0,Ge.$L)(n.data,r));case 17:return e.abrupt("return",(v.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",'Symbol of type "'.concat(t.type,'" unsupported in MapView. Defaulting to simple-line')),yt(new Xe.default,r,!1)));case 18:return e.abrupt("return",(v.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",'Symbol of type "'.concat(t.type,'" unsupported in MapView. Defaulting to simple-marker')),ut(new Ke.default,r)));case 19:return e.abrupt("return",(v.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",'Symbol of type "'.concat(t.type,'" unsupported in MapView. Defaulting to simple-fill')),pt(new Ye.default,r)));case 20:return e.abrupt("return",(v.Z.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",'Symbol of type "'.concat(t.type,'" unsupported in MapView. Ignoring')),[]));case 21:throw new Error("InternalError: CIMSymbolReference should already be resolved");case 22:case"end":return e.stop()}}),e)}))),et.apply(this,arguments)}function tt(e,t){return rt.apply(this,arguments)}function rt(){return rt=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,u,o,l,c,d,f,p,h,y,v,m;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=r.schemaOptions,i=n.store,u=new Array(Je.Pp),o=new Array(Je.Pp/4),l=0;l<Je.Pp;l++)c=l<t.attributes.length?t.attributes[l].color:null,u[l]=[0,0,0,0],De(u[l],c);for(d=0;d<Je.Pp/4;d++)o[d]=[0,0,0,0],o[d][0]=4*d<t.attributes.length?1:0,o[d][1]=4*d+1<t.attributes.length?1:0,o[d][2]=4*d+2<t.attributes.length?1:0,o[d][3]=4*d+3<t.attributes.length?1:0;if(f={uniforms:{isActive:o,colors:u,dotValue:t.dotValue,dotScale:t.referenceScale,blending:t.dotBlendingEnabled,dotSize:t.dotSize,seed:t.seed},optionalAttributes:{}},p=i.ensureInstance(je.k2.dotDensity,f).createMeshInfo({effects:null}),h=[],!t.backgroundColor){e.next=10;break}return y=new Ye.default({color:t.backgroundColor,outline:null}),e.next=8,$e(y,r);case 8:v=e.sent,h.push.apply(h,(0,a.Z)(v));case 10:return h.push(p),t.outline&&(m=yt(t.outline,r,!0),h.push.apply(h,(0,a.Z)(m))),e.abrupt("return",h);case 12:case"end":return e.stop()}}),e)}))),rt.apply(this,arguments)}function nt(e,t){return it.apply(this,arguments)}function it(){return it=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u,o,l,c,d,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.store,i=t.radius,a=t.minDensity,u=t.maxDensity,o=t.referenceScale,l=t.field,c=t.valueExpression,d=t.colorStops,f=(0,Pe.uI)(d),e.abrupt("return",[n.ensureInstance(je.k2.heatmap,{uniforms:{radius:(0,_e.F2)(i),minDensity:a,maxDensity:u,referenceScale:o,isFieldActive:!(!l&&!c),gradient:f,gradientHash:f.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]);case 2:case"end":return e.stop()}}),e)}))),it.apply(this,arguments)}function at(e,t){var r,n,i,s,u=t.store,o=(null===(r=e.outline)||void 0===r?void 0:r.width)||0,l=(0,He.Sc)(e),c=u.ensureInstance(je.k2.pieChart,{uniforms:{shader:{outlineWidth:Math.round((0,_e.F2)(o)),defaultColor:(0,Qe.n)(e.defaultColor),outlineColor:(0,Qe.n)(null===(n=e.outline)||void 0===n?void 0:n.color),othersColor:(0,Qe.n)(null===(i=e.othersCategory)||void 0===i?void 0:i.color),donutRatio:e.holePercentage,sectorThreshold:(null===(s=e.othersCategory)||void 0===s?void 0:s.threshold)||0,colors:e.attributes.map((function(e){return(0,Qe.n)(e.color)})),visualVariableOpacity:l.visualVariableOpacity,visualVariableSizeMinMaxValue:l.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:l.visualVariableSizeScaleStops,visualVariableSizeStops:l.visualVariableSizeStops,visualVariableSizeUnitValue:l.visualVariableSizeUnitValue,hittestUniforms:null},numberOfFields:e.attributes.length},optionalAttributes:{}}).createMeshInfo({size:e.size,outlineWidth:o,effects:null,scaleInfo:null,minPixelBuffer:(0,He.XS)(l)});return[].concat((0,a.Z)(e.backgroundFillSymbol?pt(e.backgroundFillSymbol,{schemaOptions:t,path:"",uniforms:He.Jh}):[]),[c])}function st(e){if("path"===e.style){if(null==e.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:e.path,asFill:!0}}}var t=Ue.B$.fromSimpleMarker(e);if("outline"in e&&e.outline&&"none"!==e.outline.style&&"solid"!==e.outline.style){if(!t||!t.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:t.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:(0,Ne.Fp)(t),overrides:[]}}function ut(e,t){return ot.apply(this,arguments)}function ot(){return ot=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u,o,l,c,d,f,p,h,y,v,m,b,g,S,x,_,k,w,Z,V;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=r.uniforms,f=r.schemaOptions,p=f.store,!("path"===t.style||t.outline&&"solid"!==t.outline.style&&"none"!==t.outline.style)){e.next=7;break}if((h=Ue.B$.fromSimpleMarker(t))&&h.symbolLayers){e.next=5;break}throw new Error("Error handling marker! ");case 5:return d.visualVariableRotation&&(h.angleAlignment="Map"),"path"!==t.style&&(y=h.symbolLayers[0],(0,We.h)(r.uniforms)&&(v=(0,He.XS)(r.uniforms,0,1))>y.size&&(b=v/y.size,y.size=v,((g=null===(m=y.markerGraphics)||void 0===m?void 0:m[0].symbol).symbolLayers&&g.symbolLayers[0]).width*=b)),e.abrupt("return",(0,Ge.$L)({type:"CIMSymbolReference",symbol:h},r));case 7:return S=p.ensureInstance(je.k2.marker,{uniforms:{visualVariableColor:d.visualVariableColor,visualVariableOpacity:d.visualVariableOpacity,visualVariableSizeMinMaxValue:d.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:d.visualVariableSizeScaleStops,visualVariableSizeStops:d.visualVariableSizeStops,visualVariableSizeUnitValue:d.visualVariableSizeUnitValue,visualVariableRotation:d.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),x=st(t),_=null!==(n=null===(i=t.color)||void 0===i?void 0:i.toArray())&&void 0!==n?n:[0,0,0,0],"CIMVectorMarker"===x.resource.type&&(_=[255,255,255,255]),k="triangle"===t.style?124/116:1,w=t.size,Z=w*k,V=null!=d.visualVariableColor&&("cross"===t.style||"x"===t.style),e.abrupt("return",[S.createMeshInfo({type:"simple",color:_,height:w,width:Z,offsetX:t.xoffset,offsetY:t.yoffset,angle:t.angle,alignment:(0,We.A)(d)?Be.v2.MAP:Be.v2.SCREEN,outlineColor:null!==(a=null===(u=t.outline)||void 0===u||null===(o=u.color)||void 0===o?void 0:o.toArray())&&void 0!==a?a:[0,0,0,0],outlineSize:null!==(l=null===(c=t.outline)||void 0===c?void 0:c.width)&&void 0!==l?l:1,referenceSize:w,sprite:x,overrideOutlineColor:V,hasSizeVV:(0,We.h)(d),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,He.XS)(d)})]);case 12:case"end":return e.stop()}}),e)}))),ot.apply(this,arguments)}function lt(e,t){var r=t.uniforms,n=t.schemaOptions.store.ensureInstance(je.k2.marker,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),i=Ue.B$.createPictureMarkerRasterizationParam(e);return i?[n.createMeshInfo({type:"picture",color:[255,255,255,255],height:e.height,width:e.width,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,alignment:(0,We.A)(r)?Be.v2.MAP:Be.v2.SCREEN,outlineColor:null,outlineSize:0,referenceSize:e.height,sprite:i,overrideOutlineColor:!1,hasSizeVV:(0,We.h)(r),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:(0,He.XS)(r)})]:[]}function ct(e,t){var r,n,i,a,s,u,o,l,c=t.uniforms;return[t.schemaOptions.store.ensureInstance(je.k2.text,{uniforms:{visualVariableColor:c.visualVariableColor,visualVariableOpacity:c.visualVariableOpacity,visualVariableRotation:c.visualVariableRotation,visualVariableSizeMinMaxValue:c.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:c.visualVariableSizeScaleStops,visualVariableSizeStops:c.visualVariableSizeStops,visualVariableSizeUnitValue:c.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1}}).createMeshInfo({boxBackgroundColor:null===(r=e.backgroundColor)||void 0===r?void 0:r.toArray(),boxBorderLineColor:null===(n=e.borderLineColor)||void 0===n?void 0:n.toArray(),boxBorderLineSize:null!==(i=e.borderLineSize)&&void 0!==i?i:0,color:null!==(a=null===(s=e.color)||void 0===s?void 0:s.toArray())&&void 0!==a?a:[0,0,0,0],offsetX:e.xoffset,offsetY:e.yoffset,postAngle:e.angle,fontSize:e.font.size,decoration:e.font.decoration,haloColor:null!==(u=null===(o=e.haloColor)||void 0===o?void 0:o.toArray())&&void 0!==u?u:[0,0,0,0],haloFontSize:null!==(l=e.haloSize)&&void 0!==l?l:0,lineWidth:e.lineWidth,lineHeightRatio:e.lineHeight,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:e.font.toJSON(),textString:e.text,symbol:Ue.B$.createCIMTextSymbolfromTextSymbol(e)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:(0,He.XS)(c),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})]}function dt(e,t){var r,n,i,a,s,u,o,l,c,d,f,p,h,y=t.schemaOptions,v=t.uniforms,m=y.store,b=e.symbol,g=e.allowOverrun,S=e.repeatLabel,x=e.repeatLabelDistance,_={maxScale:null!==(r=e.maxScale)&&void 0!==r?r:0,minScale:null!==(n=e.minScale)&&void 0!==n?n:0},k=m.ensureInstance(je.k2.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:v.visualVariableRotation,visualVariableSizeMinMaxValue:v.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:v.visualVariableSizeScaleStops,visualVariableSizeStops:v.visualVariableSizeStops,visualVariableSizeUnitValue:v.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0}}),w=e.labelPlacement,Z=(0,Le.qv)(w),V=(0,K.Z)(Z,2),I=V[0],F=V[1];return[k.createMeshInfo({boxBackgroundColor:null===(i=b.backgroundColor)||void 0===i?void 0:i.toArray(),boxBorderLineColor:null===(a=b.borderLineColor)||void 0===a?void 0:a.toArray(),boxBorderLineSize:null!==(s=b.borderLineSize)&&void 0!==s?s:0,color:null!==(u=null===(o=b.color)||void 0===o?void 0:o.toArray())&&void 0!==u?u:[0,0,0,0],offsetX:b.xoffset,offsetY:b.yoffset,postAngle:b.angle,fontSize:b.font.size,decoration:b.font.decoration,haloColor:null!==(l=null===(c=b.haloColor)||void 0===c?void 0:c.toArray())&&void 0!==l?l:[0,0,0,0],haloFontSize:null!==(d=b.haloSize)&&void 0!==d?d:0,lineWidth:b.lineWidth,lineHeightRatio:b.lineHeight,horizontalAlignment:I,verticalAlignment:F,repeatLabel:S,repeatLabelDistance:(0,_e.F2)(x),allowOverrun:g,labelPosition:e.labelPosition,scaleInfo:_,minPixelBuffer:(0,He.XS)(v),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:b.font.toJSON(),textString:b.text,symbol:Ue.B$.createCIMTextSymbolfromTextSymbol(b),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==(null===(f=e.labelExpressionInfo)||void 0===f?void 0:f.expression),overrides:[{type:"CIMPrimitiveOverride",valueExpressionInfo:{type:"CIMExpressionInfo",expression:null!==(p=null===(h=e.labelExpressionInfo)||void 0===h?void 0:h.expression)&&void 0!==p?p:e.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1,isLineLabel:!1})]}function ft(e,t){var r,n,i,a=e.width;return{outlineColor:(null===(r=e.color)||void 0===r?void 0:r.toArray())||[0,0,0,1],width:a,referenceWidth:a,capType:null!==(n=e.cap)&&void 0!==n?n:"round",joinType:null!==(i=e.join)&&void 0!==i?i:"round",miterLimit:e.miterLimit,hasSizeVV:t}}function pt(e,t){var r=e.style;return r&&"none"!==r&&"solid"!==r?function(e,t){var r,n,s,u,o,l=t.uniforms,c=t.schemaOptions.store,d=null!==(r=null===(n=e.color)||void 0===n?void 0:n.toArray())&&void 0!==r?r:[0,0,0,0],f={type:"sprite-rasterization-param",resource:{type:"fill-style",style:e.style},overrides:[]};if("solid"===(null===(s=e.outline)||void 0===s?void 0:s.style))return[c.ensureInstance(je.k2.patternOutlineFill,{uniforms:{visualVariableColor:l.visualVariableColor,visualVariableOpacity:l.visualVariableOpacity,visualVariableSizeScaleStops:l.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo((0,i.Z)((0,i.Z)({color:d},ft(e.outline,!!l.visualVariableSizeOutlineScaleStops)),{},{sprite:f,scaleInfo:null,effects:null}))];var p=[],h=c.ensureInstance(je.k2.patternFill,{uniforms:{visualVariableColor:l.visualVariableColor,visualVariableOpacity:l.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:null!==(u=null===(o=e.color)||void 0===o?void 0:o.toArray())&&void 0!==u?u:[0,0,0,0],sprite:f,scaleInfo:null,effects:null});return p.push(h),e.outline&&p.push.apply(p,(0,a.Z)(yt(e.outline,t,!0))),p}(e,t):function(e,t){var r,n,s,u=t.uniforms,o=t.schemaOptions.store,l=null!==(r=null===(n=e.color)||void 0===n?void 0:n.toArray())&&void 0!==r?r:[0,0,0,0];if("none"!==e.style&&"solid"===(null===(s=e.outline)||void 0===s?void 0:s.style))return[o.ensureInstance(je.k2.outlineFill,{uniforms:{visualVariableColor:u.visualVariableColor,visualVariableOpacity:u.visualVariableOpacity,visualVariableSizeScaleStops:u.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo((0,i.Z)((0,i.Z)({color:l},ft(e.outline,!!u.visualVariableSizeOutlineScaleStops)),{},{scaleInfo:null,effects:null}))];var c=[];if("none"!==e.style){var d=o.ensureInstance(je.k2.fill,{uniforms:{visualVariableColor:u.visualVariableColor,visualVariableOpacity:u.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:l,scaleInfo:null,effects:null});c.push(d)}return e.outline&&c.push.apply(c,(0,a.Z)(yt(e.outline,t,!0))),c}(e,t)}function ht(e,t){var r=e.outline,n=t.uniforms,s=t.schemaOptions.store,u=[],o=Ue.B$.createPictureFillRasterizationParam(e);if(!o)return[];var l=e.width,c=e.height,d={color:[255,255,255,255],sprite:o,height:c,aspectRatio:l/c,offsetX:e.xoffset,offsetY:e.yoffset,scaleX:e.xscale,scaleY:e.yscale,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===(null===r||void 0===r?void 0:r.style))return[s.ensureInstance(je.k2.complexOutlineFill,{uniforms:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeScaleStops:n.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo((0,i.Z)((0,i.Z)({},d),ft(r,!!n.visualVariableSizeOutlineScaleStops)))];var f=s.ensureInstance(je.k2.complexFill,{uniforms:{visualVariableColor:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!1}});return u.push(f.createMeshInfo(d)),r&&u.push.apply(u,(0,a.Z)(yt(r,t,!0))),u}function yt(e,t,r){var n,s=e.color,u=e.style,o=e.width,l=e.cap,c=e.join,d=t.schemaOptions.store,f=[],p=r?(0,i.Z)((0,i.Z)({},He.Jh),{},{visualVariableSizeScaleStops:t.uniforms.visualVariableSizeOutlineScaleStops}):t.uniforms,h={uniforms:{visualVariableColor:p.visualVariableColor,visualVariableOpacity:p.visualVariableOpacity,visualVariableSizeMinMaxValue:p.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:p.visualVariableSizeScaleStops,visualVariableSizeStops:p.visualVariableSizeStops,visualVariableSizeUnitValue:p.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}},y={color:null!==(n=null===s||void 0===s?void 0:s.toArray())&&void 0!==n?n:[0,0,0,0],width:o,referenceWidth:o,capType:l,joinType:c,miterLimit:e.miterLimit,hasSizeVV:(0,We.h)(p),effects:null,scaleInfo:null};if(null==u||"solid"===u){var v=d.ensureInstance(je.k2.line,h).createMeshInfo(y);f.push(v)}else if("none"!==u){var m=d.ensureInstance(je.k2.texturedLine,h).createMeshInfo((0,i.Z)((0,i.Z)({},y),{},{shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:(0,Ue.U1)(u,l),capStyle:(0,Ue.qp)(l)},overrides:[]}}));f.push(m)}return null!=e.marker&&f.push.apply(f,(0,a.Z)(function(e,t,r){var n,i,a,s,u,o=r.uniforms,l=r.schemaOptions.store.ensureInstance(je.k2.marker,{uniforms:{visualVariableColor:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue,visualVariableRotation:o.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),c=st(e),d=6*t.width,f=d,p=null!==(n=null!==(i=null===(a=e.color)||void 0===a?void 0:a.toArray())&&void 0!==i?i:null===(s=t.color)||void 0===s?void 0:s.toArray())&&void 0!==n?n:[0,0,0,0],h="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":u=Be.Tx.Both;break;case"begin":u=Be.Tx.JustBegin;break;case"end":u=Be.Tx.JustEnd;break;default:u=Be.Tx.None}var y={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:u,offsetAlongLine:0},overrides:[]};return[l.createMeshInfo({type:"simple",color:p,height:f,width:d,offsetX:0,offsetY:0,angle:0,alignment:(0,We.A)(o)?Be.v2.MAP:Be.v2.SCREEN,outlineColor:p,outlineSize:h?t.width:0,referenceSize:f/6,sprite:c,overrideOutlineColor:h&&null!=o.visualVariableColor,hasSizeVV:(0,We.h)(o),placement:y,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:(0,He.XS)(o)})]}(e.marker,e,t))),f}function vt(e,t,r){return mt.apply(this,arguments)}function mt(){return mt=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var i,a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.labelsVisible&&r.labelingInfo||[],a=xe(r),u=(0,qe.a)(i,a),e.next=3,Promise.all(u.map((function(e,r){return bt(t,e,r,n)})));case 3:return e.t0=e.sent,e.abrupt("return",{type:"label",classes:e.t0});case 5:case"end":return e.stop()}}),e)}))),mt.apply(this,arguments)}function bt(e,t,r,n){return gt.apply(this,arguments)}function gt(){return gt=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,i){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e(r,{path:"".concat(n),schemaOptions:t,uniforms:i});case 2:return o=e.sent,e.abrupt("return",{maxScale:r.maxScale,minScale:r.minScale,expression:null!==(a=null===(u=r.labelExpressionInfo)||void 0===u?void 0:u.expression)&&void 0!==a?a:r.labelExpression,where:r.where,meshes:o});case 4:case"end":return e.stop()}}),e)}))),gt.apply(this,arguments)}function St(e,t){return xt.apply(this,arguments)}function xt(){return xt=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",{type:"simple",meshes:[]});case 2:e.t0=r.type,e.next="simple"===e.t0?5:"dot-density"===e.t0?6:"class-breaks"===e.t0?7:"unique-value"===e.t0?8:"dictionary"===e.t0?9:"heatmap"===e.t0?10:"pie-chart"===e.t0?11:12;break;case 5:return e.abrupt("return",_t(t,r));case 6:return e.abrupt("return",wt(t,r));case 7:return e.abrupt("return",Vt(t,r));case 8:return e.abrupt("return",Ft(t,r));case 9:return e.abrupt("return",Rt(r));case 10:return e.abrupt("return",Ct(t,r));case 11:return e.abrupt("return",Tt(t,r));case 12:case"end":return e.stop()}}),e)}))),xt.apply(this,arguments)}function _t(e,t){return kt.apply(this,arguments)}function kt(){return kt=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.getSymbols(),i=n.length?n[0]:null,a=(0,He.Sc)(r),"renderer.symbol",e.next=3,$e(i,{schemaOptions:t,uniforms:a,path:"renderer.symbol"});case 3:return e.t0=e.sent,e.abrupt("return",{type:"simple",meshes:e.t0});case 5:case"end":return e.stop()}}),e)}))),kt.apply(this,arguments)}function wt(e,t){return Zt.apply(this,arguments)}function Zt(){return Zt=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,He.Sc)(r),"renderer.symbol",e.next=3,tt(r,{schemaOptions:t,uniforms:n,path:"renderer.symbol"});case 3:return e.t0=e.sent,e.abrupt("return",{type:"dot-density",meshes:e.t0});case 5:case"end":return e.stop()}}),e)}))),Zt.apply(this,arguments)}function Vt(e,t){return It.apply(this,arguments)}function It(){return It=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,a,o,l,c,d,f,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,He.Sc)(r),a=r.backgroundFillSymbol,o=r.normalizationType,l="log"===o?"esriNormalizeByLog":"percent-of-total"===o?"esriNormalizeByPercentOfTotal":"field"===o?"esriNormalizeByField":null,c=r.classBreakInfos.map(function(){var e=(0,u.Z)((0,s.Z)().mark((function e(r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$e(r.symbol,{path:"renderer-stop-".concat(r.minValue,"-").concat(r.maxValue),schemaOptions:t,uniforms:n});case 2:return e.t0=e.sent,e.t1=r.minValue,e.t2=r.maxValue,e.abrupt("return",{meshes:e.t0,min:e.t1,max:e.t2});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,Promise.all(c);case 7:return d=e.sent.sort((function(e,t){return e.min-t.min})),e.next=10,$e(a,{schemaOptions:t,path:"renderer.backgroundFill",uniforms:(0,i.Z)((0,i.Z)({},He.Jh),{},{visualVariableSizeOutlineScaleStops:n.visualVariableSizeOutlineScaleStops})});case 10:return f=e.sent,e.next=13,$e(r.defaultSymbol,{schemaOptions:t,path:"renderer.defaultSymbol",uniforms:n});case 13:return p=e.sent,e.abrupt("return",{type:"interval",field:r.field,expression:r.valueExpression,backgroundFill:f,defaultSymbol:p,intervals:d,normalizationField:r.normalizationField,normalizationTotal:r.normalizationTotal,normalizationType:l,isMaxInclusive:r.isMaxInclusive});case 15:case"end":return e.stop()}}),e)}))),It.apply(this,arguments)}function Ft(e,t){return Et.apply(this,arguments)}function Et(){return Et=(0,u.Z)((0,s.Z)().mark((function e(t,r){var a,u,o,l,c,d,f,p,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=[],o=(0,He.Sc)(r),e.next=4,$e(r.backgroundFillSymbol,{schemaOptions:t,path:"renderer.backgroundFill",uniforms:(0,i.Z)((0,i.Z)({},He.Jh),{},{visualVariableSizeOutlineScaleStops:o.visualVariableSizeOutlineScaleStops})});case 4:return l=e.sent,e.next=7,$e(r.defaultSymbol,{schemaOptions:t,path:"renderer.defaultSymbol",uniforms:o});case 7:c=e.sent,d=(0,n.Z)(null!==(a=r.uniqueValueInfos)&&void 0!==a?a:[]),e.prev=9,d.s();case 11:if((f=d.n()).done){e.next=19;break}return p=f.value,e.next=15,$e(p.symbol,{path:"renderer-unique-value-".concat(p.value),schemaOptions:t,uniforms:o});case 15:h=e.sent,u.push({value:""+p.value,symbol:h});case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),d.e(e.t0);case 24:return e.prev=24,d.f(),e.finish(24);case 27:return e.abrupt("return",{type:"map",field:r.field,expression:r.valueExpression,field2:r.field2,field3:r.field3,fieldDelimiter:r.fieldDelimiter,backgroundFill:l,defaultSymbol:c,map:u});case 28:case"end":return e.stop()}}),e,null,[[9,21,24,27]])}))),Et.apply(this,arguments)}function Rt(e){var t=(0,He.Sc)(e),r=e.scaleExpression,n=null!=r&&"1"!==r?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0;return{type:"dictionary",fieldMap:e.fieldMap,scaleExpression:n,visualVariableUniforms:t}}function Ct(e,t){return zt.apply(this,arguments)}function zt(){return zt=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(r,t);case 2:return e.t0=e.sent,e.abrupt("return",{type:"heatmap",meshes:e.t0});case 4:case"end":return e.stop()}}),e)}))),zt.apply(this,arguments)}function Tt(e,t){return Ot.apply(this,arguments)}function Ot(){return Ot=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"pie-chart",meshes:at(r,t)});case 1:case"end":return e.stop()}}),e)}))),Ot.apply(this,arguments)}var Mt=r(71873);function At(e,t){return qt.apply(this,arguments)}function qt(){return qt=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.renderer,i=(0,He.Sc)(n),e.next=3,St(t,n);case 3:return e.t0=e.sent,e.next=6,vt(t,r,i);case 6:return e.t1=e.sent,e.abrupt("return",{symbology:e.t0,labels:e.t1});case 8:case"end":return e.stop()}}),e)}))),qt.apply(this,arguments)}function Pt(e,t,r,n){return Ut.apply(this,arguments)}function Ut(){return Ut=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,i){var a,u,o,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=n.featureReduction)){e.next=7;break}e.t0=a.type,e.next="binning"===e.t0?5:"cluster"===e.t0?6:7;break;case 5:return e.abrupt("return",Lt(a,t,r,n,i));case 6:return e.abrupt("return",Jt(a,t,r,n,i));case 7:return u=Qt(n.orderBy,n.renderer,n.objectIdField),o=(0,Mt.$F)(n.renderer,r.filters),e.next=11,At(t,n);case 11:return l=e.sent,!1,e.abrupt("return",{storage:o,mesh:{properties:{sortKey:u,timeZone:r.timeZone,returnMeshObjectId:false,displayRefreshVersion:i},strategy:{type:"feature"},factory:l}});case 14:case"end":return e.stop()}}),e)}))),Ut.apply(this,arguments)}function Bt(e,t){return e.fields.map((function(e){return(0,i.Z)((0,i.Z)({},e.toJSON()),{},{type:Nt(e,t)})}))}function Nt(e,t){var r=e.onStatisticExpression,n=e.onStatisticField;switch(e.statisticType){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":if(r){var i=r.returnType;return i?"string"===i?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}var a=t.find((function(e){return e.name===n}));return a?a.type:"esriFieldTypeString"}}function Lt(e,t,r,n,i){return Dt.apply(this,arguments)}function Dt(){return Dt=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,i,a){var u,o,l,c,d,f,p,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Bt(t,i.fields),l=t.renderer,e.next=4,St(r,l);case 4:return c=e.sent,d=(0,Mt.$F)(l,[null,null]),f=(0,He.Sc)(l),e.next=9,vt(r,{geometryType:"polygon",labelingInfo:t.labelingInfo,labelsVisible:t.labelsVisible},f);case 9:return p=e.sent,!1,h="geohash"===t.binType?{type:"geohash",fixBinLevel:null!==(u=t.fixedBinLevel)&&void 0!==u?u:3}:{type:"grid",size:(0,_e.F2)(t.size),fixedBinLevel:t.fixedBinLevel},e.abrupt("return",{storage:d,mesh:{properties:{sortKey:null,timeZone:n.timeZone,returnMeshObjectId:false,displayRefreshVersion:a},strategy:{type:"binning",fields:o,index:h,featureFilter:n.filters[0]},factory:{labels:p,symbology:c}}});case 13:case"end":return e.stop()}}),e)}))),Dt.apply(this,arguments)}function Jt(e,t,r,n,i){return jt.apply(this,arguments)}function jt(){return jt=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,i,a){var u,o,l,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=Bt(t,i.fields),e.next=3,St(r,t.effectiveFeatureRenderer);case 3:return e.t0=e.sent,e.next=6,St(r,t.effectiveClusterRenderer);case 6:return e.t1=e.sent,o={type:"cluster",feature:e.t0,cluster:e.t1},l=(0,He.Sc)(t.effectiveFeatureRenderer),e.next=11,vt(r,i,l);case 11:return e.t2=e.sent,e.next=14,vt(r,{geometryType:"point",labelingInfo:t.labelingInfo,labelsVisible:t.labelsVisible},l);case 14:return e.t3=e.sent,c={type:"cluster",feature:e.t2,cluster:e.t3},!1,e.abrupt("return",{storage:(0,Mt.$F)(t.effectiveFeatureRenderer,[null,null]),mesh:{properties:{sortKey:null,timeZone:n.timeZone,displayRefreshVersion:a,returnMeshObjectId:false},strategy:{type:"cluster",fields:u,featureFilter:n.filters[0],clusterRadius:(0,_e.F2)(t.clusterRadius/2)},factory:{labels:c,symbology:o}}});case 18:case"end":return e.stop()}}),e)}))),jt.apply(this,arguments)}function Qt(e,t,r){var n=null!=t&&"unique-value"===t.type&&t.orderByClassesEnabled;if("default"!==e||n||(e=[new Ae.Z({field:r,order:"descending"})]),"default"!==e&&e.length){e.length;var i=e[0],a="ascending"===i.order?"asc":"desc";return i.field?{field:i.field,order:a}:i.valueExpression?{expression:i.valueExpression,order:a}:null}return n?{byRenderer:!0,order:"asc"}:null}var Ht=r(91370),Gt=function(){function e(t){(0,o.Z)(this,e),this.layer=t}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){var t=this.layer,r=Re(t);return[{vvEvaluators:{0:Te(t.renderer)},deconflictionEnabled:r}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,d,f,p,h,y,v,m,b,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.layer,a=i.capabilities,u=i.editingInfo,o=i.objectIdField,l=i.globalIdField,c=i.datesInUnknownTimezone,d=i.orderBy,f=i.parsedUrl,p=i.fieldsIndex.toJSON(),h=xe(i),y=null===(r=i.timeInfo)||void 0===r?void 0:r.toJSON(),v=i.spatialReference.toJSON(),m=(0,ge.d9)(f),b=o,null!==d&&void 0!==d&&d.length&&(g=!d[0].valueExpression&&d[0].field)&&(b=g),e.abrupt("return",{type:"feature-service",source:m,isSourceHosted:(0,Se.M8)(m.path),orderByFields:b,outSpatialReference:t.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:c,globalIdField:l,fieldsIndex:p,geometryType:h,objectIdField:o,timeInfo:y,spatialReference:v,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:null===u||void 0===u||null===(n=u.lastEditDate)||void 0===n?void 0:n.getTime(),snapshotInfo:null}});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){var r=this.layer;return Me({definitionExpression:r.definitionExpression,customParameters:r.customParameters,timeExtent:r.timeExtent},e,t,r.apiKey)}},{key:"createProcessorSchema",value:function(e,t,r){var n=this.layer,i=n.fields,a=n.geometryType,s=n.orderBy,u=n.objectIdField,o=n.renderer,l=n.labelingInfo,c=n.labelsVisible,d={featureReduction:null,fields:i.map((function(e){return e.toJSON()})),geometryType:a,labelingInfo:l,labelsVisible:c,objectIdField:u,orderBy:null!==s&&void 0!==s?s:"default",renderer:null===o||void 0===o?void 0:o.clone()};return Pt(e,t,d,r)}},{key:"hasRequiredSupport",get:function(){return(0,Ht.T)(this.layer.renderer)}},{key:"timeOptions",get:function(){return this.layer}},{key:"getUpdateHashProperties",value:function(e){var t=this.layer,r=t.definitionExpression,n=t.apiKey,i=t.renderer,a=this.layer.labelsVisible?this.layer.labelingInfo:null,s=JSON.stringify(t.customParameters),u=JSON.stringify(t.orderBy);return{outFields:this.layer.outFields,apiKey:n,customParameters:s,definitionExpression:r,labelingInfo:a,orderBy:u,renderer:i}}},{key:"setGraphicOrigin",value:function(e){e.origin={type:"catalog",layer:this.layer}}}]),e}();function Wt(e,t){var r=e.extent,n=null===t||void 0===t?void 0:t.clone().intersection(r),i=null!=n?n.width*n.height:0,a=t?t.width*t.height:0,s=0===a?0:i/a,u=(0,y.Z)("featurelayer-snapshot-point-coverage");return!isNaN(s)&&s>=u}function Yt(e,t){return null!=e.floorInfo&&(e.floorInfo.viewAllLevelIds.length>0||t.floors.length>0)}function Kt(e,t,r){var n,i,a=function(e,t,r){var n,i;if(null==e.floorInfo||null===(n=r.floors)||void 0===n||!n.length)return t;var a=r.floors,s=e.floorInfo,u=s.floorField,o=s.viewAllLevelIds;o.length&&(a=o);var l=a.filter((function(e){return""!==e})).map((function(e){return"'"+e+"'"}));if(l.push("''"),null!==(i=t)&&void 0!==i&&i.includes(u)){var c=new RegExp("AND \\("+u+".*NULL\\)","g");t=t.replace(c,""),c=new RegExp("\\("+u+".*NULL\\)","g"),t=(t=t.replace(c,"")).replaceAll(/\s+/g," ").trim()}var d="("+u+" IN ({ids}) OR "+u+" IS NULL)";return d=d.replace("{ids}",l.join(", ")),(0,Oe._)(t,d)}(e,null===(n=t)||void 0===n?void 0:n.where,r);return a?(null!==(i=t)&&void 0!==i||(t=new O.Z),t.where=a,t):t}var Xt=function(){function e(t){(0,o.Z)(this,e),this.layer=t}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){var t,r=this.layer,n=null!==(t=Ce(r,e))&&void 0!==t?t:Re(r);return[{vvEvaluators:{0:Te(r.renderer)},deconflictionEnabled:n}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,d,f,p,h,v,m,b,g,S,x,_,k,w,Z,V,I,F,E;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=this.layer,o=u.capabilities,l=u.editingInfo,c=u.objectIdField,d=u.typeIdField,f=u.globalIdField,p=u.datesInUnknownTimezone,h=u.orderBy,v=u.subtypeField,m=u.refreshInterval,b=u.fieldsIndex.toJSON(),g=b.fields,S=xe(u),x=null===(r=u.timeInfo)||void 0===r?void 0:r.toJSON(),_=u.spatialReference.toJSON(),k=null===(n=u.types)||void 0===n?void 0:n.map((function(e){return e.toJSON()})),w=(0,ge.d9)(this.layer.parsedUrl),this.layer.dynamicDataSource&&(w.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})}),Z=this.layer.objectIdField,null!==h&&void 0!==h&&h.length&&(V=!h[0].valueExpression&&h[0].field)&&(Z=V),I=!(null!=(null===l||void 0===l?void 0:l.lastEditDate))&&m>0,F=(0,y.Z)("featurelayer-snapshot-enabled")&&"point"===u.geometryType&&(null===o||void 0===o?void 0:o.query.supportsPagination)&&!(null!==o&&void 0!==o&&o.operations.supportsEditing)&&!I,E=F&&Wt(t,u.fullExtent),e.abrupt("return",{type:"feature-service",source:w,isSourceHosted:(0,Se.M8)(w.path),orderByFields:Z,outSpatialReference:t.spatialReference.toJSON(),metadata:{typeIdField:null!==d&&void 0!==d?d:void 0,types:k,timeReferenceUnknownClient:p,subtypeField:v,globalIdField:f,fields:g,fieldsIndex:b,geometryType:S,objectIdField:c,timeInfo:x,spatialReference:_,subtypes:null===(i=this.layer.subtypes)||void 0===i?void 0:i.map((function(e){return e.toJSON()}))},queryMetadata:{maxRecordCount:o.query.maxRecordCount,supportsCompactGeometry:o.query.supportsCompactGeometry,supportsDefaultSpatialReference:o.query.supportsDefaultSpatialReference,supportsFormatPBF:o.query.supportsFormatPBF,supportsMaxRecordCountFactor:o.query.supportsMaxRecordCountFactor,supportsQuantization:o.query.supportsQuantization,lastEditDate:null===l||void 0===l||null===(a=l.lastEditDate)||void 0===a?void 0:a.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:F,supportsSnapshotMaxThreshold:E,snapshotCountThresholds:{min:(0,y.Z)("featurelayer-snapshot-point-min-threshold"),max:(0,y.Z)("featurelayer-snapshot-point-max-threshold")}}}});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){var r=this.layer;return Me({definitionExpression:r.definitionExpression,customParameters:r.customParameters,gdbVersion:r.gdbVersion,historicMoment:r.historicMoment,subtypeCode:r.subtypeCode,subtypeField:r.subtypeField,timeExtent:r.timeExtent},e,t,r.apiKey)}},{key:"createProcessorSchema",value:function(e,t,r){var n=this.layer,i=n.fields,a=n.renderer,s=n.geometryType,u=n.labelingInfo,o=n.labelsVisible,l=n.orderBy,c=n.objectIdField,d={fields:i.map((function(e){return e.toJSON()})),renderer:null===a||void 0===a?void 0:a.clone(),featureReduction:(0,ke.g)(this.layer,t),geometryType:s,labelingInfo:u,labelsVisible:o,objectIdField:c,orderBy:null!==l&&void 0!==l?l:"default"};return Pt(e,t,d,r)}},{key:"hasRequiredSupport",get:function(){return(0,Ht.T)(this.layer.renderer)}},{key:"timeOptions",get:function(){return this.layer}},{key:"hasFilters",value:function(e){return Yt(this.layer,e)}},{key:"addFilters",value:function(e,t){return Kt(this.layer,e,t)}},{key:"getUpdateHashProperties",value:function(e){var t,r,n=this.layer,i=n.definitionExpression,a=n.renderer,s=n.gdbVersion,u=n.apiKey,o=n.subtypeCode,l=this.layer.labelsVisible?this.layer.labelingInfo:null,c=null!==(t=null===(r=n.historicMoment)||void 0===r?void 0:r.getTime())&&void 0!==t?t:void 0,d=JSON.stringify(n.customParameters),f=(0,ke.g)(n,e),p=JSON.stringify(n.orderBy),h=Yt(this.layer,e)?e.floors:null;return{outFields:this.layer.outFields,apiKey:u,customParameters:d,definitionExpression:i,featureReduction:f,floors:h,gdbVersion:s,historicMoment:c,labelingInfo:l,orderBy:p,renderer:a,subtypeCode:o}}}]),e}();function $t(e){if(!("openPorts"in e))throw new k.Z("source-not-supported")}var er=function(){function e(t){(0,o.Z)(this,e),this.layer=t}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){var t,r=this.layer,n=null!==(t=Ce(r,e))&&void 0!==t?t:Re(r);return[{vvEvaluators:{0:Te(r.renderer)},deconflictionEnabled:n}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.layer,i=n.capabilities,a=n.objectIdField,u=n.fieldsIndex.toJSON(),o=xe(n),l=null===(r=n.timeInfo)||void 0===r?void 0:r.toJSON(),c=n.spatialReference.toJSON(),$t(n.source),e.next=4,n.source.openPorts();case 4:return e.t0=e.sent,e.t1=a,e.t2=t.spatialReference.toJSON(),e.t3={fieldsIndex:u,geometryType:o,objectIdField:a,timeInfo:l,spatialReference:c,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:null},e.t4={maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:null,snapshotInfo:null},e.abrupt("return",{type:"memory",source:e.t0,orderByFields:e.t1,outSpatialReference:e.t2,metadata:e.t3,queryMetadata:e.t4});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){var r=this.layer;return Me({definitionExpression:r.definitionExpression,timeExtent:r.timeExtent,customParameters:null},e,t,null)}},{key:"createProcessorSchema",value:function(e,t,r){var n=this.layer,i=n.fields,a=n.renderer,s=n.geometryType,u=n.labelingInfo,o=n.labelsVisible,l=n.orderBy,c=n.objectIdField,d={fields:i.map((function(e){return e.toJSON()})),renderer:null===a||void 0===a?void 0:a.clone(),featureReduction:(0,ke.g)(this.layer,t),geometryType:s,labelingInfo:u,labelsVisible:o,objectIdField:c,orderBy:null!==l&&void 0!==l?l:"default"};return Pt(e,t,d,r)}},{key:"hasRequiredSupport",get:function(){return(0,Ht.T)(this.layer.renderer)}},{key:"timeOptions",get:function(){return this.layer}},{key:"getUpdateHashProperties",value:function(e){var t=this.layer,r=t.definitionExpression,n=t.renderer,i=this.layer.labelsVisible?this.layer.labelingInfo:null,a=(0,ke.g)(t,e);return{orderBy:JSON.stringify(t.orderBy),definitionExpression:r,renderer:n,labelingInfo:i,featureReduction:a}}}]),e}(),tr=function(){function e(t){(0,o.Z)(this,e),this.layer=t,this.timeOptions=null}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){var t,r=this.layer,n=null!==(t=Ce(r,e))&&void 0!==t?t:Re(r);return[{vvEvaluators:{0:Te(r.renderer)},deconflictionEnabled:n}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.layer,n=r.capabilities,i=r.objectIdField,a=r.fieldsIndex.toJSON(),u=xe(r),o=r.spatialReference.toJSON(),e.next=3,r.source.openPorts();case 3:return e.t0=e.sent,e.t1=i,e.t2=t.spatialReference.toJSON(),e.t3={fieldsIndex:a,geometryType:u,objectIdField:i,spatialReference:o,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},e.t4={maxRecordCount:n.query.maxRecordCount,supportsCompactGeometry:n.query.supportsCompactGeometry,supportsDefaultSpatialReference:n.query.supportsDefaultSpatialReference,supportsFormatPBF:n.query.supportsFormatPBF,supportsMaxRecordCountFactor:n.query.supportsMaxRecordCountFactor,supportsQuantization:n.query.supportsQuantization,lastEditDate:null,snapshotInfo:null},e.abrupt("return",{type:"memory",source:e.t0,orderByFields:e.t1,outSpatialReference:e.t2,metadata:e.t3,queryMetadata:e.t4});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){return Me({definitionExpression:this.layer.definitionExpression,customParameters:null},e,t,null)}},{key:"createProcessorSchema",value:function(e,t,r){var n=this.layer,i=n.fields,a=n.renderer,s=n.geometryType,u=n.labelingInfo,o=n.labelsVisible,l=n.objectIdField;return Pt(e,t,{fields:i.map((function(e){return e.toJSON()})),renderer:null===a||void 0===a?void 0:a.clone(),featureReduction:(0,ke.g)(this.layer,t),geometryType:s,labelingInfo:u,labelsVisible:o,objectIdField:l,orderBy:"default"},r)}},{key:"hasRequiredSupport",get:function(){return(0,Ht.T)(this.layer.renderer)}},{key:"getUpdateHashProperties",value:function(e){var t=this.layer;return{definitionExpression:t.definitionExpression,renderer:t.renderer,labelingInfo:this.layer.labelsVisible?this.layer.labelingInfo:null,featureReduction:(0,ke.g)(t,e)}}}]),e}(),rr=function(){function e(t){(0,o.Z)(this,e),this.layer=t}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){var t,r=this.layer,n=null!==(t=Ce(r,e))&&void 0!==t?t:Re(r);return[{vvEvaluators:{0:Te(r.renderer)},deconflictionEnabled:n}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,d,f,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.layer,i=n.capabilities,a=n.objectIdField,u=n.fieldsIndex.toJSON(),o=xe(n),l=null===(r=n.timeInfo)||void 0===r?void 0:r.toJSON(),c=n.spatialReference.toJSON(),d=n.source.getSource(),f=this.layer.objectIdField,p=(0,ge.d9)(i),e.abrupt("return",(p.query.maxRecordCount=d.maxRecordCount,{type:"ogc",source:d,orderByFields:f,outSpatialReference:t.spatialReference.toJSON(),metadata:{fieldsIndex:u,geometryType:o,objectIdField:a,timeInfo:l,spatialReference:c,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:p.query.maxRecordCount,supportsCompactGeometry:p.query.supportsCompactGeometry,supportsDefaultSpatialReference:p.query.supportsDefaultSpatialReference,supportsFormatPBF:p.query.supportsFormatPBF,supportsMaxRecordCountFactor:p.query.supportsMaxRecordCountFactor,supportsQuantization:p.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){var r=this.layer;return Me({customParameters:r.customParameters,timeExtent:r.timeExtent},e,t,r.apiKey)}},{key:"createProcessorSchema",value:function(e,t,r){var n=this.layer,i=n.fields,a=n.renderer,s=n.geometryType,u=n.labelingInfo,o=n.labelsVisible,l=n.orderBy,c=n.objectIdField,d={fields:i.map((function(e){return e.toJSON()})),renderer:null===a||void 0===a?void 0:a.clone(),featureReduction:(0,ke.g)(this.layer,t),geometryType:s,labelingInfo:u,labelsVisible:o,objectIdField:c,orderBy:null!==l&&void 0!==l?l:"default"};return Pt(e,t,d,r)}},{key:"hasRequiredSupport",get:function(){return(0,Ht.T)(this.layer.renderer)}},{key:"timeOptions",get:function(){return this.layer}},{key:"getUpdateHashProperties",value:function(e){var t=this.layer,r=t.renderer,n=t.apiKey,i=this.layer.labelsVisible?this.layer.labelingInfo:null;return{apiKey:n,customParameters:JSON.stringify(t.customParameters),featureReduction:(0,ke.g)(t,e),labelingInfo:i,orderBy:JSON.stringify(t.orderBy),renderer:r}}}]),e}(),nr=function(){function e(t){(0,o.Z)(this,e),this.layer=t}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){var t,r=this.layer,n=null!==(t=Ce(r,e))&&void 0!==t?t:Re(r);return[{vvEvaluators:{0:Te(r.renderer)},deconflictionEnabled:n}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,d,f,p,h,v,m,b,g,S,x;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.layer,i=n.capabilities,a=n.objectIdField,u=n.globalIdField,o=n.orderBy,l=n.refreshInterval,c=n.fieldsIndex.toJSON(),d=c.fields,f=xe(n),p=null===(r=n.timeInfo)||void 0===r?void 0:r.toJSON(),h=n.spatialReference.toJSON(),v=(0,ge.d9)(this.layer.parsedUrl),m=this.layer.objectIdField,null!==o&&void 0!==o&&o.length&&(b=!o[0].valueExpression&&o[0].field)&&(m=b),g=l>0,S=(0,y.Z)("featurelayer-snapshot-enabled")&&"point"===n.geometryType&&(null===i||void 0===i?void 0:i.query.supportsPagination)&&!(null!==i&&void 0!==i&&i.operations.supportsEditing)&&!g,x=S&&Wt(t,n.fullExtent),e.abrupt("return",{type:"feature-service",source:v,isSourceHosted:(0,Se.M8)(v.path),orderByFields:m,outSpatialReference:t.spatialReference.toJSON(),metadata:{globalIdField:u,fields:d,fieldsIndex:c,geometryType:f,objectIdField:a,timeInfo:p,spatialReference:h,timeReferenceUnknownClient:!1,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:null,snapshotInfo:{supportsSnapshotMinThreshold:S,supportsSnapshotMaxThreshold:x,snapshotCountThresholds:{min:(0,y.Z)("featurelayer-snapshot-point-min-threshold"),max:(0,y.Z)("featurelayer-snapshot-point-max-threshold")}}}});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){var r=this.layer;return Me({definitionExpression:r.definitionExpression,customParameters:r.customParameters,timeExtent:r.timeExtent},e,t,null)}},{key:"createProcessorSchema",value:function(e,t,r){var n=this.layer,i=n.fields,a=n.renderer,s=n.geometryType,u=n.labelingInfo,o=n.labelsVisible,l=n.orderBy,c=n.objectIdField,d={fields:i.map((function(e){return e.toJSON()})),renderer:null===a||void 0===a?void 0:a.clone(),featureReduction:(0,ke.g)(this.layer,t),geometryType:s,labelingInfo:u,labelsVisible:o,objectIdField:c,orderBy:null!==l&&void 0!==l?l:"default"};return Pt(e,t,d,r)}},{key:"hasRequiredSupport",get:function(){return(0,Ht.T)(this.layer.renderer)}},{key:"timeOptions",get:function(){return this.layer}},{key:"hasFilters",value:function(e){return Yt(this.layer,e)}},{key:"addFilters",value:function(e,t){return Kt(this.layer,e,t)}},{key:"getUpdateHashProperties",value:function(e){var t=this.layer,r=t.definitionExpression,n=t.renderer,i=t.outFields,a=this.layer.labelsVisible?this.layer.labelingInfo:null,s=JSON.stringify(t.customParameters),u=(0,ke.g)(t,e);return{outFields:i,orderBy:JSON.stringify(t.orderBy),definitionExpression:r,renderer:n,labelingInfo:a,featureReduction:u,customParameters:s,floors:Yt(this.layer,e)?e.floors:null}}}]),e}(),ir=function(){function e(t){(0,o.Z)(this,e),this.layer=t}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){var t,r=this.layer,n=null!==(t=Ce(r,e))&&void 0!==t?t:Re(r);return[{vvEvaluators:{0:Te(r.renderer)},deconflictionEnabled:n}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.layer,i=n.objectIdField,a=xe(n),u=(null===(r=n.timeInfo)||void 0===r?void 0:r.toJSON())||null,o=n.spatialReference?n.spatialReference.toJSON():null,e.abrupt("return",{type:"stream",source:this.layer.parsedUrl,outSpatialReference:t.spatialReference.toJSON(),metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:a,objectIdField:i,timeInfo:u,timeReferenceUnknownClient:null,spatialReference:o,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){var r=this.layer,n=r.definitionExpression,i=r.geometryDefinition,a=r.customParameters;return{type:"stream",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{geometryDefinition:null===i||void 0===i?void 0:i.toJSON(),definitionExpression:n,customParameters:null!==a&&void 0!==a?a:null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}},{key:"createProcessorSchema",value:function(e,t,r){var n=this.layer,i=n.fields,a=n.renderer,s=n.geometryType,u=n.labelingInfo,o=n.labelsVisible,l=n.objectIdField;return Pt(e,t,{fields:i.map((function(e){return e.toJSON()})),renderer:null===a||void 0===a?void 0:a.clone(),featureReduction:(0,ke.g)(this.layer,t),geometryType:s,labelingInfo:u,labelsVisible:o,objectIdField:l,orderBy:"default"},r)}},{key:"hasRequiredSupport",get:function(){return(0,Ht.T)(this.layer.renderer)}},{key:"timeOptions",get:function(){return this.layer}},{key:"getUpdateHashProperties",value:function(e){var t=this.layer,r=t.definitionExpression,n=t.renderer,i=this.layer.labelsVisible?this.layer.labelingInfo:null,a=JSON.stringify(t.customParameters);return{definitionExpression:r,renderer:n,labelingInfo:i,featureReduction:(0,ke.g)(t,e),customParameters:a,geometryDefinition:t.geometryDefinition,definitionExpressoin:t.definitionExpression}}}]),e}(),ar=r(4942),sr=r(90316);function ur(e,t){return or.apply(this,arguments)}function or(){return or=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.subtypeField,a=r.sublayers,e.next=3,Promise.all(a.map((function(e){var r=e.renderer;return St(t,r)})));case 3:return u=e.sent,e.abrupt("return",{type:"subtype",subtypeField:n,renderers:a.reduce((function(e,t,r){var n=t.subtypeCode;return(0,i.Z)((0,i.Z)({},e),{},(0,ar.Z)({},n,u[r]))}),{})});case 5:case"end":return e.stop()}}),e)}))),or.apply(this,arguments)}function lr(e,t){var r=(0,sr.h)();return{type:"subtype",filters:e.filters,capabilities:{maxTextureSize:r.maxTextureSize},subtypeField:t.subtypeField,target:"feature",bindings:t.sublayers.reduce((function(e,t){var r=t.renderer,n=t.subtypeCode,a=(0,Mt.vZ)(r);return(0,i.Z)((0,i.Z)({},e),{},(0,ar.Z)({},n,a))}),{})}}function cr(e,t){return dr.apply(this,arguments)}function dr(){return dr=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.subtypeField,a=r.sublayers,e.next=3,Promise.all(a.map((function(e){var r,n=(0,He.Sc)(e.renderer),a=(0,i.Z)((0,i.Z)({},e),{},{geometryType:null!==(r=e.geometryType)&&void 0!==r?r:null});return vt(t,a,n)})));case 3:return u=e.sent,e.abrupt("return",{type:"subtype",subtypeField:n,renderers:a.reduce((function(e,t,r){var n=t.subtypeCode;return(0,i.Z)((0,i.Z)({},e),{},(0,ar.Z)({},n,u[r]))}),{})});case 5:case"end":return e.stop()}}),e)}))),dr.apply(this,arguments)}function fr(){return fr=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=lr(r,n),e.t1={timeZone:r.timeZone,displayRefreshVersion:i,returnMeshObjectId:!1,sortKey:null},e.t2={type:"feature"},e.next=5,ur(t,n);case 5:return e.t3=e.sent,e.next=8,cr(t,n);case 8:return e.t4=e.sent,e.t5={symbology:e.t3,labels:e.t4},e.t6={properties:e.t1,strategy:e.t2,factory:e.t5},e.abrupt("return",{storage:e.t0,mesh:e.t6});case 12:case"end":return e.stop()}}),e)}))),fr.apply(this,arguments)}var pr=function(){function e(t){(0,o.Z)(this,e),this.layer=t}return(0,l.Z)(e,[{key:"getLabelingDeconflictionInfo",value:function(e){return[{vvEvaluators:{},deconflictionEnabled:this.layer.sublayers.every((function(e){return Re(e)}))}]}},{key:"createServiceOptions",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,d,f,p,h,v,m,b,g,S,x,_,k;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.layer,u=a.capabilities,o=a.datesInUnknownTimezone,l=a.editingInfo,c=a.globalIdField,d=a.objectIdField,f=a.refreshInterval,p=a.subtypeField,h=a.fieldsIndex.toJSON(),v=xe(a),m=null===(r=a.timeInfo)||void 0===r?void 0:r.toJSON(),b=a.spatialReference.toJSON(),g=(0,ge.d9)(this.layer.parsedUrl),S=d,x=!(null!=(null===l||void 0===l?void 0:l.lastEditDate))&&f>0,_=(0,y.Z)("featurelayer-snapshot-enabled")&&"point"===a.geometryType&&(null===u||void 0===u?void 0:u.query.supportsPagination)&&!(null!==u&&void 0!==u&&u.operations.supportsEditing)&&!x,k=_&&Wt(t,a.fullExtent),e.abrupt("return",{type:"feature-service",source:g,isSourceHosted:(0,Se.M8)(g.path),orderByFields:S,outSpatialReference:t.spatialReference.toJSON(),metadata:{timeReferenceUnknownClient:o,subtypeField:p,globalIdField:c,fieldsIndex:h,geometryType:v,objectIdField:d,timeInfo:m,spatialReference:b,subtypes:null===(n=this.layer.subtypes)||void 0===n?void 0:n.map((function(e){return e.toJSON()})),typeIdField:null,types:null},queryMetadata:{maxRecordCount:u.query.maxRecordCount,supportsCompactGeometry:u.query.supportsCompactGeometry,supportsDefaultSpatialReference:u.query.supportsDefaultSpatialReference,supportsFormatPBF:u.query.supportsFormatPBF,supportsMaxRecordCountFactor:u.query.supportsMaxRecordCountFactor,supportsQuantization:u.query.supportsQuantization,lastEditDate:null===l||void 0===l||null===(i=l.lastEditDate)||void 0===i?void 0:i.getTime(),snapshotInfo:{supportsSnapshotMinThreshold:_,supportsSnapshotMaxThreshold:k,snapshotCountThresholds:{min:(0,y.Z)("featurelayer-snapshot-point-min-threshold"),max:(0,y.Z)("featurelayer-snapshot-point-max-threshold")}}}});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSourceSchema",value:function(e,t){var r=this.layer,n=r.definitionExpression,i=r.customParameters,a=r.gdbVersion,s=r.historicMoment,u=r.subtypeField,o=r.timeExtent,l=r.apiKey,c={queryScaleRanges:this.layer.sublayers.items.map((function(e){return{subtypeCode:e.subtypeCode,minScale:e.minScale,maxScale:e.maxScale}})),definitionExpression:n,customParameters:i,gdbVersion:a,historicMoment:s,subtypeField:u,timeExtent:o};return Me(c,e,t,l)}},{key:"createProcessorSchema",value:function(e,t,r){var n=this,i={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,(function(e){return{featureReduction:null,geometryType:n.layer.geometryType,labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible,renderer:e.renderer,subtypeCode:e.subtypeCode,orderBy:null}}))};return function(e,t,r,n){return fr.apply(this,arguments)}(e,t,i,r)}},{key:"hasFilters",value:function(e){return Yt(this.layer,e)||function(e,t){return e.sublayers.some((function(e){return!hr(e,t)}))}(this.layer,e)}},{key:"addFilters",value:function(e,t){var r;e=Kt(this.layer,e,t);var n=this.layer.sublayers.filter((function(e){return!hr(e,t)})).map((function(e){return e.subtypeCode}));if(!n.length)return e;null!==(r=e)&&void 0!==r||(e=new O.Z);var i="NOT ".concat(this.layer.subtypeField," IN (").concat(n.join(","),")");return e.where=(0,Oe._)(e.where,i),e}},{key:"hasRequiredSupport",get:function(){return!0}},{key:"timeOptions",get:function(){return this.layer}},{key:"getUpdateHashProperties",value:function(e){var t,r,n=this.layer,i=n.definitionExpression,a=n.gdbVersion,s=n.apiKey,u=null!==(t=null===(r=n.historicMoment)||void 0===r?void 0:r.getTime())&&void 0!==t?t:void 0,o=JSON.stringify(n.customParameters),l=Yt(this.layer,e)?e.floors:null,c=this.layer.sublayers.map((function(e){return{renderer:e.renderer,labelsVisible:e.labelsVisible,labelingInfo:e.labelingInfo,visible:e.visible}}));return{outFields:this.layer.outFields,gdbVersion:a,definitionExpression:i,historicMoment:u,customParameters:o,apiKey:s,sublayers:c,floors:l}}},{key:"setGraphicOrigin",value:function(e){var t=this.layer.fieldsIndex.get(this.layer.subtypeField),r=e.attributes[t.name],n=this.layer.sublayers.find((function(e){return e.subtypeCode===r}));e.layer=e.sourceLayer=n}}]),e}();function hr(e,t){return e.visible&&(0===e.minScale||(0,we.W8)(t.scale,e.minScale)||t.scale<e.minScale)&&(0===e.maxScale||(0,we.W8)(t.scale,e.maxScale)||t.scale>e.maxScale)}var yr=r(10507),vr=r(62862),mr=r(16547);function br(e,t){var r,i=new Set,a=(0,n.Z)(e instanceof Set?e.values():e.keys());try{for(a.s();!(r=a.n()).done;){var s=r.value;t.has(s)||i.add(s)}}catch(u){a.e(u)}finally{a.f()}return i}var gr=function(){function e(t,r,i){(0,o.Z)(this,e);var a=i?t.getTileCoverage(i,0,!0,"closest"):null,s=t.getTileCoverage(r,0,!0,"closest");if(this._tileKeys=new Map,a){var u,l=(0,n.Z)(a.keys());try{for(l.s();!(u=l.n()).done;){var c=u.value;this._tileKeys.set(c.id,c)}}catch(h){l.e(h)}finally{l.f()}}if(s){var d,f=(0,n.Z)(s.keys());try{for(f.s();!(d=f.n()).done;){var p=d.value;this._tileKeys.set(p.id,p)}}catch(h){f.e(h)}finally{f.f()}}}return(0,l.Z)(e,[{key:"coverageSet",get:function(){return new Set(this._tileKeys.keys())}},{key:"keys",value:function(){return this._tileKeys.values()}}]),e}(),Sr=(0,l.Z)((function e(t){(0,o.Z)(this,e),this.version=t})),xr=function(){function e(t){(0,o.Z)(this,e),this._subscriptions=new Map,this._visible=new Set,this._paused=new Set,this._version=0,this._config=t}return(0,l.Z)(e,[{key:"destroy",value:function(){}},{key:"_coverageSet",get:function(){var e,t;return null!==(e=null===(t=this._coverage)||void 0===t?void 0:t.coverageSet)&&void 0!==e?e:new Set}},{key:"suspend",value:function(){this._suspendedOverage=this._coverage,this._coverage=null,this._updateSubscriptions()}},{key:"resume",value:function(){null==this._coverage&&(this._coverage=this._suspendedOverage,this._suspendedOverage=null,this._updateSubscriptions())}},{key:"update",value:function(e,t){return this._version=(this._version+1)%Number.MAX_SAFE_INTEGER,this._updateCoverage(e,t),this._updateSubscriptions(),new Set(this._visible)}},{key:"_updateCoverage",value:function(e,t){this._coverage=new gr(this._config.tileInfoView,e,t)}},{key:"_updateSubscriptions",value:function(){var e=this._coverageSet,t=this._updateVisibility(),r=br(t,e),i=br(this._subscriptions,t),a=br(e,this._subscriptions),s=br(i,e),u=br(r,s),o=br(u,this._paused);this._visible=t;var l,c=(0,n.Z)(a.values());try{for(c.s();!(l=c.n()).done;){var d=l.value;this._subscriptions.set(d,new Sr(this._version))}}catch(b){c.e(b)}finally{c.f()}var f,p=(0,n.Z)(o.values());try{for(p.s();!(f=p.n()).done;){var h=f.value;this._paused.add(h)}}catch(b){p.e(b)}finally{p.f()}var y,v=(0,n.Z)(s.values());try{for(v.s();!(y=v.n()).done;){var m=y.value;this._subscriptions.delete(m),this._paused.delete(m)}}catch(b){v.e(b)}finally{v.f()}(a.size||s.size||o.size)&&this._sendUpdateSubscriptions(a,s,o)}},{key:"_sendUpdateSubscriptions",value:function(e,t,r){var n=this,i=Array.from(e.values()).map((function(e){return{tileId:e,version:n._subscriptions.get(e).version}}));this._config.updateSubscriptions({subscribe:i,unsubscribe:Array.from(t.values()),pause:Array.from(r.values())})}},{key:"_updateVisibility",value:function(){var e=new Set,t=new Set;if(!this._coverage)return e;var r,i=(0,n.Z)(this._coverage.keys());try{for(i.s();!(r=i.n()).done;){var a=r.value;this._config.isDone(a)?e.add(a.id):this._addVisibleParent(e,t,a)||this._addVisibleChildren(e,a)||e.add(a.id)}}catch(h){i.e(h)}finally{i.f()}var s,u=new ae.Z(0,0,0,0),o=new ae.Z(0,0,0,0),l=(0,n.Z)(t);try{for(l.s();!(s=l.n()).done;){var c=s.value;u.id=c;var d,f=(0,n.Z)(e);try{for(f.s();!(d=f.n()).done;){var p=d.value;o.id=p,u.containsChild(o)&&e.delete(p)}}catch(h){f.e(h)}finally{f.f()}}}catch(h){l.e(h)}finally{l.f()}return e}},{key:"_addVisibleParent",value:function(e,t,r){var i,a=!1,s=(0,n.Z)(this._visible.values());try{for(s.s();!(i=s.n()).done;){var u=i.value;new ae.Z(u).containsChild(r)&&(e.add(u),t.add(u),a=!0)}}catch(o){s.e(o)}finally{s.f()}return a}},{key:"_addVisibleChildren",value:function(e,t){var r,i=!1,a=(0,n.Z)(this._visible.values());try{for(a.s();!(r=a.n()).done;){var s=r.value,u=new ae.Z(s);t.containsChild(u)&&(e.add(s),i=!0)}}catch(o){a.e(o)}finally{a.f()}return i}}]),e}(),_r=r(74937),kr=r(67581),wr=r(13107),Zr=r(53866);var Vr=4294967294,Ir=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments))._commandsQueue=new yr.Z({process:function(t){switch(t.type){case"edit-by-feature":case"edit-by-id":return e._doEdit(t);case"update":return e._doUpdate();case"highlight":return e._updateHighlights()}}}),e._visibilityOverrides=new Set,e._highlightCounter=new mr.i,e._lastAvailableFields=[],e._lastTargetState=null,e.eventLog=new be,e._sourceRefreshVersion=1,e._displayRefreshVersion=1,e._pipelineUpdating=!1,e._fields=null,e.featureEffectView=new z,e}return(0,l.Z)(r,[{key:"destroy",value:function(){var e;null!==(e=this._workerProxy)&&void 0!==e&&e.destroy(),this._workerAttached.reject((0,I.zE)()),this._commandsQueue.destroy()}},{key:"initialize",value:function(){this._workerAttached=(0,I.hh)(),(0,I.R8)(this._workerAttached.promise),this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransitions()}},{key:"_initProxy",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("isTable"in(r=this.layer))||!r.isTable){e.next=3;break}throw new k.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:r});case 3:if("mesh"!==r.geometryType){e.next=5;break}throw new k.Z("featurelayerview:geometry-type-not-supported","Geometry type of ".concat(r.geometryType," is not supported"),{layer:r});case 5:if("feature"!==r.type&&"subtype-group"!==r.type||!1!==(null===(t=(0,A.S1)(r))||void 0===t?void 0:t.operations.supportsQuery)){e.next=7;break}throw new k.Z("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:r});case 7:return this._workerProxy&&this._workerProxy.destroy(),n=this._createClientOptions(),e.next=11,pe(n);case 11:this._workerProxy=e.sent;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_attachProxy",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerAdapter.createServiceOptions(this.view);case 2:return e.t0=e.sent,e.t1=this.view.featuresTilingScheme.tileInfo.toJSON(),t={service:e.t0,tileInfoJSON:e.t1},r=[],Array.isArray(t.service.source)&&(r=t.service.source),e.prev=7,e.next=10,this._workerProxy.pipeline.onAttach(t,{transferList:r});case 10:this._workerAttached.resolve(),e.next=16;break;case 13:e.prev=13,e.t2=e.catch(7),this._workerAttached.reject((0,I.zE)()),(0,I.H9)(e.t2);case 16:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_detachProxy",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._workerProxy.pipeline.onDetach());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWorker",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._workerAttached.promise;case 2:return e.abrupt("return",this._workerProxy);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasAllFeatures",get:function(){return this.layer.visible&&this.eventLog.hasAllFeatures}},{key:"hasAllFeaturesInView",get:function(){return this.layer.visible&&this.eventLog.hasAllFeaturesInView}},{key:"hasFullGeometries",get:function(){return this.layer.visible&&this.eventLog.hasFullGeometries}},{key:"labelingCollisionInfos",get:function(){var e=this,t=this.layerAdapter.getLabelingDeconflictionInfo(this.view),r=this.layer.geometryType,n=!this.suspended;return t.map((function(t){var i=t.vvEvaluators,a=t.deconflictionEnabled;return{container:e.featureContainer,vvEvaluators:i,deconflictionEnabled:a,geometryType:r,visible:n}}))}},{key:"layerAdapter",get:function(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new er(this.layer):new Xt(this.layer);case"geojson":case"csv":case"wfs":return new er(this.layer);case"subtype-group":return new pr(this.layer);case"ogc-feature":return new rr(this.layer);case"stream":return new ir(this.layer);case"oriented-imagery":return new nr(this.layer);case"knowledge-graph-sublayer":return new tr(this.layer);case"catalog-footprint":return new Gt(this.layer);default:(0,_.Bg)(this.layer)}return null}},{key:"timeExtent",get:function(){var e;return(0,q.h)(this.layerAdapter.timeOptions,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}},{key:"getDisplayStatistics",value:function(e,t){var r;return null===(r=this.featureContainer)||void 0===r?void 0:r.getDisplayStatistics(e,t)}},{key:"queryHeatmapStatistics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return e.abrupt("return",e.sent.pipeline.queryHeatmapStatistics(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"highlight",value:function(e){var t,r,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"highlight";e instanceof p.Z?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:x.Z.isCollection(e)&&e.length>0?r=e.map((function(e){return null===e||void 0===e?void 0:e.getObjectId()})).toArray():Array.isArray(e)&&e.length>0&&(r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((function(e){return null===e||void 0===e?void 0:e.getObjectId()})));var a=null===(t=r)||void 0===t?void 0:t.filter(S.pC);return null!==a&&void 0!==a&&a.length?(this._addHighlights(a,i),(0,w.kB)((function(){return n._removeHighlights(a,i)}))):(0,w.kB)()}},{key:"getHighlightIds",value:function(){return Array.from(this._highlightCounter.ids())}},{key:"hasHighlight",value:function(){return!this._highlightCounter.empty}},{key:"hitTest",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,u,o,l,c,d,f=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.featureContainer.hitTest(r);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,this.getWorker();case 7:return i=e.sent,e.next=10,i.pipeline.getDisplayFeatures(n);case 10:return u=e.sent,o=u.features,l=u.aggregates,c=this.featureContainer.getSortKeys(n),d=function(e,t){var r=e.displayId,n=t.displayId;return c.has(r)&&c.has(n)?c.get(r)-c.get(n):r-n},e.abrupt("return",(o.sort(d).reverse(),l.sort(d).reverse(),[].concat((0,a.Z)(l.map((function(e){return f._createGraphicHit(t,g.fromJSON(e))}))),(0,a.Z)(o.map((function(e){return f._createGraphicHit(t,p.Z.fromJSON(e))}))))));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryStatistics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return t=e.sent,e.abrupt("return",(0,vr.Y)(t.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"querySummaryStatistics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return a=e.sent,u=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),o=a.features.executeQueryForSummaryStatistics(this._cleanUpQuery(t),u,n),e.abrupt("return",(0,vr.Y)(o,{}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateSummaryStatistics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),e.next=3,this.getWorker();case 3:return u=e.sent.aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(t),a,n),e.abrupt("return",(0,vr.Y)(u,{}));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryUniqueValues",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return a=e.sent,u=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),o=a.features.executeQueryForUniqueValues(this._cleanUpQuery(t),u,n),e.abrupt("return",(0,vr.Y)(o,{uniqueValueInfos:[]}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateUniqueValues",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return a=e.sent,u=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),o=a.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(t),u,n),e.abrupt("return",(0,vr.Y)(o,{uniqueValueInfos:[]}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryClassBreaks",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return a=e.sent,u=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),o=a.features.executeQueryForClassBreaks(this._cleanUpQuery(t),u,n),e.abrupt("return",(0,vr.Y)(o,{classBreakInfos:[]}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateClassBreaks",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return a=e.sent,u=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),o=a.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(t),u,n),e.abrupt("return",(0,vr.Y)(o,{classBreakInfos:[]}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryHistogram",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return a=e.sent,u=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),o=a.features.executeQueryForHistogram(this._cleanUpQuery(t),u,n),e.abrupt("return",(0,vr.Y)(o,{bins:[],maxValue:null,minValue:null,normalizationTotal:null}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryAggregateHistogram",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return a=e.sent,u=(0,i.Z)((0,i.Z)({},r),{},{scale:this.view.scale}),o=a.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(t),u,n),e.abrupt("return",(0,vr.Y)(o,{bins:[],maxValue:null,minValue:null,normalizationTotal:null}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=U.Z.fromJSON(e);return t.features.forEach((function(e){return r._setLayersForFeature(e)})),t}))}},{key:"queryVisibleFeatures",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.pipeline.queryVisibleFeatures(this._cleanUpQuery(t),r),e.next=5,(0,vr.Y)(n,{features:[]});case 5:return i=e.sent,a=U.Z.fromJSON(i),e.abrupt("return",(a.features.forEach((function(e){return u._setLayersForFeature(e)})),a));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregates",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.aggregates.executeQuery(this._cleanUpAggregateQuery(t),r),e.next=5,(0,vr.Y)(n,{features:[]});case 5:return i=e.sent,a=L.fromJSON(i),e.abrupt("return",(a.features.forEach((function(e){return u._setLayersForFeature(e)})),a));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregateIds",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.aggregates.executeQueryForIds(this._cleanUpAggregateQuery(t),r),e.abrupt("return",(0,vr.Y)(n,[]));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregateCount",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.aggregates.executeQueryForCount(this._cleanUpAggregateQuery(t),r),e.abrupt("return",(0,vr.Y)(n,0));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryAggregateJSON",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.aggregates.executeQuery(this._cleanUpAggregateQuery(t),r),e.abrupt("return",(0,vr.Y)(n,{features:[]}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.features.executeQuery(this._cleanUpQuery(t),r),e.abrupt("return",(0,vr.Y)(n,{features:[]}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.features.executeQueryForIds(this._cleanUpQuery(t),r),e.abrupt("return",(0,vr.Y)(n,[]));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.features.executeQueryForCount(this._cleanUpQuery(t),r),e.abrupt("return",(0,vr.Y)(n,0));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return n=e.sent.features.executeQueryForExtent(this._cleanUpQuery(t),r),e.next=5,(0,vr.Y)(n,{count:0,extent:null});case 5:return i=e.sent,e.abrupt("return",{count:i.count,extent:Zr.Z.fromJSON(i.extent)});case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSampleFeatures",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return e.abrupt("return",e.sent.pipeline.getSampleFeatures(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._subscriptionManager){this.view.animation&&!this._lastTargetState&&(this._lastTargetState=e.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null);var t=this._subscriptionManager.update(e.targetState,this._lastTargetState);this.featureContainer.setVisibleTiles(t)}}},{key:"attach",value:function(){var e=this;(0,y.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),(0,I.R8)(this._updatingHandles.addPromise(this._workerAttached.promise)),(0,I.R8)(this._attachProxy()),this.featureContainer=new de(this),this.container.addChild(this.featureContainer),this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._subscriptionManager=new xr({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:function(t){e.featureContainer.updateSubscriptions(t),(0,I.R8)(e._updatingHandles.addPromise(e.getWorker().then((function(e){return e.pipeline.updateSubscriptions(t)}))))},isDone:function(t){return e.featureContainer.isDone(t)}}),this.requestUpdate(),this.addAttachHandles([(0,F.watch)((function(){return JSON.stringify((0,i.Z)({displayRefreshVersion:e._displayRefreshVersion,timeExtent:e.timeExtent,clips:e.clips,filter:e.filter,featureEffect:e.featureEffect,sourceRefreshVersion:e._sourceRefreshVersion,timeZone:e.view.timeZone,effect:e.featureEffect},e.layerAdapter.getUpdateHashProperties(e.view)))}),(function(){return e._update()}),F.initial),(0,F.watch)((function(){return e.updateSuspended}),(function(t){t||(e._subscriptionManager.resume(),e.view.labelManager.requestUpdate())}))]),"stream"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",(function(t){return e._edit(t)})))}},{key:"detach",value:function(){(0,y.Z)("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._detachProxy(),this._fields=null,this.featureContainer.destroy(),this.featureContainer=null,this._commandsQueue.clear(),this.container.removeAllChildren(),this._subscriptionManager=(0,Z.SC)(this._subscriptionManager),this._workerProxy.pipeline.onDetach(),this._workerAttached=(0,I.hh)(),(0,I.R8)(this._workerAttached.promise),this._lastAvailableFields=[],this._lastSchema=null}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"isUpdating",value:function(){var e="renderer"in this.layer&&null!=this.layer.renderer,t=this._commandsQueue.updateTracking.updating,r=null!=this._updatingRequiredFieldsPromise,i=this.featureContainer.updatingHandles.updating,a=this.updateRequested||e&&(t||r)||i||this._pipelineUpdating||this.dataUpdating;if((0,y.Z)("esri-2d-log-updating")){console.log("Updating FLV2D (".concat(this.layer.id,"): ").concat(a,"\n  -> updateRequested ").concat(this.updateRequested,"\n  -> hasRenderer ").concat(e,"\n  -> updatingRequiredFields ").concat(r,"\n  -> hasPendingCommand ").concat(t,"\n  -> dataUpdating ").concat(this.dataUpdating,"\n  -> processing ").concat(this._pipelineUpdating,"\n  -> updatingContainer ").concat(i,"\n"));var s,u=(0,n.Z)(this.featureContainer.subscriptions());try{for(u.s();!(s=u.n()).done;){var o=s.value;console.log("    -> Tile[".concat(o.id,"] Done: ").concat(o.done))}}catch(l){u.e(l)}finally{u.f()}}return a}},{key:"_createClientOptions",value:function(){var e=this,t=this;return{get container(){return t.featureContainer},setUpdating:function(t){e._set("_pipelineUpdating",t.pipeline),e._set("dataUpdating",t.data)},emitEvent:function(t){e.emit(t.name,t.event)},get eventLog(){return t.eventLog},fetch:function(e){return Promise.all(e.map((function(e){return t.view.stage.painter.textureManager.rasterizeItem(e)})))},fetchDictionary:function(t){return Promise.all(t.map((function(t){return e._fetchDictionaryRequest(t)})))}}}},{key:"_fetchDictionaryRequest",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"subtype-group"!==this.layer.type){e.next=3;break}throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");case 3:if((r=this.layer.renderer)&&"dictionary"===r.type){e.next=6;break}throw new Error("InternalError: Expected layer to have a DictionaryRenderer");case 6:if("dictionary"===(n=this._lastSchema.processor.mesh.factory.symbology).type){e.next=9;break}throw new Error("InternalError: Expected schema to be of type 'dictionary'");case 9:return i={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this.featureContainer.instanceStore,scaleExpression:n.scaleExpression},this._fields||(this._fields=this.layer.fields.map((function(e){return e.toJSON()}))),a=n.visualVariableUniforms,e.next=14,r.getSymbolAsync(t.feature,{fields:this._fields});case 14:if((u=e.sent)&&u.data){e.next=17;break}return e.abrupt("return",{type:"dictionary-response",meshes:[]});case 17:return e.next=19,(0,Ge.$L)(u.data,{uniforms:a,path:"renderer",schemaOptions:i});case 19:return e.t0=e.sent,e.abrupt("return",{type:"dictionary-response",meshes:e.t0});case 23:return e.prev=23,e.t1=e.catch(0),e.abrupt("return",{type:"dictionary-response",meshes:[]});case 26:case"end":return e.stop()}}),e,this,[[0,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_cleanUpQuery",value:function(e){var t=D.Z.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t.toJSON()}},{key:"_cleanUpAggregateQuery",value:function(e){var t,r,i=D.Z.from(e)||this.createAggregateQuery();i.outSpatialReference||(i.outSpatialReference=this.view.spatialReference);var a,s=null!==(t=i.objectIds)&&void 0!==t?t:[],u=(0,n.Z)(null!==(r=i.aggregateIds)&&void 0!==r?r:[]);try{for(u.s();!(a=u.n()).done;){var o=a.value;s.push(o)}}catch(l){u.e(l)}finally{u.f()}return i.objectIds=s,i.aggregateIds=[],i.toJSON()}},{key:"_update",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._commandsQueue.push({type:"update"}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_edit",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.updateSuspended){e.next=2;break}return e.abrupt("return",void this._subscriptionManager.suspend());case 2:return r=this._getEffectiveEdit(t),e.abrupt("return",r?this._commandsQueue.push(r).catch(I.H9):void 0);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"doRefresh",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.attached&&(this.updateSuspended&&t||(t?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"incrementSourceRefreshVersion",value:function(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%Vr+1}},{key:"incrementDisplayRefreshVersion",value:function(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%Vr+1}},{key:"_getEffectiveEdit",value:function(e){var t,r,n,i="globalIdField"in this.layer&&this.layer.globalIdField,a=e.deletedFeatures.some((function(e){return-1===e.objectId||!e.objectId})),s=i&&this.availableFields.includes(i);if(a&&!s)return v.Z.getLogger(this).error(new k.Z("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(i," to be included the layer's outFields for updates to be reflected on the map"))),null;var u=this.layer,o=null!==(t=null===(r=e.historicMoment)||void 0===r?void 0:r.getTime())&&void 0!==t?t:null,l="layerId"in u&&(null===(n=e.editedFeatures)||void 0===n?void 0:n.find((function(e){return e.layerId===u.layerId})));if(l&&this._canEditByFeature(l)){var c=(0,le.oq)(this.layer.geometryType),d=l.editedFeatures,f=d.adds,p=d.deletes,h=d.updates,y=this.layer.objectIdField,m=f.map((function(e){return(0,T.XA)(e,c,false,false)})),b=h.map((function(e){return(0,T.XA)(e.current,c,false,false)}));return{type:"edit-by-feature",added:m,removed:p.map((function(e){return"attributes"in e?{globalId:i?e.attributes[i]:null,objectId:y?e.attributes[y]:null}:e})),updated:b,historicMoment:o}}return{type:"edit-by-id",added:e.addedFeatures,updated:e.updatedFeatures,removed:e.deletedFeatures,historicMoment:o}}},{key:"_canEditByFeature",value:function(e){var t=this,r=e.editedFeatures,n=r.adds,i=r.updates;return n.every((function(e){var r;return t.view.spatialReference.equals(null===(r=e.geometry)||void 0===r?void 0:r.spatialReference)}))&&i.every((function(e){var r;return t.view.spatialReference.equals(null===(r=e.current.geometry)||void 0===r?void 0:r.spatialReference)}))}},{key:"_doUpdate",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,a,u,o,l,c,d,f,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=null===(t=this.layer.featureReduction)||void 0===t?void 0:t.clone(),this._lastFeatureReduction=this.layer.featureReduction),e.prev=1,e.next=4,this._updateRequiredFields();case 4:if(!this.destroyed&&null!==(r=this.layerAdapter)&&void 0!==r&&r.hasRequiredSupport&&this._subscriptionManager){e.next=6;break}return e.abrupt("return");case 6:return a=this.featureContainer.instanceStore,this.featureContainer.attributeView.lockTextureUploads(),a.updateStart(),u=this.featureEffect,o={store:a,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},l=this._createViewSchemaConfig(),e.t0=this.layerAdapter.createSourceSchema(l,this._sourceRefreshVersion),e.next=14,this.layerAdapter.createProcessorSchema(o,l,this._displayRefreshVersion);case 14:if(e.t1=e.sent,c={source:e.t0,processor:e.t1},d=(0,V.R)(null===(n=this._lastSchema)||void 0===n?void 0:n.source.mutable,c.source.mutable)||(0,V.R)(null===(i=this._lastSchema)||void 0===i?void 0:i.processor,c.processor)){e.next=19;break}return e.abrupt("return",(this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),a.updateEnd(),void(this.featureEffectView.featureEffect=u)));case 19:return this._lastSchema=c,this._fields=null,f=Math.round(performance.now()),(0,y.Z)("esri-2d-update-debug")&&console.debug("Id[".concat(this.layer.uid,"] Version[").concat(f,"] FeatureLayerView2D._doUpdate"),{changes:d}),e.next=24,this.getWorker();case 24:return p=e.sent,e.next=27,p.pipeline.updateSchema(c,f);case 27:a.updateEnd(),this.featureEffectView.featureEffect=u,this.featureEffectView.endTransitions(),this.featureContainer.attributeView.unlockTextureUploads(),this.featureContainer.swapRenderState(),this.featureContainer.requestRender(),(0,y.Z)("esri-2d-update-debug")&&console.debug("Version[".concat(f,"] FeatureLayerView2D.updateEnd")),this.requestUpdate(),e.next=40;break;case 37:e.prev=37,e.t2=e.catch(1),(0,y.Z)("esri-2d-update-debug")&&console.error("Encountered an error during update",e.t2);case 40:case"end":return e.stop()}}),e,this,[[1,37]])})));return function(){return e.apply(this,arguments)}}()},{key:"_doEdit",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getWorker();case 2:return r=e.sent,e.prev=3,this.featureContainer.editStart(),e.next=7,r.pipeline.onEdits(t);case 7:this.featureContainer.editEnd(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),(0,I.D_)(e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"hasFilter",get:function(){var e,t,r,n=null!==(e=null===(t=(r=this.layerAdapter).hasFilters)||void 0===t?void 0:t.call(r,this.view))&&void 0!==e&&e;return null!=this.filter||null!=this.timeExtent||this._visibilityOverrides.size>0||n}},{key:"_getEffectiveAvailableFields",value:function(e){var t=function(e,t){var r=new Set;return e&&e.forEach((function(e){return r.add(e)})),t&&t.forEach((function(e){return r.add(e)})),r.has("*")?["*"]:Array.from(r)}(this._lastAvailableFields,e);return this._lastAvailableFields=t,(0,M.TK)(this.layer.fieldsIndex,t)}},{key:"_createViewSchemaConfig",value:function(){var e,t,r,n=[Fr(this.view,this.layerAdapter,this.timeExtent,this._visibilityOverrides,this.filter),null!==(e=null===(t=this.featureEffect)||void 0===t||null===(r=t.filter)||void 0===r?void 0:r.toJSON())&&void 0!==e?e:null];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),filters:n,scale:this.view.scale,timeZone:this.view.timeZone}}},{key:"_addHighlights",value:function(e,t){this._highlightCounter.addReason(e,t),this._commandsQueue.push({type:"highlight"})}},{key:"_removeHighlights",value:function(e,t){this._highlightCounter.deleteReason(e,t),this._commandsQueue.push({type:"highlight"})}},{key:"_updateHighlights",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,i,a,u,o,l,c,d=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=(0,n.Z)(this._highlightCounter.ids());try{for(r.s();!(i=r.n()).done;)a=i.value,u=this._highlightCounter.getHighlightReason(a),o=(0,J.ck)(u),t.push({objectId:a,highlightFlags:o})}catch(s){r.e(s)}finally{r.f()}return e.next=5,this.getWorker();case 5:if(l=e.sent,!this.destroyed){e.next=8;break}return e.abrupt("return");case 8:c=l.pipeline.updateHighlight({highlights:t}).catch((function(e){(0,I.D_)(e)||v.Z.getLogger(d).error(e)})),this._updatingHandles.addPromise(c);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setLayersForFeature",value:function(e){e.layer=e.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin&&this.layerAdapter.setGraphicOrigin(e)}},{key:"_createGraphicHit",value:function(e,t){return this._setLayersForFeature(t),null!=t.geometry&&(t.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:t,layer:this.layer,mapPoint:e}}}]),r}((0,_r.Z)((0,wr.Z)((0,j.y)(kr.Z))));function Fr(e,t,r,n,i){var a,s,u,o,l,c;i&&(i=i.clone());var d=null!=i?i.timeExtent:null,f=null!=r&&null!=d?r.intersection(d):r||d;f&&(null!==(a=i)&&void 0!==a||(i=new O.Z),i.timeExtent=f);var p=null!==(o=null===(l=i=null!==(s=null===(u=t.addFilters)||void 0===u?void 0:u.call(t,i,e))&&void 0!==s?s:i)||void 0===l?void 0:l.toJSON())&&void 0!==o?o:null;return n.size&&(null!==(c=p)&&void 0!==c||(p=(new O.Z).toJSON()),p.hiddenIds=Array.from(n)),p}(0,f._)([(0,h.Cb)()],Ir.prototype,"_commandsQueue",void 0),(0,f._)([(0,h.Cb)()],Ir.prototype,"_sourceRefreshVersion",void 0),(0,f._)([(0,h.Cb)()],Ir.prototype,"_displayRefreshVersion",void 0),(0,f._)([(0,h.Cb)({readOnly:!0})],Ir.prototype,"_pipelineUpdating",void 0),(0,f._)([(0,h.Cb)({readOnly:!0})],Ir.prototype,"hasAllFeatures",null),(0,f._)([(0,h.Cb)({readOnly:!0})],Ir.prototype,"hasAllFeaturesInView",null),(0,f._)([(0,h.Cb)({readOnly:!0})],Ir.prototype,"hasFullGeometries",null),(0,f._)([(0,h.Cb)()],Ir.prototype,"featureEffectView",void 0),(0,f._)([(0,h.Cb)()],Ir.prototype,"labelingCollisionInfos",null),(0,f._)([(0,h.Cb)()],Ir.prototype,"layerAdapter",null),(0,f._)([(0,h.Cb)({readOnly:!0})],Ir.prototype,"timeExtent",null),(0,f._)([(0,h.Cb)()],Ir.prototype,"updating",void 0);var Er=Ir=(0,f._)([(0,m.j)("esri.views.2d.layers.FeatureLayerView2D")],Ir)},74184:function(e,t,r){function n(e,t){var r=e.featureReduction;return r&&"selection"!==r.type&&(!("maxScale"in r)||!r.maxScale||r.maxScale<t.scale)?r:null}r.d(t,{g:function(){return n}})},35092:function(e,t,r){function n(e,t,r,n){var i=e.clone(),a=1<<i.level,s=i.col+t,u=i.row+r;return n&&s<0?(i.col=s+a,i.world-=1):s>=a?(i.col=s-a,i.world+=1):i.col=s,i.row=u,i}r.d(t,{M:function(){return n}})},16547:function(e,t,r){r.d(t,{i:function(){return u}});var n=r(37762),i=r(15671),a=r(43144),s=r(8841),u=function(){function e(){(0,i.Z)(this,e),this._idToCounters=new Map}return(0,a.Z)(e,[{key:"empty",get:function(){return 0===this._idToCounters.size}},{key:"addReason",value:function(e,t){var r,i=(0,n.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=this._idToCounters.get(a);s||(s=new Map,this._idToCounters.set(a,s)),s.set(t,(s.get(t)||0)+1)}}catch(u){i.e(u)}finally{i.f()}}},{key:"deleteReason",value:function(e,t){var r,i=(0,n.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=this._idToCounters.get(a);if(s){var u=s.get(t);if(null==u)return;--u>0?s.set(t,u):s.delete(t),0===s.size&&this._idToCounters.delete(a)}}}catch(o){i.e(o)}finally{i.f()}}},{key:"getHighlightReason",value:function(e){var t=this._idToCounters.get(e);if(!t)return null;var r,i=null,a=(0,n.Z)(s.Oo);try{for(a.s();!(r=a.n()).done;){var u=r.value;t.get(u)&&(i=u)}}catch(o){a.e(o)}finally{a.f()}return i||null}},{key:"ids",value:function(){return this._idToCounters.keys()}}]),e}()},62862:function(e,t,r){r.d(t,{Y:function(){return a}});var n=r(74165),i=r(15861);function a(e,t){return s.apply(this,arguments)}function s(){return s=(0,i.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t;case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),"no-queryEngine"===e.t0.name){e.next=10;break}throw e.t0;case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,null,[[0,6]])}))),s.apply(this,arguments)}},24405:function(e,t,r){r.d(t,{V5:function(){return l},e7:function(){return u},zc:function(){return c}});var n=r(74165),i=r(93433),a=r(15861),s=r(37270);function u(e){return o.apply(this,arguments)}function o(){return o=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,u,o,l,c,d,f,p,h,y,v=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(u=v.length>1&&void 0!==v[1]?v[1]:t.popupTemplate)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,u.getRequiredFields(t.fieldsIndex);case 5:if(o=e.sent,l=u.lastEditInfoEnabled,c=t.objectIdField,d=t.typeIdField,f=t.globalIdField,p=t.relationships,!o.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:return h=l?(0,s.CH)(t):[],y=(0,s.Q0)(t.fieldsIndex,[].concat((0,i.Z)(o),(0,i.Z)(h))),e.abrupt("return",(d&&y.push(d),y&&c&&null!==(r=t.fieldsIndex)&&void 0!==r&&r.has(c)&&!y.includes(c)&&y.push(c),y&&f&&null!==(a=t.fieldsIndex)&&void 0!==a&&a.has(f)&&!y.includes(f)&&y.push(f),p&&p.forEach((function(e){var r,n=e.keyField;y&&n&&(null===(r=t.fieldsIndex)||void 0===r?void 0:r.has(n))&&!y.includes(n)&&y.push(n)})),y));case 15:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function l(e,t){return e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&null!=e.defaultPopupTemplate?e.defaultPopupTemplate:null}function c(e,t){return null!=l(e,{defaultPopupTemplateEnabled:t})}}}]);
//# sourceMappingURL=38848.ae15e65c.chunk.js.map