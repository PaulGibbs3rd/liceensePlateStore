"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[89290],{25810:function(e,t,n){n.d(t,{Z:function(){return g}});var i=n(43144),a=n(15671),r=n(60136),o=n(29388),s=n(27366),l=(n(59486),n(48805)),u=n(11582),c=n(17768),d=n(46784),p=n(49861),f=n(89125),v=(n(84936),n(93169),n(69912)),h=n(25243),m=n(848),y=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="length",i.startPoint=null,i.endPoint=null,i.measureType=l.n.Direct,i.offset=0,i.orientation=0,i}return(0,i.Z)(n)}((0,d.eC)(u.j));(0,s._)([(0,p.Cb)({type:["length"],json:{write:{isRequired:!0}}})],y.prototype,"type",void 0),(0,s._)([(0,p.Cb)({type:m.Z,json:{write:!0}})],y.prototype,"startPoint",void 0),(0,s._)([(0,p.Cb)({type:m.Z,json:{write:!0}})],y.prototype,"endPoint",void 0),(0,s._)([(0,p.Cb)({type:l.V,nonNullable:!0,json:{write:{isRequired:!0}}})],y.prototype,"measureType",void 0),(0,s._)([(0,p.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],y.prototype,"offset",void 0),(0,s._)([(0,p.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,f.p)((function(e){return c.BV.normalize((0,h.q9)(e),0,!0)}))],y.prototype,"orientation",void 0);var g=y=(0,s._)([(0,v.j)("esri.analysis.LengthDimension")],y)},48805:function(e,t,n){var i;n.d(t,{V:function(){return a},n:function(){return i}}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));var a=[i.Horizontal,i.Vertical,i.Direct]},32500:function(e,t,n){n.d(t,{I:function(){return w},b:function(){return M}});var i,a,r,o,s=n(30168),l=n(37081),u=n(33280),c=n(94951),d=n(15226),p=n(26461),f=n(116),v=n(41012),h=n(58406),m=n(98634),y=n(64201),g=n(19253),_=n(25920),S=n(4760);function M(e){var t=new y.kG,n=t.vertex,M=t.fragment;return(0,v.Sv)(n,e),t.include(c.w,e),t.attributes.add(S.T.POSITION,"vec3"),t.attributes.add(S.T.UV0,"vec2"),e.perspectiveInterpolation&&t.attributes.add(S.T.PERSPECTIVEDIVIDE,"float"),t.varyings.add("vpos","vec3"),e.multipassEnabled&&t.varyings.add("depth","float"),n.code.add((0,m.H)(i||(i=(0,s.Z)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0;\n      gl_Position = transformPosition(proj, view, vpos);\n\n      ","\n    }\n  "])),e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":"")),t.include(u.f5,e),t.include(d.l,e),M.uniforms.add(new g.A("tex",(function(e){return e.texture})),new h.p("opacity",(function(e){return e.opacity}))),t.varyings.add("vTexCoord","vec2"),e.transparencyPassType===_.A.ColorAlpha&&(t.outputs.add("fragColor","vec4",0),t.outputs.add("fragAlpha","float",1)),M.include(f.Y),M.code.add((0,m.H)(a||(a=(0,s.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      fragColor = texture(tex, vTexCoord) * opacity;\n\n      if (fragColor.a < ",") {\n        discard;\n      }\n\n      fragColor = highlightSlice(fragColor, vpos);\n      ","\n      ","\n    }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",m.H.float(p.F),e.transparencyPassType===_.A.ColorAlpha?(0,m.H)(r||(r=(0,s.Z)(["\n              fragColor = premultiplyAlpha(fragColor);\n              fragAlpha = fragColor.a;"]))):"",e.output===l.H_.ObjectAndLayerIdColor?(0,m.H)(o||(o=(0,s.Z)(["\n              fragColor = vec4(0,0,0,1);"]))):"")),t}var w=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}))},97942:function(e,t,n){function i(e){var t,n,i=[],r=!1;return function(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return r&&t===this&&a(s,i)||(n=e.apply(this,s),t=this,i=s,r=!0),n}}function a(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}n.d(t,{H:function(){return i}})},89290:function(e,t,n){n.r(t),n.d(t,{default:function(){return ln}});var i,a=n(74165),r=n(15861),o=n(15671),s=n(43144),l=n(60136),u=n(29388),c=n(27366),d=n(7138),p=n(42537),f=(n(93169),n(32718)),v=n(92026),h=n(94172),m=n(49861),y=(n(84936),n(69912)),g=n(98074),_=n(48805),S=n(68860),M=n(74177),w=n(29439),b=n(16889),C=n(47898),P=n(29134),Z=n(7025),k=n(32035),D=n(12400),T=n(14320),O=n(51378),A=n(55946),x=n(37818),I=n(9052),z=n(59418),R=n(4914),H=n(47072);function E(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint,i=e.dimension;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i.offset,measureType:i.measureType,orientation:i.orientation}}function G(e,t){var n,i,a,r=e.elevationAlignedStartPoint,o=e.elevationAlignedEndPoint,s=e.offset,l=e.measureType,u=e.orientation,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==r||null==o)return null;var d=L(null!==(n=null===c||void 0===c?void 0:c.directSegment)&&void 0!==n?n:new I.y,{elevationAlignedStartPoint:r,elevationAlignedEndPoint:o},t),p=null!==(i=null===c||void 0===c?void 0:c.primaryOffsetAxis)&&void 0!==i?i:(0,D.Ue)();W(p,{measureType:l,elevationAlignedStartPoint:r,elevationAlignedEndPoint:o,directSegment:d,orientation:u,renderCoordsHelper:t});var f=null!==(a=null===c||void 0===c?void 0:c.dimensionSegment)&&void 0!==a?a:new I.y;return B({elevationAlignedStartPoint:r,elevationAlignedEndPoint:o})&&l===_.n.Vertical?((0,k.c)(f.startRenderSpace,d.startRenderSpace),(0,k.c)(f.endRenderSpace,d.endRenderSpace)):Y(f,{offsetAxis:p,offset:s,relativeToSegment:d,renderCoordsHelper:t}),{elevationAlignedStartPoint:r,elevationAlignedEndPoint:o,directSegment:d,dimensionSegment:f,primaryOffsetAxis:p,spatialReference:t.spatialReference}}function N(e,t,n,a){return t===i.Start?((0,k.c)(e.startRenderSpace,n.startRenderSpace),(0,k.c)(e.endRenderSpace,a.startRenderSpace)):((0,k.c)(e.startRenderSpace,n.endRenderSpace),(0,k.c)(e.endRenderSpace,a.endRenderSpace)),e}function j(e,t,n,i){switch(t){case _.n.Direct:return L(e,n,i);case _.n.Horizontal:case _.n.Vertical:var a,r=n.elevationAlignedStartPoint,o=n.elevationAlignedEndPoint,s=n.dimension,l=n.geometry;s.measureType===_.n.Direct?(a=function(e,t){var n=e.directSegment.eval(.5,O.WM.get()),i=t.worldUpAtPosition(n,O.WM.get()),a=e.dimensionSegment.eval(.5,O.WM.get()),r=(0,k.z)(O.WM.get(),a,n);return!(0,k.G)(r,D.AG)&&(0,k.m)(r,i)>0}(l,i)===r.z>o.z,t===_.n.Horizontal&&(a=!a)):a=!function(e){var t=e.dimensionSegment,n=t.startRenderSpace,i=t.endRenderSpace,a=e.directSegment,r=a.startRenderSpace,o=a.endRenderSpace;return(0,k.w)(r,n)<(0,k.w)(o,i)}(l);var u=a?[r,o]:[o,r],c=(0,w.Z)(u,2),d=c[0],p=c[1],f=(0,x.WG)(p,U);return t===_.n.Horizontal?f.z=d.z:(f.x=d.x,f.y=d.y),i.toRenderCoords(d,e.startRenderSpace),i.toRenderCoords(f,e.endRenderSpace),e}}function L(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(i||(i={}));var U=(0,A.T)(0,0,0,null);var V=new I.y;function W(e,t){var n=t.measureType,i=t.elevationAlignedStartPoint,a=t.elevationAlignedEndPoint,r=t.directSegment,o=r.startRenderSpace,s=r.endRenderSpace,l=t.directSegment,u=t.renderCoordsHelper,c=l.eval(.5,O.WM.get()),d=u.worldUpAtPosition(c,O.WM.get()),p=u.worldBasisAtPosition(c,T.R.Y,O.WM.get());switch(n){case _.n.Horizontal:(0,k.c)(e,d);break;case _.n.Vertical:(0,k.m)(o,d)<(0,k.m)(s,d)?(0,k.z)(e,s,o):(0,k.z)(e,o,s),(0,k.b)(e,e,d),(0,k.b)(e,e,d);break;case _.n.Direct:var f,v=null!==(f=t.orientation)&&void 0!==f?f:0;if(B({elevationAlignedStartPoint:i,elevationAlignedEndPoint:a}))(0,P.Us)(F,-(0,b.Vl)(v),d),(0,k.h)(e,p,F);else{var h=(0,k.z)(O.WM.get(),s,o),m=(0,k.b)(O.WM.get(),h,d);(0,k.b)(m,m,h),(0,P.Us)(F,(0,b.Vl)(v),h),(0,k.h)(e,m,F)}}return(0,k.G)(e,D.AG)?(0,k.c)(e,p):(0,k.n)(e,e)}var F=(0,Z.Ue)();function B(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint;return null!=t&&null!=n&&t.x===n.x&&t.y===n.y}function Y(e,t){var n=t.offsetAxis,i=t.offset,a=t.relativeToSegment,r=a.startRenderSpace,o=a.endRenderSpace,s=t.relativeToSegment,l=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=(0,k.m)(t,n),r=(0,k.m)(e,n),o=Math.abs(a-r)+i;return a>r?[o,i]:[i,o]}(r,o,n,i/t.renderCoordsHelper.unitInMeters),u=(0,w.Z)(l,2),c=u[0],d=u[1];return(0,k.r)(e.startRenderSpace,s.startRenderSpace,n,c),(0,k.r)(e.endRenderSpace,s.endRenderSpace,n,d),e}function Q(e,t,n){var i=t.directSegment.eval(.5,O.WM.get());return n.worldUpAtPosition(i,e)}function X(e,t){var n=t.directSegment,i=n.startRenderSpace,a=n.endRenderSpace;return(0,k.z)(e,a,i)}function q(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1},i=t.dimensionSegment,a=i.startRenderSpace,r=i.endRenderSpace;return n.invert?(0,k.z)(e,a,r):(0,k.z)(e,r,a)}function J(e,t){var n=e.directSegment.eval(.5,O.WM.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}var K=(0,D.Ue)();function $(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint;if(null==t||null==n)return!1;var i=(0,R.Z1)(t,n);return null!=i&&(0,C.nn)(i,"meters").value>H.Yo}function ee(e){return null!=e.geometry}var te=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){return(0,o.Z)(this,n),t.call(this,e)}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this,t=(0,h.mapCollection)((function(){return e.analysisViewData.computations}),(function(t){var n=t.computation;return e._watchComputation(n)}));this.addHandles((0,p.ed)(t))}},{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"_defaultUnit",get:function(){return(0,M.R)(this.view)}},{key:"_watchComputation",value:function(e){var t=this;return(0,h.watch)((function(){return E(e)}),(function(n){var i=n.measureType;if($(n)&&i!==_.n.Direct){var a=Math.round((0,S.En)(H.Yo,"meters","kilometers"));return f.Z.getLogger(t).warnOnce("A ".concat(i," dimension in the analysis (id: '").concat(t.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(a,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}var r=G(n,t.view.renderCoordsHelper,e.geometry);e.geometry=r,e.result.length=function(e,t,n){if(null==e)return null;var i;if(t===_.n.Horizontal)i=(0,z.Qw)(e.elevationAlignedStartPoint,e.elevationAlignedEndPoint);else{var a=e.dimensionSegment,r=a.startRenderSpace,o=a.endRenderSpace;i=(0,R.FN)(r,o,e.spatialReference)}if(null==i)return null;var s=t===_.n.Vertical?(0,S.yv)(i.value,i.unit,n):(0,S.wd)(i.value,i.unit,n);return(0,C.nn)(i,s)}(r,i,t._defaultUnit)}),h.syncAndInitial)}}]),n}(d.default);(0,c._)([(0,m.Cb)({constructOnly:!0})],te.prototype,"analysisViewData",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],te.prototype,"view",void 0),(0,c._)([(0,m.Cb)()],te.prototype,"analysis",null),(0,c._)([(0,m.Cb)()],te.prototype,"_defaultUnit",null),te=(0,c._)([(0,y.j)("esri.views.3d.analysis.Dimension.DimensionController")],te);n(59486);var ne=n(84702),ie=n(93433),ae=n(97326),re=n(1413),oe=n(88301),se=n(61120),le=n(37762),ue=n(51995),ce=n(17768),de=n(17842),pe=n(86361),fe=n(55652),ve=n(86950);function he(e){return(0,ve.G)(e.accentColor,.5)}var me=new ue.Z([127,127,127,.5]),ye=n(35284),ge=n(83639),_e=n(40508),Se=n(51328),Me=n(2522),we=n(91526),be=n(40779),Ce=n(70619),Pe=n(56529),Ze=n(4760),ke=n(66156),De=n(58901),Te=n(74229),Oe=n(99034),Ae=n(848),xe=function(){function e(t){(0,o.Z)(this,e),this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}return(0,s.Z)(e,[{key:"manipulatorName",value:function(e){var t=this;return Object.keys(this).find((function(n){return t.hasOwnProperty(n)&&e===t[n]}))}},{key:"values",value:function(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}},{key:"forEachMeasureTypeManipulator",value:function(e){var t,n=(0,le.Z)(_.V);try{for(n.s();!(t=n.n()).done;){var i=t.value;e(this.manipulatorForMeasureType(i),i)}}catch(a){n.e(a)}finally{n.f()}}},{key:"manipulatorForMeasureType",value:function(e){switch(e){case _.n.Direct:return this.direct;case _.n.Horizontal:return this.horizontal;case _.n.Vertical:return this.vertical}}}]),e}(),Ie=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e,i){var a;(0,o.Z)(this,n);var r=(0,ge.EA)(ue.Z.toUnitRGBA(he(e.effectiveTheme))),s=[new _e.r((0,Ce.PI)(r,1,32,32),tt)];return(a=t.call(this,{view:e,renderObjects:s,metadata:i.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}))._themeHandle=(0,h.watch)((function(){return{color:ue.Z.toUnitRGBA(he(e.effectiveTheme))}}),(function(e){return r.setParameters(e)})),a}return(0,s.Z)(n,[{key:"destroy",value:function(){this._themeHandle.remove(),(0,oe.Z)((0,se.Z)(n.prototype),"destroy",this).call(this)}}]),n}(ye.Z);var ze=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e,i){var a,r=i.lineSizePt,s=i.material,l=i.metadata;return(0,o.Z)(this,n),(a=t.call(this,{view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:l}))._options={calloutColor:(0,pe.Ue)(),lineSizePt:r,material:s},a._themeHandle=(0,h.watch)((function(){return ue.Z.toUnitRGBA(he(e.effectiveTheme))}),(function(e){a._options.calloutColor=e,$e((0,ae.Z)(a),Re((0,re.Z)((0,re.Z)({},a._options),{},{metadata:a.metadata})))}),h.initial),a}return(0,s.Z)(n,[{key:"update",value:function(e){var t=e.lineSizePt,n=e.material;this._options.lineSizePt=t,this._options.material=n,$e(this,Re((0,re.Z)((0,re.Z)({},this._options),{},{metadata:this.metadata})))}},{key:"destroy",value:function(){this._themeHandle.remove(),(0,oe.Z)((0,se.Z)(n.prototype),"destroy",this).call(this)}}]),n}(ye.Z);function Re(e){var t=e.calloutColor,n=e.lineSizePt,i=e.material,a=e.metadata;return{calloutLength:.25*Me.M_*.8*(0,de.F2)(n)+18,calloutColor:t,calloutWidth:2,customStateMask:tt,discScale:.3,focusMultiplier:2,material:i,metadata:a}}function He(e,t){var n=t.computation,i=t.view;return[(0,Te.Xd)(e,(function(e,t,a){Ee({cancel:a,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(function(e){!function(e,t,n){var i=t.dimension,a=t.geometry;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if(null==a)return;var r=n.renderCoordsHelper,o=G((0,re.Z)((0,re.Z)({},E(t)),{},{orientation:90}),r),s=G((0,re.Z)((0,re.Z)({},E(t)),{},{orientation:270}),r);if(null==o||null==s)return;var l=J(o,r),u=J(s,r),c=je(a,n),d=ce.BV.shortestSignedDiff(c,l),p=ce.BV.shortestSignedDiff(c,u);i.orientation=Math.abs(d)<Math.abs(p)?90:270,e.stopPropagation()}(e,n,i)}))]}function Ee(e){var t,n,i=e.cancel,a=e.computation,r=e.settingHeading,o=e.steps,s=e.view;if(ee(a)){var l=s.renderCoordsHelper,u=a.dimension,c=a.geometry,d=(0,D.Ue)(),p=Qe((0,D.Ue)(),c,c.directSegment,l),f=Xe(O.WM.get(),{forHeading:r,geometry:c,renderCoordsHelper:l}),v=(0,fe.Yq)(p,f,(0,fe.Ue)()),h=r?null!==(t=u.orientation)&&void 0!==t?t:J(c,s.renderCoordsHelper):null!==(n=u.orientation)&&void 0!==n?n:0;o.next((0,Se._N)(s,v)).next((function(e){"start"===e.action&&(0,k.c)(d,e.renderStart);var t=(0,fe.st)(v),n=(0,ge.Gd)(d,e.renderEnd,p,t),i=h-(0,b.BV)(n);r||(i=function(e){var t=ce.BV.normalize(e)%90;return t<5?e-t:90-t<5?e+(90-t):e}(i)),u.orientation=i})),i.next((0,Te.di)(u,["orientation"]))}}function Ge(e,t){var n=t.computation,i=t.manipulatorMeasureType,a=t.view,r=_.n.Direct,o=0,s=0;return[e.events.on("grab-changed",(function(t){if("start"===t.action&&ee(n)){var l=n.dimension,u=n.geometry;r=l.measureType,o=l.offset,s=l.orientation;var c=(0,k.c)(O.WM.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){var a=n.directSegment,r=W(O.WM.get(),{measureType:t,directSegment:a,renderCoordsHelper:i}),o=Y(V,{offsetAxis:r,offset:0,relativeToSegment:a,renderCoordsHelper:i}).eval(.5,O.WM.get()),s=(0,k.z)(O.WM.get(),e,o);return(0,k.m)(s,r)*i.unitInMeters}(c,i,u,a.renderCoordsHelper),l.orientation=0}})),(0,Te.Xd)(e,(function(e,t,l){if(ee(n)){var u=n.geometry,c=n.dimension,d=a.renderCoordsHelper,p=j(rt,i,n,d),f=W(O.WM.get(),{measureType:i,directSegment:u.directSegment,renderCoordsHelper:d}),v=(0,Se.J4)(e);t.next(v).next(Ne(a,c,p,f)),l.next(v).next((function(e){return c.measureType=r,c.offset=o,c.orientation=s,e}))}}))]}function Ne(e,t,n,i){var a=(0,k.f)(O.WM.get(),n.endRenderSpace,n.startRenderSpace);(0,k.b)(a,a,i);var r,o=(0,fe.Yq)(n.startRenderSpace,a,(0,fe.Ue)()),s=(0,fe.Yq)(n.startRenderSpace,i,(0,fe.Ue)()),l=t.offset,u=0,c=new Te.hM;return c.next((0,Se._N)(e,o)).next((function(n){"start"===n.action&&(u=(0,fe.jH)(s,n.renderStart));var i=((0,fe.jH)(s,n.renderEnd)-u)*e.renderCoordsHelper.unitInMeters;t.offset=l+i,r=n})),function(e){return c.execute(e),r}}function je(e,t){var n=e.directSegment,i=t.renderCoordsHelper,a=Q(O.WM.get(),e,i),r=X(O.WM.get(),e),o=(0,k.b)(O.WM.get(),r,a),s=t.state.camera.viewForward;(0,k.m)(o,s)>0&&(0,k.j)(o,o,-1);var l=n.eval(.5,O.WM.get());return i.headingAtPosition(l,o)}function Le(e,t,n){var i=t.dimensionSegment,a=t.primaryOffsetAxis,r=q(nt,t),o=(0,k.e)(r,D.AG)?(0,P.yR)(at):(0,ge.Aq)(r,a,D.AG,at),s=Math.max((0,k.l)(r),.1/n.unitInMeters);(0,P.bA)(o,o,(0,k.s)(nt,s,s,s)),e.modelTransform=o,e.renderLocation=i.eval(.5,nt)}function Ue(e,t,n){We(e,t,n,{forHeading:!0})}function Ve(e,t,n){We(e,t,n,{forHeading:!1})}function We(e,t,n,i){var a=i.forHeading,r=t.dimension,o=t.geometry,s=o.primaryOffsetAxis,l=(0,k.j)(Fe,s,r.offset>=0?1:-1),u=Xe(Be,{forHeading:a,geometry:o,renderCoordsHelper:n});(0,k.b)(u,u,l);var c=(0,ge.Aq)(l,u,D.AG,at);e.modelTransform=c,e.renderLocation=Qe(nt,o,o.dimensionSegment,n)}var Fe=(0,D.Ue)(),Be=(0,D.Ue)();function Ye(e,t,n,i){var a=t.geometry,r=j(rt,n,t,i),o=W(nt,{measureType:n,directSegment:a.directSegment,renderCoordsHelper:i}),s=(0,k.z)(it,r.endRenderSpace,r.startRenderSpace),l=(0,ge.Aq)(s,o,D.AG,at),u=(0,k.l)(s);(0,P.bA)(l,l,(0,k.s)(it,u,u,u)),e.modelTransform=l,e.renderLocation=r.eval(.5,it)}function Qe(e,t,n,i){var a=n.startRenderSpace,r=n.endRenderSpace,o=function(e,t){var n=X(qe,e),i=Q(Je,e,t);return(0,k.m)(n,i)>0}(t,i)?a:r;return(0,k.c)(e,o)}function Xe(e,t){var n=t.forHeading,i=t.geometry,a=t.renderCoordsHelper;return n?Q(e,i,a):q(e,i,{invert:!0})}var qe=(0,D.Ue)(),Je=(0,D.Ue)();function Ke(e){return(0,de.F2)(e)+6}function $e(e,t){var n,i,a,r,o,s,l,u=null!==(n=t.material)&&void 0!==n?n:new ke.j({transparent:!0,writeDepth:!1,textureId:null===(i=t.texture)||void 0===i?void 0:i.id,renderOccluded:Pe.yD.Opaque,isDecoration:!0}),c=null!==(a=t.focusMultiplier)&&void 0!==a?a:ge.vQ.focusMultiplier,d=null!==(r=t.calloutLength)&&void 0!==r?r:ge.vQ.calloutLength,p=ge.vQ.discRadius*(null!==(o=t.discScale)&&void 0!==o?o:1),f=p*c,v=function(e,t){var n=[0,1,2,2,3,0];return new be.Z(t,[[Ze.T.POSITION,new we.a([d-e,-e,0,d+e,-e,0,d+e,e,0,d-e,e,0],n,3,!0)],[Ze.T.UV0,new we.a([0,0,1,0,1,1,0,1],n,2,!0)]])},h=null!==(s=t.calloutWidth)&&void 0!==s?s:ge.vQ.calloutWidth,m=new De.U({width:h,color:t.calloutColor,renderOccluded:Pe.yD.OccludeAndTransparent,isDecoration:!0}),y=(0,Ce.rh)(m,[[0,0,0],[d-p,0,0]]),g=(0,Ce.rh)(m,[[0,0,0],[d-f,0,0]]),_=null!==(l=t.customStateMask)&&void 0!==l?l:Oe.jg.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[d,0,0]},e.focusMultiplier=c,e.metadata=t.metadata,e.radius=p,e.renderObjects=[new _e.r(v(p,u),Oe.Q9.Unfocused|_),new _e.r(y,Oe.Q9.Unfocused|_),new _e.r(v(f,u),Oe.Q9.Focused|_),new _e.r(g,Oe.Q9.Focused|_)]}var et,tt=Oe.jg.Custom1,nt=(0,D.Ue)(),it=(0,D.Ue)(),at=(0,Z.Ue)(),rt=new I.y,ot=n(25810),st=n(100),lt=n(84652),ut=n(97942),ct=n(66978),dt=n(46634);function pt(e,t,n){var i=n.constraint,a=n.elevationAlignedStartPoint,r=n.elevationAlignedEndPoint,o=n.unconstrainedGeometry,s=n.view,l=e.dimension,u=e.previousConstraint,c=e.preConstraintProperties;if(null!=a&&null!=r){var d=function(){"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if(null==i)d(),null!=u&&null!=c&&(l.measureType=c.measureType,l.orientation=c.orientation);else switch(l.measureType=_.n.Direct,i){case et.Horizontal:if(i!==u&&(l.orientation=0),"startPoint"in t){var p=t.startPoint;null!=p&&(p.z=r.z),l.startPoint=p}else if("endPoint"in t){var f=t.endPoint;null!=f&&(f.z=a.z),l.endPoint=f}break;case et.Vertical:if(i!==u&&(l.orientation=je(o,s)),"startPoint"in t){var v=t.startPoint;null!=v&&(v.x=r.x,v.y=r.y),l.startPoint=v}else if("endPoint"in t){var h=t.endPoint;null!=h&&(h.x=a.x,h.y=a.y),l.endPoint=h}break;case et.Direct:i!==u&&null!=c&&(l.orientation=c.orientation),d()}e.previousConstraint=i,e.unconstrainedGeometry=o}}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(et||(et={}));var ft=n(11526),vt=n(79311),ht=n(33837),mt=n(27676),yt=n(86700),gt=n(14813),_t=n(84954),St=n(17877),Mt=n(34019),wt=n(80151),bt=n(44270),Ct=n(71040),Pt=n(64674),Zt=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;(0,o.Z)(this,n),(i=t.call(this,e))._stagedDimension=null,i._computationManipulators=new Map,i._computationHandles=new st.Z,i._orientationManipulatorTexture=null,i._updatingHandles=new dt.R,i._getSnappingContext=(0,ut.H)((function(e){return new Mt.N({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new St.c(new _t.XE("point",(0,gt.Y6)(!0,!1,i.view.spatialReference)),i.view.state.viewingMode),visualizer:new vt._})}));var a=e.view;i._snappingManagerResult=(0,bt.u)(a),i.addHandles(i._snappingManagerResult),i._unfocusedOffsetManipulatorMaterial=i._createOffsetManipulatorMaterial(),i._focusedOffsetManipulatorMaterial=i._createOffsetManipulatorMaterial(),i._thinOffsetManipulatorMaterial=i._createOffsetManipulatorMaterial(),i._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,yt.z5)(2)}),i._constraintSnappingIndicator=new ht.r({view:a,attached:!0,width:1,renderOccluded:Pe.yD.OccludeAndTransparent,stipplePattern:(0,yt.z5)(5),isDecoration:!0});var r=ue.Z.toUnitRGBA(me);return i._stagedStartIndicator=new mt.j({view:a,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,color:r,size:10,outlineSize:0,renderOccluded:Pe.yD.OccludeAndTransparent,isDecoration:!0}),i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e,t=this,n=this.view;this._snappingOperation=new Ct.y({view:n});var i=!(null!==(e=n._stage)&&void 0!==e&&e.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new ke.j({transparent:!0,writeDepth:!1,renderOccluded:Pe.yD.Opaque,isDecoration:!0}),this.addHandles((0,h.watch)((function(){return{accentColor:he(n.effectiveTheme),contrastColor:(e=n.effectiveTheme,(0,ve.mj)(e.accentColor))};var e}),(function(e){var a=e.accentColor,r=e.contrastColor,o=t._orientationManipulatorTexture,s=(0,ft.O)(n.textures,{accentColor:a,contrastColor:r,preMultiplyAlpha:i});t._orientationManipulatorMaterial.setParameters({textureId:s.texture.id}),t._orientationManipulatorTexture=s,null===o||void 0===o||o.release();var l=ue.Z.toUnitRGBA(a);t._unfocusedOffsetManipulatorMaterial.setParameters({color:l}),t._focusedOffsetManipulatorMaterial.setParameters({color:l}),t._thinOffsetManipulatorMaterial.setParameters({color:l}),t._constraintSnappingIndicator.color=l}),h.initial));var a=(0,h.mapCollection)((function(){return t.analysisViewData.computations}),(function(e){var n=e.computation;return t._createManipulators(n)}));this.addHandles((0,p.ed)(a)),this.addHandles([(0,h.watch)((function(){return{stagedPoint:t._snappingOperation.stagedPoint,stagedComputation:t._stagedComputation}}),(function(e){var n=e.stagedPoint,i=e.stagedComputation;if(null!=i&&null!=n){var a=(0,x.WG)(n,new Ae.Z);t._applyPointUpdate(i,{endPoint:a})}}),h.sync),(0,h.watch)((function(){return{stagedDimension:t._stagedDimension,selectedComputation:t.analysisViewData.selectedComputation,firstGrabbedManipulator:t.firstGrabbedManipulator}}),(function(e,n){var i=e.stagedDimension,a=e.selectedComputation,r=e.firstGrabbedManipulator;if(i===(null===n||void 0===n?void 0:n.stagedDimension)&&r===(null===n||void 0===n?void 0:n.firstGrabbedManipulator))for(var o=0,s=[a,null===n||void 0===n?void 0:n.selectedComputation];o<s.length;o++){var l=s[o];if(null!=l){var u=t._computationManipulators.get(l);null!=u&&t._updateManipulators(l,u,e)}}else{var c,d=(0,le.Z)(t._computationManipulators);try{for(d.s();!(c=d.n()).done;){var p=(0,w.Z)(c.value,2),f=p[0],v=p[1];t._updateManipulators(f,v,e)}}catch(h){d.e(h)}finally{d.f()}}}),h.syncAndInitial),(0,h.watch)((function(){return t.analysis.style.lineSize}),(function(e){t._updateManipulatorStyle(e)}),h.initial),(0,h.watch)((function(){return t.view.state.camera}),(function(){null!=t._stagedComputation&&t._updateStagedDimensionOffset(t._stagedComputation)})),(0,h.watch)((function(){var e=t._stagedComputation;if(!e)return null;var n=e.elevationAlignedStartPoint,i=(0,D.Ue)();return null!=n&&t.view.renderCoordsHelper.toRenderCoords(n,i)?i:null}),(function(e){null!=e?(t._stagedStartIndicator.vertices=[e],t._stagedStartIndicator.attached=!0):t._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,Pt.Ob)(this,(function(){var e=t._activeComputation,n=t._stagedComputation;if(null==e||null!=n){var i,a=null!==(i=t.view.inputManager.latestPointerType)&&void 0!==i?i:"mouse",r=t._getSnappingContext(a);t._updatingHandles.addPromise((0,ct.R8)(t._snappingOperation.snapAgainNearPreviousMapPoint(t._snappingManager,r)))}if(null!=e){var o=t._computationManipulators.get(e),s=o.start,l=o.end;if(s.grabbing||l.grabbing)!function(e,t,n){var i=n.constraint,a=n.view,r=e.unconstrainedGeometry;if(null!=r){var o=a.renderCoordsHelper,s=a.spatialReference,l=r.directSegment,u=l.startRenderSpace,c=l.endRenderSpace,d=o.fromRenderCoords(u,new Ae.Z({spatialReference:s})),p=o.fromRenderCoords(c,new Ae.Z({spatialReference:s}));pt(e,"start"===t?{startPoint:d}:{endPoint:p},{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:r,view:a})}}(e,s.grabbing?"start":"end",{constraint:t._computeConstraint(e),view:t.view})}}))}},{key:"destroy",value:function(){var e;this._snappingOperation=(0,v.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),null===(e=this._orientationManipulatorTexture)||void 0===e||e.release()}},{key:"updating",get:function(){return this._updatingHandles.updating||this._snappingManager.updating}},{key:"firstGrabbedManipulator",get:function(){return this.parentTool.firstGrabbedManipulator}},{key:"hasGrabbedManipulators",get:function(){return this.parentTool.hasGrabbedManipulators}},{key:"snappingOptions",get:function(){return this._snappingManager.options}},{key:"_snappingManager",get:function(){return this._snappingManagerResult.snappingManager}},{key:"_activeComputation",get:function(){if(null!=this._stagedComputation)return this._stagedComputation;var e=this.analysisViewData.selectedComputation;return this.hasGrabbedManipulators&&null!=e?e:null}},{key:"_stagedComputation",get:function(){var e,t=this._stagedDimension,n=null===(e=this.analysisViewData.computations.at(-1))||void 0===e?void 0:e.computation;return null==t||null==n||n.dimension!==t?null:n}},{key:"_constraintHandles",get:function(){var e=this;return[(0,h.when)((function(){return e.analysisViewData.selectedComputation}),(function(t){t.previousConstraint=e._computeConstraint(t)}),(0,re.Z)((0,re.Z)({},h.syncAndInitial),{},{equals:lt.fS})),(0,h.watch)((function(){var t=e._activeComputation;if(null==t)return null;var n=t.dimension;return{measureType:n.measureType,orientation:n.orientation,computation:t}}),(function(e,t){if(null!=e&&null==t){var n=e.measureType,i=e.orientation,a=e.computation;switch(a.previousConstraint){case et.Horizontal:a.preConstraintProperties={measureType:_.n.Horizontal,orientation:0};break;case et.Vertical:a.preConstraintProperties={measureType:_.n.Vertical,orientation:0};break;case et.Direct:a.preConstraintProperties={measureType:_.n.Direct,orientation:i};break;default:a.preConstraintProperties={measureType:n,orientation:i}}}null==e&&null!=t&&(t.computation.preConstraintProperties=null)}),h.sync)]}},{key:"_snappingIndicatorHandles",get:function(){var e=this,t="snapping-indicator-event-handles";return[(0,h.watch)((function(){return{stagedComputation:e._stagedComputation,activeComputation:e._activeComputation}}),(function(n){var i=n.stagedComputation,a=n.activeComputation,r=e._constraintSnappingIndicator;if(e.removeHandles(t),null!=a)if(a===i)r.attached=!0;else{var o=e._computationManipulators.get(a),s=o.start,l=o.end,u=function(){r.attached=s.grabbing||l.grabbing};u(),e.addHandles([s.events.on("grab-changed",u),l.events.on("grab-changed",u)],t)}else r.attached=!1})),(0,h.watch)((function(){var t=e._activeComputation;return null!=t?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(function(t){var n=t.geometry,i=t.constraint,a=e._constraintSnappingIndicator;null!=n&&null!=i&&i!==et.Direct?(a.visible=!0,a.setGeometryFromSegment(n.directSegment)):a.visible=!1}))]}},{key:"removeStaged",value:function(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}},{key:"onDeactivate",value:function(){this.removeStaged(),this._resetSnappingState()}},{key:"onClick",value:function(e){var t=this._stagedDimension;if(null==t){var n=this._onUnstagedClick(e);return this.analysis.dimensions.add(n),null}return this._onStagedClick(e),t}},{key:"onPointerMove",value:function(e){var t=e.mapPoint,n=e.pointerType;if("touch"!==n){var i=this._getSnappingContext(n);this._updatingHandles.addPromise((0,ct.R8)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}}},{key:"onManipulatorSelectionChanged",value:function(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}},{key:"_onUnstagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=t;if("mouse"===n){var a=this._getSnappingContext(n);i=this._snappingManager.update({point:t,context:a})}var r=new ot.Z({startPoint:(0,x.WG)(i,new Ae.Z),endPoint:null,measureType:_.n.Horizontal});return this._stagedDimension=r,this._resetSnappingState(),r}},{key:"_onStagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=this._stagedComputation;if(null!=i){var a=t;if("mouse"===n){var r=this._getSnappingContext(n);a=this._snappingManager.update({point:t,context:r})}var o=(0,x.WG)(a,new Ae.Z);this._applyPointUpdate(i,{endPoint:o}),this._stagedDimension=null,this._resetSnappingState()}}},{key:"_resetSnappingState",value:function(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}},{key:"_createManipulators",value:function(e){var t=this,n=this._setupPointManipulator(e,{isStart:!0}),i=this._setupPointManipulator(e,{isStart:!1}),a=this._setupOffsetManipulator(e),r=this._setupHeadingManipulator(e),o=this._setupRotationManipulator(e),s=this._setupMeasureTypeManipulator(e,_.n.Direct),l=this._setupMeasureTypeManipulator(e,_.n.Horizontal),u=this._setupMeasureTypeManipulator(e,_.n.Vertical),c=new xe({start:n,end:i,offset:a,heading:r,rotation:o,direct:s,horizontal:l,vertical:u});return this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:function(){t._computationHandles.remove(e),t._computationManipulators.delete(e);var n,i=(0,le.Z)(c.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;t.manipulators.remove(a)}}catch(r){i.e(r)}finally{i.f()}}}}},{key:"_setupComputationToManipulatorsSync",value:function(e,t){var n=this;this._computationHandles.add([(0,h.watch)((function(){return e.geometry}),(function(){return n._updateManipulators(e,t)}),(0,re.Z)((0,re.Z)({},h.syncAndInitial),{},{equals:lt.fS}))],e)}},{key:"_setupPointManipulator",value:function(e,t){var n=this,i=this.view,a=e.dimension,r=new Ie(i,{metadata:a}),o=function(e,t){var n=t.isStart,i=t.createSnappingPipelineStep,a=t.dimension,r=t.onUpdate,o=t.view,s=n?"startPoint":"endPoint",l=(0,Te.Xd)(e,(function(e,t,n,l){var u,c=(0,Se.J4)(e),d=i(l),p=d.snappingStep,f=d.cancelSnapping;n=n.next(c).next((0,Te.di)(a,[s,"measureType","orientation"])).next(f),(u=t.next(c).next((0,Se.gv)(o))).next.apply(u,(0,ie.Z)(p)).next((function(e){var t=(0,x.WG)(e.mapEnd,new Ae.Z);r("startPoint"===s?{startPoint:t}:{endPoint:t})}))}));return[l]}(r,{isStart:t.isStart,createSnappingPipelineStep:function(e){return(0,wt.W)({snappingContext:n._getSnappingContext(e),snappingManager:n._snappingManager,updatingHandles:n._updatingHandles})},dimension:a,onUpdate:function(t){return n._applyPointUpdate(e,t)},view:i});return this._computationHandles.add(o,e),r}},{key:"_setupOffsetManipulator",value:function(e){var t=this.view,n=function(e,t){var n=[(0,D.al)(-.5,0,0),(0,D.al)(.5,0,0)],i=(0,Ce.rh)(t.unfocusedMaterial,n.map((function(e){return(0,k.j)((0,D.Ue)(),e,.5)}))),a=i.instantiate({material:t.focusedMaterial});return new ye.Z((0,re.Z)({view:e,renderObjects:[new _e.r(i,Oe.Q9.Unfocused|Oe.Q9.Selected|tt),new _e.r(a,Oe.Q9.Focused|tt)],collisionType:{type:"line",paths:[n]},radius:Ke(t.lineSizePt)/2,metadata:t.metadata,available:!1},ge.X9))}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){var n=t.computation,i=t.view;return[(0,Te.Xd)(e,(function(e,t,a){if(ee(n)&&e.selected){var r=n.geometry,o=n.dimension,s=(0,Se.J4)(e);t.next(s).next(Ne(i,o,r.dimensionSegment,r.primaryOffsetAxis)),a.next(s).next((0,Te.di)(o,["offset"]))}}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupHeadingManipulator",value:function(e){var t=this.view,n=new ze(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){var n=t.computation,i=t.view;return[(0,Te.Xd)(e,(function(e,t,a){Ee({cancel:a,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupRotationManipulator",value:function(e){var t=this.view,n=new ze(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=He(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupMeasureTypeManipulator",value:function(e,t){var n=this.view,i=function(e,t){var n=[(0,D.al)(-.5,0,0),(0,D.al)(.5,0,0)],i=(0,Ce.rh)(t.thinOffsetManipulatorMaterial,n),a=(0,Ce.rh)(t.unfocusedMaterial,n.map((function(e){return(0,k.j)((0,D.Ue)(),e,.5)}))),r=a.instantiate({material:t.focusedMaterial});return new ye.Z((0,re.Z)({view:e,renderObjects:[new _e.r(a,Oe.Q9.Unfocused|tt),new _e.r(r,Oe.Q9.Focused|tt),new _e.r(i,tt)],collisionType:{type:"line",paths:[n]},radius:Ke(t.lineSizePt)/2,available:!1,metadata:t.metadata},ge.X9))}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),a=Ge(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(a,e),i}},{key:"_updateManipulators",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator},a=i.stagedDimension,r=i.selectedComputation,o=i.firstGrabbedManipulator,s=t.start,l=t.end,u=t.offset,c=t.heading,d=t.rotation,p=r===e,f=ee(e),v=e.dimension,h=(0,le.Z)(t.values());try{for(h.s();!(n=h.n()).done;){var m=n.value,y=f&&null==a&&(null==o||m===o);m===u?(m.available=y,m.selected=p):m.available=y&&p}}catch(C){h.e(C)}finally{h.f()}if(f){null!=this._computeConstraint(e)?t.forEachMeasureTypeManipulator((function(e){return e.available=!1})):t.manipulatorForMeasureType(v.measureType).available=!1;for(var g=0,S=[c,d];g<S.length;g++){var M=S[g];v.measureType===_.n.Direct&&0!==v.offset||(M.available=!1)}B(e)?d.available=!1:c.available=!1;var w=e.geometry;s.renderLocation=w.directSegment.startRenderSpace,l.renderLocation=w.directSegment.endRenderSpace;var b=this.view.renderCoordsHelper;Le(u,w,b),c.available&&Ue(c,e,b),d.available&&Ve(d,e,b),t.forEachMeasureTypeManipulator((function(t,n){t.available&&Ye(t,e,n,b)}))}}},{key:"_updateManipulatorStyle",value:function(e){var t,n=function(e){return(0,de.F2)(e)+4}(e),i=Ke(e),a={lineSizePt:e,material:this._orientationManipulatorMaterial},r=(0,le.Z)(this._computationManipulators.values());try{for(r.s();!(t=r.n()).done;){var o=t.value,s=o.offset,l=o.heading,u=o.rotation;s.radius=i/2,l.update(a),u.update(a)}}catch(c){r.e(c)}finally{r.f()}this._unfocusedOffsetManipulatorMaterial.setParameters({width:n}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}},{key:"_applyPointUpdate",value:function(e,t){var n=this.view,i=E(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);var a=G(i,n.renderCoordsHelper);if(null!=a){var r=this._computeConstraint((0,re.Z)((0,re.Z)({},i),{},{geometry:a}));pt(e,t,(0,re.Z)((0,re.Z)({},i),{},{constraint:r,unconstrainedGeometry:a,view:n})),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}}},{key:"_updateStagedDimensionOffset",value:function(e){if(null!=e.geometry){e.geometry.directSegment.eval(.5,Dt);var t=this.view.state.camera.computeScreenPixelSizeAt(Dt);e.dimension.offset=50*t}}},{key:"_computeConstraint",value:function(e){return function(e,t){if($(e))return et.Direct;if(!e.enabled)return null;var n=e.geometry;if(null==n||(0,k.e)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;var i=t.state.camera,a=Q(O.WM.get(),n,t.renderCoordsHelper),r=X(O.WM.get(),n),o=(0,k.j)(O.WM.get(),a,(0,k.m)(r,a)),s=(0,k.f)(O.WM.get(),r,o),l=(0,k.q)(s),u=(0,k.q)(o),c=n.directSegment,d=c.startRenderSpace,p=c.endRenderSpace,f=Math.pow(Math.max(10*i.computeScreenPixelSizeAt(d),10*i.computeScreenPixelSizeAt(p)),2);return l<f?et.Vertical:u<f?et.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}},{key:"_createOffsetManipulatorMaterial",value:function(){return new De.U({width:1,renderOccluded:Pe.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}},{key:"testInfo",get:function(){}}]),n}(d.default);(0,c._)([(0,m.Cb)({constructOnly:!0})],Zt.prototype,"analysis",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Zt.prototype,"analysisViewData",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Zt.prototype,"manipulators",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Zt.prototype,"parentTool",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"view",void 0),(0,c._)([(0,m.Cb)({readOnly:!0})],Zt.prototype,"updating",null),(0,c._)([(0,m.Cb)()],Zt.prototype,"firstGrabbedManipulator",null),(0,c._)([(0,m.Cb)()],Zt.prototype,"hasGrabbedManipulators",null),(0,c._)([(0,m.Cb)()],Zt.prototype,"snappingOptions",null),(0,c._)([(0,m.Cb)()],Zt.prototype,"_stagedDimension",void 0),(0,c._)([(0,m.Cb)()],Zt.prototype,"_activeComputation",null),(0,c._)([(0,m.Cb)()],Zt.prototype,"_stagedComputation",null),Zt=(0,c._)([(0,y.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],Zt);var kt,Dt=(0,D.Ue)(),Tt=n(86509),Ot=n(87888),At=n(81298),xt=n(72612);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(kt||(kt={}));var It=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).automaticManipulatorSelection=!1,i.removeIncompleteOnCancel=!1,i._pointerMoveTimerMs=2500,i._prevPointerMoveTimeout=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=(0,At.w)(this.view.state.viewingMode),this._lengthDimensionSubTool=new Zt({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,p.ed)(this._lengthDimensionSubTool),(0,p.kB)((function(){return e._clearPointerMoveTimeout()})),(0,h.watch)((function(){return e.state}),(function(t){t===kt.Created&&e.finishToolCreation()}),h.syncAndInitial),(0,h.when)((function(){return e.firstGrabbedManipulator}),(function(t){e.selectedDimension=t.metadata}),h.syncAndInitial),(0,h.watch)((function(){return e.selectedDimension}),(function(){return e._resetPointerMoveTimeout()}),h.syncAndInitial)])}},{key:"state",get:function(){return this.analysis.dimensions.some((function(e){return"length"===e.type}))?null!=this._activeSubTool?kt.Creating:kt.Created:kt.Ready}},{key:"updating",get:function(){return this._lengthDimensionSubTool.updating}},{key:"cursor",get:function(){return this.active?"crosshair":null}},{key:"selectedDimension",get:function(){return this.analysisViewData.selectedDimension},set:function(e){this.analysisViewData.selectedDimension=e}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(Ot.Sn.cancel===e.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else Ot.Sn.delete.includes(e.key)&&this._deleteKeyHandler()}}},{key:"onActivate",value:function(){this._activeSubTool=this._lengthDimensionSubTool}},{key:"onDeactivate",value:function(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}},{key:"onShow",value:function(){this._resetPointerMoveTimeout()}},{key:"onManipulatorSelectionChanged",value:function(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}},{key:"onHide",value:function(){this.selectedDimension=null}},{key:"_clickHandler",value:function(e){if(this.hasFocusedManipulators)e.stopPropagation();else if(null!=this._activeSubTool){var t=this._intersectScreen(e);null!=t&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}}},{key:"_doubleClickHandler",value:function(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(this._resetPointerMoveTimeout(),null!=this._activeSubTool&&!this.hasFocusedManipulators){var t=this._intersectScreen(e);null!=t&&this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}}},{key:"_deleteKeyHandler",value:function(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}},{key:"_intersectScreen",value:function(e){var t=(0,xt.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);var n=this._intersector.results.min,i=O.WM.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,new Ae.Z({spatialReference:this.view.spatialReference})):null}},{key:"_removeSelected",value:function(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}},{key:"_clearPointerMoveTimeout",value:function(){this._prevPointerMoveTimeout=(0,v.hw)(this._prevPointerMoveTimeout)}},{key:"_resetPointerMoveTimeout",value:function(){var e=this;this._clearPointerMoveTimeout(),this.manipulators.forEach((function(e){return e.manipulator.state|=tt})),this._prevPointerMoveTimeout=ne.m.setTimeout((function(){e.manipulators.forEach((function(e){return e.manipulator.state&=~tt}))}),this._pointerMoveTimerMs)}},{key:"testInfo",get:function(){}}]),n}(Tt.f);(0,c._)([(0,m.Cb)({constructOnly:!0})],It.prototype,"view",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],It.prototype,"analysis",void 0),(0,c._)([(0,m.Cb)({readOnly:!0})],It.prototype,"state",null),(0,c._)([(0,m.Cb)({readOnly:!0})],It.prototype,"updating",null),(0,c._)([(0,m.Cb)({readOnly:!0})],It.prototype,"cursor",null),(0,c._)([(0,m.Cb)({constructOnly:!0})],It.prototype,"analysisViewData",void 0),(0,c._)([(0,m.Cb)()],It.prototype,"selectedDimension",null),(0,c._)([(0,m.Cb)()],It.prototype,"automaticManipulatorSelection",void 0),(0,c._)([(0,m.Cb)()],It.prototype,"_activeSubTool",void 0),(0,c._)([(0,m.Cb)()],It.prototype,"_lengthDimensionSubTool",void 0),It=(0,c._)([(0,y.j)("esri.views.3d.analysis.Dimension.DimensionTool")],It);n(59166);var zt=n(58935),Rt=n(27210),Ht=n(99894),Et=n(52168),Gt=n(79685),Nt=n(21317),jt=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e,i){var a;return(0,o.Z)(this,n),(a=t.call(this,e))._hasExternalMaterial=!1,a._renderOccluded=Pe.yD.OccludeAndTransparent,a._width=1,a._color=(0,Ht.al)(1,0,1,1),a._placement="end",a._markerPrimitive="arrow",a._material=i,a._hasExternalMaterial=null!=i,a.applyProperties(e),a}return(0,s.Z)(n,[{key:"setGeometryFromSegment",value:function(e,t){var n=e.endRenderSpace;this.transform=(0,P.vc)(Lt,n),this._normal=t;var i=e.createRenderGeometry(n,this.view.renderCoordsHelper).points;this.geometry=[i]}},{key:"renderOccluded",get:function(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded},set:function(e){this._renderOccluded=e,null!=this._material&&this._material.setParameters({renderOccluded:e})}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"normal",get:function(){return this._normal},set:function(e){this._normal=e,this.recreateGeometry()}},{key:"width",get:function(){return null!=this._material?this._material.parameters.width:this._width},set:function(e){this._width=e,null!=this._material&&this._material.setParameters({width:e})}},{key:"color",get:function(){return null!=this._material?this._material.parameters.color:this._color},set:function(e){this._color=(0,Ht.d9)(e),null!=this._material&&this._material.setParameters({color:this._color})}},{key:"placement",get:function(){return null!=this._material?this._material.parameters.placement:this._placement},set:function(e){this._placement=e,null!=this._material&&this._material.setParameters({placement:this._placement})}},{key:"markerPrimitive",get:function(){var e,t;return null!==(e=null===(t=this._material)||void 0===t?void 0:t.parameters.markerPrimitive)&&void 0!==e?e:this._markerPrimitive},set:function(e){this._markerPrimitive=e,null!=this._material&&this._material.setParameters({markerPrimitive:e})}},{key:"createExternalResources",value:function(){this._hasExternalMaterial||(this._material=new Nt.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}},{key:"destroyExternalResources",value:function(){this._hasExternalMaterial||(this._material=null)}},{key:"createGeometries",value:function(e){var t,n=(0,le.Z)((0,Gt.c)(this.geometry,this.normal));try{for(n.s();!(t=n.n()).done;){var i=t.value,a=(0,Gt.Y)(this._material,i);e.addGeometry(a)}}catch(r){n.e(r)}finally{n.f()}}},{key:"forEachExternalMaterial",value:function(e){this._hasExternalMaterial||e(this._material)}}]),n}(Et._),Lt=(0,Z.Ue)(),Ut=function(){function e(t){var n=this;(0,o.Z)(this,e),this.destroyed=!1,this._handles=new st.Z,this._messages=null,this._labelSegment=new I.y;var i=t.analysis,a=t.computation,r=t.view,s=t.messages,l=t.isDecoration;this.analysis=i,this.computation=a,this.view=r,this._messages=s;var u=t.visible,c={view:r,attached:u,isDecoration:l},d=i.style,p=d.fontSize,f=d.textColor,v=d.textBackgroundColor;this._visualElements=new Bt({marker:new jt(c,t.markerMaterial),dimension:new ht.r(c,t.dimensionLineMaterial),startOffset:new ht.r(c,t.offsetLineMaterial),endOffset:new ht.r(c,t.offsetLineMaterial),dimensionSmall:new ht.r(c,t.smallDimensionLineMaterial),startOffsetSmall:new ht.r(c,t.smallOffsetLineMaterial),endOffsetSmall:new ht.r(c,t.smallOffsetLineMaterial),label:new Rt.K({view:r,attached:u,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,de.F2)(p),textColor:f.clone(),backgroundColor:v.clone(),isDecoration:l})}),this._handles.add([(0,h.watch)((function(){return a.geometry}),(function(e){n.updateCameraDependentElements(r.state.camera,e,i.style),null!=a.geometry&&n._updateLines(a.geometry)}),(0,re.Z)((0,re.Z)({},h.initial),{},{equals:lt.fS})),(0,h.watch)((function(){return a.length}),(function(e){return n._updateLabelContent(e)}),h.initial)])}return(0,s.Z)(e,[{key:"visible",set:function(e){var t,n=(0,le.Z)(this._visualElements.values());try{for(n.s();!(t=n.n()).done;){t.value.attached=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"destroy",value:function(){this.destroyed=!0,this._handles=(0,v.SC)(this._handles);var e,t=(0,le.Z)(this._visualElements.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}}},{key:"testInfo",get:function(){}},{key:"_updateLines",value:function(e){var t=N(Vt,i.Start,e.directSegment,e.dimensionSegment),n=N(Wt,i.End,e.directSegment,e.dimensionSegment),a=this._visualElements;a.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),a.dimension.setGeometryFromSegment(e.dimensionSegment),a.startOffset.setGeometryFromSegment(t),a.endOffset.setGeometryFromSegment(n),a.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),a.startOffsetSmall.setGeometryFromSegment(t),a.endOffsetSmall.setGeometryFromSegment(n)}},{key:"updateCameraDependentElements",value:function(e,t,n){var i=this._visualElements;if(null!=t){var a=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Ft)),r=function(e,t){return(0,k.q)(q(K,e))/Math.pow(t,2)}(t,a),o=r<Math.pow(2*(0,de.F2)(n.lineSize),2),s=!o;i.marker.visible=s,i.dimension.visible=s,i.startOffset.visible=s,i.endOffset.visible=s,i.dimensionSmall.visible=o,i.startOffsetSmall.visible=o,i.endOffsetSmall.visible=o;var l=5*(0,de.F2)(n.fontSize),u=i.label;if(u.visible=r>=Math.pow(l,2),u.visible){var c=t.dimensionSegment,d=t.primaryOffsetAxis,p=this.computation.dimension.offset,f=(Math.sign(p)>=0?1:-1)*function(e){return 1.5*(0,de.F2)(e.fontSize)+20+(0,de.F2)(e.lineSize/2)}(n)*a;(function(e,t,n,i){(0,k.r)(e.startRenderSpace,t.startRenderSpace,n,i),(0,k.r)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,c,d,f),u.updateLabelPosition()}}else{var v,h=(0,le.Z)(i.values());try{for(h.s();!(v=h.n()).done;){v.value.visible=!1}}catch(m){h.e(m)}finally{h.f()}}}},{key:"updateLabelStyle",value:function(e){var t=this._visualElements.label;t.fontSize=(0,de.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}},{key:"updateUnitsMessages",value:function(e){this._messages=e;var t=this.computation.length;this._updateLabelContent(t)}},{key:"_updateLabelContent",value:function(e){var t=this._visualElements.label;null!=e&&null!=this._messages?t.text=(0,zt.VG)(this._messages,e,e.unit):t.text=""}}]),e}();var Vt=new I.y,Wt=new I.y,Ft=(0,D.Ue)(),Bt=function(){function e(t){(0,o.Z)(this,e),this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}return(0,s.Z)(e,[{key:"values",value:function(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}]),e}(),Yt=n(33720),Qt=n(36257),Xt=n(41201),qt=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).loadingMessages=!1,i._messages=null,i}return(0,s.Z)(n,[{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"initialize",value:function(){var e=this,t=this.isDecoration;this._markerMaterial=new Nt.X({width:1,anchor:Yt.i5.Tip,color:pe.AG,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:Pe.yD.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:t}),this._dimensionLineMaterial=new De.U({width:1,color:pe.AG,renderOccluded:Pe.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:t}),this._offsetLineMaterial=new De.U({width:1,color:pe.AG,renderOccluded:Pe.yD.OccludeAndTransparent,stipplePattern:(0,yt.z5)(5),isDecoration:t}),this._smallDimensionLineMaterial=new De.U({width:1,color:pe.AG,renderOccluded:Pe.yD.OccludeAndTransparent,isDecoration:t}),this._smallOffsetLineMaterial=new De.U({width:1,color:pe.AG,renderOccluded:Pe.yD.OccludeAndTransparent,stipplePattern:(0,yt.z5)(5),isDecoration:t});var n,i=(0,le.Z)(this._lineMaterials());try{var a=function(){var t=n.value;e.view._stage.add(t),e.addHandles((0,p.kB)((function(){var n;null===(n=e.view._stage)||void 0===n||n.remove(t)})))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}var r=(0,h.mapCollection)((function(){return e.analysisViewData.computations}),(function(t){var n=t.computation;return e._createVisualization(n)}));this._dimensionVisualizations=r,this.addHandles([(0,p.ed)(r),(0,h.watch)((function(){return ue.Z.toUnitRGBA(e.analysis.style.color)}),(function(t){var n,i=(0,le.Z)(e._lineMaterials());try{for(i.s();!(n=i.n()).done;){n.value.setParameters({color:t})}}catch(o){i.e(o)}finally{i.f()}}),h.syncAndInitial),(0,h.watch)((function(){return e.analysis.style.lineSize}),(function(t){var n=(0,de.F2)(t);e._markerMaterial.setParameters({width:.8*n}),e._dimensionLineMaterial.setParameters({width:n,markerParameters:e._markerMaterial.parameters});var i=Math.max(.25*n,1);e._offsetLineMaterial.setParameters({width:i})}),h.syncAndInitial),(0,h.watch)((function(){return{camera:e.view.state.camera,style:Jt(e.analysis)}}),(function(t){var n,i=t.camera,a=t.style,r=(0,le.Z)(e._dimensionVisualizations);try{for(r.s();!(n=r.n()).done;){var s=n.value.visualization;s.updateCameraDependentElements(i,s.computation.geometry,a),s.updateLabelStyle(a)}}catch(o){r.e(o)}finally{r.f()}})),(0,h.watch)((function(){return e.visible}),(function(t){var n,i=(0,le.Z)(e._dimensionVisualizations);try{for(i.s();!(n=i.n()).done;){n.value.visualization.visible=t}}catch(o){i.e(o)}finally{i.f()}}))]),this.addHandles([(0,Qt.qe)((function(){return e._updateMessageBundle()})),(0,h.when)((function(){return!e.loadingMessages}),(function(){var t,n=(0,le.Z)(e._dimensionVisualizations);try{for(n.s();!(t=n.n()).done;){t.value.visualization.updateUnitsMessages(e._messages)}}catch(o){n.e(o)}finally{n.f()}}),h.sync)]),this._updateMessageBundle()}},{key:"testInfo",get:function(){}},{key:"_createVisualization",value:function(e){var t=new Ut({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:t,remove:function(){return t.destroy()}}}},{key:"_lineMaterials",value:function(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}},{key:"_updateMessageBundle",value:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingMessages=!0,e.prev=1,e.next=4,(0,Xt.ME)("esri/core/t9n/Units");case 4:this._messages=e.sent;case 5:return e.prev=5,this.loadingMessages=!1,e.finish(5);case 8:case"end":return e.stop()}}),e,this,[[1,,5,8]])})));return function(){return e.apply(this,arguments)}}()}]),n}(d.default);function Jt(e){var t=e.style,n=t.fontSize,i=t.lineSize,a=t.textColor;return{fontSize:n,lineSize:i,textBackgroundColor:t.textBackgroundColor.clone(),textColor:a.clone()}}(0,c._)([(0,m.Cb)({constructOnly:!0})],qt.prototype,"analysisViewData",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0,nonNullable:!0})],qt.prototype,"view",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],qt.prototype,"isDecoration",void 0),(0,c._)([(0,m.Cb)()],qt.prototype,"analysis",null),(0,c._)([(0,m.Cb)()],qt.prototype,"visible",null),(0,c._)([(0,m.Cb)()],qt.prototype,"loadingMessages",void 0),qt=(0,c._)([(0,y.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],qt);var Kt=n(44925),$t=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).dimension=null,i.length=null,i}return(0,s.Z)(n)}(d.default);(0,c._)([(0,m.Cb)({constructOnly:!0,nonNullable:!0})],$t.prototype,"dimension",void 0),(0,c._)([(0,m.Cb)()],$t.prototype,"length",void 0);var en=$t=(0,c._)([(0,y.j)("esri.views.analysis.LengthDimensionResult")],$t),tn=["dimension"],nn=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).geometry=null,i.unconstrainedGeometry=null,i.elevationAlignedStartPoint=null,i.elevationAlignedEndPoint=null,i}return(0,s.Z)(n,[{key:"normalizeCtorArgs",value:function(e){var t=e.dimension,n=(0,Kt.Z)(e,tn);return(0,re.Z)({result:new en({dimension:t})},n)}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,h.watch)((function(){return e.dimension.startPoint}),(function(t){return e.elevationAlignedStartPoint=e.projectAndAlignPoint(t)}),h.syncAndInitial),(0,h.watch)((function(){return e.dimension.endPoint}),(function(t){return e.elevationAlignedEndPoint=e.projectAndAlignPoint(t)}),h.syncAndInitial)])}},{key:"dimension",get:function(){return this.result.dimension}},{key:"length",get:function(){return this.result.length}}]),n}(d.default);(0,c._)([(0,m.Cb)({constructOnly:!0,nonNullable:!0})],nn.prototype,"result",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0,nonNullable:!0})],nn.prototype,"projectAndAlignPoint",void 0),(0,c._)([(0,m.Cb)()],nn.prototype,"dimension",null),(0,c._)([(0,m.Cb)()],nn.prototype,"length",null),(0,c._)([(0,m.Cb)()],nn.prototype,"geometry",void 0),(0,c._)([(0,m.Cb)()],nn.prototype,"unconstrainedGeometry",void 0),(0,c._)([(0,m.Cb)()],nn.prototype,"elevationAlignedStartPoint",void 0),(0,c._)([(0,m.Cb)()],nn.prototype,"elevationAlignedEndPoint",void 0),(0,c._)([(0,m.Cb)()],nn.prototype,"preConstraintProperties",void 0),(0,c._)([(0,m.Cb)()],nn.prototype,"previousConstraint",void 0),nn=(0,c._)([(0,y.j)("esri.views.3d.analysis.Dimension.LengthDimensionComputation")],nn);var an=n(33906),rn=n(70209),on=n(80987),sn=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).type="dimension-view-3d",i.tool=null,i.selectedDimension=null,i._dimensionsToComputations=new Map,i._placementTask=null,i._projectAndAlignPoint=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._projectAndAlignPoint=function(t){if(null==t)return null;var n=e.view,i=n.spatialReference,a=n.elevationProvider,r=(0,an.G)(t,i,a);return null==r&&(0,an.e)(e.analysis,t.spatialReference,f.Z.getLogger(e)),r};var t=(0,h.mapCollection)((function(){return e.analysis.dimensions}),(function(t){return e._createComputation(t)}));this.computations=t,this.addHandles([(0,rn.Lp)(this,It),(0,p.ed)(t)]),this._analysisVisualization=new qt({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new te({analysisViewData:this,view:this.view})}},{key:"destroy",value:function(){this._placementTask=(0,v.IM)(this._placementTask),this._analysisVisualization=(0,v.SC)(this._analysisVisualization),(0,rn.Yq)(this)}},{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}},{key:"results",get:function(){var e=this;return this.analysis.dimensions.map((function(t){return e._dimensionsToComputations.get(t).result}))}},{key:"selectedComputation",get:function(){var e=this.selectedDimension;return null==e?null:this._dimensionsToComputations.get(e)}},{key:"testInfo",get:function(){}},{key:"createLengthDimensions",value:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.selectedDimension=null,this._placementTask=(0,v.IM)(this._placementTask),this._placementTask=(0,rn.Er)(this,t),this._placementTask.promise));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createComputation",value:function(e){var t=this,n=this._dimensionsToComputations,i=new nn({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});return n.set(e,i),{computation:i,remove:function(){return t._removeComputation(i)}}}},{key:"_removeComputation",value:function(e){var t=e.dimension;t===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(t),e.destroy()}}]),n}(function(e){var t=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;(0,o.Z)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).analysis=null,e.tool=null,e.selectedDimension=null,e.interactive=!1,e.visible=null,e}return(0,s.Z)(n,[{key:"results",get:function(){return new on.Z}},{key:"createLengthDimensions",value:function(e){throw new Error("Method not implemented.")}}]),n}(e);return(0,c._)([(0,m.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,c._)([(0,m.Cb)()],t.prototype,"tool",void 0),(0,c._)([(0,m.Cb)({readOnly:!0})],t.prototype,"results",null),(0,c._)([(0,m.Cb)()],t.prototype,"selectedDimension",void 0),(0,c._)([(0,m.Cb)()],t.prototype,"interactive",void 0),(0,c._)([(0,m.Cb)()],t.prototype,"visible",void 0),t=(0,c._)([(0,y.j)("esri.views.analysis.DimensionAnalysisView")],t)}((0,g.p)(d.default)));(0,c._)([(0,m.Cb)({readOnly:!0})],sn.prototype,"type",void 0),(0,c._)([(0,m.Cb)()],sn.prototype,"tool",void 0),(0,c._)([(0,m.Cb)()],sn.prototype,"updating",null),(0,c._)([(0,m.Cb)({readOnly:!0})],sn.prototype,"results",null),(0,c._)([(0,m.Cb)()],sn.prototype,"computations",void 0),(0,c._)([(0,m.Cb)()],sn.prototype,"selectedDimension",void 0),(0,c._)([(0,m.Cb)()],sn.prototype,"selectedComputation",null),(0,c._)([(0,m.Cb)()],sn.prototype,"_analysisVisualization",void 0),(0,c._)([(0,m.Cb)()],sn.prototype,"_analysisController",void 0),(0,c._)([(0,m.Cb)()],sn.prototype,"_dimensionsToComputations",void 0),(0,c._)([(0,m.Cb)()],sn.prototype,"_placementTask",void 0);var ln=sn=(0,c._)([(0,y.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],sn)},11526:function(e,t,n){n.d(t,{O:function(){return o},s:function(){return s}});function i(e,t){return function(e,t){var n=new Image(t,t);return n.src=e,n}(function(e){var t=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,".concat(btoa(t))}(a(function(e){var t=e.split(",")[1],n=atob(t);return(new DOMParser).parseFromString(n,"image/svg+xml")}(e),t)),t.size)}function a(e,t){var n=t.accentColor,i=t.contrastColor,a=n.toHex(),r=n.a,o=i.toHex(),s=i.a,l=e.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem("theme-style");return l&&(l.innerHTML="\n      .contrast-fill { fill: ".concat(o,"; fill-opacity: ").concat(s,"; }\n      .contrast-stroke { stroke: ").concat(o,"; stroke-opacity: ").concat(s,";  }\n      .accent-fill { fill: ").concat(a,"; fill-opacity: ").concat(r,"; }\n      .accent-stroke { stroke: ").concat(a,"; stroke-opacity:  ").concat(r,"; }")),e}var r=n(1487);function o(e,t){var n=t.accentColor,a=t.contrastColor,o=t.preMultiplyAlpha;return e.fromData("heading-rotate:[accent:".concat(n,",contrast:").concat(a,",size:").concat(64,"]"),(function(){return new r.x(i("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",{accentColor:n,contrastColor:a,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:o})}))}function s(e,t){var n=t.accentColor,a=t.contrastColor,o=t.preMultiplyAlpha;return e.fromData("tilt-rotate:[accent:".concat(n,",contrast:").concat(a,",size:").concat(64,"]"),(function(){return new r.x(i("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxjaXJjbGUgY3g9IjM5LjQ3OCIgY3k9IjMuMDc4IiByPSIyOCIgY2xhc3M9ImFjY2VudC1maWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg0MC41NDIpIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI1IiBkPSJtNy4wNzQgMzAuMDUzIDI5LjM5NyAxMS45ODUtMy42NzMtMzMuNDkzIiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSIyLjk5NiIgZD0iTTI0LjUwNCAyMy4yMDdhMTEuOTggMTEuOTggMCAwIDAtOS44IDcuNTA3IiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIGNvbnRyYXN0LWZpbGwiLz48cGF0aCBkPSJtMjkuODE4IDIyLjgwOC02LjE4NCA0LjYtLjU0MS04LjM2NHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+",{accentColor:n,contrastColor:a,size:64}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:o})}))}},27676:function(e,t,n){n.d(t,{j:function(){return M}});var i=n(1413),a=n(37762),r=n(15671),o=n(43144),s=n(60136),l=n(29388),u=n(32035),c=n(12400),d=n(19093),p=n(86361),f=n(52168),v=n(78935),h=n(86372),m=n(69691);var y=n(68401),g=n(70619),_=n(56529),S=n(11606),M=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).view=null,i._renderOccluded=_.yD.OccludeAndTransparent,i._vertices=null,i._spatialReference=null,i._color=(0,p.nI)([1,127/255,0,1]),i._size=11,i._outlineColor=(0,p.nI)([0,0,0,.5]),i._outlineSize=1,i._elevationInfo=null,i.applyProperties(e),i}return(0,o.Z)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){(0,d.a)(e,this._color)||((0,d.c)(this._color,e),this._updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,d.a)(e,this._outlineColor)||((0,d.c)(this._outlineColor,e),this._updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"_vertexMaterialParameters",get:function(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}},{key:"_vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}},{key:"_updateMaterial",value:function(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}},{key:"_updateOutlineMaterial",value:function(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}},{key:"_createRenderGeometries",value:function(){var e=this.vertices;if(null==e||0===e.length)return[];for(var t=function(e,t,n,i,a){var r=(0,h.bg)(3*e.length),o=(0,h.bg)(r.length);e.forEach((function(e,t){r[3*t]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0}));var s=(0,m.rR)(r,t,0,o,0,r,0,r.length/3,n,i,a),l=null!=s;return{numVertices:e.length,position:r,mapPositions:o,projectionSuccess:l,sampledElevation:s}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,v.o.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,a=t.position,r=0;r<i;++r){var o=(0,u.s)(w,a[3*r],a[3*r+1],a[3*r+2]),s=b(this._vertexMaterial,.5,o),l=b(this._vertexOutlineMaterial,.5,o);n.push({vertexGeometry:s,vertexOutlineGeometry:l})}return n}},{key:"createGeometries",value:function(e){var t,n=this._createRenderGeometries(),i=(0,a.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value,o=r.vertexGeometry,s=r.vertexOutlineGeometry;e.addGeometry(o),e.addGeometry(s)}}catch(l){i.e(l)}finally{i.f()}}},{key:"createExternalResources",value:function(){this._vertexMaterial=new S.Q((0,i.Z)((0,i.Z)({},this._vertexMaterialParameters),{},{writeDepth:!0,cullFace:y.Vr.Back,screenSizeEnabled:!0})),this._vertexOutlineMaterial=new S.Q((0,i.Z)((0,i.Z)({},this._vertexOutlineMaterialParameters),{},{forceTransparentMode:!0,writeDepth:!0,cullFace:y.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}]),n}(f._),w=(0,c.Ue)();function b(e,t,n){return(0,g.PI)(e,t,16,16,{offset:n})}},66156:function(e,t,n){n.d(t,{j:function(){return j}});var i=n(37762),a=n(1413),r=n(15671),o=n(43144),s=n(60136),l=n(29388),u=n(25158),c=n(37081),d=n(68401),p=n(17363),f=n(56529),v=n(78041),h=n(93822),m=n(97731),y=n(4760),g=n(12594),_=n(64642),S=n(11983),M=n(33236),w=n(88301),b=n(61120),C=n(27366),P=n(98634),Z=n(82144),k=n(31132),D=n(33559),T=n(27627),O=n(50411),A=n(25920),x=n(8883),I=n(32500),z=n(8548),R=n(36207),H=(P.K,function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"initializeProgram",value:function(e){return new T.$(e.rctx,n.shader.get().build(this.configuration),N)}},{key:"_setPipelineState",value:function(e,t){var n=this.configuration,i=e===A.A.NONE,a=e===A.A.FrontFace;return(0,R.sm)({blending:n.output===c.H_.Color&&n.transparent?i?E:(0,v.j7)(e):null,culling:(0,R.zp)(n.cullFace),depthTest:{func:(0,v.Bh)(e)},depthWrite:i?n.writeDepth?R.LZ:null:(0,v.K5)(e),drawBuffers:(0,v.V7)(e),colorWrite:R.BK,stencilWrite:n.hasOccludees?O.s3:null,stencilTest:n.hasOccludees?t?O.eD:O.RY:null,polygonOffset:i||a?null:(0,v.je)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipeline",value:function(e){return e?this._occludeePipelineState:(0,w.Z)((0,b.Z)(n.prototype),"getPipeline",this).call(this)}}]),n}(k.A));H.shader=new Z.J(I.I,(function(){return n.e(18957).then(n.bind(n,18957))}));var E=(0,R.if)(z.zi.ONE,z.zi.ONE_MINUS_SRC_ALPHA),G=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).output=c.H_.Color,e.cullFace=d.Vr.None,e.hasSlicePlane=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.hasOccludees=!1,e.transparencyPassType=A.A.NONE,e.multipassEnabled=!1,e.cullAboveGround=!1,e.perspectiveInterpolation=!0,e}return(0,o.Z)(n)}(x.W);(0,C._)([(0,D.o)({count:c.H_.COUNT})],G.prototype,"output",void 0),(0,C._)([(0,D.o)({count:d.Vr.COUNT})],G.prototype,"cullFace",void 0),(0,C._)([(0,D.o)()],G.prototype,"hasSlicePlane",void 0),(0,C._)([(0,D.o)()],G.prototype,"transparent",void 0),(0,C._)([(0,D.o)()],G.prototype,"enableOffset",void 0),(0,C._)([(0,D.o)()],G.prototype,"writeDepth",void 0),(0,C._)([(0,D.o)()],G.prototype,"hasOccludees",void 0),(0,C._)([(0,D.o)({count:A.A.COUNT})],G.prototype,"transparencyPassType",void 0),(0,C._)([(0,D.o)()],G.prototype,"multipassEnabled",void 0),(0,C._)([(0,D.o)()],G.prototype,"cullAboveGround",void 0),(0,C._)([(0,D.o)()],G.prototype,"perspectiveInterpolation",void 0),(0,C._)([(0,D.o)({constValue:!1})],G.prototype,"occlusionPass",void 0);var N=new Map([[y.T.POSITION,0],[y.T.UV0,2],[y.T.PERSPECTIVEDIVIDE,3]]),j=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e,new V)).supportsEdges=!0,i.produces=new Map([[h.r.OPAQUE_MATERIAL,function(e){return(0,c.ou)(e)||(0,c.D5)(e)&&!i.parameters.transparent}],[h.r.TRANSPARENT_MATERIAL,function(e){return(0,c.D5)(e)&&i.parameters.transparent&&i.parameters.writeDepth}],[h.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,function(e){return(0,c.D5)(e)&&i.parameters.transparent&&!i.parameters.writeDepth}],[h.r.DRAPED_MATERIAL,function(e){return(0,c.D5)(e)||(0,c.ou)(e)}]]),i._vertexAttributeLocations=N,i._configuration=new G,i}return(0,o.Z)(n,[{key:"getConfiguration",value:function(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<v.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}},{key:"createGLMaterial",value:function(e){return new L(e)}},{key:"createBufferWriter",value:function(){var e=_.W1.clone();return this.parameters.perspectiveInterpolation&&e.f32(y.T.PERSPECTIVEDIVIDE),new U(e)}}]),n}(S.c),L=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){return(0,r.Z)(this,n),t.call(this,(0,a.Z)((0,a.Z)({},e),e.material.parameters))}return(0,o.Z)(n,[{key:"_updateParameters",value:function(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(H,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}},{key:"beginSlot",value:function(e){return this._output===c.H_.Color&&this._updateOccludeeState(e),this._updateParameters(e)}}]),n}(p.F),U=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"write",value:function(e,t,n,a,r){var o,s=(0,i.Z)(this.vertexBufferLayout.fields.keys());try{for(s.s();!(o=s.n()).done;){var l=o.value,c=n.attributes.get(l);if(c)if(l===y.T.PERSPECTIVEDIVIDE){(0,m.hu)(1===c.size);var d=a.getField(l,u.ly);d&&(0,M.XW)(c,d,r)}else(0,M.i9)(l,c,e,t,a,r)}}catch(p){s.e(p)}finally{s.f()}}}]),n}(g.G),V=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).transparent=!1,e.writeDepth=!0,e.hasSlicePlane=!1,e.cullFace=d.Vr.None,e.hasOccludees=!1,e.opacity=1,e.textureId=null,e.initTextureTransparent=!0,e.perspectiveInterpolation=!1,e}return(0,o.Z)(n)}(f.Mt)},70209:function(e,t,n){n.d(t,{Er:function(){return u},Lp:function(){return c},Yq:function(){return d}});var i=n(74165),a=n(15861),r=n(14921),o=n(92026),s=n(66978),l=n(94172);function u(e,t){e.interactive=!0;var n=e.tool,u=e.view;u.activeTool=n;var c=(0,s.fu)(t,(function(){u.activeTool===n&&(u.activeTool=null)}));return(0,r.vr)(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.whenOnce)((function(){return null==n||!n.active}),t);case 2:c=(0,o.hw)(c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t)}function c(e,t){return(0,l.watch)((function(){return e.interactive}),(function(){return function(e,t){e.interactive?function(e,t){d(e);var n=e.view,i=e.analysis,a=new t({view:n,analysis:i,analysisViewData:e});e.tool=a,n.tools.add(a)}(e,t):d(e)}(e,t)}),l.syncAndInitial)}function d(e){var t=e.view,n=e.tool;null!=n&&(t.tools.remove(n),e.tool=null)}},86509:function(e,t,n){n.d(t,{f:function(){return c}});var i=n(15671),a=n(43144),r=n(60136),o=n(29388),s=n(27366),l=n(94172),u=(n(32718),n(93169),n(84936),n(10064),n(69912)),c=function(e){(0,r.Z)(n,e);var t=(0,o.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,a.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,l.watch)((function(){return e.analysisViewData.visible}),(function(t){return e.visible=t}),l.syncAndInitial))}},{key:"deactivate",value:function(){this.onDeactivate(),this.created||this.analysis.clear()}},{key:"resetCreated",value:function(){this._set("created",!1)}}]),n}(n(45900).m);c=(0,s._)([(0,u.j)("esri.views.interactive.AnalysisToolBase")],c)},81298:function(e,t,n){n.d(t,{w:function(){return r}});var i=n(88153),a=n(54463);function r(e){var t=(0,i.Z8)(e);return t.options.store=a.eC.MIN,t.options.hud=!1,t}},34019:function(e,t,n){n.d(t,{N:function(){return r}});var i=n(15671),a=n(43144),r=function(){function e(t){(0,i.Z)(this,e),this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.feature=t.feature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ,this.drawConstraints=t.drawConstraints}return(0,a.Z)(e,[{key:"coordinateHelper",get:function(){return this.editGeometryOperations.data.coordinateHelper}},{key:"spatialReference",get:function(){return this.coordinateHelper.spatialReference}}]),e}()},80151:function(e,t,n){n.d(t,{W:function(){return y}});var i=n(37762),a=n(29439),r=n(74165),o=n(15861),s=n(1413),l=n(92026),u=n(66978),c=n(94172),d=n(70178),p=n(37818),f=n(74509),v=n(74229),h=n(34019),m=n(93463);function y(e){var t=e.predicate,n=void 0===t?function(){return!0}:t,a=e.snappingManager,p=e.snappingContext,y=e.updatingHandles,w=e.useZ,b=void 0===w||w,C=new v.hM;if(null==a)return{snappingStep:[M,C],cancelSnapping:M};var P,Z,k,D,T=null,O=null,A=null,x=function(){var e;T=(0,l.IM)(T),a.doneSnapping(),null!==(e=O)&&void 0!==e&&e.frameTask.remove(),O=null,P=(0,l.hw)(P),A=null},I=(Z=a,k=b,D=C,(0,u.Ds)(function(){var e=(0,o.Z)((0,r.Z)().mark((function e(t,n){var i,a,o,s,l,u,c,p,f,v;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.frameTask,a=t.point,o=t.scenePoint,s=t.context,l=t.event,u=t.delta,c=t.getLastState,e.next=3,i.schedule((function(){return Z.snap({point:a,scenePoint:o,context:s,signal:n})}),n);case 3:if(!(p=e.sent).valid){e.next=10;break}return e.next=7,i.schedule((function(){return p.apply()}),n);case 7:f=e.sent,null!=(v=c()).point&&a!==v.point&&(f=Z.update({point:v.point,scenePoint:v.scenePoint,context:s})),null!=v.updatePoint&&(0,d.kg)(f,v.updatePoint)||(S(l.mapEnd,f,u,k),D.execute(l));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())),z=null,R=null,H=null;return{snappingStep:[function(e){if(!n(e))return e;var t=e.action;if("start"===t){var r=e.info,o=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(m.T8.SNAPPING):m.sq}(a.view);if(O=function(e,t,n){return{context:new h.N({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:null!=t.info?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:null!=t.snapOrigin?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:null!=t.scenePoints?t.scenePoints.sceneStart:null,frameTask:n}}(p,e,o),O.context.selfSnappingZ=null,!b&&null!=r){var l,d=function(e,t){if(!e.hasZ())return null;var n,a=t.vertices,r=null,o=(0,i.Z)(a);try{for(o.s();!(n=o.n()).done;){var s=n.value,l=e.getZ(s.pos);if(null!=r&&null!=l&&Math.abs(l-r)>1e-6)return null;null==r&&(r=l)}}catch(u){o.e(u)}finally{o.f()}return r}(p.coordinateHelper,r.handle.component);null!=d&&(O.context.selfSnappingZ={value:d,elevationInfo:null!==(l=p.elevationInfo)&&void 0!==l?l:f.jG})}}if(null!=O){var v=O,M=v.context,w=v.originalScenePos,C=v.originalPos,Z=e.mapEnd,k=e.mapStart,D=e.scenePoints,E=g(C,_(Z,k)),G=_(k,C),N=(0,s.Z)((0,s.Z)({},e),{},{action:"update"}),j=O.context,L=function(e,t){return null==e||null==t?null:g(e,_(t.sceneEnd,t.sceneStart))}(w,D),U=a.update({point:E,scenePoint:L,context:M});if(H=U,S(Z,U,G,b),z=E,R=L,"end"!==t){var V=O.frameTask;null==T&&(T=new AbortController),A=function(e){y.addPromise((0,u.R8)(I({frameTask:V,event:N,context:j,point:E,scenePoint:L,delta:G,getLastState:function(){return{point:z,scenePoint:R,updatePoint:e.forceUpdate?null:H}}},T.signal)))},A({forceUpdate:!1}),null==P&&(P=(0,c.watch)((function(){return a.options.effectiveEnabled}),(function(){var e;return null===(e=A)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===t&&x(),e},C],cancelSnapping:function(e){return x(),e}}}function g(e,t){var n=(0,a.Z)(t,3),i=n[0],r=n[1],o=n[2],s=(0,p.WG)(e);return s.x+=i,s.y+=r,s.hasZ&&(s.z+=o),s}function _(e,t){var n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function S(e,t,n,i){var r=(0,a.Z)(n,3),o=r[0],s=r[1],l=r[2];e.x=t.x+o,e.y=t.y+s,i&&e.hasZ&&t.hasZ&&(e.z=t.z+l)}function M(e){return e}},44270:function(e,t,n){n.d(t,{u:function(){return v}});var i=n(1413),a=n(42537),r=n(70758),o=n(80987),s=n(94172),l=n(22006),u=n(76014),c=n(98173);var d=n(27357),p=n(38856),f=new Map;function v(e){if(!f.has(e)){var t=function(e,t){var n,a,r=new c.Z({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:u.c.distance,touchSensitivityMultiplier:null!==(a=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==a?a:u.c.touchSensitivityMultiplier});return(0,i.Z)((0,i.Z)({},(0,s.watch)((function(){var t,n,i;return null!==(t=null===(n=e.map)||void 0===n||null===(i=n.allLayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]}),(function(e){r.featureSources=new o.Z(e.map((function(e){return new l.Z({layer:e})})))}),s.initial)),{},{options:r})}(e,{distance:10}),n=function(e,t){return new p.N({view:e,options:t,snappingEnginesFactory:function(t,n){return[new d.U({view:e,spatialReference:e.spatialReference,options:n})]}})}(e,t.options);f.set(e,{referenceCount:0,snappingManager:n,remove:function(){t.remove(),n.destroy()}})}var v=f.get(e);v.referenceCount++;var h=(0,a.kB)((function(){return t=e,(n=v).referenceCount--,void(n.referenceCount>0||(0,r.Y)((function(){0===n.referenceCount&&(n.remove(),f.delete(t))})));var t,n}));return(0,i.Z)({snappingManager:v.snappingManager},h)}},71040:function(e,t,n){n.d(t,{y:function(){return y}});var i=n(74165),a=n(1413),r=n(15861),o=n(15671),s=n(43144),l=n(60136),u=n(29388),c=n(27366),d=n(7138),p=n(92026),f=n(66978),v=n(49861),h=(n(93169),n(32718),n(84936),n(69912)),m=n(93463),y=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var s;return(0,o.Z)(this,n),(s=t.call(this,e)).constrainResult=function(e){return e},s._snapPoints=null,s._frameTask=null,s._abortController=null,s._stagedPoint=null,s._snap=(0,f.Ds)(function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r,o){var l,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(l=s._frameTask)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,l.schedule((function(){return n.snap((0,a.Z)((0,a.Z)({},t),{},{context:r,signal:o}))}),o);case 5:if(u=e.sent,e.t0=u.valid,!e.t0){e.next=10;break}return e.next=10,l.schedule((function(){s.stagedPoint=u.apply(),t!==s._snapPoints&&null!=s._snapPoints&&(s.stagedPoint=n.update((0,a.Z)((0,a.Z)({},s._snapPoints),{},{context:r})))}),o);case 10:case"end":return e.stop()}}),e)})));return function(t,n,i,a){return e.apply(this,arguments)}}()),s}return(0,s.Z)(n,[{key:"stagedPoint",get:function(){return this._stagedPoint},set:function(e){this._stagedPoint=this.constrainResult(e)}},{key:"initialize",value:function(){var e,t,n="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(t=e.resourceController)||void 0===t?void 0:t.scheduler:null;this._frameTask=null!=n?n.registerTask(m.T8.SNAPPING):m.sq}},{key:"destroy",value:function(){this._abortController=(0,p.IM)(this._abortController),this._frameTask=(0,p.hw)(this._frameTask)}},{key:"update",value:function(e,t,n){this._snapPoints=e;var i=e.point,a=e.scenePoint,r=t.update({point:i,scenePoint:a,context:n});return this.stagedPoint=r,r}},{key:"snap",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,a){var r,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.point,o=t.scenePoint,e.abrupt("return",(this.stagedPoint=n.update({point:r,scenePoint:o,context:a}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,n,a,this._abortController.signal)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"snapAgainNearPreviousMapPoint",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this._snapPoints,!e.t0){e.next=4;break}return e.next=4,this.snap(this._snapPoints,t,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"abort",value:function(){this._abortController=(0,p.IM)(this._abortController),this._snapPoints=null}}]),n}(d.default);(0,c._)([(0,v.Cb)({constructOnly:!0})],y.prototype,"view",void 0),(0,c._)([(0,v.Cb)()],y.prototype,"stagedPoint",null),(0,c._)([(0,v.Cb)()],y.prototype,"constrainResult",void 0),(0,c._)([(0,v.Cb)()],y.prototype,"_stagedPoint",void 0),y=(0,c._)([(0,h.j)("esri.views.interactive.snapping.SnappingOperation")],y)},59418:function(e,t,n){n.d(t,{C_:function(){return o},Qw:function(){return s},x:function(){return l}});var i=n(12400),a=n(4914),r=n(13615);function o(e){var t;return null!==(t=(0,r.kQ)(e))&&void 0!==t?t:(0,a.Sx)(e)}function s(e,t){var n;return null!==(n=(0,r.RT)(e,t))&&void 0!==n?n:(0,a.xI)(e,t)}function l(e,t,n){var i;return u[0]=e[0],u[1]=e[1],u[2]=3===e.length?e[2]:0,c[0]=t[0],c[1]=t[1],c[2]=3===t.length?t[2]:0,null!==(i=(0,r.FB)(u,c,n))&&void 0!==i?i:(0,a.qj)(u,c,n)}var u=(0,i.Ue)(),c=(0,i.Ue)()}}]);
//# sourceMappingURL=89290.a7573fe4.chunk.js.map