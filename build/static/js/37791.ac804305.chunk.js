"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[37791],{71039:function(e,t,r){r.d(t,{z:function(){return G}});var n=r(37762),i=r(93433),a=r(15671),o=r(43144),u=r(60136),s=r(29388),l=r(27366),c=(r(59486),r(7138)),f=r(63780),y=r(32718),d=r(16889),p=r(25666),h=r(94172),v=r(68860),g=r(49861),b=(r(93169),r(69912)),m=r(32035),_=r(12400),w=r(54054),S=r(83448),E=r(79803),k=r(51066),I=r(5986),R=r(41414),F=r(65156),C=r(86372),x=r(22186),Z=r(92975),O=r(23470),j=r(81753),Q=r(18661),M=r(44011),T=r(78952),N="esri.views.3d.layers.i3s.I3SMeshViewFilter",D=function(){return y.Z.getLogger(N)},G=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e))._projectionEngineLoaded=!1,r}return(0,o.Z)(n,[{key:"initialize",value:function(){var e=this;(0,h.whenOnce)((function(){var t;return(null===(t=e.viewFilter)||void 0===t?void 0:t.geometry)||null!=e.layerFilter})).then((function(){return e.loadAsyncModule(Promise.all([r.e(99058),r.e(2170)]).then(r.bind(r,2170)).then((function(t){e.destroyed||(e._geometryEngine=t)})))}))}},{key:"sortedObjectIds",get:function(){var e;if(null==(null===(e=this.viewFilter)||void 0===e?void 0:e.objectIds))return null;var t=(0,C.QZ)(this.viewFilter.objectIds);return t.sort(),t}},{key:"parsedWhereClause",get:function(){var e,t=null===(e=this.viewFilter)||void 0===e?void 0:e.where;if(null==t||!t)return null;try{return w.WhereClause.create(t,this.layerFieldsIndex)}catch(r){D().error("Failed to parse filter where clause: ".concat(r))}return null}},{key:"addFilters",value:function(e,t,r,n){var i,a=this.sortedObjectIds;null!=a&&e.push((function(e){return(0,M.Yb)(a,!0,e)})),this.addSqlFilter(e,this.parsedWhereClause),this.addTimeFilter(e,null===(i=this.viewFilter)||void 0===i?void 0:i.timeExtent);var o=(0,p.lK)(this._layerMaskGeometries),u=this._geometryEngine;if(null!=o&&null!=this.layerFilter&&null!=u){var s=this.layerFilter.spatialRelationship;e.push((function(e,i){return q(u,e,i,n,t,r,o,s)}))}var l=(0,p.lK)(this._viewMaskGeometries);if(null!=l&&null!=this.viewFilter&&null!=u){var c=this.viewFilter.spatialRelationship;e.push((function(e,i){return q(u,e,i,n,t,r,l,c)}))}}},{key:"isMBSGeometryVisible",value:function(e,t,r){var n=(0,p.lK)(this._layerMaskGeometries),i=this._geometryEngine;if(null!=n&&null!=this.layerFilter&&null!=i){var a=this.layerFilter.spatialRelationship,o=n[0].spatialReference||t;return(0,k.s)(e,r,W,o)?V(i,W,n,o,a):(D().warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}var u=(0,p.lK)(this._viewMaskGeometries);if(null!=u&&null!=this.viewFilter&&null!=i){var s=this.viewFilter.spatialRelationship,l=u[0].spatialReference||t;return(0,k.s)(e,r,W,l)?V(i,W,u,l,s):(D().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}return!0}},{key:"parsedGeometry",get:function(){var e=(0,p.lK)(this._viewMaskGeometries),t=(0,p.lK)(this._layerMaskGeometries);return null==e||null==t?e||t:t.concat(e)}},{key:"_layerMaskGeometries",get:function(){var e=this.layerFilter;return null==e?null:null==this._geometryEngine?p.cn:"disjoint"===e.spatialRelationship?e.geometries.map((function(e){return{type:"polygon",rings:e.rings,spatialReference:e.spatialReference,cache:{}}})):[e.geometries.reduce((function(e,t){return e.rings=[].concat((0,i.Z)(e.rings),(0,i.Z)(t.rings)),e}),{type:"polygon",rings:[],spatialReference:e.geometries[0].spatialReference,cache:{}})]}},{key:"_viewMaskGeometries",get:function(){var e=this;if(null==this.viewFilter)return null;var t=this.viewFilter.geometry;if(null==t)return null;if(null==this.viewFilter||null==this._geometryEngine)return p.cn;var r=this.viewFilter,n=r.distance,i=r.units,a=this.viewFilter.spatialRelationship,o="mesh"===t.type?t.extent:t;if(null==n||0===n)return P(this._geometryEngine,o,a);var u=i||(0,v.qE)(o.spatialReference);if(o.spatialReference.isWGS84){var s=this._geometryEngine.geodesicBuffer(o,n,u);return P(this._geometryEngine,s,a)}var l=(0,j.iV)(o,T.Z.WGS84);if(null!=l){var c=(0,j.iV)(this._geometryEngine.geodesicBuffer(l,n,u),o.spatialReference);return P(this._geometryEngine,c,a)}if(!this._projectionEngineLoaded&&(this.loadAsyncModule((0,E.load)().then((function(){return e._projectionEngineLoaded=!0}))),!this._projectionEngineLoaded))return null;var f=null;try{f=(0,E.project)(o,T.Z.WGS84)}catch(y){}if(f)try{f=(0,E.project)(this._geometryEngine.geodesicBuffer(f,n,u),o.spatialReference)}catch(y){f=null}return f||D().error("Filter by geodesic buffer (distance) unsupported, failed to project input geometry (".concat(o.spatialReference.wkid,") to WGS84.")),P(this._geometryEngine,f,a)}},{key:"updating",get:function(){return(0,p.j)(this._layerMaskGeometries)||(0,p.j)(this._viewMaskGeometries)}}],[{key:"checkSupport",value:function(e){return null!=e&&(!!function(e){return null!=e&&J.includes(e)}(e.spatialRelationship)||(D().warn("Filters with spatialRelationship other than ".concat(J.join(", ")," are not supported for mesh scene layers")),!1))}}]),n}(c.default);(0,l._)([(0,g.Cb)()],G.prototype,"layerFilter",void 0),(0,l._)([(0,g.Cb)({type:Q.Z})],G.prototype,"viewFilter",void 0),(0,l._)([(0,g.Cb)()],G.prototype,"layerFieldsIndex",void 0),(0,l._)([(0,g.Cb)()],G.prototype,"loadAsyncModule",void 0),(0,l._)([(0,g.Cb)()],G.prototype,"addSqlFilter",void 0),(0,l._)([(0,g.Cb)()],G.prototype,"addTimeFilter",void 0),(0,l._)([(0,g.Cb)({readOnly:!0})],G.prototype,"sortedObjectIds",null),(0,l._)([(0,g.Cb)({readOnly:!0})],G.prototype,"parsedWhereClause",null),(0,l._)([(0,g.Cb)({readOnly:!0})],G.prototype,"parsedGeometry",null),(0,l._)([(0,g.Cb)({readOnly:!0})],G.prototype,"_layerMaskGeometries",null),(0,l._)([(0,g.Cb)({readOnly:!0})],G.prototype,"_viewMaskGeometries",null),(0,l._)([(0,g.Cb)()],G.prototype,"updating",null),(0,l._)([(0,g.Cb)()],G.prototype,"_projectionEngineLoaded",void 0),(0,l._)([(0,g.Cb)()],G.prototype,"_geometryEngine",void 0),G=(0,l._)([(0,b.j)(N)],G);var A,K,J=["contains","intersects","disjoint"];function P(e,t,r){if(null==t)return null;if("disjoint"===r&&"polygon"===t.type){var n=function(){for(var r=t.rings.length,n=t.spatialReference,i=new Array(r),a=0;a<r;++a){var o=(0,F.al)(1/0,1/0,-1/0,-1/0);(0,F.Wi)(o,t.rings[a]),i[a]={type:"polygon",rings:[t.rings[a]],spatialReference:n,cache:{},aabr:o}}i.sort((function(e,t){return e.aabr[0]-t.aabr[0]}));for(var u=new Set,s=new f.SO,l=function(t){var r=i[t],n=r.aabr[0];u.forEach((function(t){if(n>=t.aabr[2])u.delete(t);else if(!(r.aabr[1]>t.aabr[3]||r.aabr[3]<t.aabr[1])&&e.intersects(r,t)){r.rings=r.rings.concat(t.rings),(0,F.jn)(r.aabr,t.aabr,r.aabr),r.cache={},u.delete(t);var a=(0,f.cq)(i,t,i.length,s);i.splice(a,1)}})),u.add(r)},c=0;c<i.length;++c)l(c);for(var y=0,d=i;y<d.length;y++){d[y].aabr=void 0}return{v:i}}();if("object"===typeof n)return n.v}return[t]}function V(e,t,r,n,i){if(t[3]>=.5*(t[2]+(0,S.Iu)(n).radius))return!0;var a=B(e,t,n);return r.every((function(t){return L(e,t,a,i)!==A.DISCARD}))}function q(e,t,r,i,a,o,u,s){var l=u[0].spatialReference||a.spatialReference;if((0,k.s)(r.node.serviceMbsInIndexSR,o,W,l)){var c,f=B(e,W,l),y=function(e,t,r,n,i){var a=t.renderSpatialReference,o=new Map,u={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],spatialReference:r};u.rings[0][3]=u.rings[0][0];var s,l,c={indices:null,data:null,stride:0,startIndex:0,endIndex:0};switch(e){case"intersects":s=function(e,t,r){return e.intersects(t,r)?A.KEEP:A.TEST},l=U;break;case"contains":s=function(e,t,r){return e.contains(t,r)?A.TEST:A.DISCARD},l=U;break;default:s=function(e,t,r){return e.disjoint(t,r)?A.TEST:A.DISCARD},l=z}return{collection:n,object:i,type:e,maskSR:r,renderSR:a,aabbCache:o,triangle:u,positions:c,triangleTest:s,geometryTest:l}}(s,a,l,i,r.objectHandle),d=(0,n.Z)(u);try{var p=function(){var n=c.value;if(0===t.length)return{v:void 0};switch(L(e,n,f,s)){case A.DISCARD:return{v:void(t.length=0)};case A.KEEP:return"continue"}(0,M.hv)(t,r.featureIds,(function(t){return function(e,t,r,n){var i=n.collection,a=n.object,o=n.renderSR,u=n.maskSR,s=n.geometryTest,l=n.aabbCache,c=l.get(r);if(!c){var f=i.getObjectTransform(a);i.getComponentAabb(a,r,H);for(var y=[(0,_.al)(H[0],H[1],0),(0,_.al)(H[0],H[4],0),(0,_.al)(H[3],H[4],0),(0,_.al)(H[3],H[1],0)],d=0;d<4;++d)(0,m.t)(y[d],y[d],f.rotationScale),(0,m.g)(y[d],y[d],f.position),(0,I.S)(y[d],o,y[d],u);(c={type:"polygon",rings:[y],spatialReference:u,cache:{}}).rings[0][4]=c.rings[0][0],l.set(r,c)}switch(s(e,t,c)){case A.DISCARD:return!1;case A.KEEP:return!0}var p=n.triangle,h=n.triangleTest,v=n.positions,g=p.rings[0][0],b=p.rings[0][1],w=p.rings[0][2],S=i.getObjectTransform(a);i.getComponentPositions(a,r,v);for(var E=v.indices,k=v.data,R=v.stride,F=v.startIndex,C=v.endIndex,x=F;x<C;x+=3){var Z=R*E[x],O=R*E[x+1],j=R*E[x+2];switch((0,m.s)(g,k[Z],k[Z+1],k[Z+2]),(0,m.s)(b,k[O],k[O+1],k[O+2]),(0,m.s)(w,k[j],k[j+1],k[j+2]),(0,m.t)(g,g,S.rotationScale),(0,m.t)(b,b,S.rotationScale),(0,m.t)(w,w,S.rotationScale),(0,m.g)(g,g,S.position),(0,m.g)(b,b,S.position),(0,m.g)(w,w,S.position),(0,I.S)(g,o,g,u),(0,I.S)(b,o,b,u),(0,I.S)(w,o,w,u),h(e,t,p)){case A.DISCARD:return!1;case A.KEEP:return!0}}return"intersects"!==n.type}(e,n,t,y)}))};for(d.s();!(c=d.n()).done;){var h=p();if("continue"!==h&&"object"===typeof h)return h.v}}catch(v){d.e(v)}finally{d.f()}}else D().warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}(K=A||(A={}))[K.KEEP=0]="KEEP",K[K.DISCARD=1]="DISCARD",K[K.TEST=2]="TEST";var W=(0,O.f)(0,0,0,0);function B(e,t,r){var n={type:"point",x:t[0],y:t[1],hasZ:!1,hasM:!1,spatialReference:r},i=!(0,Z.oR)(r)&&!(0,Z.sS)(r),a=Number.isNaN(t[3])?0:(0,d.uZ)(t[3],0,2*x.sv.radius),o=i?e.buffer(n,a,1):e.geodesicBuffer(n,a,1);return o.type="polygon",o}function L(e,t,r,n){switch(n){case"intersects":case"contains":return U(e,t,r);case"disjoint":return z(e,t,r)}}function U(e,t,r){return e.intersects(t,r)?e.contains(t,r)?A.KEEP:A.TEST:A.DISCARD}function z(e,t,r){return e.intersects(t,r)?e.contains(t,r)?A.DISCARD:A.TEST:A.KEEP}var H=(0,R.Ue)()},43812:function(e,t,r){r.d(t,{u:function(){return S}});var n=r(74165),i=r(15861),a=r(15671),o=r(43144),u=r(60136),s=r(29388),l=r(27366),c=r(7138),f=r(10064),y=r(92026),d=r(49861),p=(r(93169),r(32718),r(84936),r(69912)),h=r(53866),v=r(28970),g=r(75878),b=r(52410),m=r(49818),_=r(21149),w=g.q,S=function(e){(0,u.Z)(r,e);var t=(0,s.Z)(r);function r(e){return(0,a.Z)(this,r),t.call(this,e)}return(0,o.Z)(r,[{key:"spatialReference",get:function(){return this.layerView.view.spatialReference}},{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"defaultQueryJSON",get:function(){return new _.Z({outSpatialReference:this.spatialReference}).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}},{key:"initialize",value:function(){var e=this;this.addHandles(this.layerView.on("visible-geometry-changed",(function(){return e.spatialIndex.events.emit("changed")})))}},{key:"destroy",value:function(){this._dataQueryEngineInstance=(0,y.SC)(this._dataQueryEngineInstance),this._set("layerView",null)}},{key:"executeQueryForCount",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),r);case 2:return i=e.sent,a=i.count,o=i.extent,e.abrupt("return",{count:a,extent:h.Z.fromJSON(o)});case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQuery",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(t,r){var i,a,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=this._ensureQueryJSON(t)).returnGeometry){e.next=3;break}throw new f.Z("unsupported-query","returnGeometry is not supported when querying a mesh scene layer view, it is only supported when directly querying a scene layer");case 3:if(!i.returnCentroid){e.next=5;break}throw new f.Z("unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");case 5:return e.next=7,this._dataQueryEngine.executeQuery(i,r);case 7:return a=e.sent,o=m.Z.fromJSON(a),e.abrupt("return",(o.features.forEach((function(e){return e.geometry=null})),o));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_ensureQueryJSON",value:function(e){return null==e?this.defaultQueryJSON:e.toJSON()}},{key:"_ensureDataQueryEngine",value:function(){var e;if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var t=this.layer.objectIdField||v.d,r=(null===(e=this.layer.fieldsIndex)||void 0===e?void 0:e.toJSON())||new b.Z([]),n=this.layerView.view.resourceController.scheduler,i=this.spatialReference.toJSON(),a=this.priority,o=this.spatialIndex;return this._dataQueryEngineInstance=new w({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fieldsIndex:r,timeInfo:null,spatialReference:i,objectIdField:t,featureStore:o,scheduler:n,priority:a}),this._dataQueryEngineInstance}}]),r}(c.default);(0,l._)([(0,d.Cb)({constructOnly:!0})],S.prototype,"layerView",void 0),(0,l._)([(0,d.Cb)({constructOnly:!0})],S.prototype,"priority",void 0),(0,l._)([(0,d.Cb)({constructOnly:!0})],S.prototype,"spatialIndex",void 0),(0,l._)([(0,d.Cb)()],S.prototype,"spatialReference",null),(0,l._)([(0,d.Cb)()],S.prototype,"layer",null),(0,l._)([(0,d.Cb)()],S.prototype,"defaultQueryJSON",null),S=(0,l._)([(0,p.j)("esri.views.3d.layers.i3s.I3SQueryEngine")],S)},51246:function(e,t,r){r.d(t,{u:function(){return c}});var n=r(29439),i=r(15671),a=r(43144),o=r(41414),u=r(85403),s=r(80457),l=r(44011),c=function(){function e(t){(0,i.Z)(this,e),this._objectIdField=t.objectIdField,this._getFeatureExtent=t.getFeatureExtent}return(0,a.Z)(e,[{key:"getObjectId",value:function(e){return e.id}},{key:"getAttributes",value:function(e){var t,r=e.meta,n=e.index,i={};this._objectIdField&&(i[this._objectIdField]=e.id);var a=null===(t=r.attributeInfo)||void 0===t?void 0:t.attributeData;if(null!=a)for(var o=0,u=Object.keys(a);o<u.length;o++){var s=u[o];i[s]=(0,l.Jx)(a[s],n)}return i}},{key:"getAttribute",value:function(e,t){var r;if(t===this._objectIdField)return e.id;var n=e.meta,i=e.index,a=null===(r=n.attributeInfo)||void 0===r?void 0:r.attributeData;return null!=a?(0,l.Jx)(a[t],i):null}},{key:"getGeometry",value:function(e){if(e.geometry)return e.geometry;var t=this._getFeatureExtent(e,f),r=(0,n.Z)(t,5),i=r[0],a=r[1],o=r[2],u=r[3],l=r[4];return new s.Z([5],[i,a,o,u,a,o,u,l,o,i,l,o,i,a,o])}},{key:"getCentroid",value:function(e,t){if(e.geometry)return(0,u.Y)(new s.Z,e.geometry,t.hasZ,t.hasM);var r=this._getFeatureExtent(e,f),i=(0,n.Z)(r,6),a=i[0],o=i[1],l=i[2],c=i[3],y=i[4],d=i[5];return new s.Z([0],[(a+c)/2,(o+y)/2,(l+d)/2])}},{key:"cloneWithGeometry",value:function(e,t){return{id:e.id,index:e.index,meta:e.meta,geometry:t}}}]),e}(),f=(0,o.Ue)()},73552:function(e,t,r){r.d(t,{I:function(){return m}});var n=r(37762),i=r(15671),a=r(43144),o=r(60136),u=r(29388),s=r(27366),l=r(7138),c=r(91505),f=r(49861),y=(r(93169),r(32718),r(84936),r(69912)),d=r(51066),p=r(41414),h=r(65156),v=r(23470),g=r(42757),b=(0,p.Ue)(),m=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).events=new c.Z,n}return(0,a.Z)(r,[{key:"forEach",value:function(e){this.forAllFeatures((function(t){return e(t),g.Ku.CONTINUE}))}},{key:"forEachBounds",value:function(e,t){var r,i=this.getFeatureExtent,a=(0,n.Z)(e);try{for(a.s();!(r=a.n()).done;){t(i(r.value,b))}}catch(o){a.e(o)}finally{a.f()}}},{key:"forEachInBounds",value:function(e,t){var r=this;this.forAllFeatures((function(n){var i=r.getFeatureExtent(n,w);return(0,h.kK)(e,(0,p.y8)(i,S))&&t(n),g.Ku.CONTINUE}),(function(t){if((0,d.s)(t.node.serviceMbsInIndexSR,r.sourceSpatialReference,_,r.viewSpatialReference),_[0]>=e[0]&&_[2]<=e[2]&&_[1]>=e[1]&&_[3]<=e[3])return g.Ku.CONTINUE;var n=Math.max(e[0],Math.min(_[0],e[2])),i=Math.max(e[1],Math.min(_[1],e[3])),a=_[0]-n,o=_[1]-i;return a*a+o*o<=_[3]*_[3]?g.Ku.CONTINUE:g.Ku.SKIP}))}}]),r}(l.default);(0,s._)([(0,f.Cb)({constructOnly:!0})],m.prototype,"featureAdapter",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],m.prototype,"forAllFeatures",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],m.prototype,"getFeatureExtent",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],m.prototype,"sourceSpatialReference",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],m.prototype,"viewSpatialReference",void 0),m=(0,s._)([(0,y.j)("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],m);var _=(0,v.f)(0,0,0,0),w=(0,p.Ue)(),S=(0,h.Ue)()}}]);
//# sourceMappingURL=37791.ac804305.chunk.js.map