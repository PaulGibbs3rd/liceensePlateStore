"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[39199],{23254:function(e,t,i){i.d(t,{a:function(){return h}});var r=i(37762),n=i(15671),a=i(43144),s=2654435761,u=2246822519,o=3266489917,l=668265263,c=374761393;function d(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e.charCodeAt(i);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<55296||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(i++,n=65536+((1023&n)<<10|1023&e.charCodeAt(i)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(t)}var h=function(){function e(t){(0,n.Z)(this,e),this._seed=t,this._totallen=0,this._bufs=[],this.init()}return(0,a.Z)(e,[{key:"init",value:function(){return this._bufs=[],this._totallen=0,this}},{key:"updateFloatArray",value:function(e){var t,i=[],n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;isNaN(a)?i.push("NaN"):a===1/0?i.push("Infinity"):a===-1/0?i.push("-Infinity"):0===a?i.push("0"):i.push(a.toString(16))}}catch(s){n.e(s)}finally{n.f()}this.update(d(i.join("")))}},{key:"updateIntArray",value:function(e){var t=Int32Array.from(e);this.update(new Uint8Array(t.buffer))}},{key:"updateUint8Array",value:function(e){this.update(Uint8Array.from(e))}},{key:"updateWithString",value:function(e){return this.update(d(e))}},{key:"update",value:function(e){return this._bufs.push(e),this._totallen+=e.length,this}},{key:"digest",value:function(){var e,t=new Uint8Array(this._totallen),i=0,n=(0,r.Z)(this._bufs);try{for(n.s();!(e=n.n()).done;){var a=e.value;t.set(a,i),i+=a.length}}catch(s){n.e(s)}finally{n.f()}return this.init(),this._xxHash32(t,this._seed)}},{key:"_xxHash32",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e,r=t+c&4294967295,n=0;if(i.length>=16){var a=[t+s+u&4294967295,t+u&4294967295,t+0&4294967295,t-s&4294967295],d=e,h=d.length-16,p=0;for(n=0;(4294967280&n)<=h;n+=4){var f=n,y=d[f]+(d[f+1]<<8),v=d[f+2]+(d[f+3]<<8),_=y*u+(v*u<<16),g=a[p]+_&4294967295,m=65535&(g=g<<13|g>>>19),b=g>>>16;a[p]=m*s+(b*s<<16)&4294967295,p=p+1&3}r=(a[0]<<1|a[0]>>>31)+(a[1]<<7|a[1]>>>25)+(a[2]<<12|a[2]>>>20)+(a[3]<<18|a[3]>>>14)&4294967295}r=r+e.length&4294967295;for(var F=e.length-4;n<=F;n+=4){var x=n,C=i[x]+(i[x+1]<<8),k=i[x+2]+(i[x+3]<<8);r=(65535&(r=(r=r+(C*o+(k*o<<16))&4294967295)<<17|r>>>15))*l+((r>>>16)*l<<16)&4294967295}for(;n<i.length;++n)r=(65535&(r=(r+=i[n]*c)<<11|r>>>21))*s+((r>>>16)*s<<16)&4294967295;return r=((65535&(r^=r>>>15))*u&4294967295)+((r>>>16)*u<<16),r=((65535&(r^=r>>>13))*o&4294967295)+((r>>>16)*o<<16),(r^=r>>>16)<0?r+4294967296:r}}]),e}()},23819:function(e,t,i){i.d(t,{H:function(){return p},b:function(){return h}});var r,n,a=i(30168),s=i(24967),u=i(64600),o=i(58406),l=i(98634),c=i(64201),d=i(19253);function h(e){var t=new c.kG;t.include(s.k),t.include(u.f);var i=e.usesHalfFloat;return t.fragment.uniforms.add(new d.A("densityMap",(function(e){return e.densityMap})),new d.A("tex",(function(e){return e.colorRamp})),new o.p("densityNormalizer",(function(e){return 1/(e.maxDensity-e.minDensity)})),new o.p("minDensity",(function(e){return e.minDensity})),new o.p("densityMultiplier",(function(e){return 3/(e.searchRadius*e.searchRadius*Math.PI)}))),i&&t.constants.add("compressionFactor","float",4),t.fragment.code.add((0,l.H)(r||(r=(0,a.Z)(["\n    void main() {\n      float density = texture(densityMap, uv).r * densityMultiplier",";\n      float densityRatio = (density - minDensity) * densityNormalizer;\n\n      vec4 color = texture(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));\n\n      discardOrAdjustAlpha(color);\n      fragColor = color;\n    }\n  "])),i?(0,l.H)(n||(n=(0,a.Z)([" * compressionFactor"]))):"")),t}var p=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},65322:function(e,t,i){i.d(t,{H:function(){return y},b:function(){return f}});var r,n,a,s,u,o=i(30168),l=i(41012),c=i(58406),d=i(98634),h=i(64201),p=i(4760);function f(e){var t=new h.kG,i=t.vertex,f=t.fragment,y=t.attributes,v=t.varyings;(0,l.Sv)(i,e);var _=e.isAttributeDriven,g=e.usesHalfFloat;return y.add(p.T.POSITION,"vec3"),y.add(p.T.UV0,"vec2"),_&&(y.add(p.T.FEATUREATTRIBUTE,"float"),v.add("attributeValue","float")),g&&t.constants.add("compressionFactor","float",.25),v.add("unitCirclePos","vec2"),i.uniforms.add(new c.p("radius",(function(e,t){var i=e.resolutionForScale,r=e.searchRadius,n=t.camera,a=t.screenToWorldRatio,s=t.overlayStretch;return 2*r*(0===i?1:i/a)*n.pixelRatio/n.fullViewport[2]/s}))),i.code.add((0,d.H)(r||(r=(0,o.Z)(["\n    void main() {\n      unitCirclePos = uv0;\n\n      vec4 posProj = proj * (view * vec4(",", 1.0));\n      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);\n\n      ","\n      gl_Position = posProj + quadOffset;\n    }\n  "])),p.T.POSITION,_?(0,d.H)(n||(n=(0,o.Z)(["attributeValue = ",";"])),p.T.FEATUREATTRIBUTE):"")),f.code.add((0,d.H)(a||(a=(0,o.Z)(["\n    void main() {\n      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);\n      if (radiusRatioSquared > 1.0) {\n        discard;\n      }\n\n      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;\n      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared "," ",";\n      fragColor = vec4(density);\n    }\n  "])),_?(0,d.H)(s||(s=(0,o.Z)([" * attributeValue"]))):"",g?(0,d.H)(u||(u=(0,o.Z)([" * compressionFactor"]))):"")),t}var y=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}))},5845:function(e,t,i){i.d(t,{g:function(){return j}});var r=i(37762),n=i(74165),a=i(15861),s=i(15671),u=i(43144),o=i(60136),l=i(29388),c=i(27366),d=i(7138),h=i(14921),p=i(80987),f=i(93169),y=i(10064),v=i(84652),_=i(32718),g=i(92026),m=i(67426),b=i(66978),F=i(94172),x=i(49861),C=i(69912),k=i(46634),E=i(25899),w=i(37933),R=i(67387),S=i(33997),T=i(32080),Z=i(29439),O=i(51995),D=i(52639),P=(i(51508),i(80885)),I=i(43977),V=i(62554),M=i(1030),A=i(87037),N=i(61054),L=i(62140),H=i(98351),G=i(21897),U=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],q=function(){function e(t,i,r){(0,s.Z)(this,e),this._loadingGraphics=new Map,this._loadedGraphics=new Map,this._pendingGraphics=new Map,this._dataExtentGraphic=null,this._enabled=!0,this._tileFetcher=t,this._view=r,this._tilingScheme=new L.t(i),this._loadedSymbols=U.map((function(e){return new M.Z({symbolLayers:new p.Z([new I.Z({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}})])})})),this._loadingSymbols=[new M.Z({symbolLayers:new p.Z([new I.Z({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}})])})],this._pendingSymbols=[new M.Z({symbolLayers:new p.Z([new I.Z({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}})])})],this._dataExtentSymbol=new M.Z({symbolLayers:new p.Z([new I.Z({material:{color:[0,0,0,0]},outline:{color:"green",size:4}})])})}return(0,u.Z)(e,[{key:"destroy",value:function(){this.enabled=!1}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},{key:"update",value:function(){var e=this;this._enabled?(this._synchronizeMaps(this._loadingGraphics,{filter:function(e){return e.isFetching},symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach((function(t){e._view.graphics.removeMany(t)})),this._loadingGraphics.clear(),this._loadedGraphics.forEach((function(t){e._view.graphics.removeMany(t)})),this._loadedGraphics.clear(),this._pendingGraphics.forEach((function(t){e._view.graphics.removeMany(t)})),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))}},{key:"showDataExtent",value:function(e){if(this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null),null!=e){var t=P.Z.fromExtent(e);this._dataExtentGraphic=new D.Z({geometry:t,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic)}}},{key:"_synchronizeMaps",value:function(e,t){var i=this,r=[];e.forEach((function(e,n){var a=i._tileFetcher.test.getFeatureTileById(n);a&&t.filter(a)||(i._view.graphics.removeMany(e),r.push(n))})),r.forEach((function(t){return e.delete(t)})),this._tileFetcher.test.forEachFeatureTile((function(r){if(t.filter(r)&&!e.has(r.id)){var n=(0,Z.Z)(r.descriptor.lij,3),a=n[0],s=n[1],u=n[2];i._tilingScheme.ensureMaxLod(a);var o=i._tilingScheme.getExtentGeometry(a,s,u),l=[new D.Z({geometry:o,symbol:t.symbols[a%t.symbols.length]}),new D.Z({geometry:o.center,symbol:new V.Z({verticalOffset:new N.Z({screenLength:40/.75}),callout:new H.Z({color:new O.Z("white"),border:new G.Z({color:new O.Z("black")})}),symbolLayers:new p.Z([new A.Z({text:"".concat(a,"/").concat(s,"/").concat(u),halo:{color:"white",size:1/.75},material:{color:"black"},size:16})])})})];e.set(r.id,l),i._view.graphics.addMany(l)}}))}}]),e}(),z=i(94463),j=function(e){(0,o.Z)(i,e);var t=(0,l.Z)(i);function i(e){var r;return(0,s.Z)(this,i),(r=t.call(this,e)).type="feature-tile-3d",r._updatingHandles=new k.R,r.serviceDataExtent=null,r.serviceDataCount=Q.noServiceDataCount,r._snapshotLimitExceeded=!1,r.displayFeatureLimit=null,r._forceTilesMode=!1,r._suspended=!1,r._tileFetcher=null,r._fetchDataInfoPromise=null,r._fetchDataInfoAbortController=null,r._lifeCycleAbortController=new AbortController,r}return(0,u.Z)(i,[{key:"dataUpdating",get:function(){var e,t;return null!==(e=null===(t=this._tileFetcher)||void 0===t?void 0:t.dataUpdating)&&void 0!==e&&e}},{key:"extent",set:function(e){if(null==e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&(null==t||!e||!t.equals(e))){var i=null!=e?e.clone():null;this._set("extent",i)}}else _.Z.getLogger(this).error("#extent=","extent needs to be in the same spatial reference as the view")}},{key:"updating",get:function(){return!!(null!=this._tileFetcher&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._updatingHandles&&this._updatingHandles.updating)}},{key:"updatingTotal",get:function(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&null!=this._tileFetcher?this._tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return null!=this._tileFetcher?this._tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(null==this._tileFetcher||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){var e,t;return null!==(e=null===(t=this.displayFeatureLimit)||void 0===t?void 0:t.maximumNumberOfFeatures)&&void 0!==e?e:0},set:function(e){e!==this.maximumNumberOfFeatures&&this._overrideIfSome("maximumNumberOfFeatures",e)}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"hasAllFeatures",get:function(){return this.serviceDataCount===Q.noServiceDataCount&&"snapshot"===this.mode&&this.hasAllFeaturesInView||this.serviceDataCount===this.graphics.length}},{key:"hasAllFeaturesInView",get:function(){var e,t;return null!==(e=null===(t=this._tileFetcher)||void 0===t?void 0:t.hasAllFeatures)&&void 0!==e&&e}},{key:"hasFullGeometries",get:function(){var e,t;return null!==(e=null===(t=this._tileFetcher)||void 0===t?void 0:t.hasFullGeometries)&&void 0!==e&&e}},{key:"mode",get:function(){var e,t,i=this.layerView.layer;if("feature"===i.type&&null!=i.infoFor3D)return"snapshot";if("catalog-footprint"===i.type)return"tiles";if(this._forceTilesMode)return"tiles";var r=this.layerView.view;if(!1===(null===(e=r.qualitySettings)||void 0===e||null===(t=e.graphics3D)||void 0===t?void 0:t.snapshotAvailable)||this.serviceDataCount===Q.noServiceDataCount||this._snapshotLimitExceeded||this.maximumNumberOfFeaturesExceeded||r.quality<1)return"tiles";var n=r&&r.featureTiles,a=n&&n.tilingScheme;if(i&&i.minScale&&this.serviceDataExtent&&a){var s=this._approximateExtentSizeAtScale(i.minScale,a);if((this.serviceDataExtent.width/s+this.serviceDataExtent.height/s)/2>Q.maxSnapshotMinScaleFactor)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){var e,t=this._get("maxTotalSnapshotVertices")||0,i="snapshot"===this.mode&&(null===(e=this._tileFetcher)||void 0===e?void 0:e.totalVertices)||0;return Math.max(t,i)}},{key:"_approximateExtentSizeAtScale",value:function(e,t){var i=this.layerView.view,r=Math.ceil((i.width/t.pixelSize+i.height/t.pixelSize)/2),n=t.levels[0];return r*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)}},{key:"tileDescriptors",get:function(){var e=this.layerView.view.featureTiles;return"snapshot"===this.mode?new p.Z([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):e?e.tiles:new p.Z}},{key:"test",get:function(){}},{key:"initialize",value:function(){var e=this;this._updatingHandles.add((function(){return e.displayFeatureLimit}),(function(t){return e._updatingHandles.addPromise(e._updateSnapshotLimit(t,null,e._lifeCycleAbortController.signal))})),this._updatingHandles.add((function(){return e.mode}),(function(){return e._modeChanged()}),F.initial),this._updatingHandles.add((function(){return e.mode}),(function(t,i){"tiles"===t&&"snapshot"===i&&(e._forceTilesMode=!0)}),F.initial),this.addResolvingPromise(Promise.resolve().then((function(){return e._verifyCapabilities()})).then((function(){return e._updatingHandles.addPromise(e._fetchServiceDataInfo())})).then((function(){return e._initializeTileFetcher()})))}},{key:"_verifyCapabilities",value:function(){var e,t=this.layerView.layer;if("ogc-feature"!==t.type&&(null===(e=(0,w.S1)(t))||void 0===e||!e.operations.supportsQuery))throw new y.Z("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:t})}},{key:"destroy",value:function(){this._cancelFetchServiceDataInfo(),this._tileFetcher=(0,g.SC)(this._tileFetcher),this._tilesHandle=(0,g.hw)(this._tilesHandle),this._lifeCycleAbortController=(0,g.IM)(this._lifeCycleAbortController),this._updatingHandles.destroy(),this._set("_updatingHandles",null)}},{key:"suspend",value:function(){this._suspended||(this._suspended=!0,null!=this._tileFetcher&&this._tileFetcher.suspend())}},{key:"resume",value:function(){this._suspended&&(this._suspended=!1,null!=this._tileFetcher&&this._tileFetcher.resume())}},{key:"restart",value:function(){var e=this,t=function(){null!=e._tileFetcher&&e._tileFetcher.restart()};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(t,t))}},{key:"refetch",value:function(){this._refetch({resetForceTilesMode:!1})}},{key:"getMissingAttributesForFeature",value:function(e){var t;return null===(t=this._tileFetcher)||void 0===t?void 0:t.getMissingAttributesForFeature(e)}},{key:"_refetch",value:function(e){var t=this,i=function(){null!=t._tileFetcher&&(e.resetForceTilesMode&&(t._forceTilesMode=!1),t._tileFetcher.refetch())};this._updatingHandles.addPromise(this._fetchServiceDataInfo().then(i,i))}},{key:"_initializeTileFetcher",value:function(){var e=this,t=this.layerView.view;if(t){var i=(0,F.whenOnce)((function(){var e;return null===(e=t.featureTiles)||void 0===e?void 0:e.tilingScheme}),this._lifeCycleAbortController.signal);this._updatingHandles.addPromise(i),i.then((function(){var t=e.layerView,i=e.tileDescriptors,r=t.layer,n=new T.j({context:e.context,filterExtent:e.extent,tileDescriptors:i,features:e.graphics});e._tileFetcher=n,e._suspended?n.suspend():n.resume();var a=e.layerView.view;a&&e.addHandles((0,F.watch)((function(){return a.quality}),(function(e){return n.memoryFactor=e}),F.syncAndInitial));var s="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;s&&e.addHandles((0,F.watch)((function(){var t,i,r;return null===(t=e.layerView.view)||void 0===t||null===(i=t.qualitySettings)||void 0===i||null===(r=i.graphics3D)||void 0===r?void 0:r[s]}),(function(e){return n.lodFactor=e||1}),F.initial));"ogc-feature"!==r.type&&e._updatingHandles.add((function(){return r.createQueryVersion}),(function(){return e._dataFilterChanged()})),e._updatingHandles.add((function(){return t.availableFields}),(function(t,i){return e._availableFieldsChanged(i,t)})),e._updatingHandles.add((function(){return t.requiredFields}),(function(t,i){return e._requiredFieldsChanged(i,t)})),"customParameters"in r&&e._updatingHandles.add((function(){return r.customParameters}),(function(){return e.restart()})),e.addHandles([r.on("apply-edits",(function(t){return e._applyEdits(t)})),(0,F.watch)((function(){return e.extent}),(function(e){return n.filterExtent=e}),F.sync),(0,F.watch)((function(){return e.tileDescriptors}),(function(e){return n.tileDescriptors=e}),F.sync),(0,F.watch)((function(){return e.maximumNumberOfFeatures}),(function(t){n.maximumNumberOfFeatures=t,n.useTileCount=e.serviceDataCount>t}),F.syncAndInitial),(0,F.watch)((function(){return e.serviceDataCount}),(function(t){n.useTileCount=t>e.maximumNumberOfFeatures}),F.syncAndInitial),(0,F.watch)((function(){return z.h.FEATURE_TILE_FETCH_SHOW_TILES}),(function(t){t&&n&&!n.debugger?(n.debugger=new q(n,a.featureTiles.tilingScheme.toTileInfo(),a),n.debugger.update()):!t&&e._tileFetcher&&n.debugger&&(n.debugger.destroy(),n.debugger=null)}),F.syncAndInitial)]),e._supportsExceedsLimitQuery||e._updatingHandles.add((function(){return e.maxTotalSnapshotVertices}),(function(){return e._updatingHandles.addPromise(e._updateSnapshotLimit(e.displayFeatureLimit,null,e._lifeCycleAbortController.signal))}))})).catch((function(){}))}}},{key:"_modeChanged",value:function(){switch(this.mode){case"tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:_.Z.getLogger(this).warn("Unhandled feature layer mode "+this.mode);case"snapshot":null!=this._tilesHandle&&(this._tilesHandle.remove(),this._tilesHandle=null)}}},{key:"_dataFilterChanged",value:function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this._refetch({resetForceTilesMode:!0})}},{key:"_applyEdits",value:function(e){var t=this,i=this.layerView.layer;null!=this._tileFetcher&&this._tileFetcher.applyEdits(e).then((function(e){if(e){if(!t._lifeCycleAbortController)throw(0,b.zE)();e.exceededTransferLimit&&"refresh"in i?i.refresh():(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t._updatingHandles.addPromise(t._updateServiceDataExtent(t._lifeCycleAbortController.signal))}})).catch((function(e){if(!(0,b.D_)(e))throw e}))}},{key:"_availableFieldsChanged",value:function(e,t){null!=this._tileFetcher&&X(this._tileFetcher.availableFields,t)&&this._refetch({resetForceTilesMode:!1})}},{key:"_requiredFieldsChanged",value:function(e,t){null!=this._tileFetcher&&X(this._tileFetcher.availableFields,t)&&this.restart()}},{key:"_createVertexLimitExceededQuery",value:function(e){var t,i=this.layerView.layer,r=i.createQuery();return r.returnGeometry=!1,r.outStatistics=[new S.Z({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],null!==(t=i.capabilities)&&void 0!==t&&t.query.supportsCacheHint&&(r.cacheHint=!0),r}},{key:"_createDataInfoQuery",value:function(){var e,t=this.layerView.layer,i=t.createQuery();return i.returnGeometry=!1,i.outSpatialReference=this.layerView.view.spatialReference,null!==(e=t.capabilities)&&void 0!==e&&e.query.supportsCacheHint&&(i.cacheHint=!0),i}},{key:"_fullExtentIsAccurate",value:function(){var e=this.layerView.layer;if("definitionExpression"in e&&e.definitionExpression)return!1;switch(e.type){case"feature":case"catalog-footprint":case"oriented-imagery":return(0,E.M8)(e.url);case"csv":case"geojson":case"ogc-feature":case"wfs":return!0;default:return}}},{key:"_updateServiceDataExtent",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._tryUpdateServiceDataExtent(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,b.D_)(e.t0)||this._set("serviceDataExtent",(0,v.d9)(this.layerView.fullExtentInLocalViewSpatialReference));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_tryUpdateServiceDataExtent",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r,a,s,u,o,l,c,d,h,p,f,y;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.layerView,s=a.layer,u=null!==(i=null===(r=s.capabilities)||void 0===r?void 0:r.query.supportsExtent)&&void 0!==i&&i,o=(0,v.d9)(a.fullExtentInLocalViewSpatialReference),l=s.fullExtent,c=this._fullExtentIsAccurate(),d=this.serviceDataCount,!(u&&d<=Q.maxFeatureCountForExtent)||o&&c||!("queryExtent"in s)){e.next=9;break}return h=this._createDataInfoQuery(),e.next=5,s.queryExtent(h,{timeout:Q.queryExtentTimeout,signal:t});case 5:p=e.sent,this._set("serviceDataExtent",p.extent),e.next=22;break;case 9:if(!o){e.next=13;break}this._set("serviceDataExtent",o),e.next=22;break;case 13:if(null==l){e.next=21;break}return f="portalItem"in s?s.portalItem:null,e.next=17,(0,R.projectGeometry)(l,a.view.spatialReference,f,t);case 17:y=e.sent,this._set("serviceDataExtent",y),e.next=22;break;case 21:this._set("serviceDataExtent",null);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateServiceDataCount",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("queryFeatureCount"in(i=this.layerView.layer)&&(0,f.Z)("featurelayer-snapshot-enabled")){e.next=3;break}return e.abrupt("return",void this._set("serviceDataCount",Q.noServiceDataCount));case 3:return e.next=5,(0,h.q6)(i.queryFeatureCount(this._createDataInfoQuery(),{timeout:Q.queryStatisticsTimeout,signal:t}));case 5:if(!0!==(r=e.sent).ok){e.next=10;break}this._set("serviceDataCount",r.value),e.next=13;break;case 10:if(!(0,b.D_)(r.error)){e.next=12;break}throw r.error;case 12:this._set("serviceDataCount",Q.noServiceDataCount);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_supportsExceedsLimitQuery",get:function(){var e=this.layerView.layer;return null!=e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics}},{key:"_minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return 0}}},{key:"_updateSnapshotLimit",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s,u,o,l,c,d,p,y,v,_,g;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(null===t||void 0===t?void 0:t.averageSymbolComplexity)){e.next=2;break}return e.abrupt("return",void(this._snapshotLimitExceeded=!1));case 2:if(a=t.maximumTotalNumberOfVertices,s=t.averageSymbolComplexity,u=s.verticesPerFeature,o=s.verticesPerCoordinate,l=u<=0,c=this._minimumNumberOfVerticesForGeometry>1,l||c){e.next=5;break}return e.abrupt("return",void(this._snapshotLimitExceeded=!1));case 5:if(e.t0=0!==u&&null!=i,!e.t0){e.next=9;break}return e.next=9,i;case 9:if(d=Math.min(a,J),p=this.serviceDataCount,y=p!==Q.noServiceDataCount,v=y?Math.ceil((d-p*u)/(o||1)):Math.ceil(d/(o||1)),c&&(v=Math.min(v,W)),!(y&&this._minimumNumberOfVerticesForGeometry*p>v)){e.next=13;break}return e.abrupt("return",void(this._snapshotLimitExceeded=!0));case 13:if(this._supportsExceedsLimitQuery&&(0,f.Z)("featurelayer-snapshot-enabled")){e.next=15;break}return e.abrupt("return",void(this._snapshotLimitExceeded=this.maxTotalSnapshotVertices>v));case 15:return e.next=17,(0,h.q6)(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(v),{timeout:Q.queryStatisticsTimeout,signal:r}));case 17:if(!1!==(_=e.sent).ok){e.next=22;break}if(!(0,b.D_)(_.error)){e.next=21;break}throw _.error;case 21:return e.abrupt("return",void(this._snapshotLimitExceeded=!1));case 22:g=_.value.features[0],this._snapshotLimitExceeded=!(null===g||void 0===g||!g.attributes)&&!!g.attributes.exceedslimit;case 24:case"end":return e.stop()}}),e,this)})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"_fetchServiceDataInfo",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,i,r,a,s,u=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._cancelFetchServiceDataInfo(),t=new AbortController,i=t.signal,r=this._updateServiceDataCount(i),a=Promise.allSettled([r,this._updateSnapshotLimit(this.displayFeatureLimit,r,i)]),s=a.then((function(){return u._updateServiceDataExtent(i)})).catch((function(e){(0,b.D_)(e)||_.Z.getLogger(u).error("#fetchServiceDataInfo()",e)})).then((function(){s===u._fetchDataInfoPromise&&(u._fetchDataInfoPromise=null,u._fetchDataInfoAbortController=null),t=null})),e.abrupt("return",(t&&(this._fetchDataInfoPromise=s),this._fetchDataInfoAbortController=t,a.then((function(){}),(function(){}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_cancelFetchServiceDataInfo",value:function(){var e=this._fetchDataInfoAbortController;e&&(this._fetchDataInfoAbortController=null,this._fetchDataInfoPromise=null,e.abort())}},{key:"performanceInfo",get:function(){var e,t,i,r,n,a,s,u;return{storedFeatures:null!==(e=null===(t=this._tileFetcher)||void 0===t?void 0:t.storedFeatures)&&void 0!==e?e:0,totalFeatures:null!==(i=null===(r=this._tileFetcher)||void 0===r?void 0:r.totalFeatures)&&void 0!==i?i:0,totalVertices:null!==(n=null===(a=this._tileFetcher)||void 0===a?void 0:a.totalVertices)&&void 0!==n?n:0,missingTiles:null!==(s=null===(u=this._tileFetcher)||void 0===u?void 0:u.missingTiles)&&void 0!==s?s:0}}}]),i}((0,m.v)(d.default));(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"type",void 0),(0,c._)([(0,x.Cb)({constructOnly:!0})],j.prototype,"graphics",void 0),(0,c._)([(0,x.Cb)({constructOnly:!0})],j.prototype,"layerView",void 0),(0,c._)([(0,x.Cb)({constructOnly:!0})],j.prototype,"context",void 0),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"dataUpdating",null),(0,c._)([(0,x.Cb)()],j.prototype,"extent",null),(0,c._)([(0,x.Cb)()],j.prototype,"updating",null),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"_updatingHandles",void 0),(0,c._)([(0,x.Cb)()],j.prototype,"updatingTotal",null),(0,c._)([(0,x.Cb)()],j.prototype,"updatingRemaining",null),(0,c._)([(0,x.Cb)()],j.prototype,"expectedFeatureDiff",null),(0,c._)([(0,x.Cb)()],j.prototype,"memoryForUnusedFeatures",null),(0,c._)([(0,x.Cb)()],j.prototype,"maximumNumberOfFeaturesExceeded",null),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"serviceDataExtent",void 0),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"serviceDataCount",void 0),(0,c._)([(0,x.Cb)()],j.prototype,"_snapshotLimitExceeded",void 0),(0,c._)([(0,x.Cb)()],j.prototype,"displayFeatureLimit",void 0),(0,c._)([(0,x.Cb)({type:Number})],j.prototype,"maximumNumberOfFeatures",null),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"hasAllFeatures",null),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"hasAllFeaturesInView",null),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"hasFullGeometries",null),(0,c._)([(0,x.Cb)()],j.prototype,"_forceTilesMode",void 0),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"mode",null),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"maxTotalSnapshotVertices",null),(0,c._)([(0,x.Cb)({readOnly:!0})],j.prototype,"tileDescriptors",null),(0,c._)([(0,x.Cb)()],j.prototype,"_tileFetcher",void 0),(0,c._)([(0,x.Cb)()],j.prototype,"_fetchDataInfoPromise",void 0),j=(0,c._)([(0,C.j)("esri.layers.graphics.controllers.FeatureTileController3D")],j);var Q,B,J=1e6,W=5e6;function X(e,t){if(!t)return!1;var i,n=(0,r.Z)(t);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(!e.has(a))return!0}}catch(s){n.e(s)}finally{n.f()}return!1}(B=Q||(Q={})).noServiceDataCount=1/0,B.maxSnapshotMinScaleFactor=5,B.reset=function(){B.maxFeatureCountForExtent=1e4,B.queryStatisticsTimeout=12e3,B.queryExtentTimeout=1e4},Q.reset()},22585:function(e,t,i){function r(e){var t={};for(var i in e)if("declaredClass"!==i){var n=e[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){t[i]=[];for(var a=0;a<n.length;a++)t[i][a]=r(n[a])}else"object"==typeof n?n.toJSON&&(t[i]=JSON.stringify(n)):t[i]=n}return t}i.d(t,{A:function(){return r}})},5192:function(e,t,i){i.d(t,{Ev:function(){return F},JT:function(){return v},Vn:function(){return E},Vr:function(){return C},hH:function(){return x},n7:function(){return b},qp:function(){return g}});var r=i(1413),n=i(74165),a=i(15861),s=i(76200),u=i(35995),o=i(77981),l=i(91340),c=i(92975),d=i(22585),h=i(27607),p=i(68620),f="Layer does not support extent calculation.";function y(e,t){var i,r=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;var a,s,u,l=n;if(null!=r&&(s=r.spatialReference,u=(0,c.B9)(s),l.geometryType=(0,o.Ji)(r),l.geometry=function(e,t){if(t&&"extent"===e.type)return"".concat(e.xmin,",").concat(e.ymin,",").concat(e.xmax,",").concat(e.ymax);if(t&&"point"===e.type)return"".concat(e.x,",").concat(e.y);var i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}(r,e.compactGeometryEnabled),l.inSR=u),n.groupByFieldsForStatistics&&(l.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds&&(l.objectIds=n.objectIds.join(",")),n.orderByFields&&(l.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(null!==t&&void 0!==t&&t.returnCountOnly||null!==t&&void 0!==t&&t.returnExtentOnly||null!==t&&void 0!==t&&t.returnIdsOnly)?delete l.outFields:n.outFields.includes("*")?l.outFields="*":l.outFields=n.outFields.join(","),n.outSR?(l.outSR=(0,c.B9)(n.outSR),a=e.outSpatialReference):r&&(n.returnGeometry||n.returnCentroid)&&(l.outSR=l.inSR,a=s),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(l.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(l.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(l.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=s&&null!=(null===(i=e.quantizationParameters)||void 0===i?void 0:i.extent)&&s.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,l.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(l.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(l.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(l.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){var d=n.timeExtent,h=d.start,p=d.end;null==h&&null==p||(l.time=h===p?h:"".concat(null!==h&&void 0!==h?h:"null",",").concat(null!==p&&void 0!==p?p:"null")),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=s&&null!=a&&s.equals(a)&&(l.defaultSR=l.inSR,delete l.inSR,delete l.outSR),l}function v(e,t,i,r){return _.apply(this,arguments)}function _(){return(_=(0,a.Z)((0,n.Z)().mark((function e(t,i,r,a){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i.timeExtent||!i.timeExtent.isEmpty){e.next=4;break}e.t0={data:{features:[]}},e.next=7;break;case 4:return e.next=6,E(t,i,"json",a);case 6:e.t0=e.sent;case 7:return s=e.t0,e.abrupt("return",((0,p.p)(i,r,s.data),s));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,i,r){return m.apply(this,arguments)}function m(){return(m=(0,a.Z)((0,n.Z)().mark((function e(t,i,r,a){var s,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i.timeExtent||!i.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:r.createFeatureResult()});case 2:return e.next=4,b(t,i,a);case 4:return s=e.sent,u=s,e.abrupt("return",(u.data=(0,h.C)(s.data,r),u));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e,t,i){return E(e,t,"pbf",i)}function F(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(e,t,"json",i,{returnIdsOnly:!0})}function x(e,t,i){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function C(e,t,i){return k.apply(this,arguments)}function k(){return(k=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i.timeExtent||!i.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:{count:0,extent:null}});case 2:return e.next=4,E(t,i,"json",r,{returnExtentOnly:!0,returnCountOnly:!0});case 4:if(a=e.sent,!(s=a.data).hasOwnProperty("extent")){e.next=8;break}return e.abrupt("return",a);case 8:if(!s.features){e.next=10;break}throw new Error(f);case 10:if(!s.hasOwnProperty("count")){e.next=12;break}throw new Error(f);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,i){return w.apply(this,arguments)}function w(){return w=(0,a.Z)((0,n.Z)().mark((function e(t,i,a){var o,c,h,p,f,v,_,g=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=g.length>3&&void 0!==g[3]?g[3]:{},c=g.length>4&&void 0!==g[4]?g[4]:{},h="string"==typeof t?(0,u.mN)(t):t,p=i.geometry?[i.geometry]:[],e.next=6,(0,l.aX)(p,null,{signal:o.signal});case 6:return f=e.sent,null!=(v=null===f||void 0===f?void 0:f[0])&&((i=i.clone()).geometry=v),_=(0,d.A)((0,r.Z)((0,r.Z)((0,r.Z)({},h.query),{},{f:a},c),y(i,c))),e.abrupt("return",(0,s.Z)((0,u.v_)(h.path,R(i,c)?"query3d":"query"),(0,r.Z)((0,r.Z)({},o),{},{responseType:"pbf"===a?"array-buffer":"json",query:(0,r.Z)((0,r.Z)({},_),o.query)})));case 11:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function R(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}},7303:function(e,t,i){i.d(t,{R:function(){return x}});var r=i(1413),n=i(74165),a=i(15861),s=i(15671),u=i(43144),o=i(88301),l=i(61120),c=i(60136),d=i(29388),h=i(27366),p=i(10064),f=i(92026),y=i(49861),v=(i(93169),i(32718),i(84936),i(69912)),_=i(37818),g=i(50863),m=i(21149),b=i(61712),F=i(78485),x=function(e){var t=function(e){(0,c.Z)(i,e);var t=(0,d.Z)(i);function i(){var e;return(0,s.Z)(this,i),(e=t.apply(this,arguments)).updatePolicy=F.j.SYNC,e.slicePlaneEnabled=!1,e.fullExtentInLocalViewSpatialReference=null,e.supportsHeightUnitConversion=!0,e}return(0,u.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(Promise.reject(new p.Z("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this.addResolvingPromise(this._validateGeometryType()),this.addResolvingPromise((0,a.Z)((0,n.Z)().mark((function t(){var i,r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,b.E)(e);case 2:return i=t.sent,e.fullExtentInLocalViewSpatialReference=i,r=e.createGraphicsPipeline(),e.graphicsPipeline=r,t.next=8,r.when();case 8:case"end":return t.stop()}}),t)})))()),this.notifyChange("updating"))}},{key:"destroy",value:function(){this.graphicsPipeline=(0,f.SC)(this.graphicsPipeline)}},{key:"dataUpdating",get:function(){var e;return!(null===(e=this.graphicsPipeline)||void 0===e||!e.dataUpdating)}},{key:"legendEnabled",get:function(){var e;return this.canResume()&&(null===(e=this.graphicsPipeline)||void 0===e?void 0:e.legendEnabled)}},{key:"visibleAtCurrentScale",get:function(){var e;return!(null!==(e=this.graphicsPipeline)&&void 0!==e&&e.scaleVisibilitySuspended)}},{key:"symbologySnappingSupported",get:function(){return this.graphicsPipeline.symbologySnappingSupported}},{key:"hasAllFeatures",get:function(){return this.graphicsPipeline.hasAllFeatures}},{key:"hasAllFeaturesInView",get:function(){return this.graphicsPipeline.hasAllFeaturesInView}},{key:"hasFullGeometries",get:function(){return this.graphicsPipeline.hasFullGeometries}},{key:"timeExtent",get:function(){var e;return(0,g.h)(this.layer,null===(e=this.view)||void 0===e?void 0:e.timeExtent,this._get("timeExtent"))}},{key:"queryEngine",get:function(){return this.graphicsPipeline.queryEngine}},{key:"getHit",value:function(e){var t=this.graphicsPipeline.findGraphic((function(t){return t.uid===e}));if(null==t)return null;var i=(0,_.mW)(t,this.layer);return{type:"graphic",graphic:i,layer:i.layer}}},{key:"whenGraphicBounds",value:function(e,t){var i;return null===(i=this.graphicsPipeline)||void 0===i?void 0:i.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){var i;return null===(i=this.graphicsPipeline)||void 0===i?void 0:i.computeAttachmentOrigin(e,t)}},{key:"elevationAlignPointsInFeatures",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.graphicsPipeline.elevationAlignPointsInFeatures(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"queryForSymbologySnapping",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.graphicsPipeline.queryForSymbologySnapping(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryObjectIds",value:function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatureCount",value:function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryExtent",value:function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"_ensureQuery",value:function(e){return null==e?this.createQuery():m.Z.from(e)}},{key:"highlight",value:function(e){return this.graphicsPipeline.highlight(e)}},{key:"maskOccludee",value:function(e){return this.graphicsPipeline.maskOccludee(e)}},{key:"getSuspendInfo",value:function(){return(0,r.Z)((0,r.Z)({},(0,o.Z)((0,l.Z)(i.prototype),"getSuspendInfo",this).call(this)),this.graphicsPipeline.suspendInfo)}},{key:"isUpdating",value:function(){var e,t,i;return!(!this.graphicsPipeline||this.graphicsPipeline.destroyed)&&!((null===(e=this.graphicsPipeline)||void 0===e||!e.updating)&&null!==(t=this.view)&&void 0!==t&&null!==(i=t.basemapTerrain)&&void 0!==i&&i.ready)}},{key:"_validateGeometryType",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.layer.geometryType,e.next="multipatch"===e.t0||"multipoint"===e.t0?3:4;break;case 3:throw new p.Z("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"performanceInfo",get:function(){return this.graphicsPipeline.performanceInfo}}]),i}(e);return(0,h._)([(0,y.Cb)()],t.prototype,"graphicsPipeline",void 0),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"dataUpdating",null),(0,h._)([(0,y.Cb)()],t.prototype,"suspended",void 0),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"legendEnabled",null),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"visibleAtCurrentScale",null),(0,h._)([(0,y.Cb)()],t.prototype,"updating",void 0),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"updatePolicy",void 0),(0,h._)([(0,y.Cb)({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"suspendInfo",void 0),(0,h._)([(0,y.Cb)()],t.prototype,"symbologySnappingSupported",null),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"hasAllFeatures",null),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"hasAllFeaturesInView",null),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"hasFullGeometries",null),(0,h._)([(0,y.Cb)({readOnly:!0})],t.prototype,"timeExtent",null),t=(0,h._)([(0,v.j)("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}},53586:function(e,t,i){i.d(t,{I:function(){return H}});var r=i(74165),n=i(15861),a=i(1413),s=i(15671),u=i(43144),o=i(60136),l=i(29388),c=i(27366),d=i(52639),h=i(23254),p=i(7138),f=i(41644),y=i(42537),v=i(92026),_=i(66978),g=i(94172),m=i(49861),b=(i(32718),i(84936),i(69912)),F=i(48732),x=i(46634),C=i(81753),k=i(58801),E=i(34610),w=i(21149),R=i(26279),S=i(61310),T=i(14173),Z=i(8186),O=i(57848),D=i(24202),P=i(46568),I=i(59453),V=i(96387),M=i(99879),A=i(26511),N=i(68401),L=i(78485),H=function(e){(0,o.Z)(i,e);var t=(0,l.Z)(i);function i(e){var r;return(0,s.Z)(this,i),(r=t.call(this,e)).type="graphics-3d",r._randomRotationRenderers=null,r._updatingHandles=new x.R,r.elevationFeatureExpressionEnabled=!1,r.scaleVisibilityEnabled=!1,r.filterVisibilityEnabled=!1,r.frustumVisibilityEnabled=!1,r.elevationAlignmentEnabled=!1,r.timeExtentEnabled=!1,r.setUidToIdOnAdd=!0,r.dataExtent=null,r.drapeSourceType=R.Lw.Features,r.preferredUpdatePolicy=L.j.ASYNC,r._suspendResumeExtent=null,r}return(0,u.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.owner,i=(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==t.layer.geometryType,r=new Z.w({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:t.hasZ,hasM:t.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:function(e){return t.view.deconflictor.addGraphicsOwner(e)},labeler:function(e,i){return t.view.labeler.addGraphicsOwner(e,i)},elevationAlignment:this.elevationAlignmentEnabled?function(i,r){return new O._({graphicsCoreOwner:e,graphicsCore:i,queryGraphicUIDsInExtent:r,elevationProvider:t.view.elevationProvider})}:null,scaleVisibility:this.scaleVisibilityEnabled?function(i,r){return new I.c({graphicsCoreOwner:e,layer:e.layer,queryGraphicUIDsInExtent:r,graphicsCore:i,basemapTerrain:t.view.basemapTerrain})}:null,filterVisibility:i?function(e){return new A.n({context:(0,a.Z)((0,a.Z)({},e),{},{configuration:t})})}:null,objectStates:function(e){return new P.d(e)}}});this._set("graphicsCore",r),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new D.L({graphicsCoreOwner:this})),this.elevationAlignment&&this._updatingHandles.add((function(){return e.layer.elevationInfo}),(function(t,i){(0,F.Hg)(t,i)&&e._updatingHandles.addPromise(e.graphicsCore.elevationInfoChange())})),this._updatingHandles.add((function(){return e.layer.labelsVisible}),(function(){return e.graphicsCore.updateVisibilityInfo()})),this._updatingHandles.add((function(){return e.layer.labelingInfo}),(function(t,i){(0,F.Hg)(t,i)&&e.graphicsCore.updateLabelingInfo()})),this._updatingHandles.add((function(){return e.preferredUpdatePolicy}),(function(t){return e.graphicsCore.preferredUpdatePolicy=t})),this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}},{key:"_initializeAsync",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(){var t,i=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,_.U3)(this.graphicsCore.initializePromise);case 2:if(t=this.owner,this._updatingHandles.add((function(){return i.renderer}),(function(e){return i._updatingHandles.addPromise(i.graphicsCore.rendererChange(e))})),this._updatingHandles.add((function(){return t.fullOpacity}),(function(){return i.graphicsCore.opacityChange()})),this._setupSuspendResumeExtent(),this.updateClippingExtent&&(this._updatingHandles.add((function(){return t.view.clippingArea}),(function(){return i._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),e.t0=this.graphicsCore.labelsEnabled,!e.t0){e.next=12;break}return e.next=12,(0,_.U3)(this.graphicsCore.updateLabelingInfo());case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,v.SC)(this.frustumVisibility)),this._set("graphicsCore",(0,v.SC)(this.graphicsCore)),this._set("owner",null)}},{key:"layer",get:function(){return this.owner.layer}},{key:"dataUpdating",get:function(){var e,t;return null!==(e=null===(t=this.graphicsCore)||void 0===t?void 0:t.dataUpdating)&&void 0!==e&&e}},{key:"renderer",get:function(){var e=this.layer,t=e.renderer,i=e.objectIdField;if(!t||!i||"heatmap"===t.type||!t.visualVariables)return t;var r=t.visualVariables.findIndex((function(e){return"rotation"===e.type&&null!=e.valueExpression&&(0,k.v)(e.valueExpression)===i&&(null==e.axis||"heading"===e.axis)&&"geographic"===e.rotationType}));if(r<0)return t;var n=t.clone();return n.visualVariables.splice(r,1),this._randomRotationRenderers||(this._randomRotationRenderers=new WeakMap),this._randomRotationRenderers.set(n,i),n}},{key:"scaleVisibility",get:function(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.scaleVisibility}},{key:"filterVisibility",get:function(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.filterVisibility}},{key:"elevationAlignment",get:function(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.elevationAlignment}},{key:"suspendResumeExtentMode",get:function(){var e;return null!==(e=this.owner.suspendResumeExtentMode)&&void 0!==e?e:"computed"}},{key:"scaleVisibilitySuspended",get:function(){return null!=this.scaleVisibility&&this.scaleVisibility.suspended}},{key:"suspended",get:function(){return this.owner.suspended}},{key:"legendEnabled",get:function(){return null==this.frustumVisibility||!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var e={};return this.scaleVisibilitySuspended&&(e.outsideScaleRange=!0),null!=this.frustumVisibility&&this.frustumVisibility.suspended&&(e.outsideOfView=!0),e}},{key:"updating",get:function(){var e,t;return!!(null!==(e=this.graphicsCore)&&void 0!==e&&e.updating||null!==(t=this.frustumVisibility)&&void 0!==t&&t.updating||this._updatingHandles.updating)}},{key:"updatingRemaining",get:function(){var e,t;return null!==(e=null===(t=this.graphicsCore)||void 0===t?void 0:t.updatingRemaining)&&void 0!==e?e:0}},{key:"featureStore",get:function(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.featureStore}},{key:"view",get:function(){return this.owner.view}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){var e;return null===(e=this.owner)||void 0===e?void 0:e.fullOpacity}},{key:"filter",get:function(){return"filter"in this.owner?this.owner.filter:null}},{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}},{key:"graphics3DGraphics",get:function(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.graphics3DGraphicsByObjectID}},{key:"symbolUpdateType",get:function(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.symbolUpdateType}},{key:"displayFeatureLimit",get:function(){var e,t=this.view.quality,i=null===(e=this.graphicsCore)||void 0===e?void 0:e.displayFeatureLimit;if(1===t)return i;var r=Math.ceil(i.maximumNumberOfFeatures*t);return new T.J(i.maximumTotalNumberOfVertices,r,i.averageSymbolComplexity)}},{key:"usedMemory",get:function(){var e,t;return null!==(e=null===(t=this.graphicsCore)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0}},{key:"loadedFeatures",get:function(){var e,t;return null!==(e=null===(t=this.graphicsCore)||void 0===t?void 0:t.numberOfGraphics)&&void 0!==e?e:0}},{key:"usedMemoryPerFeature",get:function(){var e,t;return null!==(e=null===(t=this.graphicsCore)||void 0===t?void 0:t.usedMemoryPerGraphic)&&void 0!==e?e:0}},{key:"unprocessedMemoryEstimate",get:function(){var e,t;return null!==(e=null===(t=this.graphicsCore)||void 0===t?void 0:t.unprocessedMemoryEstimate)&&void 0!==e?e:0}},{key:"performanceInfo",get:function(){return this.graphicsCore.performanceInfo}},{key:"maskOccludee",value:function(e){var t,i=null===(t=this.graphicsCore)||void 0===t?void 0:t.objectStates;if(!i)return(0,y.kB)();var r=i.acquireSet(N.V_.MaskOccludee,null),n=r.set,a=r.handle;return i.setUid(n,e.uid),a}},{key:"highlight",value:function(e,t){var i,r=this,n=null===(i=this.graphicsCore)||void 0===i?void 0:i.objectStates;if(!n)return(0,y.kB)();if(e instanceof w.Z){var a=n.acquireSet(N.V_.Highlight,t),s=a.set,u=a.handle;return this.owner.queryObjectIds(e).then((function(e){return n.setObjectIds(s,e)})),u}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof d.Z)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof d.Z){var o=e;if(null==(0,M.g)(this.layer.fieldsIndex,o[0].attributes,t)){var l=o.map((function(e){return e.uid})),c=n.acquireSet(N.V_.Highlight,null),h=c.set,p=c.handle;return n.setUids(h,l),p}e=o.map((function(e){return(0,M.g)(r.layer.fieldsIndex,e.attributes,t)}))}if(Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0])){var f=e,v=n.acquireSet(N.V_.Highlight,t),_=v.set,g=v.handle;return n.setObjectIds(_,f),g}}return(0,y.kB)()}},{key:"resetObjectStates",value:function(){var e,t;null===(e=this.graphicsCore)||void 0===e||null===(t=e.objectStates)||void 0===t||t.reset()}},{key:"whenGraphicBounds",value:function(e,t){var i;return null===(i=this.graphicsCore)||void 0===i?void 0:i.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){var i;return null===(i=this.graphicsCore)||void 0===i?void 0:i.computeAttachmentOrigin(e,t)}},{key:"notifyGraphicGeometryChanged",value:function(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}},{key:"notifyGraphicVisibilityChanged",value:function(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}},{key:"getRenderingInfo",value:function(e,t,i){var r,n=(0,E.Kb)(e,{renderer:t,arcade:i});if(null!==n&&void 0!==n&&n.color){var a=n.color;a[0]=a[0]/255,a[1]=a[1]/255,a[2]=a[2]/255}if(null!=n&&null!=t&&null!==(r=this._randomRotationRenderers)&&void 0!==r&&r.has(t)){var s=this._randomRotationRenderers.get(t),u=e.attributes[s],o=new h.a(0);o.updateFloatArray([u]),o.updateUint8Array([173]),n.heading=8.381e-8*o.digest()}return n}},{key:"getRenderingInfoAsync",value:function(e,t,i,r){return(0,E.xn)(e,(0,a.Z)({renderer:t,arcade:i},r))}},{key:"getSymbolLayerSize",value:function(e,t){var i;return null===(i=this.graphicsCore)||void 0===i?void 0:i.getSymbolLayerSize(e,t)}},{key:"setObjectIdVisibility",value:function(e,t){var i;null===(i=this.graphicsCore)||void 0===i||i.setObjectIdVisibility(e,t)}},{key:"refreshFilter",value:function(){null!=this.filterVisibility&&this.filterVisibility.reapply()}},{key:"getGraphics3DGraphicByObjectId",value:function(e){var t;return null===(t=this.graphicsCore)||void 0===t?void 0:t.getGraphics3DGraphicByObjectId(e)}},{key:"_updateClippingExtent",value:function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())}},{key:"_setupSuspendResumeExtent",value:function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this.addHandles((0,g.watch)((function(){return e.suspendResumeExtentMode}),(function(){switch(e.removeHandles(G),e.suspendResumeExtentMode){case"computed":e.addHandles([(0,g.watch)((function(){return e.graphicsCore.computedExtent}),(function(t){return e._updateSuspendResumeExtent(t)}),g.initial),(0,g.watch)((function(){return e.graphicsCore.extentPadding}),(function(){return e._updateSuspendResumeExtent(e.graphicsCore.computedExtent)}))],G);break;case"data":e.addHandles([(0,g.when)((function(){return e.dataExtent}),(function(t){return e._updateSuspendResumeExtent(t)}),g.initial),(0,g.watch)((function(){return e.graphicsCore.extentPadding}),(function(){return e._updateSuspendResumeExtent(e.dataExtent)}))],G);break;default:(0,f.Bg)(e.suspendResumeExtentMode)}}),g.initial))}},{key:"_updateSuspendResumeExtent",value:function(e){e?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(e,this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)}},{key:"_extentToSuspendResumeRect",value:function(e,t){var i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!(0,C.Q8)(e,i))return;e=(0,C.iV)(e,i)}return(0,V.Go)(e,t,S.PY,this.graphicsCore.extentPadding)}},{key:"_suspendResumeExtentChanged",value:function(e){null!=this.frustumVisibility&&this.frustumVisibility.setExtent(e),null!=this.scaleVisibility&&this.scaleVisibility.setExtent(e)}}]),i}(p.default);(0,c._)([(0,m.Cb)()],H.prototype,"type",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"owner",void 0),(0,c._)([(0,m.Cb)()],H.prototype,"layer",null),(0,c._)([(0,m.Cb)({readOnly:!0})],H.prototype,"dataUpdating",null),(0,c._)([(0,m.Cb)()],H.prototype,"renderer",null),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"updateClippingExtent",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"elevationFeatureExpressionEnabled",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"graphicsCore",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"scaleVisibilityEnabled",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"filterVisibilityEnabled",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"frustumVisibilityEnabled",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"elevationAlignmentEnabled",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"timeExtentEnabled",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"setUidToIdOnAdd",void 0),(0,c._)([(0,m.Cb)()],H.prototype,"scaleVisibility",null),(0,c._)([(0,m.Cb)()],H.prototype,"filterVisibility",null),(0,c._)([(0,m.Cb)()],H.prototype,"elevationAlignment",null),(0,c._)([(0,m.Cb)({constructOnly:!0})],H.prototype,"frustumVisibility",void 0),(0,c._)([(0,m.Cb)()],H.prototype,"initializePromise",void 0),(0,c._)([(0,m.Cb)()],H.prototype,"suspendResumeExtentMode",null),(0,c._)([(0,m.Cb)()],H.prototype,"dataExtent",void 0),(0,c._)([(0,m.Cb)()],H.prototype,"scaleVisibilitySuspended",null),(0,c._)([(0,m.Cb)()],H.prototype,"suspended",null),(0,c._)([(0,m.Cb)()],H.prototype,"legendEnabled",null),(0,c._)([(0,m.Cb)()],H.prototype,"suspendInfo",null),(0,c._)([(0,m.Cb)()],H.prototype,"updating",null),(0,c._)([(0,m.Cb)()],H.prototype,"updatingRemaining",null),(0,c._)([(0,m.Cb)()],H.prototype,"featureStore",null),(0,c._)([(0,m.Cb)()],H.prototype,"view",null),(0,c._)([(0,m.Cb)()],H.prototype,"loadedGraphics",null),(0,c._)([(0,m.Cb)()],H.prototype,"fullOpacity",null),(0,c._)([(0,m.Cb)()],H.prototype,"filter",null),(0,c._)([(0,m.Cb)()],H.prototype,"slicePlaneEnabled",null),(0,c._)([(0,m.Cb)()],H.prototype,"drapeSourceType",void 0),(0,c._)([(0,m.Cb)()],H.prototype,"updatePolicy",null),(0,c._)([(0,m.Cb)()],H.prototype,"preferredUpdatePolicy",void 0),(0,c._)([(0,m.Cb)({readOnly:!0})],H.prototype,"displayFeatureLimit",null),H=(0,c._)([(0,b.j)("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],H);var G="suspendResumeExtentMode"},22380:function(e,t,i){i.d(t,{Q:function(){return Ye}});var r=i(74165),n=i(15861),a=i(15671),s=i(43144),u=i(60136),o=i(29388),l=i(27366),c=i(10064),d=i(92026),h=i(67426),p=i(94172),f=i(49861),y=(i(93169),i(32718)),v=(i(84936),i(69912)),_=i(46634),g=i(5845),m=i(74579),b=i(60487),F=i(53586),x=i(82607),C=i(77098),k=i(37762),E=i(1413),w=i(7138),R=i(63780),S=i(59896),T=i(42537),Z=i(17842),O=i(12400),D=i(68859),P=i(39406),I=i(82582),V=i(65618),M=i(83406),A=i(3182),N=i(80457),L=i(68928),H=i(37270),G=i(27811),U=i(26279),q=i(14173),z=i(46281),j=i(26511),Q=i(19265),B=i(91526),J=i(79100),W=i(50951),X=i(20684),Y=i(81341),K=i(98634),$=i(82144),ee=i(31132),te=i(33559),ie=i(7566),re=i(78041),ne=i(27627),ae=i(8883),se=i(23819),ue=i(8548),oe=i(36207),le=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).colorRamp=null,e.densityMap=null,e.searchRadius=1,e.fieldTotal=0,e.minDensity=0,e.maxDensity=100,e}return(0,s.Z)(i)}(K.K),ce=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(e,r){var n;return(0,a.Z)(this,i),n=t.call(this,e,r,(function(){return n.destroy()}))}return(0,s.Z)(i,[{key:"initializeProgram",value:function(e){return new ne.$(e.rctx,i.shader.get().build(this.configuration),ie.i)}},{key:"initializePipeline",value:function(){return(0,oe.sm)({blending:re.wu,colorWrite:oe.BK,depthTest:null,depthWrite:null})}},{key:"primitiveType",get:function(){return ue.MX.TRIANGLE_STRIP}}]),i}(ee.A);ce.shader=new $.J(se.H,(function(){return i.e(28259).then(i.bind(i,28259))}));var de=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).usesHalfFloat=!1,e}return(0,s.Z)(i)}(ae.W);(0,l._)([(0,te.o)()],de.prototype,"usesHalfFloat",void 0);var he=i(53634),pe=i(57808),fe=i(52311),ye=i(3384),ve=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;(0,a.Z)(this,i),(r=t.call(this,e)).pixelRatio=1,r._colorRampData=new Uint8ClampedArray(4),r.type="draped-heatmap",r._heatmapParameters=new le;var n=new fe.X;n.pixelFormat=e.pixelFormat,n.internalFormat=e.internalFormat,n.dataType=e.dataType,n.samplingMode=e.samplingMode,n.wrapMode=ue.e8.CLAMP_TO_EDGE;var s=e.rendererContext.rctx;r._densityMap=new he.X(s,n),r._quad=(0,X.o)(s);var u=new de;return u.usesHalfFloat=e.dataType!==ue.Br.FLOAT,r._technique=new ce({rctx:s,viewingMode:W.JY.Local},u),r}return(0,s.Z)(i,[{key:"initialize",value:function(){var e=this,t=this._colorRampData,i=new fe.X(t.length/4,1);i.wrapMode=ue.e8.CLAMP_TO_EDGE,this._colorRamp=new pe.x(this.rctx,i,t),this._heatmapParameters.densityMap=this._densityMap.colorTexture,this.addHandles((0,p.watch)((function(){return[e.colorRampData,e.minDensity,e.maxDensity,e.fieldTotal,e.pixelRatio,e.searchRadius]}),(function(){return e.rendererContext.notifyContentChanged()})))}},{key:"destroy",value:function(){this._technique=(0,d.RY)(this._technique),this._densityMap=(0,d.M2)(this._densityMap),this._quad=(0,d.M2)(this._quad),this._colorRamp=(0,d.M2)(this._colorRamp)}},{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(e){e!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=e,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(e){e!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=e,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(e){e!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=e,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},set:function(e){this._heatmapParameters.fieldTotal=e,this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(e){var t=this._heatmapParameters.colorRamp;if(null!=t&&e!==this._colorRampData){var i=t.descriptor.width,r=e.length/4;r!==i&&t.resize(r,1),t.setData(e)}this._colorRampData=e}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(e){this._heatmapParameters.colorRamp=e}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccludedDraped",get:function(){return!1}},{key:"render",value:function(e){var t=this._sortedMaterialRenderers;if(0!==t.length){var i=this.rctx.getBoundFramebufferObject(),r=this.rctx.getViewport(),n=this.pixelRatio,a=Math.ceil(r.width*n),s=Math.ceil(r.height*n);this._densityMap.resize(a,s),this.rctx.bindFramebuffer(this._densityMap),this.rctx.setViewport(0,0,a,s),this.rctx.clear(ue.lk.COLOR_BUFFER_BIT);var u=!1;t.forAll((function(t){var i=t.prepareTechnique(e);null!=i&&(t.renderNode(e,i),u=!0)})),this.rctx.bindFramebuffer(i),this.rctx.setViewport(r.x,r.y,r.width,r.height),u&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,e.bindParameters,this._heatmapParameters),this.rctx.drawArrays(this._technique.primitiveType,0,(0,ye._V)(this._quad,"geometry")))}}}]),i}(Y.S);(0,l._)([(0,f.Cb)()],ve.prototype,"searchRadius",null),(0,l._)([(0,f.Cb)()],ve.prototype,"minDensity",null),(0,l._)([(0,f.Cb)()],ve.prototype,"maxDensity",null),(0,l._)([(0,f.Cb)()],ve.prototype,"fieldTotal",null),(0,l._)([(0,f.Cb)()],ve.prototype,"pixelRatio",void 0),(0,l._)([(0,f.Cb)()],ve.prototype,"colorRampData",null),(0,l._)([(0,f.Cb)({constructOnly:!0})],ve.prototype,"dataType",void 0),(0,l._)([(0,f.Cb)({constructOnly:!0})],ve.prototype,"samplingMode",void 0),(0,l._)([(0,f.Cb)({constructOnly:!0})],ve.prototype,"pixelFormat",void 0),(0,l._)([(0,f.Cb)({constructOnly:!0})],ve.prototype,"internalFormat",void 0),(0,l._)([(0,f.Cb)()],ve.prototype,"_colorRampData",void 0),ve=(0,l._)([(0,v.j)("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],ve);var _e=i(40779),ge=i(78289),me=i(39077),be=i(78485),Fe=i(4760),xe=i(13611),Ce=i(6644),ke=i(55158),Ee=i(37081),we=i(23620),Re=i(56529),Se=i(93822),Te=i(33236),Ze=i(88301),Oe=i(61120),De=i(65322),Pe=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).searchRadius=128,e.resolutionForScale=0,e}return(0,s.Z)(i)}(Re.Mt),Ie=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,s.Z)(i,[{key:"initializeProgram",value:function(e){return new ne.$(e.rctx,i.shader.get().build(this.configuration),ie.i)}},{key:"initializePipeline",value:function(){return(0,oe.sm)({blending:(0,oe.if)(ue.zi.ONE,ue.zi.ONE,ue.db.ADD),colorWrite:oe.BK,depthTest:null,depthWrite:null})}},{key:"destroy",value:function(){(0,Ze.Z)((0,Oe.Z)(i.prototype),"destroy",this).call(this)}}]),i}(ee.A);Ie.shader=new $.J(De.H,(function(){return i.e(7682).then(i.bind(i,7682))}));var Ve=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).isAttributeDriven=!1,e.usesHalfFloat=!1,e}return(0,s.Z)(i)}(ae.W);(0,l._)([(0,te.o)()],Ve.prototype,"isAttributeDriven",void 0),(0,l._)([(0,te.o)()],Ve.prototype,"usesHalfFloat",void 0);var Me=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).isAttributeDriven=!1,e.usesHalfFloats=!1,e}return(0,s.Z)(i)}(Pe),Ae=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e,new Me)).produces=new Map([[Se.r.DRAPED_MATERIAL,function(e){return e===Ee.H_.Color}]]),r._configuration=new Ve,r}return(0,s.Z)(i,[{key:"getConfiguration",value:function(){return this._configuration.isAttributeDriven=this.parameters.isAttributeDriven,this._configuration.usesHalfFloat=this.parameters.usesHalfFloats,this._configuration}},{key:"createGLMaterial",value:function(e){return new Ne(e)}},{key:"intersect",value:function(){}},{key:"intersectDraped",value:function(e,t,i,r,n,a){for(var s=e.attributes.get(Fe.T.POSITION),u=this.parameters.searchRadius,o=e.screenToWorldRatio,l=u*o+2*o,c=l*l,d=s.data.length/s.size,h=0;h<d;h++){var p=h*s.size,f=(0,xe.t8)(qe,s.data[p],s.data[p+1]);(0,xe.bI)(f,r)<c&&n(a.dist,a.normal,-1,!1)}}},{key:"createBufferWriter",value:function(){return new Le(this.parameters.isAttributeDriven?Ge:He)}}]),i}(Re.F5),Ne=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,s.Z)(i,[{key:"beginSlot",value:function(e){return this.ensureTechnique(Ie,e)}}]),i}(we.Z),Le=function(){function e(t){(0,a.Z)(this,e),this.vertexBufferLayout=t}return(0,s.Z)(e,[{key:"elementCount",value:function(e){return e.attributes.get(Fe.T.POSITION).indices.length*Ue}},{key:"write",value:function(e,t,i,r,n){(0,Te.ho)(i.attributes.get(Fe.T.POSITION),e,r.position,n,Ue);for(var a=i.attributes.get(Fe.T.POSITION).indices.length,s=r.uv0,u=n,o=0;o<a;++o)s.setValues(u++,-1,-1),s.setValues(u++,1,-1),s.setValues(u++,1,1),s.setValues(u++,1,1),s.setValues(u++,-1,1),s.setValues(u++,-1,-1);var l=Fe.T.FEATUREATTRIBUTE in r?r.featureAttribute:null;l&&(0,Te.XW)(i.attributes.get(Fe.T.FEATUREATTRIBUTE),l,n,Ue)}}]),e}(),He=(0,ke.U$)().vec3f(Fe.T.POSITION).vec2f(Fe.T.UV0),Ge=He.clone().f32(Fe.T.FEATUREATTRIBUTE),Ue=6,qe=(0,Ce.Ue)(),ze=i(69787),je=i(34552),Qe=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e)).type="heatmap",r.preferredUpdatePolicy=be.j.ASYNC,r.dataExtent=null,r.drapeSourceType=U.Lw.Features,r._renderGeometries=new Map,r._fieldTotal=0,r._drapeSourceRenderer=null,r._dataType=ue.Br.HALF_FLOAT,r._pixelFormat=ue.VI.RGBA,r._updatingHandles=new _.R,r.initializePromise=Promise.resolve(),r}return(0,s.Z)(i,[{key:"initialize",value:function(){var e=this;this._featureStore=new L.Z({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});var t=(0,je.v)(this._renderView.renderingContext,y.Z.getLogger(this)),i=t.dataType,r=t.samplingMode,n=t.pixelFormat,a=t.internalFormat;this._dataType=i,this._pixelFormat=n;var s=i!==ue.Br.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,ve,(0,E.Z)((0,E.Z)({},this._rendererParameters),{},{dataType:i,samplingMode:r,pixelFormat:n,internalFormat:a})),this._material=new Ae({usesHalfFloats:s}),this._materialWithField=new Ae({usesHalfFloats:s,isAttributeDriven:!0}),this._filterVisibility=new j.n({context:{configuration:this.owner,featureStore:this.featureStore,getFeatureCount:function(){return e._loadedPointGraphics.length},setAllFeaturesVisibility:function(t){return e._setAllFeaturesVisibility(t)},clearFeaturesVisibility:function(){return e._setAllFeaturesVisibility(!0)},updateFeatureVisibilities:function(t){return e._updateFeatureVisibilities(t)}}}),this._updatingHandles.addOnCollectionChange((function(){return e._loadedPointGraphics}),(function(t){return e._onLoadedFeaturesChange(t)}),p.initial),this._updatingHandles.addWhen((function(){return e._materialParameters}),(function(t){return e._forEachMaterial((function(e){return e.setParameters(t)}))}),p.initial),this._updatingHandles.add((function(){return e._rendererParameters}),(function(t){return e._drapeSourceRenderer.set(t)})),this._updatingHandles.add((function(){return e._heatmapRendererField}),(function(){e._recreate()}),p.sync),this._updatingHandles.add((function(){return{fieldName:e._heatmapRendererFieldName,numeric:e._heatmapRendererFieldIsNumeric}}),(function(t){var i=t.fieldName,r=t.numeric;if(null!=i&&r){var n=0;e._featureStore.forEach((function(e){var t;return n+=null!==(t=e.attributes[i])&&void 0!==t?t:0})),e._fieldTotal=n}else e._fieldTotal=e._featureStore.numFeatures}),p.initial),this.addHandles([(0,p.watch)((function(){return{fieldName:e._heatmapRendererFieldName,field:e._heatmapRendererField}}),(function(t){var i,r=t.fieldName,n=t.field;r&&!n&&y.Z.getLogger(e).warn("Heatmap renderer field '".concat(r,"' for layer '").concat(null!==(i=e.layer.title)&&void 0!==i?i:e.layer.id,"' not found"))})),(0,p.watch)((function(){return{field:e._heatmapRendererField,numeric:e._heatmapRendererFieldIsNumeric}}),(function(t){var i,r=t.field,n=t.numeric;null==r||n||y.Z.getLogger(e).warn("Heatmap renderer field '".concat(r.name,"' for layer '").concat(null!==(i=e.layer.title)&&void 0!==i?i:e.layer.id,"' does not contain numeric values and cannot be used to drive the heatmap density"))})),(0,T.kB)((function(){return e.view.basemapTerrain.overlayManager.unregisterDrapeSource(e)}))])}},{key:"destroy",value:function(){this._renderGeometries.clear(),this._material=null,this._materialWithField=null,this._featureStore.clear(),this._featureStore=null,this._updatingHandles.destroy()}},{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this._updatingHandles.updating||this.filterVisibility.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"filterVisibility",get:function(){return this._filterVisibility}},{key:"displayFeatureLimit",get:function(){var e,t,i,r,n,a=null!==(e=null===(t=this.owner)||void 0===t||null===(i=t.view)||void 0===i?void 0:i.quality)&&void 0!==e?e:1,s=null===(r=this.owner)||void 0===r||null===(n=r.view)||void 0===n?void 0:n.qualitySettings,u=s?Math.ceil(s.heatmap.maxTotalNumberOfFeatures*a):0;return new q.J(6*u,u)}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){if(!this._isScaleRangeActive)return!1;var e=this.layer.effectiveScaleRange,t=e.minScale,i=e.maxScale,r=this.view.scale;return!(0,ze.rs)(r,null!==t&&void 0!==t?t:0,null!==i&&void 0!==i?i:0)}},{key:"usedMemory",get:function(){var e,t,i,r,n=this.usedMemoryPerFeature*this._featureStore.numFeatures,a=this._pixelFormat===ue.VI.RED?1:4,s=this._dataType===ue.Br.FLOAT?4:2,u=null!==(e=Math.ceil((null!==(t=null===(i=this._overlayRenderer)||void 0===i||null===(r=i.overlays[0])||void 0===r?void 0:r.resolution)&&void 0!==t?t:0)*this._densityMapPixelRatio))&&void 0!==e?e:0;return u*u*a*s+n}},{key:"usedMemoryPerFeature",get:function(){var e=this._loadedPointGraphics.find((function(){return!0}));if(null==e)return 0;var t=(0,S.f2)(e),i=(0,S.G3)();return 6*(0,S.do)([0,0,0],i)+6*(0,S.do)([0,0],i)+(this._heatmapRendererFieldIsNumeric?6*i:0)+t}},{key:"loadedFeatures",get:function(){return this._featureStore.numFeatures}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",get:function(){return new z.J(this._visibleFeatures,0,0)}},{key:"renderer",get:function(){return this._heatmapRenderer}},{key:"_overlayRenderer",get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return this._overlayRenderer.spatialReference}},{key:"_rendererParameters",get:function(){return(0,E.Z)((0,E.Z)((0,E.Z)((0,E.Z)({},this._radiusParameter),this._densityParameters),this._colorRampParameter),this._pixelRatioParameter)}},{key:"_materialParameters",get:function(){return(0,E.Z)((0,E.Z)({},this._radiusParameter),this._resolutionForScaleParameter)}},{key:"_densityParameters",get:function(){var e=this._heatmapRenderer;return null==e?null:{minDensity:e.minDensity,maxDensity:e.maxDensity,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){var e=this._heatmapRenderer;return e?{searchRadius:(0,Z.F2)(this._clampSearchRadius(e.radius))}:null}},{key:"_resolutionForScaleParameter",get:function(){var e=this._heatmapRenderer;if(!e)return null;var t=e.referenceScale;return{resolutionForScale:0===t?0:(0,I.dp)(t,this.view.spatialReference)}}},{key:"_colorRampParameter",get:function(){var e=this._heatmapRenderer;return e?{colorRampData:(0,G.uI)(e.colorStops)}:null}},{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},{key:"_densityMapPixelRatio",get:function(){var e,t,i;return null!==(e=null===(t=this.owner)||void 0===t||null===(i=t.view)||void 0===i?void 0:i.qualitySettings.heatmap.pixelRatio)&&void 0!==e?e:1}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){var e=this.layer.renderer;return"heatmap"===(null===e||void 0===e?void 0:e.type)?e:null}},{key:"_heatmapRendererFieldName",get:function(){var e;return null===(e=this._heatmapRenderer)||void 0===e?void 0:e.field}},{key:"_heatmapRendererField",get:function(){var e=this._heatmapRendererFieldName;return null!=e?this.layer.fieldsIndex.get(e):null}},{key:"_heatmapRendererFieldIsNumeric",get:function(){var e=this._heatmapRendererField;return null!=e&&(0,H.H7)(e)}},{key:"_isScaleRangeActive",get:function(){var e=this.layer;if(!("effectiveScaleRange"in e))return!1;var t=e.effectiveScaleRange,i=t.minScale,r=t.maxScale;return(0,ze.Av)(i,r)}},{key:"_visibleFeatures",get:function(){var e=0;return this._renderGeometries.forEach((function(t){t.visible&&++e})),e}},{key:"whenGraphicBounds",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"computeAttachmentOrigin",value:function(){return null}},{key:"highlight",value:function(){return(0,T.kB)()}},{key:"maskOccludee",value:function(){return(0,T.kB)()}},{key:"setObjectIdVisibility",value:function(){}},{key:"refreshFilter",value:function(){this.filterVisibility.reapply()}},{key:"_onLoadedFeaturesChange",value:function(e){var t=this;if(this._featuresArePoints){var i=this.layer.objectIdField;this._featureStore.removeManyById(e.removed.map((function(e){return(0,V.MS)(e,i)}))),this._featureStore.addMany(e.added.map((function(e){var t=e.attributes,r=e.centroid,n=e.geometry,a=new A.u_((0,M.dd)(new N.Z,n),t,r?(0,M.dd)(new N.Z,r):null,(0,V.MS)(e,i));return a.displayId=e.uid,a})));var r=e.added,n=e.removed;this._fieldTotal+=this._computeFieldTotalChange(r,n);var a=n.map((function(e){var i=e.uid,r=t._renderGeometries.get(i);return t._renderGeometries.delete(i),r})).filter(R.pC),s=r.map((function(e){var i=t._pointGraphicToRenderGeometry(e);return t._renderGeometries.set(e.uid,i),i}));a.length>0&&this._drapeSourceRenderer.removeGeometries(a,ge.T.REMOVE),s.length>0&&this._drapeSourceRenderer.addGeometries(s,ge.T.ADD),(s.length>0||a.length>0)&&(this.filterVisibility.reapply(),this._renderView.requestRender())}}},{key:"_recreate",value:function(){if(this._loadedPointGraphics){var e=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:e,removed:e})}}},{key:"_pointGraphicToRenderGeometry",value:function(e){var t,i=this._heatmapRendererFieldName,r=null!=i?this._materialWithField:this._material,n=(0,O.Ue)();(0,D.K)(e.geometry,n,this._overlaySpatialReference),n[2]=Q.gi;var a=(0,P.KF)(1),s=[[Fe.T.POSITION,new B.a(n,a,n.length)]],u=this._heatmapRendererFieldIsNumeric;null!=i&&s.push([Fe.T.FEATUREATTRIBUTE,new B.a([u&&null!==(t=e.attributes[i])&&void 0!==t?t:0],a,1)]);var o=new me.z(new _e.Z(r,s,null,J.U.Point),{layerUid:this.layer.uid,graphicUid:e.uid});return o.visible=this.filterVisibility.defaultVisibility,o}},{key:"_forEachMaterial",value:function(e){e(this._material),e(this._materialWithField)}},{key:"_computeFieldTotalChange",value:function(e,t){if(null==this._heatmapRendererFieldName||!this._heatmapRendererFieldIsNumeric)return e.length-t.length;var i=this._heatmapRendererFieldName,r=function(e,t){var r;return e+(null!==(r=t.attributes[i])&&void 0!==r?r:0)};return e.reduce(r,0)-t.reduce(r,0)}},{key:"_clampSearchRadius",value:function(e){return e>112&&y.Z.getLogger(this).warnOnce("SceneView supports a maximum radius of ".concat(112," pt for HeatmapRenderer.")),Math.min(e,112)}},{key:"_updateFeatureVisibilities",value:function(e){var t=this,i=[];this._featureStore.forEach((function(r){var n=r.objectId,a=r.displayId,s=e(n),u=t._renderGeometries.get(a);u&&u.visible!==s&&(i.push(u),u.visible=s)})),this._drapeSourceRenderer.modifyGeometries(i,ge.$.VISIBILITY)}},{key:"_setAllFeaturesVisibility",value:function(e){var t,i=[],r=(0,k.Z)(this._renderGeometries.values());try{for(r.s();!(t=r.n()).done;){var n=t.value;n.visible!==e&&(i.push(n),n.visible=e)}}catch(a){r.e(a)}finally{r.f()}this._drapeSourceRenderer.modifyGeometries(i,ge.$.VISIBILITY)}},{key:"test",get:function(){}}]),i}(w.default);(0,l._)([(0,f.Cb)()],Qe.prototype,"type",void 0),(0,l._)([(0,f.Cb)({constructOnly:!0})],Qe.prototype,"owner",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"layer",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"featureStore",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"updating",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"updatingRemaining",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"suspendInfo",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"legendEnabled",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"filterVisibility",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"displayFeatureLimit",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"preferredUpdatePolicy",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"hasZ",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"hasM",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"dataExtent",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"view",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"fullOpacity",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"updatePolicy",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"drapeSourceType",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"scaleVisibilitySuspended",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"renderer",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_featureStore",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"_filterVisibility",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"_overlayRenderer",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_overlaySpatialReference",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_rendererParameters",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_materialParameters",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_densityParameters",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_radiusParameter",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_resolutionForScaleParameter",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_colorRampParameter",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_pixelRatioParameter",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_densityMapPixelRatio",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_renderGeometries",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"_material",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"_materialWithField",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"_renderView",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_featuresArePoints",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_loadedPointGraphics",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_heatmapRenderer",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_heatmapRendererFieldName",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_heatmapRendererField",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_heatmapRendererFieldIsNumeric",null),(0,l._)([(0,f.Cb)()],Qe.prototype,"_fieldTotal",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"_drapeSourceRenderer",void 0),(0,l._)([(0,f.Cb)()],Qe.prototype,"_isScaleRangeActive",null),Qe=(0,l._)([(0,v.j)("esri.views.3d.layers.support.HeatmapFeatureProcessor")],Qe);var Be,Je,We=i(20488),Xe=i(93463),Ye=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e))._dataUpdatingState=Be.NONE,r.controller=null,r.updatingHandles=new _.R,r._controllerCreated=!1,r._pendingController=null,r}return(0,s.Z)(i,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(this._initializeController()),this.updatingHandles.add((function(){return e.layer.renderer}),(function(t){return e._recreateProcessor(t)}),p.initial),this.updatingHandles.add((function(){return e.updatePolicy}),(function(t){return e.processor.preferredUpdatePolicy=t}));this.queryEngine=new x.q({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return e.processor.featureStore},hasZ:this.hasZ,hasM:this.hasM},priority:Xe.T8.FEATURE_QUERY_ENGINE})}},{key:"destroy",value:function(){this.removeAllHandles(),this.updatingHandles.destroy(),this._destroyPendingController(),this.controller=(0,d.SC)(this.controller),this.processor=(0,d.SC)(this.processor),this.queryEngine=(0,d.SC)(this.queryEngine),this.loadedGraphics=null}},{key:"_destroyPendingController",value:function(){this._pendingController=(0,d.SC)(this._pendingController)}},{key:"updating",get:function(){var e,t;return this.updatingHandles.updating||!this._controllerCreated||(null===(e=this.controller)||void 0===e?void 0:e.updating)||(null===(t=this.processor)||void 0===t?void 0:t.updating)}},{key:"legendEnabled",get:function(){return this.processor.legendEnabled}},{key:"layer",get:function(){return this.layerView.layer}},{key:"view",get:function(){return this.layerView.view}},{key:"hasZ",get:function(){return this.layerView.hasZ}},{key:"hasM",get:function(){return this.layerView.hasM}},{key:"fullOpacity",get:function(){return this.layerView.fullOpacity}},{key:"suspended",get:function(){return this.layerView.suspended}},{key:"filter",get:function(){return"filter"in this.layerView?this.layerView.filter:null}},{key:"slicePlaneEnabled",get:function(){return this.layerView.slicePlaneEnabled}},{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.layerView?this.layerView.featureSpatialReference:null}},{key:"graphics3DProcessor",get:function(){var e;return"graphics-3d"===(null===(e=this.processor)||void 0===e?void 0:e.type)?this.processor:null}},{key:"heatmapProcessor",get:function(){var e;return"heatmap"===(null===(e=this.processor)||void 0===e?void 0:e.type)?this.processor:null}},{key:"hasAllFeatures",get:function(){return!(!this.controller||!("hasAllFeatures"in this.controller))&&this.controller.hasAllFeatures}},{key:"hasAllFeaturesInView",get:function(){return!(!this.controller||!("hasAllFeaturesInView"in this.controller))&&this.controller.hasAllFeaturesInView}},{key:"hasFullGeometries",get:function(){return!(!this.controller||!("hasFullGeometries"in this.controller))&&this.controller.hasFullGeometries}},{key:"symbologySnappingSupported",get:function(){var e,t,i,r=null===(e=this.layer)||void 0===e||null===(t=e.renderer)||void 0===t?void 0:t.getSymbols();return null!==(i=null===r||void 0===r?void 0:r.some(m.QL))&&void 0!==i&&i}},{key:"updatePolicy",get:function(){return be.j.SYNC}},{key:"scaleVisibilitySuspended",get:function(){var e;return null===(e=this.processor)||void 0===e?void 0:e.scaleVisibilitySuspended}},{key:"timeExtent",get:function(){return"timeExtent"in this.layerView?this.layerView.timeExtent:null}},{key:"dataUpdating",get:function(){return this._dataUpdatingState!==Be.NONE}},{key:"suspendInfo",get:function(){var e,t;return null!==(e=null===(t=this.processor)||void 0===t?void 0:t.suspendInfo)&&void 0!==e?e:{}}},{key:"forEachGraphic",value:function(e){this.loadedGraphics.forEach(e)}},{key:"findGraphic",value:function(e){return this.loadedGraphics.find(e)}},{key:"queryObjectIds",value:function(e,t){return this.layerView.queryObjectIds(e,t)}},{key:"whenGraphicBounds",value:function(e,t){var i;return null===(i=this.processor)||void 0===i?void 0:i.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){var i;return null===(i=this.processor)||void 0===i?void 0:i.computeAttachmentOrigin(e,t)}},{key:"elevationAlignPointsInFeatures",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=this.graphics3DProcessor)){e.next=3;break}throw new c.Z("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");case 3:return e.abrupt("return",(0,b.W)(this.view,this.layer,(function(e){return n.getGraphics3DGraphicByObjectId(e)}),t,i));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"queryForSymbologySnapping",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.symbologySnappingSupported?(0,C.c)(this.graphics3DProcessor,t,i):{candidates:[],sourceCandidateIndices:[]});case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"highlight",value:function(e){return this.processor.highlight(e,this.layer.objectIdField)}},{key:"maskOccludee",value:function(e){return this.processor.maskOccludee(e)}},{key:"_initializeController",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.createController(),this._pendingController=t,this._setupDataUpdating(t),e.next=5,t.when();case 5:this._setControllerWhenInitialized(t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setupDataUpdating",value:function(e){var t=this;"dataUpdating"in e&&this.addHandles([(0,p.watch)((function(){return e.dataUpdating}),(function(e){e&&t._dataUpdatingState===Be.NONE?t._dataUpdatingState=Be.CONTROLLER:e||t._dataUpdatingState!==Be.CONTROLLER||(t._dataUpdatingState=Be.NONE)}),p.sync),(0,p.watch)((function(){var e;return!(null===(e=t.graphics3DProcessor)||void 0===e||!e.dataUpdating)}),(function(i){i&&t._dataUpdatingState===Be.CONTROLLER?t._dataUpdatingState=Be.CORE:i||t._dataUpdatingState!==Be.CORE||(t._dataUpdatingState=e.dataUpdating?Be.CONTROLLER:Be.NONE)}),p.sync)])}},{key:"_setControllerWhenInitialized",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){var i=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.when();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:if(this._controllerCreated=!0,!this.isResolved()||this.destroyed){e.next=17;break}return e.next=11,(0,p.whenOnce)((function(){var e,t;return null===(e=i.view)||void 0===e||null===(t=e.basemapTerrain)||void 0===t?void 0:t.ready}));case 11:this.beforeSetController(t),this._pendingController=null,this.controller=t,this.loadedGraphics=t.graphics,e.next=18;break;case 17:this._destroyPendingController();case 18:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_recreateProcessor",value:function(e){var t,i,r=this,n="heatmap"===(null===e||void 0===e?void 0:e.type),a="heatmap"===(null===(t=this.processor)||void 0===t?void 0:t.type),s=this.processor;if(!s||n!==a){var u=n?new Qe({owner:this}):new F.I({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:function(e){return r._updateClippingExtent(e)}});this.processor=u,null!==s&&void 0!==s&&s.destroy(),null!==(i=this.queryEngine)&&void 0!==i&&i.clear(),this.addResolvingPromise(u.initializePromise)}}},{key:"_updateClippingExtent",value:function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}}},{key:"performanceInfo",get:function(){var e,t,i,r=this.controller instanceof g.g?this.controller:null;return new We.W(this.processor.usedMemory,null===(e=this.loadedGraphics)||void 0===e?void 0:e.length,null!==(t=null===r||void 0===r?void 0:r.serviceDataCount)&&void 0!==t?t:-1,null!==(i=null===r||void 0===r?void 0:r.maximumNumberOfFeatures)&&void 0!==i?i:-1,0,this.processor.performanceInfo)}}]),i}(h.D);(0,l._)([(0,f.Cb)()],Ye.prototype,"updating",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"legendEnabled",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"layerView",void 0),(0,l._)([(0,f.Cb)()],Ye.prototype,"layer",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"view",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"hasZ",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"hasM",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"fullOpacity",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"suspended",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"filter",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"slicePlaneEnabled",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"featureSpatialReference",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"loadedGraphics",void 0),(0,l._)([(0,f.Cb)()],Ye.prototype,"graphics3DProcessor",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"heatmapProcessor",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"hasAllFeatures",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"hasAllFeaturesInView",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"hasFullGeometries",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"symbologySnappingSupported",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"updatePolicy",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"queryEngine",void 0),(0,l._)([(0,f.Cb)()],Ye.prototype,"scaleVisibilitySuspended",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"timeExtent",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"_dataUpdatingState",void 0),(0,l._)([(0,f.Cb)({readOnly:!0})],Ye.prototype,"dataUpdating",null),(0,l._)([(0,f.Cb)()],Ye.prototype,"controller",void 0),(0,l._)([(0,f.Cb)()],Ye.prototype,"processor",void 0),(0,l._)([(0,f.Cb)()],Ye.prototype,"updatingHandles",void 0),(0,l._)([(0,f.Cb)()],Ye.prototype,"_controllerCreated",void 0),Ye=(0,l._)([(0,v.j)("esri.views.3d.layers.graphics.Graphics3DGraphicsPipeline")],Ye),(Je=Be||(Be={}))[Je.NONE=0]="NONE",Je[Je.CONTROLLER=1]="CONTROLLER",Je[Je.CORE=2]="CORE"},82607:function(e,t,i){i.d(t,{q:function(){return F}});var r=i(1413),n=i(74165),a=i(15861),s=i(15671),u=i(43144),o=i(60136),l=i(29388),c=i(27366),d=(i(59486),i(7138)),h=i(49861),p=(i(93169),i(32718),i(84936),i(69912)),f=i(53866),y=i(75878),v=i(52410),_=i(49818),g=i(21149),m=i(27823),b=y.q,F=function(e){(0,o.Z)(i,e);var t=(0,l.Z)(i);function i(e){var r;return(0,s.Z)(this,i),(r=t.call(this,e))._dataQueryEngineInstance=null,r}return(0,u.Z)(i,[{key:"layer",get:function(){return this.context.layer}},{key:"spatialReference",get:function(){return this.context.spatialReference}},{key:"_queryGeometryType",get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}},{key:"defaultQueryJSON",get:function(){return new g.Z({outSpatialReference:this.spatialReference}).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}},{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}},{key:"executeQueryForIdSet",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(t,i),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){var r,a,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),i);case 2:return r=e.sent,a=r.count,s=r.extent,e.abrupt("return",{count:a,extent:f.Z.fromJSON(s)});case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){var r,a,s=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(t),i);case 2:return r=e.sent,a=_.Z.fromJSON(r),e.abrupt("return",(a.features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQuery",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){var r,a,s=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._dataQueryEngine.executeQuery(this._ensureQueryJSON(t),i);case 2:return r=e.sent,a=_.Z.fromJSON(r),e.abrupt("return",(a.features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_ensureQueryJSON",value:function(e,t){var i=this.defaultQueryJSON;if(null!=e&&("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),i=e.toJSON()),null!=t){var n=t.geometries.map((function(e){return e.toJSON()})).reduce((function(e,t){return e.rings=e.rings.concat(t.rings),e}));i=(0,r.Z)((0,r.Z)({},i),{},{sceneFilter:(0,r.Z)((0,r.Z)({},t),{},{geometry:n})})}return i}},{key:"_ensureDataQueryEngine",value:function(){var e,t;if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var i="timeInfo"in this.layer&&(null===(e=this.layer.timeInfo)||void 0===e?void 0:e.toJSON())||null,r=this.layer.objectIdField,n=m.M.toJSON(this._queryGeometryType),a=(null===(t=this.layer.fieldsIndex)||void 0===t?void 0:t.toJSON())||new v.Z([]),s=this.priority,u=this.spatialReference.toJSON(),o=this.context,l=o.hasZ,c=o.hasM,d=o.featureStore,h=o.scheduler;return this._dataQueryEngineInstance=new b({hasZ:l,hasM:c,geometryType:n,fieldsIndex:a,timeInfo:i,spatialReference:u,objectIdField:r,featureStore:d,scheduler:h,priority:s}),this._dataQueryEngineInstance}}]),i}(d.default);(0,c._)([(0,h.Cb)({constructOnly:!0})],F.prototype,"context",void 0),(0,c._)([(0,h.Cb)({constructOnly:!0})],F.prototype,"priority",void 0),(0,c._)([(0,h.Cb)()],F.prototype,"layer",null),(0,c._)([(0,h.Cb)()],F.prototype,"spatialReference",null),(0,c._)([(0,h.Cb)()],F.prototype,"_queryGeometryType",null),(0,c._)([(0,h.Cb)()],F.prototype,"defaultQueryJSON",null),F=(0,c._)([(0,p.j)("esri.views.3d.layers.graphics.QueryEngine")],F)},32080:function(e,t,i){i.d(t,{j:function(){return L},A:function(){return G}});var r,n=i(74165),a=i(15861),s=i(29439),u=i(37762),o=i(15671),l=i(43144),c=i(60136),d=i(29388),h=i(27366),p=i(7138),f=(i(93169),i(32718)),y=i(77427),v=i(66978),_=i(18442),g=i(94172),m=i(99346),b=i(49861),F=(i(84936),i(69912)),x=i(65156),C=i(65618),k=i(94618),E=i(21149),w=i(50951),R=(i(78952),i(41414),i(16889),i(53866),i(32238),i(77577),i(848),i(80885),i(29909),i(27823),i(83040),i(70178)),S=function(){function e(t,i){(0,o.Z)(this,e),this._highestResolutionVersion=null,this.versions=[],this.ref(t,i)}return(0,l.Z)(e,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"ref",value:function(e,t){var i=this.feature;Z.oldVersion=i,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});var r,n=(0,u.Z)(this.versions);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a.resolution===t){a.refCount++;var s=this._highestResolutionVersion===a&&!(0,R.fS)(e,a.feature);return(s||this._highestResolutionVersion!==a)&&(a.feature=e),Z.newVersion=s?e:i,Z}}}catch(l){n.e(l)}finally{n.f()}var o={feature:e,resolution:t,refCount:1};return this.versions.push(o),!this._highestResolutionVersion||t<this._highestResolutionVersion.resolution?(Z.newVersion=e,this._highestResolutionVersion=o):Z.newVersion=i,Z}},{key:"unref",value:function(e){for(var t=0;t<this.versions.length;t++){var i=this.versions[t];if(i.resolution===e)return i.refCount--,Z.oldVersion=this.feature,0===i.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this._highestResolutionVersion===i&&(this._recalculateHighestResolutionVersion(),Z.oldVersion=i.feature)),Z.newVersion=this.feature,Z}return null}},{key:"feature",get:function(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}},{key:"_recalculateHighestResolutionVersion",value:function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var i=this.versions[t];i.resolution<e.resolution&&(e=i)}this._highestResolutionVersion=e}else this._highestResolutionVersion=null}}]),e}(),T=function(){function e(t){(0,o.Z)(this,e),this._feature=t,this._refCount=1}return(0,l.Z)(e,[{key:"isReferenced",get:function(){return 0!==this._refCount}},{key:"isSingle",get:function(){return 1===this._refCount}},{key:"ref",value:function(e){return++this._refCount,Z.oldVersion=this._feature,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0}),(0,R.fS)(this._feature,e)||(this._feature=e),Z.newVersion=this._feature,Z}},{key:"unref",value:function(){return Z.oldVersion=this._feature,this._refCount>0&&(this._refCount--,!this.isReferenced)?(Z.newVersion=null,Z):(Z.newVersion=this._feature,Z)}},{key:"feature",get:function(){return this._feature}}]),e}(),Z={oldVersion:null,newVersion:null},O=i(63780),D=i(76432),P=new Set,I=function(){function e(t){(0,o.Z)(this,e),this.descriptor=t,this.fetchStatus=r.FETCH_NEEDED,this._features=null,this._featuresLength=(0,D.t)(0),this._numVertices=0,this._featureLimit=(0,D.t)(0),this._featuresMissing=(0,D.t)(!0),this._fetchFailed=(0,D.t)(!1),this._shuffled=!1,this._numFeatures=V,this._emptyFeatureRatio=(0,D.t)(0),this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=P,this._displayingFeatures=null,this.alive=!0,this.filtered=!1}return(0,l.Z)(e,[{key:"featuresMissing",get:function(){return this._featuresMissing.value},set:function(e){this._featuresMissing.value=e}},{key:"missingAttributes",get:function(){return this._missingAttributes}},{key:"fetchFailed",get:function(){return this._fetchFailed.value},set:function(e){this._fetchFailed.value=e}},{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(e){this._displayingFeatures=e,this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){var e=(this.fetchStatus===r.DONE||this.fetchStatus===r.FULL)&&this.featuresMissing;return!this.filtered&&(e||this.hasFeatureLimit)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit.value},set:function(e){this._featureLimit.value!==e&&(this._featureLimit.value=e,this._estimatedUnusedSizeDirty=!0)}},{key:"hasFeatureLimit",get:function(){return this.featureLimit!==this._featuresLength.value}},{key:"hasAllFeatures",get:function(){return!(this.featuresMissing||this.fetchFailed||this.hasFeatureLimit)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"setFeatures",value:function(e,t,i,r){var n;this._availableFields=null!==i&&void 0!==i?i:P,this._features=e,this._featuresLength.value=null!==(n=null===e||void 0===e?void 0:e.length)&&void 0!==n?n:0,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,this._missingAttributes=r,e&&e.length>0?(this._emptyFeatureRatio.value=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+(0,C.R3)(t.geometry)}),0)):(this._emptyFeatureRatio.value=0,this._numVertices=0)}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio.value}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e}},{key:"hasPreciseFeatureCount",get:function(){return this._numFeatures>V}},{key:"needsFeatureCount",get:function(){return this._numFeatures===V}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){return this.updateMemoryEstimates(),this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"updateMemoryEstimates",value:function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=(0,C.Xw)(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(var i=this.featureLimit;i<this._features.length;++i)this._estimatedUnusedSize+=(0,C.Xw)(this._features[i]);return!0}return!1}},{key:"isFetching",get:function(){return this.fetchStatus===r.FETCHING||this.fetchStatus===r.REFETCHING}},{key:"isRefetching",get:function(){return this.fetchStatus===r.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===r.FETCH_NEEDED||this.fetchStatus===r.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===r.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===r.DONE||this.fetchStatus===r.FULL}},{key:"resetFetching",value:function(){this.fetchStatus=this.fetchStatus===r.REFETCHING?r.REFETCH_NEEDED:r.FETCH_NEEDED}},{key:"needsDisplayUpdate",get:function(){return!!this._features&&!function(e,t,i){if(null==t||null==e||i!==t.length||i>e.length)return!1;for(var r=0;r<i;++r)if(e[r]!==t[r])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)}},{key:"intersects",value:function(e){return null==e||!this.descriptor.extent||((0,x.oJ)(e,M),(0,x.kK)(this.descriptor.extent,M))}},{key:"intersectionIncludingBorrowed",value:function(e,t){var i=null!=this.extentIncludingBorrowedFeatures?this.extentIncludingBorrowedFeatures:this.descriptor.extent;return e||i?(null!=e?((0,x.oJ)(e,t),(0,x.jV)(t,i,t)):(0,x.JG)(t,i),t):((0,x.JG)(t,x.gy),t)}},{key:"_shuffle",value:function(e){this._features&&(this._features.sort((function(t,i){return(0,C.MS)(t,e)-(0,C.MS)(i,e)})),(0,O.TV)(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0)}},{key:"reduceFeatures",value:function(e,t,i){if(e<=0)return!1;if(!this._features)return this.featureLimit=0,!1;var n=!1;this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===r.DONE&&this._features.length>0&&(this.fetchStatus=r.REFETCH_NEEDED,n=!0)),!this._shuffled&&e<1&&this._shuffle(i);var a=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));return this._features.length>a&&(this._features.length=a,this._featuresLength.value=a,this.featuresMissing=!0,this.fetchStatus===r.FULL&&(this.fetchStatus=r.DONE)),n}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio.value,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){var t,i;this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._featuresLength.value=null!==(t=null===(i=e.features)||void 0===i?void 0:i.length)&&void 0!==t?t:0,this._numFeatures=e.numFeatures,this._emptyFeatureRatio.value=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0}}]),e}(),V=-1;!function(e){e[e.FETCH_NEEDED=0]="FETCH_NEEDED",e[e.REFETCH_NEEDED=1]="REFETCH_NEEDED",e[e.FETCHING=2]="FETCHING",e[e.REFETCHING=3]="REFETCHING",e[e.DONE=4]="DONE",e[e.FULL=5]="FULL"}(r||(r={}));var M=(0,x.Ue)(),A=i(36734),N=i(93463),L=function(e){(0,c.Z)(i,e);var t=(0,d.Z)(i);function i(e){var r;return(0,o.Z)(this,i),(r=t.call(this,e))._useTileCount=!1,r.dataUpdating=!1,r.running=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r._fullRatio=1,r._farRatio=1,r._changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},r._frameTask=N.sq,r._dirty=!1,r._featureTiles=new _.Z,r._displayingFeatureReferences=new Map,r._numDisplayingFeatureReferences=0,r._suspended=!0,r._pendingEdits=null,r._applyEditsTilesUpdated=!1,r._isFetching=!1,r}return(0,l.Z)(i,[{key:"maximumNumberOfFeatures",set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this._maximumFeaturesUpdated(t,e))}},{key:"memoryFactor",set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this._setDirty())}},{key:"lodFactor",set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this._supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&null!=this.context.query.queryFeatureCount},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")}},{key:"updating",get:function(){var e,t;return this._dirty||!!this._pendingEdits||this._isFetching||null!==(e=null===(t=this.tileDescriptors)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"memoryForUnusedFeatures",get:function(){var e=0;return this._featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e}},{key:"totalVertices",get:function(){var e=0;return this._featureTiles.forEach((function(t){return e+=t.numVertices})),e}},{key:"totalFeatures",get:function(){var e=0;return this._featureTiles.forEach((function(t){return e+=t.numFeatures})),e}},{key:"hasAllFeatures",get:function(){if(this._paused||this.dataUpdating)return!1;var e,t=(0,u.Z)(this._featureTiles);try{for(t.s();!(e=t.n()).done;){var i=(0,s.Z)(e.value,2)[1];if(!this.hasFullGeometries&&0!==i.emptyFeatureRatio||!i.hasAllFeatures)return!1}}catch(r){t.e(r)}finally{t.f()}return!0}},{key:"hasFullGeometries",get:function(){return!this._supportsResolution||(!this.tileDescriptors.find((function(e){return null!=e.resolution}))||!this.context.capabilities.supportsQuantization&&"polyline"!==this.context.geometryType)}},{key:"filterExtent",set:function(e){if(null==e||!this.context.tilingScheme||e.spatialReference.equals(this.context.tilingScheme.spatialReference)){var t=this._get("filterExtent");if(!(t===e||null!=t&&e&&t.equals(e))){var i=null!=e?e.clone():null;this._set("filterExtent",i),this._reclip(i,t)}}else f.Z.getLogger(this).error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme")}},{key:"initialize",value:function(){var e=this;this.addHandles((0,g.on)((function(){return e.tileDescriptors}),"change",(function(){return e._setDirty()}),{sync:!0,onListenerAdd:function(){return e._setDirty()}})),this._objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?S:T;var t=this.context.scheduler;null!=t&&(this._frameTask=t.registerTask(N.T8.FEATURE_TILE_FETCHER,this)),this._setDirty()}},{key:"destroy",value:function(){var e,t=this;this._frameTask.remove(),this._featureTiles.forEach((function(e){t._cancelFetchTile(e),t._removeTile(e)})),this._featureTiles.clear(),this._displayingFeatureReferences.clear(),null!==(e=this._pendingEdits)&&void 0!==e&&e.controller.abort(),this._pendingEdits=null}},{key:"_paused",get:function(){return this._suspended||!!this._pendingEdits}},{key:"restart",value:function(){var e=this;this._featureTiles.forEach((function(t){e._cancelFetchTile(t),e._clearTile(t),e._resetFetchTile(t)})),null!=this.context.memoryCache&&this.context.memoryCache.clear(),this._setDirty()}},{key:"refetch",value:function(){var e=this;this._featureTiles.forEach((function(t){e._cancelFetchTile(t),e._resetFetchTile(t)})),null!=this.context.memoryCache&&this.context.memoryCache.clear(),this._setDirty()}},{key:"suspend",value:function(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())}},{key:"resume",value:function(){this._suspended&&(this._suspended=!1,this._unpause())}},{key:"getMissingAttributesForFeature",value:function(e){var t,i=(0,u.Z)(this._featureTiles);try{for(i.s();!(t=i.n()).done;){var r,n=null===(r=(0,s.Z)(t.value,2)[1].missingAttributes)||void 0===r?void 0:r.get(e);if(null!=n)return n}}catch(a){i.e(a)}finally{i.f()}}},{key:"_pause",value:function(){var e=this;this._paused&&(this._featureTiles.forEach((function(t){return e._cancelFetchTile(t)})),this._updated())}},{key:"_unpause",value:function(){this._paused||this._setDirty()}},{key:"availableFields",get:function(){var e=null;return this._featureTiles.forEach((function(t){null!=t.displayingFeatures&&0!==t.displayingFeatures.length&&(null==e?e=new Set(t.availableFields):e.forEach((function(i){t.availableFields.has(i)||e.delete(i)})))})),null!=e?e:new Set}},{key:"applyEdits",value:function(e){var t=this;this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());var i=this._pendingEdits;i.count++;var r=i.edits.then((function(){return e.result.catch((function(e){if((0,v.D_)(e))throw e;return null})).then((function(e){return e?(t._applyEditsDeleteFeatures(e.deletedFeatures),t._applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,i.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--i.count&&(t._pendingEdits===i&&(t._pendingEdits=null),null!=t.context.memoryCache&&t.context.memoryCache.clear(),t._applyEditsTilesUpdated=!1,t._unpause()),e}))}));return i.edits=r,this._updated(),r}},{key:"_applyEditsDeleteFeatures",value:function(e){var t=this;if(0!==e.length){var i=this.context.globalIdField,r=i&&this.availableFields.has(i),n=new Set,a=this._objectIdField;e.forEach((function(e){var s=e.objectId,u=e.globalId;(!s||s<0)&&i&&u&&(r||f.Z.getLogger(t).errorOncePerTick("Editing the specified service requires the layer's globalIdField, ".concat(i," to be included the layer's outFields for updates to be reflected in the view")),s=t._objectIdFromGlobalId(u,a,i)),null!=s&&s>=0&&n.add(s)})),this._featureTiles.forEach((function(e){if(e.features){var i=e.features.filter((function(e){return!n.has((0,C.MS)(e,t._objectIdField))}));i.length!==e.features.length&&(t._applyEditsTileUpdated(),e.setFeatures(i,0,e.availableFields,e.missingAttributes),t._invalidateCounts())}}))}}},{key:"_objectIdFromGlobalId",value:function(e,t,i){if(null==e)return null;var r=this.features.find((function(t){var r;return(null===(r=t.attributes)||void 0===r?void 0:r[i])===e}));return r?(0,C.MS)(r,t):null}},{key:"_applyEditsAddUpdateFeatures",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s,o,l,c,d,h,p,y,v,_,g,m,b,F,x,C,k=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.context,s=a.objectIdField,o=a.globalIdField,l=o&&this.availableFields.has(o),c=new Set,d=new Set,h=(0,u.Z)(t);try{for(h.s();!(p=h.n()).done;)y=p.value,null!=(v=y.objectId)&&c.add(v)}catch(n){h.e(n)}finally{h.f()}_=(0,u.Z)(i);try{for(_.s();!(g=_.n()).done;)m=g.value,b=m.objectId,F=m.globalId,(null==(x=b)||x<0)&&o&&(l||f.Z.getLogger(this).errorOncePerTick("Editing the specified service requires the layer's globalIdField, ".concat(o," to be included the layer's outFields for updates to be reflected in the view")),x=this._objectIdFromGlobalId(F,s,o)),null!=x&&x>=0&&(c.add(x),d.add(x))}catch(n){_.e(n)}finally{_.f()}if(0!==c.size){e.next=7;break}return e.abrupt("return");case 7:return C=[],this._featureTiles.forEach((function(e){var t=k._applyEditsAddUpdateTile(e,c,d,r);t&&C.push(t)})),this._updated(),e.next=12,Promise.allSettled(C);case 12:case"end":return e.stop()}}),e,this)})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"_applyEditsAddUpdateTile",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r,a){var s,o,l,c,d,h,p,f=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:return(s=this._createQuery(t)).resultType=void 0,s.cacheHint=!1,s.objectIds=Array.from(i),e.next=6,this._queryFeatures(s,a);case 6:if(o=e.sent,l=null,r.size>0&&(c=t.features.filter((function(e){return!r.has((0,C.MS)(e,f._objectIdField))}))).length!==t.features.length&&(l=c),o.features.length>0){l||(l=t.features.slice()),d=(0,u.Z)(o.features);try{for(d.s();!(h=d.n()).done;)p=h.value,l.push(p)}catch(n){d.e(n)}finally{d.f()}}l&&(t.hasPreciseFeatureCount&&(t.numFeatures=Math.max(t.numFeatures,l.length)),this._applyEditsTileUpdated(),t.setFeatures(l,0,j(t.availableFields,o.fields),Q(t.missingAttributes,o.missingAttributes)),this._invalidateCounts());case 11:case"end":return e.stop()}}),e,this)})));return function(t,i,r,n){return e.apply(this,arguments)}}()},{key:"_applyEditsTileUpdated",value:function(){this._applyEditsTilesUpdated||(this._applyEditsTilesUpdated=!0,this._updated())}},{key:"_queryFeatures",value:function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:X})}},{key:"_setDirty",value:function(){this._dirty=!0,this._updated()}},{key:"runTask",value:function(e){var t=this,i=this._frameTask.processQueue(e);if(!this._dirty||!this.initialized)return i;this._dirty=!1;var r=this._getListOfTiles();if(this._markTilesNotAlive(r),e.run((function(){return t._addTiles(r,e)}))&&e.run((function(){return t._filterExtentTiles(r,e)}))&&e.run((function(){return t._removeTiles(r,e)}))&&!e.done){var n=this._sortTiles(r);e.run((function(){return t._showTiles(n,e)}))&&e.run((function(){return t._fetchTiles(n,e)}))&&e.run((function(){return t._updateMemoryEstimates(n,e)}))||this._setDirty(),this._updated(),this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}},{key:"_markTilesNotAlive",value:function(e){var t,i=(0,u.Z)(e);try{for(i.s();!(t=i.n()).done;){t.value.alive=!1}}catch(r){i.e(r)}finally{i.f()}}},{key:"_addTiles",value:function(e,t){var i=this;return!(this._suspended||!this.tileDescriptors)&&(this.tileDescriptors.forEach((function(r){var n=i._featureTiles.get(r.id);n?n.alive=!0:t.done||(e.push(i._addTile(r)),t.madeProgress())})),t.hasProgressed)}},{key:"_filterExtentTiles",value:function(e,t){var i,r=(0,u.Z)(e);try{for(r.s();!(i=r.n()).done;){var n=i.value;if(t.done)break;n.alive&&(n.filtered=!n.intersects(this.filterExtent),n.filtered&&(this._clearTile(n),t.madeProgress()))}}catch(a){r.e(a)}finally{r.f()}return t.hasProgressed}},{key:"_removeTiles",value:function(e,t){for(var i=e.length-1;i>=0&&!t.done;i--){var r=e[i];r.alive||(this._removeTile(r),i!==e.length-1&&(e[i]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed}},{key:"_sortTiles",value:function(e){return e.sort((function(e,t){var i,r;return(null!==(i=e.descriptor.loadPriority)&&void 0!==i?i:0)-(null!==(r=t.descriptor.loadPriority)&&void 0!==r?r:0)})),e}},{key:"_showTiles",value:function(e,t){var i,r=this,n=this._updateRatio(e),a=(0,u.Z)(e);try{var s=function(){var e=i.value;if(!t.run((function(){return function(e){var t=r._fullRatio<1?n(e)*r._farRatio:1;return e.reduceFeatures(t,r.memoryFactor,r._objectIdField)&&r._setDirty(),r._showTile(e)}(e)})))return r._setDirty(),"break"};for(a.s();!(i=a.n()).done;){if("break"===s())break}}catch(o){a.e(o)}finally{a.f()}return t.hasProgressed}},{key:"_fetchTiles",value:function(e,t){var i=this;if(this._paused)return!1;var r,n=!1,a=(0,u.Z)(e);try{var s=function(){var e=r.value;if(!e.needsFetching)return"continue";var a=null!=i.context.memoryCache?i.context.memoryCache.pop(e.id):null;if(null==a){if(i._needsNumFeatures(e)){var s=new AbortController,u=i._fetchTileCount(e,s.signal);i._handleRequest(e,u,s,(function(){return e.numFeatures=-2})),n=!0,t.madeProgress()}if(t.done)return{v:!0}}else e.cache=a,e.numFeatures&&i._notifyDataUpdating(),i._setDirty(),i._scheduleUpdated(),t.madeProgress()};for(a.s();!(r=a.n()).done;){var o=s();if("continue"!==o&&"object"===typeof o)return o.v}}catch(p){a.e(p)}finally{a.f()}if(n)return t.hasProgressed;var l,c=(0,u.Z)(e);try{var d=function(){var e=l.value;if(e.needsFetching){var r=new AbortController,n=i._fetchTile(e,r.signal);if(i._handleRequest(e,n,r,(function(t){e.setFeatures([],0,null,void 0),i._invalidateCounts(),e.featuresMissing=!1,e.fetchFailed=!0,i.context.logFetchError(f.Z.getLogger(i),t)})),t.madeProgress())return{v:!0}}};for(c.s();!(l=c.n()).done;){var h=d();if("object"===typeof h)return h.v}}catch(p){c.e(p)}finally{c.f()}return t.hasProgressed}},{key:"_updateMemoryEstimates",value:function(e,t){var i=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(i._setDirty(),!0)})),t.hasProgressed}},{key:"_reclip",value:function(e,t){if(this.initialized){var i=new Array;this._featureTiles.forEach((function(r){null!=r.displayingFeatures&&0!==r.displayingFeatures.length&&(r.intersectionIncludingBorrowed(t,J),r.intersectionIncludingBorrowed(e,W),(0,x.fS)(J,W)||i.push(r))})),this._refreshDisplayingFeatures(i),this._updated()}}},{key:"_refreshDisplayingFeatures",value:function(e){var t,i=new Set,r=this._changes.updates,n=(0,u.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(null!=a.displayingFeatures){var s,o=(0,u.Z)(a.displayingFeatures);try{for(o.s();!(s=o.n()).done;){var l=s.value,c=(0,C.MS)(l,this._objectIdField);if(!i.has(c)){i.add(c);var d=this._displayingFeatureReferences.get(c).feature;r.removes.push(d),r.adds.push(d)}}}catch(h){o.e(h)}finally{o.f()}}}}catch(h){n.e(h)}finally{n.f()}this._applyChanges()}},{key:"_updated",value:function(){var e=this,t=0;if(this._paused||this._featureTiles.forEach((function(e){return e.isFetching?++t:0})),this._isFetching=t>0,this._set("running",this._dirty),t>0||this._applyEditsTilesUpdated?this._notifyDataUpdating():this._dirty||this._set("dataUpdating",!1),this.updating){var i=0,r=0,n=0,a=0,s=0,u=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach((function(t){if(++r,t.isFetching&&t.hasPreciseFeatureCount){var o=e._maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),l=null!=t.displayingFeatures?t.displayingFeatures.length*u:0;s+=o-l}t.needsFetching?++a:t.numFeatures>0&&(++n,i+=t.numFeatures)})),a+=t;var o=0,l=0;i?(l=i,o=Math.min(a*i/n,i)):(l=r,o=a),s=Math.min(this.maximumNumberOfFeatures-this.features.length,s),this._set("updatingTotal",l),this._set("updatingRemaining",o),this._set("expectedFeatureDiff",s)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}},{key:"_updateMaximumNumberOfFeaturesExceeded",value:function(){var e=(0,y.oE)(this._featureTiles,(function(e){return e.perTileMaximumNumberOfFeaturesExceeded}));this._set("maximumNumberOfFeaturesExceeded",e)}},{key:"_updateRatio",value:function(e){var t,i=function(e){var t,i=0,r=(0,u.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.features&&n.features.length>0&&n.alive&&(i=Math.max(i,n.descriptor.lij[0]))}}catch(a){r.e(a)}finally{r.f()}return i}(e),r=function(e){return 1/(1<<Math.max(0,i-e.descriptor.lij[0]))},n=0,a=0,s=(0,u.Z)(e);try{for(s.s();!(t=s.n()).done;){var o=t.value,l=o.numFeatures;n+=l,a+=l*r(o)}}catch(c){s.e(c)}finally{s.f()}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/n),this._farRatio=this.maximumNumberOfFeatures/a,this._scheduleUpdated(),r}},{key:"_maximumFeaturesUpdated",value:function(e,t){var i=this;e!==t&&(t>e&&this._featureTiles.forEach((function(e){if(e.featuresMissing){var t=i._maximumFeaturesForTile(e);e.features&&(e.features.length>=t||e.fetchStatus===r.FULL)||(i._cancelFetchTile(e),i._resetFetchTile(e))}})),this._setDirty())}},{key:"_addTile",value:function(e){var t=new I(e);return this._featureTiles.set(t.id,t),this._resetFetchTile(t),this._referenceDisplayingFeaturesFromRelatedTiles(t),t}},{key:"_referenceDisplayingFeaturesFromRelatedTiles",value:function(e){var t=this,i=e.descriptor.resolution;this._featureTiles.forEach((function(r){if(!(null==r.displayingFeatures||e===r||e.descriptor.lij&&r.descriptor.lij&&!(0,A.E9)(e.descriptor.lij,r.descriptor.lij))){null==e.displayingFeatures&&(e.displayingFeatures=[]),e.descriptor.extent&&r.descriptor.extent&&(null==e.extentIncludingBorrowedFeatures&&(e.extentIncludingBorrowedFeatures=(0,x.d9)(e.descriptor.extent)),(0,x.jn)(e.extentIncludingBorrowedFeatures,r.descriptor.extent,e.extentIncludingBorrowedFeatures));var n,a=(0,u.Z)(r.displayingFeatures);try{for(a.s();!(n=a.n()).done;){var s=n.value;e.displayingFeatures.push(s);var o=t._displayingFeatureReferences.get((0,C.MS)(s,t._objectIdField));o.ref(o.feature,i),t._numDisplayingFeatureReferences++}}catch(l){a.e(l)}finally{a.f()}}})),e.featureLimit=null!=e.displayingFeatures?e.displayingFeatures.length:0}},{key:"_removeTile",value:function(e){this._clearTile(e),this._featureTiles.delete(e.id)}},{key:"_resetFetchTile",value:function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=r.DONE):e.fetchStatus=r.FETCH_NEEDED}},{key:"_cancelFetchTile",value:function(e){var t=e.requestController;null!=t&&(e.requestController=null,e.resetFetching(),t.abort())}},{key:"_fetchTileCount",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchCount(t,i);case 2:return t.numFeatures=e.sent,this._updateRatio(this._getListOfTiles()),e.abrupt("return",t.fetchStatus===r.REFETCHING?r.REFETCH_NEEDED:r.FETCH_NEEDED);case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_fetchTile",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){var a,s,u,o,l,c,d,h,p,f,y,_=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.fetchFailed=!1,!((a=this._maximumFeaturesForTile(t))<=0)){e.next=4;break}return e.abrupt("return",(t.hasPreciseFeatureCount&&0===t.numFeatures||(t.fetchFailed=!0),q(t)));case 4:if(s=this._getMaxRecordCount(t),u=Math.ceil(a/s),!(H(t)||!this.context.capabilities.supportsMaxRecordCountFactor||t.numFeatures<=a&&u>E.Z.MAX_MAX_RECORD_COUNT_FACTOR)){e.next=7;break}return e.abrupt("return",this._fetchPagedTile(t,i));case 7:return(o=this._createQuery(t)).maxRecordCountFactor=Math.ceil(a/s),t.isRefetching&&t.features&&t.features.length>0&&(l=Math.ceil(t.features.length/(1-t.emptyFeatureRatio)/s),o.maxRecordCountFactor=Math.max(l+1,o.maxRecordCountFactor)),e.next=11,this._queryFeatures(o,i);case 11:return c=e.sent,d=c.features,h=c.exceededTransferLimit,p=c.fields,f=c.missingAttributes,y=h?o.maxRecordCountFactor>=E.Z.MAX_MAX_RECORD_COUNT_FACTOR?r.FULL:r.DONE:r.FULL,e.next=19,this._frameTask.schedule((function(){t.featuresMissing=t.hasPreciseFeatureCount&&d.length<t.numFeatures||!!h;var e=_._removeEmptyFeatures(d);t.setFeatures(d,e,z(p),Q(void 0,f))}),i);case 19:return(0,v.k_)(i),this._invalidateCounts(),e.abrupt("return",y);case 22:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_fetchCount",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.context.query.queryFeatureCount(this._createFeatureCountQuery(t),{signal:i}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_fetchPagedTile",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){var a,s,u,o,l,c,d,h,p,f,y=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0,u=0,o=0,l=this._maximumFeaturesForTile(t)-o,c=this._getMaxRecordCount(t),h=null,p=(0,n.Z)().mark((function e(){var p,f,_,g,m,b,F;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=y._createQuery(t),f=y._setPagingParameters(p,s,l,c),e.next=4,y._queryFeatures(p,i);case 4:return _=e.sent,g=_.features,m=_.exceededTransferLimit,b=_.fields,F=_.missingAttributes,e.next=11,y._frameTask.schedule((function(){f&&(s+=p.num),o+=g.length,u+=y._removeEmptyFeatures(g),t.featuresMissing=f&&t.hasPreciseFeatureCount&&s<t.numFeatures||!!m,a=a?a.concat(g):g,h=j(h,b),d=Q(d,F),t.setFeatures(a,u,h,d)}),i);case 11:if((0,v.k_)(i),y._invalidateCounts(),y._setDirty(),l=y._maximumFeaturesForTile(t)-o,f&&m&&!(l<=0)){e.next=17;break}return e.abrupt("return",{v:m?r.DONE:r.FULL});case 17:case"end":return e.stop()}}),e)}));case 4:return e.delegateYield(p(),"t0",5);case 5:if("object"!==typeof(f=e.t0)){e.next=8;break}return e.abrupt("return",f.v);case 8:e.next=4;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_createFeatureCountQuery",value:function(e){var t=this._createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t}},{key:"_createQuery",value:function(e){var t=this.context.createQuery(),i=e.descriptor.extent;if(i){var r=this.context.tilingScheme.spatialReference;t.geometry=(0,x.HH)(i,r)}return this._setResolutionParams(t,e),this._useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"_setPagingParameters",value:function(e,t,i,r){return!!this.context.capabilities.supportsPagination&&(e.start=t,i>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(i/r),e.num=Math.min(e.maxRecordCountFactor*r,i)):e.num=Math.min(r),!0)}},{key:"_getEffectiveTileResolution",value:function(e){if(null==e.descriptor.resolution)return null;var t=this.context.viewingMode===w.JY.Global?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor}},{key:"_supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"_setResolutionParams",value:function(e,t){if(this._supportsResolution){var i=this._getEffectiveTileResolution(t);null!=i&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new k.Z({mode:"view",originPosition:"upper-left",tolerance:i,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=i))}}},{key:"_removeEmptyFeatures",value:function(e){for(var t=e.length,i=0;i<e.length;){var r=e[i];(0,C.dF)(r.geometry)?++i:(e[i]=e[e.length-1],--e.length)}return t-e.length}},{key:"_needsNumFeatures",value:function(e){return this.useTileCount&&e.needsFeatureCount&&!H(e)}},{key:"_getMaxRecordCount",value:function(e){var t=this.context,i=t.tileMaxRecordCount,r=t.maxRecordCount;return this._useTileQuery(e)&&null!=i&&i>0&&this.context.capabilities.supportsResultType?i:null!=r&&r>0?r:B}},{key:"_useTileQuery",value:function(e){return(!H(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType}},{key:"_handleRequest",value:function(e,t,i,n){var a=this;e.fetchStatus=e.needsRefetching?r.REFETCHING:r.FETCHING,e.requestController=i;var s=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===i&&(e.requestController=null,e.fetchStatus=r.DONE),(0,v.D_)(t)?s=!0:n(t)})).then((function(){s||a._setDirty(),a._scheduleUpdated()}))}},{key:"_scheduleUpdated",value:function(){var e=this;this.hasHandles("scheduleUpdated")||this.addHandles((0,m.Os)((function(){e.removeHandles("scheduleUpdated"),e._updated()})),"scheduleUpdated")}},{key:"_showTile",value:function(e){if(null!=e.displayingFeatures&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var i=null!=e.displayingFeatures&&e.displayingFeatures.length>0;return this._hideTileFeatures(e),e.displayingFeatures=[],i}var r=e.descriptor.resolution,n=this._changes.updates,a=this._changes.adds,s=Math.min(e.featureLimit,t.length);e.featureLimit=s;for(var u=0;u<s;++u){var o=t[u],l=(0,C.MS)(o,this._objectIdField),c=this._displayingFeatureReferences.get(l);if(c){var d=c.ref(o,r);d.oldVersion!==d.newVersion&&(d.oldVersion&&n.removes.push(d.oldVersion),d.newVersion&&n.adds.push(d.newVersion))}else this._displayingFeatureReferences.set(l,new this.FeatureReferenceClass(o,r)),a.push(o);this._numDisplayingFeatureReferences++}return this._hideTileFeatures(e),this._applyChanges(),e.displayingFeatures=t.slice(0,s),!0}},{key:"_hideTile",value:function(e){this._cancelFetchTile(e),this._hideTileFeatures(e)}},{key:"_hideTileFeatures",value:function(e){if(null!=e.displayingFeatures){var t,i=this._changes.updates,r=this._changes.removes,n=(0,u.Z)(e.displayingFeatures);try{for(n.s();!(t=n.n()).done;){var a=t.value,s=(0,C.MS)(a,this._objectIdField),o=this._displayingFeatureReferences.get(s);if(o){var l=o.unref(e.descriptor.resolution);this._numDisplayingFeatureReferences--,l?l.oldVersion!==l.newVersion&&(null==l.newVersion?(this._displayingFeatureReferences.delete(s),l.oldVersion&&r.push(l.oldVersion)):(i.adds.push(l.newVersion),l.oldVersion&&i.removes.push(l.oldVersion))):console.error("Hiding unreferenced feature")}}}catch(c){n.e(c)}finally{n.f()}this._applyChanges(),e.displayingFeatures=null}}},{key:"_notifyDataUpdating",value:function(){this._get("dataUpdating")||this._set("dataUpdating",!0)}},{key:"_applyChanges",value:function(){var e=this._changes.updates;e.removes.length>0&&(this._notifyDataUpdating(),this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this._notifyDataUpdating(),this.features.addMany(e.adds),e.adds.length=0);for(var t=this._changes.adds,i=this._changes.removes,r=Math.min(t.length,i.length),n=0;n<r;){var a=Math.min(n+Y,r);this._notifyDataUpdating(),this.features.addMany(t.slice(n,a)),this.features.removeMany(i.slice(n,a)),n=a}t.length>r&&(this._notifyDataUpdating(),this.features.addMany(0===n?t:t.slice(n))),i.length>r&&(this._notifyDataUpdating(),this.features.removeMany(0===n?i:i.slice(n))),t.length=0,i.length=0}},{key:"_clearTile",value:function(e){if(this._hideTile(e),e.features&&null!=this.context.memoryCache){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null,void 0),this._invalidateCounts()}},{key:"_invalidateCounts",value:function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")}},{key:"_getListOfTiles",value:function(){return Array.from(this._featureTiles.values())}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)}},{key:"missingTiles",get:function(){return Array.from(this._featureTiles.values()).reduce((function(e,t){return e+(t.needsFetching||t.isFetching?1:0)}),0)}},{key:"_maximumFeaturesForTile",value:function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,i=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,r=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(i*r/(1-e.emptyFeatureRatio)),t)}},{key:"test",get:function(){}}]),i}(p.default);function H(e){return"dummy-tile-full-extent"===e.id}function G(e){var t=e.capabilities.query;return{supportsMultipleResolutions:U(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}}function U(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function q(e){return e.setFeatures([],0,null,void 0),e.featuresMissing=!1,r.DONE}function z(e){return null==e?new Set:new Set(e.map((function(e){return e.name})))}function j(e,t){if(null==e||null==t)return z(t);var i,r=new Set,n=(0,u.Z)(t);try{for(n.s();!(i=n.n()).done;){var a=i.value.name;e.has(a)&&r.add(a)}}catch(s){n.e(s)}finally{n.f()}return r}function Q(e,t){var i;if(null===t||void 0===t||!t.length)return e;null!==(i=e)&&void 0!==i||(e=new Map);var r,n=function(){return new Set},a=(0,u.Z)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value,o=s.objectId,l=s.attribute;(0,y.s1)(e,o,n).add(l)}}catch(c){a.e(c)}finally{a.f()}return e}(0,h._)([(0,b.Cb)({constructOnly:!0})],L.prototype,"features",void 0),(0,h._)([(0,b.Cb)()],L.prototype,"tileDescriptors",void 0),(0,h._)([(0,b.Cb)({value:1/0})],L.prototype,"maximumNumberOfFeatures",null),(0,h._)([(0,b.Cb)({value:1})],L.prototype,"memoryFactor",null),(0,h._)([(0,b.Cb)({value:1})],L.prototype,"lodFactor",null),(0,h._)([(0,b.Cb)()],L.prototype,"useTileCount",null),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"updating",null),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"dataUpdating",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"running",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"updatingTotal",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"updatingRemaining",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"expectedFeatureDiff",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"memoryForUnusedFeatures",null),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"maximumNumberOfFeaturesExceeded",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"totalVertices",null),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"totalFeatures",null),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"hasAllFeatures",null),(0,h._)([(0,b.Cb)({readOnly:!0})],L.prototype,"hasFullGeometries",null),(0,h._)([(0,b.Cb)()],L.prototype,"filterExtent",null),(0,h._)([(0,b.Cb)({constructOnly:!0})],L.prototype,"context",void 0),(0,h._)([(0,b.Cb)()],L.prototype,"_dirty",void 0),(0,h._)([(0,b.Cb)()],L.prototype,"_suspended",void 0),(0,h._)([(0,b.Cb)()],L.prototype,"_pendingEdits",void 0),(0,h._)([(0,b.Cb)()],L.prototype,"_applyEditsTilesUpdated",void 0),(0,h._)([(0,b.Cb)()],L.prototype,"_paused",null),(0,h._)([(0,b.Cb)()],L.prototype,"_isFetching",void 0),L=(0,h._)([(0,F.j)("esri.views.3d.layers.support.FeatureTileFetcher3D")],L);var B=2e3,J=(0,x.Ue)(),W=(0,x.Ue)(),X=6e5,Y=200},26511:function(e,t,i){i.d(t,{n:function(){return E}});var r=i(74165),n=i(15861),a=i(15671),s=i(43144),u=i(97326),o=i(60136),l=i(29388),c=i(27366),d=i(7138),h=i(14921),p=i(32718),f=i(92026),y=i(66978),v=i(94172),_=i(49861),g=(i(93169),i(84936),i(69912)),m=i(46634),b=i(18661),F=i(87072),x=i(82607),C=i(93463),k=i(73553),E=function(e){(0,o.Z)(i,e);var t=(0,l.Z)(i);function i(e){var s;return(0,a.Z)(this,i),(s=t.call(this,e))._updateTask=null,s._frameTask=null,s._queryEngine=null,s._updateRequested=!0,s._updatingHandles=new m.R,s._updateVisibility=function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null!=s._compositedFeatureFilter||null!=s._sceneFilter)&&0!==s.context.getFeatureCount()){e.next=4;break}return e.next=3,s._frameTask.schedule((function(){return s.clear()}),t);case 3:case 11:case 20:return e.abrupt("return",e.sent);case 4:return e.prev=4,e.next=7,s._queryEngine.executeQueryForIdSet(s._compositedFeatureFilter,s._sceneFilter,t);case 7:return i=e.sent,(0,y.k_)(t),e.next=11,s._frameTask.schedule((function(){s.context.updateFeatureVisibilities((function(e){return i.has(e)}))}),t);case 14:return e.prev=14,e.t0=e.catch(4),(0,y.r9)(e.t0),p.Z.getLogger((0,u.Z)(s)).warn("FeatureFilter query failed: ".concat(e.t0),{error:e.t0}),e.next=20,s._frameTask.schedule((function(){s.context.setAllFeaturesVisibility(!0)}),t);case 21:case"end":return e.stop()}}),e,null,[[4,14]])})));return function(t){return e.apply(this,arguments)}}(),s}return(0,s.Z)(i,[{key:"initialize",value:function(){var e,t,i=this,r=C.T8.FILTER_VISIBILITY,n=this._configuration,a=n.layer,s=n.view,u=this.context.featureStore,o=null!==(e=this._configuration.hasZ)&&void 0!==e&&e,l=null!==(t=this._configuration.hasM)&&void 0!==t&&t;this._queryEngine=new x.q({context:{spatialReference:s.spatialReference,layer:a,scheduler:s.resourceController.scheduler,featureStore:u,hasM:l,hasZ:o},priority:r}),this._frameTask=s.resourceController.scheduler.registerTask(r,this),this._updatingHandles.add((function(){return[i._compositedFeatureFilter,i._sceneFilter]}),(function(){return i.reapply()}),v.initial)}},{key:"destroy",value:function(){this._updateRequested=!1,this._updatingHandles.destroy(),this.clear(),this._updateTask=(0,f.IM)(this._updateTask),this._frameTask=(0,f.hw)(this._frameTask),this._queryEngine=(0,f.SC)(this._queryEngine),this._set("context",null)}},{key:"updating",get:function(){return this.running||this._updatingHandles.updating||null!=this._updateTask&&!this._updateTask.finished}},{key:"running",get:function(){return this._updateRequested||this._frameTask.updating}},{key:"defaultVisibility",get:function(){return null==this._compositedFeatureFilter&&null==this._sceneFilter}},{key:"_featureFilter",get:function(){return"filter"in this._configuration?this._configuration.filter:null}},{key:"_sceneFilter",get:function(){return"layerFilter"in this._configuration?this._configuration.layerFilter:null}},{key:"_floorFilter",get:function(){return(0,F.c)(this._configuration)}},{key:"_timeExtent",get:function(){return"timeExtent"in this._configuration?this._configuration.timeExtent:null}},{key:"_compositedFeatureFilter",get:function(){var e=this._featureFilter,t=this._timeExtent,i=this._floorFilter;if(null==t&&null==i)return e;var r=null!=e?e.clone():new b.Z;if(null!=t&&(r.timeExtent=null!=r.timeExtent?r.timeExtent.intersection(t):t),null!=i){var n=null==r.where||""===r.where;r.where=n?i:"(".concat(r.where,") AND (").concat(i,")")}return r}},{key:"_configuration",get:function(){return this.context.configuration}},{key:"reapply",value:function(){this._updateRequested=!0}},{key:"clear",value:function(){this._queryEngine.clear(),this.context.clearFeaturesVisibility()}},{key:"runTask",value:function(e){if(this._updateRequested&&(this._updateTask=(0,f.IM)(this._updateTask),this._updateTask=(0,h.vr)(this._updateVisibility),this._updateRequested=!1,e.madeProgress()),this._frameTask.processQueue(e),!e.hasProgressed)return k.J}}]),i}(d.default);(0,c._)([(0,_.Cb)({constructOnly:!0})],E.prototype,"context",void 0),(0,c._)([(0,_.Cb)()],E.prototype,"updating",null),(0,c._)([(0,_.Cb)()],E.prototype,"running",null),(0,c._)([(0,_.Cb)()],E.prototype,"defaultVisibility",null),(0,c._)([(0,_.Cb)()],E.prototype,"_featureFilter",null),(0,c._)([(0,_.Cb)()],E.prototype,"_sceneFilter",null),(0,c._)([(0,_.Cb)()],E.prototype,"_floorFilter",null),(0,c._)([(0,_.Cb)()],E.prototype,"_timeExtent",null),(0,c._)([(0,_.Cb)()],E.prototype,"_compositedFeatureFilter",null),(0,c._)([(0,_.Cb)()],E.prototype,"_configuration",null),(0,c._)([(0,_.Cb)()],E.prototype,"_updateTask",void 0),(0,c._)([(0,_.Cb)()],E.prototype,"_updateRequested",void 0),E=(0,c._)([(0,g.j)("esri.views.3d.layers.support.FeatureVisibilityFilter")],E)},99879:function(e,t,i){function r(e,t,i){if(!i||null==t)return null;if(!e)return function(e,t){var i=t.toLowerCase();for(var r in e)if(r.toLowerCase()===i)return e[r];return null}(t,i);var r=e.get(i);return r?t[r.name]:null}i.d(t,{g:function(){return r}})},5198:function(e,t,i){i.d(t,{g:function(){return p}});var r=i(93433),n=i(37762),a=i(15671),s=i(43144),u=i(60136),o=i(29388),l=i(91505),c=i(62314),d=i(92377),h=i(76432),p=function(e){(0,u.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments))._set=new Set,e._length=(0,h.t)(0),e}return(0,s.Z)(i,[{key:"clear",value:function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:c.y.REMOVE}),this.emit("change",{added:[],removed:e})}}},{key:"length",get:function(){return this._length.value}},{key:"addMany",value:function(e){if(0!==e.length){var t,i=(0,n.Z)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._set.add(r)}}catch(a){i.e(a)}finally{i.f()}this._length.value=this._set.size,this.emit("after-changes",{type:c.y.ADD}),this.emit("change",{added:e,removed:[]})}}},{key:"remove",value:function(e){this._set.delete(e)&&(this._length.value=this._set.size,this.emit("after-changes",{type:c.y.REMOVE}),this.emit("change",{added:[],removed:[e]}))}},{key:"removeMany",value:function(e){var t,i=[],r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;this._set.delete(a)&&i.push(a)}}catch(s){r.e(s)}finally{r.f()}i.length>0&&(this._length.value=this._set.size,this.emit("after-changes",{type:c.y.REMOVE}),this.emit("change",{added:[],removed:i}))}},{key:"toArray",value:function(){return(0,r.Z)(this._set)}},{key:"find",value:function(e){var t;return(0,d.fn)(this._set,(function(i){return!!e(i)&&(t=i,!0)})),t}},{key:"forEach",value:function(e){this._set.forEach((function(t){return e(t)}))}}]),i}(l.Z)},34552:function(e,t,i){i.d(t,{v:function(){return o}});var r=i(43144),n=i(15671),a=i(10064),s=i(8548),u=(0,r.Z)((function e(t,i,r,a){(0,n.Z)(this,e),this.dataType=t,this.samplingMode=i,this.pixelFormat=r,this.internalFormat=a}));function o(e,t){var i=e.capabilities,r=i.textureFloatLinear,n=i.colorBufferFloat,o=null===n||void 0===n?void 0:n.textureFloat,l=null===n||void 0===n?void 0:n.textureHalfFloat,c=null===n||void 0===n?void 0:n.floatBlend,d=e.driverTest.floatBufferBlend.result;if(!o&&!l)throw new a.Z("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(c&&d||l))throw new a.Z("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(d?"":" This device claims support for EXT_float_blend, but does not actually support it."));var h=o&&c&&d,p=l,f=r,y=!(null===n||void 0===n||!n.R32F),v=!(null===n||void 0===n||!n.R16F);if(h&&f)return f||t.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new u(s.Br.FLOAT,f?s.cw.LINEAR:s.cw.NEAREST,y?s.VI.RED:s.VI.RGBA,y?s.lP.R32F:s.VI.RGBA);if(p)return new u(s.Br.HALF_FLOAT,s.cw.LINEAR,v?s.VI.RED:s.VI.RGBA,v?s.lP.R16F:s.VI.RGBA);throw new a.Z("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}},38675:function(e,t,i){function r(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass}i.d(t,{s:function(){return r}})}}]);
//# sourceMappingURL=39199.d739f493.chunk.js.map