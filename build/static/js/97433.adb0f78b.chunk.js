"use strict";(self.webpackChunkreact_training=self.webpackChunkreact_training||[]).push([[97433,92463,2170],{92463:function(e,t,n){n.r(t),n.d(t,{hydratedAdapter:function(){return u}});var i=n(53866),r=n(77577),a=n(848),o=n(80885),l=n(29909),u={convertToGEGeometry:function(e,t){if(null==t)return null;var n="cache"in t?t.cache._geVersion:void 0;return null==n&&(n=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=n)),n},exportPoint:function(e,t,n){var i=e.hasZ(t),r=e.hasM(t),o=new a.Z({x:e.getPointX(t),y:e.getPointY(t),spatialReference:n});return i&&(o.z=e.getPointZ(t)),r&&(o.m=e.getPointM(t)),o.cache._geVersion=t,o},exportPolygon:function(e,t,n){var i=new o.Z({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i},exportPolyline:function(e,t,n){var i=new l.Z({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return i.cache._geVersion=t,i},exportMultipoint:function(e,t,n){var i=new r.Z({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:n});return i.cache._geVersion=t,i},exportExtent:function(e,t,n){var r=e.hasZ(t),a=e.hasM(t),o=new i.Z({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:n});if(r){var l=e.getZExtent(t);o.zmin=l.vmin,o.zmax=l.vmax}if(a){var u=e.getMExtent(t);o.mmin=u.vmin,o.mmax=u.vmax}return o.cache._geVersion=t,o}}},2170:function(e,t,n){n.r(t),n.d(t,{buffer:function(){return T},changeDefaultSpatialReferenceTolerance:function(){return Q},clearDefaultSpatialReferenceTolerance:function(){return J},clip:function(){return h},contains:function(){return p},convexHull:function(){return D},crosses:function(){return v},cut:function(){return f},densify:function(){return L},difference:function(){return S},disjoint:function(){return b},distance:function(){return y},equals:function(){return _},extendedSpatialReferenceInfo:function(){return d},flipHorizontal:function(){return F},flipVertical:function(){return G},generalize:function(){return I},geodesicArea:function(){return W},geodesicBuffer:function(){return U},geodesicDensify:function(){return j},geodesicLength:function(){return X},intersect:function(){return A},intersectLinesToPoints:function(){return q},intersects:function(){return m},isSimple:function(){return M},nearestCoordinate:function(){return R},nearestVertex:function(){return P},nearestVertices:function(){return H},offset:function(){return E},overlaps:function(){return V},planarArea:function(){return N},planarLength:function(){return B},relate:function(){return C},rotate:function(){return z},simplify:function(){return k},symmetricDifference:function(){return O},touches:function(){return w},union:function(){return Z},within:function(){return g}});var i=n(43144),r=n(15671),a=n(60136),o=n(29388),l=n(28664),u=n(99058),s=n(92463);function c(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function d(e){return u.G.extendedSpatialReferenceInfo(e)}function h(e,t){return u.G.clip(s.hydratedAdapter,c(e),e,t)}function f(e,t){return u.G.cut(s.hydratedAdapter,c(e),e,t)}function p(e,t){return u.G.contains(s.hydratedAdapter,c(e),e,t)}function v(e,t){return u.G.crosses(s.hydratedAdapter,c(e),e,t)}function y(e,t,n){return u.G.distance(s.hydratedAdapter,c(e),e,t,n)}function _(e,t){return u.G.equals(s.hydratedAdapter,c(e),e,t)}function m(e,t){return u.G.intersects(s.hydratedAdapter,c(e),e,t)}function w(e,t){return u.G.touches(s.hydratedAdapter,c(e),e,t)}function g(e,t){return u.G.within(s.hydratedAdapter,c(e),e,t)}function b(e,t){return u.G.disjoint(s.hydratedAdapter,c(e),e,t)}function V(e,t){return u.G.overlaps(s.hydratedAdapter,c(e),e,t)}function C(e,t,n){return u.G.relate(s.hydratedAdapter,c(e),e,t,n)}function M(e){return u.G.isSimple(s.hydratedAdapter,c(e),e)}function k(e){return u.G.simplify(s.hydratedAdapter,c(e),e)}function D(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.G.convexHull(s.hydratedAdapter,c(e),e,t)}function S(e,t){return u.G.difference(s.hydratedAdapter,c(e),e,t)}function O(e,t){return u.G.symmetricDifference(s.hydratedAdapter,c(e),e,t)}function A(e,t){return u.G.intersect(s.hydratedAdapter,c(e),e,t)}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return u.G.union(s.hydratedAdapter,c(e),e,t)}function E(e,t,n,i,r,a){return u.G.offset(s.hydratedAdapter,c(e),e,t,n,i,r,a)}function T(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return u.G.buffer(s.hydratedAdapter,c(e),e,t,n,i)}function U(e,t,n,i,r,a){return u.G.geodesicBuffer(s.hydratedAdapter,c(e),e,t,n,i,r,a)}function R(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return u.G.nearestCoordinate(s.hydratedAdapter,c(e),e,t,n)}function P(e,t){return u.G.nearestVertex(s.hydratedAdapter,c(e),e,t)}function H(e,t,n,i){return u.G.nearestVertices(s.hydratedAdapter,c(e),e,t,n,i)}function x(e){var t,n;return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e&&null!==(t=null===(n=e.extent)||void 0===n?void 0:n.center)&&void 0!==t?t:null}function z(e,t,n){var i;if(null==e)throw new Y;var r=e.spatialReference;if(null==(n=null!==(i=n)&&void 0!==i?i:x(e)))throw new Y;var a=e.constructor.fromJSON(u.G.rotate(e,t,n));return a.spatialReference=r,a}function F(e,t){var n;if(null==e)throw new Y;var i=e.spatialReference;if(null==(t=null!==(n=t)&&void 0!==n?n:x(e)))throw new Y;var r=e.constructor.fromJSON(u.G.flipHorizontal(e,t));return r.spatialReference=i,r}function G(e,t){var n;if(null==e)throw new Y;var i=e.spatialReference;if(null==(t=null!==(n=t)&&void 0!==n?n:x(e)))throw new Y;var r=e.constructor.fromJSON(u.G.flipVertical(e,t));return r.spatialReference=i,r}function I(e,t,n,i){return u.G.generalize(s.hydratedAdapter,c(e),e,t,n,i)}function L(e,t,n){return u.G.densify(s.hydratedAdapter,c(e),e,t,n)}function j(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return u.G.geodesicDensify(s.hydratedAdapter,c(e),e,t,n,i)}function N(e,t){return u.G.planarArea(s.hydratedAdapter,c(e),e,t)}function B(e,t){return u.G.planarLength(s.hydratedAdapter,c(e),e,t)}function W(e,t,n){return u.G.geodesicArea(s.hydratedAdapter,c(e),e,t,n)}function X(e,t,n){return u.G.geodesicLength(s.hydratedAdapter,c(e),e,t,n)}function q(e,t){return u.G.intersectLinesToPoints(s.hydratedAdapter,c(e),e,t)}function Q(e,t){u.G.changeDefaultSpatialReferenceTolerance(e,t)}function J(e){u.G.clearDefaultSpatialReferenceTolerance(e)}var Y=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.call(this,"Illegal Argument Exception")}return(0,i.Z)(n)}((0,l.Z)(Error))},98074:function(e,t,n){n.d(t,{p:function(){return h}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),l=n(27366),u=n(42537),s=n(67426),c=n(49861),d=(n(93169),n(32718),n(84936),n(69912)),h=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).parent=null,e._userInteractive=!1,e._interactiveViewModelCount=0,e}return(0,r.Z)(n,[{key:"interactive",get:function(){return this._interactiveViewModelCount>0||this._userInteractive},set:function(e){this._userInteractive=e}},{key:"updating",get:function(){return!1}},{key:"visible",get:function(){return null==this.parent||this.parent.visible&&!this.parent.suspended},set:function(e){this._overrideIfSome("visible",e)}},{key:"forceInteractiveForViewModel",value:function(){var e=this;return this._interactiveViewModelCount++,(0,u.kB)((function(){return e._interactiveViewModelCount--}))}}]),n}((0,s.v)(e));return(0,l._)([(0,c.Cb)({constructOnly:!0})],t.prototype,"parent",void 0),(0,l._)([(0,c.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,l._)([(0,c.Cb)({type:Boolean})],t.prototype,"interactive",null),(0,l._)([(0,c.Cb)()],t.prototype,"_userInteractive",void 0),(0,l._)([(0,c.Cb)({readOnly:!0})],t.prototype,"updating",null),(0,l._)([(0,c.Cb)()],t.prototype,"visible",null),(0,l._)([(0,c.Cb)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,l._)([(0,d.j)("esri.views.3d.analysis.AnalysisView3D")],t)}},3319:function(e,t,n){n.d(t,{AN:function(){return c},C7:function(){return V},Ci:function(){return A},Eu:function(){return b},G0:function(){return f},GI:function(){return o},GW:function(){return g},K_:function(){return C},L0:function(){return u},Lf:function(){return y},Mr:function(){return l},P3:function(){return d},QG:function(){return M},Qf:function(){return S},Wp:function(){return h},XC:function(){return s},Yn:function(){return D},ZE:function(){return p},ae:function(){return Z},cf:function(){return k},fg:function(){return _},sz:function(){return m},tW:function(){return a},tv:function(){return w},v9:function(){return v},yy:function(){return O}});var i=n(93169),r=n(16889),a=(0,i.Z)("mac")?"Meta":"Control",o="Shift",l=2,u=1.15,s=1.15,c=2500,d=.02,h=Math.cos((0,r.Vl)(45)),f=Math.cos((0,r.Vl)(5)),p=.95,v=.3,y=2,_=1,m=3,w=11,g=22.5,b=40,V=48,C=2.25,M=4,k=1,D=.3,S=6,O=4,A=1600,Z=.4},44549:function(e,t,n){n.r(t),n.d(t,{default:function(){return Rt}});var i=n(74165),r=n(15861),a=n(15671),o=n(43144),l=n(60136),u=n(29388),s=n(27366),c=n(7138),d=n(92026),h=n(94172),f=n(49861),p=(n(93169),n(32718),n(84936),n(69912)),v=n(98074),y=n(42537),_=n(1413),m=n(51995),w=n(84652),g=n(16889),b=n(29134),V=n(7025),C=n(32035),M=n(12400),k=(n(13611),n(6644)),D=n(2170),S=(n(51378),n(83639)),O=n(51328);function A(e,t){var n=e.tiltedUpVector,i=e.rightVector,r=e.observerRenderSpace,a=(0,S.Aq)(n,i,r,t);return a[12]=0,a[13]=0,a[14]=0,a}function Z(e,t,n){var i=(0,M.Ue)(),r=(0,C.b)((0,M.Ue)(),n.basis1,n.basis2);return e.next((0,O._N)(t,n.plane)).next((function(e){"start"===e.action&&(0,C.c)(i,e.renderStart);var t=(0,g.BV)((0,S.Gd)(i,e.renderEnd,n.origin,r));return(0,_.Z)((0,_.Z)({},e),{},{deltaAngle:t})}))}function E(e,t){if(null==e)return 0;var n=e.observer,i=e.target,r=t.camera.position,a=(0,D.distance)(r,n)>(0,D.distance)(r,i)?n:i;return t.pixelSizeAt(a)}(0,k.Ue)();var T=n(33837),U=n(56529),R=n(86700),P=new m.Z([85,85,85,.5]),H=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).visible=!0,i._viewshedCorners={topLeft:(0,M.Ue)(),topRight:(0,M.Ue)(),bottomLeft:(0,M.Ue)(),bottomRight:(0,M.Ue)(),center:(0,M.Ue)()},i._arcCenterPoints={top:(0,M.Ue)(),bottom:(0,M.Ue)(),left:(0,M.Ue)(),right:(0,M.Ue)()},i._parallelCenters={top:(0,M.Ue)(),bottom:(0,M.Ue)()},i}return(0,o.Z)(n,[{key:"initialize",value:function(){var e=this,t=(0,_.Z)((0,_.Z)({},{view:this.view,isDecoration:!0,color:this._color}),{},{renderOccluded:U.yD.OccludeAndTransparent}),n=(0,_.Z)((0,_.Z)({},t),{},{width:2,stipplePattern:(0,R.z5)(2)});this._boundaryLinesVisualElement=new T.r(t),this._leftArcVisualElement=new T.r(t),this._rightArcVisualElement=new T.r(t),this._topArcVisualElement=new T.r(t),this._bottomArcVisualElement=new T.r(t),this._centralLongitude=new T.r(n),this._centralLatitude=new T.r(n),this.addHandles([(0,h.watch)((function(){var t=e.viewshedComputedData;if(null===t||void 0===t||!t.isValid())return null;var n=e._offsetScale,i=e._viewshedCorners,r=e._arcCenterPoints,a=e._parallelCenters;return t.cornerPoints(n,i),t.arcCentersPoints(n,r),t.parallelCenterPoints(a),{viewshedComputedData:t,corners:i,arcCenters:r,parallelCenters:a}}),(function(t){null!=t?(e._forEachVisualElement((function(e){return e.attached=!0})),e._updateVisualElements(t)):e._forEachVisualElement((function(e){return e.attached=!1}))}),{initial:!0,equals:w.fS}),(0,h.watch)((function(){var t;return{visible:e.visible,horFOV:null===(t=e.viewshedComputedData)||void 0===t?void 0:t.horizontalFieldOfView}}),(function(t,n){var i=t.visible,r=t.horFOV;i!==(null===n||void 0===n?void 0:n.visible)&&e._forEachVisualElement((function(e){return e.visible=i})),i&&r!==(null===n||void 0===n?void 0:n.horFOV)&&(e._boundaryLinesVisualElement.visible=360!==r)}),h.initial),(0,h.watch)((function(){return e._color}),(function(t){return e._forEachVisualElement((function(e){return e.color=t}))}),h.initial)])}},{key:"_color",get:function(){var e,t,n=this.viewshedComputedData;if(null==n)return m.Z.toUnitRGBA(P);var i=this.analysisViewData,r=(null===(e=i.tool)||void 0===e?void 0:e.active)||i.interactive,a=n===i.selectedViewshedComputedData,o=n.viewshed===(null===(t=i.tool)||void 0===t?void 0:t.stagedViewshed),l=r&&(a||o)?this.view.effectiveTheme.accentColor:P;return m.Z.toUnitRGBA(l)}},{key:"_offsetScale",get:function(){return E(this.viewshedComputedData,this.view)}},{key:"destroy",value:function(){this._boundaryLinesVisualElement=(0,d.SC)(this._boundaryLinesVisualElement),this._leftArcVisualElement=(0,d.SC)(this._leftArcVisualElement),this._rightArcVisualElement=(0,d.SC)(this._rightArcVisualElement),this._topArcVisualElement=(0,d.SC)(this._topArcVisualElement),this._bottomArcVisualElement=(0,d.SC)(this._bottomArcVisualElement),this._centralLongitude=(0,d.SC)(this._centralLongitude),this._centralLatitude=(0,d.SC)(this._centralLatitude)}},{key:"_forEachVisualElement",value:function(e){[this._boundaryLinesVisualElement,this._leftArcVisualElement,this._rightArcVisualElement,this._topArcVisualElement,this._bottomArcVisualElement,this._centralLatitude,this._centralLongitude].forEach(e)}},{key:"_updateVisualElements",value:function(e){var t=e.viewshedComputedData,n=e.corners,i=e.arcCenters,r=e.parallelCenters;this._updateBoundaryLines(n),this._updateBoundaryArcs(t,n,r),this._updateCentralHelperArcs(t,i)}},{key:"_updateBoundaryLines",value:function(e){this._boundaryLinesVisualElement.geometry=[[e.center,e.topLeft],[e.center,e.topRight],[e.center,e.bottomLeft],[e.center,e.bottomRight]]}},{key:"_updateBoundaryArcs",value:function(e,t,n){var i=e.observerRenderSpace,r=e.rightVector,a=e.horizontalFieldOfView,o=e.tiltedUpVector,l=(0,g.Vl)(a),u=(0,M.Ue)(),s=(0,V.Ue)();(0,b.Us)(s,l/2,o),(0,C.h)(u,r,s),x(this._leftArcVisualElement,i,t.bottomLeft,t.topLeft,"forward",u),(0,b.Us)(s,-l/2,o),(0,C.s)(u,0,0,0),(0,C.h)(u,r,s),x(this._rightArcVisualElement,i,t.bottomRight,t.topRight,"forward",u);var c=a>180?"backward":"forward";x(this._topArcVisualElement,n.top,t.topRight,t.topLeft,c,o),x(this._bottomArcVisualElement,n.bottom,t.bottomRight,t.bottomLeft,c,o)}},{key:"_updateCentralHelperArcs",value:function(e,t){var n=e.observerRenderSpace,i=e.horizontalFieldOfView>=180?"backward":"forward";x(this._centralLatitude,n,t.right,t.left,i,e.tiltedUpVector),x(this._centralLongitude,n,t.top,t.bottom,"forward",e.leftVector)}}]),n}(c.default);function x(e,t,n,i,r,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5,l=(0,M.Ue)();(0,C.z)(l,n,t);var u=(0,C.H)(l),s=(0,M.Ue)();(0,C.z)(s,i,t),(0,C.n)(s,s),(0,C.j)(s,s,u);var c=(0,C.d)(l,s),d=(0,M.d9)(a);"backward"===r&&((0,C.k)(d,d),c=-(2*Math.PI-c));var h=[],f=Math.ceil(Math.abs(c)/(0,g.Vl)(o)),p=(0,V.Ue)();(0,b.Us)(p,c/f,d);var v=(0,M.Ue)();(0,C.c)(v,l);var y=(0,M.Ue)();(0,C.c)(y,n);for(var _=0;_<f;_++){var m=(0,M.Ue)();(0,C.c)(m,y),(0,C.h)(v,v,p),(0,C.g)(y,t,v);var w=(0,M.Ue)();(0,C.c)(w,y),h.push([m,w])}e.geometry=h}(0,s._)([(0,f.Cb)()],H.prototype,"view",void 0),(0,s._)([(0,f.Cb)()],H.prototype,"analysisViewData",void 0),(0,s._)([(0,f.Cb)()],H.prototype,"viewshedComputedData",void 0),(0,s._)([(0,f.Cb)()],H.prototype,"visible",void 0),(0,s._)([(0,f.Cb)()],H.prototype,"_color",null),(0,s._)([(0,f.Cb)()],H.prototype,"_offsetScale",null);var z=H=(0,s._)([(0,p.j)("esri.views.3d.analysis.Viewshed.ViewshedVisualization")],H),F=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){return(0,a.Z)(this,n),t.call(this,e)}return(0,o.Z)(n,[{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"initialize",value:function(){var e=this,t=this.analysisViewData,n=(0,h.mapCollection)((function(){return e.analysisViewData.viewshedComputedDataHandles}),(function(n){var i=n.viewshedComputedData,r=new z({view:e.view,viewshedComputedData:i,analysisViewData:t});return{visualization:r,remove:function(){return r.destroy()}}}));this._viewshedVisualizations=n,this.addHandles([(0,y.ed)(n),(0,h.watch)((function(){return e.visible}),(function(t){return e._viewshedVisualizations.forEach((function(e){return e.visualization.visible=t}))}))])}}]),n}(c.default);(0,s._)([(0,f.Cb)({constructOnly:!0})],F.prototype,"analysisViewData",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],F.prototype,"view",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],F.prototype,"isDecoration",void 0),(0,s._)([(0,f.Cb)()],F.prototype,"visible",null),F=(0,s._)([(0,p.j)("esri.views.3d.analysis.Viewshed.ViewshedAnalysisVisualization")],F);n(59486);var G,I=n(848),L=G=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){return(0,a.Z)(this,n),t.call(this,e)}return(0,o.Z)(n,[{key:"observer",get:function(){var e;return null!==(e=this.viewshed.observer)&&void 0!==e?e:new I.Z}},{key:"farDistance",get:function(){return this.viewshed.farDistance}},{key:"farDistanceRenderSpace",get:function(){return this.farDistance/this.metersPerUnit}},{key:"heading",get:function(){return this.viewshed.heading}},{key:"tilt",get:function(){return this.viewshed.tilt}},{key:"tiltParallelToSurface",get:function(){return this.tilt-90}},{key:"horizontalFieldOfView",get:function(){return this.viewshed.horizontalFieldOfView}},{key:"verticalFieldOfView",get:function(){return this.viewshed.verticalFieldOfView}},{key:"observerRenderSpace",get:function(){return this._pointToRenderSpace(this.observer,(0,M.Ue)())}},{key:"target",get:function(){var e=this.targetRenderSpace;return this.renderSpaceToPoint(e,this.observer.spatialReference)}},{key:"targetRenderSpace",get:function(){var e=this.leftVector,t=this.northVector,n=this.upVector,i=this.observerRenderSpace,r=this.farDistanceRenderSpace,a=(0,M.Ue)();return(0,C.j)(a,t,r),N(a,-(0,g.Vl)(this.heading),n,a),N(a,-(0,g.Vl)(this.tiltParallelToSurface),e,a),(0,C.g)(a,i,a),a}},{key:"targetDirection",get:function(){var e=(0,C.z)((0,M.Ue)(),this.targetRenderSpace,this.observerRenderSpace);return(0,C.n)(e,e)}},{key:"tiltedUpVector",get:function(){var e=N(this.upVector,-(0,g.Vl)(this.tiltParallelToSurface),this.leftVector,(0,M.Ue)());return(0,C.n)(e,e)}},{key:"_basis",get:function(){return this.renderCoordsHelper.basisMatrixAtPosition(this.observerRenderSpace,(0,V.Ue)())}},{key:"upVector",get:function(){var e=this._basis;return(0,M.al)(e[8],e[9],e[10])}},{key:"northVector",get:function(){var e=this._basis;return(0,M.al)(e[4],e[5],e[6])}},{key:"leftVector",get:function(){var e=this.upVector,t=N(this.northVector,-(0,g.Vl)(this.heading),e,(0,M.Ue)());return(0,C.b)(t,e,t)}},{key:"rightVector",get:function(){return(0,C.k)((0,M.Ue)(),this.leftVector)}},{key:"clone",value:function(){return new G({renderCoordsHelper:this.renderCoordsHelper,viewshed:this.viewshed.clone()})}},{key:"isValid",value:function(){return this.viewshed.isValid()}},{key:"metersPerUnit",get:function(){return this.renderCoordsHelper.spatialReference.metersPerUnit}},{key:"pointOnSphere",value:function(e,t,n){var i=this.observerRenderSpace,r=this.targetRenderSpace,a=(0,C.z)(X,r,i);return N(a,-(0,g.Vl)(t),this.leftVector,a),N(a,-(0,g.Vl)(e),this.tiltedUpVector,a),(0,C.g)(n,a,i)}},{key:"cornerPoints",value:function(e,t){var n=this.observerRenderSpace,i=this.horizontalFieldOfView/2,r=this.verticalFieldOfView/2,a=this.pointOnSphere(-i,r,te),o=this.pointOnSphere(i,r,ne),l=this.pointOnSphere(-i,-r,ie),u=this.pointOnSphere(i,-r,re),s=(0,C.z)(Y,a,n),c=(0,C.z)($,o,n),d=(0,C.z)(K,l,n),h=(0,C.z)(ee,u,n),f=this.horizontalFieldOfView,p=Q;j(s,c,a,l,n,e,f,t.topLeft,t.bottomLeft,p);var v=J;j(h,d,o,u,n,e,f,t.topRight,t.bottomRight,v),(0,C.j)(t.center,(0,C.g)(t.center,v,p),.5)}},{key:"arcCentersPoints",value:function(e,t){var n=this.horizontalFieldOfView/2,i=this.verticalFieldOfView/2,r=this.pointOnSphere(0,i,t.top),a=this.pointOnSphere(0,-i,t.bottom),o=this.pointOnSphere(-n,0,t.left),l=this.pointOnSphere(n,0,t.right),u=this.observerRenderSpace;W(r,u,e),W(a,u,e),W(o,u,e),W(l,u,e)}},{key:"parallelCenterPoints",value:function(e){var t=this.observerRenderSpace,n=this.farDistanceRenderSpace*Math.sin((0,g.Vl)(this.verticalFieldOfView/2)),i=(0,C.j)(X,this.tiltedUpVector,n);(0,C.g)(e.top,t,i),(0,C.z)(e.bottom,t,i)}},{key:"renderSpaceToPoint",value:function(e,t){var n=X;return this.renderCoordsHelper.fromRenderCoords(e,n,t),new I.Z(n[0],n[1],n[2],t)}},{key:"_pointToRenderSpace",value:function(e,t){var n=(0,M.nI)(e.toArray());return this.renderCoordsHelper.toRenderCoords(n,e.spatialReference,t),t}}]),n}(c.default);function j(e,t,n,i,r,a,o,l,u,s){var c=function(e,t,n,i){var r=(0,C.b)(i,e,t);return(0,C.n)(r,r),(0,C.j)(r,r,n),r}(e,t,a,q);(0,C.g)(s,r,c),B(n,e,c,a,o,l),B(i,e,c,a,o,u)}function N(e,t,n,i){return(0,b.Us)(ae,t,n),(0,C.h)(i,e,ae)}function B(e,t,n,i,r,a){var o=(0,C.n)(X,t);return(0,C.j)(o,o,i),(0,C.g)(a,e,o),0!==r&&360!==r&&(0,C.g)(a,a,n),a}function W(e,t,n){var i=(0,C.z)(X,e,t);(0,C.n)(i,i),(0,C.j)(i,i,n),(0,C.g)(e,e,i)}(0,s._)([(0,f.Cb)()],L.prototype,"renderCoordsHelper",void 0),(0,s._)([(0,f.Cb)()],L.prototype,"viewshed",void 0),(0,s._)([(0,f.Cb)()],L.prototype,"observer",null),(0,s._)([(0,f.Cb)()],L.prototype,"farDistance",null),(0,s._)([(0,f.Cb)()],L.prototype,"farDistanceRenderSpace",null),(0,s._)([(0,f.Cb)()],L.prototype,"heading",null),(0,s._)([(0,f.Cb)()],L.prototype,"tilt",null),(0,s._)([(0,f.Cb)()],L.prototype,"tiltParallelToSurface",null),(0,s._)([(0,f.Cb)()],L.prototype,"horizontalFieldOfView",null),(0,s._)([(0,f.Cb)()],L.prototype,"verticalFieldOfView",null),(0,s._)([(0,f.Cb)()],L.prototype,"observerRenderSpace",null),(0,s._)([(0,f.Cb)()],L.prototype,"target",null),(0,s._)([(0,f.Cb)()],L.prototype,"targetRenderSpace",null),(0,s._)([(0,f.Cb)()],L.prototype,"targetDirection",null),(0,s._)([(0,f.Cb)()],L.prototype,"tiltedUpVector",null),(0,s._)([(0,f.Cb)()],L.prototype,"_basis",null),(0,s._)([(0,f.Cb)()],L.prototype,"upVector",null),(0,s._)([(0,f.Cb)()],L.prototype,"northVector",null),(0,s._)([(0,f.Cb)()],L.prototype,"leftVector",null),(0,s._)([(0,f.Cb)()],L.prototype,"rightVector",null),(0,s._)([(0,f.Cb)()],L.prototype,"isValid",null),(0,s._)([(0,f.Cb)()],L.prototype,"metersPerUnit",null),L=G=(0,s._)([(0,p.j)("esri.views.3d.analysis.Viewshed.ViewshedComputedData")],L);var X=(0,M.Ue)(),q=(0,M.Ue)(),Q=(0,M.Ue)(),J=(0,M.Ue)(),Y=(0,M.Ue)(),$=(0,M.Ue)(),K=(0,M.Ue)(),ee=(0,M.Ue)(),te=(0,M.Ue)(),ne=(0,M.Ue)(),ie=(0,M.Ue)(),re=(0,M.Ue)(),ae=(0,V.Ue)(),oe=n(37762),le=n(11582),ue=n(17768),se=n(89125),ce=n(25243),de=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).observer=null,i.farDistance=1e3,i.heading=0,i.tilt=90,i.horizontalFieldOfView=45,i.verticalFieldOfView=45,i}return(0,o.Z)(n,[{key:"isValid",value:function(){return null!=this.observer&&this.farDistance>0}},{key:"equals",value:function(e){return(0,d._W)(this.observer,e.observer)&&this.farDistance===e.farDistance&&this.heading===e.heading&&this.tilt===e.tilt&&this.horizontalFieldOfView===e.horizontalFieldOfView&&this.verticalFieldOfView===e.verticalFieldOfView}}]),n}((0,le.J)(c.default));(0,s._)([(0,f.Cb)({type:I.Z})],de.prototype,"observer",void 0),(0,s._)([(0,f.Cb)({type:Number,nonNullable:!0,range:{min:0}})],de.prototype,"farDistance",void 0),(0,s._)([(0,f.Cb)({type:Number,nonNullable:!0}),(0,se.p)((function(e){return ue.BV.normalize((0,ce.q9)(e))}))],de.prototype,"heading",void 0),(0,s._)([(0,f.Cb)({type:Number,nonNullable:!0,range:{min:0,max:180}})],de.prototype,"tilt",void 0),(0,s._)([(0,f.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}})],de.prototype,"horizontalFieldOfView",void 0),(0,s._)([(0,f.Cb)({type:Number,nonNullable:!0,range:{min:0,max:180}})],de.prototype,"verticalFieldOfView",void 0),(0,s._)([(0,f.Cb)()],de.prototype,"isValid",null);var he=de=(0,s._)([(0,p.j)("esri.analysis.Viewshed")],de),fe=n(55652),pe=n(63780),ve=n(79803),ye=n(50951),_e=n(93433),me=n(29439),we=n(100),ge=n(82218),be=n(3319),Ve=be.QG,Ce=be.Mr*Ve,Me=.0025,ke=Math.sin((0,g.Vl)(2)),De=be.Mr/1.5,Se=n(35284),Oe=n(40508),Ae=n(41029),Ze=n(70818),Ee=n(70619),Te=n(97731),Ue=n(58901),Re=n(74229),Pe=n(99034),He=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this))._handles=new we.Z,i._interactive=!0,i._tool=e.tool,i._view=e.view,i._focusedArcMaterial=i._createArcMaterial(!0),i._unfocusedArcMaterial=i._createArcMaterial(!1),i._createManipulators(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return(0,o.Z)(n,[{key:"destroy",value:function(){var e=this;this._handles=(0,d.SC)(this._handles),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulators=null}},{key:"interactive",get:function(){return this._interactive},set:function(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}},{key:"createDragPipeline",value:function(e,t){var n=this,i=Object.values(this._manipulators);return(0,y.AL)(i.map((function(i){var r=i.manipulator,a=i.side;return(0,Re.Xd)(r,(function(i,r,o,l,u){var s=function(e,t){var n=t.observerRenderSpace,i=t.targetDirection,r=t.tiltedUpVector,a=t.rightVector,o=ze(e)?a:r;return(0,ge.f)(n,i,o)}(a,t);ze(a)?t.horizontalFieldOfView:t.verticalFieldOfView;var c=r.next((function(e){return(0,_.Z)((0,_.Z)({},e),{},{manipulatorType:Ae.d.SCALE,side:a})})),d=Z(c,n._view,s);e(i,d,o)}))})))}},{key:"updateManipulatorsTransform",value:function(e){var t=this;this._forEachManipulatorInfo((function(n){return t._updateArcManipulatorTransform(n,e)}))}},{key:"updateManipulatorVisuals",value:function(e){var t=this;this._forEachManipulatorInfo((function(n){return t._updateArcManipulatorVisuals(n,e)}))}},{key:"_updateArcManipulatorVisuals",value:function(e,t){var n=e.manipulator,i=e.side,r=[];if(null!=t){if("left"===i&&(t.horizontalFieldOfView<1||t.horizontalFieldOfView>359)||"bottom"===i&&t.verticalFieldOfView<1)return n.renderObjects=[],void(n.collisionType={type:"line",paths:[]});var a=function(e,t,n){var i=t.horizontalFieldOfView,r=t.verticalFieldOfView,a=ze(e),o=(0,g.Vl)((0,g.uZ)((a?r:i)/2,0,15)),l=a?1:Math.max(Math.sin((0,g.Vl)(90-r/2)),.1),u=xe(-o/2,o/2,l,[-l,0,0]);return[(0,Ee.rh)(n,u),u]}(i,t,this._unfocusedArcMaterial),o=(0,me.Z)(a,2),l=o[0],u=o[1];r.push(new Oe.r(l,Pe.Q9.Unfocused),new Oe.r(l.instantiate({material:this._focusedArcMaterial}),Pe.Q9.Focused)),n.collisionType={type:"line",paths:[u]}}n.renderObjects=r,n.radius=10}},{key:"_updateArcManipulatorTransform",value:function(e,t){var n=e.manipulator,i=e.side,r=t.horizontalFieldOfView,a=(0,g.Vl)(t.verticalFieldOfView/2),o=(0,g.Vl)(r/2),l=ze(i);n.location=t.observer;var u=(0,V.Ue)(),s=function(e){(0,b.Jp)(u,e,u)};s((0,b.gT)(Ge,(0,g.Vl)(-90))),l||s((0,b.aC)(Ge,a));var c=t.farDistanceRenderSpace;s((0,b.xJ)(Ge,(0,C.s)(Ie,c,c,c))),s((0,b.QO)(Ge,function(e){return function(e){switch(e){case"left":return 0;case"bottom":return 1;case"right":return 2;case"top":return 3}}(e)*Fe}(i))),s(A(t,Ge));var d,h,f=(0,C.z)(Ie,t.targetRenderSpace,t.observerRenderSpace);if(s((0,b.vc)(Ge,f)),l){if(d=o,h=t.tiltedUpVector,0!==r&&360!==r){var p=E(t,this._view);d+=2*Math.tan(p/(2*t.farDistance))}}else h=t.rightVector,d=a;d*="right"===i||"bottom"===i?-1:1;var v=(0,b.Us)(Ge,d,h);null!=v&&s(v),n.modelTransform=u}},{key:"_updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(n){n.interactive=!t&&e.interactive||n.grabbing}))}},{key:"_createManipulators",value:function(){var e=this._createArcManipulator("left"),t=this._createArcManipulator("right"),n=this._createArcManipulator("top"),i=this._createArcManipulator("bottom");this._manipulators={left:e,right:t,top:n,bottom:i};var r=[[i.manipulator,n.manipulator],[e.manipulator,t.manipulator]];r.push.apply(r,(0,_e.Z)(r.map((function(e){var t=(0,me.Z)(e,2),n=t[0];return[t[1],n]})))),this._handles.add(r.map((function(e){var t=(0,me.Z)(e,2),n=t[0],i=t[1];return n.events.on("focus-changed",(function(e){var t="focus"===e.action;i.hovering=t}))})))}},{key:"_createArcManipulator",value:function(e){var t={manipulator:new Se.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!0}),side:e};return this._updateArcManipulatorVisuals(t),t}},{key:"_createArcMaterial",value:function(e){var t=this,n=e?Ce:Ve,i=new Ue.U({renderOccluded:U.yD.OccludeAndTransparent,isDecoration:!0,width:n});return this._handles.add((0,h.watch)((function(){return m.Z.toUnitRGBA(t._view.effectiveTheme.accentColor)}),(function(e){return i.setParameters({color:e})}),h.initial)),i}},{key:"forEachManipulator",value:function(e){Object.values(this._manipulators).forEach((function(t){var n=t.manipulator;return e(n,Ae.d.SCALE)}))}},{key:"_forEachManipulatorInfo",value:function(e){Object.values(this._manipulators).forEach((function(t){return e(t)}))}}]),n}(Ze.b);function xe(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;(0,Te.hu)(r>1,"createArcPolylineGeometry() needs at least 2 for numVertices");var a=t-e,o=(0,me.Z)(i,3),l=o[0],u=o[1],s=o[2];if(a<=0||n<=0){var c=.001;return[(0,M.al)(l,u,s+c),(0,M.al)(l,u,u+-c)]}for(var d=[],h=a/r,f=0;f<r;f++){var p=e+f*h;f===r-1&&(p=t);var v=Math.cos(p)*n,y=Math.sin(p)*n,_=(0,M.al)(v+l,u,y+s);d.push(_)}return d}function ze(e){return"left"===e||"right"===e}var Fe=Math.PI/2,Ge=(0,V.Ue)(),Ie=(0,M.Ue)(),Le=n(40885),je=n(88301),Ne=n(61120),Be=n(68401),We=n(66832),Xe=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e,i,r,o){var l;return(0,a.Z)(this,n),(l=t.call(this,{view:e,autoScaleRenderObjects:!1,worldSized:!0,radius:5}))._handles=new we.Z,l._setupManipulatorVisual(i,r,o),l}return(0,o.Z)(n,[{key:"destroy",value:function(){this._handles.remove(),(0,je.Z)((0,Ne.Z)(n.prototype),"destroy",this).call(this)}},{key:"_setupManipulatorVisual",value:function(e,t,n){var i=this._createMaterial(),r=(0,g.Vl)(t),a=e?1:Math.sin(r),o=e?xe(0,r,a,[-a,0,0]):[(0,M.al)(0,0,0),(0,M.al)(0,0,a)],l=(0,Ee.PD)(i,o,n,16,!1),u=(0,Ee.PD)(i,o,n*be.Mr,16,!1),s=qe(!1,i,n),c=qe(!0,i,n),d=(0,V.Ue)();(0,b.vc)(d,o[o.length-1]),(0,b.dC)(d,d,(0,b.aC)(Je,Math.PI/2)),(0,b.dC)(d,d,(0,b.gT)(Je,Math.PI/2)),e&&(0,b.dC)(d,d,(0,b.aC)(Je,-r)),s.transformation=d,c.transformation=d,this.renderObjects=[new Oe.r(l,Pe.Q9.Unfocused),new Oe.r(u,Pe.Q9.Focused),new Oe.r(s,Pe.Q9.Unfocused),new Oe.r(c,Pe.Q9.Focused)];var h=(0,M.al)(0,Qe(!0),0),f=(0,C.h)(h,h,d),p=[].concat((0,_e.Z)(o),[f]);this.collisionType={type:"line",paths:[p]}}},{key:"_createMaterial",value:function(){var e=this,t=new We.E({cullFace:Be.Vr.Back,renderOccluded:U.yD.OccludeAndTransparent,isDecoration:!0,writeLinearDepth:!0});return this._handles.add((0,h.watch)((function(){return m.Z.toUnitRGBA(e.view.effectiveTheme.accentColor)}),(function(e){return t.setParameters({color:e})}),h.initial)),t}}]),n}(Se.Z);function qe(e,t,n){var i=Qe(e),r=2*n;e&&(r*=be.Mr);var a=i/2;return(0,Ee.DA)(t,i,a,a,r,0)}function Qe(e){var t=ke;return e&&(t*=De),t}var Je=(0,V.Ue)(),Ye=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this))._handles=new we.Z,i._interactive=!0,i._tool=e.tool,i._view=e.view,i._manipulatorHeading=new Xe(i._view,!0,5,Me),i._manipulatorTilt=new Xe(i._view,!0,5,Me),i._manipulatorDistance=new Xe(i._view,!1,5,Me),i.forEachManipulator((function(e){i._tool.manipulators.add(e),i._handles.add(e.events.on("grab-changed",(function(){return i._updateManipulatorInteractivity()})))})),i}return(0,o.Z)(n,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._manipulatorHeading=null,this._manipulatorTilt=null,this._manipulatorDistance=null,this._tool=null,this._view=null}},{key:"interactive",get:function(){return this._interactive},set:function(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}},{key:"createHeadingDragPipeline",value:function(e,t){var n=this;return(0,Re.Xd)(this._manipulatorHeading,(function(i,r,a,o,l){var u=n._view,s=Math.sin((0,g.Vl)(t.tiltParallelToSurface))*t.farDistanceRenderSpace,c=(0,C.g)(tt,t.observerRenderSpace,(0,C.j)(nt,t.upVector,s)),d=(0,C.b)(nt,t.northVector,t.upVector),h=Z(r,u,(0,ge.f)(c,t.northVector,d)).next((function(e){return(0,_.Z)((0,_.Z)({},e),{},{manipulatorType:Ae.d.ROTATE})}));e(i,h,a)}))}},{key:"createTiltDragPipeline",value:function(e,t){var n=this;return(0,Re.Xd)(this._manipulatorTilt,(function(i,r,a,o,l){var u=(0,ge.f)(t.observerRenderSpace,t.targetDirection,t.tiltedUpVector),s=Z(r,n._view,u).next((function(e){return(0,_.Z)((0,_.Z)({},e),{},{manipulatorType:Ae.d.ROTATE})}));e(i,s,a)}))}},{key:"createDistanceDragPipeline",value:function(e,t){var n=this;return(0,Re.Xd)(this._manipulatorDistance,(function(i,r,a,o,l){var u=(0,Le.al)(t.observerRenderSpace,t.targetDirection),s=r.next((0,Re.kY)(n._view,i.location)).next((0,O.B2)(n._view,u)).next((function(e){return(0,_.Z)((0,_.Z)({},e),{},{manipulatorType:Ae.d.SCALE})}));e(i,s,a)}))}},{key:"updateManipulators",value:function(e){var t=e.target;this._manipulatorHeading.location=t,this._manipulatorTilt.location=t,this._manipulatorDistance.location=t;var n=(0,V.Ue)(),i=function(e){(0,b.Jp)(n,e,n)},r=function(e){var t=1,n=e.verticalFieldOfView,i=e.horizontalFieldOfView,r=n>180,a=i>180,o=e.farDistanceRenderSpace;if(r&&a)return Math.max(t,o);e.arcCentersPoints(o,$e);var l=$e.left,u=$e.right,s=$e.top,c=$e.bottom,d=1.9*(r?(0,C.p)(l,u):a?(0,C.p)(c,l):Math.sqrt(Math.min((0,C.a)(c,s),(0,C.a)(l,u))));return Math.max(t,Math.min(o,d))}(e);i((0,b.xJ)(Ke,(0,C.s)(tt,r,r,r))),i(A(e,Ke));var a=Me*be.Mr*r,o=(0,C.j)(tt,e.targetDirection,a);i((0,b.vc)(Ke,o));var l=(0,b.QO)(Ke,-it);(0,b.dC)(l,l,(0,b.gT)(et,-it)),this._manipulatorHeading.modelTransform=(0,b.dC)((0,V.Ue)(),n,l);var u=(0,b.gT)(Ke,it);(0,b.dC)(u,u,(0,b.QO)(et,Math.PI)),this._manipulatorTilt.modelTransform=(0,b.Jp)((0,V.Ue)(),n,u),this._manipulatorDistance.modelTransform=n}},{key:"_updateManipulatorInteractivity",value:function(){var e=this,t=!this.grabbing;this.forEachManipulator((function(n){n.interactive=t&&e._interactive||n.grabbing}))}},{key:"forEachManipulator",value:function(e){e(this._manipulatorHeading,Ae.d.ROTATE),e(this._manipulatorTilt,Ae.d.ROTATE),e(this._manipulatorDistance,Ae.d.SCALE)}}]),n}(Ze.b),$e={top:(0,M.Ue)(),bottom:(0,M.Ue)(),left:(0,M.Ue)(),right:(0,M.Ue)()},Ke=(0,V.Ue)(),et=(0,V.Ue)(),tt=(0,M.Ue)(),nt=(0,M.Ue)(),it=Math.PI/2;var rt=n(97326),at=(n(75505),n(86741),n(51370),n(10064),function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e,i){var r;(0,a.Z)(this,n),(r=t.call(this,{view:e,autoScaleRenderObjects:!1,worldSized:!1,radius:5,interactive:!1}))._handles=new we.Z;var o=(0,S.EA)(r._color);return r.renderObjects=[new Oe.r((0,Ee.PI)(o,5,32,32))],i.manipulators.add((0,rt.Z)(r)),r._handles.add([(0,h.watch)((function(){return r._color}),(function(e){o.setParameters({color:e})}),h.initial)]),r}return(0,o.Z)(n,[{key:"destroy",value:function(){this._handles.remove(),(0,je.Z)((0,Ne.Z)(n.prototype),"destroy",this).call(this)}},{key:"_color",get:function(){return m.Z.toUnitRGBA(this.view.effectiveTheme.accentColor)}}]),n}(Se.Z));(0,s._)([(0,f.Cb)()],at.prototype,"_color",null);var ot=n(99047),lt=n(89107),ut=n(6599),st=n(97411),ct=n(96026),dt=n(17877),ht=Symbol("dragHandles"),ft=Symbol("hideManipulators"),pt=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e))._moveManipulation=null,i._observerManipulator=null,i._fieldOfViewManipulation=null,i._scaleOrientManipulation=null,i._moveHelperVisualElement=null,i._settings=new ot.Z({getTheme:function(){return i.view.effectiveTheme}}),i._grabbing=!1,i.viewshedComputedData=null,i}return(0,o.Z)(n,[{key:"initialize",value:function(){var e=this;this._moveManipulation=this._createMoveManipulation(),this._fieldOfViewManipulation=new He({view:this.view,tool:this.parentTool}),this._scaleOrientManipulation=new Ye({view:this.view,tool:this.parentTool}),this._observerManipulator=new at(this.view,this.parentTool),this._createMoveHelperVisuals(),this.addHandles([(0,h.watch)((function(){var t=e.observer;return{observer:t,array:null===t||void 0===t?void 0:t.toArray()}}),(function(t){var n=t.observer;null!=n&&(e._moveManipulation.location=n,e._observerManipulator.location=n)}),h.syncAndInitial),(0,h.watch)((function(){var t=e.viewshedComputedData;return{viewshedComputedData:t,observer:null===t||void 0===t?void 0:t.observer}}),(function(t,n){var i=t.viewshedComputedData,r=t.observer;e._grabbing&&r!==(null===n||void 0===n?void 0:n.observer)||(e.removeHandles(ht),(null===i||void 0===i?void 0:i.isValid())&&e.addHandles([e._buildObserverDragPipeline(i),e._buildFOVDragPipeline(i),e._buildScaleOrientDragPipeline(i)].filter(pe.pC),ht))}),h.initial),(0,h.watch)((function(){var t=e.viewshedComputedData;return null!==t&&void 0!==t&&t.isValid()?{viewshedCompData:t,target:t.targetRenderSpace,hFOV:t.horizontalFieldOfView,vFOV:t.verticalFieldOfView}:null}),(function(t){null!=t&&e._fieldOfViewManipulation.updateManipulatorsTransform(t.viewshedCompData)}),h.initial),(0,h.watch)((function(){var t=e.viewshedComputedData;return null!==t&&void 0!==t&&t.isValid()?{viewshedCompData:t,hFOV:t.horizontalFieldOfView,vFOV:t.verticalFieldOfView,tilt:t.tilt}:null}),(function(t){null!=t&&e._fieldOfViewManipulation.updateManipulatorVisuals(t.viewshedCompData)}),h.initial),(0,h.watch)((function(){var t,n;return e.analysisViewData.visible&&null!==(t=null===(n=e.viewshedComputedData)||void 0===n?void 0:n.isValid())&&void 0!==t&&t&&!e.parentTool.placingTarget}),(function(t){return e._updateManipulationAvailability(t)}),h.initial),(0,h.watch)((function(){var t=e.viewshedComputedData;return null!==t&&void 0!==t&&t.isValid()?{viewshedCompData:t,observer:t.observer,target:t.target,verticalFieldOfView:t.verticalFieldOfView,horizontalFieldOfView:t.horizontalFieldOfView}:null}),(function(t){null!=t&&e._scaleOrientManipulation.updateManipulators(t.viewshedCompData)}),h.initial),(0,h.watch)((function(){var t;return null===(t=e.viewshedComputedData)||void 0===t?void 0:t.observerRenderSpace}),(function(t){null!=t&&e._updateMoveHelperVisualsLocation(t)}),h.initial)]);this._forEachManipulator((function(t){e.addHandles([t.events.on("focus-changed",(function(){return e._updateManipulatorVisibility()})),t.events.on("grab-changed",(function(t){e._grabbing="start"===t.action}))])}))}},{key:"destroy",value:function(){this._moveManipulation=(0,d.SC)(this._moveManipulation),this._fieldOfViewManipulation=(0,d.SC)(this._fieldOfViewManipulation),this._scaleOrientManipulation=(0,d.SC)(this._scaleOrientManipulation),this.parentTool.manipulators.remove(this._observerManipulator),this._observerManipulator=(0,d.SC)(this._observerManipulator),this._destroyMoveHelperVisuals()}},{key:"viewshed",get:function(){var e;return null===(e=this.viewshedComputedData)||void 0===e?void 0:e.viewshed}},{key:"grabbing",get:function(){return this._grabbing}},{key:"observer",get:function(){var e;return null===(e=this.viewshed)||void 0===e?void 0:e.observer},set:function(e){var t=this.viewshed;null!=t&&(t.observer=e)}},{key:"discManipulator",get:function(){return this._moveManipulation.xyManipulation.discManipulator}},{key:"onManipulatorSelectionChanged",value:function(){this._updateManipulatorVisibility()}},{key:"hasManipulator",value:function(e){var t=!1;return this._forEachManipulator((function(n){t=t||n===e})),t}},{key:"_someManipulatorSelected",value:function(){return this._moveManipulation.selected||this._fieldOfViewManipulation.selected||this._scaleOrientManipulation.selected}},{key:"_someManipulatorHovering",value:function(){return this._moveManipulation.hovering||this._fieldOfViewManipulation.hovering||this._scaleOrientManipulation.hovering}},{key:"_createMoveManipulation",value:function(){return new ut.b({view:this.view,tool:this.parentTool,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:lt.E5})}},{key:"_buildObserverDragPipeline",value:function(e){var t=this,n=e.observer;return null==n?null:this._moveManipulation.createDragPipeline((function(n,i,r,a,o){a=a.next((0,Re.di)(t,["observer"]));var l=e.observer.clone();if(null==l)return{steps:r,cancel:a};var u=dt.c.fromGeometry(l,(0,ye.wg)(t.view.viewingMode));return{steps:r.next((0,Re.$Q)({operations:u})).next((function(e){return t.observer=(0,ve.project)(u.data.geometry,l.spatialReference),e})),cancel:a}}),{mode:"absolute-height",offset:0},n.spatialReference,void 0)}},{key:"_buildFOVDragPipeline",value:function(e){var t=0,n=0;return this._fieldOfViewManipulation.createDragPipeline((function(i,r,a){if(null==e)return{steps:r,cancel:a};var o=e.viewshed;return a=a.next((0,Re.di)(e,["horizontalFieldOfView","verticalFieldOfView"])),{steps:r.next((function(i){"start"===i.action&&(t=e.horizontalFieldOfView,n=e.verticalFieldOfView);var r=i.deltaAngle,a=0;switch(i.side){case"left":a=t/2-r;break;case"right":a=t/2+r;break;case"top":a=n+2*r;break;case"bottom":a=n-2*r}return ze(i.side)?(a=(a=ue.BV.normalize(a))>270?0:a>180?180:a,o.horizontalFieldOfView=2*a):o.verticalFieldOfView=a,i})),cancel:a}}),e)}},{key:"_buildScaleOrientDragPipeline",value:function(e){var t=0,n=0,i=function(t,n){return function(i,r,a){if(null==e)return{steps:r,cancel:a};var o=e.viewshed;return a=a.next((0,Re.di)(o,[t])),{steps:r=r.next(n(o,e)),cancel:a}}};return(0,y.AL)([this._scaleOrientManipulation.createHeadingDragPipeline(i("heading",(function(t,i){return function(i){return"start"===i.action&&(n=e.heading),t.heading=ue.BV.normalize(n+i.deltaAngle),i}})),e),this._scaleOrientManipulation.createTiltDragPipeline(i("tilt",(function(n,i){return function(i){"start"===i.action&&(t=e.tilt);var r=t+i.deltaAngle;return r<-90?r=180:r>270&&(r=0),n.tilt=_t.clamp(r),i}})),e),this._scaleOrientManipulation.createDistanceDragPipeline(i("farDistance",(function(e,t){return function(n){var i=(0,C.z)(yt,n.renderEnd,t.observerRenderSpace),r=(0,C.H)(i)*t.metersPerUnit,a=(0,C.m)(i,t.targetDirection)<0?1:r;return e.farDistance=a,n}})),e)])}},{key:"_updateManipulationAvailability",value:function(e){this._moveManipulation.available=e,this._fieldOfViewManipulation.available=e,this._scaleOrientManipulation.available=e,this._observerManipulator.available=e}},{key:"_updateManipulatorVisibility",value:function(){var e=this._someManipulatorSelected()||this._someManipulatorHovering()&&null==this.view.activeTool;if(e)this.removeHandles(ft);else{var t=[];this._forEachManipulator((function(e){t.push(e.disableDisplay())})),this.addHandles(t,ft)}this._updateMoveHelperVisualsVisibility(e)}},{key:"_forEachManipulator",value:function(e){this._moveManipulation.forEachManipulator(e),this._fieldOfViewManipulation.forEachManipulator(e),this._scaleOrientManipulation.forEachManipulator(e),e(this._observerManipulator)}},{key:"_createMoveHelperVisuals",value:function(){var e=this;this._destroyMoveHelperVisuals();var t=new ct.W({view:this.view,attached:!0,style:{glowWidth:this._settings.visualElements.heightPlane.glowWidth,innerWidth:this._settings.visualElements.heightPlane.innerWidth},isDecoration:!0}),n=new st.V({view:this.view,extensionType:this._settings.visualElements.zVerticalLine.extensionType,attached:!0,innerWidth:1,writeDepthEnabled:!1,renderOccluded:U.yD.OccludeAndTransparent,isDecoration:!0});this._moveHelperVisualElement={laserline:t,verticalLine:n},this.addHandles([(0,h.watch)((function(){return e._settings.visualElements.zVerticalLine}),(function(e){return e.apply(n)}),h.syncAndInitial),(0,h.watch)((function(){return e._settings.visualElements.heightPlane}),(function(e){return e.apply(t)}),h.syncAndInitial)])}},{key:"_updateMoveHelperVisualsVisibility",value:function(e){e=this.analysisViewData.visible&&e;var t=this._moveHelperVisualElement;null!=t&&(t.verticalLine.visible=e,t.laserline.visible=e)}},{key:"_updateMoveHelperVisualsLocation",value:function(e){var t=this._moveHelperVisualElement;if(null!=t){var n=t.laserline,i=t.verticalLine;n.heightManifoldTarget=e,n.intersectsWorldUpAtLocation=e,null!=e&&i.setStartEndFromWorldDownAtLocation(e)}}},{key:"_destroyMoveHelperVisuals",value:function(){var e=this._moveHelperVisualElement;null!=e&&(e.laserline.destroy(),e.verticalLine.destroy(),this._moveHelperVisualElement=null)}},{key:"test",get:function(){return{moveManipulation:this._moveManipulation,fieldOfViewManipulation:this._fieldOfViewManipulation,scaleOrientManipulation:this._scaleOrientManipulation,moveHelperVisualElements:this._moveHelperVisualElement,viewshedComputedData:this.viewshedComputedData}}}]),n}(c.default);(0,s._)([(0,f.Cb)({constructOnly:!0})],pt.prototype,"analysis",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],pt.prototype,"analysisViewData",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],pt.prototype,"parentTool",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],pt.prototype,"view",void 0),(0,s._)([(0,f.Cb)()],pt.prototype,"viewshed",null),(0,s._)([(0,f.Cb)()],pt.prototype,"_grabbing",void 0),(0,s._)([(0,f.Cb)()],pt.prototype,"grabbing",null),(0,s._)([(0,f.Cb)()],pt.prototype,"viewshedComputedData",void 0),(0,s._)([(0,f.Cb)()],pt.prototype,"observer",null),pt=(0,s._)([(0,p.j)("esri.views.3d.analysis.Viewshed.ViewshedSubTool")],pt);var vt,yt=(0,M.Ue)(),_t=new ue.pE(0,180),mt=n(86509),wt=n(87888),gt=n(81298),bt=n(72612),Vt=vt=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).removeIncompleteOnCancel=!1,i.automaticManipulatorSelection=!1,i._stagedViewshed=null,i._stagedViewshedComputedData=null,i._creating=!1,i._selectedManipulator=null,i._selectedManipulatorSubTool=null,i}return(0,o.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=(0,gt.w)(this.view.state.viewingMode);var t=this.analysisViewData.viewshedComputedDataHandles;this.addHandles([(0,h.watch)((function(){return t.some((function(e){return e.viewshedComputedData.isValid()}))}),(function(t){t&&e.finishToolCreation()}),h.syncAndInitial),(0,h.watch)((function(){return e._stagedViewshed}),(function(t){var n;e._stagedViewshedComputedData=null!=t?null===(n=e.analysisViewData.viewshedComputedDataHandles.find((function(e){return e.viewshedComputedData.viewshed===t})))||void 0===n?void 0:n.viewshedComputedData:null}),h.syncAndInitial),(0,h.watch)((function(){return e.firstGrabbedManipulator}),(function(t){null!=t&&e._selectManipulator(t)}),h.sync),(0,h.watch)((function(){return e.analysisViewData.visible}),(function(t){t||e._selectManipulator(null)})),(0,h.watch)((function(){return e.view.activeTool}),(function(t){t!==e&&null!=t&&e._selectManipulator(null)}))]),this.subToolHandles=(0,h.mapCollection)((function(){return t}),(function(t){var n=t.viewshedComputedData,i=new pt({analysis:e.analysis,analysisViewData:e.analysisViewData,parentTool:e,view:e.view,viewshedComputedData:n});return{subTool:i,remove:function(){e._selectedManipulatorSubTool===i&&e._selectManipulator(null),i.destroy()}}}))}},{key:"destroy",value:function(){this.subToolHandles=(0,d.SC)(this.subToolHandles)}},{key:"onDeactivate",value:function(){this.removeStaged()}},{key:"cursor",get:function(){return this.creating?"crosshair":null}},{key:"_selectManipulator",value:function(e){var t,n,i,r=this._selectedManipulator;null!=r&&(r.selected=!1,this._selectedManipulator=null,null!==(t=this._selectedManipulatorSubTool)&&void 0!==t&&t.onManipulatorSelectionChanged(),this._selectedManipulatorSubTool=null),null!=e&&(e.selected=!0,this._selectedManipulator=e,this._selectedManipulatorSubTool=null===(n=this.subToolHandles.find((function(t){return t.subTool.hasManipulator(e)})))||void 0===n?void 0:n.subTool,null===(i=this._selectedManipulatorSubTool)||void 0===i||i.onManipulatorSelectionChanged())}},{key:"selectedViewshed",get:function(){var e;return null===(e=this._selectedManipulatorSubTool)||void 0===e?void 0:e.viewshed},set:function(e){this.selectViewshed(e)}},{key:"selectedViewshedComputedData",get:function(){var e;return null===(e=this._selectedManipulatorSubTool)||void 0===e?void 0:e.viewshedComputedData}},{key:"stagedViewshed",get:function(){return this._stagedViewshed}},{key:"grabbing",get:function(){return this.subToolHandles.some((function(e){return e.subTool.grabbing}))}},{key:"creating",get:function(){return this._creating&&this.active}},{key:"placingTarget",get:function(){return null!=this._stagedViewshed}},{key:"createViewsheds",value:function(){this._creating=!0}},{key:"onManipulatorSelectionChanged",value:function(){this.subToolHandles.forEach((function(e){return e.subTool.onManipulatorSelectionChanged()}))}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-click":this._clickDeselectHandler();break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":wt.Sn.cancel===e.key?this._cancelKeyHandler(e):wt.Sn.delete.includes(e.key)&&this._deleteKeyHandler()}}},{key:"onInputEventAfter",value:function(e){"immediate-click"===e.type&&this._clickPlacementHandler(e)}},{key:"_clickDeselectHandler",value:function(){this.hasFocusedManipulators||this._selectManipulator(null)}},{key:"_clickPlacementHandler",value:function(e){if(this.creating&&!this.hasFocusedManipulators){var t=this._stagedViewshed,n=this._intersectScreen(e,At);if(null!=n){if(null==t){var i;n.mapPoint.z=(null!==(i=n.mapPoint.z)&&void 0!==i?i:0)+2;var r=new he({observer:n.mapPoint.clone()});this.analysis.viewsheds.add(r),this._stagedViewshed=r,this._updateStagedViewshed(n.scenePoint)}else{this._updateStagedViewshed(n.scenePoint);var a=this._stagedViewshed;this._stagedViewshed=null,this.selectViewshed(a)}e.stopPropagation()}}}},{key:"_doubleClickHandler",value:function(e){this.creating&&(this.removeStaged(),this._selectManipulator(null),this._creating=!1,this.view.activeTool=null,e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(this.creating&&null!=this._stagedViewshed){var t=this._intersectScreen(e,At);null!=t&&this._updateStagedViewshed(t.scenePoint)}}},{key:"_cancelKeyHandler",value:function(e){if(this.creating){if(this.removeStaged())return this._selectManipulator(null),void e.stopPropagation();this._creating=!1}else if(!this.grabbing)return this.selectViewshed(null),void e.stopPropagation()}},{key:"_deleteKeyHandler",value:function(){this.creating&&this.removeStaged(),null!=this.selectedViewshed&&this.analysis.viewsheds.remove(this.selectedViewshed)}},{key:"_updateStagedViewshed",value:function(e){var t=this._stagedViewshed,n=this._stagedViewshedComputedData;if(null!=t&&null!=n){var i=function(e,t,n){var i=t.observerRenderSpace,r=(0,C.z)(Ct,n,i),a=(0,C.H)(r)*t.metersPerUnit,o=e.renderCoordsHelper.basisMatrixAtPosition(i,St),l=(0,C.s)(Mt,o[8],o[9],o[10]),u=(0,fe.Yq)(i,l,Ot),s=(0,fe.nF)(u,n,kt),c=(0,C.z)(s,s,i),d=(0,g.BV)((0,C.d)(r,c))*((0,C.m)(l,r)<0?-1:1)+90,h=(0,C.s)(Dt,o[4],o[5],o[6]),f=(0,g.BV)((0,C.d)(h,c)),p=(0,C.s)(Dt,o[0],o[1],o[2]);return{heading:(0,C.m)(c,p)<0?360-f:f,tilt:d,farDistance:a}}(this.view,n,e),r=i.heading,a=i.tilt,o=i.farDistance;t.farDistance=o,t.tilt=a,t.heading=r}}},{key:"removeStaged",value:function(){return null!=this._stagedViewshed&&(this.analysis.viewsheds.remove(this._stagedViewshed),this._stagedViewshed=null,!0)}},{key:"selectViewshed",value:function(e){var t;if(null!=e){var n,i=(0,oe.Z)(this.view.tools.items);try{for(i.s();!(n=i.n()).done;){var r=n.value;r!==this&&r instanceof vt&&r.selectViewshed(null)}}catch(o){i.e(o)}finally{i.f()}}var a=null===(t=this.subToolHandles.find((function(t){return t.subTool.viewshed===e})))||void 0===t?void 0:t.subTool;this._selectManipulator(null===a||void 0===a?void 0:a.discManipulator)}},{key:"_intersectScreen",value:function(e,t){var n=(0,bt.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(n,this._intersector);var i=this._intersector.results.min,r=t.scenePoint;if(!i.getIntersectionPoint(r))return null;var a=t.mapPoint;return a.spatialReference=this.view.spatialReference,this.view.renderCoordsHelper.fromRenderCoords(r,a),null==a?null:t}},{key:"test",get:function(){var e;return{subTools:this.subToolHandles.map((function(e){return e.subTool.test})),selectedSubTool:null===(e=this._selectedManipulatorSubTool)||void 0===e?void 0:e.test,stagedViewshed:this._stagedViewshed}}}]),n}(mt.f);(0,s._)([(0,f.Cb)({constructOnly:!0})],Vt.prototype,"view",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"analysisViewData",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"removeIncompleteOnCancel",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"automaticManipulatorSelection",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0})],Vt.prototype,"analysis",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"subToolHandles",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"_stagedViewshed",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"_stagedViewshedComputedData",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"_creating",void 0),(0,s._)([(0,f.Cb)({readOnly:!0})],Vt.prototype,"cursor",null),(0,s._)([(0,f.Cb)()],Vt.prototype,"_selectedManipulator",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"_selectedManipulatorSubTool",void 0),(0,s._)([(0,f.Cb)()],Vt.prototype,"selectedViewshed",null),(0,s._)([(0,f.Cb)()],Vt.prototype,"selectedViewshedComputedData",null),(0,s._)([(0,f.Cb)()],Vt.prototype,"grabbing",null),(0,s._)([(0,f.Cb)()],Vt.prototype,"creating",null),(0,s._)([(0,f.Cb)()],Vt.prototype,"placingTarget",null),Vt=vt=(0,s._)([(0,p.j)("esri.views.3d.analysis.Viewshed.ViewshedTool")],Vt);var Ct=(0,M.Ue)(),Mt=(0,M.Ue)(),kt=(0,M.Ue)(),Dt=(0,M.Ue)(),St=(0,V.Ue)(),Ot=(0,fe.Ue)(),At={mapPoint:new I.Z,scenePoint:(0,M.Ue)()},Zt=Vt,Et=n(58206),Tt=n(70209),Ut=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).type="viewshed-view-3d",i.analysis=null,i.tool=null,i.viewshedComputedDataHandles=null,i._placementTask=null,i}return(0,o.Z)(n,[{key:"selectedViewshed",get:function(){var e;return null===(e=this.tool)||void 0===e?void 0:e.selectedViewshed},set:function(e){var t=this.tool;null!=t&&(t.selectedViewshed=e)}},{key:"selectedViewshedComputedData",get:function(){var e;return null===(e=this.tool)||void 0===e?void 0:e.selectedViewshedComputedData}},{key:"initialize",value:function(){var e=this;this._initializeUpdateHandle(),this.viewshedComputedDataHandles=(0,h.mapCollection)((function(){return e.analysis.viewsheds}),(function(t){var n=new L({renderCoordsHelper:e.view.renderCoordsHelper,viewshed:t}),i=Symbol();return e.addHandles((0,h.watch)((function(){return n.isValid()}),(function(t,i){e.visible&&(t?e._addViewshedsToRenderer(n):i&&e._removeViewshedsFromRenderer(n))}),h.initial)),{viewshedComputedData:n,remove:function(){e.removeHandles(i),e._removeViewshedsFromRenderer(n),n.destroy()}}})),this._analysisVisualization=new F({view:this.view,analysisViewData:this,isDecoration:!this.parent}),this.addHandles([(0,h.watch)((function(){return e.visible}),(function(t){var n=e.viewshedComputedDataHandles.map((function(e){return e.viewshedComputedData})).filter((function(e){return e.isValid()}));t?e._addViewshedsToRenderer(n):e._removeViewshedsFromRenderer(n)})),(0,h.watch)((function(){return e.view.renderCoordsHelper}),(function(t){e.viewshedComputedDataHandles.forEach((function(e){return e.viewshedComputedData.renderCoordsHelper=t}))})),(0,Tt.Lp)(this,Zt)])}},{key:"destroy",value:function(){this._placementTask=(0,d.IM)(this._placementTask),(0,Tt.Yq)(this),this._analysisVisualization=(0,d.SC)(this._analysisVisualization),this._removeViewshedsFromRenderer(this.viewshedComputedDataHandles.map((function(e){return e.viewshedComputedData})))}},{key:"createViewsheds",value:function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._placementTask=(0,d.IM)(this._placementTask),this._placementTask=(0,Tt.Er)(this,t),null!=this.tool&&this.tool.createViewsheds(),e.next=5,this._placementTask.promise;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_initializeUpdateHandle",value:function(){var e=this.view._stage.renderer.plugins.plugins.find((function(e){return e instanceof Et.U}));e&&(this._updateHandleInRenderer=e.updateViewsheds.bind(e))}},{key:"_addViewshedsToRenderer",value:function(e){this._updateHandleInRenderer({adds:e})}},{key:"_removeViewshedsFromRenderer",value:function(e){this._updateHandleInRenderer({removes:e})}}]),n}((0,v.p)(c.default));(0,s._)([(0,f.Cb)({readOnly:!0})],Ut.prototype,"type",void 0),(0,s._)([(0,f.Cb)({constructOnly:!0,nonNullable:!0})],Ut.prototype,"analysis",void 0),(0,s._)([(0,f.Cb)()],Ut.prototype,"tool",void 0),(0,s._)([(0,f.Cb)()],Ut.prototype,"selectedViewshed",null),(0,s._)([(0,f.Cb)()],Ut.prototype,"selectedViewshedComputedData",null),(0,s._)([(0,f.Cb)()],Ut.prototype,"viewshedComputedDataHandles",void 0),(0,s._)([(0,f.Cb)()],Ut.prototype,"_analysisVisualization",void 0),(0,s._)([(0,f.Cb)()],Ut.prototype,"_placementTask",void 0);var Rt=Ut=(0,s._)([(0,p.j)("esri.views.3d.analysis.ViewshedAnalysisView3D")],Ut)},51328:function(e,t,n){n.d(t,{B2:function(){return S},G:function(){return M},J4:function(){return A},JA:function(){return k},Sp:function(){return D},_N:function(){return g},bB:function(){return b},cx:function(){return i},gv:function(){return Z},zP:function(){return O}});var i,r=n(1413),a=(n(59486),n(17842)),o=n(32035),l=n(12400),u=n(79803),s=n(55652),c=n(40885),d=n(40927),h=n(51378),f=n(74509),p=n(81703),v=n(88153),y=n(54463),_=n(76783),m=n(74229),w=n(848);function g(e,t){return V(e,(function(){return t}))}function b(e){return V(e,(function(e){return e.plane}))}function V(e,t){var n=(0,l.Ue)(),i=(0,l.Ue)(),o=!1;return function(l){var u=t(l);if("start"===l.action){var c=(0,a.md)(l.screenStart,(0,a.c$)(h.qW.get())),d=(0,p.u4)(e.state.camera,c,U);null!=d&&(o=(0,s.BR)(u,d,n))}if(!o)return null;var f=(0,a.md)(l.screenEnd,(0,a.c$)(h.qW.get())),v=(0,p.u4)(e.state.camera,f,U);return null==v?null:(0,s.BR)(u,v,i)?(0,r.Z)((0,r.Z)({},l),{},{renderStart:n,renderEnd:i,plane:u,ray:v}):null}}function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=null;return function(s){if("start"===s.action&&(null!=(l=e.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(s.screenStart.x,s.screenStart.y),t,n,o))&&null!=i&&!(0,u.projectPoint)(l,l,i)))return null;if(null==l)return null;var c=e.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(s.screenEnd.x,s.screenEnd.y),t,n,o);return null==c||null!=i&&!(0,u.projectPoint)(c,c,i)?null:(0,r.Z)((0,r.Z)({},s),{},{mapStart:l,mapEnd:c})}}function M(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return C(e,n,(0,f.Ou)(t,e,n),i,r)}function k(e,t,n,i){var r=n.toMap(e.screenStart);return null!=r?M(t,r,n.elevationInfo,i):null}function D(e,t,n){var i=null,r=new m.hM;return r.next(g(e,function(e,t){var n=E,i=T,r=(0,s.Ue)();e.renderCoordsHelper.worldUpAtPosition(t,n);var a=(0,o.b)((0,s.st)(r),n,(0,o.f)(i,t,e.state.camera.eye));return(0,o.b)(a,a,n),(0,s.Yq)(t,a,r)}(e,t))).next(function(e,t){var n=(0,l.Ue)(),i=(0,o.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,n);var r=(0,l.Ue)(),a=(0,l.Ue)(),u=function(r){return(0,o.f)(r,r,t),(0,d.nF)(n,r,r),"global"===e.viewingMode&&(0,o.l)(r)*Math.sign((0,o.m)(n,r))<.001-i&&(0,o.f)(r,(0,o.j)(r,n,.001),t),(0,o.g)(r,r,t),r};return function(e){return e.renderStart=u((0,o.c)(r,e.renderStart)),e.renderEnd=u((0,o.c)(a,e.renderEnd)),e}}(e,t)).next(O(e,n)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,i=e})),function(e){return i=null,r.execute(e),i}}function S(e,t){var n=function(n){var i=(0,a.md)(n,(0,a.c$)(h.qW.get())),r=(0,p.u4)(e.state.camera,i,U);return null==r?null:(0,c._w)(t,r,E,T)[1]};return function(e){var t=n(e.screenStart);if(null==t)return null;var i=n(e.screenEnd);return null==i?null:(0,r.Z)((0,r.Z)({},e),{},{renderStart:t,renderEnd:i})}}function O(e,t){var n=e.renderCoordsHelper;return function(e){var i=n.fromRenderCoords(e.renderStart,new w.Z({spatialReference:t})),a=n.fromRenderCoords(e.renderEnd,new w.Z({spatialReference:t}));return null!=i&&null!=a?(0,r.Z)((0,r.Z)({},e),{},{mapStart:i,mapEnd:a}):null}}function A(e){var t=null;return function(n){switch(n.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return n}}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,v.Z8)(e.state.viewingMode);n.options.selectionMode=!0,n.options.store=y.eC.MIN,n.options.hud=!1;var o,u=(0,a.s1)(),s={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=(0,l.Ue)(),d=null!==t&&void 0!==t?t:e.spatialReference,h=function(t){e.map.ground&&e.map.ground.opacity<1?s.exclude.add(_.xX):s.exclude.delete(_.xX),e.sceneIntersectionHelper.intersectIntersectorScreen((0,a.md)(t,u),n,s);var r,o=n.results.min;if(o.getIntersectionPoint(c))r=o.intersector===y.q7.TERRAIN?i.GROUND:i.OTHER;else{if(!n.results.ground.getIntersectionPoint(c))return null;r=i.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(c,new w.Z({spatialReference:d})),surfaceType:r}};return function(e){if("start"===e.action){var t=h(e.screenStart);o=null!=t?t.location:null}if(null==o)return null;var n=h(e.screenEnd);return null!=(null===n||void 0===n?void 0:n.location)?(0,r.Z)((0,r.Z)({},e),{},{mapStart:o,mapEnd:n.location,surfaceType:n.surfaceType}):null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(i||(i={}));var E=(0,l.Ue)(),T=(0,l.Ue)(),U=(0,c.Ue)()},33837:function(e,t,n){n.d(t,{r:function(){return _}});var i=n(37762),r=n(15671),a=n(43144),o=n(60136),l=n(29388),u=n(29134),s=n(7025),c=n(32035),d=n(12400),h=n(86361),f=n(52168),p=n(79685),v=n(56529),y=n(58901),_=function(e){(0,o.Z)(n,e);var t=(0,l.Z)(n);function n(e,i){var a;return(0,r.Z)(this,n),(a=t.call(this,e))._hasExternalMaterial=!1,a._hasExternalMaterial=null!=i,a._material=null!=i?i:new y.U({width:1,color:(0,h.al)(1,0,1,1),stippleOffColor:null,stipplePattern:null,stipplePreferContinuous:!0,isClosed:!1,falloff:0,innerColor:null,innerWidth:1,hasPolygonOffset:!1,renderOccluded:v.yD.OccludeAndTransparent,isDecoration:!!e.isDecoration,writeDepth:!0}),a.applyProperties(e),a}return(0,a.Z)(n,[{key:"setGeometryFromRenderSpacePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.geometry=[[[e[0]-t,e[1],e[2]],[e[0]+t,e[1],e[2]]],[[e[0],e[1]-t,e[2]],[e[0],e[1]+t,e[2]]],[[e[0],e[1],e[2]-t],[e[0],e[1],e[2]+t]]]}},{key:"setGeometryFromExtent",value:function(e){var t=this.view.spatialReference,n=(0,d.Ue)(),i=(0,d.Ue)(),r=100,a=[];(0,c.s)(n,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),a.push([i[0],i[1],i[2]]),(0,c.s)(n,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),a.push([i[0],i[1],i[2]]),(0,c.s)(n,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),a.push([i[0],i[1],i[2]]),(0,c.s)(n,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),a.push([i[0],i[1],i[2]]),(0,c.s)(n,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),a.push([i[0],i[1],i[2]]),(0,c.s)(n,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(n,t,i),a.push([i[0],i[1],i[2]]),this.geometry=[a]}},{key:"setGeometryFromFrustum",value:function(e){var t=[];e.lines.forEach((function(e){t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}},{key:"setGeometryFromBoundedPlane",value:function(e){var t=[],n=e.origin,i=e.basis1,r=e.basis2,a=.5,o=(0,d.Ue)(),l=(0,d.Ue)(),u=(0,d.Ue)(),s=(0,d.Ue)();o[0]=n[0]-i[0]*a-r[0]*a,o[1]=n[1]-i[1]*a-r[1]*a,o[2]=n[2]-i[2]*a-r[2]*a,l[0]=n[0]-i[0]*a+r[0]*a,l[1]=n[1]-i[1]*a+r[1]*a,l[2]=n[2]-i[2]*a+r[2]*a,u[0]=n[0]+i[0]*a+r[0]*a,u[1]=n[1]+i[1]*a+r[1]*a,u[2]=n[2]+i[2]*a+r[2]*a,s[0]=n[0]+i[0]*a-r[0]*a,s[1]=n[1]+i[1]*a-r[1]*a,s[2]=n[2]+i[2]*a-r[2]*a,t.push([o[0],o[1],o[2]]),t.push([l[0],l[1],l[2]]),t.push([u[0],u[1],u[2]]),t.push([s[0],s[1],s[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}},{key:"setGeometryFromSegment",value:function(e){var t=e.endRenderSpace;this.transform=(0,u.vc)(m,t);var n=e.createRenderGeometry(t,this.view.renderCoordsHelper).points;this.geometry=[n]}},{key:"setGeometryFromSegments",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d.AG;this.transform=(0,u.vc)(m,n),this.geometry=e.map((function(e){return e.createRenderGeometry(n,t.view.renderCoordsHelper).points}))}},{key:"getTransformedGeometry",value:function(){var e=this;return null==this._geometry?null:this._geometry.map((function(t){return t.map((function(t){return(0,c.h)((0,d.Ue)(),t,e.transform)}))}))}},{key:"renderOccluded",get:function(){return this._material.parameters.renderOccluded},set:function(e){this._material.setParameters({renderOccluded:e})}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._material.parameters.width},set:function(e){this._material.setParameters({width:e})}},{key:"color",get:function(){return this._material.parameters.color},set:function(e){var t=1===e[3];this._material.setParameters({color:(0,h.d9)(e),writeDepth:t})}},{key:"innerWidth",get:function(){return this._material.parameters.innerWidth},set:function(e){this._material.setParameters({innerWidth:e})}},{key:"innerColor",get:function(){return this._material.parameters.innerColor},set:function(e){this._material.setParameters({innerColor:null!=e?(0,h.d9)(e):null})}},{key:"stipplePattern",get:function(){return this._material.parameters.stipplePattern},set:function(e){null!=this._material&&this._material.setParameters({stipplePattern:e})}},{key:"stippleOffColor",get:function(){return this._material.parameters.stippleOffColor},set:function(e){this._material.setParameters({stippleOffColor:null!=e?(0,h.d9)(e):null})}},{key:"stipplePreferContinuous",get:function(){return this._material.parameters.stipplePreferContinuous},set:function(e){this._material.setParameters({stipplePreferContinuous:e})}},{key:"falloff",get:function(){return this._material.parameters.falloff},set:function(e){this._material.setParameters({falloff:e})}},{key:"polygonOffset",get:function(){return this._material.parameters.hasPolygonOffset},set:function(e){this._material.setParameters({hasPolygonOffset:e})}},{key:"createExternalResources",value:function(){}},{key:"destroyExternalResources",value:function(){}},{key:"createGeometries",value:function(e){var t,n=(0,i.Z)((0,p.c)(this.geometry));try{for(n.s();!(t=n.n()).done;){var r=t.value,a=(0,p.Y)(this._material,r);e.addGeometry(a)}}catch(o){n.e(o)}finally{n.f()}}},{key:"forEachExternalMaterial",value:function(e){this._hasExternalMaterial||e(this._material)}}]),n}(f._),m=(0,s.Ue)()},70209:function(e,t,n){n.d(t,{Er:function(){return s},Lp:function(){return c},Yq:function(){return d}});var i=n(74165),r=n(15861),a=n(14921),o=n(92026),l=n(66978),u=n(94172);function s(e,t){e.interactive=!0;var n=e.tool,s=e.view;s.activeTool=n;var c=(0,l.fu)(t,(function(){s.activeTool===n&&(s.activeTool=null)}));return(0,a.vr)(function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.whenOnce)((function(){return null==n||!n.active}),t);case 2:c=(0,o.hw)(c);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t)}function c(e,t){return(0,u.watch)((function(){return e.interactive}),(function(){return function(e,t){e.interactive?function(e,t){d(e);var n=e.view,i=e.analysis,r=new t({view:n,analysis:i,analysisViewData:e});e.tool=r,n.tools.add(r)}(e,t):d(e)}(e,t)}),u.syncAndInitial)}function d(e){var t=e.view,n=e.tool;null!=n&&(t.tools.remove(n),e.tool=null)}},86509:function(e,t,n){n.d(t,{f:function(){return c}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),l=n(27366),u=n(94172),s=(n(32718),n(93169),n(84936),n(10064),n(69912)),c=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,e)}return(0,r.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,u.watch)((function(){return e.analysisViewData.visible}),(function(t){return e.visible=t}),u.syncAndInitial))}},{key:"deactivate",value:function(){this.onDeactivate(),this.created||this.analysis.clear()}},{key:"resetCreated",value:function(){this._set("created",!1)}}]),n}(n(45900).m);c=(0,l._)([(0,s.j)("esri.views.interactive.AnalysisToolBase")],c)},81298:function(e,t,n){n.d(t,{w:function(){return a}});var i=n(88153),r=n(54463);function a(e){var t=(0,i.Z8)(e);return t.options.store=r.eC.MIN,t.options.hud=!1,t}},87888:function(e,t,n){n.d(t,{G7:function(){return v},Kj:function(){return h},Lk:function(){return p},Sn:function(){return d},T6:function(){return f}});var i=n(37762),r=n(15671),a=n(43144),o=n(63780),l=n(42537),u=n(77427),s=n(1614),c=n(67750),d={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},h={toggle:"Control"},f={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},p={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:c.C,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:"z",redo:"r"},v=function(){function e(){(0,r.Z)(this,e),this._bindings=new Map}return(0,a.Z)(e,[{key:"add",value:function(e,t){return this.addToggle(e,(function(e){"key-down"===e.type&&t(e)}))}},{key:"addToggle",value:function(e,t){var n=y.fromDefinition(e,t),i=(0,u.s1)(this._bindings,n.key,(function(){return[]}));return i.push(n),(0,l.kB)((function(){return(0,o.Od)(i,n)}))}},{key:"register",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.f.WIDGET;return(0,l.AL)([e.on("key-down",(function(n){return t.dispatch(e.inputManager,n)}),n),e.on("key-up",(function(n){return t.dispatch(e.inputManager,n)}),n)])}},{key:"dispatch",value:function(e,t){var n=t.key,r=this._bindings.get(n);if(r){var a,o=(0,i.Z)(r);try{for(o.s();!(a=o.n()).done;){a.value.process(e,t)}}catch(l){o.e(l)}finally{o.f()}}}}]),e}(),y=function(){function e(t,n,i,a,o){(0,r.Z)(this,e),this.key=t,this.modifiers=n,this.repeats=i,this.continuePropagation=a,this.callback=o}return(0,a.Z)(e,[{key:"process",value:function(e,t){if(!(t.key!==this.key||"repeat"in t&&t.repeat&&!this.repeats)){var n,r=(0,i.Z)(this.modifiers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!e.isModifierKeyDown(a))return}}catch(o){r.e(o)}finally{r.f()}this.continuePropagation||t.stopPropagation(),this.callback(t)}}}],[{key:"fromDefinition",value:function(t,n){if("string"==typeof t)return new e(t,[],!1,!1,n);var i=t.key,r=t.modifier,a=t.repeats,o=t.continuePropagation;return new e(i,r?Array.isArray(r)?r:[r]:[],!!a,!!o,n)}}]),e}()},94163:function(e,t,n){n.d(t,{SP:function(){return i},UG:function(){return d},dU:function(){return c},k0:function(){return u},xO:function(){return s}});n(16889);var i,r=n(13611),a=n(6644);function o(e,t){return e[0]*t[1]-e[1]*t[0]}function l(e,t,n){var i=(0,r.AK)(n,t)/(0,r.we)(n);return(0,r.bA)(e,n,i)}function u(e,t,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n;return(0,r.$X)(f,i,n),(0,r.$X)(v,t,a),l(y,v,f),(0,r.IH)(e,a,y)}function s(e,t,n,i){(0,r.$X)(f,t,n);var a=i/(0,r.kE)(f);return(0,r.od)(e,n,f,a)}function c(e,t){var n=e.start,a=e.end,l=t.start,u=t.end,s=(0,r.$X)(f,a,n),c=(0,r.$X)(p,u,l),d=o(s,c);if(Math.abs(d)<=h)return[];var _=(0,r.$X)(v,n,l),m=o(c,_)/d,w=o(s,_)/d;if(m>=0){if(w>=0||t.type===i.LINE)return[(0,r.od)(y,n,s,m)]}else if(e.type===i.LINE&&(w>=0||t.type===i.LINE))return[(0,r.od)(y,n,s,m)];return[]}function d(e,t,n){var a=[],o=(0,r.$X)(f,e.end,e.start),l=(0,r.$X)(p,e.start,t),u=(0,r.we)(o),s=2*(0,r.AK)(o,l),c=s*s-4*u*((0,r.we)(l)-n*n);if(0===c){var d=-s/(2*u);(e.type===i.LINE||d>=0)&&a.push((0,r.od)(y,e.start,o,d))}else if(c>0){var h=Math.sqrt(c),_=(-s+h)/(2*u);(e.type===i.LINE||_>=0)&&a.push((0,r.od)(y,e.start,o,_));var m=(-s-h)/(2*u);(e.type===i.LINE||m>=0)&&a.push((0,r.od)(v,e.start,o,m))}return a}!function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"}(i||(i={}));var h=1e-6,f=(0,a.Ue)(),p=(0,a.Ue)(),v=(0,a.Ue)(),y=(0,a.Ue)()}}]);
//# sourceMappingURL=97433.adb0f78b.chunk.js.map